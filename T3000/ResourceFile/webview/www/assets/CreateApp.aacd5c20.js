import{a1 as a,h as e,o as l,X as t,a3 as s,a4 as o,Z as i,c as n,aq as p,ao as d}from"./index.0d1b2de5.js";import{Q as r}from"./QPage.bbc3658c.js";import{u as c}from"./use-quasar.637dff1a.js";import{F as u}from"./FileUploadS3.0e9945c8.js";import{b as m}from"./common.0b6795d5.js";import{u as v}from"./T3Data.78a66940.js";import{l as f}from"./api.c8f0b595.js";import"./index.2aa25af0.js";import"./_commonjsHelpers.a5007c1f.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.d11c4764.js";const y={class:"flex flex-col w-full max-w-7xl"},g={class:"flex items-center"},b={class:"image-container relative w-52"},h={class:"flex grid-cols-4 gap-4"},w={__name:"CreateApp",setup(w){var j,x;const A=c(),_=a(),I=e({}),E=e(null);function T(a){return delete a.type,delete a.id,delete a.pid,delete a.command,delete a.decom,a}function U(a){const e=a.body;I.value.imageId=e.id,P()}async function D(){var a,e;v.value&&((null==(e=null==(a=E.value)?void 0:a.uppy.getFiles())?void 0:e.length)>0?E.value.upload():P())}function P(){f.post("t3Apps",{json:I.value}).then((async()=>{_.push({path:"/apps-library/user/apps"}),A.notify({type:"positive",message:"Application saved"})})).catch((a=>{}))}return l((()=>{var a,e;m.value.title="Create Application",m.value.back="/apps-library",null==(e=null==(a=window.chrome)?void 0:a.webview)||e.postMessage({action:1})})),null==(x=null==(j=window.chrome)?void 0:j.webview)||x.addEventListener("message",(a=>{var e,l,t;"action"in a.data&&("GET_INITIAL_DATA_RES"===a.data.action?(a.data.data&&(a.data.data=JSON.parse(a.data.data)),null==(l=null==(e=window.chrome)?void 0:e.webview)||l.postMessage({action:0,panelId:a.data.entry.pid})):"GET_PANEL_DATA_RES"===a.data.action&&(null==(t=a.data)?void 0:t.panel_id)&&(I.value=function(a){const e=(a,e)=>{const l=a.filter(e);return l.length?l.map(T):void 0},{panel_id:l,ranges:t,data:s}=a,o=e(s,(a=>"INPUT"===a.type)),i=e(s,(a=>"OUTPUT"===a.type)),n=e(s,(a=>"VARIABLE"===a.type)),p=e(s,(a=>"GRP"===a.type)),d=e(s,(a=>"PID"===a.type)),r=e(s,(a=>"SCHEDULE"===a.type)),c=e(s,(a=>"PROGRAM"===a.type)),u=e(s,(a=>"HOLIDAY"===a.type));return{panelId:l||0,inputs:o,outputs:i,variables:n,graphics:p,pids:d,schedules:r,programs:c,holidays:u,ranges:t}}(a.data)))})),(a,e)=>(t(),s(r,{class:"flex justify-center p-4"},{default:o((()=>[i("div",y,[i("div",g,[i("div",b,[n(u,{ref_key:"fileUploaderRef",ref:E,path:"app-images",types:["image/*"],height:150,onUploaded:U},null,512)]),n(p,{class:"grow px-4",modelValue:I.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value.name=a),label:"Name"},null,8,["modelValue"])]),n(p,{class:"py-2",modelValue:I.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value.description=a),label:"Description",type:"textarea",autogrow:""},null,8,["modelValue"]),i("div",h,[n(d,{label:"Save",color:"primary",icon:"save",onClick:D}),n(d,{label:"Cancel",icon:"cancel",to:"/apps-library"})])])])),_:1}))}};export{w as default};

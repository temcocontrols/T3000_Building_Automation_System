import{a0 as B,y as f,m as C,o as L,c as S,w as k,W as d,a as i,ad as v,X as y}from"./index.b8957d33.js";import{Q as M}from"./QPage.7f410c7e.js";import{u as Q,l as G}from"./api.5c0d92ff.js";import{F as O}from"./FileUploadS3.3c9a40f7.js";import{b as _}from"./common.92de8209.js";import{u as F}from"./T3Data.8df31f71.js";import"./plugin-vue_export-helper.21dcd24c.js";const j={class:"flex flex-col w-full max-w-7xl"},H={class:"flex items-center"},q={class:"image-container relative w-52"},J={class:"flex grid-cols-4 gap-4"},te={__name:"CreateApp",setup(W){var r,u;const w=Q(),h=B(),l=f({}),n=f(null);C(()=>{var e,a;_.value.title="Create Application",_.value.back="/apps-library",(a=(e=window.chrome)==null?void 0:e.webview)==null||a.postMessage({action:1})}),(u=(r=window.chrome)==null?void 0:r.webview)==null||u.addEventListener("message",e=>{var a,o,p;"action"in e.data&&(e.data.action==="GET_INITIAL_DATA_RES"?(e.data.data&&(e.data.data=JSON.parse(e.data.data)),(o=(a=window.chrome)==null?void 0:a.webview)==null||o.postMessage({action:0,panelId:e.data.entry.pid})):e.data.action==="GET_PANEL_DATA_RES"&&(p=e.data)!=null&&p.panel_id&&(l.value=D(e.data)))});function A(e){return delete e.type,delete e.id,delete e.pid,delete e.command,delete e.decom,e}function D(e){const a=(t,P)=>{const m=t.filter(P);return m.length?m.map(A):void 0},{panel_id:o,ranges:p,data:s}=e,x=a(s,t=>t.type==="INPUT"),U=a(s,t=>t.type==="OUTPUT"),I=a(s,t=>t.type==="VARIABLE"),R=a(s,t=>t.type==="GRP"),E=a(s,t=>t.type==="PID"),T=a(s,t=>t.type==="SCHEDULE"),V=a(s,t=>t.type==="PROGRAM"),N=a(s,t=>t.type==="HOLIDAY");return{panelId:o||0,inputs:x,outputs:U,variables:I,graphics:R,pids:E,schedules:T,programs:V,holidays:N,ranges:p}}function b(e){const a=e.body;l.value.imageId=a.id,c()}async function g(){var e,a;if(!!F.value){if(console.log("fileUploaderRef.value",n.value),((a=(e=n.value)==null?void 0:e.uppy.getFiles())==null?void 0:a.length)>0){n.value.upload();return}c()}}function c(){G.post("t3Apps",{json:l.value}).then(async()=>{h.push({path:"/apps-library/user/apps"}),w.notify({type:"positive",message:"Application saved"})}).catch(e=>{console.error(e)})}return(e,a)=>(L(),S(M,{class:"flex justify-center p-4"},{default:k(()=>[d("div",j,[d("div",H,[d("div",q,[i(O,{ref_key:"fileUploaderRef",ref:n,path:"app-images",types:["image/*"],height:150,onUploaded:b},null,512)]),i(v,{class:"grow px-4",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.name=o),label:"Name"},null,8,["modelValue"])]),i(v,{class:"py-2",modelValue:l.value.description,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.description=o),label:"Description",type:"textarea",autogrow:""},null,8,["modelValue"]),d("div",J,[i(y,{label:"Save",color:"primary",icon:"save",onClick:g}),i(y,{label:"Cancel",icon:"cancel",to:"/apps-library"})])])]),_:1}))}};export{te as default};

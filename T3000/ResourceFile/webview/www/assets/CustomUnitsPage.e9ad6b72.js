import{j as e}from"./react.2da10d74.js";import{r as t}from"./client.b9d1bbf8.js";import{w as s,A as n,x as r,T as i,b3 as l,B as o,y as a,D as d,I as c,F as x}from"./App.2c62e2d1.js";import{c as p,D as u,a as m,b as f,d as h,e as j,f as g,T as y}from"./DataGridHeaderCell.34491fc4.js";import{B as v}from"./Badge.bfe12ada.js";import"./index.5672de35.js";import"./Serializer.f6a5f515.js";import"./useFocusableGroup.6d334b5b.js";var C="_container_1642z_35",I="_bladeContentContainer_1642z_59",_="_bladeContentWrapper_1642z_75",N="_bladeContent_1642z_59",b="_partContent_1642z_107",w="_toolbar_1642z_125",U="_toolbarContainer_1642z_143",O="_toolbarButton_1642z_159",k="_overviewHr_1642z_387",z="_dockingBody_1642z_403",S="_loading_1642z_421",D="_noData_1642z_423",T="_editInput_1642z_751";const E=()=>{const{selectedDevice:E,treeData:B,selectDevice:H}=s(),[F,$]=t.exports.useState([]),[A,L]=t.exports.useState(!1),[G,K]=t.exports.useState(null),[R,W]=t.exports.useState(null),[M,P]=t.exports.useState(null),[J,Y]=t.exports.useState("");t.exports.useEffect((()=>{if(!E&&B.length>0){const e=t=>{for(const s of t){if(s.data)return s;if(s.children&&s.children.length>0){const t=e(s.children);if(t)return t}}return null},t=e(B);(null==t?void 0:t.data)&&H(t.data)}}),[E,B,H]);const q=t.exports.useCallback((async()=>{if(E){L(!0),K(null);try{const e=await fetch(`${n}/api/v1/devices/${E.serialNumber}/custom-units/refresh`);if(!e.ok)throw new Error(`Failed to fetch custom units: ${e.statusText}`);const t=await e.json();$(t.data||[])}catch(e){const t=e instanceof Error?e.message:"Failed to load custom units";K(t)}finally{L(!1)}}else $([])}),[E]);t.exports.useEffect((()=>{q()}),[q]);const Q=(e,t,s)=>{"unitId"!==t&&"unitIndex"!==t&&(P({rowIndex:e,columnId:t}),Y(String(s||"")))},V=e=>{Y(e.target.value)},X=async(e,t)=>{if(!E||!M)return;const s=F[e];let r=J;"direct"===t&&(r=parseInt(J)||0);const i={...s,[t]:r};try{const t=await fetch(`${n}/api/v1/devices/${E.serialNumber}/custom-units/${s.unitIndex}/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!t.ok)throw new Error(`Update failed: ${t.statusText}`);const r=[...F];r[e]=i,$(r),W(`Custom unit ${s.unitIndex} updated successfully`),setTimeout((()=>W(null)),3e3)}catch(l){const e=l instanceof Error?l.message:"Update failed";K(e),setTimeout((()=>K(null)),5e3)}finally{P(null)}},Z=()=>{P(null),Y("")},ee=t.exports.useMemo((()=>[p({columnId:"unitIndex",renderHeaderCell:()=>e.exports.jsx("span",{children:"Index"}),renderCell:t=>e.exports.jsx(y,{children:t.unitIndex})}),p({columnId:"unitType",renderHeaderCell:()=>e.exports.jsx("span",{children:"Type"}),renderCell:t=>{return e.exports.jsx(y,{children:e.exports.jsx(v,{appearance:"filled",color:(s=t.unitType||"ANALOG","DIGITAL"===s?"informative":"success"),children:t.unitType||"ANALOG"})});var s}}),p({columnId:"panel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Panel"}),renderCell:t=>e.exports.jsx(y,{children:t.panel||"-"})}),p({columnId:"direct",renderHeaderCell:()=>e.exports.jsx("span",{children:"Direct"}),renderCell:t=>{const s=F.indexOf(t),n=(null==M?void 0:M.rowIndex)===s&&"direct"===(null==M?void 0:M.columnId);return e.exports.jsx(y,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"number",className:T,value:J,onChange:V,onBlur:()=>X(s,"direct"),onKeyDown:e=>{"Enter"===e.key&&X(s,"direct"),"Escape"===e.key&&Z()},autoFocus:!0,min:0,max:1})}):e.exports.jsx("span",{onClick:()=>Q(s,"direct",t.direct||0),children:1===t.direct?"Yes":"No"})})}}),p({columnId:"digitalUnitsOff",renderHeaderCell:()=>e.exports.jsx("span",{children:"Digital OFF Text"}),renderCell:t=>{const s=F.indexOf(t),n=(null==M?void 0:M.rowIndex)===s&&"digitalUnitsOff"===(null==M?void 0:M.columnId);return e.exports.jsx(y,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:T,value:J,onChange:V,onBlur:()=>X(s,"digitalUnitsOff"),onKeyDown:e=>{"Enter"===e.key&&X(s,"digitalUnitsOff"),"Escape"===e.key&&Z()},autoFocus:!0,maxLength:12})}):e.exports.jsx("span",{onClick:()=>Q(s,"digitalUnitsOff",t.digitalUnitsOff),children:t.digitalUnitsOff||"-"})})}}),p({columnId:"digitalUnitsOn",renderHeaderCell:()=>e.exports.jsx("span",{children:"Digital ON Text"}),renderCell:t=>{const s=F.indexOf(t),n=(null==M?void 0:M.rowIndex)===s&&"digitalUnitsOn"===(null==M?void 0:M.columnId);return e.exports.jsx(y,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:T,value:J,onChange:V,onBlur:()=>X(s,"digitalUnitsOn"),onKeyDown:e=>{"Enter"===e.key&&X(s,"digitalUnitsOn"),"Escape"===e.key&&Z()},autoFocus:!0,maxLength:12})}):e.exports.jsx("span",{onClick:()=>Q(s,"digitalUnitsOn",t.digitalUnitsOn),children:t.digitalUnitsOn||"-"})})}}),p({columnId:"analogUnitName",renderHeaderCell:()=>e.exports.jsx("span",{children:"Analog Unit Name"}),renderCell:t=>{const s=F.indexOf(t),n=(null==M?void 0:M.rowIndex)===s&&"analogUnitName"===(null==M?void 0:M.columnId);return e.exports.jsx(y,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:T,value:J,onChange:V,onBlur:()=>X(s,"analogUnitName"),onKeyDown:e=>{"Enter"===e.key&&X(s,"analogUnitName"),"Escape"===e.key&&Z()},autoFocus:!0})}):e.exports.jsx("span",{onClick:()=>Q(s,"analogUnitName",t.analogUnitName),children:t.analogUnitName||"-"})})}}),p({columnId:"status",renderHeaderCell:()=>e.exports.jsx("span",{children:"Status"}),renderCell:t=>e.exports.jsx(y,{children:t.status||"-"})})]),[M,J]);return e.exports.jsx("div",{className:C,children:e.exports.jsx("div",{className:I,children:e.exports.jsx("div",{className:_,children:e.exports.jsx("div",{className:N,children:e.exports.jsxs("div",{className:b,children:[G&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(r,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(i,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:G})]}),R&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#f0f6ff",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(l,{style:{color:"#107c10",fontSize:"16px",flexShrink:0}}),e.exports.jsx(i,{style:{color:"#323130",fontWeight:500,fontSize:"13px"},children:R})]}),e.exports.jsx("div",{className:w,children:e.exports.jsxs("div",{className:U,children:[e.exports.jsx(o,{appearance:"subtle",icon:e.exports.jsx(a,{}),onClick:()=>{q()},disabled:A,className:O,children:"Refresh"}),E&&e.exports.jsx(d,{content:`Showing custom units for ${E.nameShowOnTree} (SN: ${E.serialNumber}). Define custom digital and analog unit labels for points.`,relationship:"description",children:e.exports.jsx("button",{className:O,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(c,{})})})]})}),e.exports.jsx("hr",{className:k}),e.exports.jsx("div",{className:z,children:A?e.exports.jsx("div",{className:S,children:e.exports.jsx(x,{size:"medium",label:"Loading custom units..."})}):0===F.length?e.exports.jsx("div",{className:D,children:e.exports.jsx(i,{children:"No custom units configured for this device."})}):e.exports.jsxs(u,{items:F,columns:ee,sortable:!0,resizableColumns:!0,focusMode:"composite",children:[e.exports.jsx(m,{children:e.exports.jsx(f,{children:({renderHeaderCell:t})=>e.exports.jsx(h,{children:t()})})}),e.exports.jsx(j,{children:({item:t,rowId:s})=>e.exports.jsx(f,{children:({renderCell:s})=>e.exports.jsx(g,{children:s(t)})},s)})]})})]})})})})})};export{E as CustomUnitsPage};

import{j as e}from"./react.8639cc86.js";import{r as s}from"./client.58f92968.js";import{F as t}from"./index.2cf43efd.js";import{M as r,aU as o,T as a,aP as n,aQ as i,Q as l,B as c,bk as x,cv as p,y as d,aH as m,cd as h,ce as u,b0 as j,K as f,cw as _,cu as v,cx as g,aK as y,z as b,Y as w,cy as N,cz as z,cA as S,cB as C,S as E,at as T,au as $,a0 as k,a1 as L,b4 as R,a4 as M}from"./App.7c34790a.js";import"./index.3bd6c859.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.63f93fe7.js";import"./_commonjsHelpers.a5007c1f.js";const P=`${r}/api/develop/database`;async function F(e){const s=await fetch(`${P}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const e=await s.json().catch((()=>({error:s.statusText})));throw new Error(e.error||"Query execution failed")}const t=await s.json();return{columns:t.columns,rows:t.rows,rowCount:t.rowCount,executionTimeMs:t.executionTimeMs}}var q="_container_f3gcv_2",I="_toolbar_f3gcv_11",O="_toolbarLeft_f3gcv_22",Q="_toolbarRight_f3gcv_28",H="_mainContent_f3gcv_35",D="_objectExplorer_f3gcv_42",A="_collapsed_f3gcv_54",B="_explorerContent_f3gcv_58",U="_propertiesPanel_f3gcv_59",W="_explorerHeader_f3gcv_63",K="_collapseButton_f3gcv_89",V="_treeNode_f3gcv_142",Y="_treeNodeHeader_f3gcv_146",G="_treeNodeChildren_f3gcv_169",J="_treeNodeItem_f3gcv_173",X="_selected_f3gcv_190",Z="_columnItem_f3gcv_202",ee="_itemCount_f3gcv_219",se="_rowCount_f3gcv_220",te="_columnType_f3gcv_227",re="_pkBadge_f3gcv_233",oe="_propertiesPanelHeader_f3gcv_251",ae="_propertiesPanelContent_f3gcv_261",ne="_propertyRow_f3gcv_271",ie="_horizontalResizeHandle_f3gcv_289",le="_queryArea_f3gcv_301",ce="_queryEditor_f3gcv_310",xe="_queryEditorHeader_f3gcv_320",pe="_queryEditorActions_f3gcv_332",de="_resultsPanel_f3gcv_404",me="_resultsTabs_f3gcv_412",he="_resultsTab_f3gcv_412",ue="_activeTab_f3gcv_438",je="_resultsContent_f3gcv_444",fe="_resultsTable_f3gcv_452",_e="_messagesContent_f3gcv_506",ve="_messageItem_f3gcv_511",ge="_resultsPlaceholder_f3gcv_516",ye="_statusBar_f3gcv_526",be="_statusLeft_f3gcv_538",we="_statusRight_f3gcv_539",Ne="_statusIndicator_f3gcv_545";const ze=()=>{var r,ze,Se;const[Ce,Ee]=s.exports.useState([]),[Te,$e]=s.exports.useState("webview_t3_device.db"),[ke,Le]=s.exports.useState([]),[Re,Me]=s.exports.useState(new Set),[Pe,Fe]=s.exports.useState(new Set(["Database","Tables"])),[qe,Ie]=s.exports.useState(null),[Oe,Qe]=s.exports.useState(""),[He,De]=s.exports.useState(null),[Ae,Be]=s.exports.useState([]),[Ue,We]=s.exports.useState(!1),[Ke,Ve]=s.exports.useState(null),[Ye,Ge]=s.exports.useState("results"),[Je,Xe]=s.exports.useState(280),[Ze,es]=s.exports.useState(200),[ss,ts]=s.exports.useState(!1),[rs,os]=s.exports.useState(!1),[as,ns]=s.exports.useState(!1),[is,ls]=s.exports.useState(null),[cs,xs]=s.exports.useState("asc");s.exports.useEffect((()=>{ps()}),[]),s.exports.useEffect((()=>{Te&&ds()}),[Te]),s.exports.useEffect((()=>{const e=e=>{if(!rs)return;const s=document.querySelector(`.${le}`);if(!s)return;const t=s.getBoundingClientRect(),r=e.clientY-t.top,o=.8*t.height;r>=100&&r<=o&&es(r)},s=()=>{os(!1)};return rs&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}}),[rs]);const ps=async()=>{try{const e=await async function(){const e=await fetch(`${P}/list`);if(!e.ok){const s=await e.json().catch((()=>({error:e.statusText})));throw new Error(s.error||"Failed to fetch databases")}return(await e.json()).databases}(),s=e.map((e=>e.name));Ee(s),s.length>0&&!Te&&$e(s[0])}catch(e){console.error("Failed to load databases:",e)}},ds=async()=>{try{We(!0);const e=await async function(e="T3000.db"){const s=await fetch(`${P}/tables?database=${encodeURIComponent(e)}`);if(!s.ok){const e=await s.json().catch((()=>({error:s.statusText})));throw new Error(e.error||"Failed to fetch tables")}return(await s.json()).tables.map((e=>({name:e.name,rowCount:e.row_count})))}(Te),s=await Promise.all(e.map((async e=>{try{const s=await async function(e,s="T3000.db"){var t;const r=(await F({database:s,query:`PRAGMA table_info("${e}")`})).rows.map((e=>({name:e[1],type:e[2],notnull:1===e[3],pk:1===e[5]})));return{name:e,rowCount:(null==(t=(await F({database:s,query:`SELECT COUNT(*) as count FROM "${e}"`})).rows[0])?void 0:t[0])||0,columns:r}}(e.name,Te);return s}catch(s){return console.error(`Failed to fetch schema for ${e.name}:`,s),e}})));if(Le(s),!Oe&&s.length>0){const e=s[0].name;Qe(`SELECT * FROM ${e} LIMIT 100;`),Ie(e)}}catch(e){console.error("Failed to load tables:",e),Ve(e instanceof Error?e.message:"Failed to load tables"),Be([`Error loading tables: ${e instanceof Error?e.message:"Unknown error"}`])}finally{We(!1)}},ms=e=>{Fe((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))},hs=e=>{Me((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))},us=e=>{is===e?"asc"===cs?xs("desc"):(ls(null),xs("asc")):(ls(e),xs("asc"))},js=e=>null===is?e:[...e].sort(((e,s)=>{const t=e[is],r=s[is];if(null==t)return 1;if(null==r)return-1;let o=0;return o="number"==typeof t&&"number"==typeof r?t-r:String(t).localeCompare(String(r)),"asc"===cs?o:-o}));return e.exports.jsxs("div",{className:q,children:[e.exports.jsxs("div",{className:I,children:[e.exports.jsxs("div",{className:O,children:[e.exports.jsx(o,{style:{fontSize:"16px",color:"#0078d4"}}),e.exports.jsx(a,{size:300,weight:"semibold",children:"Database"}),e.exports.jsxs(a,{size:200,style:{color:"#605e5c",marginLeft:"4px"},children:["(",Ce.length,")"]}),e.exports.jsx(n,{value:Te,selectedOptions:[Te],onOptionSelect:(e,s)=>$e(s.optionValue),size:"small",style:{minWidth:"200px",marginLeft:"8px"},children:Ce.map((s=>e.exports.jsx(i,{value:s,children:s},s)))})]}),e.exports.jsxs("div",{className:Q,children:[e.exports.jsx(l,{content:"New Query",relationship:"label",children:e.exports.jsx(c,{appearance:"subtle",icon:e.exports.jsx(x,{style:{fontSize:"14px"}}),size:"small",onClick:()=>{Qe(""),De(null),Be([]),Ie(null),Ge("results")},children:"New Query"})}),e.exports.jsx(l,{content:"Execute (F5)",relationship:"label",children:e.exports.jsx(c,{appearance:"primary",icon:e.exports.jsx(p,{style:{fontSize:"14px"}}),onClick:async()=>{if(!Oe.trim())return Be(["Please enter a query"]),void Ge("messages");We(!0),Ve(null),Be([]);try{const e=await F({database:Te,query:Oe});De(e),Be(["Query executed successfully",`Rows: ${e.rowCount}`,`Execution time: ${e.executionTimeMs.toFixed(2)}ms`]),Ge("results")}catch(e){const s=e instanceof Error?e.message:"Query execution failed";Ve(s),Be([`Error: ${s}`]),Ge("messages")}finally{We(!1)}},disabled:Ue,size:"small",children:"Execute"})}),e.exports.jsx(l,{content:"Refresh",relationship:"label",children:e.exports.jsx(c,{appearance:"subtle",icon:e.exports.jsx(d,{style:{fontSize:"14px"}}),onClick:ds,size:"small",children:"Refresh"})})]})]}),e.exports.jsxs("div",{className:H,children:[e.exports.jsxs("div",{className:`${D} ${ss?A:""}`,style:{width:ss?"40px":`${Je}px`},children:[e.exports.jsxs("div",{className:W,children:[!ss&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx(m,{style:{fontSize:"16px"}}),e.exports.jsx(a,{size:300,weight:"semibold",children:"Object Explorer"})]}),e.exports.jsx("button",{className:K,onClick:()=>ts(!ss),title:ss?"Expand Object Explorer":"Collapse Object Explorer",children:ss?e.exports.jsx(h,{}):e.exports.jsx(u,{})})]}),!ss&&e.exports.jsx("div",{className:B,children:e.exports.jsxs("div",{className:V,children:[e.exports.jsxs("div",{className:Y,onClick:()=>ms("Database"),children:[Pe.has("Database")?e.exports.jsx(j,{}):e.exports.jsx(f,{}),e.exports.jsx(o,{style:{fontSize:"14px",color:"#0078d4"}}),e.exports.jsx(a,{size:200,weight:"semibold",children:Te})]}),Pe.has("Database")&&e.exports.jsxs("div",{className:G,children:[e.exports.jsxs("div",{className:V,children:[e.exports.jsxs("div",{className:Y,onClick:()=>ms("Tables"),children:[Pe.has("Tables")?e.exports.jsx(j,{}):e.exports.jsx(f,{}),e.exports.jsx(_,{style:{fontSize:"14px"}}),e.exports.jsx(a,{size:200,weight:"semibold",children:"Tables"}),e.exports.jsxs(a,{size:100,className:ee,children:["(",ke.length,")"]})]}),Pe.has("Tables")&&e.exports.jsx("div",{className:G,children:ke.map((s=>e.exports.jsxs("div",{className:V,children:[e.exports.jsxs("div",{className:`${J} ${qe===s.name?X:""}`,onClick:()=>{return e=s.name,Ie(e),void Qe(`SELECT * FROM ${e} LIMIT 100;`);var e},onDoubleClick:()=>hs(s.name),children:[s.columns&&e.exports.jsx("span",{onClick:e=>{e.stopPropagation(),hs(s.name)},children:Re.has(s.name)?e.exports.jsx(j,{}):e.exports.jsx(f,{})}),e.exports.jsx(_,{style:{fontSize:"12px",color:"#605e5c"}}),e.exports.jsx(a,{size:200,children:s.name}),void 0!==s.rowCount&&e.exports.jsxs(a,{size:100,className:se,children:["(",s.rowCount,")"]})]}),Re.has(s.name)&&s.columns&&e.exports.jsx("div",{className:G,children:s.columns.map((s=>e.exports.jsxs("div",{className:Z,children:[e.exports.jsx(v,{style:{fontSize:"10px",color:"#a19f9d"}}),e.exports.jsx(a,{size:100,children:s.name}),e.exports.jsxs(a,{size:100,className:te,children:["(",s.type,")"]}),s.pk&&e.exports.jsx(a,{size:100,className:re,children:"PK"})]},s.name)))})]},s.name)))})]}),e.exports.jsx("div",{className:V,children:e.exports.jsxs("div",{className:Y,children:[e.exports.jsx(f,{}),e.exports.jsx(g,{style:{fontSize:"14px"}}),e.exports.jsx(a,{size:200,children:"Views"}),e.exports.jsx(a,{size:100,className:ee,children:"(0)"})]})}),e.exports.jsx("div",{className:V,children:e.exports.jsxs("div",{className:Y,children:[e.exports.jsx(f,{}),e.exports.jsx(y,{style:{fontSize:"14px"}}),e.exports.jsx(a,{size:200,children:"Programmability"})]})}),e.exports.jsx("div",{className:V,children:e.exports.jsxs("div",{className:Y,children:[e.exports.jsx(f,{}),e.exports.jsx(b,{style:{fontSize:"14px"}}),e.exports.jsx(a,{size:200,children:"Security"})]})})]})]})}),!ss&&qe&&e.exports.jsxs("div",{className:U,children:[e.exports.jsx("div",{className:oe,children:e.exports.jsx(a,{size:200,weight:"semibold",children:"Properties"})}),e.exports.jsxs("div",{className:ae,children:[e.exports.jsxs("div",{className:ne,children:[e.exports.jsx(a,{size:100,children:"Table:"}),e.exports.jsx(a,{size:100,weight:"semibold",children:qe})]}),e.exports.jsxs("div",{className:ne,children:[e.exports.jsx(a,{size:100,children:"Rows:"}),e.exports.jsx(a,{size:100,children:(null==(r=ke.find((e=>e.name===qe)))?void 0:r.rowCount)||"N/A"})]}),e.exports.jsxs("div",{className:ne,children:[e.exports.jsx(a,{size:100,children:"Columns:"}),e.exports.jsx(a,{size:100,children:(null==(Se=null==(ze=ke.find((e=>e.name===qe)))?void 0:ze.columns)?void 0:Se.length)||"N/A"})]})]})]})]}),e.exports.jsxs("div",{className:le,children:[e.exports.jsxs("div",{className:ce,style:{height:`${Ze}px`},children:[e.exports.jsxs("div",{className:xe,children:[e.exports.jsx(a,{size:200,weight:"semibold",children:"Query Editor"}),e.exports.jsx("div",{className:pe,children:e.exports.jsx(l,{content:"Save Query",relationship:"label",children:e.exports.jsx(c,{appearance:"subtle",icon:e.exports.jsx(w,{}),size:"small"})})})]}),e.exports.jsx(t,{height:"100%",defaultLanguage:"sql",value:Oe,onChange:e=>Qe(e||""),theme:"vs",options:{minimap:{enabled:!1},fontSize:11,lineHeight:18,fontFamily:'Consolas, "Courier New", monospace',scrollBeyondLastLine:!1,automaticLayout:!0,wordWrap:"on",wrappingIndent:"same",lineNumbers:"on",glyphMargin:!1,folding:!1,lineDecorationsWidth:10,lineNumbersMinChars:3,renderLineHighlight:"all",scrollbar:{vertical:"visible",horizontal:"hidden",verticalScrollbarSize:6,horizontalScrollbarSize:6}}})]}),e.exports.jsx("div",{className:ie,onMouseDown:()=>os(!0),style:{cursor:"row-resize"}}),e.exports.jsxs("div",{className:de,children:[e.exports.jsxs("div",{className:me,children:[e.exports.jsxs("button",{className:`${he} ${"results"===Ye?ue:""}`,onClick:()=>Ge("results"),children:[e.exports.jsx(N,{style:{fontSize:"14px",marginRight:"6px"}}),"Results"]}),e.exports.jsxs("button",{className:`${he} ${"messages"===Ye?ue:""}`,onClick:()=>Ge("messages"),children:[e.exports.jsx(z,{style:{fontSize:"14px",marginRight:"6px"}}),"Messages"]}),e.exports.jsxs("button",{className:`${he} ${"execution-plan"===Ye?ue:""}`,onClick:()=>Ge("execution-plan"),children:[e.exports.jsx(S,{style:{fontSize:"14px",marginRight:"6px"}}),"Execution Plan"]}),He&&"results"===Ye&&e.exports.jsx(l,{content:"View in Larger Panel",relationship:"label",children:e.exports.jsx("button",{className:he,onClick:()=>ns(!0),style:{marginLeft:"auto"},children:e.exports.jsx(C,{style:{fontSize:"10px"}})})})]}),e.exports.jsxs("div",{className:je,children:[Ue&&e.exports.jsx("div",{className:ge,children:e.exports.jsx(E,{size:"small",label:"Executing query..."})}),!Ue&&"results"===Ye&&He&&e.exports.jsx("div",{className:fe,children:e.exports.jsxs("table",{children:[e.exports.jsx("thead",{children:e.exports.jsx("tr",{children:He.columns.map(((s,t)=>e.exports.jsx("th",{onClick:()=>us(t),style:{cursor:"pointer",userSelect:"none"},children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s,is===t?"asc"===cs?e.exports.jsx(T,{style:{fontSize:"10px"}}):e.exports.jsx($,{style:{fontSize:"10px"}}):e.exports.jsx(T,{style:{fontSize:"10px",opacity:.3}})]})},s)))})}),e.exports.jsx("tbody",{children:js(He.rows).map(((s,t)=>e.exports.jsx("tr",{children:s.map(((s,t)=>e.exports.jsx("td",{children:String(s)},t)))},t)))})]})}),!Ue&&"messages"===Ye&&e.exports.jsx(e.exports.Fragment,{children:Ae.length>0?e.exports.jsx("div",{className:_e,children:Ae.map(((s,t)=>e.exports.jsx("div",{className:ve,children:e.exports.jsx(a,{size:200,family:"monospace",children:s})},t)))}):e.exports.jsx("div",{className:ge,children:e.exports.jsx(a,{size:200,children:"No messages"})})}),!Ue&&"execution-plan"===Ye&&e.exports.jsx("div",{className:ge,children:e.exports.jsx(a,{size:200,children:"Execution plan not available for this query"})}),!Ue&&!He&&"results"===Ye&&e.exports.jsx("div",{className:ge,children:e.exports.jsx(a,{size:200,children:"Execute a query to see results"})})]})]}),e.exports.jsxs("div",{className:ye,children:[e.exports.jsxs("div",{className:be,children:[e.exports.jsx("span",{className:Ne,children:"ðŸŸ¢"}),e.exports.jsxs(a,{size:200,children:["Connected: ",Te," â€¢ SQLite 3.x â€¢ Ready"]})]}),e.exports.jsx("div",{className:we,children:He&&e.exports.jsxs(a,{size:200,children:["Query executed successfully â€¢ ",He.rowCount," rows â€¢ ",He.executionTimeMs,"ms"]})})]})]})]}),e.exports.jsxs(k,{open:as,onOpenChange:(e,{open:s})=>ns(s),position:"end",size:"large",style:{width:"90vw",maxWidth:"2000px"},children:[e.exports.jsx(L,{style:{minHeight:"32px",padding:"8px 16px"},children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(N,{style:{fontSize:"16px",color:"#0078d4"}}),e.exports.jsx(a,{size:400,weight:"semibold",children:"Query Results"}),He&&e.exports.jsxs(a,{size:200,style:{color:"#605e5c"},children:[He.rowCount," rows â€¢ ",He.executionTimeMs,"ms"]})]}),e.exports.jsx(c,{appearance:"subtle",icon:e.exports.jsx(R,{}),onClick:()=>ns(!1),size:"small"})]})}),e.exports.jsx(M,{style:{padding:0},children:He&&e.exports.jsx("div",{className:fe,style:{height:"100%"},children:e.exports.jsxs("table",{children:[e.exports.jsx("thead",{children:e.exports.jsx("tr",{children:He.columns.map(((s,t)=>e.exports.jsx("th",{onClick:()=>us(t),style:{cursor:"pointer",userSelect:"none"},children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s,is===t?"asc"===cs?e.exports.jsx(T,{style:{fontSize:"10px"}}):e.exports.jsx($,{style:{fontSize:"10px"}}):e.exports.jsx(T,{style:{fontSize:"10px",opacity:.3}})]})},s)))})}),e.exports.jsx("tbody",{children:js(He.rows).map(((s,t)=>e.exports.jsx("tr",{children:s.map(((s,t)=>e.exports.jsx("td",{children:String(s)},t)))},t)))})]})})})]})]})};export{ze as DatabaseViewerPage,ze as default};

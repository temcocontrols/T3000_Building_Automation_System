import{j as e}from"./react.1acd1a13.js";import{r as s}from"./client.58f92968.js";import{F as t}from"./index.2cf43efd.js";import{aU as r,T as o,aP as a,aQ as n,Q as i,B as l,br as c,cA as x,y as p,aH as d,cj as m,ck as h,b0 as u,K as j,cB as f,cz as _,cC as v,aK as g,z as y,Y as b,cD as w,cE as N,cF as z,cG as S,S as C,at as E,au as T,a0 as $,a1 as k,b4 as L,a4 as R}from"./App.3fe38e41.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";const P="http://localhost:9103/api/develop/database";async function M(e){const s=await fetch(`${P}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const e=await s.json().catch((()=>({error:s.statusText})));throw new Error(e.error||"Query execution failed")}const t=await s.json();return{columns:t.columns,rows:t.rows,rowCount:t.rowCount,executionTimeMs:t.executionTimeMs}}var q="_container_f3gcv_2",I="_toolbar_f3gcv_11",F="_toolbarLeft_f3gcv_22",O="_toolbarRight_f3gcv_28",Q="_mainContent_f3gcv_35",D="_objectExplorer_f3gcv_42",H="_collapsed_f3gcv_54",A="_explorerContent_f3gcv_58",B="_propertiesPanel_f3gcv_59",U="_explorerHeader_f3gcv_63",W="_collapseButton_f3gcv_89",K="_treeNode_f3gcv_142",V="_treeNodeHeader_f3gcv_146",G="_treeNodeChildren_f3gcv_169",Y="_treeNodeItem_f3gcv_173",J="_selected_f3gcv_190",X="_columnItem_f3gcv_202",Z="_itemCount_f3gcv_219",ee="_rowCount_f3gcv_220",se="_columnType_f3gcv_227",te="_pkBadge_f3gcv_233",re="_propertiesPanelHeader_f3gcv_251",oe="_propertiesPanelContent_f3gcv_261",ae="_propertyRow_f3gcv_271",ne="_horizontalResizeHandle_f3gcv_289",ie="_queryArea_f3gcv_301",le="_queryEditor_f3gcv_310",ce="_queryEditorHeader_f3gcv_320",xe="_queryEditorActions_f3gcv_332",pe="_resultsPanel_f3gcv_404",de="_resultsTabs_f3gcv_412",me="_resultsTab_f3gcv_412",he="_activeTab_f3gcv_438",ue="_resultsContent_f3gcv_444",je="_resultsTable_f3gcv_452",fe="_messagesContent_f3gcv_506",_e="_messageItem_f3gcv_511",ve="_resultsPlaceholder_f3gcv_516",ge="_statusBar_f3gcv_526",ye="_statusLeft_f3gcv_538",be="_statusRight_f3gcv_539",we="_statusIndicator_f3gcv_545";const Ne=()=>{var Ne,ze,Se;const[Ce,Ee]=s.exports.useState([]),[Te,$e]=s.exports.useState("webview_t3_device.db"),[ke,Le]=s.exports.useState([]),[Re,Pe]=s.exports.useState(new Set),[Me,qe]=s.exports.useState(new Set(["Database","Tables"])),[Ie,Fe]=s.exports.useState(null),[Oe,Qe]=s.exports.useState(""),[De,He]=s.exports.useState(null),[Ae,Be]=s.exports.useState([]),[Ue,We]=s.exports.useState(!1),[Ke,Ve]=s.exports.useState(null),[Ge,Ye]=s.exports.useState("results"),[Je,Xe]=s.exports.useState(280),[Ze,es]=s.exports.useState(200),[ss,ts]=s.exports.useState(!1),[rs,os]=s.exports.useState(!1),[as,ns]=s.exports.useState(!1),[is,ls]=s.exports.useState(null),[cs,xs]=s.exports.useState("asc");s.exports.useEffect((()=>{ps()}),[]),s.exports.useEffect((()=>{Te&&ds()}),[Te]),s.exports.useEffect((()=>{const e=e=>{if(!rs)return;const s=document.querySelector(`.${ie}`);if(!s)return;const t=s.getBoundingClientRect(),r=e.clientY-t.top,o=.8*t.height;r>=100&&r<=o&&es(r)},s=()=>{os(!1)};return rs&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}}),[rs]);const ps=async()=>{try{const e=await async function(){const e=await fetch(`${P}/list`);if(!e.ok){const s=await e.json().catch((()=>({error:e.statusText})));throw new Error(s.error||"Failed to fetch databases")}return(await e.json()).databases}(),s=e.map((e=>e.name));Ee(s),s.length>0&&!Te&&$e(s[0])}catch(e){}},ds=async()=>{try{We(!0);const e=await async function(e="T3000.db"){const s=await fetch(`${P}/tables?database=${encodeURIComponent(e)}`);if(!s.ok){const e=await s.json().catch((()=>({error:s.statusText})));throw new Error(e.error||"Failed to fetch tables")}return(await s.json()).tables.map((e=>({name:e.name,rowCount:e.row_count})))}(Te),s=await Promise.all(e.map((async e=>{try{const s=await async function(e,s="T3000.db"){var t;const r=(await M({database:s,query:`PRAGMA table_info("${e}")`})).rows.map((e=>({name:e[1],type:e[2],notnull:1===e[3],pk:1===e[5]})));return{name:e,rowCount:(null==(t=(await M({database:s,query:`SELECT COUNT(*) as count FROM "${e}"`})).rows[0])?void 0:t[0])||0,columns:r}}(e.name,Te);return s}catch(s){return e}})));if(Le(s),!Oe&&s.length>0){const e=s[0].name;Qe(`SELECT * FROM ${e} LIMIT 100;`),Fe(e)}}catch(e){Ve(e instanceof Error?e.message:"Failed to load tables"),Be([`Error loading tables: ${e instanceof Error?e.message:"Unknown error"}`])}finally{We(!1)}},ms=e=>{qe((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))},hs=e=>{Pe((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))},us=e=>{is===e?"asc"===cs?xs("desc"):(ls(null),xs("asc")):(ls(e),xs("asc"))},js=e=>null===is?e:[...e].sort(((e,s)=>{const t=e[is],r=s[is];if(null==t)return 1;if(null==r)return-1;let o=0;return o="number"==typeof t&&"number"==typeof r?t-r:String(t).localeCompare(String(r)),"asc"===cs?o:-o}));return e.exports.jsxs("div",{className:q,children:[e.exports.jsxs("div",{className:I,children:[e.exports.jsxs("div",{className:F,children:[e.exports.jsx(r,{style:{fontSize:"16px",color:"#0078d4"}}),e.exports.jsx(o,{size:300,weight:"semibold",children:"Database"}),e.exports.jsxs(o,{size:200,style:{color:"#605e5c",marginLeft:"4px"},children:["(",Ce.length,")"]}),e.exports.jsx(a,{value:Te,selectedOptions:[Te],onOptionSelect:(e,s)=>$e(s.optionValue),size:"small",style:{minWidth:"200px",marginLeft:"8px"},children:Ce.map((s=>e.exports.jsx(n,{value:s,children:s},s)))})]}),e.exports.jsxs("div",{className:O,children:[e.exports.jsx(i,{content:"New Query",relationship:"label",children:e.exports.jsx(l,{appearance:"subtle",icon:e.exports.jsx(c,{style:{fontSize:"14px"}}),size:"small",onClick:()=>{Qe(""),He(null),Be([]),Fe(null),Ye("results")},children:"New Query"})}),e.exports.jsx(i,{content:"Execute (F5)",relationship:"label",children:e.exports.jsx(l,{appearance:"primary",icon:e.exports.jsx(x,{style:{fontSize:"14px"}}),onClick:async()=>{if(!Oe.trim())return Be(["Please enter a query"]),void Ye("messages");We(!0),Ve(null),Be([]);try{const e=await M({database:Te,query:Oe});He(e),Be(["Query executed successfully",`Rows: ${e.rowCount}`,`Execution time: ${e.executionTimeMs.toFixed(2)}ms`]),Ye("results")}catch(e){const s=e instanceof Error?e.message:"Query execution failed";Ve(s),Be([`Error: ${s}`]),Ye("messages")}finally{We(!1)}},disabled:Ue,size:"small",children:"Execute"})}),e.exports.jsx(i,{content:"Refresh",relationship:"label",children:e.exports.jsx(l,{appearance:"subtle",icon:e.exports.jsx(p,{style:{fontSize:"14px"}}),onClick:ds,size:"small",children:"Refresh"})})]})]}),e.exports.jsxs("div",{className:Q,children:[e.exports.jsxs("div",{className:`${D} ${ss?H:""}`,style:{width:ss?"40px":`${Je}px`},children:[e.exports.jsxs("div",{className:U,children:[!ss&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx(d,{style:{fontSize:"16px"}}),e.exports.jsx(o,{size:300,weight:"semibold",children:"Object Explorer"})]}),e.exports.jsx("button",{className:W,onClick:()=>ts(!ss),title:ss?"Expand Object Explorer":"Collapse Object Explorer",children:ss?e.exports.jsx(m,{}):e.exports.jsx(h,{})})]}),!ss&&e.exports.jsx("div",{className:A,children:e.exports.jsxs("div",{className:K,children:[e.exports.jsxs("div",{className:V,onClick:()=>ms("Database"),children:[Me.has("Database")?e.exports.jsx(u,{}):e.exports.jsx(j,{}),e.exports.jsx(r,{style:{fontSize:"14px",color:"#0078d4"}}),e.exports.jsx(o,{size:200,weight:"semibold",children:Te})]}),Me.has("Database")&&e.exports.jsxs("div",{className:G,children:[e.exports.jsxs("div",{className:K,children:[e.exports.jsxs("div",{className:V,onClick:()=>ms("Tables"),children:[Me.has("Tables")?e.exports.jsx(u,{}):e.exports.jsx(j,{}),e.exports.jsx(f,{style:{fontSize:"14px"}}),e.exports.jsx(o,{size:200,weight:"semibold",children:"Tables"}),e.exports.jsxs(o,{size:100,className:Z,children:["(",ke.length,")"]})]}),Me.has("Tables")&&e.exports.jsx("div",{className:G,children:ke.map((s=>e.exports.jsxs("div",{className:K,children:[e.exports.jsxs("div",{className:`${Y} ${Ie===s.name?J:""}`,onClick:()=>{return e=s.name,Fe(e),void Qe(`SELECT * FROM ${e} LIMIT 100;`);var e},onDoubleClick:()=>hs(s.name),children:[s.columns&&e.exports.jsx("span",{onClick:e=>{e.stopPropagation(),hs(s.name)},children:Re.has(s.name)?e.exports.jsx(u,{}):e.exports.jsx(j,{})}),e.exports.jsx(f,{style:{fontSize:"12px",color:"#605e5c"}}),e.exports.jsx(o,{size:200,children:s.name}),void 0!==s.rowCount&&e.exports.jsxs(o,{size:100,className:ee,children:["(",s.rowCount,")"]})]}),Re.has(s.name)&&s.columns&&e.exports.jsx("div",{className:G,children:s.columns.map((s=>e.exports.jsxs("div",{className:X,children:[e.exports.jsx(_,{style:{fontSize:"10px",color:"#a19f9d"}}),e.exports.jsx(o,{size:100,children:s.name}),e.exports.jsxs(o,{size:100,className:se,children:["(",s.type,")"]}),s.pk&&e.exports.jsx(o,{size:100,className:te,children:"PK"})]},s.name)))})]},s.name)))})]}),e.exports.jsx("div",{className:K,children:e.exports.jsxs("div",{className:V,children:[e.exports.jsx(j,{}),e.exports.jsx(v,{style:{fontSize:"14px"}}),e.exports.jsx(o,{size:200,children:"Views"}),e.exports.jsx(o,{size:100,className:Z,children:"(0)"})]})}),e.exports.jsx("div",{className:K,children:e.exports.jsxs("div",{className:V,children:[e.exports.jsx(j,{}),e.exports.jsx(g,{style:{fontSize:"14px"}}),e.exports.jsx(o,{size:200,children:"Programmability"})]})}),e.exports.jsx("div",{className:K,children:e.exports.jsxs("div",{className:V,children:[e.exports.jsx(j,{}),e.exports.jsx(y,{style:{fontSize:"14px"}}),e.exports.jsx(o,{size:200,children:"Security"})]})})]})]})}),!ss&&Ie&&e.exports.jsxs("div",{className:B,children:[e.exports.jsx("div",{className:re,children:e.exports.jsx(o,{size:200,weight:"semibold",children:"Properties"})}),e.exports.jsxs("div",{className:oe,children:[e.exports.jsxs("div",{className:ae,children:[e.exports.jsx(o,{size:100,children:"Table:"}),e.exports.jsx(o,{size:100,weight:"semibold",children:Ie})]}),e.exports.jsxs("div",{className:ae,children:[e.exports.jsx(o,{size:100,children:"Rows:"}),e.exports.jsx(o,{size:100,children:(null==(Ne=ke.find((e=>e.name===Ie)))?void 0:Ne.rowCount)||"N/A"})]}),e.exports.jsxs("div",{className:ae,children:[e.exports.jsx(o,{size:100,children:"Columns:"}),e.exports.jsx(o,{size:100,children:(null==(Se=null==(ze=ke.find((e=>e.name===Ie)))?void 0:ze.columns)?void 0:Se.length)||"N/A"})]})]})]})]}),e.exports.jsxs("div",{className:ie,children:[e.exports.jsxs("div",{className:le,style:{height:`${Ze}px`},children:[e.exports.jsxs("div",{className:ce,children:[e.exports.jsx(o,{size:200,weight:"semibold",children:"Query Editor"}),e.exports.jsx("div",{className:xe,children:e.exports.jsx(i,{content:"Save Query",relationship:"label",children:e.exports.jsx(l,{appearance:"subtle",icon:e.exports.jsx(b,{}),size:"small"})})})]}),e.exports.jsx(t,{height:"100%",defaultLanguage:"sql",value:Oe,onChange:e=>Qe(e||""),theme:"vs",options:{minimap:{enabled:!1},fontSize:11,lineHeight:18,fontFamily:'Consolas, "Courier New", monospace',scrollBeyondLastLine:!1,automaticLayout:!0,wordWrap:"on",wrappingIndent:"same",lineNumbers:"on",glyphMargin:!1,folding:!1,lineDecorationsWidth:10,lineNumbersMinChars:3,renderLineHighlight:"all",scrollbar:{vertical:"visible",horizontal:"hidden",verticalScrollbarSize:6,horizontalScrollbarSize:6}}})]}),e.exports.jsx("div",{className:ne,onMouseDown:()=>os(!0),style:{cursor:"row-resize"}}),e.exports.jsxs("div",{className:pe,children:[e.exports.jsxs("div",{className:de,children:[e.exports.jsxs("button",{className:`${me} ${"results"===Ge?he:""}`,onClick:()=>Ye("results"),children:[e.exports.jsx(w,{style:{fontSize:"14px",marginRight:"6px"}}),"Results"]}),e.exports.jsxs("button",{className:`${me} ${"messages"===Ge?he:""}`,onClick:()=>Ye("messages"),children:[e.exports.jsx(N,{style:{fontSize:"14px",marginRight:"6px"}}),"Messages"]}),e.exports.jsxs("button",{className:`${me} ${"execution-plan"===Ge?he:""}`,onClick:()=>Ye("execution-plan"),children:[e.exports.jsx(z,{style:{fontSize:"14px",marginRight:"6px"}}),"Execution Plan"]}),De&&"results"===Ge&&e.exports.jsx(i,{content:"View in Larger Panel",relationship:"label",children:e.exports.jsx("button",{className:me,onClick:()=>ns(!0),style:{marginLeft:"auto"},children:e.exports.jsx(S,{style:{fontSize:"10px"}})})})]}),e.exports.jsxs("div",{className:ue,children:[Ue&&e.exports.jsx("div",{className:ve,children:e.exports.jsx(C,{size:"small",label:"Executing query..."})}),!Ue&&"results"===Ge&&De&&e.exports.jsx("div",{className:je,children:e.exports.jsxs("table",{children:[e.exports.jsx("thead",{children:e.exports.jsx("tr",{children:De.columns.map(((s,t)=>e.exports.jsx("th",{onClick:()=>us(t),style:{cursor:"pointer",userSelect:"none"},children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s,is===t?"asc"===cs?e.exports.jsx(E,{style:{fontSize:"10px"}}):e.exports.jsx(T,{style:{fontSize:"10px"}}):e.exports.jsx(E,{style:{fontSize:"10px",opacity:.3}})]})},s)))})}),e.exports.jsx("tbody",{children:js(De.rows).map(((s,t)=>e.exports.jsx("tr",{children:s.map(((s,t)=>e.exports.jsx("td",{children:String(s)},t)))},t)))})]})}),!Ue&&"messages"===Ge&&e.exports.jsx(e.exports.Fragment,{children:Ae.length>0?e.exports.jsx("div",{className:fe,children:Ae.map(((s,t)=>e.exports.jsx("div",{className:_e,children:e.exports.jsx(o,{size:200,family:"monospace",children:s})},t)))}):e.exports.jsx("div",{className:ve,children:e.exports.jsx(o,{size:200,children:"No messages"})})}),!Ue&&"execution-plan"===Ge&&e.exports.jsx("div",{className:ve,children:e.exports.jsx(o,{size:200,children:"Execution plan not available for this query"})}),!Ue&&!De&&"results"===Ge&&e.exports.jsx("div",{className:ve,children:e.exports.jsx(o,{size:200,children:"Execute a query to see results"})})]})]}),e.exports.jsxs("div",{className:ge,children:[e.exports.jsxs("div",{className:ye,children:[e.exports.jsx("span",{className:we,children:"ðŸŸ¢"}),e.exports.jsxs(o,{size:200,children:["Connected: ",Te," â€¢ SQLite 3.x â€¢ Ready"]})]}),e.exports.jsx("div",{className:be,children:De&&e.exports.jsxs(o,{size:200,children:["Query executed successfully â€¢ ",De.rowCount," rows â€¢ ",De.executionTimeMs,"ms"]})})]})]})]}),e.exports.jsxs($,{open:as,onOpenChange:(e,{open:s})=>ns(s),position:"end",size:"large",style:{width:"90vw",maxWidth:"2000px"},children:[e.exports.jsx(k,{style:{minHeight:"32px",padding:"8px 16px"},children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(w,{style:{fontSize:"16px",color:"#0078d4"}}),e.exports.jsx(o,{size:400,weight:"semibold",children:"Query Results"}),De&&e.exports.jsxs(o,{size:200,style:{color:"#605e5c"},children:[De.rowCount," rows â€¢ ",De.executionTimeMs,"ms"]})]}),e.exports.jsx(l,{appearance:"subtle",icon:e.exports.jsx(L,{}),onClick:()=>ns(!1),size:"small"})]})}),e.exports.jsx(R,{style:{padding:0},children:De&&e.exports.jsx("div",{className:je,style:{height:"100%"},children:e.exports.jsxs("table",{children:[e.exports.jsx("thead",{children:e.exports.jsx("tr",{children:De.columns.map(((s,t)=>e.exports.jsx("th",{onClick:()=>us(t),style:{cursor:"pointer",userSelect:"none"},children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s,is===t?"asc"===cs?e.exports.jsx(E,{style:{fontSize:"10px"}}):e.exports.jsx(T,{style:{fontSize:"10px"}}):e.exports.jsx(E,{style:{fontSize:"10px",opacity:.3}})]})},s)))})}),e.exports.jsx("tbody",{children:js(De.rows).map(((s,t)=>e.exports.jsx("tr",{children:s.map(((s,t)=>e.exports.jsx("td",{children:String(s)},t)))},t)))})]})})})]})]})};export{Ne as DatabaseViewerPage,Ne as default};

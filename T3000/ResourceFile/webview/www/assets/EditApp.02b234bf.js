import{a0 as k,a1 as R,y as u,m as B,o as F,c as I,w as Q,W as p,a as s,ad as y,X as h}from"./index.a446fa3f.js";import{Q as D}from"./QPage.be1b2b29.js";import{u as N,l as b,k as j}from"./api.1a67fc33.js";import{F as C}from"./FileUploadS3.1ad5eb74.js";import{b as _,c as E}from"./common.a643a366.js";import{u as d}from"./T3Data.b51b73fb.js";import"./plugin-vue_export-helper.21dcd24c.js";const P={class:"flex flex-col w-full max-w-7xl"},S={class:"flex items-center"},q={class:"image-container relative w-52"},L={class:"flex grid-cols-4 gap-4"},J={__name:"EditApp",setup(M){const i=N(),c=k(),m=R(),l=u({});let r=!1;const o=u(!0),n=u(null),x={}.API_URL+"/file/";B(()=>{_.value.title="Edit Application",_.value.back="/apps-library",b.get("t3Apps/"+m.params.id).then(async a=>{var t;const e=await a.json();o.value=!1,!E(d.value)&&d.value.id!==e.userId&&(c.push({path:"/apps-library"}),i.notify({type:"negative",message:"Permission denied!"})),l.value={name:e.name,description:e.description},e.image&&(o.value=!0,j.get(x+((t=e.image)==null?void 0:t.path)).then(async V=>{var g;const v=await V.blob();r=!0,(g=n.value)==null||g.uppy.addFile({id:e.image.id,name:e.image.name,type:v.type,data:v})}).finally(()=>{o.value=!1}))}).catch(a=>{i.notify({type:"negative",message:a.message}),console.error(a)})});function A(a){const e=a.body;l.value.imageId=e.id,f()}function w(){l.value.imageId=null,r=!1}async function U(){var a,e;if(!!d.value){if(((e=(a=n.value)==null?void 0:a.uppy.getFiles())==null?void 0:e.length)>0&&!r){n.value.upload();return}f()}}function f(){b.patch("t3Apps/"+m.params.id,{json:l.value}).then(async()=>{c.push({path:"/user/apps"}),i.notify({type:"positive",message:"Application updated"})}).catch(a=>{console.error(a),i.notify({type:"negative",message:"Application not updated! "+a.message})})}return(a,e)=>(F(),I(D,{class:"flex justify-center p-4"},{default:Q(()=>[p("div",P,[p("div",S,[p("div",q,[s(C,{ref_key:"fileUploaderRef",ref:n,path:"app-images",types:["image/*"],height:150,onUploaded:A,onFileRemoved:w},null,512)]),s(y,{class:"grow px-4",modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),label:"Name"},null,8,["modelValue"])]),s(y,{class:"py-2",modelValue:l.value.description,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.description=t),label:"Description",type:"textarea",autogrow:""},null,8,["modelValue"]),p("div",L,[s(h,{label:"Save",color:"primary",icon:"save",onClick:U,disable:o.value},null,8,["disable"]),s(h,{label:"Cancel",icon:"cancel",to:"/apps-library"})])])]),_:1}))}};export{J as default};

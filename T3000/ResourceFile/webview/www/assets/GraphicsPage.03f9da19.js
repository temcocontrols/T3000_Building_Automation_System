import{j as e}from"./react.2da10d74.js";import{r as s}from"./client.b9d1bbf8.js";import{A as t,w as r,x as i,T as a,y as o,z as n,aE as c,F as l,I as p,H as d,J as x,K as h}from"./App.2c62e2d1.js";import{c as g,D as j,a as u,b as f,d as y,e as m,f as v,T as w}from"./DataGridHeaderCell.34491fc4.js";import"./index.5672de35.js";import"./Serializer.f6a5f515.js";import"./useFocusableGroup.6d334b5b.js";class b{static async getGraphics(e){const s=`${t}/api/t3_device/graphics/${e}`,r=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok){const e=await r.text();throw new Error(`Failed to get graphics: ${r.status} ${e}`)}return r.json()}static async refreshAllGraphics(e){const s=`${t}/api/t3_device/graphics/${e}/refresh`,r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!r.ok){const e=await r.text();throw new Error(`Failed to refresh graphics: ${r.status} ${e}`)}return r.json()}static async refreshSingleGraphic(e,s){const r=`${t}/api/t3_device/graphics/${e}/refresh`,i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:s})});if(!i.ok){const e=await i.text();throw new Error(`Failed to refresh graphic: ${i.status} ${e}`)}return i.json()}static async saveRefreshedGraphics(e,s){const r=`${t}/api/t3_device/graphics/${e}/save-refreshed`,i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:s})});if(!i.ok){const e=await i.text();throw new Error(`Failed to save graphics: ${i.status} ${e}`)}return i.json()}static async loadAndSaveGraphics(e,s=0){const r=`${t}/api/t3_device/graphics/${e}/load-and-save`,i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewitem:s})});if(!i.ok){const e=await i.text();throw new Error(`Failed to load and save graphics: ${i.status} ${e}`)}return i.json()}}var C="_container_13y2u_7",S="_bladeContentContainer_13y2u_19",_="_bladeContentWrapper_13y2u_27",N="_bladeContent_13y2u_19",I="_partContent_13y2u_43",T="_toolbar_13y2u_52",$="_toolbarContainer_13y2u_61",L="_toolbarButton_13y2u_69",P="_horizontalDivider_13y2u_111",k="_bladeDescription_13y2u_118";const F=()=>{const{selectedDevice:t,treeData:F,selectDevice:z,getNextDevice:D,getFilteredDevices:E}=r(),[G,O]=s.exports.useState([]),[R,A]=s.exports.useState(!1),[H,B]=s.exports.useState(null),[J,U]=s.exports.useState(!1),[W,K]=s.exports.useState(!1),V=s.exports.useRef(null);s.exports.useState(!1),s.exports.useRef(!1),s.exports.useEffect((()=>{if(!t&&F.length>0){const e=E();if(e.length>0){const s=e[0];z(s)}}}),[t,F,z,E]);const q=s.exports.useCallback((async()=>{if(t){A(!0),B(null);try{const e=await b.getGraphics(t.serialNumber);O(e.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load graphics";B(s)}finally{A(!1)}}else O([])}),[t]);s.exports.useEffect((()=>{q()}),[q]),s.exports.useEffect((()=>{if(R||!t||W)return;const e=setTimeout((async()=>{try{(await b.loadAndSaveGraphics(t.serialNumber,0)).savedCount>0&&await q(),K(!0)}catch(e){K(!0)}}),500);return()=>clearTimeout(e)}),[R,t,W,q]);const[M,Q]=s.exports.useState(""),[X,Y]=s.exports.useState(null),[Z,ee]=s.exports.useState("ascending"),se=e=>{X===e?ee("ascending"===Z?"descending":"ascending"):(Y(e),ee("ascending"))},te=[...G.filter((e=>{var s,t,r;return""===M||(null==(s=e.graphicLabel)?void 0:s.toLowerCase().includes(M.toLowerCase()))||(null==(t=e.graphicId)?void 0:t.toLowerCase().includes(M.toLowerCase()))||(null==(r=e.graphicPictureFile)?void 0:r.toLowerCase().includes(M.toLowerCase()))}))].sort(((e,s)=>{if(!X)return 0;const t=e[X]||"",r=s[X]||"";return"ascending"===Z?t.toString().localeCompare(r.toString()):r.toString().localeCompare(t.toString())})),re=[g({columnId:"graphicId",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>se("graphicId"),children:[e.exports.jsx("span",{children:"Graphic ID"}),"graphicId"===X?"ascending"===Z?e.exports.jsx(d,{}):e.exports.jsx(x,{}):e.exports.jsx(h,{style:{opacity:.5}})]}),renderCell:s=>e.exports.jsx(w,{children:s.graphicId||"---"})}),g({columnId:"graphicLabel",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>se("graphicLabel"),children:[e.exports.jsx("span",{children:"Label"}),"graphicLabel"===X?"ascending"===Z?e.exports.jsx(d,{}):e.exports.jsx(x,{}):e.exports.jsx(h,{style:{opacity:.5}})]}),renderCell:s=>e.exports.jsx(w,{children:s.graphicLabel||"---"})}),g({columnId:"graphicPictureFile",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>se("graphicPictureFile"),children:[e.exports.jsx("span",{children:"Picture File"}),"graphicPictureFile"===X?"ascending"===Z?e.exports.jsx(d,{}):e.exports.jsx(x,{}):e.exports.jsx(h,{style:{opacity:.5}})]}),renderCell:s=>e.exports.jsx(w,{children:s.graphicPictureFile||"---"})}),g({columnId:"switchNode",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>se("switchNode"),children:[e.exports.jsx("span",{children:"Switch Node"}),"switchNode"===X?"ascending"===Z?e.exports.jsx(d,{}):e.exports.jsx(x,{}):e.exports.jsx(h,{style:{opacity:.5}})]}),renderCell:s=>e.exports.jsx(w,{children:s.switchNode||"---"})}),g({columnId:"graphicTotalPoint",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>se("graphicTotalPoint"),children:[e.exports.jsx("span",{children:"Total Points"}),"graphicTotalPoint"===X?"ascending"===Z?e.exports.jsx(d,{}):e.exports.jsx(x,{}):e.exports.jsx(h,{style:{opacity:.5}})]}),renderCell:s=>e.exports.jsx(w,{children:s.graphicTotalPoint||"---"})})];return e.exports.jsx("div",{className:C,children:e.exports.jsx("div",{className:S,children:e.exports.jsx("div",{className:_,children:e.exports.jsx("div",{className:N,children:e.exports.jsxs("div",{className:I,children:[H&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(i,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(a,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:H})]}),t&&e.exports.jsx("div",{className:T,children:e.exports.jsxs("div",{className:$,children:[e.exports.jsxs("button",{className:L,onClick:async()=>{if(t){U(!0);try{(await b.loadAndSaveGraphics(t.serialNumber,0)).savedCount>0&&await q()}catch(e){B(e instanceof Error?e.message:"Failed to refresh graphics")}finally{U(!1)}}},disabled:J,title:"Refresh all graphics from device",children:[e.exports.jsx(o,{}),e.exports.jsx("span",{children:J?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:L,onClick:()=>{if(0===G.length)return;const e=[["Graphic ID","Label","Picture File","Switch Node","Total Points"].join(","),...G.map((e=>[e.graphicId||"",e.graphicLabel||"",e.graphicPictureFile||"",e.switchNode||"",e.graphicTotalPoint||""].join(",")))].join("\n"),s=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`graphics_${null==t?void 0:t.serialNumber}_${(new Date).toISOString()}.csv`,i.click(),URL.revokeObjectURL(r)},disabled:0===G.length,title:"Export to CSV",children:[e.exports.jsx(n,{}),e.exports.jsx("span",{children:"Export"})]})]})}),e.exports.jsx("div",{className:P}),t&&e.exports.jsxs("div",{className:k,children:[e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(c,{style:{fontSize:"16px",color:"#605e5c"}}),e.exports.jsxs(a,{style:{fontSize:"13px",color:"#323130",fontWeight:600},children:["Graphics for ",t.nameShowOnTree||`Device ${t.serialNumber}`]}),R&&e.exports.jsx(l,{size:"tiny"})]}),e.exports.jsxs(a,{style:{fontSize:"12px",color:"#605e5c",marginTop:"4px"},children:[G.length," graphic",1!==G.length?"s":""," available"]})]}),e.exports.jsx("div",{style:{padding:"0"},children:t?R&&0===G.length?e.exports.jsx("div",{style:{textAlign:"center",marginTop:"48px"},children:e.exports.jsx(l,{size:"large",label:"Loading graphics..."})}):0===G.length?e.exports.jsxs("div",{style:{marginTop:"24px",textAlign:"center",padding:"0 20px"},children:[e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"8px"},children:[e.exports.jsx(p,{style:{fontSize:"16px",color:"#605e5c"}}),e.exports.jsx(a,{size:300,weight:"semibold",style:{color:"#323130"},children:"No graphics found for this device"})]}),e.exports.jsx(a,{size:200,style:{color:"#605e5c"},children:"Graphics may not have been configured yet"})]}):e.exports.jsx("div",{ref:V,style:{maxHeight:"calc(100vh - 220px)",overflow:"auto"},children:e.exports.jsxs(j,{items:te,columns:re,sortable:!0,getRowId:e=>`${e.serialNumber}-${e.graphicId}`,children:[e.exports.jsx(u,{children:e.exports.jsx(f,{children:({renderHeaderCell:s})=>e.exports.jsx(y,{children:s()})})}),e.exports.jsx(m,{children:({item:s,rowId:t})=>e.exports.jsx(f,{children:({renderCell:t})=>e.exports.jsx(v,{children:t(s)})},t)})]})}):e.exports.jsxs("div",{style:{textAlign:"center"},children:[e.exports.jsx("div",{style:{marginTop:"48px",marginBottom:"16px"},children:e.exports.jsx(c,{style:{fontSize:"48px",color:"#c8c6c4"}})}),e.exports.jsx(a,{size:400,weight:"semibold",style:{display:"block",marginBottom:"8px"},children:"No Device Selected"}),e.exports.jsx(a,{size:300,style:{color:"#605e5c"},children:"Select a device from the tree to view its graphics"})]})})]})})})})})};export{F as GraphicsPage};

import{j as e}from"./react.1acd1a13.js";import{r as s,R as r}from"./client.58f92968.js";import{aN as a,M as t,l as i,L as l,n as o,T as n,y as c,N as p,z as d,P as x,Q as h,I as u,S as g,R as m,U as j,V as _,X as f,B as b,s as v}from"./App.3fe38e41.js";import{c as N,D as C,a as q,b as w,d as L,e as S,f as z}from"./DataGridHeaderCell.f7016832.js";import{T as F}from"./TableCellLayout.9e29eb07.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";var y="_container_1qzq2_13",I="_bladeContentContainer_1qzq2_37",D="_bladeContentWrapper_1qzq2_53",$="_bladeContent_1qzq2_37",k="_partContent_1qzq2_85",T="_toolbar_1qzq2_103",P="_toolbarContainer_1qzq2_121",E="_toolbarButton_1qzq2_137",A="_toolbarSeparator_1qzq2_223",R="_searchInputWrapper_1qzq2_239",H="_searchIcon_1qzq2_253",B="_searchInput_1qzq2_239",G="_overviewHr_1qzq2_333",O="_dockingBody_1qzq2_349",U="_autoLoadIndicator_1qzq2_365",V="_noData_1qzq2_389",W="_loadingBar_1qzq2_407",M="_headerCellSort_1qzq2_769",Q="_sortIconFaded_1qzq2_795",X="_errorNotice_1qzq2_803",Y="_iconError_1qzq2_823",J="_textError_1qzq2_835",K="_marginLeft8_1qzq2_847",Z="_noPadding_1qzq2_855",ee="_centerText_1qzq2_881",se="_scrollContainer_1qzq2_999";const re=()=>{const{selectedDevice:re,treeData:ae,selectDevice:te,getNextDevice:ie,getFilteredDevices:le}=i(),oe=l((e=>e.setMessage)),[ne,ce]=s.exports.useState([]),[pe,de]=s.exports.useState(!1),[xe,he]=s.exports.useState(null),[ue,ge]=s.exports.useState(!1),[me,je]=s.exports.useState(!1),_e=s.exports.useRef(!1),fe=s.exports.useRef(null),[be,ve]=s.exports.useState(!1),Ne=s.exports.useRef(!1);s.exports.useEffect((()=>{if(!re&&ae.length>0){const e=le();if(e.length>0){const s=e[0];te(s)}}}),[re,ae,te,le]);const Ce=s.exports.useCallback((async()=>{if(re){de(!0),he(null);try{const e=await class{static async loadAllFromDB(e){return new a(`${t}/api`).graphics.getAll(e)}static async loadFromDB(e,s){const r=new a(`${t}/api`);return(await r.graphics.getAll(e)).find((e=>e.index===s))}static async loadByIdFromDB(e){const[s,r]=e.split("-"),i=parseInt(s),l=parseInt(r);if(isNaN(i)||isNaN(l))return;const o=new a(`${t}/api`);return await o.graphics.get(i,l)||void 0}static async refreshAllFromDevice(e){throw new Error("GraphicRefreshApi.refreshAllFromDevice not yet implemented - use Action 0/1")}static async refreshSingleFromDevice(e,s){throw new Error("GraphicRefreshApi.refreshSingleFromDevice not yet implemented - use Action 7")}}.loadAllFromDB(re.serialNumber);ce(e||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load graphics";he(s)}finally{de(!1)}}else ce([])}),[re]);s.exports.useEffect((()=>{Ce(),je(!1),_e.current=!1}),[Ce]),s.exports.useEffect((()=>{if(pe||!re||me||_e.current)return;(async()=>{if(_e.current=!0,ne.length>0)je(!0);else{de(!0);try{const e=await m.refreshFromDevice({serialNumber:re.serialNumber,type:"graphic",onLoadingChange:e=>{e&&oe(`Loading graphics from ${re.nameShowOnTree} (Action 17)...`,"info")}});oe(`✓ Synced ${e.itemCount} graphics from ${re.nameShowOnTree}`,"success")}catch(e){oe(`Failed to sync graphics: ${e instanceof Error?e.message:"Unknown error"}`,"error")}finally{await Ce(),de(!1),je(!0)}}})()}),[pe,re,me,Ce,ne.length,oe]);const qe=s.exports.useCallback((()=>{const e=ie();e&&(ve(!0),te(e),setTimeout((()=>{ve(!1)}),500))}),[ie,te]),we=s.exports.useCallback((e=>{if(be||pe)return;const s=e.currentTarget;s.scrollHeight-s.scrollTop-s.clientHeight<=1&&ne.length>0?Ne.current=!0:Ne.current=!1}),[be,pe,ne.length]),Le=s.exports.useCallback((e=>{be||pe||0===ne.length||e.deltaY>0&&Ne.current&&(Ne.current=!1,qe())}),[be,pe,ne.length,qe]);s.exports.useEffect((()=>{re&&fe.current&&fe.current.scrollTo({top:0,behavior:be?"smooth":"auto"})}),[re,be]);const Se=s.exports.useCallback((e=>{if(!re||!e.Graphic_ID)return;const s=`${t}/api/t3_device/devices/${re.serialNumber}/graphics/${e.Graphic_ID}/webview`;window.open(s,"_blank")}),[re]),[ze,Fe]=s.exports.useState(""),[ye,Ie]=s.exports.useState(null),[De,$e]=s.exports.useState("ascending"),ke=e=>{ye===e?$e("ascending"===De?"descending":"ascending"):(Ie(e),$e("ascending"))},Te=[...ne.filter((e=>{var s,r,a,t;return""===ze||(null==(s=e.graphicLabel)?void 0:s.toLowerCase().includes(ze.toLowerCase()))||(null==(r=e.graphicFullLabel)?void 0:r.toLowerCase().includes(ze.toLowerCase()))||(null==(a=e.graphicId)?void 0:a.toLowerCase().includes(ze.toLowerCase()))||(null==(t=e.graphicPictureFile)?void 0:t.toLowerCase().includes(ze.toLowerCase()))}))].sort(((e,s)=>{if(!ye)return 0;const r=e[ye]||"",a=s[ye]||"";return"ascending"===De?r.toString().localeCompare(a.toString()):a.toString().localeCompare(r.toString())})),Pe=r.useMemo((()=>0===Te.length?Array(10).fill(null).map(((e,s)=>({GraphicId:-(s+1),serialNumber:(null==re?void 0:re.serialNumber)||0,graphicId:"",switchNode:"",graphicLabel:"",graphicFullLabel:"",graphicPictureFile:"",graphicTotalPoint:"0"}))):Te),[Te,re]),Ee=e=>!e.graphicId&&0===Te.length,Ae=[N({columnId:"Graphic_ID",renderHeaderCell:()=>e.exports.jsxs("div",{className:M,onClick:()=>ke("graphicId"),children:[e.exports.jsx("span",{children:"Graphic"}),"graphicId"===ye?"ascending"===De?e.exports.jsx(j,{}):e.exports.jsx(_,{}):e.exports.jsx(f,{className:Q})]}),renderCell:s=>e.exports.jsx(F,{children:!Ee(s)&&(s.graphicId||"")})}),N({columnId:"Full_Label",renderHeaderCell:()=>e.exports.jsxs("div",{className:M,onClick:()=>ke("graphicFullLabel"),children:[e.exports.jsx("span",{children:"Full Label"}),"graphicFullLabel"===ye?"ascending"===De?e.exports.jsx(j,{}):e.exports.jsx(_,{}):e.exports.jsx(f,{className:Q})]}),renderCell:s=>e.exports.jsx(F,{children:!Ee(s)&&(s.graphicFullLabel||"")})}),N({columnId:"Label",renderHeaderCell:()=>e.exports.jsxs("div",{className:M,onClick:()=>ke("graphicLabel"),children:[e.exports.jsx("span",{children:"Label"}),"graphicLabel"===ye?"ascending"===De?e.exports.jsx(j,{}):e.exports.jsx(_,{}):e.exports.jsx(f,{className:Q})]}),renderCell:s=>e.exports.jsx(F,{children:!Ee(s)&&(s.graphicLabel||"")})}),N({columnId:"Picture_File",renderHeaderCell:()=>e.exports.jsxs("div",{className:M,onClick:()=>ke("graphicPictureFile"),children:[e.exports.jsx("span",{children:"Picture File"}),"graphicPictureFile"===ye?"ascending"===De?e.exports.jsx(j,{}):e.exports.jsx(_,{}):e.exports.jsx(f,{className:Q})]}),renderCell:s=>e.exports.jsx(F,{children:!Ee(s)&&(s.graphicPictureFile||"")})}),N({columnId:"Element_Count",renderHeaderCell:()=>e.exports.jsxs("div",{className:M,onClick:()=>ke("graphicTotalPoint"),children:[e.exports.jsx("span",{children:"Element Count"}),"graphicTotalPoint"===ye?"ascending"===De?e.exports.jsx(j,{}):e.exports.jsx(_,{}):e.exports.jsx(f,{className:Q})]}),renderCell:s=>e.exports.jsx(F,{children:!Ee(s)&&(s.graphicTotalPoint||"0")})}),N({columnId:"actions",renderHeaderCell:()=>e.exports.jsx("span",{children:"Action"}),renderCell:s=>Ee(s)?e.exports.jsx(F,{}):e.exports.jsx(F,{children:e.exports.jsx(b,{size:"small",icon:e.exports.jsx(v,{}),onClick:e=>{e.stopPropagation(),Se(s)},title:"View webview for this graphic",children:"View Webview"})})})];return e.exports.jsx("div",{className:y,children:e.exports.jsx("div",{className:I,children:e.exports.jsx("div",{className:D,children:e.exports.jsx("div",{className:$,children:e.exports.jsxs("div",{className:k,children:[xe&&e.exports.jsxs("div",{className:X,children:[e.exports.jsx(o,{className:Y}),e.exports.jsx(n,{className:J,children:xe})]}),re&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:T,children:e.exports.jsxs("div",{className:P,children:[e.exports.jsxs("button",{className:E,onClick:async()=>{if(re){ge(!0);try{const e=await m.refreshFromDevice({serialNumber:re.serialNumber,type:"graphic",onLoadingChange:e=>{e&&oe(`Loading graphics from ${re.nameShowOnTree} (Action 17)...`,"info")}});oe(`✓ Synced ${e.itemCount} graphics from ${re.nameShowOnTree}`,"success"),await Ce()}catch(e){const s=e instanceof Error?e.message:"Failed to refresh graphics";he(s),oe(`Failed to sync graphics: ${s}`,"error")}finally{ge(!1)}}},disabled:ue,title:"Refresh all graphics from device",children:[e.exports.jsx(c,{}),e.exports.jsx("span",{children:ue?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:E,onClick:()=>{if(0===ne.length)return;const e=[["Graphic ID","Label","Full Label","Picture File","Switch Node","Element Count"].join(","),...ne.map((e=>[e.graphicId||"",e.graphicLabel||"",e.graphicFullLabel||"",e.graphicPictureFile||"",e.switchNode||"",e.graphicTotalPoint||""].join(",")))].join("\n"),s=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`graphics_${(null==re?void 0:re.serialNumber)||"export"}.csv`,a.click(),URL.revokeObjectURL(r)},disabled:0===ne.length,title:"Export to CSV",children:[e.exports.jsx(p,{}),e.exports.jsx("span",{children:"Export"})]}),e.exports.jsx("div",{className:A,role:"separator"}),e.exports.jsxs("button",{className:E,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(d,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:R,children:[e.exports.jsx(x,{className:H}),e.exports.jsx("input",{className:B,type:"text",placeholder:"Search graphics...",value:ze,onChange:e=>{Fe(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search graphics"})]}),e.exports.jsx(h,{content:`Showing graphics for ${re.nameShowOnTree} (SN: ${re.serialNumber}). This table displays all configured graphic floor plans and their associated elements.`,relationship:"description",children:e.exports.jsx("button",{className:`${E} ${K}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(u,{})})})]})}),e.exports.jsx("div",{className:Z,children:e.exports.jsx("hr",{className:G})})]}),e.exports.jsxs("div",{className:O,children:[pe&&0===ne.length&&e.exports.jsxs("div",{className:W,children:[e.exports.jsx(g,{size:"tiny"}),e.exports.jsx(n,{size:200,weight:"regular",children:"Loading graphics..."})]}),!re&&!pe&&e.exports.jsx("div",{className:V,children:e.exports.jsxs("div",{className:ee,children:[e.exports.jsx(n,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(n,{size:200,children:"Please select a device from the tree to view graphics"})]})}),re&&!pe&&e.exports.jsx("div",{ref:fe,className:se,onScroll:we,onWheel:Le,children:e.exports.jsxs(C,{items:Pe,columns:Ae,sortable:!0,getRowId:e=>{var s,r,a;const t=null!=(r=null!=(s=e.GraphicId)?s:e.graphicId)?r:`empty-${Pe.indexOf(e)}`;return`${null!=(a=e.serialNumber)?a:"unknown"}-${t}`},children:[e.exports.jsx(q,{children:e.exports.jsx(w,{children:({renderHeaderCell:s})=>e.exports.jsx(L,{children:s()})})}),e.exports.jsx(S,{children:({item:s,rowId:r})=>e.exports.jsx(w,{children:({renderCell:r})=>e.exports.jsx(z,{children:r(s)})},r)})]})}),be&&e.exports.jsxs("div",{className:U,children:[e.exports.jsx(g,{size:"tiny"}),e.exports.jsx(n,{size:200,children:"Loading next device..."})]})]})]})})})})})};export{re as GraphicsPage};

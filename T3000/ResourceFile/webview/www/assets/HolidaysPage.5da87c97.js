import{j as e}from"./react.1acd1a13.js";import{r as s,R as a}from"./client.58f92968.js";import{l,M as r,n as t,T as o,y as i,N as n,z as d,P as c,Q as x,I as p,S as h,R as u,U as m,V as j,X as _,Z as f}from"./App.3fe38e41.js";import{c as b,D as v,a as N,b as y,d as g,e as k,f as C}from"./DataGridHeaderCell.f7016832.js";import{T as I}from"./TableCellLayout.9e29eb07.js";import{I as S}from"./Input.037b8c53.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";var w="_container_1ak63_7",L="_bladeContentContainer_1ak63_19",D="_bladeContentWrapper_1ak63_27",H="_bladeContent_1ak63_19",z="_partContent_1ak63_43",E="_toolbar_1ak63_52",W="_toolbarContainer_1ak63_61",M="_toolbarButton_1ak63_69",T="_errorMessage_1ak63_103",R="_toolbarSeparator_1ak63_142",F="_searchInputWrapper_1ak63_150",$="_searchIcon_1ak63_157",A="_searchInput_1ak63_150",B="_overviewHr_1ak63_217",V="_dockingBody_1ak63_225",P="_scrollContainer_1ak63_233",G="_autoLoadIndicator_1ak63_261",O="_noData_1ak63_273",K="_loadingBar_1ak63_282",U="_editableCell_1ak63_423",Y="_refreshIconButton_1ak63_507",Q="_rotating_1ak63_553",X="_headerCellSort_1ak63_558",Z="_headerCellWith8Gap_1ak63_565",q="_flexCenter8Gap_1ak63_571",J="_marginLeft8_1ak63_577",ee="_headerCell_1ak63_558",se="_sortIconFaded_1ak63_587",ae="_iconError_1ak63_616",le="_textError_1ak63_622",re="_noPadding_1ak63_632",te="_centerText_1ak63_636",oe="_fullWidth_1ak63_658";const ie=()=>{const{selectedDevice:ie,selectDevice:ne,getNextDevice:de,getFilteredDevices:ce}=l(),[xe,pe]=s.exports.useState([]),[he,ue]=s.exports.useState(!1),[me,je]=s.exports.useState(null),[_e,fe]=s.exports.useState(!1),[be,ve]=s.exports.useState(""),[Ne,ye]=s.exports.useState(null),[ge,ke]=s.exports.useState(""),[Ce,Ie]=s.exports.useState(!1),[Se,we]=s.exports.useState(null),[Le,De]=s.exports.useState("ascending"),[He,ze]=s.exports.useState(new Set),[Ee,We]=s.exports.useState(!1),Me=s.exports.useRef(!1),Te=s.exports.useRef(null),[Re,Fe]=s.exports.useState(!1),$e=s.exports.useRef(!1);s.exports.useEffect((()=>{if(!ie){const e=ce();e.length>0&&ne(e[0])}}),[ie,ce,ne]);const Ae=s.exports.useCallback((async()=>{if(ie){ue(!0),je(null);try{const e=`${r}/api/t3_device/devices/${ie.serialNumber}/table/HOLIDAYS`,s=await fetch(e);if(!s.ok)throw new Error(`Failed to fetch holidays: ${s.statusText}`);const a=await s.json();pe(a.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load holidays";je(s)}finally{ue(!1)}}else pe([])}),[ie]);s.exports.useEffect((()=>{Ae()}),[Ae]),s.exports.useEffect((()=>{pe([]),We(!1),Me.current=!1}),[null==ie?void 0:ie.serialNumber]),s.exports.useEffect((()=>{if(he||!ie||Ee||Me.current)return;(async()=>{if(Me.current=!0,xe.length>0)We(!0);else try{const e=ie.serialNumber;await u.refreshAllHolidays(e);await Ae(),We(!0)}catch(e){}})()}),[he,ie,Ee,Ae,xe.length]);const Be=e=>{Se===e?De("ascending"===Le?"descending":"ascending"):(we(e),De("ascending"))},Ve=s.exports.useCallback((()=>{const e=de();e&&(Fe(!0),ne(e),setTimeout((()=>{Fe(!1)}),500))}),[de,ne]),Pe=s.exports.useCallback((e=>{if(Re||he)return;const s=e.currentTarget;s.scrollHeight-s.scrollTop-s.clientHeight<=1&&xe.length>0?$e.current=!0:$e.current=!1}),[Re,he,xe.length]),Ge=s.exports.useCallback((e=>{Re||he||0===xe.length||e.deltaY>0&&$e.current&&($e.current=!1,Ve())}),[Re,he,xe.length,Ve]);s.exports.useEffect((()=>{ie&&Te.current&&Te.current.scrollTo({top:0,behavior:Re?"smooth":"auto"})}),[ie,Re]);const Oe=a.useMemo((()=>0===xe.length?Array(10).fill(null).map(((e,s)=>({serialNumber:0,holidayId:"",fullLabel:"",autoManual:"",value:"",label:""}))):xe),[xe]),Ke=e=>!e.holidayId&&0===xe.length,Ue=(e,s,a)=>{ye({serialNumber:e.serialNumber,holidayId:e.holidayId||"",field:s}),ke(a||"")},Ye=async()=>{if(Ne&&ge.trim()){Ie(!0);try{pe((e=>e.map((e=>e.serialNumber===Ne.serialNumber&&e.holidayId===Ne.holidayId?{...e,[Ne.field]:ge}:e)))),ye(null)}catch(e){}finally{Ie(!1)}}else ye(null)},Qe=e=>{"Enter"===e.key?Ye():"Escape"===e.key&&ye(null)},Xe=[b({columnId:"holidayId",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("holidayId"),children:[e.exports.jsx("span",{children:"Holiday"}),"holidayId"===Se?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:se})]}),renderCell:s=>{const a=s.holidayId&&He.has(s.holidayId);return e.exports.jsx(I,{children:!Ke(s)&&e.exports.jsxs("div",{className:q,children:[e.exports.jsx("button",{className:`${Y} ${a?Q:""}`,onClick:e=>{e.stopPropagation(),(async e=>{if(!ie||!e.holidayId)return;const s=e.holidayId;ze((e=>new Set(e).add(s)));try{const a=ie.serialNumber,l=parseInt(e.holidayId);await u.refreshSingleHoliday(a,l),await Ae()}catch(a){}finally{ze((e=>{const a=new Set(e);return a.delete(s),a}))}})(s)},disabled:!!a,title:"Refresh this holiday from device","aria-label":"Refresh holiday",children:e.exports.jsx(i,{fontSize:16})}),e.exports.jsx("span",{children:s.holidayId||"---"})]})})}}),b({columnId:"fullLabel",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("fullLabel"),children:[e.exports.jsx("span",{children:"Full Label"}),"fullLabel"===Se?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:se})]}),renderCell:s=>{const a=(null==Ne?void 0:Ne.serialNumber)===s.serialNumber&&(null==Ne?void 0:Ne.holidayId)===s.holidayId&&"fullLabel"===(null==Ne?void 0:Ne.field);return e.exports.jsx(I,{children:!Ke(s)&&(a?e.exports.jsx(S,{value:ge,onChange:(e,s)=>ke(s.value),onBlur:Ye,onKeyDown:Qe,autoFocus:!0,disabled:Ce,size:"small",className:oe}):e.exports.jsx("div",{onDoubleClick:()=>Ue(s,"fullLabel",s.fullLabel||""),className:U,children:e.exports.jsx(o,{size:200,children:s.fullLabel||"Unnamed"})}))})}}),b({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{className:ee,children:e.exports.jsx("span",{children:"Auto/Man"})}),renderCell:s=>{var a;const l="1"===s.autoManual||"auto"===(null==(a=s.autoManual)?void 0:a.toLowerCase());return e.exports.jsx(I,{children:!Ke(s)&&e.exports.jsxs("div",{className:Z,children:[e.exports.jsx(f,{checked:l,onChange:()=>(async e=>{const s="1"===e.autoManual?"0":"1";pe((a=>a.map((a=>a.serialNumber===e.serialNumber&&a.holidayId===e.holidayId?{...a,autoManual:s}:a))))})(s)}),e.exports.jsx(o,{size:200,children:l?"Auto":"Manual"})]})})}}),b({columnId:"value",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("value"),children:[e.exports.jsx("span",{children:"Value"}),"value"===Se?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:se})]}),renderCell:s=>e.exports.jsx(I,{children:!Ke(s)&&(s.value||"---")})}),b({columnId:"label",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("label"),children:[e.exports.jsx("span",{children:"Label"}),"label"===Se?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:se})]}),renderCell:s=>{const a=(null==Ne?void 0:Ne.serialNumber)===s.serialNumber&&(null==Ne?void 0:Ne.holidayId)===s.holidayId&&"label"===(null==Ne?void 0:Ne.field);return e.exports.jsx(I,{children:!Ke(s)&&(a?e.exports.jsx(S,{value:ge,onChange:(e,s)=>ke(s.value),onBlur:Ye,onKeyDown:Qe,autoFocus:!0,disabled:Ce,size:"small",className:oe}):e.exports.jsx("div",{onDoubleClick:()=>Ue(s,"label",s.label||""),className:U,children:e.exports.jsx(o,{size:200,children:s.label||"---"})}))})}})];return e.exports.jsx("div",{className:w,children:e.exports.jsx("div",{className:L,children:e.exports.jsx("div",{className:D,children:e.exports.jsx("div",{className:H,children:e.exports.jsxs("div",{className:z,children:[me&&e.exports.jsxs("div",{className:T,children:[e.exports.jsx(t,{className:ae}),e.exports.jsx(o,{className:le,children:me})]}),ie&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:E,children:e.exports.jsxs("div",{className:W,children:[e.exports.jsxs("button",{className:M,onClick:async()=>{if(ie){fe(!0),je(null);try{const e=ie.serialNumber;await u.refreshAllHolidays(e);await Ae()}catch(e){je(e instanceof Error?e.message:"Failed to refresh from device")}finally{fe(!1)}}},disabled:_e,title:"Refresh from Device","aria-label":"Refresh from Device",children:[e.exports.jsx(i,{className:_e?Q:""}),e.exports.jsx("span",{children:_e?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:M,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(n,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:R,role:"separator"}),e.exports.jsxs("button",{className:M,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(d,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:F,children:[e.exports.jsx(c,{className:$}),e.exports.jsx("input",{className:A,type:"text",placeholder:"Search holidays...",value:be,onChange:e=>{ve(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search holidays"})]}),e.exports.jsx(x,{content:`Showing holidays for ${ie.nameShowOnTree} (SN: ${ie.serialNumber}). This table displays all configured annual routine/holiday schedules including labels, auto/manual modes, and values.`,relationship:"description",children:e.exports.jsx("button",{className:`${M} ${J}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(p,{})})})]})}),e.exports.jsx("div",{className:re,children:e.exports.jsx("hr",{className:B})})]}),e.exports.jsxs("div",{className:V,children:[he&&0===xe.length&&e.exports.jsxs("div",{className:K,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(o,{size:200,weight:"regular",children:"Loading holidays..."})]}),!ie&&!he&&e.exports.jsx("div",{className:O,children:e.exports.jsxs("div",{className:te,children:[e.exports.jsx(o,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(o,{size:200,children:"Please select a device from the tree to view holidays"})]})}),ie&&!he&&e.exports.jsxs("div",{ref:Te,className:P,onScroll:Pe,onWheel:Ge,children:[e.exports.jsxs(v,{items:Oe,columns:Xe,sortable:!0,resizableColumns:!0,columnSizingOptions:{holidayId:{minWidth:60,idealWidth:100},fullLabel:{minWidth:150,idealWidth:200},autoManual:{minWidth:100,idealWidth:130},value:{minWidth:80,idealWidth:100},label:{minWidth:90,idealWidth:130}},children:[e.exports.jsx(N,{children:e.exports.jsx(y,{children:({renderHeaderCell:s})=>e.exports.jsx(g,{children:s()})})}),e.exports.jsx(k,{children:({item:s,rowId:a})=>e.exports.jsx(y,{children:({renderCell:a})=>e.exports.jsx(C,{children:a(s)})},a)})]}),Re&&e.exports.jsxs("div",{className:G,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(o,{children:"Loading next device..."})]})]})]})]})})})})})};export{ie as HolidaysPage};

import{j as e}from"./react.3bc90b5d.js";import{r as s,R as l}from"./client.58f92968.js";import{u as a,M as r,E as t,T as o,h as i,N as n,i as d,P as c,Q as x,I as p,S as h,R as u,U as m,V as b,X as j,Z as _}from"./App.4ea21eda.js";import{c as v,D as y,a as f,b as N,d as g,e as C,f as I}from"./DataGridHeaderCell.c083631d.js";import{T as S}from"./TableCellLayout.777c5080.js";import{I as w}from"./Input.4fa0d50c.js";import"./index.f111124c.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.f6c34e59.js";import"./_commonjsHelpers.a5007c1f.js";var k="_container_1yv4b_13",L="_bladeContentContainer_1yv4b_37",D="_bladeContentWrapper_1yv4b_53",E="_bladeContent_1yv4b_37",H="_partContent_1yv4b_85",W="_toolbar_1yv4b_103",z="_toolbarContainer_1yv4b_121",M="_toolbarButton_1yv4b_137",T="_errorMessage_1yv4b_205",R="_toolbarSeparator_1yv4b_283",F="_searchInputWrapper_1yv4b_299",$="_searchIcon_1yv4b_313",A="_searchInput_1yv4b_299",B="_overviewHr_1yv4b_433",V="_dockingBody_1yv4b_449",P="_scrollContainer_1yv4b_465",G="_autoLoadIndicator_1yv4b_521",O="_noData_1yv4b_545",K="_loadingBar_1yv4b_563",U="_editableCell_1yv4b_845",Y="_refreshIconButton_1yv4b_1013",Q="_rotating_1yv4b_1105",X="_headerCellSort_1yv4b_1115",Z="_headerCellWith8Gap_1yv4b_1129",q="_flexCenter8Gap_1yv4b_1141",J="_marginLeft8_1yv4b_1153",ee="_headerCell_1yv4b_1115",se="_sortIconFaded_1yv4b_1173",le="_iconError_1yv4b_1231",ae="_textError_1yv4b_1243",re="_noPadding_1yv4b_1263",te="_centerText_1yv4b_1271",oe="_fullWidth_1yv4b_1315";const ie=()=>{const{selectedDevice:ie,selectDevice:ne,getNextDevice:de,getFilteredDevices:ce}=a(),[xe,pe]=s.exports.useState([]),[he,ue]=s.exports.useState(!1),[me,be]=s.exports.useState(null),[je,_e]=s.exports.useState(!1),[ve,ye]=s.exports.useState(""),[fe,Ne]=s.exports.useState(null),[ge,Ce]=s.exports.useState(""),[Ie,Se]=s.exports.useState(!1),[we,ke]=s.exports.useState(null),[Le,De]=s.exports.useState("ascending"),[Ee,He]=s.exports.useState(new Set),[We,ze]=s.exports.useState(!1),Me=s.exports.useRef(!1),Te=s.exports.useRef(null),[Re,Fe]=s.exports.useState(!1),$e=s.exports.useRef(!1);s.exports.useEffect((()=>{if(!ie){const e=ce();e.length>0&&ne(e[0])}}),[ie,ce,ne]);const Ae=s.exports.useCallback((async()=>{if(ie){ue(!0),be(null);try{const e=`${r}/api/t3_device/devices/${ie.serialNumber}/table/HOLIDAYS`,s=await fetch(e);if(!s.ok)throw new Error(`Failed to fetch holidays: ${s.statusText}`);const l=await s.json();pe(l.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load holidays";be(s)}finally{ue(!1)}}else pe([])}),[ie]);s.exports.useEffect((()=>{Ae()}),[Ae]),s.exports.useEffect((()=>{pe([]),ze(!1),Me.current=!1}),[null==ie?void 0:ie.serialNumber]),s.exports.useEffect((()=>{if(he||!ie||We||Me.current)return;(async()=>{if(Me.current=!0,xe.length>0)ze(!0);else try{const e=ie.serialNumber;await u.refreshAllHolidays(e);await Ae(),ze(!0)}catch(e){}})()}),[he,ie,We,Ae,xe.length]);const Be=e=>{we===e?De("ascending"===Le?"descending":"ascending"):(ke(e),De("ascending"))},Ve=s.exports.useCallback((()=>{const e=de();e&&(Fe(!0),ne(e),setTimeout((()=>{Fe(!1)}),500))}),[de,ne]),Pe=s.exports.useCallback((e=>{if(Re||he)return;const s=e.currentTarget;s.scrollHeight-s.scrollTop-s.clientHeight<=1&&xe.length>0?$e.current=!0:$e.current=!1}),[Re,he,xe.length]),Ge=s.exports.useCallback((e=>{Re||he||0===xe.length||e.deltaY>0&&$e.current&&($e.current=!1,Ve())}),[Re,he,xe.length,Ve]);s.exports.useEffect((()=>{ie&&Te.current&&Te.current.scrollTo({top:0,behavior:Re?"smooth":"auto"})}),[ie,Re]);const Oe=l.useMemo((()=>0===xe.length?Array(10).fill(null).map(((e,s)=>({serialNumber:0,holidayId:"",fullLabel:"",autoManual:"",value:"",label:""}))):xe),[xe]),Ke=e=>!e.holidayId&&0===xe.length,Ue=(e,s,l)=>{Ne({serialNumber:e.serialNumber,holidayId:e.holidayId||"",field:s}),Ce(l||"")},Ye=async()=>{if(fe&&ge.trim()){Se(!0);try{pe((e=>e.map((e=>e.serialNumber===fe.serialNumber&&e.holidayId===fe.holidayId?{...e,[fe.field]:ge}:e)))),Ne(null)}catch(e){}finally{Se(!1)}}else Ne(null)},Qe=e=>{"Enter"===e.key?Ye():"Escape"===e.key&&Ne(null)},Xe=[v({columnId:"holidayId",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("holidayId"),children:[e.exports.jsx("span",{children:"Holiday"}),"holidayId"===we?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(b,{}):e.exports.jsx(j,{className:se})]}),renderCell:s=>{const l=s.holidayId&&Ee.has(s.holidayId);return e.exports.jsx(S,{children:!Ke(s)&&e.exports.jsxs("div",{className:q,children:[e.exports.jsx("button",{className:`${Y} ${l?Q:""}`,onClick:e=>{e.stopPropagation(),(async e=>{if(!ie||!e.holidayId)return;const s=e.holidayId;He((e=>new Set(e).add(s)));try{const l=ie.serialNumber,a=parseInt(e.holidayId);await u.refreshSingleHoliday(l,a),await Ae()}catch(l){}finally{He((e=>{const l=new Set(e);return l.delete(s),l}))}})(s)},disabled:!!l,title:"Refresh this holiday from device","aria-label":"Refresh holiday",children:e.exports.jsx(i,{fontSize:16})}),e.exports.jsx("span",{children:s.holidayId||"---"})]})})}}),v({columnId:"fullLabel",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("fullLabel"),children:[e.exports.jsx("span",{children:"Full Label"}),"fullLabel"===we?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(b,{}):e.exports.jsx(j,{className:se})]}),renderCell:s=>{const l=(null==fe?void 0:fe.serialNumber)===s.serialNumber&&(null==fe?void 0:fe.holidayId)===s.holidayId&&"fullLabel"===(null==fe?void 0:fe.field);return e.exports.jsx(S,{children:!Ke(s)&&(l?e.exports.jsx(w,{value:ge,onChange:(e,s)=>Ce(s.value),onBlur:Ye,onKeyDown:Qe,autoFocus:!0,disabled:Ie,size:"small",className:oe}):e.exports.jsx("div",{onDoubleClick:()=>Ue(s,"fullLabel",s.fullLabel||""),className:U,children:e.exports.jsx(o,{size:200,children:s.fullLabel||"Unnamed"})}))})}}),v({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{className:ee,children:e.exports.jsx("span",{children:"Auto/Man"})}),renderCell:s=>{var l;const a="1"===s.autoManual||"auto"===(null==(l=s.autoManual)?void 0:l.toLowerCase());return e.exports.jsx(S,{children:!Ke(s)&&e.exports.jsxs("div",{className:Z,children:[e.exports.jsx(_,{checked:a,onChange:()=>(async e=>{const s="1"===e.autoManual?"0":"1";pe((l=>l.map((l=>l.serialNumber===e.serialNumber&&l.holidayId===e.holidayId?{...l,autoManual:s}:l))))})(s)}),e.exports.jsx(o,{size:200,children:a?"Auto":"Manual"})]})})}}),v({columnId:"value",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("value"),children:[e.exports.jsx("span",{children:"Value"}),"value"===we?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(b,{}):e.exports.jsx(j,{className:se})]}),renderCell:s=>e.exports.jsx(S,{children:!Ke(s)&&(s.value||"---")})}),v({columnId:"label",renderHeaderCell:()=>e.exports.jsxs("div",{className:X,onClick:()=>Be("label"),children:[e.exports.jsx("span",{children:"Label"}),"label"===we?"ascending"===Le?e.exports.jsx(m,{}):e.exports.jsx(b,{}):e.exports.jsx(j,{className:se})]}),renderCell:s=>{const l=(null==fe?void 0:fe.serialNumber)===s.serialNumber&&(null==fe?void 0:fe.holidayId)===s.holidayId&&"label"===(null==fe?void 0:fe.field);return e.exports.jsx(S,{children:!Ke(s)&&(l?e.exports.jsx(w,{value:ge,onChange:(e,s)=>Ce(s.value),onBlur:Ye,onKeyDown:Qe,autoFocus:!0,disabled:Ie,size:"small",className:oe}):e.exports.jsx("div",{onDoubleClick:()=>Ue(s,"label",s.label||""),className:U,children:e.exports.jsx(o,{size:200,children:s.label||"---"})}))})}})];return e.exports.jsx("div",{className:k,children:e.exports.jsx("div",{className:L,children:e.exports.jsx("div",{className:D,children:e.exports.jsx("div",{className:E,children:e.exports.jsxs("div",{className:H,children:[me&&e.exports.jsxs("div",{className:T,children:[e.exports.jsx(t,{className:le}),e.exports.jsx(o,{className:ae,children:me})]}),ie&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:W,children:e.exports.jsxs("div",{className:z,children:[e.exports.jsxs("button",{className:M,onClick:async()=>{if(ie){_e(!0),be(null);try{const e=ie.serialNumber;await u.refreshAllHolidays(e);await Ae()}catch(e){be(e instanceof Error?e.message:"Failed to refresh from device")}finally{_e(!1)}}},disabled:je,title:"Refresh from Device","aria-label":"Refresh from Device",children:[e.exports.jsx(i,{className:je?Q:""}),e.exports.jsx("span",{children:je?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:M,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(n,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:R,role:"separator"}),e.exports.jsxs("button",{className:M,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(d,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:F,children:[e.exports.jsx(c,{className:$}),e.exports.jsx("input",{className:A,type:"text",placeholder:"Search holidays...",value:ve,onChange:e=>{ye(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search holidays"})]}),e.exports.jsx(x,{content:`Showing holidays for ${ie.nameShowOnTree} (SN: ${ie.serialNumber}). This table displays all configured annual routine/holiday schedules including labels, auto/manual modes, and values.`,relationship:"description",children:e.exports.jsx("button",{className:`${M} ${J}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(p,{})})})]})}),e.exports.jsx("div",{className:re,children:e.exports.jsx("hr",{className:B})})]}),e.exports.jsxs("div",{className:V,children:[he&&0===xe.length&&e.exports.jsxs("div",{className:K,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(o,{size:200,weight:"regular",children:"Loading holidays..."})]}),!ie&&!he&&e.exports.jsx("div",{className:O,children:e.exports.jsxs("div",{className:te,children:[e.exports.jsx(o,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(o,{size:200,children:"Please select a device from the tree to view holidays"})]})}),ie&&!he&&e.exports.jsxs("div",{ref:Te,className:P,onScroll:Pe,onWheel:Ge,children:[e.exports.jsxs(y,{items:Oe,columns:Xe,sortable:!0,resizableColumns:!0,columnSizingOptions:{holidayId:{minWidth:60,idealWidth:100},fullLabel:{minWidth:150,idealWidth:200},autoManual:{minWidth:100,idealWidth:130},value:{minWidth:80,idealWidth:100},label:{minWidth:90,idealWidth:130}},children:[e.exports.jsx(f,{children:e.exports.jsx(N,{children:({renderHeaderCell:s})=>e.exports.jsx(g,{children:s()})})}),e.exports.jsx(C,{children:({item:s,rowId:l})=>e.exports.jsx(N,{children:({renderCell:l})=>e.exports.jsx(I,{children:l(s)})},l)})]}),Re&&e.exports.jsxs("div",{className:G,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(o,{children:"Loading next device..."})]})]})]})]})})})})})};export{ie as HolidaysPage};

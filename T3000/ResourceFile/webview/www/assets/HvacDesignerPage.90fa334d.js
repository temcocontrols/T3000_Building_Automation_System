var e,i,o,n,s=Object.defineProperty,a=(t,e,i)=>(((t,e,i)=>{e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);import{j as r}from"./react.8639cc86.js";import{r as l}from"./client.58f92968.js";import{l as h}from"./T3Data.63f93fe7.js";import{aw as c,ax as p,j as d,a as u,ak as g,aa as y,d as S,g as m,h as b,k as f,ab as x,bl as C,o as P,K as O,bm as v,as as w,f as k,i as L,ai as A,bn as I,bo as E,bp as F,bq as G,br as R,aO as j,bs as B,bt as M,bu as H,bv as _,bw as U,bx as N,by as V,aG as z,bk as W,bz as K,bA as Y,Y as X,bB as q,bC as J,aV as Z,aW as Q,bD as tt,b0 as et,aX as it,aY as ot,aZ as nt,bE as st,bF as at,bG as rt,bH as lt,bI as ht,bJ as ct,bK as pt,bL as dt,bM as ut,at as gt,bN as yt,au as St,aH as mt,s as bt,bO as Dt,bP as ft,bQ as xt,bR as Ct,aT as Pt,Q as Tt,bS as Ot,p as vt,bT as wt,S as kt,T as Lt,B as At,bU as It,aR as Et,bV as Ft,bW as Gt}from"./App.7c34790a.js";import{$ as Rt,T as jt,p as Bt,b as Mt,a as Ht}from"./index.cec6b9d9.js";import{X as _t}from"./index.3bd6c859.js";import{am as Ut,al as Nt}from"./index.af4b72c2.js";import{k as Vt}from"./index.d11c4764.js";import"./_commonjsHelpers.a5007c1f.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./AntdIcon.b18ae2a5.js";const zt=c(void 0),Wt={openItems:[],collapsible:!1,multiple:!1,navigation:void 0,requestToggle(){}},{Provider:Kt}=zt,Yt=t=>p(zt,((e=Wt)=>t(e))),Xt=(t,e)=>{const{openItems:i,defaultOpenItems:o,multiple:n=!1,collapsible:s=!1,onToggle:a,navigation:r,...h}=t,[c,p]=u({state:l.exports.useMemo((()=>function(t){if(void 0===t)return;return Array.isArray(t)?t:[t]}(i)),[i]),defaultState:o&&(()=>function({defaultOpenItems:t,multiple:e}){if(void 0!==t)return Array.isArray(t)?e?t:[t[0]]:[t];return[]}({defaultOpenItems:o,multiple:n})),initialState:[]}),d=g({circular:"circular"===r,tabbable:!0}),b=y((t=>{const e=function(t,e,i,o){if(!i)return e[0]===t&&o?[]:[t];if(!e.includes(t))return[...e,t].sort();if(e.length>1||o)return e.filter((e=>e!==t));return e}(t.value,c,n,s);null==a||a(t.event,{value:t.value,openItems:e}),p(e)}));return{collapsible:s,multiple:n,navigation:r,openItems:c,requestToggle:b,components:{root:"div"},root:S(m("div",{...h,...r?d:void 0,ref:e}),{elementType:"div"})}};const qt="fui-Accordion",Jt=l.exports.forwardRef(((t,e)=>{const i=Xt(t,e),o=function(t){const{navigation:e,openItems:i,requestToggle:o,multiple:n,collapsible:s}=t;return{accordion:{navigation:e,openItems:i,requestToggle:o,collapsible:s,multiple:n}}}(i);return(t=>{t.root.className=b(qt,t.root.className)})(i),f("useAccordionStyles_unstable")(i),((t,e)=>d(t.root,{children:d(Kt,{value:e.accordion,children:t.root.children})}))(i,o)}));Jt.displayName="Accordion";const $t=l.exports.createContext(void 0),Zt={open:!1,disabled:!1,value:void 0,onHeaderClick(){}},{Provider:Qt}=$t,te=()=>{var t;return null!==(t=l.exports.useContext($t))&&void 0!==t?t:Zt},ee="fui-AccordionItem",ie=l.exports.forwardRef(((t,e)=>{const i=((t,e)=>{const{value:i,disabled:o=!1}=t,n=Yt((t=>t.requestToggle)),s=Yt((t=>t.openItems.includes(i))),a=y((t=>n({event:t,value:i})));return{open:s,value:i,disabled:o,onHeaderClick:a,components:{root:"div"},root:S(m("div",{ref:e,...t}),{elementType:"div"})}})(t,e),o=function(t){const{disabled:e,open:i,value:o,onHeaderClick:n}=t;return{accordionItem:l.exports.useMemo((()=>({disabled:e,open:i,value:o,onHeaderClick:n})),[e,i,o,n])}}(i);return(t=>{t.root.className=b(ee,t.root.className)})(i),f("useAccordionItemStyles_unstable")(i),((t,e)=>d(t.root,{children:d(Qt,{value:e.accordionItem,children:t.root.children})}))(i,o)}));ie.displayName="AccordionItem";const oe=l.exports.createContext(void 0),{Provider:ne}=oe,se="fui-AccordionHeader",ae="fui-AccordionHeader__button",re="fui-AccordionHeader__expandIcon",le="fui-AccordionHeader__icon",he=L({resetButton:{B7ck84d:"f1e4lqlz",De3pzq:"f1u2r49w",sj55zd:"f1ym3bx4",Bahqtrf:"f1mo0ibp",Be2twd7:"fjoy568",Bg96gwp:"fytdu2e",B68tc82:0,Bmxbyg5:0,Bpg54ce:"f1gl81tg",Byoj8tv:0,uwmqm3:0,z189sj:0,z8tnut:0,B0ocmuz:"f1mk8lai",Bv0vk6g:"f37px4s",fsow6f:"fgusgyc"},focusIndicator:{Brovlpu:"ftqa4ok",B486eqv:"f2hkw1w",B8q5s1w:"f8hki3x",Bci5o5g:["f1d2448m","ffh67wi"],n8qw10:"f1bjia2o",Bdrgwmp:["ffh67wi","f1d2448m"],Bb7d1vk:"f226i61",zhwhgb:["f13kzufm","fsx75g8"],dhy2o1:"flujwa2",Gfyso:["fsx75g8","f13kzufm"],Bm4h7ae:"f15bsgw9",B7ys5i9:"f14e48fq",Busjfv9:"f18yb2kv",Bhk32uz:"fd6o370",f6g5ot:0,Boxcth7:0,Bhdgwq3:0,hgwjuy:0,Bshpdp8:0,Bsom6fd:0,Blkhhs4:0,Bonggc9:0,Ddfuxk:0,i03rao:0,kclons:0,clg4pj:0,Bpqj9nj:0,B6dhp37:0,Bf4ptjt:0,Bqtpl0w:0,i4rwgc:"ffwy5si",Dah5zi:0,B1tsrr9:0,qqdqy8:0,Bkh64rk:0,e3fwne:"f3znvyf",J0r882:"f57olzd",Bule8hv:["f4stah7","fs1por5"],Bjwuhne:"f480a47",Ghsupd:["fs1por5","f4stah7"]},root:{sj55zd:"f19n0e5",De3pzq:"f1c21dwh",jrapky:0,Frg6f3:0,t21cq0:0,B6of3ja:0,B74szlk:"f1s184ao",Beyfa6y:0,Bbmb7ep:0,Btl43ni:0,B7oj6ja:0,Dimara:"ft85np5"},rootDisabled:{Bcmaq0h:"fwrgwhw",sj55zd:"f1s2aq7o"},rootInline:{mc9l5x:"f14t3ns0"},button:{qhf8xq:"f10pi13n",a9b677:"fly5x3f",B4j52fo:"fre7gi1",Bekrc4i:["f1358rze","f1rvrf73"],Bn0qgzm:"fqdk4by",ibv6hh:["f1rvrf73","f1358rze"],Byoj8tv:0,uwmqm3:0,z189sj:0,z8tnut:0,B0ocmuz:["f1rmphuq","f26yw9j"],sshi5w:"f5pgtk9",mc9l5x:"f22iagw",Bt984gj:"f122n59",Bceei9c:"f1k6fduh",Bahqtrf:"fk6fouc",Be2twd7:"fkhj508",Bhrd7zp:"figsok6",Bg96gwp:"f1i3iumi",B7ck84d:"f1ewtqcl"},buttonSmall:{sshi5w:"f1nxs5xn",Be2twd7:"fy9rknc"},buttonLarge:{Bg96gwp:"faaz57k",Be2twd7:"fod5ikn"},buttonExtraLarge:{Bg96gwp:"f106mvju",Be2twd7:"f1pp30po"},buttonInline:{mc9l5x:"ftuwxu6"},buttonExpandIconEndNoIcon:{uwmqm3:["f1uw59to","fw5db7e"]},buttonExpandIconEnd:{z189sj:["f11gcy0p","f1ng84yb"]},buttonDisabled:{Bceei9c:"fdrzuqr"},expandIcon:{Bqenvij:"f1l02sjl",mc9l5x:"f22iagw",Bt984gj:"f122n59",Bg96gwp:"f106mvju",Be2twd7:"f1pp30po"},expandIconStart:{z189sj:["f1vdfbxk","f1f5gg8d"]},expandIconEnd:{Bh6795r:"fqerorx",Bnnss6s:"f1neuvcm",xawz:"flqd7gy",mc9l5x:"f22iagw",Brf1p80:"f9c4gz4",uwmqm3:["f1f5gg8d","f1vdfbxk"]},icon:{Bqenvij:"f1l02sjl",mc9l5x:"f22iagw",Bt984gj:"f122n59",z189sj:["f1vdfbxk","f1f5gg8d"],Bg96gwp:"f106mvju",Be2twd7:"f1pp30po"}},{d:[".f1e4lqlz{box-sizing:content-box;}",".f1u2r49w{background-color:inherit;}",".f1ym3bx4{color:inherit;}",".f1mo0ibp{font-family:inherit;}",".fjoy568{font-size:inherit;}",".fytdu2e{line-height:normal;}",[".f1gl81tg{overflow:visible;}",{p:-1}],[".f1mk8lai{padding:0;}",{p:-1}],".f37px4s{-webkit-appearance:button;}",".fgusgyc{text-align:unset;}",".f8hki3x[data-fui-focus-visible]{border-top-color:transparent;}",".f1d2448m[data-fui-focus-visible]{border-right-color:transparent;}",".ffh67wi[data-fui-focus-visible]{border-left-color:transparent;}",".f1bjia2o[data-fui-focus-visible]{border-bottom-color:transparent;}",'.f15bsgw9[data-fui-focus-visible]::after{content:"";}',".f14e48fq[data-fui-focus-visible]::after{position:absolute;}",".f18yb2kv[data-fui-focus-visible]::after{pointer-events:none;}",".fd6o370[data-fui-focus-visible]::after{z-index:1;}",[".ffwy5si[data-fui-focus-visible]::after{border:2px solid var(--colorStrokeFocus2);}",{p:-2}],[".f3znvyf[data-fui-focus-visible]::after{border-radius:var(--borderRadiusMedium);}",{p:-1}],".f57olzd[data-fui-focus-visible]::after{top:calc(2px * -1);}",".f4stah7[data-fui-focus-visible]::after{right:calc(2px * -1);}",".fs1por5[data-fui-focus-visible]::after{left:calc(2px * -1);}",".f480a47[data-fui-focus-visible]::after{bottom:calc(2px * -1);}",".f19n0e5{color:var(--colorNeutralForeground1);}",".f1c21dwh{background-color:var(--colorTransparentBackground);}",[".f1s184ao{margin:0;}",{p:-1}],[".ft85np5{border-radius:var(--borderRadiusMedium);}",{p:-1}],".fwrgwhw{background-image:none;}",".f1s2aq7o{color:var(--colorNeutralForegroundDisabled);}",".f14t3ns0{display:inline-block;}",".f10pi13n{position:relative;}",".fly5x3f{width:100%;}",".fre7gi1{border-top-width:0;}",".f1358rze{border-right-width:0;}",".f1rvrf73{border-left-width:0;}",".fqdk4by{border-bottom-width:0;}",[".f1rmphuq{padding:0 var(--spacingHorizontalM) 0 var(--spacingHorizontalMNudge);}",{p:-1}],[".f26yw9j{padding:0 var(--spacingHorizontalMNudge) 0 var(--spacingHorizontalM);}",{p:-1}],".f5pgtk9{min-height:44px;}",".f22iagw{display:flex;}",".f122n59{align-items:center;}",".f1k6fduh{cursor:pointer;}",".fk6fouc{font-family:var(--fontFamilyBase);}",".fkhj508{font-size:var(--fontSizeBase300);}",".figsok6{font-weight:var(--fontWeightRegular);}",".f1i3iumi{line-height:var(--lineHeightBase300);}",".f1ewtqcl{box-sizing:border-box;}",".f1nxs5xn{min-height:32px;}",".fy9rknc{font-size:var(--fontSizeBase200);}",".faaz57k{line-height:var(--lineHeightBase400);}",".fod5ikn{font-size:var(--fontSizeBase400);}",".f106mvju{line-height:var(--lineHeightBase500);}",".f1pp30po{font-size:var(--fontSizeBase500);}",".ftuwxu6{display:inline-flex;}",".f1uw59to{padding-left:var(--spacingHorizontalM);}",".fw5db7e{padding-right:var(--spacingHorizontalM);}",".f11gcy0p{padding-right:var(--spacingHorizontalMNudge);}",".f1ng84yb{padding-left:var(--spacingHorizontalMNudge);}",".fdrzuqr{cursor:not-allowed;}",".f1l02sjl{height:100%;}",".f1vdfbxk{padding-right:var(--spacingHorizontalS);}",".f1f5gg8d{padding-left:var(--spacingHorizontalS);}",".fqerorx{flex-grow:1;}",".f1neuvcm{flex-shrink:1;}",".flqd7gy{flex-basis:0%;}",".f9c4gz4{justify-content:flex-end;}"],f:[".ftqa4ok:focus{outline-style:none;}"],i:[".f2hkw1w:focus-visible{outline-style:none;}"],m:[["@media (forced-colors: active){.f226i61[data-fui-focus-visible]::after{border-top-color:Highlight;}}",{m:"(forced-colors: active)"}],["@media (forced-colors: active){.f13kzufm[data-fui-focus-visible]::after{border-right-color:Highlight;}.fsx75g8[data-fui-focus-visible]::after{border-left-color:Highlight;}}",{m:"(forced-colors: active)"}],["@media (forced-colors: active){.flujwa2[data-fui-focus-visible]::after{border-bottom-color:Highlight;}}",{m:"(forced-colors: active)"}]]});const ce=l.exports.forwardRef(((t,e)=>{const i=((t,e)=>{const{icon:i,button:o,expandIcon:n,inline:s=!1,size:a="medium",expandIconPosition:r="start"}=t,{value:h,disabled:c,open:p}=te(),d=Yt((t=>t.requestToggle)),u=Yt((t=>!t.collapsible&&1===t.openItems.length&&p)),{dir:g}=x();let b;b="end"===r?p?-90:90:p?90:"rtl"!==g?0:180;const D=S(o,{elementType:"button",defaultProps:{disabled:c,disabledFocusable:u,"aria-expanded":p,type:"button"}});return D.onClick=y((t=>{var e;C(o)&&(null===(e=o.onClick)||void 0===e||e.call(o,t)),t.defaultPrevented||d({value:h,event:t})})),{disabled:c,open:p,size:a,inline:s,expandIconPosition:r,components:{root:"div",button:"button",expandIcon:"span",icon:"div"},root:S(m("div",{ref:e,...t}),{elementType:"div"}),icon:P(i,{elementType:"div"}),expandIcon:P(n,{renderByDefault:!0,defaultProps:{children:l.exports.createElement(O,{style:{transform:`rotate(${b}deg)`,transition:`transform ${v.durationNormal}ms ease-out`}}),"aria-hidden":!0},elementType:"span"}),button:w(D.as,D)}})(t,e),o=function(t){const{disabled:e,expandIconPosition:i,open:o,size:n}=t;return{accordionHeader:l.exports.useMemo((()=>({disabled:e,expandIconPosition:i,open:o,size:n})),[e,i,o,n])}}(i);return(t=>{const e=he();t.root.className=b(se,e.root,t.inline&&e.rootInline,t.disabled&&e.rootDisabled,t.root.className),t.button.className=b(ae,e.resetButton,e.button,e.focusIndicator,"end"===t.expandIconPosition&&!t.icon&&e.buttonExpandIconEndNoIcon,"end"===t.expandIconPosition&&e.buttonExpandIconEnd,t.inline&&e.buttonInline,"small"===t.size&&e.buttonSmall,"large"===t.size&&e.buttonLarge,"extra-large"===t.size&&e.buttonExtraLarge,t.disabled&&e.buttonDisabled,t.button.className),t.expandIcon&&(t.expandIcon.className=b(re,e.expandIcon,"start"===t.expandIconPosition&&e.expandIconStart,"end"===t.expandIconPosition&&e.expandIconEnd,t.expandIcon.className)),t.icon&&(t.icon.className=b(le,e.icon,t.icon.className))})(i),f("useAccordionHeaderStyles_unstable")(i),((t,e)=>d(ne,{value:e.accordionHeader,children:d(t.root,{children:k(t.button,{children:["start"===t.expandIconPosition&&t.expandIcon&&d(t.expandIcon,{}),t.icon&&d(t.icon,{}),t.root.children,"end"===t.expandIconPosition&&t.expandIcon&&d(t.expandIcon,{})]})})}))(i,o)}));ce.displayName="AccordionHeader";const pe="fui-AccordionPanel",de=L({root:{jrapky:0,Frg6f3:0,t21cq0:0,B6of3ja:0,B74szlk:"f1axvtxu"}},{d:[[".f1axvtxu{margin:0 var(--spacingHorizontalM);}",{p:-1}]]}),ue=l.exports.forwardRef(((t,e)=>{const i=((t,e)=>{const{open:i}=te(),o=A({focusable:{excludeFromMover:!0}}),n=Yt((t=>t.navigation));return{open:i,components:{root:"div",collapseMotion:I},root:S(m("div",{ref:e,...t,...n&&o}),{elementType:"div"}),collapseMotion:E(t.collapseMotion,{elementType:I,defaultProps:{visible:i,unmountOnExit:!0}})}})(t,e);return(t=>{const e=de();t.root.className=b(pe,e.root,t.root.className)})(i),f("useAccordionPanelStyles_unstable")(i),(t=>t.collapseMotion?d(t.collapseMotion,{children:d(t.root,{})}):d(t.root,{}))(i)}));ue.displayName="AccordionPanel";class ge{}a(ge,"Default",{Environment:"prod"}),a(ge,"DocumentAreaModel",{LEFT_PANEL_ID:"left-panel",LEFT_PANEL_WIDTH:105,WORK_AREA_ID:"work-area",WORK_AREA_PADDING_LEFT:105}),a(ge,"LogConfig",{Debug:void 0,Info:void 0,Error:void 0,FileLogging:void 0}),a(ge,"T3Config",{log:{},Zoom:{Step:.25,Min:.25,Max:4,Default:1}});class ye{}a(ye,"clipboard"),a(ye,"currentObjSeqId"),a(ye,"docUtil"),a(ye,"opt"),a(ye,"wallOpt"),a(ye,"maxUndo",25),a(ye,"state"),a(ye,"stdObj"),a(ye,"userSetting"),a(ye,"Evt_ShapeDragStart"),a(ye,"Evt_LMShapeHold"),a(ye,"Evt_LMShapeDoubleTap"),a(ye,"Evt_StampObjectDragEnd"),a(ye,"Evt_LMMouseStpObjectDone"),a(ye,"arrowHlkTable",[]),a(ye,"arrowHsTable",[]),a(ye,"gFmtTextObj"),a(ye,"quasar");class Se{}a(Se,"TextElemLastOpt",{Init:-1,Char:0,BS:1,DEL:2,Style:3,Cut:4,Copy:5,Paste:6,Select:7,Timeout:8}),a(Se,"RulerUnit",{None:0,Inches:1,Feet:2,Mm:3,Cm:4,M:5}),a(Se,"Colors",{White:"#FFFFFF",Black:"#000000",Hilite:"#0099FF",Select:"#00FF00",Trans:4294967295,Gray:"#C0C0C0"}),a(Se,"FillTypes",{Transparent:0,Solid:1,Gradient:2,Texture:3,Image:4,RichGradient:5}),a(Se,"GraphType",{Unset:-1,Bar:0,StackedBar:1,Line:2,Pie:3,LineArpie:4,StackedLine:5}),a(Se,"GraphFlags",{SequenceByCategory:4}),a(Se,"AxisFlags",{DaxHideMinorTicks:4,DaxShowGridLineMajor:32}),a(Se,"LegendType",{DaxLegendFull:0,DaxLegendNone:1,DaxLegendNames:2,DaxLegendSwatches:3}),a(Se,"HopDimX",[6,8,10]),a(Se,"HopDimY",[4,5,6]),a(Se,"HopStyle",{Box:0,Arc:1}),a(Se,"DimensionFlags",{EndPts:1,AllSeg:2,Total:4,Select:8,Always:16,Area:32,AreaSel:64,Standoff:128,Exterior:256,ShowFractionalInches:512,RectWithAndHeight:1024,ShowLineAngles:2048,InteriorAngles:4096,HideHookedObjDimensions:8192,ShowFeetAsInches:16384}),a(Se,"TextGrowBehavior",{ProPortional:0,Horizontal:1,Vertical:2,FSize:3}),a(Se,"StyleDefaults",{Default:"Style1",DefThick:1,DefFont:"Arial"}),a(Se,"LayerFlags",{Visible:1,Active:2,NoAdd:4,AllowCellEdit:8,UseEdges:16}),a(Se,"LayerTypes",{None:0,WebPage:4,Background:7}),a(Se,"LayerMoveType",{Bottom:0,Before:1,After:2,Top:3}),a(Se,"ContainerListArrangements",{Row:0,Column:1}),a(Se,"ContainerListFlags",{AllowOnlyContainers:1,AllowOnlyNonContainers:2,Sparse:4,LeftChanged:8,TopChanged:16,Adjust:32}),a(Se,"EditState",{Default:1,Stamp:2,Text:3,FormatPaint:4,LinkConnect:5,LinkJoin:6,Edit:7,DragControl:8,DragShape:9,Grab:10}),a(Se,"Geometry",{PI:3.14159265358979}),a(Se,"ObjFlags",{Select:1,Hide:2,Erase:4,EraseOnGrow:8,Lock:16,Bounds:128,ImageOnly:256,TextOnly:512,Assoc:8192,Obj1:16384,ContConn:32768,UseConnect:131072,DropOnBorder:262144,DropOnTable:524288,LineHop:1048576,LineMod:2097152,NoTableLink:4194304,NoLinking:16777216,NotVisible:268435456,NoMaintainLink:536870912}),a(Se,"TextFlags",{AttachB:4,AttachA:8,None:16,AttachC:32,HorizText:128,OneClick:512,FormCR:2048,NoSpell:4096,Clickhere:8192,AttachD:16384,TitleBlock:32768}),a(Se,"SessionMoreFlags",{NoActionButton:16,HideLayerTabs:1024}),a(Se,"HookFlags",{LcShape:1,LcLine:2,LcHOnly:4,LcVOnly:8,LcCHook:16,LcArrayMod:32,LcMoveTarget:128,LcAttachToLine:256,LcNoSnaps:512,LcShapeOnLine:1024,LcAutoInsert:8192,LcForceEnd:16384,LcHookNoExtra:131072,LcHookReverse:262144,LcNoContinuous:524288,LcTableRows:1048576}),a(Se,"ListCodes",{CircTarg:1,MoveTarg:2,MoveHook:3,TargOnly:4,ChildrenOnly:5,TopOnly:6,LinesOnly:7,MoveTargAndLines:8}),a(Se,"FloatingPointDim",{Width:16,Height:32}),a(Se,"HitCodes",{Border:40,Inside:41,PLApp:73,InContainer:101}),a(Se,"GuideDistanceTypes",{Room:1,Horizontal_Wall:2,Vertical_Wall:3,PolyWall:4}),a(Se,"SegLDir",{Ktc:5,Kbc:6,Klc:7,Krc:8}),a(Se,"FNObjectTypes",{None:0,PictContainer:1,Frame:2,CauseEffectMain:9,FlWall:16,Annotation:32,UiElement:33,NgEvent:35,NgEventLabel:36,D3Symbol:37,Multiplicity:39,ShapeContainer:55,FrameContainer:75,ExtraTextLable:80,GanttBar:10}),a(Se,"ObjectSubTypes",{SubtMultiplicityFilpped:80}),a(Se,"ImageScales",{AlwaysFit:0,CropToFit:1,PropFit:2});class me{}a(me,"CSType",{Rect:1,RRect:2,Oval:3,Line:4,Polyline:5,Polygon:6,Path:7,Text:8,Image:9,Group:10,Layer:11,Symbol:12,PolylineContainer:13,PolyPolyline:14,ShapeCopy:15,ShapeContainer:16,ForeignObject:17}),a(me,"ShapeType",{Rect:"Rect",RRect:"RRect",Oval:"Oval",Polygon:"Polygon",VectorSymbol:"VectorSymbol",BitmapSymbol:"BitmapSymbol",GroupSymbol:"GroupSymbol",SvgSymbol:"SvgSymbol",D3Symbol:"D3Symbol",ForeignObject:"ForeignObject"}),a(me,"EventBehavior",{Normal:"visiblePainted",Inside:"visibleFill",Outside:"visibleStroke",ALL:"visible",Hidden:"painted",HiddenIn:"fill",HiddenOut:"stroke",HiddenAll:"all",None:"none"}),a(me,"ExportType",{None:0,PNG:2,SVG:3,JPEG:13}),a(me,"LineTypes",{LsNone:0,LsComm:1,LsDigi:2,LsChord:3,LsWall:4,LsMeasuringTape:5}),a(me,"SVGPathSeg",{PATHSEG_UNKNOWN:0,PATHSEG_CLOSEPATH:1,PATHSEG_MOVETO_ABS:2,PATHSEG_MOVETO_REL:3,PATHSEG_LINETO_ABS:4,PATHSEG_LINETO_REL:5,PATHSEG_CURVETO_CUBIC_ABS:6,PATHSEG_CURVETO_CUBIC_REL:7,PATHSEG_CURVETO_QUADRATIC_ABS:8,PATHSEG_CURVETO_QUADRATIC_REL:9,PATHSEG_ARC_ABS:10,PATHSEG_ARC_REL:11,PATHSEG_LINETO_HORIZONTAL_ABS:12,PATHSEG_LINETO_HORIZONTAL_REL:13,PATHSEG_LINETO_VERTICAL_ABS:14,PATHSEG_LINETO_VERTICAL_REL:15,PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:16,PATHSEG_CURVETO_CUBIC_SMOOTH_REL:17,PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:18,PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:19}),a(me,"LineType",{LINE:1,ARCLINE:2,SEGLINE:3,ARCSEGLINE:4,POLYLINE:5,PARABOLA:6,FREEHAND:7,NURBS:501,NURBSSEG:502,ELLIPSE:503,ELLIPSEEND:504,QUADBEZ:505,QUADBEZCON:506,CUBEBEZ:507,CUBEBEZCON:508,SPLINE:509,SPLINECON:510,MOVETO:600,MOVETO_NEWPOLY:601}),a(me,"ArcQuad",{PLA_TL:0,PLA_BL:1,PLA_BR:2,PLA_TR:3}),a(me,"ObjMoreFlags",{FixedRR:64,Container:128,UseInfoNoteIcon:256,ContainerChild:512,AutoContainer:1024,FrameAllowNesting:2048,FrameGroup:4096}),a(me,"Common",{EdgeSlop:5,DimMax:3e4,MetricConv:2.54,ConnPointDim:7,ConnPointLineDim:16,JoinPointLineDim:32,MinWidth:1,MaxPolyPoints:100,RoundFactor:.292893218,LongIntMax:2147483647,HorizOnly:1,VertOnly:2,SegMinLen:4,SegMinSeg:4,SegDefLen:25,Slop:7,SlopShapeExtra:10,ConnectorSlop:25,FlowConnectorSlop:75,FlowRadialSlop:150,FlowConnectorDisp:50,KnobSize:9,RKnobSize:7,CKnobSize:14,MinDim:4,Action:"act_",HitAreas:"hitareas_",GraphTextHit:"graph_texthit",EllipseAxes:"axes_",MaxPolySegs:500,MaxSteps:100,DimDefaultStandoff:25,DimDefaultNonStandoff:5,DimDefaultTextGap:3,DimLineColor:"#000000",CoordinateLineDefaultStandoff:-2.5,CoordinateLineDefaultNonStandoff:0,CoordinateLineDefaultTextGap:3,CoordinateLineColor:"blue",FindObjectMinHitSpot:5,DefTextMargin:2,TextBlockStyle:"Text Block",DefMargin:50,DNull:4294967295,DefRRect:.2,DefFixedRRect:.05,ShapeWidth:120,ShapeHeight:50,ShapeSquare:60,MaxHops:32,MaxWorkDimX:32e4,MaxWorkDimY:32e4,CITreeSpaceExtra:16,ConPlusPath:"plus.svg",ConMinusPath:"minus.svg",ConMoveVerticalPath:"move-vertical.svg",ConMoveHorizontalPath:"move-horizontal.svg",WallOpenId:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",ActionArrowSizeH:20,ActionArrowSizeV:13,BaseArrowSlop:7,ConnectorArrowSlop:25,MinSidePointLength:40,DefaultRulerMajor:100,AnnoHotDist:200,RRectFixedDim:100,MinLineDisDeterminOri:.2,IconShapeBottomOffset:2,iconShapeRightOffset:2,DefaultLayerName:"Layer-1",PenStylingDefault:{Line:{Thickness:1,Paint:{Opacity:1,Color:"#000000",FillType:1}}},HighlighterStylingDefault:{Line:{Thickness:5,Paint:{Opacity:.35,Color:"#FFE536",FillType:1}}},MaxTotalLayers:32,MaxLongDim:1e7,MinLineDrawGap:20}),a(me,"ExtraFlags",{NoColor:1,FlipHoriz:8,FlipVert:16,NoRotate:32,SideKnobs:1048576,ConnToConn:2097152,NoDelete:8388608,CollapseConn:134217728,DeleteOnUnhook:2147483648}),a(me,"DrawObjectBaseClass",{Shape:0,Line:1,Connector:3}),a(me,"ActionArrow",{Up:1,Left:2,Down:3,Right:4,Slop:5,Custom:6,Enter:7,CoManger:8,Assistant:9,AddParents:10,AddDescendants:11}),a(me,"SVGElementClass",{Shape:1,Slop:2,Hatch:3,Text:4,TextBackground:5,DimText:6,DimLine:7,BackgroundImage:8,Icon:9,NoteText:10,ActionArrow:11,DimTextNoEdit:12,AreaDimLine:13,CoordinateLine:21}),a(me,"ContentType",{None:1,Text:2,Table:3}),a(me,"GrowBehavior",{All:0,Horiz:1,Vertical:2,ProPortional:3}),a(me,"LineOrientation",{None:1,Horizontal:2,Vertical:3,DiagonalTLRB:4,DiagonalTRBL:5}),a(me,"HitAreaType",{ConnCollapse:1,ConnExpand:2,EditDimText:3}),a(me,"ShapeIconType",{HyperLink:"HYPERLINK",Notes:"NOTES",Attachment:"ATTACHMENT",FieldData:"FIELDDATA",ExpandTable:"EXPANDTABLE",CollapseTable:"COLLAPSETABLE",DataAction:"DATAACTION",ExpandedView:"EXPANDEDVIEW",Comment:"COMMENT"}),a(me,"ActionTriggerType",{TopLeft:1,TopCenter:2,TopRight:3,CenterRight:4,BottomRight:5,BottomCenter:6,BottomLeft:7,CenterLeft:8,Rotate:9,ModifyShape:10,LineStart:11,LineEnd:12,AttachPoint:13,SeglOne:14,SeglTwo:15,SeglThree:16,PolyNode:17,PolyAdj:18,PolyEnd:19,ConnectorHook:20,ConnectorRerp:21,ConnectorAdj:22,MovePolySeg:23,Flip:24,LineLength:31,SeglPreserve:32,LineThickness:33,DimLineAdj:34,UpdateLinks:35,ContainerAdj:36,TableSelect:27}),a(me,"CollabSVGEventTypes",{ObjectMove:1,ShapeGrow:2,TableGrowColumn:3,TextEntry:4}),a(me,"LineAngleDimensionDefs",{ArrowHeadSize:10,ArrowHeadWidth:4,PreferredArrowStemMin:4,PreferredBisectorLen:75}),a(me,"ArrayFlags",{LeaveACl:1,LeaveACr:1}),a(me,"AStyles",{StartLeft:1,BothSides:2,Stagger:4,PerpConn:8,Linear:16,Radial:32,ReverseCol:64,EndConn:128,MinZero:256,CoManager:512,FlowConn:1024,GenoConn:2048,MatchSize:4096,MinInvisible:8192,MinOne:16384,Timeline:32768}),a(me,"ConnectorDefines",{DefaultHt:25,DefaultWd:25,ABk:0,ACl:1,ACr:2,NSkip:3,StubHookPt:-3,Normal:0,Above:-2,Below:-3,Parent:-4}),a(me,"SessionFlags",{LLink:8,SLink:16,AttLink:256,FreeHand:1024,NoTreeOverlap:2048,AllowHops:4096,AutoFormat:524288,HideConnExpand:1048576,IsFlowChart:2097152,NoStepFormatting:1073741824}),a(me,"HeaderFlags",{Pages:1024,NoAuto:4096,ShowRulers:65536,ShowGrid:131072,SnapToGridTL:262144,SnapToGridC:524288,SnapToShapesOff:1048576,ShowPageDividers:2097152,AutoGrowTopLeft:4194304}),a(me,"HookPts",{KTL:1,KTR:2,KTC:5,KBC:6,KLC:7,KRC:8,LL:20,LR:21,LT:22,LB:23,KCTL:201,KCTR:202,KCBL:203,KCBR:204,KCT:205,KCB:206,KCL:207,KCR:208,KCC:209,KAT:220,KATD:221,AK:300,AKCT:305,AKCB:306,AKCL:307,AKCR:308,WTL:321,WTR:322,WBL:323,WBR:324,CustomBase:500}),a(me,"LineSubclass",{LCH:0,LCD:1,LCV:2}),a(me,"SeglTypes",{Line:0,Arc:1}),a(me,"OptTypes",{None:0,Stamp:1,Draw:2,DragDrop:3,StampTextOnTap:4,AddCorner:5,DrawPolyline:6,FormatPainter:7,SplitWall:8});class be{constructor(){a(this,"useInches"),a(this,"majorScale"),a(this,"units"),a(this,"nTics"),a(this,"nMid"),a(this,"nGrid"),a(this,"originx"),a(this,"originy"),a(this,"major"),a(this,"metricConv"),a(this,"dp"),a(this,"showpixels"),a(this,"denom"),this.useInches=!0,this.majorScale=1,this.units=Se.RulerUnit.Inches,this.nTics=12,this.nMid=1,this.nGrid=12,this.originx=0,this.originy=0,this.major=me.Common.DefaultRulerMajor,this.metricConv=me.Common.MetricConv,this.dp=2,this.showpixels=!1,this.denom=1}}class De{constructor(t,e){a(this,"x"),a(this,"y"),this.x=t||0,this.y=e||0}}const fe=class{constructor(t){a(this,"element"),a(this,"width"),a(this,"height"),this.element=t,this.width=0,this.height=0}static DefineColor(t,e,i){return t=Math.min(255,Math.max(0,t)),e=Math.min(255,Math.max(0,e)),i=Math.min(255,Math.max(0,i)),"#"+t.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")+i.toString(16).padStart(2,"0")}static CalcImageSize(t,e,i,o){const n=ye.docUtil?ye.docUtil.svgDoc:null,s=fe.GetCachedImageSize(t);if(s)return n&&n.ImageLoadAddRef(),void setTimeout((()=>{e(s.width,s.height,null,i),n&&n.ImageLoadDecRef()}),0);void 0===o&&(o="SVG"===t.slice(-3).toUpperCase()),fe.imageSizeRequest=fe.imageSizeRequest||{};const a=t.toUpperCase();fe.imageSizeRequest[a]?fe.imageSizeRequest[a].push({callback:e,data:i}):(fe.imageSizeRequest[a]=[{callback:e,data:i}],o?fe.GetSVGDimensions(t):fe.GetBitmapDimensions(t,e,i))}static CacheImageSize(t,e,i){fe.imageSizeCache=fe.imageSizeCache||{},fe.imageSizeCache[t.toUpperCase()]={width:e,height:i}}static GetCachedImageSize(t){return fe.imageSizeCache&&fe.imageSizeCache[t.toUpperCase()]||null}static ProcessImageSizeRequest(t,e,i,o){if(fe.imageSizeRequest){const n=t.toUpperCase(),s=fe.imageSizeRequest[n];if(s){delete fe.imageSizeRequest[n];for(let t=0;t<s.length;t++){const n=s[t];n&&n.callback&&n.callback(e,i,o,n.data)}}}}static GetBitmapDimensions(t,e,i){const o=new Image,n=ye.docUtil?ye.docUtil.svgDoc:null;n&&n.ImageLoadAddRef(),o.onload=function(){this.width&&this.height?(fe.CacheImageSize(t,this.width,this.height),fe.ProcessImageSizeRequest(t,this.width,this.height,null),e&&e(this.width,this.height,null,i)):(n&&n.ImageLoadDecRef(),fe.GetSVGDimensions(t,e,i)),n&&n.ImageLoadDecRef()},o.onerror=function(o){fe.ProcessImageSizeRequest(t,0,0,{success:!1}),e&&e(0,0,{success:!1},i),n&&n.ImageLoadDecRef()},o.src=t}static GetSVGDimensions(t,e,i){const o=ye.docUtil?ye.docUtil.svgDoc:null;o&&o.ImageLoadAddRef(),Rt.ajax({type:"GET",url:t,async:!0,contentType:"image/svg",dataType:"text",success:function(n){const s=fe.ExtractSVGSize(n);fe.CacheImageSize(t,s.width,s.height),fe.ProcessImageSizeRequest(t,s.width,s.height,null),e&&e(s.width,s.height,null,i),o&&o.ImageLoadDecRef()},error:function(n){fe.ProcessImageSizeRequest(t,0,0,{success:!1}),e&&e(0,0,{success:!1},i),o&&o.ImageLoadDecRef()}})}static ExtractSVGSize(t){const e={width:100,height:100},i=t.match(/<svg([\s\S]*?)>/i);if(!i||!i[1])return e;const o=i[1];let n=0,s=0;function a(t,e){let i=0;if(!e||!t)return t;switch(e){case"in":i=100*t;break;case"mm":i=100*t/25.4;break;case"cm":i=100*t/2.54;break;case"pt":i=100*t/72;break;case"pc":i=100*t/6;break;default:i=t}return i}const r=o.match(/width=["'](\d*\.?\d+)(\w*)["']/i);r&&r[1]&&(n=a(parseFloat(r[1]),r[2]));const l=o.match(/height=["'](\d*\.?\d+)(\w*)["']/i);if(l&&l[1]&&(s=a(parseFloat(l[1]),l[2])),!n||!s){const t=o.match(/viewbox=["'](\d*\.?\d+)\s+(\d*\.?\d+)\s+(\d*\.?\d+)\s+(\d*\.?\d+)["']/i);t&&t[3]&&t[4]&&(n=parseFloat(t[3]),s=parseFloat(t[4]))}return n&&s?{width:n,height:s}:e}};let xe=fe;a(xe,"imageSizeRequest"),a(xe,"imageSizeCache");class Ce{}a(Ce,"StateOperationType",{CREATE:1,UPDATE:2,DELETE:3}),a(Ce,"StoredObjectType",{BaseDrawObject:"BaseDrawObject",TextObject:"TextObject",NotesObject:"NotesObject",SDDataObject:"SDData",TEDataObject:"TEData",SelectedListObject:"SelectedList",LinkListObject:"Links",LayersManagerObject:"LayersManager",HNativeObject:"hNative",HNativeWinObject:"hNativeWindows",BlobBytesObject:"BlobBytes",STDataObject:"STData",ExpandedViewObject:"ExpandedView",CommentBlock:"CommentBlock",CommentThread:"CommentThread",CommentList:"CommentList"});class Pe{constructor(t,e,i,o,n,s){if(a(this,"ID"),a(this,"Dirty"),a(this,"Type"),a(this,"Data"),a(this,"IsPersisted"),a(this,"stateOptTypeId"),a(this,"Delete",(()=>{ye.stdObj.DeleteObject(this.ID)})),this.ID=t===parseInt(t,10)&&t>=0?t:-1,this.Dirty=o||!1,this.Type=e||null,this.Data=i||null,this.IsPersisted=!1!==n,this.stateOptTypeId=null,this.Data&&Oe.IsObject(this.Data)&&(this.Data.BlockID=t),void 0===s||!1===s||null===s)return this;if(void 0!==ye.stdObj&&!0===this.IsPersisted)if(-1!==this.ID){const t=ye.stdObj.GetObject(this.ID);if(void 0!==t)return null==t?null:(t.Type=e?this.Type:t.Type,t.Data=i?this.Data:t.Data,t.Dirty=o?this.Dirty:t.Dirty,t.stateOptTypeId=Ce.StateOperationType.UPDATE,t.IsPersisted=this.IsPersisted,t.Delete=this.Delete,ye.stdObj.SaveObject(t),t)}else this.stateOptTypeId=Ce.StateOperationType.CREATE,ye.stdObj.SaveObject(this)}}class Te{constructor(){a(this,"angle"),a(this,"origSeg"),a(this,"clipSeg"),a(this,"extSeg"),this.angle=0,this.origSeg={start:{x:0,y:0},end:{x:0,y:0}},this.clipSeg={start:{x:0,y:0},end:{x:0,y:0}},this.extSeg={startRay:{x:0,y:0},startExt:{x:0,y:0},start:{x:0,y:0},end:{x:0,y:0},endExt:{x:0,y:0},endRay:{x:0,y:0}}}}class Oe{static Alert(t,e,i){}static IsObject(t){return null!==t&&"object"==typeof t}static CloneBlock(t){const e=Oe.GetObjectInstance;if(null===t||"object"!=typeof t)throw new Error("Parameter is not an object");const i=e(t),o=Oe.DeepCopy({...i,...t});return null!==t.Data&&t.Data instanceof Object&&(o.Data=Oe.DeepCopy(t.Data)),o}static GetObjectInstance(t){if(null===t||"object"!=typeof t)throw new Error("Parameter is not an object");let e;if(t.constructor===Pe)e=new Pe(null,null,null,!1,!1,!0);else if(t instanceof Array)e=[];else{e=void 0;for(const[o,n]of Object.entries(Ce.StoredObjectType))try{if(t.Type===n){e=new t.constructor({});break}}catch(i){throw i}}return e}static GenerateObjectID(){return ye.currentObjSeqId+=1,ye.currentObjSeqId}static PatchArrayBufferSlice(){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(t,e){const i=new Uint8Array(this);void 0===e&&(e=i.length);const o=e-t,n=new ArrayBuffer(o),s=new Uint8Array(n);for(let a=0;a<o;a++)s[a]=i[a+t];return n})}static IsStateOpen(){return ye.state.currentStateId>0&&ye.state.states[ye.state.currentStateId].IsOpen}static DeepCopy(t){if(null==t)return null;const e=typeof t;if(t instanceof Array){const e=[],i=t.length;for(let o=0;o<i;o++)e.push(Oe.DeepCopy(t[o]));return e}if("string"===e||"number"===e||"boolean"===e||"function"===e)return t;if(t instanceof Blob){return t.slice()}if(t instanceof Uint8Array)return t;if("object"===e){const e=new t.constructor;for(const i in t){const o=t[i],n=typeof o;if(null==o)e[i]=o;else if("string"===n||"number"===n||"boolean"===n)e[i]=o;else if(o instanceof Array){null==e[i]&&(e[i]=[]);const t=o.length;for(let n=0;n<t;n++)e[i].push(Oe.DeepCopy(o[n]))}else"function"!==n&&(e[i]=Oe.DeepCopy(o))}return e}return null}static GenerateUUID(){let t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){let o=16*Math.random();return t>0?(o=(t+o)%16|0,t=Math.floor(t/16)):(o=(e+o)%16|0,e=Math.floor(e/16)),("x"===i?o:3&o|8).toString(16)}))}static CalcAngleFromPoints(t,e){let i,o=e.x-t.x,n=e.y-t.y;return 0===n?i=o>=0?0:180:0===o?i=n>0?90:270:(i=Math.atan(n/o)*(180/Math.PI),o<0?i+=180:n<0&&(i+=360)),i}static RoundCoord(t){const e=Math.round(1e3*Number(t))/1e3;return isNaN(e)?t:e}static RoundCoordExt(t){const e=Math.round(100*Number(t))/100;return isNaN(e)?t:e}static RoundCoordLP(t){const e=Math.round(10*Number(t))/10;return isNaN(e)?t:e}static ResolveHyperlink(t){return null}static ResolveHyperlinkForDisplay(t){let e=t||"";if(e.indexOf("\r")>=0){const t=e.split("\r");e=t[0]}else 0===e.indexOf("/#")&&(e=e.slice(2));return e}static CopyObj(t){return t?JSON.parse(JSON.stringify(t)):null}static ToTitleCase(t){return t.replace(/([^\W_]+[^\s-]*) */g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}))}static StrEscapeRegExp(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}static StrReplaceAll(t,e,i){return i.replace(new RegExp(this.StrEscapeRegExp(t),"g"),e)}static CloneToDoc(t,e){const i=document.createElementNS(t.namespaceURI,t.nodeName);for(let o=0,n=t.attributes.length;o<n;++o){const n=t.attributes[o],s=n.nodeName;if(s.length){const t=s[0]>="A"&&s[0]<="Z"?s.toLowerCase():s;e?""!==n.nodeValue&&"xmlns"!==t&&i.setAttribute(t,n.nodeValue):""!==n.nodeValue&&i.setAttribute(t,n.nodeValue)}}for(let o=0,n=t.childNodes.length;o<n;++o){const n=t.childNodes[o];1===n.nodeType?i.insertBefore(this.CloneToDoc(n,e),null):i.insertBefore(document.createTextNode(n.nodeValue),null)}return i}static CalcSegmentAngle(t,e){const i=e.x-t.x,o=e.y-t.y;let n;if(0===o)n=i>=0?0:180;else if(0===i)n=o>0?90:270;else{const t=o/i;n=180*Math.atan(t)/Math.PI,i<0?n+=180:o<0&&(n+=360)}return n}static RotatePoint(t,e,i){var o,n,s,a;const r=Math.PI*-i/180;let l=Math.sin(r),h=Math.cos(r);Math.abs(l)<1e-4&&(l=0),Math.abs(h)<1e-4&&(h=0);const c=e.x-(null!=(o=null==t?void 0:t.x)?o:0),p=e.y-(null!=(n=null==t?void 0:t.y)?n:0);return{x:c*h+p*l+(null!=(s=null==t?void 0:t.x)?s:0),y:-c*l+p*h+(null!=(a=null==t?void 0:t.y)?a:0)}}static OffsetPointAtAngle(t,e,i){const o=Oe.DeepCopy(t);if(0!==i){o.x+=i;return this.RotatePoint(t,o,e)}return o}static CalcExtendedOffsetSegment(t,e,i,o){const n=this.CalcSegmentAngle(t.origSeg.start,t.origSeg.end),s=n-90;t.extSeg.start=this.OffsetPointAtAngle(t.origSeg.start,s,e),t.extSeg.end=this.OffsetPointAtAngle(t.origSeg.end,s,e),t.extSeg.startExt=this.OffsetPointAtAngle(t.extSeg.start,n,-e*i),t.extSeg.startRay=this.OffsetPointAtAngle(t.extSeg.start,n,-o),t.extSeg.endExt=this.OffsetPointAtAngle(t.extSeg.end,n,e*i),t.extSeg.endRay=this.OffsetPointAtAngle(t.extSeg.end,n,o),t.extSeg.start=this.OffsetPointAtAngle(t.extSeg.start,n,-1),t.extSeg.end=this.OffsetPointAtAngle(t.extSeg.end,n,1),t.angle=n}static CalcSegmentIntersect(t,e,i,o,n){const s=(o.y-i.y)*(e.x-t.x)-(o.x-i.x)*(e.y-t.y),a=((o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x))/s,r=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/s;if(0===s){if(0===a&&0===r){let o,s,a,r;if(t.x<=e.x?(o=t.x,s=e.x):(o=e.x,s=t.x),t.y<=e.y?(a=t.y,r=e.y):(a=e.y,r=t.y),i.x>=o&&i.x<=s&&i.y>=a&&i.y<=r)return n.x=(i.x+e.x)/2,n.y=(i.y+e.y)/2,!0}return!1}return!(a<0||a>1||r<0||r>1)&&(n.x=t.x+a*(e.x-t.x),n.y=t.y+a*(e.y-t.y),!0)}static GetSegmentCenterPoint(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}static CompareAngle(t,e){let i;return i=t===e?0:t>e?t<e+180?1:-1:t<e-180?1:-1,i}static DeltaAngle(t,e){let i=t-e;return i>180?i-=360:i<-180&&(i+=360),i}static DeltaPoints(t,e){const i=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);return i>o?i:o}static GetSegmentsDeltaAngle(t,e,i,o){let n=0,s=i;for(;s!==o;)s--,s<0&&(s=e-1),n+=this.DeltaAngle(t[i].angle,t[s].angle),i=s;return n}static AreSegmentsObtuse(t,e,i,o){return this.GetSegmentsDeltaAngle(t,e,i,o)>0}static AreSegmentsAjacent(t,e,i){i<0&&(i=t-1);return i===e-1}static InsertSegment(t,e,i,o,n,s,a){const r=new Te;r.extSeg.start=i,r.extSeg.end=o,r.clipSeg.start=i,r.clipSeg.end=o,r.angle=this.CalcSegmentAngle(i,o),r.extSeg.startExt=this.OffsetPointAtAngle(i,r.angle,-n*s),r.extSeg.startRay=this.OffsetPointAtAngle(i,r.angle,-a),r.extSeg.endExt=this.OffsetPointAtAngle(o,r.angle,n*s),r.extSeg.endRay=this.OffsetPointAtAngle(o,r.angle,a),t.splice(e,0,r)}static SegmentsInAlignment(t,e,i,o){const n=-t[o].angle,s=t[o].extSeg.start,a=this.RotatePoint(s,t[o].extSeg.end,n),r=this.RotatePoint(s,t[i].extSeg.start,n),l=this.RotatePoint(s,t[i].extSeg.end,n);return r.x>a.x&&l.x>a.x&&r.x<=l.x}static IsEmptySeg(t){return t.start.x===t.end.x&&t.start.y===t.end.y}static IsStart(t,e){return 0===t&&!e}static IsEnd(t,e,i){return t===e-1&&!i}static TrimTrailing(t){return t.replace(/\s+$/g,"")}static TrimLeading(t){return t.replace(/^\s+/g,"")}static CleanGraphics(){}static MakeGuid(){return"aaaaaaaa-aaaa-4aaa-8aaa-aaaaaaaaaaaa".replace(/a/g,(function(){return Math.floor(16*Math.random()).toString(16)}))}}class ve{static HasFlag(t,e){return"number"==typeof t&&"number"==typeof e&&(t&e)===e}static AddFlag(t,e){return"number"!=typeof t||"number"!=typeof e?t:t|e}static RemoveFlag(t,e){return"number"!=typeof t||"number"!=typeof e?t:t&~e}static SetFlag(t,e,i){let o=t;return i?o|=e:t&e&&(o&=~e),o}static CopyRect(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height}static pointInRect(t,e){return e.x>=t.x&&e.x<t.x+t.width&&e.y>=t.y&&e.y<t.y+t.height}static EqualPt(t,e){return this.IsEqual(t.x,e.x)&&this.IsEqual(t.y,e.y)}static TrimDP(t,e){const i=t.toFixed(e);return parseFloat(i)}static Pt2CPoint(t,e){const i={};return e?(i.h=t.y,i.v=t.x):(i.h=t.x,i.v=t.y),i}static Rect2CRect(t,e){const i={h:0,v:0,hdist:0,vdist:0};return e?(i.h=t.y,i.v=t.x,i.hdist=t.height,i.vdist=t.width):(i.h=t.x,i.hdist=t.width,i.v=t.y,i.vdist=t.height),i}static CRect2Rect(t,e){const i={x:0,y:0,width:0,height:0};return e?(i.x=t.v,i.y=t.h,i.width=t.vdist,i.height=t.hdist):(i.x=t.h,i.y=t.v,i.width=t.hdist,i.height=t.vdist),i}static Pt2Rect(t,e){const i={x:0,y:0,width:0,height:0};if(null==t||null==e)return null;i.x=t.x,i.y=t.y,e.x<i.x&&(i.x=e.x),e.y<i.y&&(i.y=e.y),i.width=t.x-i.x;const o=e.x-i.x;o>i.width&&(i.width=o),i.height=t.y-i.y;const n=e.y-i.y;return n>i.height&&(i.height=n),i}static Add2Rect(t,e){t.x-=e.left,t.width+=e.right+e.left,t.y-=e.top,t.height+=e.bottom+e.top}static SubRect(t,e){t.x+=e.left,t.width-=e.right+e.left,t.y+=e.top,t.height-=e.bottom+e.top}static GetPolyRect(t,e){const i=e.length;if(i){t.x=e[0].x,t.y=e[0].y;let o=t.x,n=t.y;t.width=0,t.height=0;for(let s=1;s<i;s++)e[s].x<t.x&&(t.x=e[s].x),e[s].x>o&&(o=e[s].x),e[s].y<t.y&&(t.y=e[s].y),e[s].y>n&&(n=e[s].y);t.width=o-t.x,t.height=n-t.y}}static GetPolyRectExt(t,e,i,o){t.x=0,t.y=0,t.width=0,t.height=0;const n=e.length;if(0!==n){void 0===i&&(i=0),void 0===o&&(o=n),t.x=e[i].x,t.y=e[i].y;for(let n=1+i;n<o;n++){let i;e[n].x<t.x?(i=t.x-e[n].x,t.x=e[n].x,t.width+=i):e[n].x>t.x+t.width&&(i=e[n].x-(t.x+t.width),t.width+=i),e[n].y<t.y?(i=t.y-e[n].y,t.y=e[n].y,t.height+=i):e[n].y>t.y+t.height&&(i=e[n].y-(t.y+t.height),t.height+=i)}}}static IsRectEmpty(t){return t.width<=0||t.height<=0}static InflateRect(t,e,i){t.x-=e,t.width+=2*e,t.y-=i,t.height+=2*i}static OffsetRect(t,e,i){t.x+=e,t.y+=i}static EqualRect(t,e,i=.001){return!(Math.abs(t.x-e.x)>i||Math.abs(t.y-e.y)>i||Math.abs(t.width-e.width)>i||Math.abs(t.height-e.height)>i)}static InflatePoint(t,e){const i=e/2,o={x:0,y:0,width:0,height:0};return o.x=t.x-i,o.width=2*i,o.y=t.y-i,o.height=2*i,o}static Sqrt(t){return t<1e-9?0:Math.sqrt(t)}static UnionRect(t,e,i){const o={x:0,y:0,width:0,height:0};o.x=Math.min(t.x,e.x),o.y=Math.min(t.y,e.y);const n=t.x+t.width,s=e.x+e.width;o.width=Math.max(n,s)-o.x;const a=t.y+t.height,r=e.y+e.height;return o.height=Math.max(a,r)-o.y,i.x=o.x,i.y=o.y,i.width=o.width,i.height=o.height,i}static IntersectRect(t,e){let i,o;t.y<=e.y?(i=t,o=e):(i=e,o=t);const n=i.x+i.width,s=o.x+o.width,a=i.y+i.height,r=o.y+o.height;if(o.y>=i.y&&o.y-a<-.01)if(i.x>=o.x){if(i.x-s<-.01)return{x:i.x,width:Math.min(n,s)-i.x,y:o.y,height:Math.min(a,r)-o.y}}else if(o.x-n<-.01)return{x:o.x,width:Math.min(n,s)-o.x,y:o.y,height:Math.min(a,r)-o.y};return null}static RectInsideRect(t,e){const i=t.x+t.width,o=e.x+e.width,n=t.y+t.height,s=e.y+e.height;return e.x>=t.x&&o<=i&&e.y>=t.y&&s<=n}static CNUnionRect(t,e,i){const o={h:0,v:0,hdist:0,vdist:0};o.h=Math.min(t.h,e.h),o.v=Math.min(t.v,e.v);const n=t.h+t.hdist,s=e.h+e.hdist;o.hdist=Math.max(n,s)-o.h;const a=t.v+t.vdist,r=e.v+e.vdist;return o.vdist=Math.max(a,r)-o.v,i.h=o.h,i.v=o.v,i.hdist=o.hdist,i.vdist=o.vdist,i}static SetRect(t,e,i,o){const n={x:0,y:0,width:0,height:0};return n.x=t,n.width=i-t,n.y=e,n.height=o-e,n}static PolyFromRect(t){const e=[];return e.push(new De(t.x,t.y)),e.push(new De(t.x+t.width,t.y)),e.push(new De(t.x+t.width,t.y+t.height)),e.push(new De(t.x,t.y+t.height)),e.push(new De(t.x,t.y)),e}static GetRectFromDiagonal(t,e){let i,o,n;return this.IsEqual(t.height,0)?(o=e,n=0):this.IsEqual(t.width,0)?(o=0,n=e):(i=t.height/t.width,o=this.Sqrt(e*e/(1+i*i)),n=i*o),{width:o,height:n}}static IsPointInPoly(t,e){let i=!1;const o=t.length;for(let n=0,s=o-1;n<o;s=n++)(t[n].y<=e.y&&e.y<t[s].y||t[s].y<=e.y&&e.y<t[n].y)&&e.x<(t[s].x-t[n].x)*(e.y-t[n].y)/(t[s].y-t[n].y)+t[n].x&&(i=!i);return i}static IsFrameCornersInPoly(t,e){const i={x:0,y:0};return i.x=e.x,i.y=e.y,!!ve.IsPointInPoly(t,i)||(i.x+=e.width,!!ve.IsPointInPoly(t,i)||(i.y+=e.height,!!ve.IsPointInPoly(t,i)||(i.x-=e.width,ve.IsPointInPoly(t,i))))}static IsAllFrameCornersInPoly(t,e){const i={x:0,y:0};return i.x=e.x,i.y=e.y,!!ve.IsPointInPoly(t,i)&&(i.x+=e.width,!!ve.IsPointInPoly(t,i)&&(i.y+=e.height,!!ve.IsPointInPoly(t,i)&&(i.x-=e.width,ve.IsPointInPoly(t,i))))}static IsAllPolyPointsInPoly(t,e){const i=e.length;for(let o=0;o<i;o++)if(!ve.IsPointInPoly(t,e[o]))return!1;return!0}static StringtoCSV(t){const e=t.split('"'),i=e.length;if(i<2)return t;let o="";for(let n=0;n<i-1;n++)o=o+e[n]+'""';return o+=e[i-1],o}static IsEqual(t,e,i){const o=void 0!==i?i:.5;return Math.abs(t-e)<o}static SpliceArray(t,e,i,o){let n=[];const s=t.length;if(e>=s)n=t.concat(o);else{const a=t.slice(0,e),r=t.slice(e+i,s);n=a.concat(o).concat(r)}return n}static EqualDate(t,e){return t.year===e.year?t.month===e.month?t.day===e.day?0:t.day<e.day?-1:1:t.month<e.month?-1:1:t.year<e.year?-1:1}static ArrayToString(t){let e="";const i=t.length;for(let o=0;o<i;o++)e+=t[o];return e}static BrowserDetect(){}static PolyYCurve(t,e,i,o,n,s,a,r,l,h){let c,p,d,u,g,y,S,m={x:0,y:0};c=(e.bottom-e.top)/2,p=e.right-e.left,d=(2*c-s-a)/(i-1);for(let b=0;b<i;++b){u=d*b+s,o&&u<o&&(u=o),g=c-u,n&&g-n<-c&&(g=-(c-n)),m.y=e.top+(c-g),y=c?g/c:0,S=this.Sqrt(1-y*y)*p,m.x=r?e.right-S:e.left+S;const i=Oe.DeepCopy(m);l&&(i.x/=l),h&&(i.y/=h),t.push(i)}return t}static ArrayBufferToBase64(t){let e="";const i=new Uint8Array(t),o=i.byteLength;for(let n=0;n<o;n++)e+=String.fromCharCode(i[n]);return window.btoa(e)}static UInt8ToString(t){const e=[];for(let i=0;i<t.length;i+=32768)e.push(String.fromCharCode.apply(null,t.subarray(i,i+32768)));return e.join("")}static RegExpEscape(t){const e=["$","*","^","?","+"];let i="";for(let o=0;o<t.length;o++)e.includes(t[o])?i+="\\"+t[o]:i+=t[o];return i}static StopPropagationAndDefaults(t){t.preventDefault(),t.stopPropagation(),t.gesture&&(t.gesture.preventDefault(),t.gesture.stopPropagation())}static UTF8ToB64(t){let e;try{e=window.btoa(unescape(encodeURIComponent(t)))}catch(i){throw e="",i}return e}static B64ToUTF8(t){let e;try{e=decodeURIComponent(escape(window.atob(t)))}catch(i){throw e="",i}return e}static ArrayBufferToString(t){const e=new Uint8Array(t),i=e.length;let o="";for(let n=0;n<i;n+=65535){const t=Math.min(65535,i-n);o+=String.fromCharCode.apply(null,e.subarray(n,n+t))}return o}static ParseSVGDimensions(t){const e=ve.UInt8ToString(t);return xe.ExtractSVGSize(e)}static ObjectDiff(t,e,i,o,n){if(t===e)return{changed:"equal",value:t};const s={};let a=!0;for(const r in t)if(void 0!==t[r])if(r in e)if(t[r]===e[r])i||(s[r]={changed:"equal",value:t[r]});else{const l=typeof t[r],h=typeof e[r];if(!t[r]||!e[r]||"object"!==l&&"function"!==l||"object"!==h&&"function"!==h){if(o&&i&&!isNaN(t[r])&&!isNaN(e[r])&&Math.round(t[r])===Math.round(e[r]))continue;a=!1,s[r]={changed:"primitive change",removed:t[r],added:e[r]}}else{const l=ve.ObjectDiff(t[r],e[r],i,o,n);"equal"===l.changed?i||(s[r]={changed:"equal",value:t[r]}):(a=!1,s[r]=l)}}else a=!1,s[r]={changed:"removed",value:t[r]};if(!i||!n)for(const r in e)void 0===e[r]||r in t||(a=!1,s[r]={changed:"added",value:e[r]});return a?{changed:"equal",value:t}:{changed:"object change",value:s}}static FlipDate(t){let e,i=0,o=0,n=null,s="";for(o=t.length,i=0;i<o;i++)if(isNaN(parseInt(t[i]))){n=t[i];break}if(!n)return null;const a=t.split(n);if(a.length<2)return null;e=a.splice(1,1),a.unshift(e[0]);for(let r=0;r<a.length;r++)s.length>0&&(s+=n),s+=a[r];return s}static QualifyURL(t){return t&&t.length>0&&"/#"!==t.substring(0,2)&&-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&(t="http://"+t),t}static GetDistanceBetween2Points(t,e){const i=e.x-t.x,o=e.y-t.y;return this.Sqrt(i*i+o*o)}static IsRectangular(t){let e,i,o,n;e=t.length;for(let s=0;s<e-1;s++){if(o=ye.opt.GetCounterClockwiseAngleBetween2Points(t[s],t[s+1]),s>0&&(n=o-i,n<0&&(n+=2*Math.PI),n>Math.PI&&(n-=Math.PI),!(n>=Math.PI/2-.052&&n<=Math.PI/2+.052)))return!1;i=o}return!0}static GetPathExtension(t){if(null==t)return null;const e=t.length;if(e>4){const i=t.lastIndexOf(".");if(i>=0){let o=t.slice(i,e);const n=o.indexOf("?");return n>=0&&(o=o.slice(0,n)),o.toLowerCase()}}return null}static RemoveExtension(t){if(null==t)return null;const e=t.lastIndexOf(".");return-1===e?t:t.slice(0,e)}static HtmlEncode(t){return Rt("<div>").text(t).html()}static IsRectangleFullyEnclosed(t,e){return e.x>=t.x&&e.x+e.width<=t.x+t.width&&e.y>=t.y&&e.y+e.height<=t.y+t.height}}const we={Basic:null,Shape:null};function ke(t,e){we.Basic=t,we.Shape=e}class Le{constructor(){a(this,"targetId"),a(this,"segment"),a(this,"hitPoint"),a(this,"locked"),a(this,"context"),this.targetId=-1,this.segment=-1,this.hitPoint={x:0,y:0},this.locked=!1,this.context=0}}class Ae{}a(Ae,"CursorDisplayMode",{None:0,Show:1,Hide:2}),a(Ae,"DocContext",{CurrentTextAlignment:"center",SpacebarDown:!1,CanTypeInWorkArea:!0,CurrentWidth:"0",CurrentHeight:"0"}),a(Ae,"ClipboardType",{None:0,Text:1,LM:2,Image:4}),a(Ae,"GradientStyle",{GradMiddle:1,GradHoriz:4,GradVert:2,GradTlbr:8,GradTrbl:16,GradRev:32,GradShape:64,GradRadial:128}),a(Ae,"DataSource",{FFI_SYNC:1,REALTIME:2,HISTORICAL:3,MANUAL:4}),a(Ae,"CreatedBy",{FFI_SYNC_SERVICE:1,FRONTEND:2,BACKEND:3,API:4});class Ie{static IsRightClick(t){F.Debug("= u.MouseUtil: IsRightClick - Input:",t);let e=!1;return t.gesture&&(t=t.gesture.srcEvent),t instanceof MouseEvent?e=3===t.which||t.ctrlKey&&t.metaKey:"onpointerdown"in window&&t instanceof PointerEvent&&(e=3===t.which),F.Debug("= u.MouseUtil: IsRightClick - Output:",e),e}}class Ee{}a(Ee,"LinkFlags",{DeleteTarget:1,DeleteLink:2,Change:4,Break:8,Move:16,WasMoved:32}),a(Ee,"Contexts",{None:-1,All:0,Text:1,Table:2,Automation:3,DimensionText:4,FloorPlan:5,Note:6,Navigation:7,AutomationNoCtrl:8,ReadOnly:9}),a(Ee,"PolyListFlags",{FreeHand:1,OneStep:2,NoMiddleControlPoints:4,TimelineControlPoint:8,NoControl:16,WasExplict:32,HasMoveTo:64,HasPolyPoly:128}),a(Ee,"PolySegFlags",{Select:1,Hide:2,Temp:4,TempSave:8,VA:16,NVA:32,NoLine:64,NoFill:128}),function(t,e){var i=function t(e,i){return new t.Instance(e,i||{})},o=!1,n={},s=i.DIRECTION_DOWN="down",a=i.DIRECTION_LEFT="left",r=i.DIRECTION_UP="up",l=i.DIRECTION_RIGHT="right",h=i.POINTER_MOUSE="mouse",c=i.POINTER_TOUCH="touch",p=i.POINTER_PEN="pen",d=i.EVENT_START="start",u=i.EVENT_MOVE="move",g=i.EVENT_END="end",y=i.EVENT_RELEASE="release",S=i.EVENT_TOUCH="touch";i.defaults={behavior:{userSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.DOCUMENT=document,i.CALCULATE_INTERVAL=25,i.READY=!1,i.gestures=i.gestures||{},i.classType="Hammer";var m,b,D=i.utils={classType:"Utils",extend:function(t,i,o){for(var n in i)i.hasOwnProperty(n)&&(t[n]===e||o)&&(t[n]=i[n]);return t},on:function(t,e,i){t.addEventListener(e,i,!1)},off:function(t,e,i){t.removeEventListener(e,i,!1)},each:function(t,i,o){var n,s;if("forEach"in t)t.forEach(i,o);else if(t.length!==e){for(n=0,s=t.length;n<s;n++)if(!1===i.call(o,t[n],n,t))return}else for(n in t)if(t.hasOwnProperty(n)&&!1===i.call(o,t[n],n,t))return},inStr:function(t,e){return t.indexOf(e)>-1},inArray:function(t,e){if(t.indexOf){var i=t.indexOf(e);return-1!==i&&i}for(var o=0,n=t.length;o<n;o++)if(t[o]===e)return o;return!1},inGestureArray:function(t,e){for(var i=0,o=t.length;i<o;i++)if(t[i].gesture==e.gesture)return i;return!1},toArray:function(t){return Array.prototype.slice.call(t,0)},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){var e=[],i=[],o=[],n=[],s=Math.min,a=Math.max;return 1===t.length?{pageX:t[0].pageX,pageY:t[0].pageY,clientX:t[0].clientX,clientY:t[0].clientY}:(this.each(t,(function(t){e.push(t.pageX),i.push(t.pageY),o.push(t.clientX),n.push(t.clientY)})),{pageX:(s.apply(Math,e)+a.apply(Math,e))/2,pageY:(s.apply(Math,i)+a.apply(Math,i))/2,clientX:(s.apply(Math,o)+a.apply(Math,o))/2,clientY:(s.apply(Math,n)+a.apply(Math,n))/2})},getVelocity:function(t,e,i){return{x:Math.abs(e/t)||0,y:Math.abs(i/t)||0}},getAngle:function(t,e){var i=e.clientX-t.clientX,o=e.clientY-t.clientY;return 180*Math.atan2(o,i)/Math.PI},getDirection:function(t,e){return Math.abs(t.clientX-e.clientX)>=Math.abs(t.clientY-e.clientY)?t.clientX-e.clientX>0?a:l:t.clientY-e.clientY>0?r:s},getDistance:function(t,e){var i=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(i*i+o*o)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==r||t==s},setPrefixedCss:function(t,i,o,n){var s=[""];i=this.toCamelCase(i);for(var a=0;a<s.length;a++){var r=i;if(s[a]&&(r=s[a]+i.charAt(0).toUpperCase()+i.slice(1)),r in t.style){t.style[r]=(n===e||n)&&o||"";break}}},toggleBehavior:function(t,e,i){if(e&&t&&t.style){this.each(e,(function(e,o){this.setPrefixedCss(t,o,e,i)}),this);var o=i&&function(t){var e=t.target||t.srcElement;return!(e&&"textarea"==e.localName)};"none"==e.userSelect&&(t.onselectstart=o),"none"==e.userDrag&&(t.ondragstart=o)}},toCamelCase:function(t){return t.replace(/[_-]([a-z])/g,(function(t){return t[1].toUpperCase()}))},inWksBar:function(t){if(!window.docUtil)return!1;var e=document.getElementById("svg-area"),i=e[0];if(t.currentTarget==i){var o=e.css("overflow-x"),n=e.css("overflow-y");if("scroll"===o){var s=t.clientY-e.offset().top;if(t.currentTarget.clientHeight-s<=0)return!0}if("scroll"===n){var a=t.clientX-e.offset().left;if(t.currentTarget.clientWidth-a<=0)return!0}}return!1}},f=i.event={classType:"Event",started:!1,shouldDetect:!1,on:function(t,e,i,o){var n=e.split(" ");D.each(n,(function(e){D.on(t,e,i),o&&o(e)}))},off:function(t,e,i,o){var n=e.split(" ");D.each(n,(function(e){D.off(t,e,i),o&&o(e)}))},onTouch:function(t,e,i){var o=this,s=function(n){var s;window.docUtil&&e==d&&D.inWksBar(n)||(e==d&&(o.shouldDetect=!0),e!=g&&o.shouldDetect&&x.updatePointer(e,n),o.shouldDetect&&(s=o.doDetect.call(o,n,e,t,i,0)),s==g&&(o.shouldDetect=!1,x.reset()),e==g&&x.updatePointer(e,n))};return this.on(t,n[e],s),s},doDetect:function(t,e,i,o,n){var s=this.getTouchList(t,e),a=s.length,r=e,l=s.trigger,h=a;e===d?l=S:e===g&&(l=y,h=s.length-(t.changedTouches?t.changedTouches.length:1)),h>0&&this.started&&(r=u),this.started=!0;var c=this.collectEventData(i,r,s,t);return e!==g&&o.call(C,c),l&&(c.changedLength=h,c.eventType=l,o.call(C,c),c.eventType=r,delete c.changedLength),r===g&&(o.call(C,c),this.started=!1),r},determineEventTypes:function(){var t=["pointerdown","pointermove","pointerup pointercancel lostpointercapture"];return n[d]=t[0],n[u]=t[1],n[g]=t[2],n},getTouchList:function(t,e){return x.getTouchList()},collectEventData:function(t,e,i,o){var n=c;return D.inStr(o.type,"mouse")||x.matchType(h,o)?n=h:x.matchType(p,o)&&(n=p),{center:D.getCenter(i),timeStamp:Date.now(),target:o.target,touches:i,eventType:e,pointerType:n,srcEvent:o,preventDefault:function(){var t=this.srcEvent;t.preventManipulation&&t.preventManipulation(),t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return C.stopDetect()}}}},x=i.PointerEvent={classType:"PointerEvent",pointers:{},getTouchList:function(){var t=[];return D.each(this.pointers,(function(e){t.push(e)})),t},updatePointer:function(t,e){t==g?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e)},matchType:function(t,e){if(!e.pointerType)return!1;var i=e.pointerType,o={};return o[h]=i===h,o[c]=i===c,o[p]=i===p,o[t]},reset:function(){this.pointers={}}},C=i.detection={classType:"Detection",gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:D.extend({},e),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);var e=this.current.inst,i=e.options;return D.each(this.gestures,(function(o){!this.stopped&&e.enabled&&i[o.name]&&o.handler.call(o,t,e)}),this),this.current&&(this.current.lastEvent=t),t.eventType==g&&this.stopDetect(),t}},stopDetect:function(){this.previous=D.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(t,e,o,n,s){var a=this.current,r=!1,l=a.lastCalcEvent,h=a.lastCalcData;l&&t.timeStamp-l.timeStamp>i.CALCULATE_INTERVAL&&(e=l.center,o=t.timeStamp-l.timeStamp,n=t.center.clientX-l.center.clientX,s=t.center.clientY-l.center.clientY,r=!0),t.eventType!=S&&t.eventType!=y&&(a.futureCalcEvent=t),a.lastCalcEvent&&!r||(h.velocity=D.getVelocity(o,n,s),h.angle=D.getAngle(e,t.center),h.direction=D.getDirection(e,t.center),a.lastCalcEvent=a.futureCalcEvent||t,a.futureCalcEvent=t),t.velocityX=h.velocity.x,t.velocityY=h.velocity.y,t.interimAngle=h.angle,t.interimDirection=h.direction},extendEventData:function(t){var e=this.current,i=e.startEvent,o=e.lastEvent||i;t.eventType!=S&&t.eventType!=y&&(i.touches=[],D.each(t.touches,(function(t){i.touches.push({clientX:t.clientX,clientY:t.clientY})})));var n=t.timeStamp-i.timeStamp,s=t.center.clientX-i.center.clientX,a=t.center.clientY-i.center.clientY;return this.getCalculatedData(t,o.center,n,s,a),D.extend(t,{startEvent:i,deltaTime:n,deltaX:s,deltaY:a,distance:D.getDistance(i.center,t.center),angle:D.getAngle(i.center,t.center),direction:D.getDirection(i.center,t.center),scale:D.getScale(i.touches,t.touches),rotation:D.getRotation(i.touches,t.touches)}),t},register:function(t){var o=t.defaults||{};return o[t.name]===e&&(o[t.name]=!0),D.extend(i.defaults,o,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort((function(t,e){return t.index<e.index?-1:t.index>e.index?1:0})),this.gestures}};(i.Instance=function(t,e){var o=this;i.READY||(f.determineEventTypes(),D.each(i.gestures,(function(t){C.register(t)})),f.onTouch(i.DOCUMENT,u,C.detect),f.onTouch(i.DOCUMENT,g,C.detect),i.READY=!0),this.element=t,this.enabled=!0,D.each(e,(function(t,i){delete e[i],e[D.toCamelCase(i)]=t})),this.options=D.extend(D.extend({},i.defaults),e||{}),this.options.behavior&&D.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=f.onTouch(t,d,(function(t){o.enabled&&t.eventType==d?C.startDetect(o,t):t.eventType==S&&C.detect(t)})),this.eventHandlers=[]}).prototype={classType:"Hammer.Instance",on:function(t,e){var i,o=this,n=o.eventHandlers.length,s=null;for(i=0;i<n;++i)o.eventHandlers[i].gesture===t&&(s=o.eventHandlers[i].handler);return s&&this.off(t,s),f.on(o.element,t,e,(function(t){o.eventHandlers.push({gesture:t,handler:e})})),o},off:function(t,e){var i=this,o=t.split(" ");return D.each(o,(function(t){var e,o=i.eventHandlers.length,n=null;for(e=0;e<o;++e)if(i.eventHandlers[e].gesture===t){n=i.eventHandlers[e].handler;break}n&&f.off(i.element,t,n,(function(t){var e=D.inGestureArray(i.eventHandlers,{gesture:t});!1!==e&&i.eventHandlers.splice(e,1)}))})),i},trigger:function(t,e){e=e||{};var o=i.DOCUMENT.createEvent("Event");o.initEvent(t,!0,!0),o.gesture=e;var n=this.element;return D.hasParent(e.target,n)&&(n=e.target),n.dispatchEvent(o),this},enable:function(t){return this.enabled=t,this},dispose:function(){var t,e;for(D.toggleBehavior(this.element,this.options.behavior,!1),t=-1;e=this.eventHandlers[++t];)D.off(this.element,e.gesture,e.handler);return this.eventHandlers=[],f.off(this.element,n[d],this.eventStartHandler),null}},i.gestures.Drag={name:"drag",index:50,handler:function(t,e){var i=C.current;if(e.options.dragMaxTouches>0&&t.touches.length>e.options.dragMaxTouches)o=!1;else switch(t.eventType){case d:o||(e.trigger("dragstart",t),o=!0),e.trigger("drag",t),t.srcEvent.stopPropagation(),t.srcEvent.preventDefault();break;case u:if(t.srcEvent.stopPropagation(),t.srcEvent.preventDefault(),t.distance<e.options.dragMinDistance&&"drag"!=i.name)return void t.srcEvent.preventDefault();var n=i.startEvent.center;if("drag"!=i.name&&(i.name="drag",e.options.dragDistanceCorrection&&t.distance>0)){var s=Math.abs(e.options.dragMinDistance/t.distance);n.pageX+=t.deltaX*s,n.pageY+=t.deltaY*s,n.clientX+=t.deltaX*s,n.clientY+=t.deltaY*s,t=C.extendEventData(t)}e.trigger("drag",t);break;case y:o&&t.changedLength<=e.options.dragMaxTouches&&(e.trigger("dragend",t),o=!1)}},defaults:{dragMinDistance:1,dragDistanceCorrection:!0,dragMaxTouches:1}},m="hold",i.gestures.Hold={name:m,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:function(t,e){var i=e.options,o=C.current;switch(t.eventType){case d:clearTimeout(b),o.name=m,b=setTimeout((function(){!o||o.name!==m&&"drag"!==o.name||e.trigger(m,t)}),i.holdTimeout);break;case u:t.distance>i.holdThreshold&&clearTimeout(b);break;case y:clearTimeout(b)}}},function(t){var e=!1;i.gestures.Tap={name:t,index:100,handler:function(i,o){var n,s,a=o.options,r=C.current,l=C.previous;switch(i.eventType){case d:e=!1;break;case u:e=e||i.distance>a.tapMaxDistance;break;case g:!D.inStr(i.srcEvent.type,"cancel")&&i.deltaTime<a.tapMaxTime&&!e&&(n=l&&l.lastEvent&&i.timeStamp-l.lastEvent.timeStamp,s=!1,l&&l.name==t&&n&&n<a.doubleTapInterval&&i.distance<a.doubleTapDistance&&(o.trigger("doubletap",i),s=!0),s&&!a.tapAlways||(r.name=t,o.trigger(r.name,i)))}},defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!1,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),function(t){var e=!1;i.gestures.Transform={name:t,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:function(i,o){switch(i.eventType){case d:e=!1;break;case u:if(i.touches.length<2)return;var n=Math.abs(1-i.scale),s=Math.abs(i.rotation);if(n<o.options.transformMinScale&&s<o.options.transformMinRotation)return;C.current.name=t,e||(o.trigger("transformstart",i),e=!0),o.trigger(t,i),s>o.options.transformMinRotation&&o.trigger("rotate",i),n>o.options.transformMinScale&&(o.trigger("pinch",i),o.trigger("pinch"+(i.scale<1?"in":"out"),i));break;case g:e&&i.changedLength<2&&(o.trigger("transformend",i),e=!1)}}}}("transform"),t.Hammer=i}(window);class Fe{constructor(){a(this,"Units"),a(this,"Scale"),a(this,"RWidth"),a(this,"AlignmentScalar"),a(this,"Flags"),this.Units=0,this.Scale=0,this.RWidth=0,this.AlignmentScalar=0,this.Flags=0}}var Ge=Object.defineProperty,Re=Object.getOwnPropertyDescriptor;class je{constructor(t){a(this,"FillType"),a(this,"Color"),a(this,"EndColor"),a(this,"GradientFlags"),a(this,"Texture"),a(this,"TextureScale"),a(this,"Opacity"),a(this,"EndOpacity"),this.FillType=Se.FillTypes.Solid,this.Color=t,this.EndColor=Se.Colors.White,this.GradientFlags=0,this.Texture=0,this.TextureScale=new Fe,this.Opacity=1,this.EndOpacity=1}}((t,e,i,o)=>{for(var n,s=o>1?void 0:o?Re(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&Ge(e,i,s)})([jt((()=>Fe))],je.prototype,"TextureScale",2);class Be{constructor(){a(this,"OutsideType"),a(this,"OutsideExtent_Right"),a(this,"OutsideExtent_Left"),a(this,"OutsideExtent_Top"),a(this,"OutsideExtent_Bottom"),a(this,"Color"),a(this,"LParam"),a(this,"WParam"),this.OutsideType=0,this.OutsideExtent_Right=0,this.OutsideExtent_Left=0,this.OutsideExtent_Top=0,this.OutsideExtent_Bottom=0,this.Color=Se.Colors.Black,this.LParam=0,this.WParam=0}}var Me=Object.defineProperty,He=Object.getOwnPropertyDescriptor,_e=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?He(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&Me(e,i,s),s};class Ue{constructor(){a(this,"Paint"),a(this,"FontName"),a(this,"FontType"),a(this,"FontId"),a(this,"FontSize"),a(this,"Face"),a(this,"Effect"),a(this,"SetPaint",(t=>(this.Paint=t,this))),this.Paint=new je(Se.Colors.Black),this.FontName="Arial",this.FontType="sanserif",this.FontId=1,this.FontSize=10,this.Face=0,this.Effect=new Be}}_e([jt((()=>je))],Ue.prototype,"Paint",2),_e([jt((()=>Be))],Ue.prototype,"Effect",2);class Ne{}a(Ne,"ColorFilters",{NCFill:1,NCTexture:2,NCLine:4,NCLineThick:8,NCLinePat:16,NCLineArrow:32,NCText:64,NCOutSide:128,NCEffect:256,NCStyle:512,NCAll:1023,NCResize:1024}),a(Ne,"FillEffect",{None:0,Gloss:1,Bevel:2,InShadow:3,InGlow:4}),a(Ne,"OutEffect",{None:0,Drop:1,Cast:2,Glow:3,Refl:4}),a(Ne,"ParaStyleCodes",{Just:100,Spacing:101,Leading:102,Tracking:103,Lindent:104,Rindent:105,Pindent:106,Bindent:107,Bullet:108,TabSpace:109,Hyphen:110}),a(Ne,"FormatPainterModes",{None:0,Object:1,Text:2,Table:3}),a(Ne,"ImageDir",{Meta:113,Jpg:124,Png:125,Svg:143,Store:123}),a(Ne,"RichGradientTypes",{Linear:0,BR:1,BL:2,RadialCenter:3,RadialBC:4,RadialTC:5,RadialTR:6,RadialTL:7,RectBR:8,RectBL:9,RectCenter:10,RectTR:11,RectTL:12,Shape:13});class Ve{static GetLengthInRulerUnits(t,e,i,o){F.Debug("O.Opt GetLengthInRulerUnits - Input:",{lengthInUnits:t,skipFeetConversion:e,offset:i,displayFlags:o});const n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);let s="",a=0,r=0,l=0,h=0,c=0,p=0,d="",u=1;const g=!!o&&(o&Se.DimensionFlags.ShowFractionalInches)>0,y=!!o&&(o&Se.DimensionFlags.ShowFeetAsInches)>0;if(i&&(i*=100,ye.docUtil.rulerConfig.useInches||(i/=me.Common.MetricConv),t-=i),ye.docUtil.rulerConfig.showpixels)return s=String(Math.round(t)),F.Debug("O.Opt GetLengthInRulerUnits - Output:",s),s;if(h=this.GetLengthInUnits(t),ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units===Se.RulerUnit.Feet&&!e){if(h<0&&(u=-1,h=-h),a=Math.floor(h),r=12*(h-a),g&&(l=r-Math.floor(r),r=Math.floor(r)),"12"===Number(r).toFixed()&&(r=0,a++),y&&(r+=12*a,a=0),l>0&&(p=this.GetFractionStringGranularity(n),c=Math.round(l/p),c>=1&&(c=0,12!=++r||y||(a++,r=0)),c>0)){let t=c,e=Math.floor(1/p);for(;t%2==0&&e%2==0;)t/=2,e/=2;d=t+"/"+e}a*=u,0!==a&&(s=a+"'"),d.length>0?(s+=" "+Number(r).toFixed(),s+=" "+d,s+='"'):r>0&&(r=Math.round(r),s+=" "+r+'"')}else ye.docUtil.rulerConfig.units!==Se.RulerUnit.Inches&&ye.docUtil.rulerConfig.units!==Se.RulerUnit.M&&ye.docUtil.rulerConfig.units!==Se.RulerUnit.Cm&&ye.docUtil.rulerConfig.units!==Se.RulerUnit.Mm||(s=h.toFixed(ye.docUtil.rulerConfig.dp));return F.Debug("O.Opt GetLengthInRulerUnits - Output:",s),s}static GetLengthInUnits(t){F.Debug("O.Opt GetLengthInUnits - Input:",{length:t});const e=t*this.GetToUnits();return F.Debug("O.Opt GetLengthInUnits - Output:",e),e}static GetToUnits(){F.Debug("O.Opt GetToUnits - Input");const t=ye.docUtil.rulerConfig.major;let e=ye.docUtil.rulerConfig.majorScale/t;return ye.docUtil.rulerConfig.useInches||(e*=ye.docUtil.rulerConfig.metricConv),F.Debug("O.Opt GetToUnits - Output:",e),e}static GetFractionStringGranularity(t){return ye.docUtil.rulerConfig.denom>=1?1/ye.docUtil.rulerConfig.denom:ye.docUtil.rulerConfig.majorScale<=1?1/16:ye.docUtil.rulerConfig.majorScale<=2?1/8:ye.docUtil.rulerConfig.majorScale<=4?1/4:ye.docUtil.rulerConfig.majorScale<=8?.5:1}static GetFractionDenominator(){let t;const e=ye.docUtil.rulerConfig.majorScale;return t=e<=1?16:e<=2?8:e<=4?4:e<=8?2:1,t}}class ze{}a(ze,"CursorType",{Default:"cur-default",Pointer:"cur-pointer",Cross:"cur-cross",Text:"cur-text",Move:"cur-move",ResizeT:"cur-n-resize",ResizeR:"cur-e-resize",ResizeB:"cur-s-resize",ResizeL:"cur-w-resize",ResizeTB:"cur-ns-resize",ResizeLR:"cur-ew-resize",ResizeRT:"cur-ne-resize",ResizeLT:"cur-nw-resize",ResizeRB:"cur-se-resize",ResizeLB:"cur-sw-resize",NeswResize:"cur-nesw-resize",NwseResize:"cur-nwse-resize",Anchor:"cur-anchor",Paint:"cur-paint",Rotate:"cur-rotate",Edit:"cur-pencil",EditClose:"cur-pencil-close",Add:"cur-add",Stamp:"cur-stamp",AddRight:"cur-add-right",AddLeft:"cur-add-left",AddUp:"cur-add-up",AddDown:"cur-add-down",AddPlus:"cur-add-plus",Grab:"cur-grab"}),a(ze,"CursorTypes",{Default:"DEFAULT",Plus:"PLUS",Move:"MOVE",Grow:"GROW"}),a(ze,"Knob",{Path:"assets/img/knob/",DiagonLeft:"diagon_left.svg",DiagonRight:"diagon_right.svg",ExpandHoriz:"expand_horiz.svg",ExpandVert:"expand_vert.svg"}),a(ze,"CursorState",{None:0,EditOnly:1,EditLink:2,LinkOnly:3});class We{constructor(){a(this,"above_left"),a(this,"below_left"),a(this,"above_right"),a(this,"below_right"),a(this,"left_top"),a(this,"right_top"),a(this,"left_bottom"),a(this,"right_bottom"),a(this,"above_center"),a(this,"below_center"),a(this,"left_center"),a(this,"right_center"),a(this,"wall_left"),a(this,"wall_right"),a(this,"wall_top"),a(this,"wall_bottom"),this.above_left=null,this.below_left=null,this.above_right=null,this.below_right=null,this.left_top=null,this.right_top=null,this.left_bottom=null,this.right_bottom=null,this.above_center=null,this.below_center=null,this.left_center=null,this.right_center=null,this.wall_left=null,this.wall_right=null,this.wall_top=null,this.wall_bottom=null}}class Ke{constructor(){a(this,"tselect"),a(this,"nselect"),a(this,"nlineselected"),a(this,"nshapeselected"),a(this,"nconnectorselected"),a(this,"ngroupsselected"),a(this,"nimageselected"),a(this,"IsTargetTable"),a(this,"paste"),a(this,"undo"),a(this,"redo"),a(this,"allowalign"),a(this,"width"),a(this,"height"),a(this,"left"),a(this,"top"),a(this,"widthstr"),a(this,"heightstr"),a(this,"leftstr"),a(this,"topstr"),a(this,"fontid"),a(this,"fontsize"),a(this,"bold"),a(this,"italic"),a(this,"underline"),a(this,"superscript"),a(this,"subscript"),a(this,"TextDirection"),a(this,"ncells_selected"),a(this,"NTableRows"),a(this,"NTableCols"),a(this,"cell_notext"),a(this,"celltype"),a(this,"cellselected"),a(this,"cellflags"),a(this,"ntablesselected"),a(this,"bInNoteEdit"),a(this,"allowcopy"),a(this,"selectionhastext"),a(this,"subtype"),a(this,"objecttype"),a(this,"datasetElemID"),a(this,"projectTableSelected"),a(this,"lockedTableSelected"),a(this,"fixedCornerRadius"),a(this,"lineCornerRadius"),a(this,"colorfilter"),a(this,"SelectionBusinessManager"),a(this,"WallThickness"),this.tselect=-1,this.nselect=0,this.nlineselected=0,this.nshapeselected=0,this.nconnectorselected=0,this.ngroupsselected=0,this.nimageselected=0,this.IsTargetTable=!1,this.paste=0,this.undo=!1,this.redo=!1,this.allowalign,this.width=0,this.height=0,this.left=0,this.top=0,this.widthstr="",this.heightstr="",this.leftstr="",this.topstr="",this.fontid=0,this.fontsize=12,this.bold=!1,this.italic=!1,this.underline=!1,this.superscript=!1,this.subscript=!1,this.TextDirection=!0,this.ncells_selected=0,this.NTableRows=4,this.NTableCols=3,this.cell_notext=!1,this.celltype=0,this.cellselected=!1,this.cellflags=0,this.ntablesselected=0,this.bInNoteEdit=!1,this.allowcopy=!1,this.selectionhastext=!1,this.subtype=0,this.objecttype=0,this.datasetElemID=-1,this.projectTableSelected=!1,this.lockedTableSelected=!1,this.fixedCornerRadius=0,this.lineCornerRadius=0,this.colorfilter=0,this.SelectionBusinessManager=null,this.WallThickness=0}}const Ye=class{};let Xe=Ye;a(Xe,"Contexts",{None:-1,All:0,Text:1,Automation:3,DimensionText:4,WallOpt:5,Note:6,Navigation:7,AutomationNoCtrl:8,ReadOnly:9}),a(Xe,"ModifierKeys",{None:0,Ctrl:1,Shift:2,Alt:3,Ctrl_Alt:4,Ctrl_Shift:5,Shift_Alt:6}),a(Xe,"Keys",{Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Caps_Lock:20,Escape:27,Space:32,Page_Up:33,Page_Down:34,End:35,Home:36,Left_Arrow:37,Up_Arrow:38,Right_Arrow:39,Down_Arrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Left_Window_Key:91,Right_Window_Key:92,Select_Key:93,Numpad_0:96,Numpad_1:97,Numpad_2:98,Numpad_3:99,Numpad_4:100,Numpad_5:101,Numpad_6:102,Numpad_7:103,Numpad_8:104,Numpad_9:105,Multiply:106,Add:107,Subtract:109,Decimal_Point:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Num_Lock:144,Scroll_Lock:145,Semi_Colon:186,Equal_Sign:187,Comma:188,Dash:189,Period:190,Forward_Slash:191,Grave_Accent:192,Open_Bracket:219,Back_Slash:220,Close_Bracket:221,Single_Quote:222}),a(Xe,"NonTextKeys",[Ye.Keys.Backspace,Ye.Keys.Tab,Ye.Keys.Enter,Ye.Keys.Left_Arrow,Ye.Keys.Up_Arrow,Ye.Keys.Right_Arrow,Ye.Keys.Down_Arrow,Ye.Keys.Delete,Ye.Keys.Escape]);var qe=Object.defineProperty,Je=Object.getOwnPropertyDescriptor;class $e{constructor(){a(this,"Paint"),a(this,"Hatch"),a(this,"FillEffect"),a(this,"EffectColor"),a(this,"WParam"),a(this,"LParam"),a(this,"SetPaint",(t=>(this.Paint=t,this))),this.Paint=new je(Se.Colors.White),this.Hatch=0,this.FillEffect=0,this.EffectColor=null,this.WParam=0,this.LParam=0}}((t,e,i,o)=>{for(var n,s=o>1?void 0:o?Je(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&qe(e,i,s)})([jt((()=>je))],$e.prototype,"Paint",2);var Ze=Object.defineProperty,Qe=Object.getOwnPropertyDescriptor;class ti{constructor(){a(this,"Paint"),a(this,"Hatch"),a(this,"LineEffect"),a(this,"Thickness"),a(this,"LinePattern"),a(this,"BThick"),a(this,"EdgeColor"),a(this,"LParam"),a(this,"WParam"),a(this,"SetPaint",(t=>(this.Paint=t,this))),this.Paint=new je(Se.Colors.Black),this.Hatch=0,this.LineEffect=0,this.Thickness=Se.StyleDefaults.DefThick,this.LinePattern=0,this.BThick=0,this.EdgeColor=null,this.LParam=0,this.WParam=0}}((t,e,i,o)=>{for(var n,s=o>1?void 0:o?Qe(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&Ze(e,i,s)})([jt((()=>je))],ti.prototype,"Paint",2);var ei=Object.defineProperty,ii=Object.getOwnPropertyDescriptor,oi=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?ii(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&ei(e,i,s),s};class ni{constructor(){a(this,"Name"),a(this,"Border"),a(this,"Fill"),a(this,"Line"),a(this,"OutsideEffect"),a(this,"Text"),a(this,"StyleRecord"),this.Name="t3",this.Fill=new $e,this.Border=new ti,this.OutsideEffect=new Be,this.Text=new Ue,this.Line=new ti}}oi([jt((()=>ti))],ni.prototype,"Border",2),oi([jt((()=>$e))],ni.prototype,"Fill",2),oi([jt((()=>ti))],ni.prototype,"Line",2),oi([jt((()=>Be))],ni.prototype,"OutsideEffect",2),oi([jt((()=>Ue))],ni.prototype,"Text",2);class si{static LineDStyleHit(t,e,i,o,n){let s,a,r,l,h,c,p,d,u,g,y,S,m,b=-1,D=0,f={x:0,y:0,width:0,height:0};c=i+12+o;const x=t.length;for(let C=0;C<x-1;C++)f=ve.Pt2Rect(t[C],t[C+1]),ve.InflateRect(f,c,c),ve.pointInRect(f,e)&&(t[C].x===t[C+1].x?(f=t[C].y<t[C+1].y?ve.SetRect(t[C].x-c,t[C].y,t[C].x+c,t[C+1].y):ve.SetRect(t[C].x-c,t[C+1].y,t[C].x+c,t[C].y),ve.pointInRect(f,e)&&(D=Se.HitCodes.Border,b=C,S=t[C].x,m=e.y)):t[C].y===t[C+1].y?(f=t[C].x<t[C+1].x?ve.SetRect(t[C].x,t[C].y-c,t[C+1].x,t[C].y+c):ve.SetRect(t[C+1].x,t[C].y-c,t[C].x,t[C].y+c),ve.pointInRect(f,e)&&(D=Se.HitCodes.Border,b=C,m=t[C].y,S=e.x)):(d=Math.abs(t[C].x-t[C+1].x),u=Math.abs(t[C].y-t[C+1].y),g=ve.Sqrt(u*u+d*d),y=e.x-t[C].x,u/d<1?(t[C].x<=t[C+1].x?(r=t[C].y,l=t[C+1].y):(l=t[C].y,r=t[C+1].y,y=e.x-t[C+1].x),a=r>l?r-u*y/d:r+u*y/d,p=(d?g/d:1)*c,e.y<=a+p&&e.y>=a-p&&(D=Se.HitCodes.Border,b=C,m=a,S=e.x)):(t[C].x<=t[C+1].x?(r=t[C].y,l=t[C+1].y,h=t[C].x):(l=t[C].y,r=t[C+1].y,h=t[C+1].x),s=r>l?h+d*(r-e.y)/u:h+d*(e.y-r)/u,p=(u?g/u:1)*c,e.x<=s+p&&e.x>=s-p&&(D=Se.HitCodes.Border,b=C,S=s,m=e.y))));return void 0!==S&&(e.x=S),void 0!==m&&(e.y=m),n&&(n.lpHit=b),D}static CloneToDoc(t,e){const i=document.createElementNS(t.namespaceURI,t.nodeName);for(let o=0,n=t.attributes.length;o<n;++o){const n=t.attributes[o];let s=n.nodeName;s.length&&(s[0]>="A"&&s[0]<="Z"&&(s=s.toLowerCase()),e?""!==n.nodeValue&&"xmlns"!==s&&i.setAttribute(s,n.nodeValue):""!==n.nodeValue&&i.setAttribute(s,n.nodeValue))}for(let o=0,n=t.childNodes.length;o<n;++o){const n=t.childNodes[o];1===n.nodeType?i.insertBefore(this.CloneToDoc(n,e),null):i.insertBefore(document.createTextNode(n.nodeValue),null)}return i}static XmlToStr(t){try{return(new XMLSerializer).serializeToString(t)}catch(e){try{return t.xml}catch(i){throw i}}}static StrEscapeRegExp(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}static StrReplaceAll(t,e,i){return i.replace(new RegExp(this.StrEscapeRegExp(t),"g"),e)}static RotatePointsAboutPoint(t,e,i){if(0===e)return;const o=Math.sin(e),n=Math.cos(e),s=Math.abs(n)<1e-4?0:n,a=Math.abs(o)<1e-4?0:o;for(let r=0;r<i.length;r++){const e=i[r].x-t.x,o=i[r].y-t.y;i[r].x=e*s+o*a+t.x,i[r].y=-e*a+o*s+t.y}}static RotatePointsAboutCenter(t,e,i){if(0===e)return;const o={x:(t.x+t.x+t.width)/2,y:(t.y+t.y+t.height)/2};si.RotatePointsAboutPoint(o,e,i)}static GetModifierKeys(t){let e=Xe.ModifierKeys.None;return t.ctrlKey||t.metaKey?(e=Xe.ModifierKeys.Ctrl,t.shiftKey?e=Xe.ModifierKeys.Ctrl_Shift:t.altKey&&(e=Xe.ModifierKeys.Ctrl_Alt)):t.shiftKey?(e=Xe.ModifierKeys.Shift,t.altKey&&(e=Xe.ModifierKeys.Shift_Alt)):t.altKey&&(e=Xe.ModifierKeys.Alt),e}static FindStyle(t){return new ni}static MakeShortUniqueID(){return"aaaaaaaaaaaaaaaa".replace(/a/g,(()=>Math.floor(16*Math.random()).toString(16)))}static ConvertToFeet(t){let e="",i="",o="",n=0,s=0,a=[],r=1;if(a=t.trim().split(" "),a[a.length-1].indexOf("/")>=0){if(e=a[a.length-1],a.length>=2){let t=a[a.length-2];"'"===t.substr(t.length-1,1)&&(o=a[a.length-2],i="")}a.length>=3&&(o=a[a.length-3])}else 2===a.length?(o=a[0],i=a[1]):'"'===a[0].charAt(a[0].length-1)?i=a[0]:o=a[0];if("'"===o.charAt(o.length-1)&&(o=o.substring(0,o.length-1)),'"'===i.charAt(i.length-1)&&(i=i.substring(0,i.length-1)),'"'===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),o.length>0&&(n=parseFloat(o)),i.length>0&&(s=parseFloat(i)),n<0&&(n=-n,r=-1),e.length>0){let t=e.split("/");s+=parseInt(t[0],10)/parseInt(t[1],10)}return(n+s/12)*r}static NumberIsFloat(t,e){const i="9".charCodeAt(0),o="0".charCodeAt(0),n=".".charCodeAt(0),s="-".charCodeAt(0);t=t.trim();for(let a=0;a<t.length;a++){const r=t.charCodeAt(a),l=r===n,h=e&&r===s;if(!(r<=i&&r>=o||l||h))return!1}return!0}}class ai{}a(ai,"GradientStyle",{Linear:"linear",Radial:"radial",Radialfill:"radialfill"}),a(ai,"GradientPos",{LeftTop:"ltop",Top:"top",RightTop:"rtop",Right:"right",RightBottom:"rbottom",Bottom:"bottom",LeftBottom:"lbottom",Left:"left",Center:"center"}),a(ai,"Placeholder",{FillColor:"##FillColor",EndColor:"##EndColor",FillTrans:"##FillTrans",LineColor:"##LineColor",LineTrans:"##LineTrans",LineThick:"##LineThick",SolidFill:"##SolidFill",StrokeColor:"##StrokeColor",Terminator:"##"}),a(ai,"PlaceholderDefault",{"##FillColor":"#FFFFFF","##EndColor":"#FFFFFF","##FillTrans":1,"##LineColor":"#000000","##LineTrans":1,"##LineThick":1,"##SolidFill":"#000000","##StrokeColor":"#000000"}),a(ai,"EffectType",{DROPSHADOW:{id:"SHD",outside:!0},CASTSHADOW:{id:"SHC",outside:!0},GLOW:{id:"GLW",outside:!0},REFLECT:{id:"REFL",outside:!0},BEVEL:{id:"BVL",inside:!0},GLOSS:{id:"GLOSS",inside:!0},INNERGLOW:{id:"IGLW",inside:!0},INNERSHADOW:{id:"ISHD",inside:!0},RECOLOR:{id:"RCLR",inside:!0}}),a(ai,"FilterDirection",{LEFT:"L",LEFTTOP:"LT",TOP:"T",RIGHTTOP:"RT",RIGHT:"R",RIGHTBOTTOM:"RB",BOTTOM:"B",LEFTBOTTOM:"LB",CENTER:"C"}),a(ai,"BevelType",{HARD:"H",SOFT:"S",BUMP:"B"}),a(ai,"GlossType",{Hard:"H",Soft:"S"}),a(ai,"EffectSize",{Default:{id:"D",percentage:.1},Small:{id:"S",percentage:.05},Medium:{id:"M",percentage:.25},Large:{id:"L",percentage:.1},Giant:{id:"G",percentage:.05}}),a(ai,"WordState",{Wrong:0,Correct:1,NotProcessed:2}),a(ai,"Globals",{MaxWordSize:100,MaxServerListSize:1400}),a(ai,"DictMap",{en:"24941","en-gb":"25202","en-ca":"25441","pt-br":"28770",da:"25697",nl:"25717",fi:"26217",fr:"26226",de:"26469",it:"26996",legal:"27745",medical:"28001",no:"25442",pt:"28783",es:"29552",sv:"29559"}),a(ai,"SpellFlags",{IgnoreInitCaps:1,IgnoreAllCaps:2,IgnoreMixedAlphaNum:4,IgnoreMixedCase:8});const ri=class{constructor(){a(this,"errorQueue",[]),a(this,"maxQueueSize",50),a(this,"listeners",new Set)}static getInstance(){return ri.instance||(ri.instance=new ri),ri.instance}handleError(t,e,i="medium"){const o={error:t,context:e,severity:i,timestamp:Date.now(),stackTrace:t.stack,userAgent:navigator.userAgent};this.addToQueue(o),this.notifyListeners(o),this.logError(o),"critical"===i&&this.handleCriticalError(o)}addToQueue(t){this.errorQueue.push(t),this.errorQueue.length>this.maxQueueSize&&this.errorQueue.shift()}notifyListeners(t){this.listeners.forEach((e=>{try{e(t)}catch(i){console.error("Error in error handler listener:",i)}}))}logError(t){const e=`[${t.severity.toUpperCase()}] ${t.context.component}.${t.context.function}: ${t.error.message}`;switch(t.severity){case"low":F.Info(e);break;case"medium":F.Warn(e);break;case"high":case"critical":F.Error(e,t.error)}}handleCriticalError(t){F.Error("CRITICAL ERROR DETECTED:",t.error),console.error("Critical error context:",t.context)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}getErrorHistory(){return[...this.errorQueue]}clearHistory(){this.errorQueue=[]}static initializeGlobalHandling(){const t=ri.getInstance();window.addEventListener("unhandledrejection",(e=>{var i,o,n,s,a,r,l;const h=e.reason instanceof Error?e.reason:new Error(String(e.reason));if(h.message.includes("gesto")||h.message.includes("selecto")||h.message.includes('can\'t access property "unset"')||(null==(i=h.stack)?void 0:i.includes("SelectoManager"))||(null==(o=h.stack)?void 0:o.includes("Selecto.vue"))||(null==(n=h.stack)?void 0:n.includes("gesto")))return F.Debug("[ErrorHandler] Selecto/Gesto error detected and ignored:",h.message),void e.preventDefault();const c=h.message.includes("node is undefined")||h.message.includes("node is null")||h.message.includes("Cannot read propert")||(null==(s=h.stack)?void 0:s.includes(".node."))||(null==(a=h.stack)?void 0:a.includes("getBBox"))||(null==(r=h.stack)?void 0:r.includes("getBoundingClientRect")),p=h.message.includes("Async component timed out")||h.message.includes("component timed out")||h.message.includes("timeout")||(null==(l=h.stack)?void 0:l.includes("defineAsyncComponent"));let d="medium";(c||p)&&(d="high"),t.handleError(h,{component:"Global",function:"unhandledrejection",userAction:"Promise rejection not caught",nodeRelated:c,asyncComponentError:p},d),F.Error("Unhandled Promise Rejection Details:",{reason:e.reason,promise:e.promise,stack:h.stack,timestamp:(new Date).toISOString(),isNodeError:c,isAsyncComponentError:p,errorMessage:h.message}),e.preventDefault()})),window.addEventListener("error",(e=>{var i,o,n;const s=e.error||new Error(e.message);s.message.includes("gesto")||s.message.includes("selecto")||s.message.includes('can\'t access property "unset"')||(null==(i=s.stack)?void 0:i.includes("SelectoManager"))||(null==(o=s.stack)?void 0:o.includes("Selecto.vue"))||(null==(n=s.stack)?void 0:n.includes("gesto"))?e.preventDefault():t.handleError(s,{component:"Global",function:"globalError",userAction:`Error in ${e.filename}:${e.lineno}:${e.colno}`},"high")}))}handleNodeError(t,e,i){var o;const n={...i,nodeInfo:{nodeType:null==e?void 0:e.nodeType,nodeName:null==e?void 0:e.nodeName,id:null==e?void 0:e.id,className:null==e?void 0:e.className,isConnected:null==e?void 0:e.isConnected,parentNode:null==(o=null==e?void 0:e.parentNode)?void 0:o.nodeName,exists:!!e}};F.Error("Node-related error details:",n),this.handleError(t,n,"high")}handleAsyncComponentError(t,e,i){const o={...i,componentInfo:{name:(null==e?void 0:e.name)||"Unknown",path:(null==e?void 0:e.path)||"Unknown",timeout:(null==e?void 0:e.timeout)||"Unknown",retryCount:(null==e?void 0:e.retryCount)||0,loadTime:(null==e?void 0:e.loadTime)||0,isTimeout:t.message.includes("timed out"),isAsyncComponent:!0}};F.Error("Async component error details:",o),this.handleError(t,o,"high")}static safeNodeAccess(t,e,i){try{const e=t();if(null==e)throw new Error("Node is "+(void 0===e?"undefined":"null"));return e}catch(o){return ri.getInstance().handleNodeError(o,null,{component:e.component||"Unknown",function:e.function||"safeNodeAccess",userAction:"Accessing DOM node"}),i||null}}};let li=ri;a(li,"instance");const hi=li.safeNodeAccess;var ci={ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",did:0,create:function(t){return document.createElementNS(this.ns,t)},extend:function(t,e){for(var i in e)t.prototype[i]=e[i]},svg:function(t){return new ci.Doc(t)},Element:function(t){t&&(this.node=t,this.type=t.nodeName),this.attrs={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,fill:"#000",stroke:"#000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0},this.trans={x:0,y:0,scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0}}};ci.extend(ci.Element,{move:function(t,e){return this.attr({x:t,y:e})},center:function(t,e){var i=this.bbox();return this.move(t-i.width/2,e-i.height/2)},size:function(t,e){return this.attr({width:t,height:e})},clone:function(){var t;if(this instanceof ci.Wrap)(t=this.parent[this.child.node.nodeName]()).attrs=this.attrs,t.child.trans=this.child.trans,t.child.attr(this.child.attrs).transform({}),t.plot&&t.plot(this.child.attrs[this.child instanceof ci.Path?"d":"points"]);else{const e=hi((()=>this.node.nodeName),{component:"T3Svg",function:"clone"});if(!e)return null;(t="rect"==e?this.parent[e](this.attrs.width,this.attrs.height):"ellipse"==e?this.parent[e](2*this.attrs.rx,2*this.attrs.ry):"image"==e?this.parent[e](this.src):"text"==e?this.parent[e](this.content):"g"==e?this.parent.group():this.parent[e]()).attr(this.attrs)}return t.trans=this.trans,t.transform({}),t},remove:function(){return null!=this.parent?this.parent.remove(this):void 0},doc:function(){return this._parent(ci.Doc)},nested:function(){return this._parent(ci.Nested)},attr:function(t,e,i){if(arguments.length<2){if("object"!=typeof t)return this._isStyle(t)?"text"==t?this.content:"leading"==t?this[t]:this.style[t]:this.attrs[t];for(var o in t)this.attr(o,t[o])}else{if(this.attrs[t]=e,"x"==t&&this._isText())for(var n=this.lines.length-1;n>=0;n--)this.lines[n].attr(t,e);else{const o=hi((()=>this.node),{component:"T3Svg",function:"attr"});o&&(null!=i?o.setAttributeNS(i,t,e):o.setAttribute(t,e))}this._isStyle(t)&&("text"==t?this.text(e):"leading"==t?this[t]=e:this.style[t]=e,this.text(this.content))}return this},transform:function(t){if("string"==typeof t)return this.trans[t];var e=[];for(var i in t)null!=t[i]&&(this.trans[i]=t[i]);if(0!=(t=this.trans).rotation){var o=this.bbox();e.push("rotate("+t.rotation+","+(null!=t.cx?t.cx:o.cx)+","+(null!=t.cy?t.cy:o.cy)+")")}return e.push("scale("+t.scaleX+","+t.scaleY+")"),0!=t.skewX&&e.push("skewX("+t.skewX+")"),0!=t.skewY&&e.push("skewY("+t.skewY+")"),e.push("translate("+t.x+","+t.y+")"),this.attr("transform",e.join(" "))},data:function(t,e){if(arguments.length<2)try{return JSON.parse(this.attr("data-"+t))}catch(i){return this.attr("data-"+t)}else{const i=hi((()=>this.node),{component:"T3Svg",function:"data"});i&&(null===e?i.removeAttribute("data-"+t):this.attr("data-"+t,JSON.stringify(e)))}return this},bbox:function(){const t=hi((()=>this.node),{component:"T3Svg",function:"bbox"});if(!t||"function"!=typeof t.getBBox)return{x:0,y:0,cx:0,cy:0,width:0,height:0};try{var e=t.getBBox();return{x:e.x+this.trans.x,y:e.y+this.trans.y,cx:e.x+this.trans.x+e.width/2,cy:e.y+this.trans.y+e.height/2,width:e.width,height:e.height}}catch(i){return li.getInstance().handleError(i,{component:"T3Svg",function:"bbox",userAction:"Getting bounding box"}),{x:0,y:0,cx:0,cy:0,width:0,height:0}}},rbox:function(){const t=hi((()=>this.node),{component:"T3Svg",function:"rbox"});if(!t||"function"!=typeof t.getBoundingClientRect)return{x:0,y:0,width:0,height:0};try{var e=t.getBoundingClientRect();return{x:e.left,y:e.top,width:e.width,height:e.height}}catch(i){return li.getInstance().handleError(i,{component:"T3Svg",function:"rbox",userAction:"Getting client rectangle"}),{x:0,y:0,width:0,height:0}}},inside:function(t,e){var i=this.bbox();return t>i.x&&e>i.y&&t<i.x+i.width&&e<i.y+i.height},show:function(){const t=hi((()=>this.node),{component:"T3Svg",function:"show"});return t&&t.style&&(t.style.display=""),this},hide:function(){const t=hi((()=>this.node),{component:"T3Svg",function:"hide"});return t&&t.style&&(t.style.display="none"),this},visible:function(){const t=hi((()=>this.node),{component:"T3Svg",function:"visible"});return!(!t||!t.style)&&"none"!=t.style.display},_parent:function(t){for(var e=this;null!=e&&!(e instanceof t);)e=e.parent;return e},_isStyle:function(t){return"string"==typeof t&&this._isText()&&/^font|text|leading/.test(t)},_isText:function(){return this instanceof ci.Text}}),ci.Container=function(t){this.constructor.call(this,t)},ci.Container.prototype=new ci.Element,ci.extend(ci.Container,{add:function(t,e){if(!this.has(t)){e=null==e?this.children().length:e,this.children().splice(e,0,t);const i=hi((()=>this.node),{component:"T3Svg",function:"add"}),o=hi((()=>t.node),{component:"T3Svg",function:"add"});i&&o&&i.insertBefore(o,i.childNodes[e]||null),t.parent=this}return this},put:function(t,e){return this.add(t,e),t},has:function(t){return this.children().indexOf(t)>=0},children:function(){return this._children||(this._children=[])},each:function(t){var e,i=this.children();for(e=0,length=i.length;e<length;e++)i[e]instanceof ci.Shape&&t.apply(i[e],[e,i]);return this},remove:function(t){return this.removeAt(this.children().indexOf(t))},removeAt:function(t){if(0<=t&&t<this.children().length){var e=this.children()[t];this.children().splice(t,1);const i=hi((()=>this.node),{component:"T3Svg",function:"removeAt"}),o=hi((()=>e.node),{component:"T3Svg",function:"removeAt"});i&&o&&i.removeChild(o),e.parent=null}return this},defs:function(){return this._defs||(this._defs=this.put(new ci.Defs,0))},level:function(){return this.remove(this.defs()).put(this.defs(),0)},group:function(){return this.put(new ci.G)},rect:function(t,e){return this.put((new ci.Rect).size(t,e))},circle:function(t){return this.ellipse(t)},ellipse:function(t,e){return this.put((new ci.Ellipse).size(t,e))},polyline:function(t){return this.put(new ci.Wrap(new ci.Polyline)).plot(t)},polygon:function(t){return this.put(new ci.Wrap(new ci.Polygon)).plot(t)},path:function(t){return this.put(new ci.Wrap(new ci.Path)).plot(t)},image:function(t,e,i){return e=null!=e?e:100,this.put((new ci.Image).load(t).size(e,null!=i?i:e))},text:function(t){return this.put((new ci.Text).text(t))},nested:function(){return this.put(new ci.Nested)},gradient:function(t,e){return this.defs().gradient(t,e)},pattern:function(t,e,i){return this.defs().pattern(t,e,i)},mask:function(){return this.defs().put(new ci.Mask)},first:function(){return this.children()[0]instanceof ci.Defs?this.children()[1]:this.children()[0]},last:function(){return this.children()[this.children().length-1]},clear:function(){this._children=[];const t=hi((()=>this.node),{component:"T3Svg",function:"clear"});if(t)for(;t.hasChildNodes();){const e=hi((()=>t.lastChild),{component:"T3Svg",function:"clear"});if(!e)break;t.removeChild(e)}return this}}),ci.FX=function(t){this.target=t},ci.extend(ci.FX,{animate:function(t,e){t=null==t?1e3:t,e=e||"<>";var i,o,n,s=this.target,a=this,r=(new Date).getTime(),l=r+t;return this.interval=setInterval((function(){var h,c=(new Date).getTime(),p=c>l?1:(c-r)/t;if(null==i)for(var d in i=[],a.attrs)i.push(d);if(null==o){for(var u in o=[],a.trans)o.push(u);n={}}h="<>"===e?-Math.cos(p*Math.PI)/2+.5:">"===e?Math.sin(p*Math.PI/2):"<"===e?1-Math.cos(p*Math.PI/2):"-"===e?p:"function"==typeof e?e(p):p,a._move?s.move(a._at(a._move.x,h),a._at(a._move.y,h)):a._center&&s.move(a._at(a._center.x,h),a._at(a._center.y,h)),a._size&&s.size(a._at(a._size.width,h),a._at(a._size.height,h));for(var g=i.length-1;g>=0;g--)s.attr(i[g],a._at(a.attrs[i[g]],h));if(o.length>0){for(g=o.length-1;g>=0;g--)n[o[g]]=a._at(a.trans[o[g]],h);s.transform(n)}c>l&&(clearInterval(a.interval),a._after?a._after.apply(s,[a]):a.stop())}),t>10?10:t),this},attr:function(t,e){if("object"==typeof t)for(var i in t)this.attr(i,t[i]);else this.attrs[t]={from:this.target.attr(t),to:e};return this},transform:function(t){for(var e in t)this.trans[e]={from:this.target.trans[e],to:t[e]};return this},move:function(t,e){var i=this.target.bbox();return this._move={x:{from:i.x,to:t},y:{from:i.y,to:e}},this},size:function(t,e){var i=this.target.bbox();return this._size={width:{from:i.width,to:t},height:{from:i.height,to:e}},this},center:function(t,e){var i=this.target.bbox();return this._move={x:{from:i.cx,to:t},y:{from:i.cy,to:e}},this},after:function(t){return this._after=t,this},stop:function(){return clearInterval(this.interval),this.attrs={},this.trans={},this._move=null,this._size=null,this._after=null,this},_at:function(t,e){return"number"==typeof t.from?t.from+(t.to-t.from)*e:t.to.r||/^#/.test(t.to)?this._color(t,e):e<1?t.from:t.to},_color:function(t,e){var i=this._h2r(t.from||"#000"),o=this._h2r(t.to);return this._r2h({r:~~(i.r+(o.r-i.r)*e),g:~~(i.g+(o.g-i.g)*e),b:~~(i.b+(o.b-i.b)*e)})},_h2r:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(this._fh(t));return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}},_r2h:function(t){return"#"+this._c2h(t.r)+this._c2h(t.g)+this._c2h(t.b)},_c2h:function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},_fh:function(t){return 4==t.length?"#"+t.substring(1,2)+t.substring(1,2)+t.substring(2,3)+t.substring(2,3)+t.substring(3,4)+t.substring(3,4):t}}),ci.extend(ci.Element,{animate:function(t,e){return(this._fx||(this._fx=new ci.FX(this))).stop().animate(t,e)},stop:function(){return this._fx.stop(),this}}),ci.on=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},ci.off=function(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent("on"+e,i)},ci.extend(ci.Element,{on:function(t,e){return ci.on(this.node,t,e),this},off:function(t,e){return ci.off(this.node,t,e),this}}),ci.G=function(){this.constructor.call(this,ci.create("g"))},ci.G.prototype=new ci.Container,ci.extend(ci.G,{defs:function(){return this.doc().defs()}}),ci.extend(ci.Element,{siblings:function(){return this.parent.children()},position:function(){return this.siblings().indexOf(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){return this.parent.remove(this).put(this,this.position()+1)},backward:function(){let t;return this.parent.level(),t=this.position(),t>1&&this.parent.remove(this).add(this,t-1),this},front:function(){return this.parent.remove(this).put(this)},back:function(){return this.parent.level(),this.position()>1&&this.parent.remove(this).add(this,0),this}}),ci.Defs=function(){this.constructor.call(this,ci.create("defs"))},ci.Defs.prototype=new ci.Container,ci.Mask=function(){this.constructor.call(this,ci.create("mask")),this.attr("id",this.id="svgjs_element_"+ci.did++)},ci.Mask.prototype=new ci.Container,ci.extend(ci.Element,{maskWith:function(t){return this.mask=t instanceof ci.Mask?t:this.parent.mask().add(t),this.attr("mask","url(#"+this.mask.id+")")}}),ci.Pattern=function(){this.constructor.call(this,ci.create("pattern")),this.attr("id",this.id="svgjs_element_"+ci.did++)},ci.Pattern.prototype=new ci.Container,ci.extend(ci.Pattern,{fill:function(){return"url(#"+this.id+")"}}),ci.extend(ci.Defs,{pattern:function(t,e,i){var o=this.put(new ci.Pattern);return i(o),o.attr({x:0,y:0,width:t,height:e,patternUnits:"userSpaceOnUse"}),o}}),ci.Gradient=function(t){this.constructor.call(this,ci.create(t+"Gradient")),this.attr("id",this.id="svgjs_element_"+ci.did++),this.type=t},ci.Gradient.prototype=new ci.Container,ci.extend(ci.Gradient,{from:function(t,e){return"radial"==this.type?this.attr({fx:t+"%",fy:e+"%"}):this.attr({x1:t+"%",y1:e+"%"})},to:function(t,e){return"radial"==this.type?this.attr({cx:t+"%",cy:e+"%"}):this.attr({x2:t+"%",y2:e+"%"})},radius:function(t){return"radial"==this.type?this.attr({r:t+"%"}):this},at:function(t){return this.put(new ci.Stop(t))},update:function(t){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return t(this),this},fill:function(){return"url(#"+this.id+")"}}),ci.extend(ci.Defs,{gradient:function(t,e){var i=this.put(new ci.Gradient(t));return e(i),i}}),ci.Stop=function(t){this.constructor.call(this,ci.create("stop")),this.update(t)},ci.Stop.prototype=new ci.Element,ci.extend(ci.Stop,{update:function(t){var e,i="",o=["opacity","color"];for(e=o.length-1;e>=0;e--)null!=t[o[e]]&&(i+="stop-"+o[e]+":"+t[o[e]]+";");return this.attr({offset:(null!=t.offset?t.offset:this.attrs.offset||0)+"%",style:i})}}),ci.Doc=function(t){this.constructor.call(this,ci.create("svg")),this.parent="string"==typeof t?document.getElementById(t):t,this.attr({xmlns:ci.ns,version:"1.1",width:"100%",height:"100%"}).attr("xmlns:xlink",ci.xlink).attr("xlink",ci.xlink,ci.ns).defs(),this.stage()},ci.Doc.prototype=new ci.Container,ci.Doc.prototype.stage=function(){const t=this.parent,e=document.createElement("div");e.style.cssText="position:relative;height:100%;",t?t.appendChild(e):(this.parent=document.createElement("div"),this.parent.appendChild(e)),e.appendChild(this.node);const i=()=>{"complete"===document.readyState?(this.attr("style","position:absolute;overflow:hidden;"),setTimeout((()=>{this.attr("style","position:relative;overflow:hidden;");try{t.removeChild(this.node.parentNode),this.node.parentNode.removeChild(this.node),t.appendChild(this.node)}catch(e){console.error(e)}}),5)):setTimeout(i,10)};return i(),this},ci.Shape=function(t){this.constructor.call(this,t)},ci.Shape.prototype=new ci.Element,ci.Wrap=function(t){this.constructor.call(this,ci.create("g")),this.node.insertBefore(t.node,null),this.child=t,this.type=t.node.nodeName},ci.Wrap.prototype=new ci.Shape,ci.extend(ci.Wrap,{move:function(t,e){return this.transform({x:t,y:e})},size:function(t,e){var i=t/this._b.width;return this.child.transform({scaleX:i,scaleY:null!=e?e/this._b.height:i}),this},center:function(t,e){return this.move(t+this._b.width*this.child.trans.scaleX/-2,e+this._b.height*this.child.trans.scaleY/-2)},attr:function(t,e,i){if("object"==typeof t)for(var o in t)this.attr(o,t[o]);else{if(arguments.length<2)return"transform"==t?this.attrs[t]:this.child.attrs[t];"transform"==t?(this.attrs[t]=e,null!=i?this.node.setAttributeNS(i,t,e):this.node.setAttribute(t,e)):this.child.attr(t,e,i)}return this},plot:function(t){return this.child.plot(t),this._b=this.child.bbox(),this.child.transform({x:-this._b.x,y:-this._b.y}),this}}),ci.Rect=function(){this.constructor.call(this,ci.create("rect"))},ci.Rect.prototype=new ci.Shape,ci.extend(ci.Rect,{move:function(t,e){return this.attr({x:t,y:e})},size:function(t,e){return this.attr({width:t,height:e})},center:function(t,e){return this.move(t-this.attr("width")/2,e-this.attr("height")/2)}}),ci.Ellipse=function(){this.constructor.call(this,ci.create("ellipse"))},ci.Ellipse.prototype=new ci.Shape,ci.extend(ci.Ellipse,{move:function(t,e){return this.attrs.x=t,this.attrs.y=e,this.center()},size:function(t,e){return this.attr({rx:t/2,ry:(null!=e?e:t)/2}).center()},center:function(t,e){return this.attr({cx:t||(this.attrs.x||0)+(this.attrs.rx||0),cy:e||(this.attrs.y||0)+(this.attrs.ry||0)})}}),ci.Line=function(){this.constructor.call(this,ci.create("line"))},ci.Line.prototype=new ci.Shape,ci.extend(ci.Line,{move:function(t,e){var i=this.bbox();return this.attr({x1:this.attr("x1")-i.x+t,y1:this.attr("y1")-i.y+e,x2:this.attr("x2")-i.x+t,y2:this.attr("y2")-i.y+e})},center:function(t,e){var i=this.bbox();return this.move(t-i.width/2,e-i.height/2)},size:function(t,e){var i=this.bbox();return this.attr(this.attr("x1")<this.attr("x2")?"x2":"x1",i.x+t),this.attr(this.attr("y1")<this.attr("y2")?"y2":"y1",i.y+e),this}}),ci.extend(ci.Container,{line:function(t,e,i,o){return this.put((new ci.Line).attr({x1:t,y1:e,x2:i,y2:o}))}}),ci.Poly={plot:function(t){return this.attr("points",t||"0,0"),this}},ci.Polyline=function(){this.constructor.call(this,ci.create("polyline"))},ci.Polyline.prototype=new ci.Shape,ci.extend(ci.Polyline,ci.Poly),ci.Polygon=function(){this.constructor.call(this,ci.create("polygon"))},ci.Polygon.prototype=new ci.Shape,ci.extend(ci.Polygon,ci.Poly),ci.Path=function(){this.constructor.call(this,ci.create("path"))},ci.Path.prototype=new ci.Shape,ci.extend(ci.Path,{move:function(t,e){this.transform({x:t,y:e})},plot:function(t){return this.attr("d",t||"M0,0")}}),ci.Image=function(){this.constructor.call(this,ci.create("image"))},ci.Image.prototype=new ci.Shape,ci.extend(ci.Image,{load:function(t){return this.src=t,t?this.attr("xlink:href",t,ci.xlink):this}});var pi=["size","family","weight","stretch","variant","style"];function di(){this.constructor.call(this,ci.create("tspan"))}ci.Text=function(){this.constructor.call(this,ci.create("text")),this.style={"font-size":16,"font-family":"Helvetica","text-anchor":"start"},this.leading=1.2},ci.Text.prototype=new ci.Shape,ci.extend(ci.Text,{text:function(t){this.content=t=t||"text",this.lines=[];var e=this._style();this.doc();for(var i=t.split("\n"),o=this.style["font-size"];this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);for(var n=0,s=i.length;n<s;n++){var a=(new di).text(i[n]).attr({dy:o*this.leading-(0===n?.3*o:0),x:this.attrs.x||0,style:e});this.node.appendChild(a.node),this.lines.push(a)}return this.attr("style",e)},_style:function(){for(var t="",e=pi.length-1;e>=0;e--){var i=pi[e];null!=this.style["font-"+i]&&(t+="font-"+i+":"+this.style["font-"+i]+";")}return t+="text-anchor:"+this.style["text-anchor"]+";"}}),di.prototype=new ci.Shape,ci.extend(di,{text:function(t){return this.node.appendChild(document.createTextNode(t)),this}}),ci.Nested=function(){this.constructor.call(this,ci.create("svg")),this.attr("overflow","visible")},ci.Nested.prototype=new ci.Container,ci._stroke=["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],ci._fill=["color","opacity","rule"];var ui=function(t,e){return"color"===e?t:t+"-"+e};["fill","stroke"].forEach((function(t){ci.Shape.prototype[t]=function(e){var i;if("string"==typeof e)this.attr(t,e);else{var o=ci["_"+t];for(i=o.length-1;i>=0;i--){var n=o[i];null!=e[n]&&this.attr(ui(t,n),e[n])}}return this}})),[ci.Element,ci.FX].forEach((function(t){t&&ci.extend(t,{rotate:function(t){return this.transform({rotation:t||0})},skew:function(t,e){return this.transform({skewX:t||0,skewY:e||0})},scale:function(t,e){return this.transform({scaleX:t,scaleY:null==e?t:e})},opacity:function(t){return this.attr("opacity",t)}})})),ci.G&&ci.extend(ci.G,{move:function(t,e){return this.transform({x:t,y:e})}}),ci.Text&&ci.extend(ci.Text,{font:function(t){var e,i={};for(e in t)"leading"===e?i[e]=t[e]:"anchor"===e?i["text-anchor"]=t[e]:pi.indexOf(e)>-1&&(i["font-"+e]=t[e]);return this.attr(i).text(this.content)}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchend","touchmove","touchcancel"].forEach((function(t){ci.Element.prototype[t]=function(e){const i=this;return this.node["on"+t]="function"==typeof e?function(){return e.apply(i,arguments)}:null,this}})),ci.ForeignObject=function(){this.constructor.call(this,ci.create("foreignObject"))},ci.ForeignObject.prototype=new ci.Container,ci.extend(ci.ForeignObject,{move:function(t,e){return this.attr({x:t,y:e})},size:function(t,e){return this.attr({width:t,height:e})},html:function(t){if("string"==typeof t){const e=document.createElement("div");e.textContent=t,this.node.innerHTML=e.innerHTML}else t instanceof HTMLElement&&(this.node.innerHTML="",this.node.appendChild(t));return this}}),ci.extend(ci.Container,{foreignObject:function(t,e){return this.put((new ci.ForeignObject).size(t,e))}});const gi=ci;class yi{constructor(){a(this,"x"),a(this,"y"),a(this,"width"),a(this,"height"),this.x=0,this.y=0,this.width=0,this.height=0}}class Si{constructor(t){a(this,"element"),a(this,"curBounds"),this.element=t,this.curBounds=new yi}SetEffects(t,e){let i=this.GetEffectsID(t,!1),o=[],n=ai.EffectSize.Default,s=ai.EffectSize.Default,a=!1,r=0,l=0;t&&(l=t.length||0),e=e||this.curBounds,this.curBounds=e,e&&(n=e.width<500?ai.EffectSize.Small:e.width<1500?ai.EffectSize.Medium:e.width<3e3?ai.EffectSize.Large:ai.EffectSize.Giant,s=e.height<500?ai.EffectSize.Small:e.height<1500?ai.EffectSize.Medium:e.height<3e3?ai.EffectSize.Large:ai.EffectSize.Giant);for(let h=0;h<l;h++)Si.IsSecondaryEffect(t[h])?o.push(t[h]):r++;if(r&&!this.FilterLimitNeeded(e,n,s)||(this.element.svgObj.node.removeAttribute("filter"),this.element.svgObj.attr.filter&&delete this.element.svgObj.filter,a=!0),!o.length&&this.element.externalEffects){for(let t=0;t<this.element.externalEffects.length;t++)this.element.parent.RemoveElement(this.element.externalEffects[t],!0);this.element.externalEffects=null}if(!a||o.length){if(!a){if(i+=n.id+s.id,!this.element.doc.DefExists(i)){let e=new gi.Container(gi.create("filter")),o="SourceGraphic",a=[];e.attr("id",i),e.attr("x",-n.percentage),e.attr("y",-s.percentage),e.attr("width",1+2*n.percentage),e.attr("height",1+2*s.percentage);for(let i=0;i<l;i++)t[i].type.inside&&this.DefineEffect(e,t[i].type,t[i].params,o,"sourceEffect")&&(o="sourceEffect");for(let i=0;i<l;i++)if(t[i].type.outside)if(t[i].type.id==ai.EffectType.CASTSHADOW.id||t[i].type.id==ai.EffectType.REFLECT.id)t[i];else{let n="oEffect"+i;this.DefineEffect(e,t[i].type,t[i].params,o,n)&&a.push(n)}let r=new gi.Container(gi.create("feMerge")),h=a.length;for(let t=0;t<h;t++){let e=new gi.Element(gi.create("feMergeNode"));e.attr("in",a[t]),r.add(e)}let c=new gi.Element(gi.create("feMergeNode"));c.attr("in",o),r.add(c),e.add(r),this.element.doc.Defs().add(e)}this.element.SetEffect(i)}if(o.length){for(let t=0;t<o.length;t++){let e=o[t];e.effectID=this.GetEffectsID([e],!0)}if(this.element.externalEffects)for(let t=this.element.externalEffects.length-1;t>=0;t--){let e=this.element.externalEffects[t],i=e.GetID();for(let t=0;t<o.length;t++){let n=o[t];if(i==n.effectID){n.elem=e;break}}this.element.parent.RemoveElement(this.element.externalEffects[t],!0)}this.element.externalEffects=[];for(let t=0;t<o.length;t++){let i=o[t],a=i.elem;a||(a=this.CreateSecondaryEffectElement(i,e,n,s),a.SetID(i.effectID)),a&&(this.element.externalEffects.push(a),this.element.parent.AddElement(a,t,!0))}}}}CreateSecondaryEffectElement(t,e,i,o){let n;return Si.IsSecondaryEffect(t)&&(n=this.element.doc.CreateShape(me.CSType.ShapeCopy),n&&(n.SetElementSource(this.element),n.Effects().SetSecondaryEffect(t,e,i,o),n.svgObj.attr("sfx",1))),n}SetSecondaryEffect(t,e,i,o){}ClearEffects(){this.SetEffects()}FilterLimitNeeded(t,e,i){if(!t)return!1;let o=this.element.doc.GetWorkArea(),n=1+2*e.pct,s=1+2*i.pct,a=t.width*o.docToScreenScale*n,r=t.height*o.docToScreenScale*s;return a>4096||r>4096}GetEffectsID(t,e){let i="T3",o=0,n=0,s=t&&t.length||0;if(!s)return i+"_NONE";e=e||!1;for(let a=0;a<s;a++)if(t[a].type.outside){if(Si.IsSecondaryEffect(t[a])!==e)continue;i+="_"+t[a].type.id,void 0!==t[a].params.xOff&&(i+="."+t[a].params.xOff),void 0!==t[a].params.yOff&&(i+="."+t[a].params.yOff),void 0!==t[a].params.size&&(i+="."+t[a].params.size),void 0!==t[a].params.color&&(i+=t[a].params.color),o++}for(let a=0;a<s;a++)t[a].type.inside&&(i+="_"+t[a].type.id,void 0!==t[a].params.size&&(i+="."+t[a].params.size),void 0!==t[a].params.type&&(i+="."+t[a].params.type),void 0!==t[a].params.dir&&(i+="."+t[a].params.dir),void 0!==t[a].params.color&&(i+=t[a].params.color),n++);return o||n||(i+="_NONE"),i}DefineEffect(t,e,i,o,n){let s=!0;switch(e.id){case ai.EffectType.DROPSHADOW.id:this.DefineDropShadow(t,i,o,n);break;case ai.EffectType.CASTSHADOW.id:this.DefineCastShadow(t,i,o,n);break;case ai.EffectType.REFLECT.id:this.DefineReflect(t,i,o,n);break;case ai.EffectType.GLOW.id:this.DefineGlow(t,i,o,n);break;case ai.EffectType.BEVEL.id:this.DefineBevel(t,i,o,n);break;case ai.EffectType.GLOSS.id:this.DefineGloss(t,i,o,n);break;case ai.EffectType.INNERGLOW.id:this.DefineInnerGlow(t,i,o,n);break;case ai.EffectType.INNERSHADOW.id:this.DefineInnerShadow(t,i,o,n);break;case ai.EffectType.RECOLOR.id:this.DefineRecolor(t,i,o,n);break;default:s=!1}return s}DefineDropShadow(t,e,i,o){let n,s=e.xOff||0,a=e.yOff||0,r=e.color||"#000",l=e.size||2;n=new gi.Element(gi.create("feFlood")),n.attr("flood-color",r),n.attr("flood-opacity",.3),n.attr("result","flood"),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr("in","flood"),n.attr("in2","SourceAlpha"),n.attr("operator","in"),n.attr("result","mask"),t.add(n),n=new gi.Element(gi.create("feGaussianBlur")),n.attr("in","mask"),n.attr("stdDeviation",l),t.add(n),n=new gi.Element(gi.create("feOffset")),n.attr("dx",s),n.attr("dy",a),n.attr("result",o),t.add(n)}DefineCastShadow(t,e,i,o){let n,s=e.size||2;n=new gi.Element(gi.create("feFlood")),n.attr("flood-color","#FFF"),n.attr("flood-opacity",.3),n.attr("result","flood"),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr("in2","flood"),n.attr("in","SourceAlpha"),n.attr("operator","in"),n.attr("result","mask"),t.add(n),n=new gi.Element(gi.create("feGaussianBlur")),n.attr("in","mask"),n.attr("stdDeviation",s),t.add(n)}DefineReflect(t,e,i,o){let n;n=new gi.Element(gi.create("feFlood")),n.attr("flood-color","#FFF"),n.attr("flood-opacity",.3),n.attr("result","flood"),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr("in2","flood"),n.attr("in",i),n.attr("operator","in"),n.attr("result","mask"),o&&n.attr("result",o),t.add(n)}DefineGlow(t,e,i,o){let n,s=e.color||"#fff",a=e.size||2;n=new gi.Element(gi.create("feFlood")),n.attr("flood-color",s),n.attr("result","flood"),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr("in","flood"),n.attr("in2","SourceAlpha"),n.attr("operator","in"),n.attr("result","mask"),t.add(n),n=new gi.Element(gi.create("feGaussianBlur")),n.attr("in","mask"),n.attr("stdDeviation",a),n.attr("result",o),t.add(n)}DefineBevel(t,e,i,o){let n,s,a=e.size||1,r=6,l=0;switch(e.dir||ai.FilterDirection.LEFTTOP){case ai.FilterDirection.RIGHT:l=0;break;case ai.FilterDirection.RIGHTBOTTOM:l=45;break;case ai.FilterDirection.BOTTOM:l=90;break;case ai.FilterDirection.LEFTBOTTOM:l=135;break;case ai.FilterDirection.LEFT:l=180;break;case ai.FilterDirection.LEFTTOP:l=225;break;case ai.FilterDirection.TOP:l=270;break;case ai.FilterDirection.RIGHTTOP:l=315}e.type==ai.BevelType.HARD&&(r=20),e.type==ai.BevelType.BUMP?(n=new gi.Element(gi.create("feMorphology")),n.attr({in:"SourceAlpha",operator:"erode",radius:a}),t.add(n),n=new gi.Element(gi.create("feGaussianBlur")),n.attr({stdDeviation:a,result:"blur"}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in:"blur",in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"inner"}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in:"blur",in2:"inner",operator:"in"}),t.add(n)):(n=new gi.Element(gi.create("feGaussianBlur")),n.attr({in:"SourceAlpha",stdDeviation:a}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"SourceAlpha",operator:"in"}),t.add(n)),n=new gi.Container(gi.create("feDiffuseLighting")),n.attr({surfaceScale:r,"lighting-color":"white",diffuseConstant:"1",result:"hilite"}),s=new gi.Element(gi.create("feDistantLight")),s.attr({azimuth:l,elevation:"40"}),n.add(s),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in:i,in2:"hilite",k1:1.5,operator:"arithmetic",result:o}),t.add(n)}DefineGloss(t,e,i,o){let n,s,a=e.size||2,r=e.dir||ai.FilterDirection.LEFTTOP,l=e.type||ai.GlossType.Soft,h=e.color||"#ffffff",c=1,p=0;switch(r){case ai.FilterDirection.RIGHT:p=0;break;case ai.FilterDirection.RIGHTBOTTOM:p=45;break;case ai.FilterDirection.BOTTOM:p=90;break;case ai.FilterDirection.LEFTBOTTOM:p=135;break;case ai.FilterDirection.LEFT:p=180;break;case ai.FilterDirection.LEFTTOP:p=225;break;case ai.FilterDirection.TOP:p=270;break;case ai.FilterDirection.RIGHTTOP:p=315}l==ai.GlossType.Hard&&(c=1.2),a/=4,a=Math.max(Math.min(a,20),2),n=new gi.Element(gi.create("feGaussianBlur")),n.attr({in:"SourceAlpha",stdDeviation:a}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"SourceAlpha",operator:"in"}),t.add(n),n=new gi.Container(gi.create("feSpecularLighting")),n.attr({surfaceScale:20,"lighting-color":"white",specularConstant:c,specularExponent:2,result:"hilite"}),s=new gi.Element(gi.create("feDistantLight")),s.attr({azimuth:p,elevation:"40"}),n.add(s),t.add(n),n=new gi.Element(gi.create("feFlood")),n.attr({"flood-color":h,"flood-opacity":.7}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"SourceAlpha",operator:"in",result:"flood"}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in:"hilite",in2:"flood",k1:1.5,operator:"arithmetic"}),t.add(n),n=new gi.Element(gi.create("feBlend")),n.attr({in2:i,mode:"lighten",result:o}),t.add(n)}DefineInnerGlow(t,e,i,o){let n,s=e.color||"#fff",a=e.size||0;n=new gi.Element(gi.create("feGaussianBlur")),n.attr({in:"SourceAlpha",stdDeviation:a}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowdiff"}),t.add(n),n=new gi.Element(gi.create("feFlood")),n.attr({"flood-color":s,"flood-opacity":1}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"shadowdiff",operator:"in"}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:i,operator:"over",result:o}),t.add(n)}DefineInnerShadow(t,e,i,o){let n,s=e.dir||ai.FilterDirection.LEFTTOP,a=e.size||0,r=0,l=0;switch(s){case ai.FilterDirection.RIGHT:r=-a,l=0;break;case ai.FilterDirection.RIGHTBOTTOM:r=-a,l=-a;break;case ai.FilterDirection.BOTTOM:r=0,l=-a;break;case ai.FilterDirection.LEFTBOTTOM:r=a,l=-a;break;case ai.FilterDirection.LEFT:r=a,l=0;break;case ai.FilterDirection.LEFTTOP:r=a,l=a;break;case ai.FilterDirection.TOP:r=0,l=a;break;case ai.FilterDirection.RIGHTTOP:r=-a,l=a}n=new gi.Element(gi.create("feGaussianBlur")),n.attr({in:"SourceAlpha",stdDeviation:a}),t.add(n),n=new gi.Element(gi.create("feOffset")),n.attr({dx:r,dy:l}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowdiff"}),t.add(n),n=new gi.Element(gi.create("feFlood")),n.attr({"flood-color":"black","flood-opacity":1}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"shadowdiff",operator:"in"}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:i,operator:"over",result:o}),t.add(n)}DefineRecolor(t,e,i,o){let n,s=e.color||"#000000";n=new gi.Element(gi.create("feFlood")),n.attr({"flood-color":s,"flood-opacity":1}),t.add(n),n=new gi.Element(gi.create("feComposite")),n.attr({in2:"SourceAlpha",operator:"in",result:o}),t.add(n)}static CalcSecondaryEffectOffset(t,e){let i=Math.abs(e),o=Math.max(-i,2*t);o=Math.min(o,i);let n=o/i*45;return i/Math.tan((90-n)*Math.PI/180)}static IsSecondaryEffect(t){return!(!t||!t.type)&&(t.params.asSecondary||t.type.id===ai.EffectType.CASTSHADOW.id||t.type.id===ai.EffectType.REFLECT.id)}}class mi{constructor(){a(this,"x"),a(this,"y"),a(this,"width"),a(this,"height"),this.x=0,this.y=0,this.width=-1,this.height=-1}}class bi{}a(bi,"TextFace",{Bold:1,Italic:2,Underline:4,Superscript:16,Subscript:32,Strike:64}),a(bi,"TextFlags",{BadSpell:32}),a(bi,"TextStyleCodes",{Font:0,Size:1,Face:2,Flags:3,Color:4,StyleId:5,Extra:7,LinkId:10,DataId:11,PaintType:20,SizeFloat:25}),a(bi,"TextJust",{Left:0,Right:2,Center:6,Top:0,Bottom:8}),a(bi,"TextAlign",{Left:"left",Center:"center",Right:"right",TopLeft:"top-left",TopCenter:"top-center",TopRight:"top-right",BottomLeft:"bottom-left",BottomCenter:"bottom-center",BottomRight:"bottom-right"}),a(bi,"TextureAlign",{TopLeft:1,TopCenter:2,TopRight:3,CenterLeft:4,Center:5,CenterRight:6,BottomLeft:7,BottomCenter:8,BottomRight:9});class Di{constructor(){a(this,"doc"),a(this,"parent"),a(this,"svgObj"),a(this,"ID"),a(this,"style"),a(this,"effects"),a(this,"userData"),a(this,"cursor"),a(this,"strokeWidth"),a(this,"mirrored"),a(this,"flipped"),a(this,"geometryBBox"),a(this,"fillPatternData"),a(this,"strokePatternData"),a(this,"internalID"),a(this,"eventProxy"),a(this,"fillGradientData"),a(this,"strokeGradientData"),a(this,"strokeDashArray"),this.doc=null,this.parent=null,this.svgObj=null}InitElement(t,e){this.doc=t,this.parent=e,this.svgObj.SDGObj=this,this.ID=null,this.style=null,this.effects=null,this.userData=null,this.cursor=null,this.strokeWidth=0,this.mirrored=!1,this.flipped=!1,this.geometryBBox=new mi,this.fillPatternData=null,this.strokePatternData=null,this.internalID=null}CreateElement(t,e){throw this.InitElement(t,e)}Document(){return this.doc}Parent(){return this.parent}DOMElement(){return this.svgObj?this.svgObj.node:null}InDocument(){if(!this.svgObj)return!1;let t=this.svgObj.parent;for(;t;){if("svg"===t.type)return!0;t=t.parent}return!1}SetID(t){this.ID=t}ExcludeFromExport(t){t?this.svgObj.node.setAttribute("no-export","1"):this.svgObj.node.removeAttribute("no-export")}SetCustomAttribute(t,e){e?this.svgObj.node.setAttribute(t,e):this.svgObj.node.removeAttribute(t)}GetCustomAttribute(t){return this.svgObj.node.getAttribute(t)}SetHyperlinkAttribute(t){}GetID(){return this.ID}GetInternalID(){return this.internalID||(this.internalID=Oe.MakeGuid())}SetInternalID(){const t=this.GetInternalID();return this.svgObj.attr("id",t),t}SetUserData(t){this.userData=t}GetUserData(){return this.userData}SetEventProxy(t){this.eventProxy=t}GetEventProxy(){return this.eventProxy}SetSize(t,e){t=Oe.RoundCoord(t),e=Oe.RoundCoord(e),this.svgObj.size(t,e),this.UpdateTransform(),this.geometryBBox.width=t,this.geometryBBox.height=e,this.RefreshPaint()}SetPos(t,e){t=Oe.RoundCoord(t),e=Oe.RoundCoord(e),this.svgObj.transform({x:t,y:e}),this.GetRotation()&&this.SetRotation(this.GetRotation()),this.UpdateTransform(),this.RefreshPaint(!0)}GetPos(){return{x:this.svgObj.trans.x,y:this.svgObj.trans.y}}SetCenter(t,e){const i=this.CalcBBox(),o=t-i.width/2,n=e-i.height/2;this.SetPos(o,n)}SetRotation(t,e,i){let o;void 0===e&&(o=this.CalcBBox(),e=o.cx),void 0===i&&(o=o||this.CalcBBox(),i=o.cy),e=Oe.RoundCoord(e),i=Oe.RoundCoord(i),t=Oe.RoundCoord(t),this.svgObj.transform({rotation:t,cx:e,cy:i}),this.UpdateTransform()}GetRotation(){const t=this.svgObj.trans.rotation;return"number"==typeof t?t:0}SetMirror(t){this.mirrored=t,this.UpdateTransform()}GetMirror(){return this.mirrored}SetFlip(t){this.flipped=t,this.UpdateTransform()}GetFlip(){return this.flipped}SetScale(t,e){this.GetScaleElement().transform({scaleX:t,scaleY:e}),this.UpdateTransform()}GetScale(){const t=this.GetScaleElement();return{scaleX:t.trans.scaleX||1,scaleY:t.trans.scaleY||1}}SetVisible(t){t?this.svgObj.show():this.svgObj.hide()}GetVisible(){return this.svgObj.visible()}GetBBox(){let t,e=null;return this.parent||(e=this.doc.GetFormattingLayer(),e.AddElement(this)),t=this.svgObj.bbox(),e&&e.RemoveElement(this),t}CalcBBox(){const t=this.CalcElementFrame(!0);return{...t,cx:t.x+t.width/2,cy:t.y+t.height/2}}GetRBox(){let t=null;this.parent||(t=this.doc.GetFormattingLayer(),t.AddElement(this));const e=this.svgObj.rbox();return t&&t.RemoveElement(this),e}UpdateTransform(){F.Debug("= B.Element: UpdateTransform - Starting transformation update for element",this.ID);let t=null;this.parent||(F.Debug("= B.Element: UpdateTransform - No parent found, using formatting layer"),t=this.doc.GetFormattingLayer(),t.AddElement(this));const e=this.GetScaleElement();if(e.transform({}),this.mirrored||this.flipped){let t;const i=this.CalcBBox(),o=e.trans.scaleX||1,n=e.trans.scaleY||1;F.Debug("= B.Element: UpdateTransform - Processing mirror/flip with scales",{horizontalScale:o,verticalScale:n}),t=e.node.transform.baseVal.consolidate().matrix,i.width/=o,i.height/=n,this.mirrored&&(F.Debug("= B.Element: UpdateTransform - Applying horizontal mirroring"),t=t.flipX().translate(-i.width,0)),this.flipped&&(F.Debug("= B.Element: UpdateTransform - Applying vertical flipping"),t=t.flipY().translate(0,-i.height));const s=`matrix(${Oe.RoundCoord(t.a)} ${Oe.RoundCoord(t.b)} ${Oe.RoundCoord(t.c)} ${Oe.RoundCoord(t.d)} ${Oe.RoundCoord(t.e)} ${Oe.RoundCoord(t.f)})`;e.attr("transform",s),F.Debug("= B.Element: UpdateTransform - Applied transformation matrix",s)}t&&(t.RemoveElement(this),F.Debug("= B.Element: UpdateTransform - Removed from temporary formatting layer")),F.Debug("= B.Element: UpdateTransform - Completed transformation update")}GetScaleElement(){return this.svgObj}CalcElementFrame(t){for(var e=this.GetGeometryBBox(),i={x:e.x,y:e.y,width:e.width,height:e.height},o=this.svgObj;o&&o!==this.doc.svgObj&&(i.x+=o.trans.x,i.y+=o.trans.y,o=o.parent,!t););return i}GetGeometryBBox(){if(this.geometryBBox.width<0||this.geometryBBox.height<0){const t=this.doc.GetFormattingLayer(),e={x:this.svgObj.trans.x,y:this.svgObj.trans.y},i=this.svgObj.trans.rotation,o=this.svgObj.parent;let n=0;o&&(n=this.svgObj.position(),o.remove(this.svgObj)),t.svgObj.add(this.svgObj),this.svgObj.transform({x:0,y:0,rotation:0});const s=this.svgObj.rbox();t.svgObj.remove(this.svgObj);const a=this.doc.ConvertWindowToDocCoords(s.x,s.y);this.geometryBBox.x=a.x,this.geometryBBox.y=a.y,this.geometryBBox.width=s.width,this.geometryBBox.height=s.height,this.svgObj.transform({x:e.x,y:e.y,rotation:i}),o&&o.add(this.svgObj,n),this.UpdateTransform()}return this.geometryBBox}GetArrowheadBounds(){return[]}SetTooltip(t){Di.SetTooltipOnElement(this.svgObj,t)}Style(){return this.style||(this.style=new xe(this)),this.style}SetFillColor(t){this.svgObj.attr("fill",t),this.ClearColorData(!0)}SetImageFill(t,e){if(e=e||{},this.ClearColorData(!0),this.fillPatternData={},this.fillPatternData.options={},this.fillPatternData.options.cropRect=e.cropRect||{x:0,y:0,width:0,height:0},this.fillPatternData.options.scaleType=e.scaleType||"PROPFILL",this.fillPatternData.url=t,this.fillPatternData.ID=Oe.MakeGuid(),this.fillPatternData.imgWidth=e.imageWidth||0,this.fillPatternData.imgHeight=e.imageHeight||0,this.fillPatternData.patternElem=null,this.fillPatternData.imageElem=null,this.fillPatternData.isImage=!0,!this.fillPatternData.imgWidth||!this.fillPatternData.imgHeight){const e=xe.GetCachedImageSize(t);e?(this.fillPatternData.imgWidth=e.width,this.fillPatternData.imgHeight=e.height):xe.CalcImageSize(t,(function(t,e,i,o){i||o.elem&&o.elem.fillPatternData&&(o.elem.fillPatternData.imgWidth=t,o.elem.fillPatternData.imgHeight=e,o.elem.UpdatePattern(o.ID,o.fill))}),{ID:this.fillPatternData.ID,elem:this,fill:!0})}this.UpdatePattern(this.fillPatternData.ID,!0)}UpdateImageFill(t={}){this.fillPatternData&&this.fillPatternData.isImage&&(this.fillPatternData.options.cropRect=t.cropRect||this.fillPatternData.options.cropRect,this.fillPatternData.options.scaleType=t.scaleType||this.fillPatternData.options.scaleType,this.UpdatePattern(this.fillPatternData.ID,!0))}SetTextureFill(t){t&&t.url&&(this.ClearColorData(!0),this.fillPatternData={options:{scale:t.scale||1,alignment:t.alignment||0},url:t.url,ID:Oe.MakeGuid(),imgWidth:t.dim.x,imgHeight:t.dim.y,patternElem:null,imageElem:null,isTexture:!0},this.UpdatePattern(this.fillPatternData.ID,!0))}SetGradientFill(t){if(t&&t.stops&&t.stops.length){this.ClearColorData(!0),this.fillGradientData={},this.fillGradientData.settings={},this.fillGradientData.settings.stops=[],this.fillGradientData.settings.type=t.type||ai.GradientStyle.Linear,this.fillGradientData.settings.startPos=t.startPos||ai.GradientPos.LeftTop,this.fillGradientData.settings.angle=t.angle;const e=t.stops;for(let t=0;t<e.length;t++)this.fillGradientData.settings.stops.push({offset:e[t].offset||0,color:e[t].color||"#fff",opacity:void 0!==e[t].opacity?e[t].opacity:1});this.fillGradientData.ID=Oe.MakeGuid(),this.fillGradientData.gradientElem=null,this.UpdateGradient(this.fillGradientData.ID,!0)}}ClearColorData(t){let e,i;t?(e=this.fillPatternData,i=this.fillGradientData):(e=this.strokePatternData,i=this.strokeGradientData),e&&e.patternElem&&(this.svgObj.remove(e.patternElem),e.patternElem=null,e.imageElem=null),i&&i.gradientElem&&(this.svgObj.remove(i.gradientElem),i.gradientElem=null),t?(this.fillPatternData=null,this.fillGradientData=null):(this.strokePatternData=null,this.strokeGradientData=null)}UpdatePattern(t,e){const i=e?this.fillPatternData:this.strokePatternData;if(i&&i.ID===t){i.patternElem||(i.patternElem=new gi.Pattern,i.imageElem=new gi.Image,i.imageElem.load(i.url),i.patternElem.add(i.imageElem),i.patternElem.attr("id",i.ID),this.svgObj.add(i.patternElem,0)),i.isImage?this.UpdateImagePattern(i):i.isTexture&&this.UpdateTexturePattern(i);const t=e?"fill":"stroke";this.svgObj.attr(t,"url(#"+i.ID+")")}}UpdateImagePattern(t){const e=this.CalcElementFrame();if(t.patternElem&&t.imageElem&&t.isImage){const i=t.imgWidth||e.width,o=t.imgHeight||e.height,n={x:t.options.cropRect.x,y:t.options.cropRect.y,width:t.options.cropRect.width||i,height:t.options.cropRect.height||o};if(t.imgWidth||t.imgHeight||(n.x=0,n.y=0),n.x<i&&n.y<o){n.width=Math.min(n.width,i-n.x),n.height=Math.min(n.height,o-n.y);let s=e.width/n.width,a=e.height/n.height;"PROPFILL"===t.options.scaleType?s>a?a=s:s=a:"PROPFIT"===t.options.scaleType?s<a?a=s:s=a:"NONE"===t.options.scaleType&&(s=1,a=1),n.x*=s,n.y*=a,n.width*=s,n.height*=a;const r=(e.width-n.width)/2-n.x,l=(e.height-n.height)/2-n.y;let h=n.width-r,c=n.height-l;h<e.width&&(h=e.width),c<e.height&&(c=e.height);const p=Oe.RoundCoord(r/s),d=Oe.RoundCoord(l/a),u=Oe.RoundCoord(h+1),g=Oe.RoundCoord(c+1),y=Oe.RoundCoord(s),S=Oe.RoundCoord(a);t.patternElem.attr({x:0,y:0,width:u,height:g,patternUnits:"userSpaceOnUse",preserveAspectRatio:"none meet",viewBox:"0 0 "+u+" "+g}),t.patternElem.node.setAttribute("_isImage_",!0),t.imageElem.attr({x:0,y:0,width:i,height:o,transform:"scale("+y+","+S+") translate("+p+","+d+")",preserveAspectRatio:"none"})}}}UpdateTexturePattern(t){const e=this.CalcElementFrame();let i,o,n;if(t.patternElem&&t.imageElem&&t.isTexture&&t.imgWidth&&t.imgHeight){switch(i=t.options.scale,o={x:0,y:0,width:t.imgWidth*i,height:t.imgHeight*i},n={x:0,y:0,width:o.width,height:o.height},t.options.alignment){case bi.TextureAlign.TopLeft:break;case bi.TextureAlign.TopCenter:n.x+=e.width/2;break;case bi.TextureAlign.TopRight:n.x=e.width-o.width;break;case bi.TextureAlign.CenterLeft:n.y+=e.height/2;break;case bi.TextureAlign.Center:n.x+=e.width/2,n.y+=e.height/2;break;case bi.TextureAlign.CenterRight:n.x=e.width-o.width,n.y+=e.height/2;break;case bi.TextureAlign.BottomLeft:n.y=e.height-o.height;break;case bi.TextureAlign.BottomCenter:n.x+=e.width/2,n.y=e.height-o.height;break;case bi.TextureAlign.BottomRight:n.x=e.width-o.width,n.y=e.height-o.height;break;default:n.x=-e.x,n.y=-e.y}t.imageElem.attr({x:0,y:0,width:o.width,height:o.height,preserveAspectRatio:"none"}),t.patternElem.attr({x:n.x,y:n.y,width:n.width,height:n.height,patternUnits:"userSpaceOnUse",preserveAspectRatio:"none meet",viewBox:"0 0 "+o.width+" "+o.height})}}UpdateGradient(t,e){const i=this.GetGeometryBBox();let o={x:0,y:0},n={x:0,y:0},s=Math.sqrt(i.width*i.width+i.height*i.height),a=!0;const r=e?this.fillGradientData:this.strokeGradientData;if(r&&r.ID===t){if(!r.gradientElem){let t;switch(r.settings.type){case ai.GradientStyle.Radialfill:case ai.GradientStyle.Radial:t="radial";break;default:t="linear"}r.gradientElem=new gi.Gradient(t),r.gradientElem.attr("id",r.ID);for(let e=0;e<r.settings.stops.length;e++){const t=r.settings.stops[e];r.gradientElem.at({offset:t.offset,color:t.color,opacity:t.opacity})}this.svgObj.add(r.gradientElem,0)}switch(a=r.settings.type===ai.GradientStyle.Linear,o.x=i.x,o.y=i.y,n.x=o.x+i.width,n.y=o.y+i.height,r.settings.startPos){case ai.GradientPos.Top:o.x+=i.width/2,n.x=o.x,s=i.height;break;case ai.GradientPos.RightTop:o.x=n.x,n.x=i.x;break;case ai.GradientPos.Right:o.x=n.x,o.y+=i.height/2,n.x=i.x,n.y=o.y,s=i.width;break;case ai.GradientPos.RightBottom:o.x=n.x,o.y=n.y,n.x=i.x,n.y=i.y;break;case ai.GradientPos.Bottom:o.x+=i.width/2,o.y=n.y,n.x=o.x,n.y=i.y,s=i.height;break;case ai.GradientPos.LeftBottom:o.y=n.y,n.y=i.y;break;case ai.GradientPos.Left:o.y+=i.height/2,n.y=o.y,s=i.width;break;case ai.GradientPos.Center:a&&(o.x+=i.width/2,o.y+=i.height/2,n.x=o.x,n.y=o.y,s=Math.max(i.width,i.height)/2)}if(void 0!==r.settings.angle){let t=r.settings.angle/10;if(t%=360,t<0&&(t+=360),0===t)o.x=i.x,o.y=i.y+i.height/2,n.x=i.x+i.width,n.y=i.y+i.height/2;else if(180===t)o.x=i.x+i.width,o.y=i.y+i.height/2,n.x=i.x,n.y=i.y+i.height/2;else if(90===t)o.x=i.x+i.width/2,o.y=i.y,n.x=i.x+i.width/2,n.y=i.y+i.height;else if(270===t)o.x=i.x+i.width/2,o.y=i.y+i.height,n.x=i.x+i.width/2,n.y=i.y;else{let e,s,a,r;const l=Math.tan(t*Math.PI/180),h=Math.tan((t+90)*Math.PI/180),c=i.x+i.width/2,p=i.y+i.height/2-c*l;t<90?(e=i.x,s=i.y,a=i.x+i.width,r=i.y+i.height):t<180?(e=i.x+i.width,s=i.y,a=i.x,r=i.y+i.height):t<270?(e=i.x+i.width,s=i.y+i.height,a=i.x,r=i.y):(e=i.x,s=i.y+i.height,a=i.x+i.width,r=i.y);const d=s-e*h,u=r-a*h;o.x=(d-p)/(l-h),o.y=o.x*l+p,n.x=(u-p)/(l-h),n.y=n.x*l+p}}a?r.gradientElem.attr({x1:o.x,y1:o.y,x2:n.x,y2:n.y,gradientUnits:"userSpaceOnUse"}):r.gradientElem.attr({cx:o.x,cy:o.y,r:s,gradientUnits:"userSpaceOnUse"}),e?this.svgObj.attr("fill","url(#"+r.ID+")"):this.svgObj.attr("stroke","url(#"+r.ID+")")}}RefreshPaint(t){this.fillPatternData?this.UpdatePattern(this.fillPatternData.ID,!0):this.fillGradientData&&this.UpdateGradient(this.fillGradientData.ID,!0),this.strokePatternData?this.UpdatePattern(this.strokePatternData.ID,!1):this.strokeGradientData&&this.UpdateGradient(this.strokeGradientData.ID,!1)}GetImageFillSize(){let t={width:0,height:0};return this.fillPatternData&&this.fillPatternData.isImage&&(t.width=this.fillPatternData.imgWidth,t.height=this.fillPatternData.imgHeight),t}SetStrokeColor(t){this.svgObj.attr("stroke",t),this.ClearColorData(!1)}SetTextureStroke(t){t&&t.url&&(this.ClearColorData(!1),this.strokePatternData={},this.strokePatternData.options={},this.strokePatternData.options.scale=t.scale||1,this.strokePatternData.options.alignment=t.alignment||0,this.strokePatternData.url=t.url,this.strokePatternData.ID=Oe.MakeGuid(),this.strokePatternData.imgWidth=t.dim.x,this.strokePatternData.imgHeight=t.dim.y,this.strokePatternData.patternElem=null,this.strokePatternData.imageElem=null,this.strokePatternData.isTexture=!0,this.UpdatePattern(this.strokePatternData.ID,!1))}SetGradientStroke(t){if(t&&t.stops&&t.stops.length){this.ClearColorData(!1),this.strokeGradientData={},this.strokeGradientData.settings={},this.strokeGradientData.settings.stops=[],this.strokeGradientData.settings.type=t.type||ai.GradientStyle.Linear,this.strokeGradientData.settings.startPos=t.startPos||ai.GradientPos.LeftTop,this.strokeGradientData.settings.angle=t.angle;for(let e=0;e<t.stops.length;e++){const i=t.stops[e];this.strokeGradientData.settings.stops.push({offset:i.offset||0,color:i.color||"#fff",opacity:void 0!==i.opacity?i.opacity:1})}this.strokeGradientData.ID=Oe.MakeGuid(),this.strokeGradientData.gradientElem=null,this.UpdateGradient(this.strokeGradientData.ID,!1)}}SetStrokeWidth(t){this.svgObj.attr("stroke-width",t),isNaN(Number(t))&&(t=we.Basic.Symbol.ParsePlaceholder(t,ai.Placeholder.LineThick)),this.strokeWidth=Number(t),this.svgObj.attr("stroke-dasharray",this.GetStrokePatternForWidth())}SetStrokePattern(t){this.strokeDashArray=t;const e=this.GetStrokePatternForWidth();this.svgObj.attr("stroke-dasharray",e)}GetStrokePatternForWidth(){const t=this.strokeWidth;let e=[];if(this.strokeDashArray&&(e=this.strokeDashArray.split(",").map((t=>Number(t.trim())))),!e.length||!t)return"none";return e.map((e=>e*t)).join(",")}SetOpacity(t){this.svgObj.attr("opacity",t)}SetFillOpacity(t){this.svgObj.attr("fill-opacity",t)}SetStrokeOpacity(t){this.svgObj.attr("stroke-opacity",t)}SetFillRule(t){this.svgObj.attr("fill-rule",t)}SetDisplayVisibility(t){const e=t?"":"hidden";this.svgObj.attr("visibility",e)}Effects(){return this.effects||(this.effects=new Si(this)),this.effects}SetEffect(t){this.svgObj.attr("filter",`url(#${t})`)}SetEventBehavior(t){this.svgObj.attr("pointer-events",t)}GetEventBehavior(){return this.svgObj.attr("pointer-events")}ClearEventBehavior(){this.svgObj.node.removeAttribute("pointer-events")}SetCursor(t){this.cursor=t,t?this.svgObj.node.setAttribute("class",t):this.svgObj.node.removeAttribute("class")}GetCursor(){return this.cursor}ClearAllCursors(){Di.RemoveCursorsOnSVGObj(this.svgObj)}static RemoveCursorsOnSVGObj(t){if(t.SDGObj&&(t.SDGObj.cursor=null),t.node&&t.node.removeAttribute("class"),t instanceof gi.Container){const e=t.children();for(let t=0;t<e.length;t++)Di.RemoveCursorsOnSVGObj(e[t])}}static SetTooltipOnElement(t,e){if(t&&t instanceof gi.Container){const i=new gi.Element(gi.create("title"));i.node.textContent=e,t.add(i)}}}class fi{constructor(t,e,i,o){a(this,"h"),a(this,"v"),a(this,"hdist"),a(this,"vdist"),this.h=t||0,this.v=e||0,this.hdist=i||0,this.vdist=o||0}}class xi{constructor(){a(this,"font"),a(this,"type"),a(this,"size"),a(this,"weight"),a(this,"style"),a(this,"baseOffset"),a(this,"decoration"),a(this,"color"),a(this,"colorTrans"),a(this,"spError"),a(this,"dataField"),a(this,"hyperlink"),this.font="Arial",this.type="sanserif",this.size=10,this.weight="normal",this.style="normal",this.baseOffset="none",this.decoration="none",this.color="#000",this.colorTrans=1,this.spError=!1,this.dataField=null,this.hyperlink=-1}}class Ci{constructor(){a(this,"just"),a(this,"bullet"),a(this,"spacing"),a(this,"lindent"),a(this,"rindent"),a(this,"pindent"),a(this,"tabspace"),a(this,"vjust"),this.just="center",this.bullet="none",this.spacing=0,this.lindent=0,this.rindent=0,this.pindent=0,this.tabspace=0,this.vjust="middle"}}class Pi{constructor(t,e,i){a(this,"LineType"),a(this,"dataclass"),a(this,"ShortRef"),a(this,"param"),a(this,"weight"),a(this,"dimDeflection"),a(this,"flags"),a(this,"pt"),a(this,"UserData"),a(this,"dimTextAltPositioning"),this.LineType=t||me.LineType.LINE,this.dataclass=0,this.ShortRef=0,this.param=0,this.weight=0,this.dimDeflection=0,this.flags=0,this.pt={x:0,y:0},this.UserData=null,e&&(this.pt.x=e),i&&(this.pt.y=i),this.dimTextAltPositioning=!1}}var Ti=Object.defineProperty,Oi=Object.getOwnPropertyDescriptor;class vi{constructor(){a(this,"dim"),a(this,"offset"),a(this,"flags"),a(this,"closed"),a(this,"wasline"),a(this,"Shape_Rotation"),a(this,"Shape_DataID"),a(this,"Shape_TableID"),a(this,"segs"),this.dim={x:0,y:0},this.offset={x:0,y:0},this.flags=0,this.closed=0,this.wasline=!0,this.Shape_Rotation=0,this.Shape_DataID=-1,this.Shape_TableID=-1,this.segs=[]}}((t,e,i,o)=>{for(var n,s=o>1?void 0:o?Oi(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&Ti(e,i,s)})([jt((()=>Pi))],vi.prototype,"segs",2);class wi{constructor(t,e,i,o){a(this,"x"),a(this,"y"),a(this,"width"),a(this,"height"),a(this,"firstconnector_x"),a(this,"h"),a(this,"hdist"),a(this,"v"),a(this,"vdist"),this.x=t||0,this.y=e||0,this.width=i||0,this.height=o||0}}class ki{constructor(t){a(this,"Type"),a(this,"runtimeText"),a(this,"selrange"),t=t||{},this.Type=Ce.StoredObjectType.TextObject,this.runtimeText=t.runtimeText||null,this.selrange=t.selrange||{start:0,end:0,line:0}}}const Li={minWidth:null,maxWidth:null,minHeight:null};class Ai{constructor(){a(this,"name"),a(this,"flags"),a(this,"n"),a(this,"index"),a(this,"layertype"),a(this,"zList"),this.name="",this.flags=Se.LayerFlags.Visible,this.n=0,this.index=0,this.layertype=Se.LayerTypes.None,this.zList=[]}}var Ii=Object.defineProperty,Ei=Object.getOwnPropertyDescriptor;class Fi{constructor(){a(this,"Type"),a(this,"nlayers"),a(this,"layers"),a(this,"activelayer"),a(this,"swimlanelist"),this.Type=Ce.StoredObjectType.LayersManagerObject,this.nlayers=0,this.layers=new Array,this.activelayer=0,this.swimlanelist=[]}}((t,e,i,o)=>{for(var n,s=o>1?void 0:o?Ei(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&Ii(e,i,s)})([jt((()=>Ai))],Fi.prototype,"layers",2);class Gi{constructor(t,e,i){a(this,"targetid"),a(this,"hookid"),a(this,"flags"),a(this,"cellid"),this.targetid=t||0,this.hookid=e||0,this.flags=0,this.cellid=i}}class Ri{constructor(t,e,i,o){a(this,"left"),a(this,"top"),a(this,"right"),a(this,"bottom"),this.left=t,this.top=e,this.right=i,this.bottom=o}}var ji=Object.defineProperty,Bi=Object.getOwnPropertyDescriptor,Mi=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?Bi(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&ji(e,i,s),s};class Hi{constructor(){a(this,"papersize"),a(this,"minsize"),a(this,"margins");const t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.papersize=new De(t,e),this.minsize=new De(1e3,750),this.margins=new Ri(50,50,50,50)}}Mi([jt((()=>De))],Hi.prototype,"papersize",2),Mi([jt((()=>De))],Hi.prototype,"minsize",2),Mi([jt((()=>Ri))],Hi.prototype,"margins",2);class _i{constructor(){a(this,"fontName"),a(this,"fontType"),a(this,"fontSize"),a(this,"face"),this.fontName="Arial",this.fontType="sanserif",this.fontSize=10,this.face=0}}var Ui=Object.defineProperty,Ni=Object.getOwnPropertyDescriptor,Vi=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?Ni(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&Ui(e,i,s),s};class zi{constructor(){a(this,"style"),a(this,"just"),a(this,"vjust"),a(this,"lf"),a(this,"textflags"),a(this,"textgrow"),a(this,"fsize_min"),a(this,"tmargins"),a(this,"flags"),a(this,"h_arraywidth"),a(this,"v_arraywidth"),a(this,"lastcommand"),a(this,"arrayht"),a(this,"arraywd"),a(this,"wallThickness"),a(this,"curveparam"),a(this,"rrectparam"),a(this,"pen"),a(this,"highlighter"),this.style=new ni,this.just="center",this.vjust="center",this.lf=new _i,this.textflags=0,this.textgrow=Se.TextGrowBehavior.ProPortional,this.fsize_min=8,this.tmargins={left:me.Common.DefTextMargin,top:me.Common.DefTextMargin,right:me.Common.DefTextMargin,bottom:me.Common.DefTextMargin},this.flags=0,this.h_arraywidth=50,this.v_arraywidth=50,this.lastcommand=0,this.arrayht=25,this.arraywd=25,this.wallThickness=0,this.curveparam=0,this.rrectparam=me.Common.DefFixedRRect,this.pen={},this.highlighter={}}}Vi([jt((()=>ni))],zi.prototype,"style",2),Vi([jt((()=>_i))],zi.prototype,"lf",2);var Wi=Object.defineProperty,Ki=Object.getOwnPropertyDescriptor,Yi=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?Ki(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&Wi(e,i,s),s};class Xi{constructor(){a(this,"type"),a(this,"flags"),a(this,"pointflags"),a(this,"catAxisflags"),a(this,"magAxisflags"),a(this,"legendType"),a(this,"legendlayoutflags"),a(this,"imagevaluerep"),a(this,"quadrant"),a(this,"style"),a(this,"areaStyle"),a(this,"gridStyle"),a(this,"titleStyle"),a(this,"legendStyle"),a(this,"legendTitleStyle"),a(this,"catAxisStyle"),a(this,"catAxisTitleStyle"),a(this,"magAxisStyle"),a(this,"magAxisTitleStyle"),a(this,"pointStyle"),a(this,"pointLabelStyle"),this.type=Se.GraphType.Bar,this.flags=Se.GraphFlags.SequenceByCategory,this.pointflags=0,this.catAxisflags=Se.AxisFlags.DaxShowGridLineMajor|Se.AxisFlags.DaxHideMinorTicks,this.magAxisflags=Se.AxisFlags.DaxShowGridLineMajor,this.legendType=Se.LegendType.DaxLegendFull,this.legendlayoutflags=0,this.imagevaluerep=-1,this.quadrant=0,this.style=new ni,this.areaStyle=new ni,this.gridStyle=new ni,this.titleStyle=new ni,this.legendStyle=new ni,this.legendTitleStyle=new ni,this.catAxisStyle=new ni,this.catAxisTitleStyle=new ni,this.magAxisStyle=new ni,this.magAxisTitleStyle=new ni,this.pointStyle=new ni,this.pointLabelStyle=new ni}}Yi([jt((()=>ni))],Xi.prototype,"style",2),Yi([jt((()=>ni))],Xi.prototype,"areaStyle",2),Yi([jt((()=>ni))],Xi.prototype,"gridStyle",2),Yi([jt((()=>ni))],Xi.prototype,"titleStyle",2),Yi([jt((()=>ni))],Xi.prototype,"legendStyle",2),Yi([jt((()=>ni))],Xi.prototype,"legendTitleStyle",2),Yi([jt((()=>ni))],Xi.prototype,"catAxisStyle",2),Yi([jt((()=>ni))],Xi.prototype,"catAxisTitleStyle",2),Yi([jt((()=>ni))],Xi.prototype,"magAxisStyle",2),Yi([jt((()=>ni))],Xi.prototype,"magAxisTitleStyle",2),Yi([jt((()=>ni))],Xi.prototype,"pointStyle",2),Yi([jt((()=>ni))],Xi.prototype,"pointLabelStyle",2);var qi=Object.defineProperty,Ji=Object.getOwnPropertyDescriptor,$i=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?Ji(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&qi(e,i,s),s};class Zi{constructor(){a(this,"Type"),a(this,"dim"),a(this,"flags"),a(this,"tselect"),a(this,"dupdisp"),a(this,"def"),a(this,"graphDef"),a(this,"RefCon"),a(this,"d_sarrow"),a(this,"d_sarrowdisp"),a(this,"d_earrow"),a(this,"d_earrowdisp"),a(this,"d_arrowsize"),a(this,"centersnapalign"),a(this,"hopdimindex"),a(this,"hopdim"),a(this,"hopstyle"),a(this,"dimensions"),a(this,"shapedimensions"),a(this,"background"),a(this,"bkdir"),a(this,"bkid"),a(this,"bkcroprect"),a(this,"bkflags"),a(this,"addCount"),a(this,"sequencemask"),a(this,"sequencestep"),a(this,"nsequencesteps"),a(this,"sequenceflags"),a(this,"libSelectedRestore"),a(this,"chartdirection"),a(this,"copyPasteTrialVers"),a(this,"taskmanagementflags"),a(this,"taskdays"),a(this,"forcedotted"),a(this,"moreflags"),a(this,"fieldmask"),a(this,"CurrentTheme"),a(this,"EnableSpellCheck"),a(this,"rulerConfig"),a(this,"Page"),a(this,"commentListId"),a(this,"commentId");const t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.dim={x:t,y:e},this.Type=Ce.StoredObjectType.SDDataObject,this.flags=me.SessionFlags.LLink|me.SessionFlags.FreeHand|me.SessionFlags.NoTreeOverlap,this.tselect=-1,this.dupdisp={x:0,y:0},this.def=new zi,this.graphDef=new Xi,this.RefCon=0,this.d_sarrow=0,this.d_sarrowdisp=!1,this.d_earrow=0,this.d_earrowdisp=!1,this.d_arrowsize=1,this.centersnapalign=!0,this.hopdimindex=1,this.hopdim={x:Se.HopDimX[1],y:Se.HopDimY[1]},this.hopstyle=Se.HopStyle.Arc,this.dimensions=Se.DimensionFlags.Total,this.shapedimensions=0,this.background=new $e,this.background.Paint.FillType=Se.FillTypes.Transparent,this.bkdir=0,this.bkid=-1,this.bkcroprect={left:0,top:0,right:0,bottom:0},this.bkflags=0,this.addCount=0,this.sequencemask=0,this.sequencestep=-1,this.nsequencesteps=0,this.sequenceflags=0,this.libSelectedRestore=void 0,this.chartdirection=0,this.copyPasteTrialVers=0,this.taskmanagementflags=0,this.taskdays=7,this.forcedotted=!1,this.moreflags=0,this.fieldmask=0,this.CurrentTheme="",this.EnableSpellCheck=!0,this.rulerConfig=new be,this.Page=new Hi,this.commentListId=-1,this.commentId=-1}}$i([jt((()=>zi))],Zi.prototype,"def",2),$i([jt((()=>Xi))],Zi.prototype,"graphDef",2),$i([jt((()=>$e))],Zi.prototype,"background",2),$i([jt((()=>be))],Zi.prototype,"rulerConfig",2),$i([jt((()=>Hi))],Zi.prototype,"Page",2);class Qi{constructor(){a(this,"Textures"),a(this,"Categories"),this.Textures=[],this.Categories=[]}}class to{constructor(){a(this,"updated"),a(this,"worigin"),a(this,"wscale"),a(this,"wscalemode"),a(this,"leftpanelmode"),this.updated=0,this.worigin={x:0,y:0},this.wscale=0,this.wscalemode=0,this.leftpanelmode=0}}class eo{constructor(){a(this,"error"),a(this,"coordScaleFactor"),a(this,"sdp"),a(this,"tLMB"),a(this,"ctp"),a(this,"WinSetting"),a(this,"docDpi"),a(this,"fontlist"),a(this,"lpStyles"),a(this,"UniqueMap"),a(this,"zList"),a(this,"links"),a(this,"textlinks"),a(this,"polyid"),a(this,"nsegl"),a(this,"arrayid"),a(this,"GroupOffset"),a(this,"rulerConfig"),a(this,"WriteBlocks"),a(this,"noTables"),a(this,"WriteGroupBlock"),a(this,"selectonly"),a(this,"nblocks"),a(this,"BlockAction"),a(this,"state"),a(this,"delta"),a(this,"TextureList"),a(this,"LibraryPathTarget"),a(this,"richGradients"),a(this,"KeepSegDir"),a(this,"WriteWin32"),this.error=0,this.coordScaleFactor=1,this.sdp=null,this.tLMB=null,this.ctp=null,this.WinSetting=new to,this.docDpi=100,this.fontlist=[],this.lpStyles=[],this.UniqueMap=[],this.zList=[],this.links=[],this.textlinks=[],this.polyid=0,this.nsegl=0,this.arrayid=0,this.GroupOffset={x:0,y:0},this.rulerConfig=null,this.WriteBlocks=!1,this.noTables=!1,this.WriteGroupBlock=!1,this.selectonly=!1,this.nblocks=0,this.BlockAction=0,this.state=0,this.delta=0,this.TextureList=[],this.LibraryPathTarget="",this.richGradients=[],this.KeepSegDir=!1,this.WriteWin32=!1}}class io extends class{constructor(t,e,i,o){a(this,"ID"),a(this,"CreatedBy"),a(this,"StateType"),a(this,"IsOpen"),a(this,"currentObjSeqId"),this.ID=null!=t?t:-1,this.CreatedBy=e||null,this.StateType=i||null,this.IsOpen=!1,this.currentObjSeqId=ye.currentObjSeqId}}{constructor(t,e,i,o,n){super(t,e,o,n),a(this,"storedObjects"),this.storedObjects=i||[]}AddStoredObject(t){if(null==t)throw new Error("Stored object is null");if(null==t.Type)throw new Error("Stored object type is null");this.storedObjects.push(Oe.CloneBlock(t))}SetStoredObjects(t){if(null==t)throw new Error("Stored objects array is null");const e=t.map((t=>Oe.CloneBlock(t)));this.storedObjects=e}GetStoredObjects(){return this.storedObjects.map((t=>Oe.CloneBlock(t)))}}class oo extends class{constructor(){a(this,"currentStateId"),a(this,"historyState"),a(this,"droppedStates"),a(this,"states"),this.currentStateId=-1,this.historyState=0,this.droppedStates=0,this.states=[]}PreserveState(){}SyncObjectsWithCreateStates(){}GetUndoState(){}ExceptionCleanup(){}RestorePrevState(){}RestoreNextState(){}RestoreDataStoreFromState(){}GetCurrentState(){return null}AddToCurrentState(t){}CurrentStateReplace(t,e){}CurrentStateDelete(t){}ReplaceInCurrentState(t,e){}ResetUndoStates(){this.currentStateId=-1,this.droppedStates=0,this.historyState=0,this.states=[]}ResetToSpecificState(t){}ClearFutureUndoStates(){}DumpStates(t){}}{constructor(){super(),a(this,"maxUndo"),this.maxUndo=ye.maxUndo}PreserveState(){this.SyncObjectsWithCreateStates(),this.states[this.currentStateId].IsOpen=!1}SyncObjectsWithCreateStates(){const t=Ce.StateOperationType,e=Oe.CloneBlock,i=this.states[this.currentStateId],o=i.storedObjects.length;for(let n=0;n<o;++n){const o=i.storedObjects[n];if(o.stateOptTypeId===t.CREATE){const s=e(ye.stdObj.GetObject(o.ID));s.stateOptTypeId=t.CREATE,i.storedObjects[n]=s}}}GetUndoState(){const t={undo:!1,redo:!1},e=this.states.length-1;return t.undo=this.currentStateId>0,t.redo=this.currentStateId<e,t}ExceptionCleanup(){this.currentStateId>0&&this.states[this.currentStateId].IsOpen&&(this.states[this.currentStateId].IsOpen=!1,ye.currentObjSeqId=this.states[this.currentStateId].currentObjSeqId,this.RestoreDataStoreFromState(),this.currentStateId--,this.currentStateId<this.states.length-1&&(this.states=this.states.slice(0,this.currentStateId+1)))}RestorePrevState(){this.currentStateId>0&&(this.RestoreDataStoreFromState(),this.currentStateId--)}RestoreNextState(){this.currentStateId<this.states.length-1&&(this.currentStateId++,this.RestoreDataStoreFromState())}RestoreDataStoreFromState(){const t=Ce.StateOperationType,e=Oe.CloneBlock;try{const i=this.states[this.currentStateId],o=i.storedObjects,n=o.length;for(let s=0;s<n;++s){const n=o[s];switch(n.stateOptTypeId){case t.CREATE:if(ye.stdObj.GetObject(n.ID))ye.stdObj.DeleteObject(n.ID,!1);else{const t=e(n);ye.stdObj.SaveObject(t,!1)}break;case t.DELETE:if(ye.stdObj.GetObject(n.ID))ye.stdObj.DeleteObject(n.ID,!1);else{const i=e(n);i.stateOptTypeId=t.CREATE,ye.stdObj.SaveObject(i,!1)}break;case t.UPDATE:const o=e(n),a=ye.stdObj.GetObject(n.ID),r=e(a);a.stateOptTypeId===t.CREATE&&(r.stateOptTypeId=t.UPDATE),ye.stdObj.SaveObject(o,!1),i.storedObjects[s]=r}}}catch(i){throw i}}GetCurrentState(){return this.states[this.currentStateId]}AddToCurrentState(t){const e=io,i=Ce.StateOperationType;let o=!0;const n=this.GetCurrentState();let s=null;if(void 0!==n&&!0===n.IsOpen){o=!1;let e=!1,s=null;if(Rt.each(n.storedObjects,((i,o)=>{if(o.ID===t.ID)return e=!0,s=o,!1})),e)switch(s.stateOptTypeId){case i.CREATE:switch(t.stateOptTypeId){case i.CREATE:this.CurrentStateReplace(t,!1);break;case i.DELETE:this.CurrentStateDelete(t)}break;case i.DELETE:switch(t.stateOptTypeId){case i.CREATE:t.stateOptTypeId=i.UPDATE,this.CurrentStateReplace(t,!1);break;case i.DELETE:this.CurrentStateReplace(t,!1);break;case i.UPDATE:t.stateOptTypeId=i.UPDATE,this.CurrentStateReplace(t,!1)}break;case i.UPDATE:switch(t.stateOptTypeId){case i.CREATE:this.CurrentStateReplace(t,!1);break;case i.DELETE:this.CurrentStateReplace(t,!0)}}else n.AddStoredObject(t)}if(!0===o)if(this.currentStateId<this.states.length-1&&(this.states=this.states.slice(0,this.currentStateId+1)),this.maxUndo){s=new e(this.currentStateId+1,"T3"),s.AddStoredObject(t),this.states.push(s),this.currentStateId=s.ID;let i=this.states.length;if(i>this.maxUndo){this.states.shift(),this.currentStateId--,this.droppedStates++,i=this.states.length;for(let t=0;t<i;++t)this.states[t].ID--}}else 0===this.states.length&&(s=new e(ye.state.currentStateId+1,"T3"),s.AddStoredObject(t),this.states.push(s),this.currentStateId=s.ID)}CurrentStateReplace(t,e){const i=t.ID,o=Oe.CloneBlock;if(0!==this.states.length){const n=this.states[this.currentStateId],s=n.storedObjects.length;for(let a=0;a<s;a++)if(n.storedObjects[a].ID===i){if(e)n.storedObjects[a].stateOptTypeId=t.stateOptTypeId;else{const e=o(t);n.storedObjects[a]=e}return}}}CurrentStateDelete(t){if(0!==this.states.length){const e=this.states[this.currentStateId],i=e.storedObjects.length;for(let o=0;o<i;++o)if(e.storedObjects[o].ID===t.ID)return void e.storedObjects.splice(o,1)}}GetObjectFromState(t,e){if(this.states.length>t){const i=this.states[t],o=i.storedObjects.length;for(let t=0;t<o;t++)if(i.storedObjects[t].ID===e)return i.storedObjects[t]}}ReplaceInCurrentState(t,e){if(0===this.states.length)return;const i=this.states[this.currentStateId],o=i.storedObjects.length;for(let n=0;n<o;n++)if(i.storedObjects[n].ID===t){i.storedObjects[n].Data=Oe.DeepCopy(e.Data);break}}ResetUndoStates(){this.currentStateId=-1,this.droppedStates=0,this.historyState=0,this.states=[]}ResetToSpecificState(t){this.currentStateId=t,this.droppedStates=0,this.historyState=0,this.states=[this.states[t]]}AddToHistoryState(){this.historyState++}ClearFutureUndoStates(){this.currentStateId<this.states.length-1&&(this.states=this.states.slice(0,this.currentStateId+1))}}class no{constructor(){a(this,"ID"),a(this,"Type"),a(this,"stateOptTypeId"),a(this,"storedObjects"),a(this,"Data"),a(this,"Dirty"),a(this,"IsPersisted"),a(this,"Delete"),this.storedObjects=[]}SaveObject(t,e){if(null==t)throw new Error("storedObject is null");if(null==t.Type)throw new Error("storedObject type is null");let i=void 0===e||e;try{if(-1!==t.ID){const e=this.GetObject(t.ID);null!==e?(e.Type=t.Type,e.Data=t.Data,e.Dirty=!0,e.stateOptTypeId=t.stateOptTypeId,t=e):(t.Dirty=!0,this.storedObjects.push(t))}else t.ID=this.storedObjects.length>0?Oe.GenerateObjectID():0,t.Data&&Oe.IsObject(t.Data)&&(t.Data.BlockID=t.ID),this.storedObjects.push(t);return i&&ye.state.AddToCurrentState(t),t.ID}catch(o){throw o}}GetObject(t){if(null==t)return null;for(let e=0;e<this.storedObjects.length;e++)if(this.storedObjects[e].ID===t)return this.storedObjects[e];return null}GetObjects(t){return null!=t?this.storedObjects.filter((e=>e.Type===t)):this.storedObjects}DeleteObject(t,e){if(null==t)throw new Error("Object ID is null");const i=void 0===e||e;let o=-1;try{if(this.storedObjects.forEach(((e,i)=>{if(e.ID===t)return o=i,!1})),o>=0){const e=this.GetObject(t);e.stateOptTypeId=Ce.StateOperationType.DELETE,i&&ye.state.AddToCurrentState(e),this.storedObjects.splice(o,1)}}catch(n){throw n}}PreserveBlock(t){return new Pe(t,null,null,null,null,!0)}CreateBlock(t,e){return new Pe(-1,t,e,!0,!0,!0)}SetStoredObjects(t){if(null==t)throw new Error("Stored objects is null");if(!(t instanceof Array))throw new Error("Stored objects is not an array");this.storedObjects=t}}class so{Create(t){let e=new no;return Array.isArray(t)&&(e.storedObjects=t),{Set:function(t){if(null===t)throw new Error("Stored objects cannot be null");if(!Array.isArray(t))throw new Error("Stored objects is not an array");e.storedObjects=t},Get:function(){return e.storedObjects},Clear:function(){e.storedObjects=[]}}}}class ao{constructor(){a(this,"Type"),a(this,"theActiveTextEditObjectID"),a(this,"theTEWasResized"),a(this,"theTEWasEdited"),a(this,"theTELastOp"),a(this,"theActiveTableObjectID"),a(this,"theActiveTableObjectIndex"),a(this,"theActiveOutlineObjectID"),a(this,"theActiveGraphObjectID"),a(this,"EditorID"),this.Type=Ce.StoredObjectType.TDataObject,this.theActiveTextEditObjectID=-1,this.theTEWasResized=!1,this.theTEWasEdited=!1,this.theTELastOp=Se.TextElemLastOpt.Init,this.theActiveTableObjectID=-1,this.theActiveTableObjectIndex=-1,this.theActiveOutlineObjectID=-1,this.theActiveGraphObjectID=-1,this.EditorID=0}}const ro=t=>({value:t}),lo=[{offset:33,color:"#14BE64"},{offset:66,color:"#FFB100"},{offset:100,color:"#fd666d"}],ho={digital:[{id:1,label:"Off/On",off:"Off",on:"On",direct:null},{id:2,label:"Close/Open",off:"Close",on:"Open",direct:null},{id:3,label:"Stop/Start",off:"Stop",on:"Start",direct:null},{id:4,label:"Disable/Enable",off:"Disable",on:"Enable",direct:null},{id:5,label:"Normal/Alarm",off:"Normal",on:"Alarm",direct:null},{id:6,label:"Normal/High",off:"Normal",on:"High",direct:null},{id:7,label:"Normal/Low",off:"Normal",on:"Low",direct:null},{id:8,label:"No/Yes",off:"No",on:"Yes",direct:null},{id:9,label:"Cool/Heat",off:"Cool",on:"Heat",direct:null},{id:10,label:"Unoccupy/Occupy",off:"Unoccupy",on:"Occupy",direct:null},{id:11,label:"Low/High",on:"Low",off:"High",direct:null},{id:12,label:"On/Off",on:"Off",off:"On",direct:!0},{id:13,label:"Open/Close",on:"Close",off:"Open",direct:!0},{id:14,label:"Start/Stop",on:"Stop",off:"Start",direct:!0},{id:15,label:"Enable/Disable",on:"Disable",off:"Enable",direct:!0},{id:16,label:"Alarm/Normal",on:"Normal",off:"Alarm",direct:!0},{id:17,label:"High/Normal",on:"Normal",off:"High",direct:!0},{id:18,label:"Low/Normal",on:"Normal",off:"Low",direct:!0},{id:19,label:"Yes/No",on:"No",off:"Yes",direct:!0},{id:20,label:"Heat/Cool",on:"Cool",off:"Heat",direct:!0},{id:21,label:"Occupy/Unoccupy",on:"Unoccupy",off:"Occupy",direct:!0},{id:22,label:"High/Low",on:"Low",off:"High",direct:!0}],analog:{input:[{id:0,unit:"",label:"Unused"},{id:1,unit:"C",label:"Y3K -40 to 150"},{id:2,unit:"F",label:"Y3K -40 to 300"},{id:3,unit:"C",label:"10K Type2"},{id:4,unit:"F",label:"10K Type2"},{id:5,unit:"C",label:"G3K -40 to 120"},{id:6,unit:"F",label:"G3K -40 to 250"},{id:7,unit:"C",label:"10K Type3"},{id:8,unit:"F",label:"10K Type3"},{id:9,unit:"C",label:"PT 1K -200 to 300"},{id:10,unit:"F",label:"PT 1K -200 to 570"},{id:11,unit:"V",label:"0.0 to 5.0"},{id:12,unit:"A",label:"0.0 to 100"},{id:13,unit:"ma",label:"4 to 20"},{id:14,unit:"PSI",label:"4 to 20"},{id:15,unit:"counts",label:"Pulse Count (Slow 1Hz)"},{id:16,unit:"%",label:"0 to 100"},{id:17,unit:"%",label:"0 to 100"},{id:18,unit:"%",label:"0 to 100"},{id:19,unit:"V",label:"0.0 to 10.0"},{id:25,unit:"counts",label:"Pulse Count (Fast 100Hz)"},{id:26,unit:"Hz",label:"Frequency"},{id:27,unit:"%",label:"Humidty %"},{id:28,unit:"PPM",label:"CO2  PPM"},{id:29,unit:"RPM",label:"Revolutions Per Minute"},{id:30,unit:"PPB",label:"TVOC PPB"},{id:31,unit:"ug/m3",label:"ug/m3"},{id:32,unit:"#/cm3",label:"#/cm3"},{id:33,unit:"dB",label:"dB"},{id:34,unit:"Lux",label:"Lux"}],output:[{id:0,unit:"",label:"Unused"},{id:1,unit:"V",label:"0.0 to 10.0"},{id:2,unit:"%Open",label:"0.0 to 100"},{id:3,unit:"PSI",label:"4 to 20"},{id:4,unit:"%",label:"0 to 100"},{id:5,unit:"%Cls",label:"0 to 100"},{id:6,unit:"ma",label:"4 to 20"},{id:7,unit:"%PWM",label:"0 to 100"},{id:8,unit:"%",label:"2 to 10"}],variable:[{id:0,unit:"Unused",label:"Unused"},{id:1,unit:"C",label:"C"},{id:2,unit:"F",label:"F"},{id:3,unit:"FPM",label:"FPM"},{id:4,unit:"Pa",label:"Pa"},{id:5,unit:"KPa",label:"KPa"},{id:6,unit:"PSI",label:"PSI"},{id:7,unit:"inWC",label:"inWC"},{id:8,unit:"W",label:"W"},{id:9,unit:"kW",label:"kW"},{id:10,unit:"KWH",label:"KWH"},{id:11,unit:"V",label:"V"},{id:12,unit:"KV",label:"KV"},{id:13,unit:"A",label:"A"},{id:14,unit:"ma",label:"ma"},{id:15,unit:"CFM",label:"CFM"},{id:16,unit:"s",label:"s"},{id:17,unit:"min",label:"min"},{id:18,unit:"h",label:"h"},{id:19,unit:"d",label:"d"},{id:20,unit:"Time",label:"Time"},{id:21,unit:"",label:""},{id:22,unit:"%",label:"%"},{id:23,unit:"%RH",label:"%RH"},{id:24,unit:"p/min",label:"p/min"},{id:25,unit:"Counts",label:"Counts"},{id:26,unit:"%Open",label:"%Open"},{id:27,unit:"Kg",label:"Kg"},{id:28,unit:"L/h",label:"L/h"},{id:29,unit:"GPH",label:"GPH"},{id:30,unit:"GAL",label:"GAL"},{id:31,unit:"CF",label:"CF"},{id:32,unit:"BTU",label:"BTU"},{id:33,unit:"CMH",label:"CMH"}]}},co={version:"0.8.1",items:[],selectedTargets:[],elementGuidelines:[],itemsCount:0,groupCount:0,activeItemIndex:null,viewportTransform:{x:0,y:0,scale:1},rulersGridVisible:!1,locked:!1},po=ro(h.exports.cloneDeep(co)),uo=ro(h.exports.cloneDeep(co)),go=ro([]),yo=ro({active:!1,data:{}}),So=ro(!0),mo=ro(null),bo=ro({title:"Modbus Register",home:"/modbus-register",back:null}),Do=ro(h.exports.cloneDeep({version:"0.8.1",imagesCount:0,objLibItemsCount:0,images:[],objLib:[]})),fo=ro(!1),xo=ro({workAreaPadding:"110px",hRulerWOffset:"128px",wpwWOffset:"128px",wpWOffset:"136px",hRuler:{width:0,height:20},vRuler:{width:20,height:0},hvGrid:{width:0,height:0},wiewPortWH:{width:"calc(100vw - v-bind('documentAreaPosition.wpWOffset'))",height:"calc(100vh - 93px)"},widthOffset:"128px",heightOffset:fo.value?"68px":"115px"}),Co={top:(null==fo?void 0:fo.value)?36:117,left:128},Po=ro(null),To=ro(!1),Oo={OUTPUT:0,INPUT:1,VARIABLE:2,SCHEDULE:4,HOLIDAY:5,PROGRAM:6,MON:9},vo=ro({panelsData:[],panelsList:[],panelsRanges:[],loadingPanel:null}),wo=ro([]),ko=ro(vo.value.panelsData),Lo=ro({active:!1,data:null}),Ao=ro({active:!1,data:null}),Io=ro(!1),Eo=ro([]),Fo=ro([]),Go=ro(null),Ro=ro([]),jo=ro({version:"V:26.0130.01",transform:0}),Bo={deviceList:ro([]),graphicList:ro([]),currentDevice:ro(),globalMessage:ro({})},Mo=[{name:"Pointer",label:"Select",icon:"svguse:icons.svg#cursor|0 0 280 200",cat:["Basic"]},{name:"Box",label:"Box",icon:"square",cat:["Basic"],settings:{bgColor:{value:"#659dc5",type:"color",label:"Background Color",id:1}}},{name:"Text",label:"Text",icon:"title",cat:["Basic"],settings:{textColor:{value:"black",type:"color",label:"Text color",id:2},textAlign:{value:"left",type:"textAlign",id:3},text:{value:"Text",type:"text",label:"Text",id:1}}},{name:"Line",label:"Line",icon:"svguse:icons.svg#line",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"SegLine",label:"Segment Line",icon:"svguse:icons.svg#segLine",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"G_Rectangle",label:"Rectangle",icon:"svguse:icons.svg#rectangle|0 0 24 24",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"G_Circle",label:"Circle",icon:"svguse:icons.svg#circle|0 0 24 24",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"Oval",label:"Oval",icon:"svguse:icons.svg#oval|0 0 30 30",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"ArrowRight",label:"Arrow Right",icon:"svguse:icons.svg#arrow_right|0 0 32 32",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"ArrowLeft",label:"Arrow Left",icon:"svguse:icons.svg#arrow_left|0 0 32 32",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"ArrowTop",label:"Arrow Top",icon:"svguse:icons.svg#arrow_top|0 0 32 32",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"ArrowBottom",label:"Arrow Bottom",icon:"svguse:icons.svg#arrow_bottom|0 0 32 32",cat:["General"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:2}}},{name:"Fan",label:"Fan",icon:"svguse:icons.svg#fan",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"CoolingCoil",label:"Cooling Coil",icon:"svguse:icons.svg#cooling-coil|0 0 20 29",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"HeatingCoil",label:"Heating Coil",icon:"svguse:icons.svg#heating-coil|0 0 19.526541 28.758413",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Filter",label:"Filter",icon:"svguse:icons.svg#filter|0 0 13 29",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Humidifier",label:"Humidifier",icon:"svguse:icons.svg#humidifier|0 0 18 25",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Humidity",label:"Humidity",icon:"svguse:icons.svg#humidity|0 0 10.221108 22.472175",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Pressure",label:"Pressure",icon:"svguse:icons.svg#pressure",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Damper",label:"Damper",icon:"svguse:icons.svg#damper|0 0 13.431694 28.950886",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Temperature",label:"Temperature",cat:["Duct","Pipe"],icon:"svguse:icons.svg#temperature|0 0 10.423067 22.852614",settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"ThermalWheel",label:"Thermal Wheel",icon:"svguse:icons.svg#thermal-wheel",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Enthalpy",label:"Enthalpy",icon:"svguse:icons.svg#enthalpy|0 0 10 22",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Flow",label:"Flow",icon:"svguse:icons.svg#flow",cat:["Duct"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Boiler",label:"Boiler",icon:"svguse:icons.svg#boiler",cat:["Pipe"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Heatpump",label:"Heat pump",icon:"svguse:icons.svg#heatpump",cat:["Pipe"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Pump",label:"Pump",icon:"svguse:icons.svg#pump",cat:["Pipe"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"ValveThreeWay",label:"Valve Three-Way",icon:"svguse:icons.svg#ValveThreeWay",cat:["Pipe"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"ValveTwoWay",label:"Valve Two-Way",icon:"svguse:icons.svg#ValveTwoWay",cat:["Pipe"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Gauge",label:"Gauge",icon:"speed",cat:["Metrics"],settings:{min:{value:0,type:"number",label:"Min",id:1},max:{value:100,type:"number",label:"Max",id:2},ticks:{value:10,type:"number",label:"Ticks",id:3},minorTicks:{value:5,type:"number",label:"Minor ticks",id:4},thickness:{value:30,type:"number",label:"Thickness",id:5},colors:{value:lo,type:"colors",id:6},titleColor:{value:"#000000",type:"titleColor",id:7}}},{name:"Dial",label:"Dial",icon:"horizontal_split",cat:["Metrics"],settings:{min:{value:0,type:"number",label:"Min",id:1},max:{value:100,type:"number",label:"Max",id:2},ticks:{value:5,type:"number",label:"Ticks",id:3},minorTicks:{value:5,type:"number",label:"Minor ticks",id:4},colors:{value:lo,type:"colors",id:5},titleColor:{value:"#000000",type:"titleColor",id:6},textColor:{value:"#000000",type:"color",label:"Text color",id:7}}},{name:"Value",label:"Value",icon:"123",cat:["Metrics"],settings:{bgColor:{value:"#0065a3",type:"color",label:"Background color",id:1},textColor:{value:"#ffffff",type:"color",label:"Text color",id:3},titleColor:{value:"#000000",type:"titleColor",id:2},textAlign:{value:"left",type:"textAlign",id:4},t3EntryDisplayField:{value:"description",type:"select",id:6}}},{name:"IconBasic",label:"Icon",icon:"emoji_emotions",cat:["Basic"],settings:{active:{value:!0,type:"boolean",label:"On/Off",id:1},offColor:{value:"#940303",type:"color",label:"Off Color",id:3},onColor:{value:"#659dc5",type:"color",label:"On Color",id:4},icon:{value:"warning",type:"icon",label:"Icon",id:5},t3EntryDisplayField:{value:"value",type:"select",id:6}}},{name:"Icon",label:"Icon with title",icon:"fa-solid fa-icons",cat:["Metrics"],settings:{textAlign:{value:"left",type:"textAlign",id:2},active:{value:!1,type:"boolean",label:"On/Off",id:1},offColor:{value:"#940303",type:"color",label:"Off Color",id:3},onColor:{value:"#0d87d9",type:"color",label:"On Color",id:4},icon:{value:"fa-solid fa-camera-retro",type:"icon",label:"Icon",id:5},t3EntryDisplayField:{value:"value",type:"select",id:6}}},{name:"Switch",label:"Switch Icon",icon:"toggle_off",cat:["Basic"],settings:{textAlign:{value:"left",type:"textAlign",id:2},active:{value:!1,type:"boolean",label:"On/Off",id:1},offColor:{value:"#000000",type:"color",label:"Off Color",id:3},onColor:{value:"#01c16e",type:"color",label:"On Color",id:4},icon:{value:"toggle",type:"iconSwitch",label:"Icon",id:5},t3EntryDisplayField:{value:"value",type:"select",id:6}}},{name:"LED",label:"LED",icon:"svguse:icons.svg#led",cat:["Basic"],settings:{textAlign:{value:"left",type:"textAlign",id:3},active:{value:!1,type:"boolean",label:"On/Off",id:1},blink:{value:!1,type:"boolean",label:"Blink",id:2},blinkInterval:{value:700,type:"number",label:"Blink interval",id:4},offColor:{value:"#000000",type:"color",label:"Off Color",id:5},onColor:{value:"#01c16e",type:"color",label:"On Color",id:6},t3EntryDisplayField:{value:"value",type:"select",id:7}}},{name:"Wall",label:"Wall",icon:"svguse:icons.svg#int_ext_wall",cat:["Room"],height:10,settings:{bgColor:{value:"#000",type:"color",label:"Background Color",id:1},strokeColor:{value:"#000",type:"color",label:"Stroke Color",id:2},strokeWidth:{value:19.5,type:"number",label:"Stroke width",id:3}}},{name:"RoomHumidity",label:"Room Humidity",icon:"svguse:icons.svg#room-humidity",cat:["Room"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"RoomTemperature",label:"Room Temperature",icon:"svguse:icons.svg#room-temperature",cat:["Room"],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1}}},{name:"Weld",label:"Weld",icon:"svguse:icons.svg#weld",cat:[""],settings:{fillColor:{value:"#659dc5",type:"color",label:"Fill color",id:1},active:{value:!1,type:"boolean",label:"Active",id:2},inAlarm:{value:!1,type:"boolean",label:"In alarm",id:3}}},{name:"Duct1",label:"Duct1",icon:"svguse:icons.svg#duct1 |0 0 12 12",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct2",label:"Duct2",icon:"svguse:icons.svg#duct2",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct3",label:"Duct3",icon:"svguse:icons.svg#duct3",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct4",label:"Duct4",icon:"svguse:icons.svg#duct4",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct5",label:"Duct5",icon:"svguse:icons.svg#duct5",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct7",label:"Duct6",icon:"svguse:icons.svg#duct7",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct8",label:"Duct7",icon:"svguse:icons.svg#duct8",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}},{name:"Duct9",label:"Duct8",icon:"svguse:icons.svg#duct9",cat:["NewDuct"],settings:{fillColor:{value:"#0173fe",type:"color",label:"Fill color",id:1}}}],Ho=["Basic","General","Pipe","NewDuct","Duct","Room","Metrics"];class _o{static InitStoredData(){this.InitClipboard(),this.InitState(),this.InitDataStore(),this.InitCurrentSequenceId()}static InitClipboard(){}static InitState(){const t=this.LoadData(this.STATE_KEY);if(null===t)return;const e=Bt(oo,t);for(let i=0;i<e.states.length;i++){const t=Bt(io,e.states[i]);for(let e=0;e<t.storedObjects.length;e++){const i=this.ConvertStoredObject(t.storedObjects[e]);t.storedObjects[e]=i}e.states[i]=t}ye.state=e}static InitDataStore(){const t=this.LoadData(this.OBJECT_STORE_KEY);if(null===t)return;const e=Bt(no,t);for(let i=0;i<e.storedObjects.length;i++){const t=this.ConvertStoredObject(e.storedObjects[i]);e.storedObjects[i]=t}ye.stdObj=e}static InitCurrentSequenceId(){const t=this.LoadData(this.CURRENT_OBJECT_SEQ_ID_KEY);null!==t&&(ye.currentObjSeqId=t)}static ConvertStoredObject(t){const e=Bt(Pe,t),i=e.Data;if("SDData"===i.Type){const t=Bt(Zi,i);e.Data=t}if("LayersManager"===i.Type){const t=Bt(Fi,i);e.Data=t}if("TEData"===i.Type){const t=Bt(ao,i);e.Data=t}if("BaseDrawObject"===i.Type){if(1===i.DrawingObjectBaseClass)if("PolyLineContainer"===(null==i?void 0:i.T3Type)){const t=Bt(we.Shape.PolyLineContainer,i);e.Data=t}else{const t=i.LineType;if(t==me.LineType.LINE){const t=Bt(we.Shape.Line,i);e.Data=t}if(t==me.LineType.ARCLINE){const t=Bt(we.Shape.ArcLine,i);e.Data=t}if(t==me.LineType.SEGLINE){const t=Bt(we.Shape.SegmentedLine,i);e.Data=t}if(t==me.LineType.ARCSEGLINE){const t=Bt(we.Shape.ArcSegmentedLine,i);e.Data=t}if(t==me.LineType.POLYLINE){const t=Bt(we.Shape.PolyLine,i);e.Data=t}if(t==me.LineType.FREEHAND){const t=Bt(we.Shape.FreehandLine,i);e.Data=t}}if(0===i.DrawingObjectBaseClass){if("Oval"===i.ShapeType){const t=Bt(we.Shape.Oval,i);e.Data=t}if("Rect"===i.ShapeType){const t=Bt(we.Shape.Rect,i);e.Data=t}if("Polygon"===i.ShapeType){const t=Bt(we.Shape.Polygon,i);e.Data=t}if("GroupSymbol"===i.ShapeType){const t=Bt(we.Shape.GroupSymbol,i);e.Data=t}if("SvgSymbol"===i.ShapeType){const t=Bt(we.Shape.SvgSymbol,i);e.Data=t}if("ForeignObject"===i.ShapeType){const t=Bt(we.Shape.ForeignObject,i);e.Data=t}}if(3===i.DrawingObjectBaseClass){const t=Bt(we.Shape.Connector,i);e.Data=t}}return e}static ConvertPlanObjectToShape(t){let e;if("BaseDrawObject"===t.Type){if(1===t.DrawingObjectBaseClass)if("PolyLineContainer"===(null==t?void 0:t.T3Type)){e=Bt(we.Shape.PolyLineContainer,t)}else{const i=t.LineType;if(i==me.LineType.LINE){e=Bt(we.Shape.Line,t)}if(i==me.LineType.ARCLINE){e=Bt(we.Shape.ArcLine,t)}if(i==me.LineType.SEGLINE){e=Bt(we.Shape.SegmentedLine,t)}if(i==me.LineType.ARCSEGLINE){e=Bt(we.Shape.ArcSegmentedLine,t)}if(i==me.LineType.POLYLINE){e=Bt(we.Shape.PolyLine,t)}if(i==me.LineType.FREEHAND){e=Bt(we.Shape.FreehandLine,t)}}if(0===t.DrawingObjectBaseClass){if("Oval"===t.ShapeType){e=Bt(we.Shape.Oval,t)}if("Rect"===t.ShapeType){e=Bt(we.Shape.Rect,t)}if("Polygon"===t.ShapeType){e=Bt(we.Shape.Polygon,t)}if("GroupSymbol"===t.ShapeType){e=Bt(we.Shape.GroupSymbol,t)}if("SvgSymbol"===t.ShapeType){e=Bt(we.Shape.SvgSymbol,t)}if("ForeignObject"===t.ShapeType){e=Bt(we.Shape.ForeignObject,t)}}if(3===t.DrawingObjectBaseClass){e=Bt(we.Shape.Connector,t)}}return e}static SaveToLocalStorage(){vs.VisibleZList(),this.SaveData(this.CLIPBOARD_KEY,ye.clipboard),this.SaveData(this.STATE_KEY,ye.state),this.SaveData(this.OBJECT_STORE_KEY,ye.stdObj),this.SaveData(this.CURRENT_OBJECT_SEQ_ID_KEY,ye.currentObjSeqId),this.SaveDocSettingData(),this.SaveAppStateV2()}static SaveDocSettingData(){const t={docConfig:ye.docUtil.docConfig,rulerConfig:ye.docUtil.rulerConfig,docInfo:ye.docUtil.svgDoc.docInfo};this.SaveData(this.DOC_INFO_KEY,t)}static LoadDocSettingData(){return this.LoadData(this.DOC_INFO_KEY)}static PrepareSaveData(){const t=h.exports.cloneDeep(uo.value);return t.itemsCount=t.items.filter((t=>0!==t.width)).length,t.selectedTargets=[],t.elementGuidelines=[],t.rulersGridVisible=So.value,t}static SaveToT3000(){const t=this.PrepareSaveData();if(fo.value)Ka.WebClient.SaveGraphicData(null,null,t);else{if(Ro.value.find((t=>"get_initial_data"===t.msgType)))return;const e=Ka.DeviceOpt.getCurrentDevice(),i=null==e?void 0:e.deviceId,o=null==e?void 0:e.graphic;i&&o&&Ka.WsClient.SaveGraphic(i,o,t)}}static LoadData(t){const e=localStorage.getItem(t);return e?JSON.parse(e):null}static SaveData(t,e){e&&localStorage.setItem(t,JSON.stringify(e))}static SaveDataWithoutStringify(t,e){e&&localStorage.setItem(t,e)}static InitStateAndStore(){ye.state=new oo,ye.stdObj=new no,ye.currentObjSeqId=0,ye.clipboard=(new so).Create()}static SaveAppStateV2(){const t=uo.value;this.SaveData(this.APP_STATE_V2,t)}static LoadAppStateV2(){const t=this.LoadData(this.APP_STATE_V2);t&&(uo.value=t)}static ClearT3LocalStorage(){localStorage.removeItem(this.CLIPBOARD_KEY),localStorage.removeItem(this.STATE_KEY),localStorage.removeItem(this.OBJECT_STORE_KEY),localStorage.removeItem(this.CURRENT_OBJECT_SEQ_ID_KEY),localStorage.removeItem(this.APP_STATE_V2),localStorage.removeItem(this.DRAW_KEY),localStorage.removeItem(this.DOC_INFO_KEY)}static LoadT3Config(){return this.LoadData(this.GLOBAL_CONFIG_KEY)||{}}static SaveT3Config(t){this.SaveData(this.GLOBAL_CONFIG_KEY,t)}static LoadT3Library(){return this.LoadData(this.LIBRARY_KEY)||[]}static SaveT3Library(t){this.SaveDataWithoutStringify(this.LIBRARY_KEY,t)}static GetSDDataDimensions(){const t=this.LoadData(this.OBJECT_STORE_KEY);if(null===t)return{x:0,y:0};const e=[];if(t.storedObjects&&Array.isArray(t.storedObjects))for(let i=0;i<t.storedObjects.length;i++){const o=t.storedObjects[i];o.Data&&"SDData"===o.Data.Type&&o.Data.dim&&"number"==typeof o.Data.dim.x&&"number"==typeof o.Data.dim.y&&e.push({x:o.Data.dim.x,y:o.Data.dim.y})}return e.reduce(((t,e)=>({x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)})),{x:0,y:0})}static SaveGrpSwitch(t){let e=this.LoadData(this.GRP_SWITCH_KEY)||[];Array.isArray(e)||(e=[]),e.push(t),this.SaveData(this.GRP_SWITCH_KEY,e)}static LoadGrpSwitch(){const t=this.LoadData(this.GRP_SWITCH_KEY);return Array.isArray(t)&&t.length>0?t[t.length-1]:null}static RemoveLatestGrpSwitch(){let t=this.LoadData(this.GRP_SWITCH_KEY)||[];if(!Array.isArray(t)||0===t.length)return null;const e=t.pop();return this.SaveData(this.GRP_SWITCH_KEY,t),e}static ClearGrpSwitch(){localStorage.removeItem(this.GRP_SWITCH_KEY)}}a(_o,"CLIPBOARD_KEY","t3.clipboard"),a(_o,"STATE_KEY","t3.state"),a(_o,"OBJECT_STORE_KEY","t3.dataStore"),a(_o,"CURRENT_OBJECT_SEQ_ID_KEY","t3.currentObjSeqId"),a(_o,"APP_STATE_V2","t3.stateV2"),a(_o,"DRAW_KEY","t3.draw"),a(_o,"DOC_INFO_KEY","t3.doc"),a(_o,"GLOBAL_CONFIG_KEY","t3.config"),a(_o,"LIBRARY_KEY","t3.library"),a(_o,"GRP_SWITCH_KEY","t3.grpSwitch");class Uo{static Log(t,...e){"prd"!==ge.Default.Environment.toLowerCase()&&(null==e||0===e.length?console.log.apply(console,[t]):console.log.apply(console,[t].concat(e)))}static Debug(t,...e){"prd"!==ge.Default.Environment.toLowerCase()&&(null==e||0===e.length?console.log.apply(console,[t]):console.log.apply(console,[t].concat(e)))}static Error(t,...e){null==e||0===e.length?console.error.apply(console,[t]):console.error.apply(console,[t].concat(e))}}const No=class{static LineIsReversed(t,e,i){if(null==t)return!1;if(t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line)switch(t.LineType){case me.LineType.ARCLINE:case me.LineType.LINE:if(Math.abs(t.EndPoint.x-t.StartPoint.x)<.01)return t.EndPoint.y<t.StartPoint.y;const o=ve.Pt2Rect(t.EndPoint,t.StartPoint);if(Math.abs(t.EndPoint.x-o.x)<.01&&Math.abs(t.EndPoint.y-o.y)<.01||Math.abs(t.EndPoint.x-o.x)<.01&&Math.abs(t.EndPoint.y-(o.y+o.height))<.01)return!0;break;case me.LineType.SEGLINE:case me.LineType.ARCSEGLINE:if(i)break;if(e&&e.KeepSegDir)return!1;if(Math.abs(t.StartPoint.x-t.EndPoint.x)<=1){if(t.StartPoint.y>t.EndPoint.y)return!0}else if(t.StartPoint.x>t.EndPoint.x)return!0}return!1}static TextAlignToWin(t){const e={just:bi.TextJust.Center,vjust:bi.TextJust.Center};switch(t){case bi.TextAlign.Left:e.just=bi.TextJust.Left;break;case bi.TextAlign.Right:e.just=bi.TextJust.Right;break;case bi.TextAlign.TopLeft:e.just=bi.TextJust.Left,e.vjust=bi.TextJust.Top;break;case bi.TextAlign.TopCenter:e.vjust=bi.TextJust.Top;break;case bi.TextAlign.TopRight:e.just=bi.TextJust.Right,e.vjust=bi.TextJust.Top;break;case bi.TextAlign.BottomLeft:e.just=bi.TextJust.Left,e.vjust=bi.TextJust.Bottom;break;case bi.TextAlign.BottomCenter:e.vjust=bi.TextJust.Bottom;break;case bi.TextAlign.BottomRight:e.just=bi.TextJust.Right,e.vjust=bi.TextJust.Bottom}return e}static ToSDWinCoords(t,e){return e>1?Math.round(e*t):t}static GetLineText(t,e,i,o){let n,s,a=-1;for(s=t.lineswithtext.length,n=0;n<s;n++)if(e===t.lineswithtext[n].x&&(!i||i===t.lineswithtext[n].z))return a=t.lineswithtext[n].y,o&&(o.TextGrow=t.lineswithtext[n].TextGrow,o.TextWrapWidth=t.lineswithtext[n].TextWrapWidth,o.TextAlign=t.lineswithtext[n].TextAlign,o.just=t.lineswithtext[n].just,o.vjust=t.lineswithtext[n].vjust,o.Paint=t.lineswithtext[n].Paint),t.lineswithtext.splice(n,1),a;return-1}static ReadSymbolFromBuffer(t,e,i,o,n,s,a,r,l,h,c,p,d,u){let g,y,S,m,b,D,f,x,C,P=!1,T=new No.Result,O=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0),v=[];T.isTemplate=!1,T.IgnoreHeader=!0,T.sdp=new Zi,T.sdp.def.style=Oe.DeepCopy(O.def.style),T.isSymbol=0!==u,T.tLMB=new Fi,T.AllowAddEMFHash=p,No.FragmentLoad_RefCount=0,c&&(0==(c.ObjectAttributeFlags&Ee.LibraryFlags.SEDL_NoColor)&&(T.SetColorChanges=!0,T.ColorFilter=c.ColorFilter),P=!0),h&&(T.NoTextBlocks=!0),null!=e&&(T.SymbolPosition.x=e),null!=i&&(T.SymbolPosition.y=i);let w=No.ReadBuffer(t,T,o,!1,No.ReadSymbolFromBufferComplete);if(w&&w!=No.Errors.WaitingForCallBack)return n?T.error:w;if(T.WarnMeta){if(n)return No.Errors.WarnMeta;F.Debug("Metafile not read")}if(d&&w!==No.Errors.WaitingForCallBack&&(d.x=T.sdp.dim.x,d.y=T.sdp.dim.y),w!==No.Errors.WaitingForCallBack){const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0);for(g=T.zList.length,y=0;y<g;y++){let e;m=ws.GetObjectPtr(T.zList[y],!1),e=t.layers[t.activelayer].zList,m.Layer=t.activelayer,e.push(T.zList[y]),ws.AddToDirtyList(T.zList[y]),m&&0==(m.flags&Se.ObjFlags.NotVisible)&&a.selectedList.push(T.zList[y]),null==T.STData&&(m.datasetTableID=-1,m.datasetElemID=-1,m.datasetID=-1,m.datasetType=-1,m.dataStyleOverride=null)}if(v.length&&ws.DeleteObjects(v),T.STData&&ye.opt.STData_Transfer&&ye.opt.STData_Transfer(T.zList,T.STData,P),S=T.links.length,!l&&S>0){let t=ws.GetObjectPtr(ye.opt.linksBlockId,!0);for(y=0;y<S;y++)t.push(T.links[y]);t.sort((function(t,e){return t.targetid-e.targetid}))}let o=0;for(y=0;y<g;y++)m=ws.GetObjectPtr(T.zList[y],!1),m&&0==(m.flags&Se.ObjFlags.NotVisible)&&(0===o?b=new wi(m.r.x,m.r.y,m.r.width,m.r.height):ve.UnionRect(m.r,b,b),o++);if(b){if(r?ye.opt.header.ClipboardType!==Ae.ClipboardType.LM?(D=b.x<0?-b.x:0,f=b.y<0?-b.y:0,D+=20,f+=20):(D=e-b.x,f=i-b.y):(D=0,f=0),F.Debug("= u.ShapeUtil: ReadSymbolFromBuffer/ offsetX:",D,"offsetY:",f,"PositionX:",e,"PositionY:",i,"clipboardType:",ye.opt.header.ClipboardType),D||f)for(y=0;y<g;y++)m=ws.GetObjectPtr(T.zList[y],!1),m&&0==(m.flags&Se.ObjFlags.NotVisible)&&m.OffsetShape(D,f);if(r){b.x+=D,b.y+=f,D=0,f=0,x=0,C=0;const t={x:O.dim.x,y:O.dim.y};if(b.x+b.width>O.dim.x&&(ye.opt.header.flags&me.HeaderFlags.NoAuto?(D=b.x+b.width-O.dim.x,x=0):(x=b.x+b.width,O.dim.x=x)),b.y+b.height>O.dim.y&&(ye.opt.header.flags&me.HeaderFlags.NoAuto?f=b.y+b.height-O.dim.y:(C=b.y+b.height,O.dim.y=C)),x||C){const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),i=e.nlayers;let o=!1,n=!1;for(e.layers[e.activelayer].flags&Se.LayerFlags.UseEdges&&(o=!0),y=0;y<i;y++)if(e.layers[y].flags&Se.LayerFlags.UseEdges&&e.layers[y].flags&Se.LayerFlags.Visible||o){n=!0;break}n&&ye.opt.UpdateEdgeLayers([],t,O.dim),ye.docUtil.ResizeDocument(O.dim.x,O.dim.y)}else if(D||f)for(y=0;y<g;y++)m=ws.GetObjectPtr(T.zList[y],!1),m&&0==(m.flags&Se.ObjFlags.NotVisible)&&m.OffsetShape(-D,-f)}}return!l&&r&&ye.opt.UpdateLinks(),s?Os.RenderDirtySVGObjects():1===g&&ye.opt.RenderDirtySVGObjectsNoSetMouse(),T.error}}static ReadBuffer(t,e,i,o,n){let s=null;try{if("string"==typeof t)if(t.startsWith("t3.draw")){const e=localStorage.getItem(t);e&&(s=JSON.parse(e))}else s=JSON.parse(t);else"object"==typeof t&&(s=t)}catch(a){return Uo.Error("= u.ShapeUtil: ReadBuffer/ Error parsing JSON data:",a),e.error=No.Errors.UnknownFile,e.error}return s&&s.signature&&s.signature===No.Signature?(e.PVersion=s.version,e.FVersion=s.version,e.coordScaleFactor=1,e.updatetext=!0,s.rulerConfig&&(e.rulerConfig=s.rulerConfig),s.isBlockFormat&&(e.ReadBlocks=!0),n&&e.ValidateHashesAsync?No.Errors.WaitingForCallBack:(No.ReadSymbolFromBufferComplete(s,e,o),e.error)):(e.error=No.Errors.UnknownFile,e.error)}static ReadSymbolFromBufferComplete(t,e,i){try{me.Common.DimMax;const o=me.ConnectorDefines.NSkip;let n,s,a,r,l,h,c,p;for(t.data&&t.data.header&&"fullDocument"===t.data.header.type&&(t.data.header.panelName&&(ye.opt.header.panelName=t.data.header.panelName),t.data.header.importSourcePath&&(ye.opt.header.importSourcePath=t.data.header.importSourcePath)),t.data&&t.data.structuredData&&(e.STData=t.data.structuredData),t.data&&t.data.drawing&&(t.data.drawing.styles&&t.data.drawing.styles.length>0&&(e.lpStyles=t.data.drawing.styles.map((t=>new ni(t)))),t.data.drawing.layers&&t.data.drawing.layers.length>0&&(e.tLMB.layers=t.data.drawing.layers,e.tLMB.nlayers=t.data.drawing.layers.length,e.tLMB.activelayer=t.data.drawing.activeLayer||0),t.data.drawing.objects&&t.data.drawing.objects.length>0&&t.data.drawing.objects.forEach((t=>{const i=_o.ConvertPlanObjectToShape(t),o=ye.stdObj.CreateBlock(Ce.StoredObjectType.BaseDrawObject,i);o.Data=Oe.DeepCopy(o.Data),e.zList.push(o.ID),e.IDMap[t.UniqueID]=o.ID}))),0===e.error&&e.links&&e.links.length>0&&No.ReMapLinks(e.IDMap,e.links,e,i),n=e.zList.length,s=0;s<n;s++){if(r=e.zList[s],l=ws.GetObjectPtr(r,!1),!l)continue;l.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Texture&&void 0===l.StyleRecord.Fill.Paint.Texture&&(l.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Transparent);let t=l.DrawingObjectBaseClass;switch(t===me.DrawObjectBaseClass.Line&&l.LineType===me.LineType.POLYLINE&&l.polylist&&l.polylist.closed&&(t=me.DrawObjectBaseClass.Shape),t){case me.DrawObjectBaseClass.Line:switch(l.LineType){case me.LineType.SEGLINE:case me.LineType.ARCSEGLINE:const t={x:l.Frame.x,y:l.Frame.y};(t.x<0||t.y<0)&&l.SetShapeOrigin(3e4,3e4),l.SegLFormat(l.EndPoint,me.ActionTriggerType.SeglPreserve,0),l.CalcFrame(),(t.x<0||t.y<0)&&l.SetShapeOrigin(t.x,t.y)}break;case me.DrawObjectBaseClass.Connector:if(0===l.hooks.length&&l.arraylist&&l.arraylist.hook){if(h=l.arraylist.hook.length,c=h-o,c<0&&(c=0),h>=o)for(a=1;a<o;a++)l.arraylist.hook[a].id>=0&&c++;0===c&&e.DeleteList.push(r)}break;case me.DrawObjectBaseClass.Shape:if(l.StyleRecord.Line.BThick&&l.polylist&&l.polylist.closed&&l.polylist.segs&&l.polylist.segs.length){let t,e=[];const i=l.StyleRecord.Line.Thickness/2;if(l instanceof we.Shape.Polygon&&r.polylist){const e={Frame:l.Frame,inside:l.inside};t=new we.Shape.PolyLine(e),t.polylist=l.polylist,t.StartPoint=l.StartPoint,t.EndPoint=l.EndPoint}else t=l;const o=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,e);let n=[];if(e.length>0)for(n.push(new De(o[0].x,o[0].y)),a=0;a<e.length;a++)n.push(new De(o[e[a]].x,o[e[a]].y));else n=Oe.DeepCopy(o);const s=ye.opt.InflateLine(n,i,!0,!0);if(!s||0===s.length)break;l.StartPoint.x=s[0].x,l.StartPoint.y=s[0].y,l.EndPoint.x=s[s.length-1].x,l.EndPoint.y=s[s.length-1].y;const h=Oe.DeepCopy(l.polylist.segs);for(l.polylist.segs=[],a=0;a<o.length;a++)l.polylist.segs.push(new Pi(1,s[a].x-l.StartPoint.x,s[a].y-l.StartPoint.y)),a<h.length&&(l.polylist.segs[a].LineType=h[a].LineType,l.polylist.segs[a].ShortRef=h[a].ShortRef,l.polylist.segs[a].dataclass=h[a].dataclass,l.polylist.segs[a].dimDeflection=h[a].dimDeflection,l.polylist.segs[a].flags=h[a].flags,l.polylist.segs[a].param=h[a].param,l.polylist.segs[a].weight=h[a].weight);if(l instanceof we.Shape.BaseLine)l.CalcFrame();else if(l instanceof we.Shape.Polygon&&l.polylist){const t=l.StyleRecord.Line.BThick;let e=l.Frame.width;e<=0&&(e=1);const i=(e+2*t)/e;let o=l.Frame.height;o<=0&&(o=1);const n=(o+2*t)/o,s=-(l.Frame.x*i-l.Frame.x+t),a=-(l.Frame.y*n-l.Frame.y+t);l.ScaleObject(s,a,null,0,i,n,!1),ye.opt.CalcPolyVertices(l)}}else(e.AddEMFHash||e.isTemplate||e.isSymbol)&&l.UpdateFrame(l.Frame)}l.DataID>=0&&e.updatetext&&(Os.AddSVGObject(null,r,!0,!1),on.TextResizeCommon(r,!1,!0),p=ye.opt.svgObjectLayer.GetElementById(r),p&&ye.opt.svgObjectLayer.RemoveElement(p))}return e.error}catch(o){return Uo.Error("= u.ShapeUtil: ReadSymbolFromBufferComplete/ Error processing JSON data:",o),e.error=No.Errors.BadFormat,e.error}}static ReMapLinks(t,e,i,o){let n,s,a,r,l,h,c,p=[],d=Ee.LinkFlags.Move,u=me.ConnectorDefines.NSkip,g={};for(n=t.length,s=e.length-1;s>=0;s--)(t[e[s].hookid]<0||t[e[s].targetid]<0)&&e.splice(s,1);for(let y=0;y<n;y++)if(t[y]){if(r=t[y],a=ws.GetObjectPtr(r,!1),a&&a.hooks)for(l=a.hooks.length,h=l-1;h>=0;h--)t[a.hooks[h].objid]&&t[a.hooks[h].objid]>0?(a.hooks[h].objid=t[a.hooks[h].objid],0!==e.length||o||(null==c&&(c=ws.GetObjectPtr(ye.opt.linksBlockId,!0)),ye.opt.InsertLink(c,r,h,Ee.LinkFlags.Move))):(a.hooks.splice(h,1),a.moreflags=ve.SetFlag(a.moreflags,me.ObjMoreFlags.ContainerChild,!1));if(a&&a.associd>=0&&(t[a.associd]&&t[a.associd]>0?a.associd=t[a.associd]:a.associd=-1),a&&a.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&a.arraylist){l=a.arraylist.hook.length;let e=a.arraylist.styleflags&me.AStyles.Linear;if(u=me.ConnectorDefines.NSkip,e)for(h=l-1;h>u;h--)a.arraylist.hook[h].textid=a.arraylist.hook[h-1].textid,a.arraylist.hook[h-1].textid=-1;for(h=0;h<l;h++)65535===a.arraylist.hook[h].id?a.arraylist.hook[h].id=-1:a.arraylist.hook[h].id>=0&&(a.arraylist.hook[h].id=t[a.arraylist.hook[h].id]),a.arraylist.hook[h].textid>=0&&(i.ReadBlocks||i.ReadGroupBlock||(a.arraylist.hook[h].textid=No.GetLineText(i,y,a.arraylist.hook[h].textid,g),g.Paint&&(a.StyleRecord.Fill.Paint=g.Paint)));o||(p.push(a),a.flags=ve.SetFlag(a.flags,Se.ObjFlags.Obj1,!0))}if(a&&a.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&a.ContainerList){l=a.ContainerList.List.length;const e=a.ContainerList.List;for(h=0;h<l;h++)null==e[h].id&&(e[h].id=-1),e[h].id>=0&&(e[h].id=t[e[h].id])}}for(s=0;s<e.length;s++)e[s].targetid=t[e[s].targetid],e[s].hookid=t[e[s].hookid],e[s].flags=d;if(e.sort((function(t,e){return t.targetid-e.targetid})),!o){const t=p.length;for(s=0;s<t;s++)a=p[s],l=a.arraylist.hook.length,l<u&&a.PrFormat(a.BlockID)}}static TextAlignToJust(t){var e={just:"center",vjust:"middle"};switch(t){case bi.TextAlign.Left:e.just="left";break;case bi.TextAlign.Right:e.just="right";break;case bi.TextAlign.TopLeft:e.just="left",e.vjust="top";break;case bi.TextAlign.TopCenter:e.vjust="top";break;case bi.TextAlign.TopRight:e.just="right",e.vjust="top";break;case bi.TextAlign.BottomLeft:e.just="left",e.vjust="bottom";break;case bi.TextAlign.BottomCenter:e.vjust="bottom";break;case bi.TextAlign.BottomRight:e.just="right",e.vjust="bottom"}return e}static WriteSelect(t,e,i,o,n){const s=new eo;return s.sdp=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),s.tLMB=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),s.ctp=ye.opt.header,s.selectonly=!0,o&&(s.KeepSegDir=!0),ye.docUtil.svgDoc.GetWorkArea(),s.docDpi=ye.docUtil.svgDoc.docInfo.docDpi,s.zList=t,s.noTables=e,s.richGradients=ye.opt.richGradients,vs.UpdateObjectLayerIndices(s),F.Debug("= U.ShapeUtil WriteSelect result=",s),No.WriteBuffer(s,!0,!0,n)}static WriteBuffer(t,e,i,o){try{const o={signature:No.Signature,version:t.WriteWin32?No.FVERSION2015:ye.opt.FileVersion,platform:"JSON",timestamp:(new Date).getTime(),isSelectOnly:e,data:{}};t.coordScaleFactor=t.WriteWin32?No.DRAWRES/ye.docUtil.svgDoc.docInfo.docDpi:1,o.rulerConfig={...ye.docUtil.rulerConfig,show:ye.docUtil.docConfig.showRulers},t.rulerConfig=o.rulerConfig,o.data.header=e?{type:"selectOnly"}:{type:"fullDocument",panelName:ye.opt.header.panelName,importSourcePath:ye.opt.header.importSourcePath,BusinessModule:ye.opt.header.BusinessModule,SymbolSearchString:ye.opt.header.SymbolSearchString,orgcharttable:ye.opt.header.orgcharttable,lpName:ye.opt.header.lpName,ParentPageID:ye.opt.header.ParentPageID};const n={objects:[],styles:[],layers:[]};No.BuildStyleList(t),n.styles=t.lpStyles.map((t=>JSON.parse(JSON.stringify(t)))),t.tLMB&&t.tLMB.layers&&(n.layers=t.tLMB.layers.map((t=>({name:t.name,flags:t.flags,layertype:t.layertype,zList:t.zList?[...t.zList]:[]}))),n.activeLayer=t.tLMB.activelayer);const s=t.zList.length;for(let e=0;e<s;e++){const i=t.zList[e],o=ws.GetObjectPtr(i,!1);if(o){const t=JSON.parse(JSON.stringify(o));if(o.DataID>0){const e=ws.GetObjectPtr(o.DataID,!1);e&&(t.textContent=e.runtimeText||"")}n.objects.push(t)}}o.data.drawing=n;const a=JSON.stringify(o),r="t3.draw";return localStorage.setItem(r,a),e||i?a:r}catch(n){return Uo.Error("= u.ShapeUtil: WriteBuffer/ Error serializing drawing to JSON:",n),null}}static BuildStyleList(t){let e,i,o,n,s,a,r,l;function h(e){let i,o,n;for(o=t.lpStyles.length,i=0;i<o;i++)if(e.Name===t.lpStyles[i].Name)return i;return n=Oe.DeepCopy(e),t.lpStyles.push(n),o}e=t.zList.length;const c=new ni,p=Oe.DeepCopy(c),d=Oe.DeepCopy(c);for(null==c.Line&&(p.Line=Oe.DeepCopy(c.Border),d.Line=Oe.DeepCopy(c.Border)),p.Line.Thickness=0,p.Fill.Paint.FillType=Se.FillTypes.Solid,p.Fill.Paint.Color=t.sdp.background.Paint.Color,s=0,n=0;n<e;n++){i=ws.GetObjectPtr(t.zList[n],!1),i.tstyleindex=h(i.StyleRecord),t.UniqueMap.push(t.zList[n]),s++,(i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line||i.TextFlags&Se.TextFlags.AttachB||i.TextFlags&Se.TextFlags.AttachA)&&i.DataID>0&&(t.UniqueMap.push(-i.DataID),s++,null==t.TextStyleIndex&&(t.TextStyleIndex=h(p)),a=new Gi(s-1,s,null),t.textlinks.push(a));const e=i.GetTextIDs();for(o=e.length,r=s,l=0;l<o;l++)t.UniqueMap.push(-e[l]),s++,null==t.TextStyleIndex&&(t.TextStyleIndex=h(p)),a=new Gi(r,s,null),t.textlinks.push(a)}}static PointSizeToFontSize(t){return t*ye.opt.svgDoc.GetWorkArea().docDpi/72}};let Vo=No;a(Vo,"Result",(function(){this.error=0,this.ConvertOnSave=!1,this.isTemplate=!1,this.isSymbol=!1,this.IgnoreHeader=!1,this.PVersion=0,this.FVersion=0,this.coordScaleFactor=1,this.sdp=null,this.GroupOffset={x:0,y:0},this.ReadingGroup=!1,this.WinSetting=new to,this.DefTStyle={},this.DefRun={},this.DefFSize=10,this.DefLine={},this.DefBorder={},this.DefFill={},this.fontlist=[],this.zList=[],this.lpStyles=[],this.links=[],this.IDMap=[],this.textids=[],this.usedtextids=[],this.noteids=[],this.usednoteids=[],this.nativeids=[],this.imageids=[],this.usedimageids=[],this.tableids=[],this.usedtableids=[],this.graphids=[],this.usedgraphids=[],this.expandedviewids=[],this.usedexpandedviewids=[],this.Threads=[],this.ThreadIDs=[],this.objectcount=0,this.textonline=-1,this.textonlineid=-1,this.lineswithtext=[],this.SymbolPosition={x:100,y:100},this.SetSymbolOrigin=!1,this.WarnMeta=!1,this.gHash=null,this.AddEMFHash=!1,this.AllowAddEMFHash=!1,this.ValidateHashesAsync=!1,this.shapetoolindex=null,this.linetoolindex=null,this.swimlaneformat=null,this.autocontainer=null,this.actascontainer=null,this.swimlanenlanes=null,this.swimlanenvlanes=null,this.swimlanerotate=null,this.swimlanetitle=null,this.collapsetools=null,this.TextureList=new Qi,this.NoTextBlocks=!1,this.ReadBlocks=!1,this.ReadGroupBlock=!1,this.tLMB=null,this.BlockzList=[],this.DeleteList=[],this.richGradients=[],this.hasBlockDirectory=!1,this.updatetext=!1,this.LibraryPathTarget="",this.SetColorChanges=!1,this.ColorFilter=0,this.HashRecords=[],this.PaperType="letter",this.ReadTexture=-1,this.STData=null,this.FromWindows=!1,this.SearchLibs=[],this.CurrentSymbol=null,this.SearchResults=[],this.LoadBlockList=!1,this.PaletteStatus={}})),a(Vo,"Errors",{WaitingForCallBack:-2,WarnMeta:9,BadFormat:3,UnknownFile:1,Version:2}),a(Vo,"Signature","00000000");class zo{}a(zo,"ObjectTypes",{Shape:0,LineD:1,SegL:2,Array:3,PolyL:4,Nurbs:501,NurbsSeg:502,Ellipse:503,EllipseEnd:504,Quadbez:505,QuadbezCon:506,Cubebez:507,CubebezCon:508,Spline:509,SplineCon:510,MoveTo:600,MoveToNewPoly:601,Freehand:7,NgEvent:35,NgEventLabel:36,NgTimeLine:34,ShapeContainer:55});class Wo{constructor(t,e,i){a(this,"objectid"),a(this,"hitcode"),a(this,"cellid"),a(this,"segment"),a(this,"pt"),this.objectid=t||0,this.hitcode=e||0,this.cellid=i||0,this.segment=-1,this.pt={x:0,y:0}}}class Ko{constructor(t,e,i,o,n){a(this,"objid"),a(this,"cellid"),a(this,"cellindex"),a(this,"hookpt"),a(this,"connect"),this.objid=t||0,this.cellid=e||null,this.cellindex=i||0,this.hookpt=o||0,this.connect={x:0,y:0},n&&(this.connect.x=n.x||0,this.connect.y=n.y||0)}}class Yo{static UpdateHook(t,e,i,o,n,s){F.Debug("O.Opt UpdateHook - Input:",{objectId:t,hookIndex:e,targetObjectId:i,hookPointType:o,connectionPoint:n,cellId:s});let a,r,l,h=null,c=!1,p=!1;const d=ws.GetObjectPtr(t,!0);if(null==d)return F.Debug("O.Opt UpdateHook - Output: Failed to get source object"),1;l=d.hooks.length,d.hooks.length>e&&e>=0&&(h=d.hooks[e].cellId);const u=ws.GetObjectPtr(ye.opt.linksBlockId,!0);if(null==u)return F.Debug("O.Opt UpdateHook - Output: Failed to get links list"),1;if(i>=0){if(a=ws.GetObjectPtr(i,!0),null==a)return F.Debug("O.Opt UpdateHook - Output: Failed to get target object"),1}else s=null;return e<0?d.hooks.length<d.maxhooks&&i>=0&&(e=d.hooks.length,c=!0):l>e&&(d.hooks[e].objid==i&&h==s||(r=ws.GetObjectPtr(d.hooks[e].objid,!0),r&&r.ChangeTarget(d.hooks[e].objid,t,h,e,n,!1),l=d.hooks.length,this.DeleteLink(u,d.hooks[e].objid,t,h,0,!1),p=!0,l===d.hooks.length&&d.hooks.splice(e,1),e=d.hooks.length,c=!0)),i>=0&&e>=0?(e>=d.hooks.length&&d.hooks.length<d.maxhooks?d.hooks[d.hooks.length]=new Ko(i,s,-1,o,n):(d.hooks[e].connect.x=n.x,d.hooks[e].connect.y=n.y,d.hooks[e].hookpt=o,d.hooks[e].objid=i),d.ChangeHook(e,!0,n),c&&this.InsertLink(u,t,e,0),a.ChangeTarget(i,t,h,e,n,!0)):p&&(d.extraflags&me.ExtraFlags.DeleteOnUnhook&&ws.DeleteObjects([d.BlockID]),d.objecttype===Se.FNObjectTypes.NgEvent&&d&&d.datasetElemID>-1&&(TODO.STData.DeleteRow(d.datasetElemID),d.datasetElemID=-1)),2!==d.hooks.length&&2!==l||!d.Dimensions||ws.AddToDirtyList(t),F.Debug("O.Opt UpdateHook - Output: Hook updated successfully"),0}static CNChangeHook(t,e,i,o){let n,s,a,r,l,h,c,p;F.Debug("O.Opt CNChangeHook - Input:",{sourceObjectId:t.BlockID,hookIndex:e,isAdding:i,hasHookData:!!o});let d={},u=[];if(i){if(t.hooks&&t.hooks[e]&&t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&(a=Zo.GetParentConnector(t.BlockID,null),a>=0)){if(n=ws.GetObjectPtr(a,!1),!n)return void F.Debug("O.Opt CNChangeHook - Output: Failed (no connector object)");if(n.IsFlowChartConnector())return void F.Debug("O.Opt CNChangeHook - Output: Skipped (flowchart connector)");if(l=n.arraylist.styleflags&me.AStyles.CoManager,l&&n.arraylist.hook.length-me.ConnectorDefines.NSkip>=1)return void F.Debug("O.Opt CNChangeHook - Output: Skipped (co-manager limit reached)");if(n.IsAsstConnector())return void F.Debug("O.Opt CNChangeHook - Output: Skipped (assistant connector)");if(h=n.objecttype,c=n.subtype,s=ye.opt.FindChildArray(t.BlockID,-1),s<0){if(r=Zo.GetChildConnectorStyle(t),s=Zo.AddConnector(100,100,r,t.BlockID),s>=0&&(p=ws.GetObjectPtr(s,!0)),!p)return void F.Debug("O.Opt CNChangeHook - Output: Failed to create child connector");p.objecttype=h,p.subtype=c,l?(d.x=0,d.y=-me.AStyles.CoManager):d=r.connect,Yo.UpdateHook(s,-1,t.BlockID,r.hookpt,d,null),Ps.SetLinkFlag(t.BlockID,Ee.LinkFlags.Move),p.PrFormat(s),ws.AddToDirtyList(s)}}}else if(t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape){const e={lindex:-1,id:-1,hookpt:0};for(;ye.opt.FindChildArrayByIndex(t.BlockID,e)>=0;)s=e.id,s>=0&&0===ye.opt.CN_GetNShapes(s)&&(u.push(s),ws.DeleteObjects(u,!1))}F.Debug("O.Opt CNChangeHook - Output: Operation completed")}static RemoveHook(t,e,i){F.Debug("O.Opt RemoveHook - Input:",{objectId:t,targetObjectId:e,targetCellId:i});const o=ws.GetObjectPtr(t,!0);if(null==o)return F.Debug("O.Opt RemoveHook - Output: Failed to get object (1)"),1;for(let n=0;n<o.hooks.length;n++)if(o.hooks[n].objid==e){if(null!==i&&i!==o.hooks[n].cellid)continue;o.ChangeHook(n,0,o.hooks[n].connect),o.hooks.splice(n,1);break}return F.Debug("O.Opt RemoveHook - Output: Hook removed successfully (0)"),0}static AddToHookList(t,e,i,o,n,s,a){let r,l,h,c,p,d;F.Debug("O.Opt AddToHookList - Input:",{linksListLength:t.length,hookListCount:e.length,startLinkIndex:i,targetId:o,listCode:n,recursionLevel:s,hasBoundingRect:!!a});let u={},g=!1;for(;i<t.length&&t[i].targetid==o;){if(r=t[i].hookid,d=ws.GetObjectPtr(r,!1),d){switch(l=-1,n){case Se.ListCodes.MoveHook:case Se.ListCodes.MoveTarg:if(2==d.hooks.length&&(p=d.hooks[0].objid===o?d.hooks[1].objid:d.hooks[0].objid,g=!1,e.indexOf(p)<0))break;g=!0;break;case Se.ListCodes.CircTarg:case Se.ListCodes.TopOnly:case Se.ListCodes.MoveTargAndLines:g=!0}if(e.indexOf(r)>=0&&(g=!1),g){if(l<0)for(h=0;h<d.hooks.length;h++)if(d.hooks[h].objid==o){l=h;break}if(l>=0&&d.hooks[l].objid==o){e.push(r);const i=d.GetListOfEnclosedObjects(!0);if(i.length&&this.JoinHookList(e,i),!a||d.flags&Se.ObjFlags.NotVisible||(u=d.GetMoveRect(!0,!0),a=ve.UnionRect(a,u,a)),n!==Se.ListCodes.TopOnly&&(c=Ps.FindLink(t,r,!0),c>=0&&(e=this.AddToHookList(t,e,c,r,n,s+1,a)),d.hooks.length>1&&n!==Se.ListCodes.CircTarg&&(e=this.GetTargetList(r,t,e,a,n))),n===Se.ListCodes.CircTarg&&0===s&&d.hooks.length>1)for(h=0;h<d.hooks.length;h++)if(h!==l){if(d.hooks[h].objid==d.hooks[l].objid)break;e.push(d.hooks[l].objid)}}}}i++}return F.Debug("O.Opt AddToHookList - Output: Updated hook list with",e.length,"items"),e}static HandleHookedObjectMoving(t,e){F.Debug("O.Opt HandleHookedObjectMoving - Input:",{drawingObjectId:t.BlockID,boundingBox:e});let i=0,o=0,n=null;if(ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0&&(n=ws.GetObjectPtr(ye.opt.linkParams.ConnectIndex,!1))&&n.HookedObjectMoving&&n.HookedObjectMoving({linkParams:ye.opt.linkParams,movingShapeID:t.BlockID,movingShapeBBox:e}),ye.opt.linkParams&&ye.opt.linkParams.ConnectIndexHistory.length>0)for(o=ye.opt.linkParams.ConnectIndexHistory.length,i=0;i<o;i++)ye.opt.linkParams.ConnectIndexHistory[i]!==ye.opt.linkParams.ConnectIndex&&(n=ws.GetObjectPtr(ye.opt.linkParams.ConnectIndexHistory[i],!1),n&&n.HookedObjectMoving&&n.HookedObjectMoving({linkParams:ye.opt.linkParams,movingShapeID:t.BlockID,movingShapeBBox:e}));F.Debug("O.Opt HandleHookedObjectMoving - Output: Notified connected objects")}static HiliteConnect(t,e,i,o,n,s){F.Debug("O.Opt HiliteConnect - Input:",{objectId:t,connectIndex:e,shouldHighlight:i,connectPoint:o,hookPointType:n,cellId:s});let a=t,r=null,l=null,h=null,c=null;if(r=ws.GetObjectPtr(t,!1),null==r)return void F.Debug("O.Opt HiliteConnect - Output: No drawing object found");const p=!!(r.flags&Se.ObjFlags.ContConn||null!=s);if(l=ye.opt.svgObjectLayer.GetElementById(a),null!=l&&null!=l.GetElementById(me.SVGElementClass.Shape))if(c="hilite_"+a,h=ye.opt.svgHighlightLayer.GetElementById(c),null==h&&i)if(h=r.CreateConnectHilites(ye.opt.svgDoc,t,e,o,n,s),null!=h){ye.opt.svgHighlightLayer.AddElement(h);try{p||h.SetRotation(r.RotationAngle)}catch(d){throw d}F.Debug("O.Opt HiliteConnect - Output: Highlight added")}else F.Debug("O.Opt HiliteConnect - Output: Failed to create highlight");else null==h||i?F.Debug("O.Opt HiliteConnect - Output: No change needed"):(ye.opt.svgHighlightLayer.RemoveElement(h),F.Debug("O.Opt HiliteConnect - Output: Highlight removed"));else F.Debug("O.Opt HiliteConnect - Output: No SVG element found")}static MoveLinks(t,e,i,o){let n,s,a,r,l,h,c,p,d,u;F.Debug("O.Opt MoveLinks - Input:",{targetObjectId:t,sourceObjectId:e,linkIndices:i?i.length:"null",hasHookResults:!!o});let g=[],y={},S=ws.GetObjectPtr(this.linksBlockId,!0);if(null==S)return F.Debug("O.Opt MoveLinks - Output: Failed (no links list)"),1;if(l=S.length,null==ws.GetObjectPtr(e,!1))return F.Debug("O.Opt MoveLinks - Output: Failed (source object not found)"),1;if(null==(s=ws.GetObjectPtr(t,!1)))return F.Debug("O.Opt MoveLinks - Output: Failed (target object not found)"),1;if(null==i&&(i=[],d=Ps.FindLink(S,e,!0),d>=0))for(;d<l&&S[d].targetid===e;)i.push(d),d++;if(i.length>=0){for(let n=0;n<i.length;n++)if(r=i[n],h=S[r].hookid,h>=0){if(c=ws.GetObjectPtr(h,!0),null==c)continue;if(c.flags&Se.ObjFlags.NoMaintainLink)continue;for(p=0;p<c.hooks.length;p++)if(c.hooks[p].objid===e){if(a=c.HookToPoint(c.hooks[p].hookpt,null),o){y={pt:a,obj:c,index:p},o.push(y);continue}c.objecttype!==Se.FNObjectTypes.Multiplicity?(g=s.GetTargetPoints(a,Se.HookFlags.LcNoSnaps,null),g&&g.length&&(c.hooks[p].connect.x=g[0].x,c.hooks[p].connect.y=g[0].y),c.hooks[p].objid=t,S[r].targetid=t):(S[r].flags=ve.SetFlag(S[r].flags,Ee.LinkFlags.Move,!0),c.hooks[p].objid=t,S[r].targetid=t)}}do{for(u=!1,p=0;p<l-1;p++)S[p].targetid>S[p+1].targetid&&(u=!0,n=S[p+1],S[p+1]=S[p],S[p]=n)}while(u)}return F.Debug("O.Opt MoveLinks - Output: Links moved successfully"),0}static InsertLink(t,e,i,o){F.Debug("O.Opt InsertLink - Input:",{linksList:null==t?void 0:t.length,hookObjectId:e,hookIndex:i,flagValue:o});const n=ws.GetObjectPtr(e,!1);if(null==n)return F.Debug("O.Opt InsertLink - Output: Failed to get hook object (1)"),1;if(i<0||i>=n.hooks.length)return F.Debug("O.Opt InsertLink - Output: Invalid hook index (1)"),1;const s=n.hooks[i].objid;let a=Ps.FindLink(t,s,!1);if(a>=0){for(;a<t.length&&t[a].targetid===s;){if(t[a].hookid==e)return F.Debug("O.Opt InsertLink - Output: Link already exists (1)"),1;a++}const r=new Gi(s,e,n.hooks[i].cellid);o&&(r.flags=o),t.splice(a,0,r)}return F.Debug("O.Opt InsertLink - Output: Link inserted successfully (0)"),0}static MoveConnectHilite(t,e,i){let o,n;F.Debug("O.Opt MoveConnectHilite - Input:",{objectId:t,connectionPoint:e,hookPointType:i});let s=null,a=null,r=null,l=[],h=ye.opt.svgDoc.docInfo.docToScreenScale,c=0;o=t,ye.opt.svgDoc.docInfo.docScale<=.5&&(h*=2),s=ws.GetObjectPtr(t,!1),null!=s&&(c=s instanceof we.Shape.BaseLine?me.Common.ConnPointLineDim/h:me.Common.ConnPointDim/h,l.push(e),n=s.GetPerimPts(t,l,null,!1,i,-1),null!=ye.opt.svgObjectLayer.GetElementById(o).GetElementById(me.SVGElementClass.Shape)&&(r="hilite_"+o,a=ye.opt.svgHighlightLayer.GetElementById(r),a&&a.SetPos(n[0].x-c,n[0].y-c))),F.Debug("O.Opt MoveConnectHilite - Output: Highlight moved to",n?n[0]:"null")}static DeleteLink(t,e,i,o,n,s){F.Debug("O.Opt DeleteLink - Input:",{targetId:e,hookObjectId:i,cellId:o,hookPointType:n,skipHookRemoval:s});let a=Ps.FindLink(t,e,!0),r=!1,l=-1;if(void 0===e&&(i=-1),a>=0)for(;a<t.length&&t[a].targetid===e;)-1===i||t[a].hookid===i?(r=!0,l=t[a].hookid,null!=o&&(r=o===t[a].cellid),l>=0&&0!==n&&(r=this.IsHookType(l,e,n)),r?(l>=0&&!s&&this.RemoveHook(l,e,o),t.splice(a,1)):a++):a++;return F.Debug("O.Opt DeleteLink - Output: Links deleted successfully"),0}static HasExistingLink(t,e){function i(t,e){const i=ws.GetObjectPtr(t,!1);for(let o=0;o<i.hooks.length;o++)if(i.hooks[o].objid==e)return!0;return!1}F.Debug("O.Opt HasExistingLink - Input:",{objectId1:t,objectId2:e});const o=!(!i(t,e)&&!i(e,t));return F.Debug("O.Opt HasExistingLink - Output:",o),o}static VerifyLink(t,e){F.Debug("O.Opt VerifyLink - Input:",{sourceObjectId:t.BlockID,linkData:e});const i=ws.GetObjectPtr(e.targetid,!1),o=Ee.LinkFlags;if(null==i)return e.flags=ve.SetFlag(e.flags,o.DeleteLink,!0),F.Debug("O.Opt VerifyLink - Output: Target object doesn't exist (-1)"),-1;for(let n=0;n<t.hooks.length;n++)if(t.hooks[n].objid===e.targetid&&t.hooks[n].cellid===e.cellid)return null===t.hooks[n].cellid?(F.Debug("O.Opt VerifyLink - Output: Valid link found at index",n),n):(e.flags=ve.SetFlag(e.flags,o.DeleteLink,!0),F.Debug("O.Opt VerifyLink - Output: Cell doesn't exist (-1)"),-1);return F.Debug("O.Opt VerifyLink - Output: No matching hook found (-1)"),-1}static CleanupHooks(t,e){F.Debug("O.Opt CleanupHooks - Input:",{connectorId:t,shapeId:e});const i=ws.GetObjectPtr(t,!1),o=ws.GetObjectPtr(e,!1);if(i&&i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&!(i.arraylist.styleflags&me.AStyles.FlowConn)>0&&o&&o.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape){const i=ye.opt.FindChildArray(e,t);if(i>=0&&0===ye.opt.CN_GetNShapes(i)){const t=[];return t.push(i),ws.DeleteObjects(t,!1),void F.Debug("O.Opt CleanupHooks - Output: Deleted orphaned connector",i)}}F.Debug("O.Opt CleanupHooks - Output: No cleanup needed")}static FindAllChildConnectors(t,e){F.Debug("O.Opt FindAllChildConnectors - Input:",{objectId:t,linksList:e});const i={lindex:-1,id:-1,hookpt:0},o=[];for(;ye.opt.FindChildArrayByIndex(t,i,e)>0;)o.push(i.id);return F.Debug("O.Opt FindAllChildConnectors - Output:",o),o}static MaintainLink(t,e,i,o,n){let s,a;F.Debug("O.Opt MaintainLink - Input:",{targetId:t,drawingObject:e.BlockID,triggerType:o,maintainMode:n});let r=0,l={},h=[],c=ws.GetObjectPtr(this.linksBlockId,!0);if(c&&e.AllowMaintainLink())if(s=Ps.FindLink(c,t,!0),s<0)F.Debug("O.Opt MaintainLink - Output: No links found for targetId",t);else{for(;s<c.length&&c[s].targetid===t;)if(a=ws.GetObjectPtr(c[s].hookid,!1),a)if(a.associd===t&&a.flags&Se.ObjFlags.Assoc)s++;else if(a.flags&Se.ObjFlags.NoMaintainLink)s++;else{for(let p=0;p<a.hooks.length;p++)if(a.hooks[p].objid===t){let d=n;if(2===n&&(d=!(a.hooks[p].hookpt!==me.HookPts.KAT||a.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Shape||e instanceof we.Shape.PolyLineContainer)),l=a.HookToPoint(a.hooks[p].hookpt,null),!1===e.MaintainPoint(l,t,i,a,o)){s++;continue}if(d||(r=Se.HookFlags.LcNoSnaps,r=ve.SetFlag(r,Se.HookFlags.LcShapeOnLine,!(a instanceof we.Shape.BaseLine)),h=e.GetTargetPoints(l,r,null),h&&(a.hooks[p].connect.x=h[0].x,a.hooks[p].connect.y=h[0].y)),e.TextFlags&Se.TextFlags.HorizText&&a instanceof we.Shape.BaseShape){let t=e.GetApparentAngle(l);t%=180;let i=a.RotationAngle,o=(t+180)%360;t=ye.opt.GetAngleSmallestDiff(t,i)<ye.opt.GetAngleSmallestDiff(o,i)?t:o,Math.abs(i-t)>2&&Math.abs(i-Math.abs(t-180))>2&&(ye.stdObj.PreserveBlock(c[s].hookid),a.RotationAngle=t,ws.AddToDirtyList(a.BlockID))}}s++}else s++;F.Debug("O.Opt MaintainLink - Output: Links maintained successfully")}else F.Debug("O.Opt MaintainLink - Output: No links or link maintenance not allowed")}static ResizeSetLinkFlag(t,e){F.Debug("O.Opt ResizeSetLinkFlag - Input:",{objectId:t,flagValue:e});const i=ws.GetObjectPtr(t,!1);if(i&&i.hooks.length){const t=i.hooks[0].objid,e=ws.GetObjectPtr(t,!1);e&&(e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector||e instanceof we.Shape.ShapeContainer)&&Ps.SetLinkFlag(t,Ee.LinkFlags.Move)}Ps.SetLinkFlag(t,e),F.Debug("O.Opt ResizeSetLinkFlag - Output: Link flags updated")}static MoveGetHookPoints(t,e,i,o){F.Debug("O.Opt MoveGetHookPoints - Input:",{objectId:t,drawingObject:e?e.BlockID:null,deltaX:i,deltaY:o});const n=[],s=[];let a=!1,r=!1,l=!1;const h=me.ExtraFlags,c=me.Common.DimMax;if(null==e)return F.Debug("O.Opt MoveGetHookPoints - Output: null (No drawing object)"),null;if(null==ye.opt.linkParams)return F.Debug("O.Opt MoveGetHookPoints - Output: null (No link parameters)"),null;if(e.hooks&&2===e.hooks.length)return F.Debug("O.Opt MoveGetHookPoints - Output: null (Object already has 2 hooks)"),null;if(e.flags&Se.ObjFlags.Assoc)return F.Debug("O.Opt MoveGetHookPoints - Output: null (Object is associated)"),null;if(e.PreventLink())return F.Debug("O.Opt MoveGetHookPoints - Output: null (Object prevents linking)"),null;!e.AllowLink()&&ye.opt.linkParams&&(ye.opt.linkParams.ArraysOnly=!0);const p=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(p&&(a=p.flags&me.SessionFlags.AttLink&&e.hookflags&Se.HookFlags.LcAttachToLine,r=p.flags&me.SessionFlags.FreeHand,l=xs.AllowAutoInsert()),a=!!(e.flags&Se.ObjFlags.DropOnBorder||e.flags&Se.ObjFlags.DropOnTable),a||l){if(a&&(ye.opt.linkParams.DropOnLine=!0),n.push(new De(e.attachpoint.x,e.attachpoint.y)),e.extraflags&(h.FlipHoriz|h.FlipVert)){const t=new wi(0,0,c,c);ye.opt.FlipPoints(t,e.extraflags,n)}ye.opt.linkParams.cpt=e.GetPerimPts(t,n,me.HookPts.KAT,!1,null,-1),ye.opt.linkParams.cpt&&ye.opt.linkParams.cpt.length>0&&(ye.opt.linkParams.cpt[0].id=me.HookPts.KAT,ye.opt.linkParams.cpt[0].x+=i,ye.opt.linkParams.cpt[0].y+=o)}e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&(s.push(new De(c/2,0)),ye.opt.linkParams.ContainerPt=e.GetPerimPts(t,s,me.HookPts.KAT,!1,null,-1),ye.opt.linkParams.ContainerPt&&ye.opt.linkParams.ContainerPt.length>0&&(ye.opt.linkParams.ContainerPt[0].id=me.HookPts.KAT,ye.opt.linkParams.ContainerPt[0].x+=i,ye.opt.linkParams.ContainerPt[0].y+=o)),ye.opt.linkParams.AllowJoin=r&&e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line;const d=e.GetHookPoints(!0),u=e.GetPerimPts(t,d,0,!1,null,-1);for(let g=0;g<u.length;g++)u[g].x+=i,u[g].y+=o;return F.Debug("O.Opt MoveGetHookPoints - Output:",{pointCount:u.length,allowDropOnLine:ye.opt.linkParams.DropOnLine,allowJoin:ye.opt.linkParams.AllowJoin}),u}static HandleMultipleSelectionHooks(){F.Debug("O.Opt HandleMultipleSelectionHooks - Input: No parameters");const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);if(t.length<=1)return F.Debug("O.Opt HandleMultipleSelectionHooks - Output: false (Only one object selected)"),!1;let e,i,o,n,s,a,r,l=null,h=[],c=[];const p=ws.GetObjectPtr(ye.opt.dragTargetId,!1);if(ye.opt.linkParams.ConnectIndex>=0){if(l=ws.GetObjectPtr(ye.opt.linkParams.ConnectIndex,!1),l&&l instanceof we.Shape.ShapeContainer){i=ye.opt.linkParams.ConnectIndex,n=t.length;const d=l.ContainerList.flags&Se.ContainerListFlags.Sparse;if(p.hooks.length&&p.hooks[0].objid===i){for(s=0;s<n;s++)if(o=t[s],o!==ye.opt.dragTargetId&&(e=ws.GetObjectPtr(o,!1),e.hooks.length&&e.hooks[0].objid===i))if(d){const t=ye.opt.linkParams.ConnectPt.x-p.hooks[0].connect.x,i=ye.opt.linkParams.ConnectPt.y-p.hooks[0].connect.y;(t||i)&&(h.push(o),a=e.hooks[0].connect.x+t,r=e.hooks[0].connect.y+i,a<0&&(a=0),c.push({x:a,y:r}))}else a=ye.opt.linkParams.ConnectPt.x,a<0&&(a=0),h.push(o),c.push({x:a,y:ye.opt.linkParams.ConnectPt.y+h.length})}else for(s=0;s<n;s++)o=t[s],o!==ye.opt.dragTargetId&&(e=ws.GetObjectPtr(o,!1),l.IsShapeContainer(e)&&(h.push(o),a=ye.opt.linkParams.ConnectPt.x,a<0&&(a=0),c.push({x:a,y:ye.opt.linkParams.ConnectPt.y+h.length})))}}else if(p.hooks.length>0&&(i=p.hooks[0].objid,l=ws.GetObjectPtr(i,!1),l&&l instanceof we.Shape.ShapeContainer))for(n=t.length,s=0;s<n;s++)o=t[s],o!==ye.opt.dragTargetId&&(e=ws.GetObjectPtr(o,!1),e.hooks.length&&e.hooks[0].objid===i&&(h.push(o),c.push(e.hooks[0].connect)));const d=h.length;if(d>0){for(h.unshift(ye.opt.dragTargetId),c.unshift(ye.opt.linkParams.ConnectPt),s=0;s<d+1;s++)o=h[s],this.UpdateHook(o,ye.opt.linkParams.InitialHook,ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.HookIndex,c[s],ye.opt.linkParams.ConnectInside),Ps.SetLinkFlag(ye.opt.linkParams.ConnectIndex,Ee.LinkFlags.Move),this.CleanupHooks(ye.opt.dragTargetId,ye.opt.linkParams.ConnectIndex);return F.Debug("O.Opt HandleMultipleSelectionHooks - Output: true (Multiple hooks updated)"),!0}return F.Debug("O.Opt HandleMultipleSelectionHooks - Output: false (No matching objects found)"),!1}static JoinHookList(t,e){if(F.Debug("O.Opt JoinHookList - Input:",{targetList:t,sourceList:e}),null!=t&&null!=e)for(let i=0;i<e.length;i++)t.indexOf(e[i])<0&&t.push(e[i]);F.Debug("O.Opt JoinHookList - Output: Lists joined")}static GetHookList(t,e,i,o,n,s){F.Debug("O.Opt GetHookList - Input:",{objectId:i,listCode:n,hookListLength:e?e.length:0,boundsRect:s});let a=!1,r=!1,l=-1,h={};switch(n===Se.ListCodes.ChildrenOnly&&(r=!0,n=Se.ListCodes.CircTarg),n===Se.ListCodes.LinesOnly&&(r=!0,n=Se.ListCodes.TopOnly),n){case Se.ListCodes.MoveTarg:if((o.hooks.length>1||1===o.hooks.length&&o.flags&Se.ObjFlags.Assoc)&&(n=Se.ListCodes.MoveHook),e.indexOf(i)>=0)return F.Debug("O.Opt GetHookList - Output: Object already in list",e),e;break;case Se.ListCodes.MoveHook:if(e.indexOf(i)>=0)return F.Debug("O.Opt GetHookList - Output: Object already in list",e),e;break;case Se.ListCodes.MoveTargAndLines:case Se.ListCodes.CircTarg:break;case Se.ListCodes.TargOnly:a=!0,l=-1}if(a||(l=Ps.FindLink(t,i,!0)),e.indexOf(i)<0&&!r){e.push(i),!s||o.flags&Se.ObjFlags.NotVisible||(h=o.GetMoveRect(!0,!0),1===e.length?ve.CopyRect(s,h):s=ve.UnionRect(s,h,s));const t=o.GetListOfEnclosedObjects(!0);t.length&&ye.opt.JoinHookList(e,t)}return l>=0&&this.AddToHookList(t,e,l,i,n,0,s),n===Se.ListCodes.MoveHook&&(o.hooks.length>=2||o.flags&Se.ObjFlags.Assoc)&&this.GetTargetList(i,t,e,s,n),F.Debug("O.Opt GetHookList - Output: Hook list updated",{hookListLength:e.length,boundsRect:s}),e}static UpdateLineHops(t){F.Debug("O.Opt UpdateLineHops - Input:",{forceUpdate:t});const e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(e.flags&me.SessionFlags.AllowHops){this.HideHopTargets();const i=vs.VisibleZList(),o=i.length,n=[],s=[],a=e.hopdim.x;let r=0,l=0,h=-1,c=0;for(let e=0;e<o;e++){const o=i[e],a=ws.GetObjectPtr(o,!1);a instanceof we.Shape.BaseLine&&!(a instanceof we.Shape.PolyLine)&&((a.flags&Se.ObjFlags.LineMod||t)&&-1===h&&(h=-2),n.push(o),r++,a.flags&Se.ObjFlags.LineHop&&(-2===h&&(c=l,h=-3),s.push(o),l++),a.flags=ve.SetFlag(a.flags,Se.ObjFlags.LineMod,!1))}if(l&&-3===h)for(let t=c;t<l;t++){const e=s[t],i=ws.GetObjectPtr(e,!1);i.hoplist.nhops=0,i.hoplist.hops=[];for(let t=0;t<r&&n[t]!==e;t++){let o=!1;for(let e of i.hooks)if(e.objid===n[t]){o=!0;break}if(!o){const i=ws.GetObjectPtr(n[t],!1);for(let t of i.hooks)if(t.objid===e){o=!0;break}}if(!o){const e={},o={};ve.CopyRect(e,i.r),ve.CopyRect(o,ws.GetObjectPtr(n[t],!1).r),0===e.width&&(e.width=1),0===e.height&&(e.height=1),0===o.width&&(o.width=1),0===o.height&&(o.height=1),ve.IntersectRect(e,o)&&i.CalcLineHops(ws.GetObjectPtr(n[t],!1),0)}}if(i.hoplist.nhops>1){i.hoplist.hops.sort(this.Hop_Compare);for(let t=i.hoplist.nhops-1;t>0;t--){const e=i.hoplist.hops[t-1].pt.x-i.hoplist.hops[t].pt.x,o=i.hoplist.hops[t-1].pt.y-i.hoplist.hops[t].pt.y;ve.Sqrt(e*e+o*o)<3*a&&(i.hoplist.hops[t-1].cons=!0)}}if(i.hoplist.nhops||i.hoplist.hops.length){const t=ve.Pt2Rect(i.StartPoint,i.EndPoint);for(let e=0;e<i.hoplist.nhops;e++)i.hoplist.hops[e].pt.x-=t.x,i.hoplist.hops[e].pt.y-=t.y;ws.AddToDirtyList(e)}}}F.Debug("O.Opt UpdateLineHops - Output: Completed updating line hops")}static FixAnyCircularHooks(t){F.Debug("O.Opt FixAnyCircularHooks - Input:",{initialLinkObject:t});const e=t?[t.BlockID]:(()=>{const t=ws.GetObjectPtr(ye.opt.linksBlockId,!1);let e=[];const i=t.length;for(let o=0;o<i;o++)e.includes(t[o].hookid)||e.push(t[o].hookid);return e})();let i=[];const o=e.length;for(let r=0;r<o;r++)n(i,e[r]);function n(t,e,i=[]){i.push(e);const o=ws.GetObjectPtr(e,!1);if(!o)return;const r=o.hooks.length;for(let l=0;l<r;l++){const r=o.hooks[l].objid;i.indexOf(r)>=0?a(t,e,r):n(t,r,s(i))}}function s(t){let e=[];for(let i=0;i<t.length;i++)e[i]=t[i];return e}function a(t,e,i){t.some((t=>t.objectId===e&&t.hookObjectId===i))||t.push({objectId:e,hookObjectId:i})}!function(t){const e=ws.GetObjectPtr(ye.opt.linksBlockId,!1),i=t.length;for(let o=0;o<i;o++){const i=ws.GetObjectPtr(t[o].objectId,!0),n=ws.GetObjectPtr(t[o].hookObjectId);if(n instanceof we.Shape.Connector){ws.DeleteObjects([n.BlockID],!1);continue}i.hooks=i.hooks.filter((e=>e.objid!=t[o].hookObjectId));const s=ye.opt.FindExactLink(e,t[o].hookObjectId,t[o].objectId);s>=0&&(e[s].flags=ve.SetFlag(e[s].flags,Ee.LinkFlags.DeleteTarget,!0))}}(i),F.Debug("O.Opt FixAnyCircularHooks - Output: Circular hooks fixed",{circularHookPairs:i})}}class Xo{static GroupSelectedShapes(t,e,i,o,n){let s,a=!1,r=[],l=vs.ActiveVisibleZList();i&&(l=vs.ZList());let h=l.length;if(0===h)return!1;if((e||ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data).length<=1)return!1;const c=e||Qo.GetMoveList(-1,!0,!0,!1,{},!1),p=function(t){const e=[];for(let i=0,o=t.length;i<o;i++){const o=ws.GetObjectPtr(t[i],!0);(o.Dimensions&Se.DimensionFlags.Always||o.Dimensions&Se.DimensionFlags.Select)&&(e.push({index:i,dimensions:o.Dimensions}),o.Dimensions=0,o.UpdateFrame())}return e}(c),d=ye.opt.GetListSRect(c);!function(t,e){for(let i=0,o=e.length;i<o;i++){const o=ws.GetObjectPtr(t[e[i].index],!0);o.Dimensions=e[i].dimensions,o.UpdateFrame()}}(c,p);const u=[];for(s=0;s<h;s++)-1!==c.indexOf(l[s])&&u.push(l[s]);const g=ws.GetObjectPtr(ye.opt.linksBlockId,!0);let y=null;const S=u.length;for(s=0;s<S;s++){y=ws.GetObjectPtr(u[s],!0),y.commentId>=0&&r.push(y.commentId);const t=y.Frame;if(t.x-=d.x,t.y-=d.y,y.NoRotate()&&(a=!0),y.bInGroup=!0,(y instanceof we.Shape.BaseLine||y instanceof we.Shape.Connector||void 0!==y.StartPoint&&void 0!==y.EndPoint)&&(y.StartPoint.x-=d.x,y.StartPoint.y-=d.y,y.EndPoint.x-=d.x,y.EndPoint.y-=d.y),y.NativeID>=0&&y.ShapeType===me.ShapeType.GroupSymbol){const t=ye.stdObj.PreserveBlock(y.NativeID);t&&t.Delete(),y.NativeID=-1}y.UpdateFrame(t)}const m={Frame:{x:d.x,y:d.y,width:d.width,height:d.height},TextGrow:Se.TextGrowBehavior.ProPortional,ShapesInGroup:u,InitialGroupBounds:{x:d.x,y:d.y,width:d.width,height:d.height}},b=new we.Shape.GroupSymbol(m);a&&(b.extraflags=ve.SetFlag(b.extraflags,me.ExtraFlags.NoRotate,!0)),vs.ZListPreserve();const D=xs.AddNewObject(b,!0,!1);for(b.StyleRecord&&(b.StyleRecord.Line&&(b.StyleRecord.Line.Thickness=0),b.StyleRecord.OutsideEffect&&(b.StyleRecord.OutsideEffect.OutsideType=0,b.StyleRecord.OutsideEffect.OutsideExtent_Bottom=0,b.StyleRecord.OutsideEffect.OutsideExtent_Left=0,b.StyleRecord.OutsideEffect.OutsideExtent_Right=0,b.StyleRecord.OutsideEffect.OutsideExtent_Top=0),b.UpdateFrame()),s=0;s<S;s++)vs.RemoveFromAllZLists(u[s]),Yo.DeleteLink(g,u[s],-1,null,0,!0);return r.length&&ye.opt.CommentGroup(r),l=vs.ActiveVisibleZList(),h=l.length,b.ConvertToNative(ye.opt.richGradients,i),xs.CompleteOperation([l[h-1]],t),o||i||Os.RenderAllSVGObjects(),ye.opt.moveList=null,D}static UngroupShape(t,e){let i,o,n,s=[],a=null,r=null,l=[],h=me.ExtraFlags.FlipVert,c=me.ExtraFlags.FlipHoriz,p=ws.GetObjectPtr(t,!0),d=[],u=p.Frame,g={x:u.x+u.width/2,y:u.y+u.height/2},y=p.ShapesInGroup,S=y.length;if(0===S)return;let m=null,b=ws.GetObjectPtr(ye.opt.linksBlockId,!0);vs.ZListPreserve();let D=u.x,f=u.y,x=u.width/p.InitialGroupBounds.width;isNaN(x)&&(x=1);let C=u.height/p.InitialGroupBounds.height;for(isNaN(C)&&(C=1),i=0;i<S;++i){if(m=ws.GetObjectPtr(y[i],!0),m.commentId>=0&&s.push(m.commentId),m instanceof we.Shape.ShapeContainer&&d.push(m.BlockID),a=new we.Shape.BaseDrawObject(null),a=Oe.DeepCopy(m),a.Frame.x+=D,a.Frame.y+=f,a.StartPoint&&(a.StartPoint.x+=D,a.StartPoint.y+=f),a.EndPoint&&(a.EndPoint.x+=D,a.EndPoint.y+=f),l.push(a),m instanceof we.Shape.GroupSymbol&&m.NativeID<0&&m.ConvertToNative(ye.opt.richGradients,!1),m.ScaleObject(D,f,g,p.RotationAngle,x,C,!0),o=0,p.extraflags&h&&m.Flip(h),p.extraflags&c&&(o=p.Frame.width-(m.Frame.x+m.Frame.width-p.Frame.x)-m.Frame.x+p.Frame.x,m.Flip(c)),o&&m.OffsetShape(o,0),-1!==m.DataID&&1!==C){let t=ws.GetObjectPtr(m.DataID,!0).runtimeText.styles,e=t.length;for(n=0;n<e;++n)t[n].size*=C}m.bInGroup=!1,ws.AddToDirtyList(y[i]),ye.opt.RebuildLinks(b,y[i])}for(vs.InsertObjectsIntoLayerAt(t,y),i=0;i<l.length;i++){ye.opt.ob=l[i],r=ws.GetObjectPtr(l[i].BlockID,!1);let t=!!e&&2;Yo.MaintainLink(l[i].BlockID,r,ye.opt.ob,me.ActionTriggerType.Flip,t)}ye.opt.ob={};let P=d.length;for(i=0;i<P;i++)Ps.SetLinkFlag(d[i],Ee.LinkFlags.Move);ye.opt.UpdateLinks(),p.ShapesInGroup=[],ws.DeleteObjects([t],!1),Os.RenderDirtySVGObjects()}static UngroupSelectedShapes(){let t,e;if(0===vs.ActiveVisibleZList().length)return!1;const i=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,o=i.length;if(0===o)return!1;let n=!1,s=null;for(t=0;t<o;++t){if(s=ws.GetObjectPtr(i[t],!1),s instanceof we.Shape.GroupSymbol){n=!0;break}if(s.NativeID>=0){n=!0;break}}if(n){const i=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!0).slice(0);let a=[];for(t=0;t<o;++t){s=ws.GetObjectPtr(i[t],!1);const o=i[t];s instanceof we.Shape.GroupSymbol?(n=!0,a=a.concat(s.ShapesInGroup),this.UngroupShape(o)):s.NativeID>=0?(e=ye.opt.UngroupNative(o,!1,!0),e&&(ws.DeleteObjects([o],!1),a=a.concat(e),n=!0)):a.push(o)}n&&(Os.RenderAllSVGObjects(),Qo.SelectObjects(a),xs.CompleteOperation(a))}}}const qo=class{static Init(t){if(this.isMobileDevice=/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),this.isSafariBrowser=navigator.appVersion.includes("Safari")&&!navigator.appVersion.includes("Chrome")&&!navigator.appVersion.includes("CrMo")&&!navigator.appVersion.includes("CriOS"),this.isMacOS=/(mac os x)/i.test(navigator.userAgent)&&!qo.isMobileDevice,this.isInternetExplorer=navigator.userAgent.toLowerCase().includes("msie")||navigator.userAgent.toLowerCase().includes("trident"),this.isFirefox=navigator.userAgent.toLowerCase().includes("firefox"),this.isIOSDevice=/ip(ad|hone|od)/i.test(navigator.userAgent),this.IEclipboardDiv=Rt("#_IEclipboardDiv"),this.clipboardInputElement=Rt("#_clipboardInput"),this.clipboardInputElement&&0!==this.clipboardInputElement.length){if(this.isMacOS&&this.isMobileDevice&&this.isSafariBrowser&&this.isIOSDevice){qo.clipboardInputElement.attr("readonly","readonly");const t=Rt("#_crossTabClipboardDiv");t.css("left","-100px"),t.css("top","-100px")}this.lastCutCopyTimestamp=-1,(this.isInternetExplorer||this.isFirefox)&&document&&document.addEventListener&&document.addEventListener("beforepaste",(()=>{qo.FocusOnIEclipboardDiv()})),this.clipboardInputElement[0].addEventListener("input",(t=>{this.clipboardInputElement.val(),this.isSafariBrowser?(this.clipboardInputElement.focus(),setTimeout(this.FocusOnClipboardInput,0)):this.FocusOnClipboardInput()})),["cut","copy","paste"].forEach((t=>{document.addEventListener(t,(e=>{if(ye.docUtil.IsReadOnly())return;if(("cut"===t||"copy"===t)&&Rt("#_clipboardInput:focus,#_IEclipboardDiv:focus,#T3TouchProxy:focus").length<=0)return;if("paste"===t&&(Rt("input:focus").length>0||Rt("textarea:focus").length>0)&&Rt("#_clipboardInput:focus,#_IEclipboardDiv:focus,#T3TouchProxy:focus").length<=0)return;let i;void 0!==e.clipboardData?i=e.clipboardData:void 0!==e.originalEvent.clipboardData?i=e.originalEvent.clipboardData:void 0!==window.clipboardData&&(i=window.clipboardData);const o=Rt("#T3TouchProxy:focus").length>0;if("cut"===t||"copy"===t){const o=!qo.GetCutCopyText(),n=qo.CanUseAsyncClipboard();n&&o?qo.GenerateImageInfo().then((o=>{qo.DoCutCopy(e,t,n,i,o)})):qo.DoCutCopy(e,t,n,i)}"paste"===t&&qo.PasteFromSystemEvent(i),o&&e.preventDefault()}))})),Rt(document).mouseup(qo.FocusOnClipboardInput),qo.FocusOnClipboardInput()}else F.Debug("T3Clipboard: Required DOM elements not found, skipping clipboard initialization")}static CanUseAsyncClipboard(){return!(qo.isInternetExplorer||qo.isFirefox||qo.isSafariBrowser)}static DoCutCopy(t,e,i,o,n){if(ye.opt.htmlClipboard=this.GetCutCopyHTML(),"cut"===e?$o.CutObjects(!0):"copy"===e&&$o.CopyObjects(),this.lastCutCopyTimestamp=(new Date).getTime(),i){if(!qo.ValidateAsyncClipboardApi())return;navigator&&navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"clipboard-write"}).then((()=>{}));const e=this.GetCutCopyText();if(e){const t={"text/plain":new Blob([e],{type:"text/plain"}),"text/html":new Blob([this.GetCutCopyHTML()],{type:"text/html"})},i=new ClipboardItem(t);navigator.clipboard.write([i]),this.FocusOnClipboardInput()}else if(n){const t=`<img src="${n.base64ImageData}"/>`,e={"image/png":n.imageBlob,"text/html":new Blob([this.GetCutCopyHTML(t)],{type:"text/html"})},i=new ClipboardItem(e);navigator.clipboard.write([i])}t.preventDefault()}else{if(this.isInternetExplorer)return o.setData("Text",this.GetCutCopyText()),this.IEclipboardDiv.html(this.GetCutCopyHTML()),qo.FocusOnIEclipboardDiv(),void setTimeout((()=>{this.FocusOnClipboardInput(),this.IEclipboardDiv.empty()}),0);o.setData("text/plain",this.GetCutCopyText()),o.setData("text/html",this.GetCutCopyHTML()),t.preventDefault(),F.Debug("= T3Clipboard: DoCutCopy/ data copied to system clipboard and the data is: ",o)}}static GenerateImageInfo1(){const t={},e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);return e&&0!==e.length?(i=e,new Promise((t=>ye.opt.GeneratePreviewPNG(i,1/0,1/0,{zList:i,fillBackground:!0})))).then((e=>(t.imageBlob=e,function(t){const e=new FileReader;return e.readAsDataURL(t),new Promise((t=>{e.onloadend=()=>t(e.result)}))}(e)))).then((e=>(t.base64ImageData=e,t))).catch((t=>{throw t})):Promise.resolve(null);var i}static GenerateImageInfo(){const t={},e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);return e&&0!==e.length?(i=e,new Promise((t=>ye.opt.GeneratePreviewPNG(i,1/0,1/0,{zList:i,fillBackground:!0})))).then((e=>(t.imageBlob=e,function(t){const e=new FileReader;return e.readAsDataURL(t),new Promise((t=>{e.onloadend=()=>t(e.result)}))}(e)))).then((e=>(t.base64ImageData=e,t))).catch((t=>{})):Promise.resolve(null);var i}static ValidateAsyncClipboardApi(){return!!navigator.clipboard}static PlainTextToSDObj(t){return"string"!=typeof t||null===t||0===t.length?t:{text:t,charStyles:[],hyperlinks:[],paraInfo:[],styles:[],vAlign:"middle"}}static PasteFromSystemEvent(t){F.Debug("= T3Clipboard: PasteFromSystemEvent/ Pasting from system event: ",t);const e=[{matches:this.isInternetExplorer,handler:this.PasteIE},{matches:this.isFirefox,handler:this.PasteFF},{matches:this.isSafariBrowser,handler:this.PasteSafari},{matches:!0,handler:this.PasteChrome}];this.ClearInteralClipboard();const i=e.find((t=>t.matches));i&&i.handler.call(this,t)}static PasteFF(t){ye.opt.textClipboard=qo.PlainTextToSDObj(t.getData("Text"));const e=t.getData("text/html");null!=e&&e.length>0&&(ye.opt.htmlClipboard=e),qo.FocusOnIEclipboardDiv(),setTimeout((()=>{if(qo.IEclipboardDiv.html().match(/<img src=['"]data/gi)){const t=Rt(qo.IEclipboardDiv[0].childNodes[0]).attr("src"),[e,i]=t.split(","),o=e.split(":")[1].split(";")[0],n=atob(i),s=new ArrayBuffer(n.length),a=new Uint8Array(s);for(let r=0;r<n.length;r++)a[r]=n.charCodeAt(r);ye.opt.imageClipboard=new Blob([a],{type:o})}qo.Paste(),qo.IEclipboardDiv.empty(),qo.FocusOnClipboardInput()}),0)}static PasteSafari(t){return this.PasteChrome(t)}static PasteIE(t){ye.opt.textClipboard=qo.PlainTextToSDObj(t.getData("Text"));const e=t.files;for(let i=0;i<e.length;i++)0===e[i].type.indexOf("image")&&(ye.opt.imageClipboard=e[i].slice(0,e[i].size-1));this.IEclipboardDiv.empty(),setTimeout((()=>{ye.opt.htmlClipboard=this.IEclipboardDiv.html(),this.Paste(),this.IEclipboardDiv.empty(),this.FocusOnClipboardInput()}),0)}static PasteChrome(t){void 0!==t.types&&null!=t.types&&Array.prototype.forEach.call(t.types,((e,i)=>{e.match(/image.*/)||void 0!==t.items&&t.items[i].type.match(/image.*/)?ye.opt.imageClipboard=t.items[i].getAsFile():e.match(/text\/plain/)||void 0!==t.items&&t.items[i].type.match(/text\/plain/)?t.items[i].getAsString((t=>{ye.opt.textClipboard=qo.PlainTextToSDObj(t)})):(e.match(/text\/html/)||t.items[i].type.match(/text\/html/))&&t.items[i].getAsString((t=>{ye.opt.htmlClipboard=t}))})),setTimeout(qo.Paste,10)}static ClearInteralClipboard(){ye.opt.textClipboard=null,ye.opt.htmlClipboard=null,ye.opt.imageClipboard=null}static PasteFromUIaction(){this.isMobileDevice||this.IsSameSystemPaste()?$o.PasteObjects():(this.ClearInteralClipboard(),this.PasteUsingAsynchClipboardAPI((()=>{}),(t=>{throw t})))}static PasteUsingAsynchClipboardAPI(t,e){if(this.isFirefox||this.isSafariBrowser){const t="Use ctrl+v to paste this information";return F.Debug(t),!1}return this.PasteUsingAsynchClipboardAPIDoPaste(t,e)}static PasteUsingAsynchClipboardAPIDoPaste(t,e){const i=[{typeRegex:/text\/html/,handler:t=>t.text().then((t=>(ye.opt.htmlClipboard=t,!0)))},{typeRegex:/text\/plain/,handler:t=>t.text().then((t=>(ye.opt.textClipboard=qo.PlainTextToSDObj(t),!0)))},{typeRegex:/image.*/,handler:t=>(ye.opt.imageClipboard=t,!0)}];return!!qo.ValidateAsyncClipboardApi()&&navigator.clipboard.read().then((t=>{const o=[];for(const n of t)for(const t of n.types){const s=n.getType(t).then((o=>{const n=i.find((e=>t.match(e.typeRegex)));if(n)return n.handler(o);e(`Cannot process clipboard content type: ${t}`)})).catch((t=>e(t)));o.push(s)}return Promise.all(o)})).then((()=>{setTimeout(this.Paste,1),t(!0)})).catch((t=>e(t)))}static FocusOnClipboardInput(){const t=Rt("input:focus").length>0,e=Rt("select:focus").length>0,i=Rt("textarea:focus").length>0;t||e||i||(qo.clipboardInputElement.val(" "),qo.clipboardInputElement.focus().select())}static FocusOnIEclipboardDiv(){if(/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent)){qo.IEclipboardDiv.focus();const t=document.createRange();t.selectNodeContents(qo.IEclipboardDiv.get(0));const e=window.getSelection();e.removeAllRanges(),e.addRange(t)}}static OnIECBEvent(t,e){const i=window.clipboardData;if("cut"!==t&&"copy"!==t||(i.setData("Text",this.GetCutCopyText()),this.IEclipboardDiv.html(this.GetCutCopyHTML()),this.FocusOnIEclipboardDiv(),setTimeout((()=>{this.FocusOnClipboardInput(),this.IEclipboardDiv.empty()}),0)),"paste"===t){const t=i.getData("Text");this.IEclipboardDiv.empty(),setTimeout((()=>{const e=this.IEclipboardDiv.html();this.Paste(t,e,ye.opt.imageClipboard),this.IEclipboardDiv.empty(),this.FocusOnClipboardInput()}),0)}}static OnCBEvent(t,e){const i=e.originalEvent.clipboardData;if("cut"!==t&&"copy"!==t||(i.setData("text/plain",this.GetCutCopyText()),i.setData("text/html",this.GetCutCopyHTML())),"paste"===t){const t=i.getData("text/plain"),e=i.getData("text/html");this.Paste(t,e,null)}}static Paste(){/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent);const t=qo.GetHTMLAsObject(ye.opt.htmlClipboard);let e=null;if(null!==t&&(e=qo.GetHeaderFromHTML(t)),null===t&&ye.opt.htmlClipboard)return qo.lastCutCopyTimestamp=-1,ye.opt.imageClipboard&&ye.opt.imageClipboard.size>0?ye.opt.header.ClipboardType=Ae.ClipboardType.Image:ye.opt.header.ClipboardType=Ae.ClipboardType.Text,ye.opt.header.ClipboardBuffer=null,ye.opt.header.clipboardJson=null,void $o.PasteObjects();null!==e&&$o.PasteObjects()}static GetCutCopyText(){/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent);const t=ye.opt.header.ClipboardType===Ae.ClipboardType.Text,e=ye.opt.textClipboard;return t&&null!=e?e.text:""}static GetCutCopyHTML(t=""){/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent);let e="";if(ye.opt.header.ClipboardType===Ae.ClipboardType.Text&&ye.opt.textClipboard&&(e+=ye.opt.textClipboard?ye.opt.textClipboard.text:""),ye.opt.header.ClipboardType,this.lastCutCopyTimestamp,t&&(e+=`<div>${t}</div>`),ye.opt.header.ClipboardType===Ae.ClipboardType.Text){const t=JSON.stringify(ye.opt.textClipboard),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);e+=Mt.fromByteArray(i)}if(ye.opt.header.ClipboardType===Ae.ClipboardType.LM){const t=new Uint8Array(ye.opt.header.ClipboardBuffer);e+=Mt.fromByteArray(t)}return e+="'/>",e+="</div>",e}static GetHTMLAsObject(t){var e;const i=null==(e=null==t?void 0:t.replace("\x3c!--",""))?void 0:e.replace("--\x3e","");return Rt("<html><body>"+i+"</body></html>")}static GetHeaderFromHTML(t){return""}static IsSameSystemPaste(){return!0}};let Jo=qo;a(Jo,"isMobileDevice"),a(Jo,"isSafariBrowser"),a(Jo,"isMacOS"),a(Jo,"isInternetExplorer"),a(Jo,"isFirefox"),a(Jo,"isIOSDevice"),a(Jo,"IEclipboardDiv"),a(Jo,"clipboardInputElement"),a(Jo,"lastCutCopyTimestamp");class $o{static Undo(t,e){if(F.Debug("O.Opt Undo - Input:",{restoreSequence:t,cancelModalOperation:e}),e)Ps.CancelOperation();else if(ye.opt.crtOpt!==me.OptTypes.None)return F.Debug("O.Opt Undo - Output:",!1),!1;if(null===ye.state)throw new Error("state is null");if(ye.opt.nudgeOpen&&ye.opt.CloseOpenNudge(),ye.state.currentStateId<=0)return F.Debug("O.Opt Undo - Output:",!1),!1;const i=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),o=(i.EnableSpellCheck,ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1));o.layers[o.activelayer].layertype;const n=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);-1!==n.theActiveTextEditObjectID&&n.theTELastOp!==Se.TextElemLastOpt.Init&&n.theTELastOp!==Se.TextElemLastOpt.Timeout&&n.theTELastOp!==Se.TextElemLastOpt.Select&&(this.FlushTextToLMBlock(),ws.PreserveUndoState(!1)),Oe.IsStateOpen(),t&&(ye.currentObjSeqId=ye.state.states[ye.state.currentStateId].currentObjSeqId),ye.state.RestorePrevState(),t||ye.state.AddToHistoryState();const s=ye.state.currentStateId;Ps.RebuildURLs(s+1,!1),Ts.ResizeSVGDocument(),Yo.UpdateLineHops(!0);ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).EnableSpellCheck;const a=ye.docUtil.rulerConfig;ye.docUtil.RulersNotEqual(i.rulerConfig,a)&&ye.docUtil.SetRulers(i.rulerConfig,!0),ye.docUtil.PagesNotEqual(i.Page,ye.opt.header.Page)&&(ye.opt.header.Page=Oe.DeepCopy(i.Page));const r=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),l=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if(-1!==l.theActiveOutlineObjectID&&0===r.length){const t=[];t.push(l.theActiveOutlineObjectID),Qo.SelectObjects(t,!1,!1)}on.TEUnregisterEvents(!0),ye.opt.noUndo=!0,Os.RenderAllSVGObjects(),ye.opt.noUndo=!1,-1!==l.theActiveTextEditObjectID&&this.ResetActiveTextEditAfterUndo();const h=Qo.GetTargetSelect();if(h>=0){const t=ws.GetObjectPtr(h,!1);let e=null;t&&(e=t.GetDimensionsForDisplay(),Ts.ShowFrame(!0)),Ts.UpdateDisplayCoordinates(e,null,null,t)}else Ts.ShowFrame(!1);return Qo.UpdateSelectionAttributes(r),F.Debug("O.Opt Undo - Output:",!0),!0}static Redo(t){if(F.Debug("O.Opt Redo - Input:",{shouldCancelModalOperation:t}),null===ye.state)throw new Error("state is null");if(t)Ps.CancelOperation();else if(ye.state.currentStateId+1>=ye.state.states.length)return F.Debug("O.Opt Redo - Output: false (already at last state)"),!1;ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).EnableSpellCheck;const e=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);-1!==e.theActiveTextEditObjectID&&e.theTELastOp!==Se.TextElemLastOpt.Init&&e.theTELastOp!==Se.TextElemLastOpt.Timeout&&e.theTELastOp!==Se.TextElemLastOpt.Select&&(this.FlushTextToLMBlock(),ws.PreserveUndoState(!1));const i=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);i.layers[i.activelayer].layertype,this.RedoDeleteURLs(),Oe.IsStateOpen(),ye.state.RestoreNextState(),ye.state.AddToHistoryState(),ye.state.currentStateId,Ps.RebuildURLs(ye.state.currentStateId-1,!0),Ts.ResizeSVGDocument(),Yo.UpdateLineHops(!0);const o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),n=ye.docUtil.rulerConfig;ye.docUtil.RulersNotEqual(o.rulerConfig,n)&&ye.docUtil.SetRulers(o.rulerConfig,!0),ye.docUtil.PagesNotEqual(o.Page,ye.opt.header.Page)&&(ye.opt.header.Page=Oe.DeepCopy(o.Page));const s=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),a=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if(-1!==a.theActiveOutlineObjectID&&0===s.length){const t=[];t.push(a.theActiveOutlineObjectID),Qo.SelectObjects(t,!1,!1)}on.TEUnregisterEvents(!0),ye.opt.InUndo=!0,Os.RenderAllSVGObjects(),ye.opt.InUndo=!1,ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),-1!==a.theActiveTextEditObjectID&&this.ResetActiveTextEditAfterUndo();const r=Qo.GetTargetSelect();if(r>=0){const t=ws.GetObjectPtr(r,!1);let e=null;t&&(e=t.GetDimensionsForDisplay(),Ts.ShowFrame(!0)),Ts.UpdateDisplayCoordinates(e,null,null,t)}else Ts.ShowFrame(!1);const l=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);return l.layers[l.activelayer].layertype,Qo.UpdateSelectionAttributes(s),F.Debug("O.Opt Redo - Output: true"),!0}static RedoDeleteURLs(){const t=ye.state.currentStateId;if(t+1>=ye.state.states.length)return;const e=ye.state.states[t+1],i=e.storedObjects.length;for(let o=0;o<i;o++){const t=e.storedObjects[o];if(t.Type===Ce.StoredObjectType.BaseDrawObject)if(t.stateOptTypeId===Ce.StateOperationType.DELETE){const e=ye.stdObj.GetObject(t.ID);if(e){const t=e.Data;Ps.IsBlobURL(t.ImageURL)&&Ps.DeleteURL(t.ImageURL)}}else{const e=ye.stdObj.GetObject(t.ID);if(e){const i=e.Data;Ps.IsBlobURL(i.ImageURL)&&t.Data.ImageURL!==i.ImageURL&&Ps.DeleteURL(i.ImageURL)}}}}static MakeSameSize(t){F.Debug("O.Opt MakeSameSize - Input:",{sizeOption:t});const e=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,i=e.length;if(i<=1)return void F.Debug("O.Opt MakeSameSize - Output:","Not enough objects selected");const o=Qo.GetTargetSelect();if(-1===o)return void F.Debug("O.Opt MakeSameSize - Output:","No target object selected");const n=ws.GetObjectPtr(o,!1),s=Oe.DeepCopy(n.Frame),a=s.height,r=s.width;for(let l=0;l<i;++l){const i=e[l];if(i===o)continue;const n=ws.GetObjectPtr(i,!0),s=Oe.DeepCopy(n.Frame);switch(t){case 1:n.SetSize(null,a,0);break;case 2:n.SetSize(r,null,0);break;case 3:n.SetSize(r,a,0)}if(ye.docUtil.docConfig.centerSnap&&ye.docUtil.docConfig.enableSnap||!1===ye.docUtil.docConfig.enableSnap){const t=(n.Frame.width-s.width)/2,e=(n.Frame.height-s.height)/2;(t||e)&&this.OffsetShape(i,-t,-e,0)}n.rflags&&(n.rflags=ve.SetFlag(n.rflags,Se.FloatingPointDim.Width,!1),n.rflags=ve.SetFlag(n.rflags,Se.FloatingPointDim.Height,!1)),Ps.SetLinkFlag(i,Ee.LinkFlags.Move),ws.AddToDirtyList(i)}xs.CompleteOperation(),F.Debug("O.Opt MakeSameSize - Output:","Completed")}static FlipShapes(t){F.Debug("O.Opt FlipShapes - Input:",{flipType:t});const e=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,i=e.length;if(0!==i){let n,s=0,a=null,r=!1;for(n=t===me.ExtraFlags.FlipVert?me.ExtraFlags.FlipHoriz:me.ExtraFlags.FlipVert,s=0;s<i;s++)if(a=ws.GetObjectPtr(e[s],!1),a.NoFlip()){r=!0;break}if(r);else{for(s=0;s<i;s++)a=ws.GetObjectPtr(e[s],!0),Ps.SetLinkFlag(e[s],Ee.LinkFlags.Move),a.hooks.length&&Ps.SetLinkFlag(a.hooks[0].objid,Ee.LinkFlags.Move),ws.AddToDirtyList(e[s]),o=a,!(Math.abs(o.RotationAngle%180)<20)&&Math.abs(o.RotationAngle%90)<20?a.Flip(n):a.Flip(t);xs.CompleteOperation()}}var o;F.Debug("O.Opt FlipShapes - Output: completed")}static FlipVertexArray(t,e){F.Debug("O.Opt FlipVertexArray - Input:",{vertices:t,flipFlags:e});const i=t.length;for(let o=0;o<i;o++)e&me.ExtraFlags.FlipHoriz&&(t[o].x=1-t[o].x),e&me.ExtraFlags.FlipVert&&(t[o].y=1-t[o].y);return F.Debug("O.Opt FlipVertexArray - Output:",t),t}static SendToBackOf(){F.Debug("O.Opt SendToBackOf - Input: no parameters");const t=vs.GetFrontBackLayersForSelected();t.result&&this.SendToBackOfSpecificLayer(t.backmostindex),F.Debug("O.Opt SendToBackOf - Output: completed")}static SendToBackOfSpecificLayer(t,e){F.Debug("O.Opt SendToBackOfSpecificLayer - Input:",{targetLayerIndex:t,updateSelectedBlock:e});let i=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data;if(0!==i.length){const o=ye.opt.AddAssoctoList(i,!0);let n=o.length;if(0!==n){const i=vs.VisibleZList();if(i.length>=1){const s=[];for(let t=0;t<n;t++){const e=o[t],n=Rt.inArray(e,i);s.push(n)}s.sort(((t,e)=>t-e));const a=vs.ZListPreserveForLayer(t),r=[];for(let t=0;t<n;t++){const e=i[s[t]];r.push(e)}for(let t=r.length-1;t>=0;t--){const e=r[t];vs.RemoveFromAllZLists(e),a.unshift(e)}if(Yo.UpdateLineHops(!0),null==e){ye.stdObj.PreserveBlock(ye.opt.selectObjsBlockId).Data=o}Os.RenderAllSVGObjects(),xs.CompleteOperation()}}}F.Debug("O.Opt SendToBackOfSpecificLayer - Output: completed")}static PasteObjects(t){F.Debug("O.Opt PasteObjects - Input:",t);try{let t;if(-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID||ye.opt.bInNoteEdit){if(ye.opt.textClipboard&&ye.opt.textClipboard.text){if(Jo.isInternetExplorer){const t=ye.opt.textClipboard.text.length;t>=2&&"\r"===ye.opt.textClipboard.text[t-2]&&"\n"===ye.opt.textClipboard.text[t-1]&&(ye.opt.textClipboard.text=ye.opt.textClipboard.text.slice(0,-2))}t=ye.opt.svgDoc.GetActiveEdit(),t&&(on.RegisterLastTEOp(Se.TextElemLastOpt.Paste),t.Paste(ye.opt.textClipboard,!0),on.RegisterLastTEOp(Se.TextElemLastOpt.Timeout))}return void F.Debug("O.Opt PasteObjects - Output: Text pasted in text editor")}if(ye.opt.bInDimensionEdit)return ye.opt.textClipboard&&ye.opt.textClipboard.text&&(t=ye.opt.svgDoc.GetActiveEdit(),t&&t.Paste(ye.opt.textClipboard,!0)),void F.Debug("O.Opt PasteObjects - Output: Text pasted in dimension editor");if(ye.opt.textClipboard&&ye.opt.textClipboard.text&&"\r\n"!==ye.opt.textClipboard.text&&-1!==Qo.GetTargetSelect())return on.TargetPasteText(),void F.Debug("O.Opt PasteObjects - Output: Text pasted to target");if(ye.opt.imageClipboard&&ye.opt.header.ClipboardType===Ae.ClipboardType.Image)return ye.opt.SetBackgroundImage(ye.opt.imageClipboard,0),void F.Debug("O.Opt PasteObjects - Output: Image pasted as background");ye.opt.CloseEdit(!1),ye.opt.header.ClipboardBuffer&&ye.opt.header.ClipboardType===Ae.ClipboardType.LM?(this.PasteLM(ye.opt.header.ClipboardBuffer,ye.opt.header.clipboardJson),F.Debug("O.Opt PasteObjects - Output: LM content pasted")):(this.PasteLM(ye.opt.header.ClipboardBuffer,ye.opt.header.clipboardJson),F.Debug("O.Opt PasteObjects - Output: No pasteable content found"))}catch(e){throw F.Debug("O.Opt PasteObjects - Error:",e),e}}static DeleteSelectedObjects(){this.DeleteSelectedObjectsCommon()}static DeleteSelectedObjectsCommon(t,e,i,o){F.Debug("O.Opt DeleteSelectedObjectsCommon - Input:",{objectIds:t,suppressCompleteOperation:e,preserveSelection:i,suppressCollabMessage:o});let n=0;if(t&&(n=t.length),Qo.AreSelectedObjects()||0!==n){i||ye.opt.CloseEdit();let o,n=Zo.GetNextSelect(),s=[];const a=ye.stdObj.PreserveBlock(ye.opt.selectObjsBlockId).Data,r=t||a;return o=ye.opt.AddtoDelete(r,!1,null),o>=0&&(n=o),r.length,ws.DeleteObjects(r,!1),i||(a.splice(0),n>=0?s.push(n):Qo.SetTargetSelect(-1,!0)),e||xs.CompleteOperation(s),F.Debug("O.Opt DeleteSelectedObjectsCommon - Output:",!0),!0}}static AlignShapes(t){let e,i;F.Debug("O.Opt AlignShapes - Input:",{alignmentType:t});let o=!1;const n=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,s=n.length;if(0!==s){const a=Qo.GetTargetSelect();let r=null,l=0;if(-1!==a){const h=ws.GetObjectPtr(a,!1);let c,p;r=h.GetAlignRect(),l=h.StyleRecord.Line.Thickness;let d=null;for(let u=0;u<s;++u)if(n[u]!==a&&(p=null,d=ws.GetObjectPtr(n[u],!1),!d.hooks.length)){switch(o=!0,d=ws.GetObjectPtr(n[u],!0),d.FramezList&&d.FramezList.length&&(p=d.FramezList),Ps.SetLinkFlag(n[u],Ee.LinkFlags.Move),ws.AddToDirtyList(n[u],!0),c=d.GetAlignRect(),t){case"lefts":e=r.x-l/2-(c.x-d.StyleRecord.Line.Thickness/2),i=0;break;case"centers":e=r.x+r.width/2-c.width/2-c.x,i=0;break;case"rights":e=r.x+r.width+l/2-(c.x+c.width+d.StyleRecord.Line.Thickness/2),i=0;break;case"tops":i=r.y-l/2-(c.y-d.StyleRecord.Line.Thickness/2),e=0;break;case"middles":i=r.y+r.height/2-c.height/2-c.y,e=0;break;case"bottoms":i=r.y+r.height+l/2-(c.y+c.height+d.StyleRecord.Line.Thickness/2),e=0;break;default:e=0,i=0}d.OffsetShape(e,i,p),e=0,i=0,d.r.x<0&&(e=-d.r.x),d.r.y<0&&(i=-d.r.y),(e||i)&&d.OffsetShape(e,i)}o?xs.CompleteOperation():F.Debug("O.Opt AlignShapes - Output: AlignHooked & UnBlockMessages")}}F.Debug("O.Opt AlignShapes - Output:",{alignmentPerformed:o})}static RotateShapes(t,e){F.Debug("O.Opt RotateShapes - Input:",{angleDegrees:t,selectionOverride:e});let i,o=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);e&&(o=e);let s=o.length;if(0!==s){let a,r,l,h=0,c=0;for(h=0;h<s&&(i=ws.GetObjectPtr(o[h],!1),!i.NoRotate());h++);if(i&&i.NoRotate())F.Debug("O.Opt RotateShapes - NoRotate");else{for(h=0;h<o.length;h++)if(i=ws.GetObjectPtr(o[h],!1),i instanceof we.Shape.PolyLineContainer){let t=i.GetListOfEnclosedObjects(!1);t.length>0&&(xs.AllowGroup(t)||F.Debug("O.Opt RotateShapes - GroupNotAllowed"),ye.opt.IsLinkedOutside(t)&&F.Debug("O.Opt RotateShapes - LinkedOutside"),ye.opt.IsGroupNonDelete()&&F.Debug("O.Opt RotateShapes - GroupNonDelete"))}for(h=0;h<o.length;h++)if(i=ws.GetObjectPtr(o[h],!0),i instanceof we.Shape.PolyLine&&i.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),i instanceof we.Shape.PolyLineContainer){if(Ps.SetLinkFlag(o[h],Ee.LinkFlags.Move),ws.AddToDirtyList(o[h]),r=i.RotateAllInContainer(i.BlockID,t),r&&r.length)for(c=o.length-1;c>=0;c--)r.indexOf(o[c])>=0&&o[c]!==i.BlockID&&o.splice(c,1);if(i instanceof we.Shape.PolyLineContainer||i.objecttype===Se.FNObjectTypes.FlWall)for(c=o.length-1;c>=0;c--)l=ws.GetObjectPtr(o[c],!1),l&&l.hooks.length&&l.hooks[0].objid===i.BlockID&&o.splice(c,1)}for(s=o.length,h=0;h<s;h++)if(i=ws.GetObjectPtr(o[h],!0),!(i instanceof we.Shape.PolyLineContainer))if(Ps.SetLinkFlag(o[h],Ee.LinkFlags.Move),ws.AddToDirtyList(o[h]),i instanceof we.Shape.BaseLine)if(i instanceof we.Shape.PolyLine){let e={x:i.Frame.x+i.Frame.width/2,y:i.Frame.y+i.Frame.height/2};a=2*Math.PI*((360-t)/360);let o=i.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);si.RotatePointsAboutPoint(e,a,o);let n=o.length;for(i.StartPoint.x=o[0].x,i.StartPoint.y=o[0].y,c=0;c<n;c++)i.polylist.segs[c].pt.x=o[c].x-i.StartPoint.x,i.polylist.segs[c].pt.y=o[c].y-i.StartPoint.y;i.EndPoint.x=o[n-1].x,i.EndPoint.y=o[n-1].y,i.CalcFrame()}else{ye.opt.ob=Oe.DeepCopy(i);let e=(i.StartPoint.x+i.EndPoint.x)/2,o=(i.StartPoint.y+i.EndPoint.y)/2,n=Math.sqrt(Math.pow(i.EndPoint.x-i.StartPoint.x,2)+Math.pow(i.EndPoint.y-i.StartPoint.y,2));a=2*Math.PI*(t/360),n/=2,i.StartPoint.x=e-Math.cos(a)*n,i.StartPoint.y=o-Math.sin(a)*n,i.EndPoint.x=e+Math.cos(a)*n,i.EndPoint.y=o+Math.sin(a)*n,i.AfterRotateShape(i.BlockID),ye.opt.ob={}}else if(i.RotationAngle=t,i.UpdateFrame(i.Frame),ye.opt.header.flags&me.HeaderFlags.NoAuto){let t=i.r.x+i.r.width,e=i.r.y+i.r.height,o=0,s=0;t>n.dim.x&&(o=n.dim.x-t),e>n.dim.y&&(s=n.dim.y-e),i.r.x<0&&(o=-i.r.x),i.r.y<0&&(s=-i.r.y),(o||s)&&i.OffsetShape(o,s)}null==e&&xs.CompleteOperation()}}F.Debug("O.Opt RotateShapes - Output: Rotation applied on selection, remaining count:",o.length)}static DuplicateObjects(t,e){F.Debug("O.Opt DuplicateObjects - Input:",{fromMove:t,editOverride:e});const i={selectedList:[]};if(ye.opt.CloseEdit(),Qo.AreSelectedObjects()){const o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!ye.opt.lastOpDuplicate&&!e);t?(o.dupdisp.x=0,o.dupdisp.y=0):e?(o.dupdisp.x=e.Data.dupdisp.x,o.dupdisp.y=e.Data.dupdisp.y):ye.opt.lastOpDuplicate||(o.dupdisp.x=50,o.dupdisp.y=50);const n=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);e||(Oe.DeepCopy(o.dupdisp),Oe.DeepCopy(n),Oe.DeepCopy(o.tselect));const s=this.CopyObjectsCommon(!0);if(s&&s.buffer){const n=ws.GetObjectPtr(s.zList[0],!1).Frame;Vo.ReadSymbolFromBuffer(s.buffer,n.x+o.dupdisp.x,n.y+o.dupdisp.y,0,!1,!0,i,!t,!1,!1,!1,!1),t||(xs.CompleteOperation(i.selectedList),e||(ye.opt.lastOpDuplicate=!0))}}return F.Debug("O.Opt DuplicateObjects - Output:",i.selectedList),i.selectedList}static CopyObjects(){F.Debug("O.Opt CopyObjects - Input:");let t;if(-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID||ye.opt.bInNoteEdit||ye.opt.bInDimensionEdit){const e=ye.opt.svgDoc.GetActiveEdit();if(e){const t=e.Copy(!0);t&&(ye.opt.textClipboard=t),ye.opt.header.ClipboardBuffer=null,ye.opt.header.clipboardJson=null,ye.opt.header.ClipboardType=Ae.ClipboardType.Text}return t=ye.opt.textClipboard,F.Debug("O.Opt CopyObjects - Output:",t),t}if(!Qo.AreSelectedObjects())return void F.Debug("O.Opt CopyObjects - Output: No selected objects");ye.opt.CloseEdit(),this.CopyObjectsCommon(!1),ye.opt.textClipboard=null;const e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);return Qo.UpdateSelectionAttributes(e),t=ye.opt.header.ClipboardBuffer,t=ye.opt.header.clipboardJson,F.Debug("O.Opt CopyObjects - Output:",t),t}static PasteLM(t,e){F.Debug("O.Opt PasteLM - Input:",t);const i={selectedList:[]},o=ye.opt.PastePoint||this.GetPastePosition();return Vo.ReadSymbolFromBuffer(t,o.x,o.y,0,!1,!0,i,!0,!1,!1,!1,!1),ye.opt.PastePoint=null,xs.CompleteOperation(i.selectedList),F.Debug("O.Opt PasteLM - Output:",i.selectedList),i.selectedList}static GetPastePosition(){F.Debug("= u.ToolActUtil: GetPastePosition/ - Input: no parameters");const t=100,e=ye.docUtil.svgDoc.GetWorkArea();let i=ye.docUtil.svgDoc.docInfo.docToScreenScale;null!=i&&0!==i||(i=1);let o={x:(e.scrollX+t)/i,y:(e.scrollY+t)/i};return e.scrollX===ye.opt.topLeftPasteScrollPos.x&&e.scrollY===ye.opt.topLeftPasteScrollPos.y?(o=ye.opt.topLeftPastePos,o.x+=50,o.y+=50,ye.opt.pasteCount++,ye.opt.pasteCount>5&&(ye.opt.pasteCount=0,o={x:(e.scrollX+t)/i,y:(e.scrollY+t)/i})):ye.opt.pasteCount=0,ye.opt.topLeftPastePos={x:o.x,y:o.y},ye.opt.topLeftPasteScrollPos={x:e.scrollX,y:e.scrollY},F.Debug("O.Opt GetPastePosition - Output:",o),o}static CutObjects(t){F.Debug("O.Opt CutObjects - Input:",{isFromCutButton:t});try{if(ye.opt.cutFromButton&&t)return ye.opt.cutFromButton=!1,void F.Debug("O.Opt CutObjects - Output:","Cut cancelled due to active cut button state.");ye.opt.cutFromButton=!t;if(-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID||ye.opt.bInNoteEdit||ye.opt.bInDimensionEdit){const t=ye.opt.svgDoc.GetActiveEdit();return t&&(ye.opt.textClipboard=t.Copy(!0),on.RegisterLastTEOp(Se.TextElemLastOpt.Cut),t.Delete(),ye.opt.header.ClipboardBuffer=null,ye.opt.header.clipboardJson=null,ye.opt.header.ClipboardType=Ae.ClipboardType.Text,on.RegisterLastTEOp(Se.TextElemLastOpt.Timeout)),void F.Debug("O.Opt CutObjects - Output:","Text cut completed.")}if(!Qo.AreSelectedObjects())return void F.Debug("O.Opt CutObjects - Output:","No selected objects to cut.");ye.opt.CloseEdit(),this.CopyObjectsCommon(!1),this.DeleteSelectedObjectsCommon(),F.Debug("O.Opt CutObjects - Output:","Graphic objects cut completed.")}catch(e){throw ye.opt.RestorePrimaryStateManager(),ye.opt.ExceptionCleanup(e),F.Debug("O.Opt CutObjects - Output:","Error occurred during cut operation."),e}}static CopyObjectsCommon(t){F.Debug("= u.ToolActUtil: CopyObjectsCommon/ - Input:",{returnBuffer:t});const e=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data;ye.opt.AddtoDelete(e,!0,{connectors:!1});const i=vs.ZList(),o=e.length;if(0!==o){const t=[];for(let a=0;a<o;a++){const o=e[a],n=Rt.inArray(o,i);t.push(n)}t.sort(((t,e)=>t-e));const n=[];for(let e=0;e<o;e++){const o=i[t[e]];n.push(o)}ye.opt.header.ClipboardBuffer=Vo.WriteSelect(n,!1,!0,!1),F.Debug("= u.ToolActUtil: CopyObjectsCommon/ - ClipboardType: ",ye.opt.header.ClipboardType);const s=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);for(let e=s.length-1;e>=0;e--){const t=ws.GetObjectPtr(s[e],!1);t&&t.flags&Se.ObjFlags.NotVisible&&s.splice(e,1)}F.Debug("= u.ToolActUtil: CopyObjectsCommon/ - Output: Clipboard updated")}else F.Debug("= u.ToolActUtil: CopyObjectsCommon/ - Output: No objects selected");return{buffer:ye.opt.header.ClipboardBuffer,zList:i}}static UngroupShape(t,e){F.Debug("O.Opt UngroupShape - Input:",{groupId:t,maintainLinksFlag:e});let i,o,n,s=[],a=[],r=[],l=null,h=null,c=ws.GetObjectPtr(ye.opt.linksBlockId,!0);const p=me.ExtraFlags.FlipVert,d=me.ExtraFlags.FlipHoriz,u=ws.GetObjectPtr(t,!0),g=u.Frame,y={x:g.x+g.width/2,y:g.y+g.height/2},S=u.ShapesInGroup,m=S.length;if(0===m)return void F.Debug("O.Opt UngroupShape - Output: No shapes in group");const b=g.x,D=g.y;let f=g.width/u.InitialGroupBounds.width;isNaN(f)&&(f=1);let x=g.height/u.InitialGroupBounds.height;for(isNaN(x)&&(x=1),vs.ZListPreserve(),i=0;i<m;++i){const t=ws.GetObjectPtr(S[i],!0);if(t.commentId>=0&&s.push(t.commentId),t instanceof we.Shape.ShapeContainer&&a.push(t.BlockID),l=new we.Shape.BaseDrawObject(null),l=Oe.DeepCopy(t),l.Frame.x+=b,l.Frame.y+=D,t.StartPoint&&(l.StartPoint.x+=b,l.StartPoint.y+=D),t.EndPoint&&(l.EndPoint.x+=b,l.EndPoint.y+=D),r.push(l),t instanceof we.Shape.GroupSymbol&&t.NativeID<0&&t.ConvertToNative(ye.opt.richGradients,!1),t.ScaleObject(b,D,y,u.RotationAngle,f,x,!0),o=0,u.extraflags&p&&t.Flip(p),u.extraflags&d&&(o=g.width-(t.Frame.x+t.Frame.width-g.x)-t.Frame.x+g.x,t.Flip(d)),o&&t.OffsetShape(o,0),-1!==t.DataID&&1!==x){const e=ws.GetObjectPtr(t.DataID,!0).runtimeText.styles,i=e.length;for(n=0;n<i;++n)e[n].size*=x}t.bInGroup=!1,ws.AddToDirtyList(S[i]),ye.opt.RebuildLinks(c,S[i])}for(vs.InsertObjectsIntoLayerAt(t,S),i=0;i<r.length;i++){ye.opt.ob=r[i],h=ws.GetObjectPtr(r[i].BlockID,!1);const t=!!e&&2;Yo.MaintainLink(r[i].BlockID,h,ye.opt.ob,me.ActionTriggerType.Flip,t)}ye.opt.ob={};const C=a.length;for(i=0;i<C;i++)Ps.SetLinkFlag(a[i],Ee.LinkFlags.Move);ye.opt.UpdateLinks(),u.ShapesInGroup=[],ws.DeleteObjects([t],!1),s.length&&ye.opt.CommentUngroup(s),Os.RenderDirtySVGObjects(),F.Debug("O.Opt UngroupShape - Output: Successfully ungrouped",m,"shapes")}static GroupSelected(t,e,i,o,n){Xo.GroupSelectedShapes(t,e,i,o,n)}static UnGroupSelected(){Xo.UngroupSelectedShapes()}static RotateRect(t,e,i){F.Debug("O.Opt RotateRect - Input:",{rectangle:t,centerPoint:e,angleDegrees:i});const o=[],n={x:0,y:0,width:0,height:0};if(o.push(new De(t.x,t.y)),o.push(new De(t.x+t.width,t.y)),o.push(new De(t.x+t.width,t.y+t.height)),o.push(new De(t.x,t.y+t.height)),o.push(new De(t.x,t.y)),o&&o.length){if(i){const n=-2*Math.PI*(i/360);e.x=(t.x+t.x+t.width)/2,e.y=(t.y+t.y+t.height)/2,si.RotatePointsAboutPoint(e,n,o)}ve.GetPolyRect(n,o)}return F.Debug("O.Opt RotateRect - Output:",n),n}static RotateRectAboutCenter(t,e,i){F.Debug("O.Opt RotateRectAboutCenter - Input:",{rectangle:t,centerPoint:e,angleDegrees:i});const o=[],n={x:0,y:0,width:0,height:0};if(o.push(new De(t.x,t.y)),o.push(new De(t.x+t.width,t.y)),o.push(new De(t.x+t.width,t.y+t.height)),o.push(new De(t.x,t.y+t.height)),o.push(new De(t.x,t.y)),o&&o.length){if(i){const t=-2*Math.PI*(i/360);si.RotatePointsAboutPoint(e,t,o)}ve.GetPolyRect(n,o)}return F.Debug("O.Opt RotateRectAboutCenter - Output:",n),n}static OffsetShape(t,e,i,o){F.Debug("O.Opt OffsetShape - Input:",{shapeId:t,offsetX:e,offsetY:i,hasAutoGrowSettings:!!o});let n={x:0,y:0},s=ye.stdObj.PreserveBlock(t);xs.InitializeAutoGrowDrag(o);let a=s.Data;a.OffsetShape(e,i),n.x=a.r.x+a.r.width,n.y=a.r.y+a.r.height,xs.DoAutoGrowDrag(n),(e||i)&&(Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ws.AddToDirtyList(t,!0)),F.Debug("O.Opt OffsetShape - Output: Shape offset applied",n)}}a($o,"rflags");class Zo{static GetGvSviOpt(t,e){return ye.wallOpt}static FindTreeTop(t,e,i){if(!t)return i.foundtree;if(t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line)return!1;if(t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector?(i.topconnector=t.BlockID,i.foundtree=!0,e&&Ps.SetLinkFlag(t.BlockID,e)):(i.topshape=t.BlockID,null!=i.level&&i.level++,e&&Ps.SetLinkFlag(t.BlockID,e)),t.hooks.length)if(t.hooks[0].objid===t.BlockID)t.hooks.splice(0,1);else{const o=ws.GetObjectPtr(t.hooks[0].objid,!1);o&&this.FindTreeTop(o,e,i)}else if(i.foundtree){if(t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){const t=ye.opt.FindChildArray(i.topshape,-1);t>=0&&(i.secondconnector=t)}}else{const o=ye.opt.FindChildArray(t.BlockID,-1);o>=0&&(i.topconnector=o,i.foundtree=!0,e&&Ps.SetLinkFlag(o,e))}return i.foundtree}static SelectContainerParent(t){const e=ws.GetObjectPtr(t,!1);return e&&e instanceof we.Shape.ShapeContainer&&e.hooks.length&&null!=e.hooks[0].cellid?e.hooks[0].objid:t}static ShapeCannotHaveActionButtons(t){return!0}static GetNextSelect(){const t=Qo.GetTargetSelect(),e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);let i=-1;if(t>=0){const o=ws.GetObjectPtr(t,!1);if(o&&o.hooks.length){const n=o.hooks[0].objid,s=ws.GetObjectPtr(n,!1);if(s&&s.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){if(s.IsFlowChartConnector())return-1;i=Zo.GetConnectorNextSelect(s,t,e)}else if(s&&s instanceof we.Shape.ShapeContainer){const e=s.ContainerList,o=e.List,n=e.flags&Se.ContainerListFlags.Sparse,a=o.length;let r=-1;for(let i=0;i<a;i++)if(o[i].id===t){r=i;break}if(n){if(i>=0)return i;if(i<0){for(let t=r-1;t>=0;t--)if(o[t].id>=0)return o[t].id;for(let t=r+1;t<a;t++)if(o[t].id>=0)return o[t].id}}else r>=0&&(r>0?i=o[r-1].id:a>1&&(i=o[r+1].id))}return i}const n=ye.opt.FindChildArray(t,-1);n>=0&&ws.GetObjectPtr(n,!1)}return i}static GetParentConnector(t,e){let i=-1;const o=ws.GetObjectPtr(t,!1);if(o&&o.hooks.length){const t=o.hooks[0].objid;if(t>=0){const n=ws.GetObjectPtr(t,!1);n&&n.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&(i=t,e&&(e.x=o.hooks[0].connect.x,e.y=o.hooks[0].connect.y))}}return i}static HasContainerParent(t){if(t&&t.hooks.length){const e=t.hooks[0].objid,i=ws.GetObjectPtr(e,!1);if(i&&i instanceof we.Shape.ShapeContainer)return e}return!1}static ShiftConnectedShapes(t,e,i,o,n,s,a){let r,l,h,c,p=[],d=[],u=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),g=me.ActionArrow;Zo.GetLineTree(e,i,p),r=Zo.FilterChartShapes(t,o,p,n);let y,S=0,m=0,b=ws.GetObjectPtr(i,!1),D=ws.GetObjectPtr(t,!1);if(n&&null!=s){let t=ws.GetObjectPtr(s,!1);if(t)if(t.flags&Se.ObjFlags.UseConnect&&t.ConnectPoints){let e=Oe.DeepCopy(t);y=e.AdjustAutoInsertShape(e.Frame,o===g.Up||o===g.Down,!0)?{width:e.Frame.height,height:e.Frame.width}:t.Frame}else y=t.Frame}switch(null==y&&(y=D.Frame),o){case g.Right:null!=a?(S=a,c=20):(S=y.width+u.def.h_arraywidth,c=u.def.g_arraywidth),h=Math.abs(b.EndPoint.x-b.StartPoint.x),!n&&h-S<c&&(S=h-c);break;case g.Left:S=null!=a?a:y.width+u.def.h_arraywidth,h=Math.abs(b.EndPoint.x-b.StartPoint.x),!n&&h-S<u.def.h_arraywidth&&(S=h-u.def.h_arraywidth),S=-S;break;case g.Down:null!=a?(m=a,c=20):(m=y.height+u.def.v_arraywidth,c=u.def.v_arraywidth),h=Math.abs(b.EndPoint.y-b.StartPoint.y),!n&&h-m<c&&(m=h-c);break;case g.Up:m=null!=a?a:y.height+u.def.v_arraywidth,h=Math.abs(b.EndPoint.y-b.StartPoint.y),!n&&h-m<u.def.v_arraywidth&&(m=h-u.def.v_arraywidth),m=-m}if(!n&&(S=-S,m=-m,Zo.GetLineTree(e,-1,d),l=Zo.FilterChartShapes(t,o,d,n),l.remainframe&&r.shiftframe)){r.shiftframe.x+=S,r.shiftframe.y+=m;const t=20;switch(o){case g.Right:if(r.shiftframe.x<l.remainframe.x+l.remainframe.width+t)return-1;break;case g.Left:if(r.shiftframe.x+r.shiftframe.width+t>l.remainframe.x)return-1;break;case g.Down:if(r.shiftframe.y<l.remainframe.y+l.remainframe.height+t)return-1;break;case g.Up:if(r.shiftframe.y+r.shiftframe.height+t>l.remainframe.y)return-1}}let f=r.newlist,x=f.length;for(let C=0;C<x;C++)$o.OffsetShape(f[C],S,m,0)}static GetLineTree(t,e,i){i.indexOf(t)<0&&i.push(t);const o=ws.GetObjectPtr(t,!1);if(o&&o.hooks.length&&i.indexOf(o.hooks[0].objid)<0){const e=ws.GetObjectPtr(o.hooks[0].objid,!1);if(e&&e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector)Zo.GetConnectorTree(e.BlockID,i,!0);else{let n=t;switch(e.objecttype){case zo.ObjectTypes.NgTimeLine:n=o.hooks[0].objid;break;case zo.ObjectTypes.NgEvent:e.hooks.length>0&&(n=e.hooks[0].objid)}i.indexOf(n)<0&&i.push(n)}}const n=Yo.FindAllChildConnectors(t);for(let r=0;r<n.length;r++)i.indexOf(n[r])<0&&Zo.GetConnectorTree(n[r],i,!0);let s;const a=ye.opt.FindAllChildLines(t);for(let r=0;r<a.length;r++)if(a[r]!==e&&i.indexOf(a[r])<0){i.push(a[r]);const e=ws.GetObjectPtr(a[r],!1);if(e&&2===e.hooks.length)for(let o=0;o<2;o++){const n=e.hooks[o].objid;if(n!==t){const t=ws.GetObjectPtr(n,!1);t&&t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&Zo.GetLineTree(n,a[r],i)}}else e.objecttype===zo.ObjectTypes.NgEvent&&(s=e.associd,s>=0&&i.indexOf(s)<0&&i.push(s))}}static FilterChartShapes(t,e,i,o){let n,s,a=ws.GetObjectPtr(t,!1),r=[],l=me.ActionArrow;if(a){let h,c,p,d,u=i.length,g=a.Frame.x+a.Frame.width,y=a.Frame.y+a.Frame.height;for(h=0;h<u;h++)if(p=i[h],p!==t&&(c=ws.GetObjectPtr(p,!1),c&&c.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)){switch(d=!1,e){case l.Right:c.Frame.x>g&&(r.push(p),d=!0);break;case l.Left:c.Frame.x+c.Frame.width<a.Frame.x&&(r.push(p),d=!0);break;case l.Down:c.Frame.y>y&&(r.push(p),d=!0);break;case l.Up:c.Frame.y+c.Frame.height<a.Frame.y&&(r.push(p),d=!0);break;default:r.push(p),d=!0}o||(d?null==n?n=Oe.DeepCopy(c.r):ve.UnionRect(n,c.r,n):null==s?s=Oe.DeepCopy(c.r):ve.UnionRect(s,c.r,s))}}return{newlist:r,shiftframe:n,remainframe:s}}static GetConnectorTree(t,e,i){e.indexOf(t)<0&&e.push(t);const o=ws.GetObjectPtr(t,!1);if(o&&o.arraylist){const t=o.arraylist.hook.length;for(let n=1;n<t;n++){const t=o.arraylist.hook[n].id;if(t>=0){if(e.indexOf(t)<0){e.push(t);const i=ws.GetObjectPtr(t,!1);i&&i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&Zo.GetConnectorTree(t,e)}const o=Yo.FindAllChildConnectors(t),n=o.length;for(let t=0;t<n;t++)this.GetConnectorTree(o[t],e,i);if(i){const i=ye.opt.FindAllChildLines(t),o=i.length;for(let n=0;n<o;n++)if(e.indexOf(i[n])<0){e.push(i[n]);const o=ws.GetObjectPtr(i[n],!1);if(o&&2===o.hooks.length)for(let s=0;s<2;s++){const a=o.hooks[s].objid;if(a!==t){const t=ws.GetObjectPtr(a,!1);t&&t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&Zo.GetLineTree(a,i[n],e)}}}}}}}}}class Qo{static SelectObjectFromClick(t,e,i){F.Debug("O.Opt SelectObjectFromClick - Input:",{event:t,svgElement:e,preserveSelection:i}),Ps.CancelOperation();if(0===vs.ActiveVisibleZList().length)return F.Debug("O.Opt SelectObjectFromClick - Output: false (no visible objects)"),!1;if(null===e)return F.Debug("O.Opt SelectObjectFromClick - Output: false (no SVG element)"),!1;const o=e.GetID(),n=ws.GetObjectPtr(o,!1);if(!(n&&n instanceof we.Shape.BaseDrawObject))return F.Debug("O.Opt SelectObjectFromClick - Output: false (not a drawing object)"),!1;let s=t.gesture.srcEvent.shiftKey||t.gesture.srcEvent.ctrlKey||Ae.DocContext.SelectionToolMultiple;t.gesture.srcEvent.ctrlKey&&t.gesture.srcEvent.metaKey&&(s=!1);const a=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data.indexOf(o);let r=[];return r.push(o),-1==a?(this.SelectObjects(r,s,!1),F.Debug("O.Opt SelectObjectFromClick - Output: true (object selected)"),!0):!s||(this.SelectObjects(r,s,!1),!!i)}static SelectObjects(t,e,i){F.Debug("O.Opt SelectObjects - Input:",{objectsToSelect:t,isMultipleSelection:e,preserveSelectionState:i});let o=-1;if(t&&t.length>0){-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID&&on.DeactivateTextEdit(!1,!0);const n=ws.GetObjectPtr(ye.opt.selectObjsBlockId,i);if(o=Qo.GetTargetSelect(),e||(ye.opt.SetDimensionVisibility(n,!1),n.length=0),o>=0){const t=n.indexOf(o);e?t>=0&&(o=-1):t<0&&(o=-1)}for(let i=0;i<t.length;i++){let s=t[i];if(ws.GetObjectPtr(s,!1)){const t=n.indexOf(s);if(-1===t)o<0&&(o=s),n.push(s);else if(e){const e=ws.GetObjectPtr(s,!1);e&&e.ShowOrHideDimensions(!1),n.splice(t,1)}}}if(o>=0){n.indexOf(o)<0&&(o=-1)}o<0&&n.length>0&&(o=n[0]),Qo.SetTargetSelect(o,i),ye.opt.lastOpDuplicate=!1,this.UpdateSelectionAttributes(n),Os.HideAllSVGSelectionStates(),Os.RenderAllSVGSelectionStates()}return F.Debug("O.Opt SelectObjects - Output:",{selectedIndex:o,selectedCount:(null==t?void 0:t.length)||0}),o}static GetTargetSelect(){F.Debug("O.Opt GetTargetSelect - Input: No parameters");const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);let e=-1;if(t.tselect>=0){const i=ws.GetObjectPtr(t.tselect,!1);i&&i instanceof we.Shape.BaseDrawObject&&(e=t.tselect)}return F.Debug("O.Opt GetTargetSelect - Output:",e),e}static SetTargetSelect(t,e){F.Debug("O.Opt SetTargetSelect - Input:",{targetId:t,preserveSession:e});let i=ws.GetObjectPtr(ye.opt.sdDataBlockId,e);i.tselect=t;let o=null;if(t>0){const e=ws.GetObjectPtr(t,!1);e&&e instanceof we.Shape.BaseDrawObject?o=e.GetDimensionsForDisplay():(t=-1,i.tselect=t)}o?(Ts.ShowFrame(!0),Ts.UpdateDisplayCoordinates(o,null,null,null)):Ts.ShowFrame(!1),F.Debug("O.Opt SetTargetSelect - Output:",{targetId:i.tselect,dimensions:o})}static UpdateSelectionAttributes(t){if(F.Debug("O.Opt UpdateSelectionAttributes - Input:",t),!t)return void F.Debug("O.Opt UpdateSelectionAttributes - Output: No selection objects provided, exiting early");let e,i,o,n,s=0;const a=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);t&&(s=t.length)&&t[0],this.ResetSelectionState();const r=ye.state.GetUndoState();let l=ye.opt.selectionState;if(l.undo=r.undo,l.redo=r.redo,ye.opt.bInDimensionEdit)return ye.opt.HandleDimensionEditMode(a),void F.Debug("O.Opt UpdateSelectionAttributes - Output: Dimension edit mode handled");if(0===s||ye.opt.bInNoteEdit)return ye.opt.HandleEmptySelectionOrNoteEditMode(a),void F.Debug("O.Opt UpdateSelectionAttributes - Output: Empty selection or note edit mode handled");for(e=Qo.GetTargetSelect(),l.nselect=s,e>=0&&(n=ws.GetObjectPtr(e,!1),n&&n instanceof we.Shape.BaseDrawObject||(e=-1,a.tselect=-1)),e>=0&&ye.opt.ProcessTargetObject(e,n),i=0;i<s;i++){const n=t[i];if(n!==e&&(l.allowalign=!0),o=ws.GetObjectPtr(n,!1),!(o instanceof we.Shape.BaseDrawObject))continue;const s=o;ye.opt.ProcessSelectedObject(o,s,i)}ye.opt.moveList=null,l.allowcopy=l.nselect>0;const h=Object.assign(new Ke,Oe.DeepCopy(l));ye.docUtil.rulerConfig.showpixels&&h.fontsize>=0&&(h.fontsize=Ps.PixelstoPoints(h.fontsize)),F.Debug("O.Opt UpdateSelectionAttributes - Output:",{nselect:l.nselect,nshapeselected:l.nshapeselected,nlineselected:l.nlineselected,nconnectorselected:l.nconnectorselected,hastext:l.selectionhastext})}static ResetSelectionState(){F.Debug("O.Opt ResetSelectionState - Input: No parameters");const t=ye.opt.selectionState;t.nselect=0,t.nlineselected=0,t.nshapeselected=0,t.nconnectorselected=0,t.ngroupsselected=0,t.nimageselected=0,t.ntablesselected=0,t.npolylinecontainerselected=0,t.ncells_selected=0,t.nsegs=0,t.IsTargetTable=!1,t.allowalign=0,t.allowcopy=!1,t.selectionhastext=!1,t.cell_notext=!1,t.cellselected=!1,t.projectTableSelected=!1,t.lockedTableSelected=!1,t.polyclosed=!1,t.iswallselected=!1,t.bInNoteEdit=ye.opt.bInNoteEdit,t.connectorCanHaveCurve=!1,t.isJiraCard=!1,t.width=0,t.widthstr="",t.height=0,t.heightstr="",t.left=0,t.leftstr="",t.top=0,t.topstr="",t.WallThickness=0,t.fixedCornerRadius=-2,t.lineCornerRadius=-2,t.TextDirection=0,t.dimensions=0,t.celltype=0,t.cellflags=0,t.subtype=0,t.objecttype=0,t.datasetElemID=-1,t.tselect=-1,t.paste=Ps.GetClipboardType(),t.csOptMng=ye.wallOpt,F.Debug("O.Opt ResetSelectionState - Output: Selection state reset")}static RemoveFromSelectedList(t){F.Debug("O.Opt RemoveFromSelectedList - Input:",t);const e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1).indexOf(t);if(-1!==e){ws.GetObjectPtr(ye.opt.selectObjsBlockId,!0).splice(e,1);if(t===ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).tselect){ws.GetObjectPtr(ye.opt.sdDataBlockId,!0).tselect=-1}}F.Debug("O.Opt RemoveFromSelectedList - Output: Object removed from selection")}static StartOptSltSelect(t){F.Debug("O.Opt StartOptSltSelect - Input event:",t);try{if(ye.docUtil.IsReadOnly())return void F.Debug("O.Opt StartOptSltSelect - Document is read-only; aborting.");if(ye.opt.crtOpt===me.OptTypes.FormatPainter){if(ye.opt.formatPainterSticky)return void F.Debug("O.Opt StartOptSltSelect - formatPainterSticky active; aborting.");Ts.SetFormatPainter(!0,!1)}ws.GetObjectPtr(ye.opt.teDataBlockId,!1),ye.opt.CloseEdit();const e=ye.opt.svgDoc.CreateShape(me.CSType.Rect);e.SetStrokeColor("black"),e.SetFillColor("black"),e.SetFillOpacity(.03);const i=1/ye.docUtil.GetZoomFactor();e.SetStrokeWidth(1*i);{const t=2*i+","+i;e.SetStrokePattern(t)}const o=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);ye.opt.optSltStartX=o.x,ye.opt.optSltStartY=o.y,e.SetSize(1,1),e.SetPos(o.x,o.y),ye.opt.svgOverlayLayer.AddElement(e),F.Debug("O.Opt StartOptSltSelect - Opt Slt shape created:",e),ye.opt.optSlt=e,ye.opt.EndStampSession(),ye.opt.WorkAreaHammer.on("drag",Ls.Evt_OptSltDrag),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_OptSltDragEnd),F.Debug("O.Opt StartOptSltSelect - Output opt slt set successfully:",ye.opt.optSlt)}catch(e){throw F.Debug("O.Opt StartOptSltSelect - Error:",e),this.OptSltSelectExceptionCleanup(e),ye.opt.ExceptionCleanup(e),e}}static SelectAllInRect(t,e){F.Debug("O.Opt SelectAllInRect - Input:",{selectionRect:t,allowMultipleSelection:e});const i=vs.ActiveVisibleZList(),o=ye.opt.RemoveNotVisible(i),n=o.length,s=Se.FNObjectTypes.ShapeContainer;if(0!==n){const i={x:t.x,y:t.y,width:t.width,height:t.height},a=[];for(let t=0;t<n;++t){const e=ye.stdObj.GetObject(o[t]);if(null!=e){const n=e.Data;if(n.objecttype!==s){let e=n.Frame;if(n.RotationAngle){const t={x:e.x+e.width/2,y:e.y+e.height/2};e=$o.RotateRectAboutCenter(e,t,n.RotationAngle)}ve.IsRectangleFullyEnclosed(i,e)&&a.push(o[t])}}}0===a.length?(F.Debug("O.Opt SelectAllInRect - No objects found in selection rectangle"),this.ClearSelectionClick()):(F.Debug("O.Opt SelectAllInRect - Found objects:",a.length),Qo.SelectObjects(a,e,!1))}else F.Debug("O.Opt SelectAllInRect - No visible objects to select");F.Debug("O.Opt SelectAllInRect - Output: Selection processing completed")}static OptSltSelectMoveCommon(t,e){if(F.Debug("O.Opt OptSltSelectMoveCommon - Input:",{mouseX:t,mouseY:e}),null===ye.opt.optSlt)return;const i=t,o=e,n=ye.opt.optSltStartX,s=ye.opt.optSltStartY;i>=n&&o>=s?(ye.opt.optSlt.SetSize(i-n,o-s),ye.opt.optSltFrame={x:n,y:s,width:i-n,height:o-s}):o<s?i>=n?(ye.opt.optSlt.SetSize(i-n,s-o),ye.opt.optSlt.SetPos(n,o),ye.opt.optSltFrame={x:n,y:o,width:i-n,height:s-o}):(ye.opt.optSlt.SetSize(n-i,s-o),ye.opt.optSlt.SetPos(i,o),ye.opt.optSltFrame={x:i,y:o,width:n-i,height:s-o}):i<n&&(ye.opt.optSlt.SetSize(n-i,o-s),ye.opt.optSlt.SetPos(i,s),ye.opt.optSltFrame={x:i,y:s,width:n-i,height:o-s}),F.Debug("O.Opt OptSltSelectMoveCommon - Output:",{optSltFrame:ye.opt.optSltFrame})}static UnbindOptSltHammerEvents(){F.Debug("O.Opt UnbindOptSltHammerEvents - Input"),ye.opt.WorkAreaHammer&&(ye.opt.WorkAreaHammer.off("drag"),ye.opt.WorkAreaHammer.off("dragend")),F.Debug("O.Opt UnbindOptSltHammerEvents - Output: done")}static OptSltSelectExceptionCleanup(t){F.Debug("O.Opt OptSltSelectExceptionCleanup - Input:",t);try{this.UnbindOptSltHammerEvents(),xs.ResetAutoScrollTimer(),ye.opt.optSlt&&ye.opt.svgOverlayLayer.RemoveElement(ye.opt.optSlt),ye.opt.optSlt=null,ye.opt.optSltStartX=0,ye.opt.optSltStartY=0,ye.opt.optSltFrame={x:0,y:0,width:0,height:0},ye.opt.noUndo=!1}catch(e){throw Uo.Error("= u.SelectUtil: OptSltSelectExceptionCleanup/ - Cleanup Error:",e),e}throw F.Debug("O.Opt OptSltSelectExceptionCleanup - Output: Cleanup completed"),t}static ClearAnySelection(t){F.Debug("O.Opt ClearAnySelection - Input:",{preserveBlock:t});const e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,t);0!==e.length&&(Qo.SetTargetSelect(-1,t),Os.HideAllSVGSelectionStates(),e.length=0),F.Debug("O.Opt ClearAnySelection - Output: selection cleared")}static ClearSelectionClick(){F.Debug("O.Opt ClearSelectionClick: input"),ye.opt.CloseEdit(),this.ClearAnySelection(!1),Qo.UpdateSelectionAttributes(null),F.Debug("O.Opt ClearSelectionClick: output")}static OptSltSelectCancel(t){F.Debug("O.Opt OptSltSelectCancel - Input:",t),ye.opt.optSlt&&(ye.opt.WorkAreaHammer.off("drag"),ye.opt.WorkAreaHammer.off("dragend"),ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart),xs.ResetAutoScrollTimer(),ye.opt.svgOverlayLayer.RemoveElement(ye.opt.optSlt),ye.opt.optSlt=null,ye.opt.optSltStartX=0,ye.opt.optSltStartY=0,ye.opt.optSltFrame={x:0,y:0,width:0,height:0}),F.Debug("O.Opt OptSltSelectCancel - Output: Opt slt selection canceled")}static SelectAllObjects(t){let e,i;F.Debug("U.Util1 SelectAllObjects - Input:",{typeFilter:t});const o=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);let n,s=0;if(o.theActiveTextEditObjectID>=0){e=ye.opt.svgObjectLayer.GetElementById(o.theActiveTextEditObjectID);const t=e.textElem;if(t&&(s=t.GetText().length,t.SetSelectedRange(0,s)),!(0===s&&o.theActiveTableObjectID>=0))return void F.Debug("U.Util1 SelectAllObjects - Output: All text selected");ye.opt.CloseEdit(!0)}const a=[];let r=vs.ActiveVisibleZList();r=ye.opt.RemoveNotVisible(r);const l=r.length;let h=0,c=!1;for(t&&(h=t.length),n=0;n<l;++n)i=ws.GetObjectPtr(r[n],!1),h>0&&(c=!!(-1!==t.indexOf(me.DrawObjectBaseClass.Shape)&&i instanceof we.Shape.PolyLineContainer&&i.polylist&&i.polylist.closed),-1===t.indexOf(i.DrawingObjectBaseClass)&&!c)||(a.push(r[n]),Qo.SelectObjects(a,!1,!1),F.Debug("U.Util1 SelectAllObjects - Output: Selected",a.length,"objects"))}static GetSelectionContext(){let t;F.Debug("O.Opt GetSelectionContext - Input:",{});let e=[];if(-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID)return t=Zo.GetGvSviOpt(),t?(e.push(Ee.Contexts.Text),e.push(ye.opt.GetAutomationContext(t)),F.Debug("O.Opt GetSelectionContext - Output:",e),e):(F.Debug("O.Opt GetSelectionContext - Output:",Ee.Contexts.Text),Ee.Contexts.Text);const i=ye.opt.svgDoc.GetActiveEdit();if(null!==i&&i.ID===me.SVGElementClass.DimText)return F.Debug("O.Opt GetSelectionContext - Output:",Ee.Contexts.DimensionText),Ee.Contexts.DimensionText;if(null!==i&&i.ID===me.SVGElementClass.NoteText)return F.Debug("O.Opt GetSelectionContext - Output:",Ee.Contexts.Note),Ee.Contexts.Note;let o=Qo.GetTargetSelect();if(0===o&&(o=-1),-1!==o){t=Zo.GetGvSviOpt();const i=ye.stdObj.GetObject(o).Data;if(t&&e.push(Ee.Contexts.Automation),i.AllowTextEdit())return e.length?(e.push(Ee.Contexts.Text),F.Debug("O.Opt GetSelectionContext - Output:",e),e):(F.Debug("O.Opt GetSelectionContext - Output:",Ee.Contexts.Text),Ee.Contexts.Text)}return F.Debug("O.Opt GetSelectionContext - Output:",Ee.Contexts.None),Ee.Contexts.None}static FindAllChildObjects(t,e,i){F.Debug("O.Opt FindAllChildObjects - Input:",{targetObjectId:t,filterDrawingBaseClass:e,filterObjectType:i});const o=ws.GetObjectPtr(ye.opt.linksBlockId,!1),n=Ps.FindLink(o,t,!0),s=[],a=o.length;if(n>=0)for(let r=n;r<a&&o[r].targetid===t;r++){const t=o[r].hookid,n=ws.GetObjectPtr(t,!1);n&&(null!=e&&n.DrawingObjectBaseClass!==e||null!=i&&n.objecttype!==i||s.push(t))}return F.Debug("O.Opt FindAllChildObjects - Output:",{childObjectIds:s}),s}static AreSelectedObjects(){F.Debug("O.Opt AreSelectedObjects - Input: No parameters");const t=ye.stdObj.GetObject(ye.opt.selectObjsBlockId),e=null!==t&&0!==t.Data.length;return F.Debug("O.Opt AreSelectedObjects - Output:",e),e}static FindConnect(t,e,i,o,n,s,a){F.Debug("O.Opt FindConnect - Input:",{targetObjectId:t,drawingObject:e?e.BlockID:null,hookPointsCount:i?i.length:0,showVisuals:o,isAttachMode:n,allowJoin:s,eventPosition:a});let r,l,h,c,p,d,u=0,g=-1,y=!1,S={},m=[],b=[],D=1e30,f=0,x={x:0,y:0},C={x:0,y:0},P=[],T=[],O=null,v=0,w=Se.HookFlags.LcHookNoExtra,k=me.HookPts,L=!1;const A=t=>{switch(t){case k.KTC:case k.KBC:case k.KRC:case k.KLC:return!0;default:if(t>=k.CustomBase&&t<k.CustomBase+100)return!0}return!1},I=e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line;if(null==i)return F.Debug("O.Opt FindConnect - Output: false (No hook points)"),!1;const E=ye.opt.linkParams.lpCircList;if(null==E)return F.Debug("O.Opt FindConnect - Output: false (No circular list)"),!1;x.x=ye.opt.linkParams.ConnectPt.x,x.y=ye.opt.linkParams.ConnectPt.y,f=e.hookflags,f=ve.SetFlag(f,Se.HookFlags.LcAttachToLine,!1);const G=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);G&&(v=G.flags),n?(P.push(me.DrawObjectBaseClass.Line),O=P):ye.opt.linkParams.ArraysOnly&&(e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector?(P.push(me.DrawObjectBaseClass.Shape),O=P):e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape?(P.push(me.DrawObjectBaseClass.Connector),v&me.SessionFlags.LLink&&P.push(me.DrawObjectBaseClass.Line),O=P):O=P),s&&T.push(me.DrawObjectBaseClass.Line),ye.opt.fromOverlayLayer&&(P.push(me.DrawObjectBaseClass.Shape),O=P),ye.opt.linkParams.JoinIndex=-1;for(let R=0;R<i.length;R++){if(u=0,(s||(S=new Wo(-1,0,null),e.ClosePolygon(t,i,S)&&(s=!0)))&&s&&(S=new Wo(-1,0,null),e.ClosePolygon(t,i,S)||(S=this.FindObject(i[R],E,T,!1,!0,null)),S&&S.hitcode===Se.HitCodes.PLApp)){ye.opt.linkParams.JoinIndex=S.objectid,ye.opt.linkParams.JoinData=S.segment,ye.opt.linkParams.JoinSourceData=i[R].id,r=S.pt.x-i[R].x,l=S.pt.y-i[R].y,ye.opt.dragDeltaX=r,ye.opt.dragDeltaY=l,ye.opt.linkParams.JoinData===me.HookPts.KTL?(ye.opt.linkParams.ConnectPt.x=0,ye.opt.linkParams.ConnectPt.y=0):(ye.opt.linkParams.ConnectPt.x=me.Common.DimMax,ye.opt.linkParams.ConnectPt.y=me.Common.DimMax);break}if(ye.opt.linkParams.PrevConnect>=0){const t=ws.GetObjectPtr(ye.opt.linkParams.PrevConnect,!1);if(t){const o=Oe.DeepCopy(ye.opt.linkParams.ContainerPt[0]);if(t.IsShapeContainer(e,o)){const i=t.GetHitTestFrame(e);ve.pointInRect(i,o)&&(S.objectid=ye.opt.linkParams.PrevConnect,S.hitcode=Se.HitCodes.InContainer,S.cellid=null)}else ve.pointInRect(t.r,i[R])&&(u=t.Hit(i[R],I,!1,null),u&&(null==S&&(S={cellid:null}),S.objectid=ye.opt.linkParams.PrevConnect,S.hitcode=u,S.cellid=null))}}if(0===u&&(S=this.FindObject(i[R],E,O,I,!1,e)),S&&S.hitcode){if(p=ws.GetObjectPtr(S.objectid,!1),null==p)return F.Debug("O.Opt FindConnect - Output: false (Target object not found)"),!1;if(S.hitcode===Se.HitCodes.InContainer&&(L=!0,d=S.theContainerPt),!L)if(n){if(ye.opt.linkParams.AutoInsert){if(e.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Shape)continue;let t=!1;for(let i=0;i<p.hooks.length;i++)if(p.hooks[i].objid==e.BlockID){t=!0;break}if(t)continue;if(p.LineType!==me.LineType.SEGLINE)continue}if(0==(p.targflags&Se.HookFlags.LcAttachToLine))continue}else{let t=p.targflags;if(ye.opt.linkParams.ArraysOnly||0!=(v&me.SessionFlags.SLink)?ye.opt.linkParams.ArraysOnly&&p.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line&&(t=ve.SetFlag(t,Se.HookFlags.LcShape,!0)):t=ve.SetFlag(t,Se.HookFlags.LcShape,!1),0==(f&t))continue}if(f=ve.SetFlag(f,Se.HookFlags.LcShapeOnLine,n),e.objecttype===Se.FNObjectTypes.FlWall&&(f=ve.SetFlag(f,Se.HookFlags.LcNoSnaps,!0)),b=p.GetTargetPoints(i[R],f|w,t),!b||0===b.length)return F.Debug("O.Opt FindConnect - Output: false (No target points)"),!1;m=p.GetPerimPts(S.objectid,b,null,!1,b[0].cellid,t);let o=i[R];L&&(C=o=d,c=d.id);for(let t=0;t<m.length;t++){const e=m[t].x-o.x,i=m[t].y-o.y;h=e*e+i*i,h<D&&(D=h,g=t)}if(p.polylist&&S.segment>=0){const t=this.FindObject(m[g],E,O,!1,!1,e);if(!t)return F.Debug("O.Opt FindConnect - Output: false (Segment check failed)"),!1;if(t.segment!=S.segment)return F.Debug("O.Opt FindConnect - Output: false (Segment mismatch)"),!1}if(L||(c=i[R].id,c=p.GetBestHook(t,i[R].id,b[g]),c!=i[R].id?(C=e.HookToPoint(c,null),C.x+=a.x-ye.opt.dragStartX,C.y+=a.y-ye.opt.dragStartY):C=i[R]),-1===g)return;const s=(r=m[g].x-C.x)*r+(l=m[g].y-C.y)*l;if(!p.AllowHook(i[R],t,s))continue;if(ye.opt.dragDeltaX=r,ye.opt.dragDeltaY=l,n&&ye.opt.linkParams.AutoInsert){ye.opt.linkParams.AutoPoints=[];let t=Oe.DeepCopy(e.Frame);if(Math.floor((e.RotationAngle+45)/90)){const e=90/(180/Se.Geometry.PI),i=[];i.push(new De(t.x,t.y)),i.push(new De(t.x+t.width,t.y+t.height)),si.RotatePointsAboutCenter(t,e,i),t=ve.Pt2Rect(i[0],i[1])}if(t.x+=r,t.y+=l,!p.GetFrameIntersects(t,e,ye.opt.linkParams.AutoPoints,ye.opt.linkParams))continue}y=!0,ye.opt.linkParams.ConnectIndex=S.objectid,ye.opt.linkParams.ConnectIndex>=0&&ye.opt.linkParams.ConnectIndexHistory.indexOf(ye.opt.linkParams.ConnectIndex)<0&&ye.opt.linkParams.ConnectIndexHistory.push(ye.opt.linkParams.ConnectIndex),ye.opt.linkParams.ConnectPt.x=b[g].x,ye.opt.linkParams.ConnectPt.y=b[g].y,ye.opt.linkParams.ConnectInside=b[g].cellid,ye.opt.linkParams.HookIndex=c,ye.opt.linkParams.AutoInsert&&n&&!ye.opt.linkParams.AutoSinglePoint?ye.opt.linkParams.ConnectHookFlag=Se.HookFlags.LcAutoInsert:ye.opt.linkParams.ArraysOnly&&p.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line&&e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&A(c)?ye.opt.linkParams.ConnectHookFlag=Se.HookFlags.LcHookReverse:ye.opt.linkParams.ConnectHookFlag=0;break}}if(y||(ye.opt.linkParams.ConnectIndex>=0&&ye.opt.linkParams.ConnectIndexHistory.indexOf(ye.opt.linkParams.ConnectIndex)<0&&ye.opt.linkParams.ConnectIndexHistory.push(ye.opt.linkParams.ConnectIndex),ye.opt.linkParams.ConnectIndex=-1),ye.opt.linkParams.JoinIndex!=ye.opt.linkParams.HiliteJoin&&o&&(ye.opt.linkParams.HiliteConnect>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteConnect,ye.opt.linkParams.ConnectPt,!1,!1,t,ye.opt.linkParams.HiliteInside),ye.opt.linkParams.HiliteConnect=-1,ye.opt.linkParams.HiliteInside=null,ye.opt.UndoEditMode()),ye.opt.linkParams.JoinIndex>=0&&ye.opt.linkParams.HiliteJoin<0?Ps.GetEditMode()!=Se.EditState.LinkJoin&&Ps.SetEditMode(Se.EditState.LinkJoin,null,!0):ye.opt.linkParams.JoinIndex<0&&ye.opt.linkParams.HiliteJoin>=0&&ye.opt.UndoEditMode(),ye.opt.linkParams.HiliteJoin>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteJoin,ye.opt.linkParams.ConnectPt,!1,!0,t,null),ye.opt.linkParams.HiliteJoin=-1,ye.opt.UndoEditMode()),ye.opt.linkParams.JoinIndex>=0&&(Yo.HiliteConnect(ye.opt.linkParams.JoinIndex,ye.opt.linkParams.ConnectPt,!0,!0,t,null),ye.opt.linkParams.HiliteJoin=ye.opt.linkParams.JoinIndex,Ps.GetEditMode()!=Se.EditState.LinkJoin&&Ps.SetEditMode(Se.EditState.LinkJoin,null,!0))),ye.opt.linkParams.HiliteConnect==ye.opt.linkParams.ConnectIndex&&ye.opt.linkParams.HiliteInside==ye.opt.linkParams.ConnectInside||!o)y&&o&&ye.opt.linkParams.HiliteConnect===ye.opt.linkParams.ConnectIndex&&ye.opt.linkParams.HiliteInside===ye.opt.linkParams.ConnectInside&&1===m.length&&(x.x==ye.opt.linkParams.ConnectPt.x&&x.y==ye.opt.linkParams.ConnectPt.y||Yo.MoveConnectHilite(ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.ConnectPt,ye.opt.linkParams.ConnectInside));else{if(ye.opt.linkParams.HiliteJoin>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteJoin,ye.opt.linkParams.ConnectPt,!1,!0,t,null),ye.opt.linkParams.HiliteJoin=-1,ye.opt.UndoEditMode()),ye.opt.linkParams.ConnectIndex>=0&&ye.opt.linkParams.HiliteConnect<0)Ps.GetEditMode()!=Se.EditState.LinkConnect&&Ps.SetEditMode(Se.EditState.LinkConnect,null,!0);else if(ye.opt.linkParams.ConnectIndex<0&&ye.opt.linkParams.HiliteConnect>=0){const i=ws.GetObjectPtr(ye.opt.linkParams.HiliteConnect,!1);e.OnDisconnect(t,i,ye.opt.linkParams.HookIndex,m[g]),ye.opt.UndoEditMode()}ye.opt.linkParams.HiliteConnect>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteConnect,ye.opt.linkParams.ConnectPt,!1,!1,t,ye.opt.linkParams.HiliteInside),ye.opt.linkParams.HiliteConnect=-1,ye.opt.linkParams.HiliteInside=null,ye.opt.UndoEditMode()),ye.opt.linkParams.ConnectIndex>=0&&(Yo.HiliteConnect(ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.ConnectPt,!0,!1,t,ye.opt.linkParams.ConnectInside),ye.opt.linkParams.HiliteConnect=ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.HiliteInside=ye.opt.linkParams.ConnectInside,e.OnConnect(t,p,ye.opt.linkParams.HookIndex,m[g],a),Ps.GetEditMode()!=Se.EditState.LinkConnect&&Ps.SetEditMode(Se.EditState.LinkConnect,null,!0))}return F.Debug("O.Opt FindConnect - Output:",y),y}static FindObject(t,e,i,o,n,s){let a,r;F.Debug("O.Opt FindObject - Input:",{point:t,objectIdFilter:e,classFilter:i,hitTestOptions:o,usePreciseHitTest:n,containerObject:s});const l=new Wo(-1,0,null),h=vs.ActiveVisibleZList();if(null==h)return F.Debug("O.Opt FindObject - Output: no visible objects"),-1;for(let c=h.length-1;c>=0;c--)if(!(r=e&&-1!==e.indexOf(h[c]))){if(a=ws.GetObjectPtr(h[c],!1),null!=a){if(s&&s instanceof we.Shape.ShapeContainer&&a.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector)continue;(a.flags&Se.ObjFlags.Lock||a.flags&Se.ObjFlags.NoLinking)&&(a=null)}if(null!=a){if(a.flags&Se.ObjFlags.NotVisible)continue;if(a.extraflags&me.ExtraFlags.ConnToConn)continue;if(s&&s.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&ye.opt.FindChildArray(h[c],-1)>=0)continue;i&&(r=-1===i.indexOf(a.DrawingObjectBaseClass));const e=a.GetHitTestFrame(s);if(e.width<me.Common.FindObjectMinHitSpot&&(e.width=me.Common.FindObjectMinHitSpot,e.x-=me.Common.FindObjectMinHitSpot/2),e.height<me.Common.FindObjectMinHitSpot&&(e.height=me.Common.FindObjectMinHitSpot,e.y-=me.Common.FindObjectMinHitSpot/2),a instanceof we.Shape.ShapeContainer){const t=Oe.DeepCopy(ye.opt.linkParams.ContainerPt[0]);if(a.IsShapeContainer(s,t)&&ve.pointInRect(e,t))return l.objectid=h[c],l.hitcode=Se.HitCodes.InContainer,l.theContainerPt=t,F.Debug("O.Opt FindObject - Output:",l),l;continue}if(!r&&ve.pointInRect(e,t)&&(l.objectid=h[c],l.hitcode=a.Hit(t,o,n,l),l.hitcode))return F.Debug("O.Opt FindObject - Output:",l),l}}return F.Debug("O.Opt FindObject - Output: result null"),null}static GetMoveList(t,e,i,o,n,s){let a,r,l,h,c,p,d,u,g;F.Debug("O.Opt GetMoveList - Input:",{objectId:t,useSelectedList:e,includeEnclosedObjects:i,useVisibleList:o,boundsRect:n,targetOnlyMode:s}),ye.opt.moveList=[];const y=ws.GetObjectPtr(ye.opt.linksBlockId,!1);if(null==y)return F.Debug("O.Opt GetMoveList - Output: No links found, returning empty list"),ye.opt.moveList;if(c=s?Se.ListCodes.TargOnly:Se.ListCodes.MoveTarg,t>=0&&(r=ws.GetObjectPtr(t,!1),r&&(h=r.GetHookFlags(),h&Se.HookFlags.LcMoveTarget&&e&&r.hooks.length&&(t=this.GetTargetNode(r.hooks[0].objid)))),e||o)for(l=o?vs.ActiveVisibleZList().slice(0):ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1).slice(0),a=0;a<l.length;a++)if(r=ws.GetObjectPtr(l[a],!1),r){if(r.objecttype===Se.FNObjectTypes.NgEventLabel){-1===l.indexOf(r.associd)&&l.push(r.associd);continue}(0===r.hooks.length||i)&&(ye.opt.moveList=Yo.GetHookList(y,ye.opt.moveList,l[a],r,c,n))}if(t>=0&&(r=ws.GetObjectPtr(t,!1),r&&(0===r.hooks.length||i)&&(ye.opt.moveList=Yo.GetHookList(y,ye.opt.moveList,t,r,c,n))),i)for(p=ye.opt.moveList.length,a=0;a<p;a++)for(r=ws.GetObjectPtr(ye.opt.moveList[a],!1),d=r.GetListOfEnclosedObjects(!0),u=d.length,g=0;g<u;g++){const t=d[g];ye.opt.moveList.indexOf(t)<0&&ye.opt.moveList.push(t)}return F.Debug("O.Opt GetMoveList - Output:",{objectCount:ye.opt.moveList.length,moveList:ye.opt.moveList}),ye.opt.moveList}static GetSelectedObject(){let t=Qo.GetTargetSelect();return{selectedId:t,selectedObject:ws.GetObjectPtr(t,!1)}}static GetSelectedObjectList(){const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);F.Debug("O.Opt GetSelectedObjectList - Input: No parameters");const e=[];for(let i=0;i<t.length;i++){const o=t[i],n=ws.GetObjectPtr(o,!1);n&&e.push(n)}return F.Debug("O.Opt GetSelectedObjectList - Output:",{selectedCount:t.length,objectCount:e.length}),{selectedList:t,selectedObjects:e}}}class tn{}a(tn,"ShapeTypes",{PHOTO:-2,TABLE:-1,TEXT:0,IMAGE:1,DOCUMENT:7,RECTANGLE:2,ROUNDED_RECTANGLE:3,OVAL:4,CIRCLE:9,DIAMOND:6,TRIANGLE:14,TRIANGLE_BOTTOM:15,PARALLELOGRAM:5,TRAPEZOID:17,TRAPEZOID_BOTTOM:18,OCTAGON:19,HEXAGON:21,PENTAGON:22,PENTAGON_LEFT:23,POLYGON:26,TERMINAL:8,INPUT:16,STORAGE:20,DELAY:24,DISPLAY:25,ARROW_RIGHT:10,ARROW_LEFT:11,ARROW_TOP:12,ARROW_BOTTOM:13,MEASURE_AREA:27,LAST_SHAPE:27,ForeignObject:28});class en{static ArcToPoly(t,e,i,o,n,s,a,r){F.Debug("O.Opt: ArcToPoly inputs:",{segments:t,center:{x:e.x,y:e.y},radius:i,startY:o,endY:n,targetX:s,flipArc:a,isComplexArc:r});let l,h,c,p=[];return r?(o>n?(c=e.y-i,h=e.y+i):(h=e.y-i,c=e.y+i),l=s<e.x,a=!1,this.ArcToPolySeg(p,t/2,e,i,o,h,s,a,!l),this.ArcToPolySeg(p,t,e,i,h,c,e.x,a,l),this.ArcToPolySeg(p,t/2,e,i,c,n,s,a,!l)):(l=s>=e.x,this.ArcToPolySeg(p,t,e,i,o,n,s,a,l)),F.Debug("O.Opt: ArcToPoly output points:",p.length),p}static ArcToPolySeg(t,e,i,o,n,s,a,r,l){F.Debug("O.Opt: ArcToPolySeg inputs:",{segments:e,center:{x:i.x,y:i.y},radius:o,startY:n,endY:s,targetX:a,flipArc:r,isRightSide:l});const h=o*o,c=(s-n)/e;for(let p=0;p<e;p++){const e=c*p,o=i.y-(n+e),s=ve.Sqrt(h-o*o),d=new De(0,0);if(d.y=i.y-o,l){d.x=i.x+s;const t=d.x-a;r&&(d.x=a-t)}else{d.x=i.x-s;const t=a-d.x;r&&(d.x=a+t)}t.push(d)}return F.Debug("O.Opt: ArcToPolySeg output points count:",t.length),t}static PolyGetIntersect(t,e,i,o,n){F.Debug("O.Opt PolyGetIntersect - Input:",{pointCount:t.length,intersectValue:e,isHorizontal:n});let s,a,r,l,h,c,p,d,u,g=0,y=1,S=!1,m=0,b=t.length,D=0,f={x:0,y:0},x={x:0,y:0};for(;y<b+1;y++){let r=y;if(f=t[g],y===b?(x=t[0],r=0):x=t[y],!ve.IsEqual(x.x,f.x)||!ve.IsEqual(x.y,f.y))if(g=y,s=x.x-f.x,a=x.y-f.y,n){if(f.x<x.x?(l=f.x,h=x.x):(l=x.x,h=f.x),e<l||e>h)continue;if(0===s&&(s=1),p=a/s*(e-f.x)+f.y,f.y<x.y?(d=f.y,u=x.y):(u=f.y,d=x.y),p>=d&&p<=u){if(D>0)for(m=0;m<D;m++)S=Math.abs(p-i[m])>1;else S=!0;if(S){if(D>=2)return F.Debug("O.Opt PolyGetIntersect - Output: Too many intersections",D+1),D+1;i[D]=p,o&&(o[D]=r),D++}}}else{if(f.y<x.y?(l=f.y,h=x.y):(l=x.y,h=f.y),e<l||e>h)continue;if(0===a&&(a=1),c=s/a*(e-f.y)+f.x,f.x<x.x?(d=f.x,u=x.x):(u=f.x,d=x.x),c>=d&&c<=u){if(D>0)for(m=0;m<D;m++)S=Math.abs(c-i[m])>1;else S=!0;if(S){if(D>=2)return F.Debug("O.Opt PolyGetIntersect - Output: Too many intersections",D+1),D+1;i[D]=c,o&&(o[D]=r),D++}}}}return 2===D&&i[0]>i[1]&&(r=i[1],i[1]=i[0],i[0]=r,o&&(r=o[1],o[1]=o[0],o[0]=r)),F.Debug("O.Opt PolyGetIntersect - Output: Found",D,"intersections"),D}static ArcToChord(t,e,i,o,n){const s={x:(e.x+t.x)/2,y:(e.y+t.y)/2},a=e.x-t.x,r=e.y-t.y,l=Math.sqrt(a*a+r*r),h=r/l,c=a/l,p=Math.abs(h)<1e-4?0:h,d=Math.abs(a)<1e-4?0:a,u=Math.asin(p),g=Math.acos(c);let y,S={x:0,y:0};y=d<0&&r<0?-g:u>0&&d<0?-u:u;const m=Math.sin(y),b=Math.cos(y);let D=t.x-s.x,f=t.y-s.y;S.x=D*b+f*m+s.x,S.y=-D*m+f*b+s.y,D=e.x-s.x,f=e.y-s.y;const x={x:n.StartPoint.x,y:n.StartPoint.y},C={x:n.EndPoint.x,y:n.EndPoint.y};D=x.x-s.x,f=x.y-s.y,x.x=D*b+f*m+s.x,x.y=-D*m+f*b+s.y,D=C.x-s.x,f=C.y-s.y,C.x=D*b+f*m+s.x,C.y=-D*m+f*b+s.y,D=i.x-s.x,f=i.y-s.y;const P={x:D*b+f*m+s.x,y:-D*m+f*b+s.y};let T={x:0,y:0},O=!1;o&&(D=o.center.x-s.x,f=o.center.y-s.y,T.x=D*b+f*m+s.x,T.y=-D*m+f*b+s.y,O=s.y<T.y?P.y<T.y:P.y>T.y,O&&(x.x<C.x?P.x>x.x&&P.x<C.x&&(C.x-P.x<P.x-x.x?P.x=C.x:P.x=x.x):P.x>C.x&&P.x<x.x&&(x.x-P.x<P.x-C.x?P.x=x.x:P.x=C.x))),P.y=s.y,D=P.x-s.x,f=P.y-s.y;const v=Math.sin(-y),w=Math.cos(-y);return P.x=D*w+f*v+s.x,P.y=-D*v+f*w+s.y,D=S.x-s.x,f=S.y-s.y,S.x=D*w+f*v+s.x,S.y=-D*v+f*w+s.y,o&&(P.x=2*Math.round((P.x+.5)/2),!0===O&&P.x--),P}static ChordToArc(t,e,i,o,n,s,a,r){const l=e.x-t.x,h=e.y-t.y,c=h/Math.sqrt(l*l+h*h),p=Math.abs(c)<1e-4?0:c;let d=Math.asin(p);(d>0&&l<0||d<0&&l<0&&h<0)&&(d=-d);let u=Math.sin(d),g=Math.cos(d),y={x:0,y:0},S={x:0,y:0},m=t.x-i.x,b=t.y-i.y;i.x,i.y,m=e.x-i.x,b=e.y-i.y,i.x,i.y,m=r.x-i.x,b=r.y-i.y,y.x=m*g+b*u+i.x,y.y=-m*u+b*g+i.y,m=t.x-i.x,b=t.y-i.y,S.x=m*g+b*u+i.x,S.y=-m*u+b*g+i.y;let D=S.y>i.y&&!a||S.y<=i.y&&a;s&&(D=!D),m=y.x-i.x,Math.abs(m)>o&&(m=o);const f=ve.Sqrt(o*o-m*m);if(D){if(y.y=i.y+f,n){const t=S.y-y.y;y.y=S.y+t}}else if(y.y=i.y-f,n){const t=S.y-y.y;y.y=S.y+t}m=y.x-i.x,b=y.y-i.y;const x=Math.sin(-d),C=Math.cos(-d);return y.x=m*C+b*x+i.x,y.y=-m*x+b*C+i.y,y}static ArcIntersect(t,e,i){t.EndPoint.x,t.StartPoint.x,t.EndPoint.y,t.StartPoint.y;let o=t.IsReversed?t.CalcRadiusAndCenter(t.EndPoint.x,t.EndPoint.y,t.StartPoint.x,t.StartPoint.y,t.CurveAdjust,t.IsReversed):t.CalcRadiusAndCenter(t.StartPoint.x,t.StartPoint.y,t.EndPoint.x,t.EndPoint.y,t.CurveAdjust,t.IsReversed),n=o.centerX,s=o.centerY,a=o.radius,r=e.EndPoint.x-e.StartPoint.x,l=e.EndPoint.y-e.StartPoint.y,h=0===r,c=h?1:l/r,p=e.StartPoint.x,d=e.StartPoint.y,u=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null);if(0===c){let o=e.StartPoint.y-s,r=a*a-o*o;if(r<0)return!1;let l=ve.Sqrt(r),h=l+n;if(i.x=h,i.y=d,si.LineDStyleHit(u,i,t.StyleRecord.lineThickness,0,null)||ve.pointInRect(t.Frame,i))return!0;let c=-l+n;return i.x=c,i.y=d,si.LineDStyleHit(u,i,t.StyleRecord.lineThickness,0,null)||ve.pointInRect(t.Frame,i)}if(h){let o=e.StartPoint.x-n,r=a*a-o*o;if(r<0)return!1;let l=ve.Sqrt(r),h=l+s;if(i.x=p,i.y=h,si.LineDStyleHit(u,i,t.StyleRecord.lineThickness,0,null)||ve.pointInRect(t.Frame,i))return!0;let c=-l+s;return i.x=p,i.y=c,si.LineDStyleHit(u,i,t.StyleRecord.lineThickness,0,null)||ve.pointInRect(t.Frame,i)}{let e=c*c+1,o=d-c*p-s,r=2*c*o-2*n,l=r*r-4*e*(n*n+o*o-a*a);if(l<0)return!1;let h=ve.Sqrt(l),g=(-r+h)/(2*e),y=d+c*(g-p);if(i.x=g,i.y=y,si.LineDStyleHit(u,i,t.StyleRecord.lineThickness,0,null)||ve.pointInRect(t.Frame,i))return!0;let S=(-r-h)/(2*e),m=d+c*(S-p);return i.x=S,i.y=m,si.LineDStyleHit(u,i,t.StyleRecord.lineThickness,0,null)||ve.pointInRect(t.Frame,i)}}static LinesMaintainDist(t,e,i,o){let n,s,a,r,l,h,c,p,d,u={startpt:0,endpt:0},g={x:0,y:0},y={x:0,y:0};if(null===e&&(e=t),u=e.GetConnectLine(),u?(c=u.startpt,p=u.endpt):(c=e.StartPoint,p=e.EndPoint),n=p.x-c.x,s=p.y-c.y,g.x=o.x,g.y=o.y,e.LineType===me.LineType.ARCLINE&&(g=this.ArcToChord(c,p,g,u,e)),i===me.ActionTriggerType.LineStart?(n=g.x-p.x,s=g.y-p.y):(n=g.x-c.x,s=g.y-c.y),a=Math.sqrt(n*n+s*s),u=t.GetConnectLine(),u?(c=u.startpt,p=u.endpt):(c=t.StartPoint,p=t.EndPoint),i===me.ActionTriggerType.LineStart?(d=p,n=-(p.x-c.x),s=-(p.y-c.y)):(d=c,n=p.x-c.x,s=p.y-c.y),r=Math.sqrt(n*n+s*s),a>r&&(a=r),r<1?(o.x=c.x,o.y=c.y):(l=s/r,h=n/r,o.x=d.x+h*a,o.y=d.y+l*a),t.LineType===me.LineType.ARCLINE){const e=t.CalcRadiusAndCenter(t.StartPoint.x,t.StartPoint.y,t.EndPoint.x,t.EndPoint.y,t.CurveAdjust,t.IsReversed),i=!1,n=!u&&t.IsReversed;y.x=e.centerX,y.y=e.centerY,o=this.ChordToArc(c,p,y,e.radius,n,i,e.centerInside,o)}}static GetMaxDim(t){return t.x=me.Common.MaxLongDim,t.y=me.Common.MaxLongDim,!0}static LinesAddCurve(t,e,i,o,n,s){let a,r=[],l=[],h={x:0,y:0,width:0,height:0};if(t)if(e>0&&i>0)for(h.x=o,h.y=n,h.width=s,h.height=-2*s,ve.PolyYCurve(l,h,20,0,0,0,-s,!0),a=l.length-1;a>=0;a--)r.push(l[a]);else e<0&&i>0?(h.x=o,h.y=n+2*s,h.width=s,h.height=-2*s,ve.PolyYCurve(r,h,20,0,0,-s,0,!0)):e>0&&i<0?(h.x=o,h.y=n-2*s,h.width=-s,h.height=2*s,ve.PolyYCurve(r,h,20,0,0,s,0,!0)):e<0&&i<0&&(h.x=o,h.y=n+2*s,h.width=-s,h.height=-2*s,ve.PolyYCurve(r,h,20,0,0,-s,0,!0));else if(e>0&&i>0)h.x=o-s,h.y=n,h.width=s,h.height=2*s,ve.PolyYCurve(r,h,20,0,0,0,s,!1);else if(e<0&&i>0)h.x=o,h.y=n,h.width=s,h.height=2*s,ve.PolyYCurve(r,h,20,0,0,0,s,!0);else if(e>0&&i<0)h.x=o-s,h.y=n,h.width=s,h.height=-2*s,ve.PolyYCurve(r,h,20,0,0,0,-s,!1);else if(e<0&&i<0)for(h.x=o,h.y=n-2*s,h.width=s,h.height=2*s,ve.PolyYCurve(l,h,20,0,0,s,0,!0),a=l.length-1;a>=0;a--)r.push(l[a]);return r}static PolyLJoin(t,e,i,o,n){let s,a,r,l,h,c,p,d,u,g,y,S,m,b=null,D=null,f=null,x=null,C=[],P=[],T=!1,O=!1,v=me.ActionTriggerType.LineEnd,w={x:0,y:0};const k=me.Common.KnobSize;let L,A,I=-1,E=vs.ActiveVisibleZList();if(b=ws.GetObjectPtr(t,!0),null==b)return-1;if(D=ws.GetObjectPtr(i,!0),null==D)return-1;if(g=b.DataID,D.DataID>=0&&(g=D.DataID),y=b.NoteID,D.NoteID>=0&&(y=D.NoteID),S=b.commentId,D.commentId>=0&&(S=D.commentId),m=b.HyperlinkText,D.HyperlinkText&&(m=D.HyperlinkText),o!==me.HookPts.WTL&&o!==me.HookPts.WTR||(o=me.HookPts.KTL),t===i&&b.LineType===me.LineType.POLYLINE){T=b.polylist.closed,b.polylist.closed=!0,s=b.polylist.segs.length,b.polylist.segs[s-1].pt.x=b.polylist.segs[0].pt.x,b.polylist.segs[s-1].pt.y=b.polylist.segs[0].pt.y,b.EndPoint.x=b.StartPoint.x,b.EndPoint.y=b.StartPoint.y,b.objecttype!==Se.FNObjectTypes.FlWall&&this.OpenShapeEdit(t);let e=-1;return b instanceof we.Shape.PolyLineContainer&&!T&&!0!==n&&(b.MaintainDimensionThroughPolygonOpennessChange(b.polylist.closed),e=-2),b.CalcFrame(),ws.AddToDirtyList(b.BlockID),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),Yo.MaintainLink(t,b,null,v,!1),e}if(b.LineType===me.LineType.POLYLINE)f=b,x=D,C.push(i),c=t;else if(D.LineType===me.LineType.POLYLINE){f=D,x=b;let n=e;e=o,o=n,C.push(t),c=i}if(null==f){C.push(i),C.push(t),I=Math.min(E.indexOf(i),E.indexOf(t));let e={Frame:{x:b.Frame.x,y:b.Frame.x,width:b.Frame.width,height:b.Frame.height},inside:{x:b.inside.x,y:b.inside.x,width:b.inside.width,height:b.inside.height},StartPoint:{x:b.StartPoint.x,y:b.StartPoint.y},EndPoint:{x:b.EndPoint.x,y:b.EndPoint.y},flags:Se.ObjFlags.Erase|Se.ObjFlags.EraseOnGrow,extraflags:me.ExtraFlags.SideKnobs,StartArrowID:D.StartArrowID,EndArrowID:D.EndArrowID,StartArrowDisp:D.StartArrowDisp,EndArrowDisp:D.EndArrowDisp,ArrowSizeIndex:D.ArrowSizeIndex,TextFlags:b.TextFlags,objecttype:b.objecttype,Dimensions:b.Dimensions,dataclass:tn.ShapeTypes.POLYGON,polylist:new vi};0===D.StartArrowID&&b.StartArrowID>0&&(e.StartArrowID=b.StartArrowID,e.StartArrowDisp=b.StartArrowDisp,e.ArrowSizeIndex=b.ArrowSizeIndex),0===D.EndArrowID&&b.EndArrowID>0&&(e.EndArrowID=b.EndArrowID,e.EndArrowDisp=b.EndArrowDisp,e.ArrowSizeIndex=b.ArrowSizeIndex),e.StyleRecord=Oe.DeepCopy(b.StyleRecord),e.objecttype===Se.FNObjectTypes.FlWall&&(e.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Transparent),e.StyleRecord.Fill.Hatch=0;let o=b.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),n=o.length;for(let t=0;t<n;t++){let i=0===t||b.LineType===me.LineType.SEGLINE?me.LineType.LINE:b.LineType;if(e.polylist.segs.push(new Pi(i,o[t].x-b.StartPoint.x,o[t].y-b.StartPoint.y)),i===me.LineType.ARCLINE)e.polylist.segs[e.polylist.segs.length-1].param=b.IsReversed?b.CurveAdjust:-b.CurveAdjust;else if(i===me.LineType.ARCSEGLINE){let i=this.PolyLinePrPolyLGetArcQuadrant(o[t-1],o[t],0);e.polylist.segs[e.polylist.segs.length-1].param=i.param,e.polylist.segs[e.polylist.segs.length-1].ShortRef=i.ShortRef}}f=ye.wallOpt.AddNewPolyLine(b.objecttype,e)||new we.Shape.PolyLine(e),x=D,O=!0}L=e===me.HookPts.KTL?{x:f.StartPoint.x,y:f.StartPoint.y}:{x:f.EndPoint.x,y:f.EndPoint.y},A=o===me.HookPts.KTL?{x:x.StartPoint.x,y:x.StartPoint.y}:{x:x.EndPoint.x,y:x.EndPoint.y},a=L.x-A.x,r=L.y-A.y,x.StartPoint.x+=a,x.StartPoint.y+=r,x.EndPoint.x+=a,x.EndPoint.y+=r;let F=x.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);h=F.length;let G=f.polylist.segs.length;if(h+G>me.Common.MaxPolySegs)return-1;if(e===me.HookPts.KTL){if(v=me.ActionTriggerType.LineStart,o===me.HookPts.KTL){a=f.StartPoint.x-F[h-1].x,r=f.StartPoint.y-F[h-1].y;for(let t=0;t<G;t++)f.polylist.segs[t].pt.x+=a,f.polylist.segs[t].pt.y+=r;f.StartPoint.x=F[h-1].x,f.StartPoint.y=F[h-1].y;for(let t=1;t<h;t++){switch(x.LineType){case me.LineType.POLYLINE:w.x=f.polylist.segs[0].pt.x,w.y=f.polylist.segs[0].pt.y,f.polylist.segs[0]=Oe.DeepCopy(x.polylist.segs[t]),f.polylist.segs[0].pt.x=w.x,f.polylist.segs[0].pt.y=w.y,f.polylist.segs[0].param=-f.polylist.segs[0].param;break;case me.LineType.ARCLINE:f.polylist.segs[0].LineType=x.LineType,f.polylist.segs[0].param=x.IsReversed?-x.CurveAdjust:x.CurveAdjust;break;case me.LineType.ARCSEGLINE:f.polylist.segs[0].LineType=x.LineType,f.polylist.segs[0].param=0,p=f.PrPolyLGetArcQuadrant(F[t],F[t-1],0),f.polylist.segs[0].param=p.param,f.polylist.segs[0].ShortRef=p.ShortRef;break;default:f.polylist.segs[0].LineType=me.LineType.LINE}f.polylist.segs.unshift(new Pi(me.LineType.LINE,F[t].x-f.StartPoint.x,F[t].y-f.StartPoint.y))}}else{a=f.StartPoint.x-F[0].x,r=f.StartPoint.y-F[0].y;for(let t=0;t<G;t++)f.polylist.segs[t].pt.x+=a,f.polylist.segs[t].pt.y+=r;switch(f.StartPoint.x=F[0].x,f.StartPoint.y=F[0].y,x.LineType){case me.LineType.POLYLINE:w.x=f.polylist.segs[0].pt.x,w.y=f.polylist.segs[0].pt.y,f.polylist.segs[0]=Oe.DeepCopy(x.polylist.segs[h-1]),f.polylist.segs[0].pt.x=w.x,f.polylist.segs[0].pt.y=w.y;break;case me.LineType.ARCLINE:f.polylist.segs[0].LineType=x.LineType,f.polylist.segs[0].param=x.IsReversed?x.CurveAdjust:-x.CurveAdjust;break;case me.LineType.ARCSEGLINE:f.polylist.segs[0].LineType=x.LineType,f.polylist.segs[0].param=0,p=f.PrPolyLGetArcQuadrant(F[h-2],F[h-1],0),f.polylist.segs[0].param=p.param,f.polylist.segs[0].ShortRef=p.ShortRef;break;default:f.polylist.segs[0].LineType=me.LineType.LINE}for(let t=h-2;t>=0;t--)if(f.polylist.segs.unshift(new Pi(me.LineType.LINE,F[t].x-f.StartPoint.x,F[t].y-f.StartPoint.y)),t>0)switch(x.LineType){case me.LineType.POLYLINE:w.x=f.polylist.segs[0].pt.x,w.y=f.polylist.segs[0].pt.y,f.polylist.segs[0]=Oe.DeepCopy(x.polylist.segs[t]),f.polylist.segs[0].pt.x=w.x,f.polylist.segs[0].pt.y=w.y;break;case me.LineType.ARCSEGLINE:f.polylist.segs[0].LineType=x.LineType,F[t].x,f.StartPoint.x,F[t].y,f.StartPoint.y,f.polylist.segs[0].param=0,p=f.PrPolyLGetArcQuadrant(F[t-1],F[t],0),f.polylist.segs[0].param=p.param,f.polylist.segs[0].ShortRef=p.ShortRef}}u=ve.InflatePoint(f.polylist.segs[0].pt,k),!f.polylist.closed&&ve.pointInRect(u,f.polylist.segs[f.polylist.segs.length-1].pt)&&(f.polylist.closed=!0,f.polylist.segs[f.polylist.segs.length-1].pt.x=f.polylist.segs[0].pt.x,f.polylist.segs[f.polylist.segs.length-1].pt.y=f.polylist.segs[0].pt.y,f.EndPoint.x=f.StartPoint.x,f.EndPoint.y=f.StartPoint.y,f instanceof we.Shape.PolyLine&&!0!==n&&f.MaintainDimensionThroughPolygonOpennessChange(f.polylist.closed),f.objecttype!==Se.FNObjectTypes.FlWall&&this.OpenShapeEdit(f.BlockID),ws.AddToDirtyList(f.BlockID))}else{if(o===me.HookPts.KTL){for(let t=1;t<h;t++){switch(x.LineType){case me.LineType.POLYLINE:l=x.polylist.segs[t].LineType;break;case me.LineType.ARCLINE:case me.LineType.ARCSEGLINE:l=x.LineType;break;default:l=me.LineType.LINE}switch(f.polylist.segs.push(new Pi(l,F[t].x-f.StartPoint.x,F[t].y-f.StartPoint.y)),x.LineType){case me.LineType.ARCLINE:f.polylist.segs[f.polylist.segs.length-1].param=x.IsReversed?x.CurveAdjust:-x.CurveAdjust;break;case me.LineType.POLYLINE:f.polylist.segs[f.polylist.segs.length-1]=Oe.DeepCopy(x.polylist.segs[t]),f.polylist.segs[f.polylist.segs.length-1].pt.x=F[t].x-f.StartPoint.x,f.polylist.segs[f.polylist.segs.length-1].pt.y=F[t].y-f.StartPoint.y;break;case me.LineType.ARCSEGLINE:F[t].x,f.StartPoint.x,F[t].y,f.StartPoint.y,d=f.polylist.segs.length,f.polylist.segs[d-1].param=0,p=f.PrPolyLGetArcQuadrant(F[t-1],F[t],0),f.polylist.segs[d-1].param=p.param,f.polylist.segs[d-1].ShortRef=p.ShortRef}}f.EndPoint.x=F[h-1].x,f.EndPoint.y=F[h-1].y}else{for(let t=h-2;t>=0;t--){switch(x.LineType){case me.LineType.POLYLINE:l=x.polylist.segs[t+1].LineType;break;case me.LineType.ARCLINE:case me.LineType.ARCSEGLINE:l=x.LineType;break;default:l=me.LineType.LINE}switch(f.polylist.segs.push(new Pi(l,F[t].x-f.StartPoint.x,F[t].y-f.StartPoint.y)),x.LineType){case me.LineType.ARCLINE:f.polylist.segs[f.polylist.segs.length-1].param=x.IsReversed?-x.CurveAdjust:x.CurveAdjust;break;case me.LineType.POLYLINE:f.polylist.segs[f.polylist.segs.length-1]=Oe.DeepCopy(x.polylist.segs[t+1]),f.polylist.segs[f.polylist.segs.length-1].pt.x=F[t].x-f.StartPoint.x,f.polylist.segs[f.polylist.segs.length-1].pt.y=F[t].y-f.StartPoint.y,f.polylist.segs[f.polylist.segs.length-1].param=-f.polylist.segs[f.polylist.segs.length-1].param;break;case me.LineType.ARCSEGLINE:d=f.polylist.segs.length,f.polylist.segs[d-1].param=0,p=f.PrPolyLGetArcQuadrant(F[t+1],F[t],0),f.polylist.segs[d-1].param=p.param,f.polylist.segs[d-1].ShortRef=p.ShortRef}}f.EndPoint.x=F[0].x,f.EndPoint.y=F[0].y}u=ve.InflatePoint(f.polylist.segs[f.polylist.segs.length-1].pt,k),ve.pointInRect(u,f.polylist.segs[0].pt)&&(f.polylist.closed=!0,f.polylist.segs[f.polylist.segs.length-1].pt.x=f.polylist.segs[0].pt.x,f.polylist.segs[f.polylist.segs.length-1].pt.y=f.polylist.segs[0].pt.y,f.EndPoint.x=f.StartPoint.x,f.EndPoint.y=f.StartPoint.y,f.objecttype!==Se.FNObjectTypes.FlWall&&this.OpenShapeEdit(f.BlockID),f instanceof we.Shape.PolyLine&&!0!==n&&f.MaintainDimensionThroughPolygonOpennessChange(f.polylist.closed),ws.AddToDirtyList(f.BlockID))}if(f.CalcFrame(),O)c=xs.AddNewObject(f,!1,!0),O=!0,ws.AddToDirtyList(c);else{let t=vs.VisibleZList().indexOf(c);t>=0&&Os.AddSVGObject(t,c,!0,!0)}f=ws.GetObjectPtr(c,!1),f&&(f.DataID<0&&(f.DataID=g,b.DataID===g?(f.TextDirection=b.TextDirection,b.DataID=-1):D.DataID===g&&(f.TextDirection=D.TextDirection,D.DataID=-1),f.TextFlags=ve.SetFlag(f.TextFlags,Se.TextFlags.HorizText,!f.TextDirection)),f&&f.NoteID<0&&(f.NoteID=y,b.NoteID===y?b.NoteID=-1:D.NoteID===y&&(D.NoteID=-1),f.TextFlags=ve.SetFlag(f.TextFlags,Se.TextFlags.HorizText,!f.TextDirection)),f&&f.commentId<0&&(f.commentId=S,b.commentId===S?b.commentId=-1:D.commentId===S&&(D.commentId=-1),f.TextFlags=ve.SetFlag(f.TextFlags,Se.TextFlags.HorizText,!f.TextDirection)),f&&!f.HyperlinkText&&(f.HyperlinkText=m));for(let R=0;R<C.length;R++)Yo.MoveLinks(c,C[R],null,null);if(ws.DeleteObjects(C,!1),Ps.SetLinkFlag(c,Ee.LinkFlags.Move),Yo.MaintainLink(c,f,null,v,!1),ye.opt.UpdateLinks(),P.push(c),Qo.SelectObjects(P,!1,!0),O&&I>=0){let t=E.indexOf(c);E.splice(t,1),E.splice(I,0,c),O=!0,ws.AddToDirtyList(c)}return f instanceof we.Shape.PolyLineContainer&&f.MoveBehindAllLinked()&&(O=!0),O&&(vs.IsTopMostVisibleLayer()?Os.RenderDirtySVGObjects():Os.RenderAllSVGObjects()),c}static PolyLinePrPolyLGetArcQuadrant(t,e,i){F.Debug("O.Opt PolyLinePrPolyLGetArcQuadrant - Input:",{startPoint:t,endPoint:e,arcAngle:i});const o={param:0,ShortRef:0};let n=[],s={x:0,y:0};if(n.push(new De(t.x,t.y)),n.push(new De(e.x,e.y)),s.x=t.x,s.y=t.y,Math.abs(i)>=.01){const t=Math.sin(i),e=Math.cos(i),o=Math.asin(t),a=e<0?-o:o;si.RotatePointsAboutPoint(s,a,n)}const a=n[0],r=n[1];return r.x>a.x?r.y>a.y?(o.param=-Se.Geometry.PI/2,o.ShortRef=me.ArcQuad.PLA_BL,e.notclockwise&&(o.param=0)):(o.ShortRef=me.ArcQuad.PLA_TL,e.notclockwise&&(o.ShortRef=me.ArcQuad.PLA_TR,o.param=Se.Geometry.PI/2)):r.y>a.y?(o.ShortRef=me.ArcQuad.PLA_BR,e.notclockwise&&(o.ShortRef=me.ArcQuad.PLA_BL,o.param=Se.Geometry.PI/2)):(o.param=-Se.Geometry.PI/2,o.ShortRef=me.ArcQuad.PLA_TR,e.notclockwise&&(o.param=0)),F.Debug("O.Opt PolyLinePrPolyLGetArcQuadrant - Output:",o),o}static PolyYCurve(t,e,i,o,n,s,a,r){F.Debug("O.Opt PolyYCurve - Input:",{pointCount:t.length,rect:e,segmentCount:i,minOffset:o,maxOffset:n,startOffset:s,endOffset:a,isRightSide:r});const l=e.height/2;let h=e.width;i<2&&(i=2);const c=(2*l-s-a)/(i-1);let p=!1,d=!1;for(let u=0;u<i;u++){let i=c*u+s;if(o&&i<o){if(p)continue;i=o,p=!0}let a=l-i;if(n&&a-n<-l){if(d)break;a=-(l-n),d=!0}const g=new De(0,0);g.y=e.y+(l-a);let y=0;l?y=a/l:h=0;const S=ve.Sqrt(1-y*y)*h;g.x=r?e.x+e.width-S:e.x+S,t.push(g)}return F.Debug("O.Opt PolyYCurve - Output: Generated points:",t.length),t}static PolyPtInPolygon(t,e){F.Debug("O.Opt PolyPtInPolygon - Input:",{polygonPointsCount:t.length,testPoint:e});const i=[{},{},{}];let o=0;i[0]=t[0];const n=t.length;for(let a=1;a<n-1;a++){let n=!0;i[1]=t[a],i[2]=t[a+1];for(let t=0;t<3;t++){const o=ye.opt.GetCounterClockwiseAngleBetween2Points(i[t],e),s=t-1>=0?t-1:2,a=t+1<3?t+1:0,r=ye.opt.GetCounterClockwiseAngleBetween2Points(i[t],i[s]),l=ye.opt.GetCounterClockwiseAngleBetween2Points(i[t],i[a]),h=r>l?r:l,c=Se.Geometry.PI-h,p=ye.opt.NormalizeAngle(r,c),d=ye.opt.NormalizeAngle(l,c);let u=p,g=d;p>d&&(u=d,g=p);const y=ye.opt.NormalizeAngle(o,c);if(y<u||y>g){n=!1;break}}n&&o++}const s=o%2!=0;return F.Debug("O.Opt PolyPtInPolygon - Output:",s),s}static PolyLIntersect(t,e,i,o){let n,s,a,r,l,h,c,p,d,u,g,y,S=null,m=-1,b=-1,D={x:0,y:0},f={x:0,y:0},x=0,C=Math.abs(e.x-t.x);if(Math.abs(e.y-t.y)<1&&C>=1){for(n=1;n<o;n++)if(i[n].y>i[n-1].y?(r=i[n-1].y,l=i[n].y):(r=i[n].y,l=i[n-1].y),e.y>=r&&e.y<l){m=n,f.y=e.y;break}if(m>=0)return x=m,i[m].x-i[m-1].x==0?(f.x=i[m].x,{bSuccess:!0,ipt:f,lpseg:x}):i[m].y-i[m-1].y==0?(i[m].x>i[m-1].x?(s=i[m-1].x,a=i[m].x):(s=i[m].x,a=i[m-1].x),f.x<s&&(f.x=s),f.x>a&&(f.x=a),{bSuccess:!0,ipt:f,lpseg:x}):(h=i[m].x-i[m-1].x,d=(i[m].y-i[m-1].y)/h,p=i[m].y-d*i[m].x,f.x=(f.y-p)/d,{bSuccess:!0,ipt:f,lpseg:x})}else if(C<1){for(n=1;n<o;n++)if(i[n].x>i[n-1].x?(s=i[n-1].x,a=i[n].x):(s=i[n].x,a=i[n-1].x),e.x>=s&&e.x<a){b=n,f.x=e.x;break}if(b>=0)return x=b,i[b].y-i[b-1].y==0?(f.y=i[b].y,{bSuccess:!0,ipt:f,lpseg:x}):i[b].x-i[b-1].x==0?(i[b].y>i[b-1].y?(r=i[b-1].y,l=i[b].y):(r=i[b].y,l=i[b-1].y),f.y<r&&(f.y=r),f.y>l&&(f.y=l),{bSuccess:!0,ipt:f,lpseg:x}):(h=i[b].x-i[b-1].x,d=(i[b].y-i[b-1].y)/h,p=i[b].y-d*i[b].x,f.y=d*f.x+p,{bSuccess:!0,ipt:f,lpseg:x})}else for(h=e.x-t.x,c=(e.y-t.y)/h,p=e.y-c*e.x,n=1;n<o;n++){if(i[n].x-i[n-1].x==0)D.x=i[n].x,D.y=c*D.x+p;else if(i[n].y-i[n-1].y==0)D.y=i[n].y,D.x=(D.y-p)/c;else{if(h=i[n].x-i[n-1].x,d=(i[n].y-i[n-1].y)/h,p=i[n].y-d*i[n].x,u=c-d,g=p-p,Math.abs(u)<.001)continue;y=g/u,D.x=y,D.y=c*y+p}if(S=ve.Pt2Rect(i[n],i[n-1]),S.y+S.height==S.y&&S.height++,S.x+S.width==S.x&&S.width++,ve.pointInRect(S,D))return{bSuccess:!0,ipt:D,lpseg:n}}return{bSuccess:!1,ipt:f,lpseg:x}}static EllipseToPoints(t,e,i,o,n,s,a){const r=Math.abs(o-i),l=Math.abs(s-n),h=l*l;let c,p;e<2&&(e=100);let d=1;s>n?o>i?a?(c=i,p=s):(c=o,p=n,d=-1):a?(c=o,p=n):(c=i,p=s,d=-1):o>i?a?(c=o,p=n,d=-1):(c=i,p=s):a?(c=i,p=s,d=-1):(c=o,p=n);const u=(s-n)/(e-1);for(let g=0;g<e;g++){const e=n+u*g,i=e-p,o=ve.Sqrt(1-i*i/h)*r,s=new De(c+o*d,e);t.push(s)}return t}static GetClockwiseAngleBetween2PointsInRadians(t,e){const i=Se.Geometry.PI,o=e.x-t.x,n=e.y-t.y;let s;return s=0===o?n>=0?i/2:-i/2:0===n?o>=0?0:i:Math.atan2(n,o),s<0&&(s+=2*i),s}}class on{static DeactivateTextEdit(t,e){let i;F.Debug("O.Opt DeactivateTextEdit - Input:",{preventCompleteOperation:t,shouldCloseTable:e});let o=ws.GetObjectPtr(ye.opt.teDataBlockId,!1),n=!1;if(null!=ye.opt.textEntryTimer&&(clearTimeout(ye.opt.textEntryTimer),ye.opt.textEntryTimer=null,this.RegisterLastTEOp(Se.TextElemLastOpt.Timeout)),-1!=o.theActiveTextEditObjectID){let e;o=ws.GetObjectPtr(ye.opt.teDataBlockId,!0);let s=!1,a=!1,r=ye.opt.svgDoc.GetActiveEdit(),l=null,h=o.theActiveTableObjectID<0,c=ws.GetObjectPtr(o.theActiveTextEditObjectID,!0);if(c&&(c.TableID<0&&(h=!0),c.DataID,o.theTEWasResized&&(Ps.SetLinkFlag(o.theActiveTextEditObjectID,Ee.LinkFlags.Move),c.hooks.length&&Ps.SetLinkFlag(c.hooks[0].objid,Ee.LinkFlags.Move),o.theTEWasResized=!1,o.theTEWasEdited=!0,o.theActiveTableObjectID<0&&ws.AddToDirtyList(o.theActiveTextEditObjectID)),c instanceof we.Shape.D3Symbol&&(h=!1)),r&&(l=r.GetRuntimeText())){e=r.GetSelectedRange(),s=r.HasDataFields()?0===r.GetTextMinDimensions().width:0===r.GetTextMinDimensions().width||" "===r.GetText();const t=r.formatter.GetFormatAtOffset(0);h&&this.TextStyleToText(c.StyleRecord.Text,t.style),a=!!(c.flags&Se.ObjFlags.TextOnly);{let t=ws.GetObjectPtr(i,!1);t&&(t.runtimeText=l,t.selrange=e,t=ws.GetObjectPtr(i,!0),o.theActiveTableObjectID<0&&ws.AddToDirtyList(o.theActiveTextEditObjectID))}}if(this.TEUnregisterEvents(),s)if(a){ws.DeleteObjects([o.theActiveTextEditObjectID],!1),c=null;const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!0),e=t.indexOf(o.theActiveTextEditObjectID);e>=0&&(t.splice(e,1),Qo.GetTargetSelect()===o.theActiveTextEditObjectID&&Qo.SetTargetSelect(-1,!0)),o.theTEWasEdited=!0}else{const t=ye.stdObj.GetObject(i);c=ws.GetObjectPtr(o.theActiveTextEditObjectID,!0),c&&c.SetTextObject(-1),t&&t.Delete(),o.theActiveTableObjectID<0&&ws.AddToDirtyList(o.theActiveTextEditObjectID),o.theTEWasEdited=!0}o.theTEWasEdited&&(n=!0),o.theActiveTextEditObjectID=-1,o.theTEWasEdited=!1,o.theTEWasResized=!1,o.theTELastOp=Se.TextElemLastOpt.Init,this.RegisterLastTEOp(Se.TextElemLastOpt.Init),n&&!t?xs.CompleteOperation():(ws.PreserveUndoState(!1),Os.RenderDirtySVGObjects())}F.Debug("O.Opt DeactivateTextEdit - Output: Text edit deactivated")}static RegisterLastTEOp(t){if(F.Debug("O.Opt RegisterLastTEOp - Input:",{lastOp:t}),!ye.opt.bInNoteEdit){const e=ws.GetObjectPtr(ye.opt.teDataBlockId,!1),i=e.theTELastOp;null!=ye.opt.textEntryTimer&&t!==Se.TextElemLastOpt.Char&&(clearTimeout(ye.opt.textEntryTimer),ye.opt.textEntryTimer=null,this.RegisterLastTEOp(Se.TextElemLastOpt.Timeout)),e.theTELastOp=t,t!==Se.TextElemLastOpt.Init&&(e.theTEWasEdited=!0);if((e=>{if(t!==Se.TextElemLastOpt.Init)switch(t){case Se.TextElemLastOpt.Char:if(e!==t)return!0;break;case Se.TextElemLastOpt.Select:return!1;default:return!0}return!1})(i)){const i=ye.opt.svgDoc.GetActiveEdit();let o=null,n=null;const s=ws.GetObjectPtr(e.theActiveTextEditObjectID,!1);if(s&&s.DataID>=0&&i){const a=s.DataID;if(o=i.GetRuntimeText(),n=i.GetSelectedRange(),o){ws.PreserveUndoState(!1);let s=ws.GetObjectPtr(a,!1);if(s&&(s.runtimeText=o,s.selrange=n,t!==Se.TextElemLastOpt.Timeout&&(Li.minWidth=i.formatter.limits.minWidth,Li.maxWidth=i.formatter.limits.maxWidth,Li.minHeight=i.minHeight,ws.GetObjectPtr(e.theActiveTextEditObjectID,!0),s=ws.GetObjectPtr(a,!0)),t===Se.TextElemLastOpt.Timeout)){const t={};t.BlockID=e.theActiveTextEditObjectID;const i=ws.GetObjectPtr(t.BlockID,!1);i&&i instanceof we.Shape.Connector&&(t.DataID=i.DataID),t.runtimeText=Oe.DeepCopy(o),t.selrange=Oe.DeepCopy(n),t.minWidth=Li.minWidth,t.maxWidth=Li.maxWidth,t.minHeight=Li.minHeight,Li.minWidth=null}}}}t===Se.TextElemLastOpt.Char&&(clearTimeout(ye.opt.textEntryTimer),ye.opt.textEntryTimer=null,ye.opt.textEntryTimer=setTimeout(ye.opt.TextEdit_PauseTyping,1e3))}F.Debug("O.Opt RegisterLastTEOp - Output: Completed")}static TextStyleToText(t,e){F.Debug("O.Opt TextStyleToText - Input:",{sdText:t,textStyle:e}),t.FontSize=Math.round(72*e.size/100),t.FontId=-1,t.FontName=e.font,t.Face=0,"bold"===e.weight&&(t.Face+=bi.TextFace.Bold),"italic"===e.style&&(t.Face+=bi.TextFace.Italic),"sub"===e.baseOffset?t.Face+=bi.TextFace.Subscript:"super"===e.baseOffset&&(t.Face+=bi.TextFace.Superscript),"underline"===e.decoration?t.Face+=bi.TextFace.Underline:"line-through"===e.decoration&&(t.Face+=bi.TextFace.Strike),t.Paint.Color=e.color,t.Paint.Opacity=e.colorTrans,F.Debug("O.Opt TextStyleToText - Output:",t)}static TEUnregisterEvents(t){F.Debug("O.Opt TEUnregisterEvents - Input:",t),ye.opt.svgDoc.ClearActiveEdit(t),null!=ye.opt.textEntryTimer&&(clearTimeout(ye.opt.textEntryTimer),ye.opt.textEntryTimer=null),ye.opt.textHammer&&(ye.opt.textHammer.off("dragstart"),ye.opt.textHammer.dispose(),ye.opt.textHammer=null),ye.opt.clickAreaHammer&&(ye.opt.clickAreaHammer.off("dragstart"),ye.opt.clickAreaHammer.dispose(),ye.opt.clickAreaHammer=null),ye.opt.decAreaHammer&&(ye.opt.decAreaHammer.off("dragstart"),ye.opt.decAreaHammer.dispose(),ye.opt.decAreaHammer=null),ye.opt.TEWorkAreaHammer&&(ye.opt.TEWorkAreaHammer.off("drag"),ye.opt.TEWorkAreaHammer.off("dragend"),ye.opt.TEWorkAreaHammer.dispose(),ye.opt.TEWorkAreaHammer=null),F.Debug("O.Opt TEUnregisterEvents - Output: done")}static CalcDefaultInitialTextStyle(t){F.Debug("O.Opt CalcDefaultInitialTextStyle - Input:",t);const e=new xi,i=bi.TextFace;return e.font=t.FontName,e.size=Vo.PointSizeToFontSize(t.FontSize),e.type=t.FontType,e.color=t.Paint.Color,e.colorTrans=t.Paint.Opacity,e.weight=t.Face&i.Bold?"bold":"normal",e.style=t.Face&i.Italic?"italic":"normal",e.decoration=t.Face&i.Underline?"underline":"none",F.Debug("O.Opt CalcDefaultInitialTextStyle - Output:",e),e}static TextResizeCommon(t,e,i,o,n){var s;F.Debug("O.Opt: TextResizeCommon inputs:",{shapeId:t,constrainWidth:e,allowResize:i,svgElementType:(null==(s=null==o?void 0:o.constructor)?void 0:s.name)||"unknown",skipLinkFlagUpdate:n});const a=ws.GetObjectPtr(ye.opt.teDataBlockId,!1),r=ws.GetObjectPtr(t,!1);if(r instanceof we.Shape.BaseShape){let e=o||ye.opt.svgObjectLayer.GetElementById(t);if(e){const o=e.textElem;if(null!=o){let s=r.GetTextParams(!0),l=s.trect,h=r.sizedim.width,c=r.sizedim.height,p=s.tsizedim.width,d=s.tsizedim.height,u=o.GetTextMinDimensions(),g=u.width;g<p&&(g=p);let y=u.height;y<d&&(y=d);let S=new wi(l.x,l.y,g,y);if(r.TextFlags&Se.TextFlags.AttachA||r.TextFlags&Se.TextFlags.AttachB){if(r.TextFlags&Se.TextFlags.AttachA){switch(r.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:o.SetPos(0,-u.height-r.TMargins.top);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:o.SetPos(r.Frame.width-u.width,-u.height-r.TMargins.top);break;default:o.SetPos(r.Frame.width/2-u.width/2,-u.height-r.TMargins.top)}ye.opt.SetShapeR(r)}else if(r.TextFlags&Se.TextFlags.AttachB){switch(r.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:o.SetPos(0,r.Frame.height);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:o.SetPos(r.Frame.width-u.width,r.Frame.height);break;default:o.SetPos(r.Frame.width/2-u.width/2,r.Frame.height)}ye.opt.SetShapeR(r)}}else{let p,u=Oe.DeepCopy(r.Frame),m=null;r.GetGraph(!1);const b=!0===r.bInGroup;if(b&&(i=!0),r.TextGrow===Se.TextGrowBehavior.Horizontal)if(!ve.IsEqual(g,l.width)||!ve.IsEqual(y,l.height)){m=Oe.DeepCopy(r.Frame),r.TRectToFrame(S,!1);let g=r.Frame.width-m.width;ve.IsEqual(g,0)&&(g=0);let y=r.Frame.height-m.height;if(ve.IsEqual(y,0)&&(y=0),g)switch(r.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:m.width+=g;break;case bi.TextAlign.TopCenter:case bi.TextAlign.Center:case bi.TextAlign.BottomCenter:p=m.x+m.width/2,m.width+=g,p-=m.width/2,b&&0===r.RotationAngle||(m.x=p);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:m.width+=g,b&&0===r.RotationAngle||(m.x-=g)}if(y&&(m.height+=y),i||this.TextPinFrame(m,d)){if(m.width<h&&(m.x=r.Frame.x+r.Frame.width/2-h/2,m.width=h),m.height<c&&(m.y=r.Frame.y+r.Frame.height/2-c/2,m.height=c),(g||y)&&(r.UpdateFrame(m),a.theTEWasResized=!0),o){s=r.GetTextParams(!1),l=s.trect;let t=r.GetSVGFrame(m);o.SetPos(l.x-t.x,l.y-t.y),o.SetConstraints(ye.opt.header.MaxWorkDim.x,l.width,l.height)}if(r.ResizeInTextEdit(e,m),this.TextResizeNeedPageResize(r,m.x+m.width,m.y+m.height),b&&0!==r.RotationAngle){let t={x:u.x+u.width/2,y:u.y+u.height/2},e=$o.RotateRect(u,t,r.RotationAngle);t={x:m.x+m.width/2,y:m.y+m.height/2};let i=$o.RotateRect(m,t,r.RotationAngle);g=e.x-i.x,y=e.y-i.y,r.OffsetShape(g,y)}n||Yo.ResizeSetLinkFlag(t,Ee.LinkFlags.Move)}}}}}}else r.AdjustTextEditBackground(t,o);F.Debug("O.Opt: TextResizeCommon completed for shape:",t)}static ResetActiveTextEditAfterUndo(t){F.Debug("O.Opt: ResetActiveTextEditAfterUndo called with text override:",t?"provided":"none");const e=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if(-1!==e.theActiveTextEditObjectID){const i=ws.GetObjectPtr(e.theActiveTextEditObjectID,!1);if(!i)return void F.Debug("O.Opt: ActiveTextObject not found, aborting");const o=i.DataID;if(-1!==o){const n=ws.GetObjectPtr(o,!1);if(n){let o=n.runtimeText;const s=n.selrange;t&&(o=t),t||(ws.AddToDirtyList(e.theActiveTextEditObjectID),Os.RenderDirtySVGObjects());const a=ye.opt.svgObjectLayer.GetElementById(e.theActiveTextEditObjectID);if(a&&a.textElem){this.TextRegisterEvents(a.textElem);const t=ye.opt.svgDoc.GetActiveEdit();t&&(t.SetRuntimeText(o),t.SetSelectedRange(s.start,s.end,s.line,s.anchor)),""===o.text&&(F.Debug("O.Opt: Initializing empty text formatting"),this.InitEmptyText(i,a))}}}e.TELastOp=Se.TextElemLastOpt.Init,Os.ShowSVGSelectionState(e.theActiveTextEditObjectID,!1)}F.Debug("O.Opt: ResetActiveTextEditAfterUndo complete")}static GuessTextIndents(t,e){let i,o,n,s,a,r,l,h,c,p,d,u,g,y,S;F.Debug("O.Opt GuessTextIndents - Input:",{polygonPoints:t,shapeFrame:e});let m,b=!1,D=!1,f=10,x=[{x:0,y:0},{x:0,y:0}],C=[{x:0,y:0},{x:0,y:0}],P={},T={},O={};i=e.width,i<1&&(i=1),o=e.height,o<1&&(o=1),n=i,s=o;let v=ve.SetRect(0,0,e.width,e.height);a=s/20;for(let w=0;w<f;w++){r=.8*w*n/f;let e=en.PolyGetIntersect(t,r,x,null,!0);if(2===e)for(let i=0;i<f-w;i++)l=(1-i/f*.8)*n,e=en.PolyGetIntersect(t,l,C,null,!0),2===e&&(h=C[0]>x[0]?C[0]:x[0],c=C[1]<x[1]?C[1]:x[1],h<c&&(u=h,e=en.PolyGetIntersect(t,u+1,C,null,!1),e>2&&(u=h+=a,e=en.PolyGetIntersect(t,u+1,C,null,!1)),u=c,2===e&&(e=en.PolyGetIntersect(t,u-1,C,null,!1),e>2&&(u=c-=a,e=en.PolyGetIntersect(t,u-1,C,null,!1))),2===e&&c>h&&(u=h+(c-h)/2,p=r,d=l,e=en.PolyGetIntersect(t,u-1,C,null,!1),2===e&&(C[0]>r&&(p=C[0]),C[1]<l&&(d=C[1])),g=(d-p)*(c-h),(!1===b||y<g)&&(b=!0,y=g,P=ve.SetRect(p,h,d,c)))))}b&&(S=y,ve.CopyRect(T,P),D=!0),a=n/20;for(let w=0;w<f;w++)if(r=.8*w*s/f,m=en.PolyGetIntersect(t,r,x,null,!1),2===m)for(let e=0;e<f-w;e++)l=(1-e/f*.8)*s,m=en.PolyGetIntersect(t,l,C,null,!1),2===m&&(h=C[0]>x[0]?C[0]:x[0],c=C[1]<x[1]?C[1]:x[1],h<c&&(u=h,m=en.PolyGetIntersect(t,u+1,C,null,!0),m>2&&(u=h+=a,m=en.PolyGetIntersect(t,u+1,C,null,!0)),u=c,2===m&&(m=en.PolyGetIntersect(t,u-1,C,null,!0),m>2&&(u=c-=a,m=en.PolyGetIntersect(t,u-1,C,null,!0))),2===m&&c>h&&(u=h+(c-h)/2,p=r,d=l,m=en.PolyGetIntersect(t,u-1,C,null,!0),2===m&&(C[0]>r&&(p=C[0]),C[1]<l&&(d=C[1])),g=(d-p)*(c-h),(!1===b||y<g)&&(b=!0,D=!0,y=g,P=ve.SetRect(h,p,c,d)))));for(D&&b&&S>y&&ve.CopyRect(P,T),b?(O.left_sindent=(P.x+0)/i,O.right_sindent=(v.x+v.width-(P.x+P.width)-0)/i,O.top_sindent=(P.y+0)/o,O.bottom_sindent=(v.y+v.height-(P.y+P.height)-0)/o):(O.left_sindent=.2,O.right_sindent=.2,O.top_sindent=.2,O.bottom_sindent=.2);O.left_sindent+O.right_sindent>.8;)O.left_sindent>.4&&(O.left_sindent-=.1),O.right_sindent>.4&&(O.right_sindent-=.1);for(;O.top_sindent+O.bottom_sindent>.8;)O.top_sindent>.4&&(O.top_sindent-=.1),O.bottom_sindent>.4&&(O.bottom_sindent-=.1);return F.Debug("O.Opt GuessTextIndents - Output:",O),O}static FontSizeToPoints(t){if(F.Debug("O.Opt FontSizeToPoints - Input:",t),!t)return F.Debug("O.Opt FontSizeToPoints - Output:",-1),-1;const{rulerConfig:e,svgDoc:i}=ye.docUtil,o=i.docInfo.docDpi,n=e.showpixels?72*t/o:Math.round(72*t/o);return F.Debug("O.Opt FontSizeToPoints - Output:",n),n}static TextRegisterEvents(t,e,i){F.Debug("O.Opt TextRegisterEvents - Input:",{textEditorWrapper:t,activationEvent:e,additionalOptions:i}),null!=t&&(ye.opt.SetVirtualKeyboardLifter(t),t.Activate(e,i),ye.opt.textHammer=new Hammer(t.editor.parent.textElem.node),ye.opt.clickAreaHammer=new Hammer(t.editor.parent.clickAreaElem.node),ye.opt.decAreaHammer=new Hammer(t.editor.parent.decorationAreaElem.node),ye.opt.TEWorkAreaHammer=new Hammer(document.getElementById("svg-area")),ye.opt.textHammer.on("dragstart",this.TEDragStartFactory(t.editor)),ye.opt.clickAreaHammer.on("dragstart",this.TEClickAreaDragStartFactory(t.editor)),ye.opt.decAreaHammer.on("dragstart",this.TEClickAreaDragStartFactory(t.editor)),ye.opt.TEWorkAreaHammer.on("drag",this.TEDragFactory(t.editor)),ye.opt.TEWorkAreaHammer.on("dragend",this.TEDragEndFactory(t.editor))),F.Debug("O.Opt TextRegisterEvents - Output: Registered events")}static TargetPasteText(){if(F.Debug("O.Opt TargetPasteText - Input: no parameters"),!ye.opt.textClipboard)return F.Debug("O.Opt TargetPasteText - Output: false (text clipboard does not exist)"),!1;if(null==ye.opt.textClipboard.text)return F.Debug("O.Opt TargetPasteText - Output: false (text clipboard text is null)"),!1;const t=Qo.GetTargetSelect();if(-1!==t){const e=ws.GetObjectPtr(t,!1);if(e&&e.AllowTextEdit()){const e=ye.opt.svgObjectLayer.GetElementById(t);this.ActivateTextEdit(e);const i=ye.opt.svgDoc.GetActiveEdit(),o=i.GetText().length;return i.SetSelectedRange(0,o),this.RegisterLastTEOp(Se.TextElemLastOpt.Paste),i.Paste(ye.opt.textClipboard,!0),this.RegisterLastTEOp(Se.TextElemLastOpt.Timeout),F.Debug("O.Opt TargetPasteText - Output: true (text pasted successfully)"),!0}}return F.Debug("O.Opt TargetPasteText - Output: false (invalid target or text editing not allowed)"),!1}static GetActiveTextEdit(){F.Debug("O.Opt GetActiveTextEdit - Input: No parameters");let t=null;const e=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);return-1!=e.theActiveTextEditObjectID&&(t=e.theActiveTextEditObjectID),F.Debug("O.Opt GetActiveTextEdit - Output:",t),t}static ActivateTextEdit(t,e,i,o){let n,s,a,r,l;F.Debug("O.Opt ActivateTextEdit - Input:",{drawingElementId:null==t?void 0:t.ID,hasEvent:!!e,preventSelectionChange:i,hasTextData:!!o});const h=t.ID;let c=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);const p=[];let d={};if(!(r=ws.GetObjectPtr(h,!1))||!(r instanceof we.Shape.BaseDrawObject)||r.flags&Se.ObjFlags.Lock)return void F.Debug("O.Opt ActivateTextEdit - Output: Object invalid or locked");if(d.BlockID=h,null==o){if(h==c.theActiveTextEditObjectID)return;-1!=c.theActiveTextEditObjectID&&ye.opt.CloseEdit();const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);-1===t.indexOf(h)||t.length>1?(p.push(h),Qo.SelectObjects(p,!1,!0),n=t[0]):n=h}else d=o.Data;let u=ws.GetObjectPtr(h,!0);const g=u.GetTextObject(e,!1,d);if(null!=g){if(null==o)c=ws.GetObjectPtr(ye.opt.teDataBlockId,!0);else{ws.GetObjectPtr(ye.opt.teDataBlockId,!1).EditorID=o.EditorID,c=ws.GetObjectPtr(ye.opt.teDataBlockId,!0)}const t=ye.opt.svgObjectLayer.GetElementById(h);if(-1==g){if(u=ws.GetObjectPtr(h,!0),a=new ki({}),s=ye.stdObj.CreateBlock(Ce.StoredObjectType.TextObject,a),null===s)return void F.Debug("O.Opt ActivateTextEdit - Output: Failed to create text block");if(!u.SetTextObject(s.ID))return;u.LMAddSVGTextObject(ye.opt.svgDoc,t),a=s.Data}else a=ws.GetObjectPtr(g,!0),null==t.textElem&&u.LMAddSVGTextObject(ye.opt.svgDoc,t);if(null==o&&(c.theActiveTextEditObjectID=h,c.theTEWasResized=!1,c.theTEWasEdited=!1),null==o&&(r.TextFlags&Se.TextFlags.AttachA||r.TextFlags&Se.TextFlags.AttachB||ye.opt.svgObjectLayer.MoveElementToFront(t)),null==o){e&&e.gesture?this.TextRegisterEvents(t.textElem,e.gesture.srcEvent,i):this.TextRegisterEvents(t.textElem,e);const o=ye.opt.svgDoc.GetActiveEdit();if(l=o.GetSelectedRange(),d.theSelectedRange=Oe.DeepCopy(l),null==e){const t=o.GetText().length;d.theSelectedRange.start=0,d.theSelectedRange.anchor=0,d.theSelectedRange.end=t}}else o&&o.EditorID===cl.EditorID&&(l=o.Data.theSelectedRange);if(""===t.textElem.GetText()){if(g<0){const e={},i=u.GetTextDefault(e);d.TextStyle=Oe.DeepCopy(i);const o=this.CalcDefaultInitialTextStyle(i);d.theDefaultStyle=Oe.DeepCopy(o);const n=e.vjust;d.vjust=n,ye.opt.svgDoc.GetActiveEdit(),d.theSelectedRange=l,t.textElem.SetText(" "),t.textElem.SetFormat(o),t.textElem.SetParagraphStyle(e),u instanceof we.Shape.BaseShape&&t.textElem.SetVerticalAlignment(n),t.textElem.SetText(""),a.runtimeText=t.textElem.GetRuntimeText()}u.TextFlags=ve.SetFlag(u.TextFlags,Se.TextFlags.Clickhere,!1)}l&&(a.selrange=l),null==o&&(t.SetCursor(ze.CursorType.Text),n&&Os.ShowSVGSelectionState(n,!1),this.RegisterLastTEOp(Se.TextElemLastOpt.Init)),ws.PreserveUndoState(!1)}F.Debug("O.Opt ActivateTextEdit - Output: Text editing activated for object",h)}static CheckTextHyperlinkHit(t,e){if(F.Debug("O.Opt CheckTextHyperlinkHit - Input:",{drawingObject:t.BlockID,eventPosition:e}),-1===t.DataID&&-1===t.TableID)return F.Debug("O.Opt CheckTextHyperlinkHit - Output: false (no text data)"),!1;if(t.flags&Se.ObjFlags.Lock)return F.Debug("O.Opt CheckTextHyperlinkHit - Output: false (object locked)"),!1;if(Ps.GetEditMode()!==Se.EditState.Default)return F.Debug("O.Opt CheckTextHyperlinkHit - Output: false (not in default edit mode)"),!1;const i=ye.opt.svgObjectLayer.GetElementById(t.tag),o=i?i.textElem:null;if(!o)return F.Debug("O.Opt CheckTextHyperlinkHit - Output: false (no text element)"),!1;return!!o.GetHyperlinkAtLocation(e)||(F.Debug("O.Opt CheckTextHyperlinkHit - Output: false (no hyperlink found)"),!1)}static NoteIsShowing(t,e){F.Debug("O.Opt NoteIsShowing - Input:",{noteShapeId:t,noteTableCell:e});return F.Debug("O.Opt NoteIsShowing - Output:",false),false}static CreateTextBlock(t,e,i,o){const n={},s=t.GetTextDefault(n);if(!s)return-1;const a=on.CalcDefaultInitialTextStyle(s),r=ye.opt.svgDoc.CreateShape(me.CSType.Text);if(r.SetText(e),r.SetFormat(a),r.SetParagraphStyle(n),t instanceof we.Shape.BaseShape){if(null===t.vjust){const e=Vo.TextAlignToJust(t.TextAlign);t.vjust=e.vjust}r.SetVerticalAlignment(t.vjust)}if(i){const t=r.CalcTextFit(32e3);i.height=t.height,i.width=t.width}const l=r.GetRuntimeText(),h=r.GetSelectedRange(),c=new ki({});return c.runtimeText=l,c.selrange=h,ye.stdObj.CreateBlock(Ce.StoredObjectType.TextObject,c).ID}static UpdateFieldDataTooltipPos(t,e){}static HandleDataTooltipClose(t){}static ClearFieldDataDatePicker(){}static HandleTextFormatAttributes(t,e){F.Debug("O.Opt HandleTextFormatAttributes - Input:",{textObject:t,objectIndex:e});const i=bi.TextFace,o={hasText:!1},n=t.GetTextFormat(!0,o);o.hasText&&(ye.opt.selectionState.selectionhastext=!0),0===e?(ye.opt.selectionState.fontid=n.FontId,ye.opt.selectionState.fontsize=n.FontSize,ye.opt.selectionState.bold=(n.Face&i.Bold)>0,ye.opt.selectionState.italic=(n.Face&i.Italic)>0,ye.opt.selectionState.underline=(n.Face&i.Underline)>0,ye.opt.selectionState.superscript=(n.Face&i.Superscript)>0,ye.opt.selectionState.subscript=(n.Face&i.Subscript)>0):(ye.opt.selectionState.fontid!==n.FontId&&(ye.opt.selectionState.fontid=-1),ye.opt.selectionState.fontsize!==n.FontSize&&(ye.opt.selectionState.fontsize=-1),ye.opt.selectionState.bold!==(n.Face&i.Bold)>0&&(ye.opt.selectionState.bold=!1),ye.opt.selectionState.italic!==(n.Face&i.Italic)>0&&(ye.opt.selectionState.italic=!1),ye.opt.selectionState.underline!==(n.Face&i.Underline)>0&&(ye.opt.selectionState.underline=!1),ye.opt.selectionState.superscript!==(n.Face&i.Superscript)>0&&(ye.opt.selectionState.superscript=!1),ye.opt.selectionState.subscript!==(n.Face&i.Subscript)>0&&(ye.opt.selectionState.subscript=!1)),F.Debug("O.Opt HandleTextFormatAttributes - Output: Text format attributes processed")}static TEDragStartFactory(t){return F.Debug("O.Opt TEDragStartFactory - Input:",{mouseDragHandler:t}),function(e){return F.Debug("O.Opt TEDragStartHandler - Input:",{pointerEvent:e}),e.preventDefault(),e.stopPropagation(),e.gesture.preventDefault(),e.gesture.stopPropagation(),t.HandleMouseDown(e),F.Debug("O.Opt TEDragStartHandler - Output: Mouse down handled"),!1}}static TEClickAreaDragStartFactory(t){return F.Debug("O.Opt TEClickAreaDragStartFactory - Input:",{clickAreaHandler:t}),function(e){return F.Debug("O.Opt TEClickAreaDragStartHandler - Input:",{pointerEvent:e}),e.preventDefault(),e.stopPropagation(),e.gesture.preventDefault(),e.gesture.stopPropagation(),t.HandleMouseDown(e),F.Debug("O.Opt TEClickAreaDragStartHandler - Output: Mouse down handled"),!1}}static TEDragFactory(t){return F.Debug("O.Opt TEDragFactory - Input:",{dragMoveHandler:t}),function(e){return F.Debug("O.Opt TEDragHandler - Input:",{pointerEvent:e}),e.preventDefault(),e.stopPropagation(),e.gesture.preventDefault(),e.gesture.stopPropagation(),t.HandleMouseMove(e),F.Debug("O.Opt TEDragHandler - Output: Mouse move handled"),!1}}static TEDragEndFactory(t){return F.Debug("O.Opt TEDragEndFactory - Input:",{dragEndHandler:t}),function(e){return F.Debug("O.Opt TEDragEndHandler - Input:",{pointerEvent:e}),e.preventDefault(),e.stopPropagation(),e.gesture.preventDefault(),e.gesture.stopPropagation(),t.HandleMouseUp(e),F.Debug("O.Opt TEDragEndHandler - Output: Mouse up handled and messages unblocked"),!1}}static DeleteTargetTextObject(t){if(null==t&&(t=Qo.GetTargetSelect()),t>=0){const e=ws.GetObjectPtr(t,!0),i=e.DataID;if(-1!=i){const t=ye.stdObj.GetObject(i);e.SetTextObject(-1),t&&t.Delete()}}}static TextAutoScroll(t){if(-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID){const e=ye.opt.svgObjectLayer.GetElementById(t);if(e&&e.textElem){const t=e.textElem.GetInputCursorPos();if(t){const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.x2,t.y2);ye.docUtil.ScrollToPosition(e.x,e.y)}}}}static TextPinFrame(t,e){const i=me.Common.EdgeSlop;if(t.x<i&&(t.x=i),t.y<i&&(t.y=i),ye.opt.header.flags&me.HeaderFlags.NoAuto){const o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);let n=t.x+t.width-o.dim.x+i;n>0&&t.x>=n&&(t.x-=n),n=t.y+t.height-o.dim.y+i,n>0&&(t.y-e>=n||F.Debug("O.Opt TextPinFrame - Error: Frame cannot be pinned within bounds"),t.y-=n)}return!0}static TextResizeNeedPageResize(t,e,i){if(!(ye.opt.header.flags&me.HeaderFlags.NoAuto)){let t,o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);e>o.dim.x&&(o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0),t={x:o.dim.x+ye.opt.header.Page.papersize.x-(ye.opt.header.Page.margins.left+ye.opt.header.Page.margins.right),y:o.dim.y},ye.opt.UpdateEdgeLayers([],o.dim,t),o.dim.x+=ye.opt.header.Page.papersize.x-(ye.opt.header.Page.margins.left+ye.opt.header.Page.margins.right),Ts.ResizeSVGDocument()),i>o.dim.y&&(o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0),t={x:o.dim.x,y:o.dim.y+ye.opt.header.Page.papersize.y-(ye.opt.header.Page.margins.top+ye.opt.header.Page.margins.bottom)},ye.opt.UpdateEdgeLayers([],o.dim,t),o.dim.y+=ye.opt.header.Page.papersize.y-(ye.opt.header.Page.margins.top+ye.opt.header.Page.margins.bottom),Ts.ResizeSVGDocument())}}static InitEmptyText(t,e){const i={},o=t.GetTextDefault(i),n=this.CalcDefaultInitialTextStyle(o),s=i.vjust;e.textElem.SetText(" "),e.textElem.SetFormat(n),e.textElem.SetParagraphStyle(i),t instanceof we.Shape.BaseShape&&e.textElem.SetVerticalAlignment(s),e.textElem.SetText("")}}class nn{constructor(){a(this,"ConnectIndex"),a(this,"ConnectPt"),a(this,"ConnectInside"),a(this,"ConnectHookFlag"),a(this,"HookIndex"),a(this,"InitialHook"),a(this,"PrevConnect"),a(this,"ConnectIndexHistory"),a(this,"SConnectIndex"),a(this,"SConnectInside"),a(this,"SConnectHookFlag"),a(this,"SConnectPt"),a(this,"HiliteConnect"),a(this,"HiliteInside"),a(this,"HiliteHookFlag"),a(this,"SHiliteConnect"),a(this,"SHiliteInside"),a(this,"SHiliteHookFlag"),a(this,"JoinIndex"),a(this,"JoinData"),a(this,"JoinSourceData"),a(this,"SJoinIndex"),a(this,"SJoinData"),a(this,"SJoinSourceData"),a(this,"HiliteJoin"),a(this,"SHiliteJoin"),a(this,"ArraysOnly"),a(this,"lpCircList"),a(this,"DropOnLine"),a(this,"AutoInsert"),a(this,"AutoPoints"),a(this,"AutoSeg"),a(this,"AutoSinglePoint"),a(this,"AutoHeal"),a(this,"AutoHealID"),a(this,"cpt"),a(this,"ContainerPt"),a(this,"AllowJoin"),a(this,"savedEditState"),this.ConnectIndex=-1,this.ConnectPt={x:0,y:0},this.ConnectInside=null,this.ConnectHookFlag=0,this.HookIndex=-1,this.InitialHook=-1,this.PrevConnect=-1,this.ConnectIndexHistory=[],this.SConnectIndex=-1,this.SConnectInside=null,this.SConnectHookFlag=0,this.SConnectPt={x:0,y:0},this.HiliteConnect=-1,this.HiliteInside=null,this.HiliteHookFlag=0,this.SHiliteConnect=-1,this.SHiliteInside=null,this.SHiliteHookFlag=0,this.JoinIndex=-1,this.JoinData=0,this.JoinSourceData=0,this.SJoinIndex=-1,this.SJoinData=0,this.SJoinSourceData=0,this.HiliteJoin=-1,this.SHiliteJoin=-1,this.ArraysOnly=!1,this.lpCircList=[],this.DropOnLine=!1,this.AutoInsert=!1,this.AutoPoints=[],this.AutoSeg=0,this.AutoSinglePoint=0,this.AutoHeal=!1,this.AutoHealID=-1,this.cpt=[],this.ContainerPt=[],this.AllowJoin=0,this.savedEditState=Se.EditState.Default}}class sn{constructor(t,e,i,o,n,s,r){a(this,"ID"),a(this,"snap"),a(this,"edge"),a(this,"distance"),a(this,"leftright"),a(this,"aboveleft"),a(this,"label"),a(this,"pt"),a(this,"otherhits",[]),this.ID=t,this.snap=e,this.edge=i,this.distance=o,this.leftright=n,this.aboveleft=s,this.label=r,this.pt=null,this.otherhits=[]}}class an{static DynamicSnapsGetSnapObjects(t,e,i,o,n,s){let a,r,l,h,c,p,d,u,g;const y=bi.TextJust,S=vs.ActiveVisibleZList();a=S.length;const m=function(t,e,o,n,s,a,r,l,h){const c=o-n,u=Math.abs(c);p=[];const g=i[t];if(g&&(p=g.otherhits),u<=5)if(null==g||a<g.distance)g&&p.push(g),d=new sn(e,c,s,a,r,l,s===y.Center),d.otherhits=p,i[t]=d;else{const t=new sn(e,c,s,a,r,l,s===y.Center);g.otherhits.push(t)}},b=function(t){let e,o=!1;for(e in i){const n=i[e];if(t&&n&&t.ID==n.ID&&!0===n.label){o=!0;break}}o||(t.label=!0)},D=function(t){let i,o;a=t.otherhits.length;let n,s=[];for(r=0;r<a;r++)i=t.otherhits[r],ve.IsEqual(i.snap,t.snap,.5)&&s.push(i);for(t.otherhits=s,a=t.otherhits.length,a>1&&t.otherhits.sort((function(t,e){return t.distance===e.distance?0:t.distance<e.distance?-1:1})),r=a-1;r>=0;r--)if(i=t.otherhits[r],ws.GetObjectPtr(i.ID,!1).GetSnapRect(),r>0?(o=t.otherhits[r-1],n=ws.GetObjectPtr(o.ID,!1).GetSnapRect()):(o=t,n=ws.GetObjectPtr(t.ID,!1).GetSnapRect()),t.leftright)if(t.aboveleft)switch(i.distance-=o.distance+n.height,t.edge){case y.Left:i.pt={x:e.x,y:n.y};break;case y.Right:i.pt={x:l,y:n.y};break;case y.Center:i.pt={x:u,y:n.y}}else switch(i.distance-=o.distance+n.height,t.edge){case y.Left:i.pt={x:e.x,y:n.y+n.height};break;case y.Right:i.pt={x:l,y:n.y+n.height};break;case y.Center:i.pt={x:u,y:n.y+n.height}}else if(t.aboveleft)switch(i.distance-=o.distance+n.width,t.edge){case y.Top:i.pt={x:n.x,y:n.y};break;case y.Bottom:i.pt={x:n.x,y:h};break;case y.Center:i.pt={x:n.x,y:g}}else switch(i.distance-=o.distance+n.width,t.edge){case y.Top:i.pt={x:n.x+n.width,y:n.y};break;case y.Bottom:i.pt={x:n.x+n.width,y:h};break;case y.Center:i.pt={x:n.x+n.width,y:g}}},f=function(t,i,o,n,s){let a,r,c,p,d,u,g,y=0,S=[],m=[];const b=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null);let D=en.PolyLIntersect(t,i,b,b.length);for(;D.bSuccess&&(S.push(D.ipt),y+=D.lpseg,!(y>b.length-1));){const e=b.slice(y);D=en.PolyLIntersect(t,i,e,e.length)}if(n){for(r=S.length,a=0;a<r;a++)S[a].y<=e.y?(c=e.y-S[a].y,(void 0===p||c<p)&&(p=c,u=a)):S[a].y>=h&&(c=S[a].y-h,(void 0===d||c<d)&&(d=c,g=a));(void 0!==p&&void 0!==d||!s)&&(void 0!==p&&m.push({pt:S[u],dist:p}),void 0!==d&&m.push({pt:S[g],dist:d}))}else{for(r=S.length,a=0;a<r;a++)S[a].x<=e.x?(c=e.x-S[a].x,(void 0===p||c<p)&&(p=c,u=a)):S[a].x>=l&&(c=S[a].x-l,(void 0===d||c<d)&&(d=c,g=a));(void 0!==p&&void 0!==d||!s)&&(void 0!==p&&m.push({pt:S[u],dist:p}),void 0!==d&&m.push({pt:S[g],dist:d}))}return m},x=function(t,o,n){let s,a;const r=e.x,l=e.y,h=e.x+e.width,c=e.y+e.height,p=e.x+e.width/2,d=e.y+e.height/2,u=bi.TextJust;if(n===Se.GuideDistanceTypes.Room){let e=Oe.DeepCopy(t.Frame);const n=t.StyleRecord.Line.BThick;if(ve.InflateRect(e,-n,-n),ve.IsRectangleFullyEnclosed(e,o)){const e=f(t,{x:r,y:d},0,!1,!0),o=f(t,{x:p,y:l},0,!0,!0);2===e.length&&(s=e[0].dist,(null==i.wall_left||i.wall_left.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!1,-1,!0),a.pt=e[0].pt,i.wall_left=a),s=e[1].dist,(null==i.wall_right||i.wall_right.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!1,-2,!0),a.pt=e[1].pt,i.wall_right=a)),2===o.length&&(s=o[0].dist,(null==i.wall_top||i.wall_top.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!0,-1,!0),a.pt=o[0].pt,i.wall_top=a),s=o[1].dist,(null==i.wall_bottom||i.wall_bottom.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!0,-2,!0),a.pt=o[1].pt,i.wall_bottom=a))}}if(n===Se.GuideDistanceTypes.PolyWall||n===Se.GuideDistanceTypes.Room){if(d>=l&&d<=c){const e=f(t,{x:r,y:d},0,!1,!1);2===e.length&&(null!=e[0].pt&&(s=e[0].dist,(null==i.wall_left||i.wall_left.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!1,-1,!0),a.pt=e[0].pt,i.wall_left=a)),null!=e[1].pt&&(s=e[1].dist,(null==i.wall_right||i.wall_right.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!1,-2,!0),a.pt=e[1].pt,i.wall_right=a)))}if(p>=r&&p<=h){const e=f(t,{x:p,y:l},0,!0,!1);2===e.length&&(null!=e[0].pt&&(s=e[0].dist,(null==i.wall_top||i.wall_top.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!0,-1,!0),a.pt=e[0].pt,i.wall_top=a)),null!=e[1].pt&&(s=e[1].dist,(null==i.wall_bottom||i.wall_bottom.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!0,-2,!0),a.pt=e[1].pt,i.wall_bottom=a)))}}else if(n===Se.GuideDistanceTypes.Vertical_Wall){let e=Oe.DeepCopy(t.Frame);const n=t.StyleRecord.Line.BThick;ve.InflateRect(e,-n,0),e.y<=d&&e.y+e.height>=d&&(o.x>e.x+e.width?(s=o.x-(e.x+e.width),(null==i.wall_left||i.wall_left.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!1,-1,!0),i.wall_left=a)):h<e.x&&(s=e.x-h,(null==i.wall_right||i.wall_right.distance>s)&&(a=new sn(t.BlockID,null,u.Center,s,!1,-2,!0),i.wall_right=a)))}else if(n===Se.GuideDistanceTypes.Horizontal_Wall){let e=Oe.DeepCopy(t.Frame);const n=t.StyleRecord.Line.BThick;ve.InflateRect(e,0,-n),e.x<=p&&e.x+e.width>=p&&(o.y>e.y+e.height?(s=o.y-(e.y+e.height),a=new sn(t.BlockID,null,u.Center,s,!0,-1,!0),i.wall_top=a):c<e.y&&(s=e.y-c,a=new sn(t.BlockID,null,u.Center,s,!0,-2,!0),i.wall_bottom=a))}};if(null!=ws.GetObjectPtr(t,!1)){let l;const h=e.x+e.width,p=e.y+e.height,d=e.x+e.width/2,u=e.y+e.height/2;let g,f=!1;o&&o.distanceonly&&(f=!0);for(let i=0;i<a;i++){const o=S[i];if(o!==t&&!s){const t=ws.GetObjectPtr(o,!1);if(t){const i=t.GetSnapRect(),n=i.x+i.width,s=i.x,a=i.y,r=i.y+i.height,g=i.x+i.width/2,S=i.y+i.height/2;l=t.GuideDistanceOnly(),l&&x(t,e,l),t&&t.IsSnapTarget()&&!f&&(s>=e.x-5&&s<=e.x+5&&(r<e.y?(c=e.y-r,m("above_left",o,s,e.x,y.Left,c,!0,!0)):a>p&&(c=a-p,m("below_left",o,s,e.x,y.Left,c,!0,!1))),n>=e.x-5&&n<=e.x+5&&(r<e.y?(c=e.y-r,m("above_left",o,n,e.x,y.Left,c,!0,!0)):a>p&&(c=a-p,m("below_left",o,n,e.x,y.Left,c,!0,!1))),n>=h-5&&n<=h+5&&(r<e.y?(c=e.y-r,m("above_right",o,n,h,y.Right,c,!0,!0)):a>p&&(c=a-p,m("below_right",o,n,h,y.Right,c,!0,!1))),s>=h-5&&s<=h+5&&(r<e.y?(c=e.y-r,m("above_right",o,s,h,y.Right,c,!0,!0)):a>p&&(c=a-p,m("below_right",o,s,h,y.Right,c,!0,!1))),a>=e.y-5&&a<=e.y+5&&(n<e.x?(c=e.x-n,m("left_top",o,a,e.y,y.Top,c,!1,!0)):s>h&&(c=s-h,m("right_top",o,a,e.y,y.Top,c,!1,!1))),r>=e.y-5&&r<=e.y+5&&(n<e.x?(c=e.x-n,m("left_top",o,r,e.y,y.Top,c,!1,!0)):s>h&&(c=s-h,m("right_top",o,r,e.y,y.Top,c,!1,!1))),r>=p-5&&r<=p+5&&(n<e.x?(c=e.x-n,m("left_bottom",o,r,p,y.Bottom,c,!1,!0)):s>h&&(c=s-h,m("right_bottom",o,r,p,y.Bottom,c,!1,!1))),a>=p-5&&a<=p+5&&(n<e.x?(c=e.x-n,m("left_bottom",o,a,p,y.Bottom,c,!1,!0)):s>h&&(c=s-h,m("right_bottom",o,a,p,y.Bottom,c,!1,!1))),g>=d-5&&g<=d+5&&(r<e.y?(c=e.y-r,m("above_center",o,g,d,y.Center,c,!0,!0)):a>p&&(c=a-p,m("below_center",o,g,d,y.Center,c,!0,!1))),S>=u-5&&S<=u+5&&(n<e.x?(c=e.x-n,m("left_center",o,S,u,y.Center,c,!1,!0)):s>h&&(c=s-h,m("right_center",o,S,u,y.Center,c,!1,!1))))}}}const C={x:null,y:null},P={x:0,y:0};if(n){let t,e;const o=n.length;for(e=0;e<o;e++){g=n[e];const t=i[g];t&&(t.leftright?(C.x=t.snap,P.x=t.snap):(C.y=t.snap,P.y=t.snap))}for(g in i){const o=i[g];if(null!=o&&n.indexOf(g)<0)if(o.leftright){if("above_center"===g||"below_center"===g)if(n.indexOf("above_right")>=0||n.indexOf("below_right")>=0)for(o.snap-=P.x/2,t=o.otherhits.length,e=0;e<t;e++)o.otherhits[e].snap-=P.x/2;else if(n.indexOf("above_left")>=0||n.indexOf("below_left")>=0)for(o.snap+=-P.x/2,t=o.otherhits.length,e=0;e<t;e++)o.otherhits[e].snap+=-P.x/2;ve.IsEqual(o.snap,0,.5)||(i[g]=null)}else{if("left_center"===g||"right_center"===g)if(n.indexOf("left_bottom")>=0||n.indexOf("right_bottom")>=0)for(o.snap-=P.y/2,t=o.otherhits.length,e=0;e<t;e++)o.otherhits[e].snap-=P.y/2;else if(n.indexOf("left_top")>=0||n.indexOf("right_top")>=0)for(o.snap+=-P.y/2,t=o.otherhits.length,e=0;e<t;e++)o.otherhits[e].snap+=-P.y/2;ve.IsEqual(o.snap,0,.5)||(i[g]=null)}}for(g in i){const t=i[g];null!=t&&(b(t),D(t))}}else{const t={x:null,y:null};if(ye.docUtil.docConfig.centerSnap){const e=["above_center","below_center","left_center","right_center"];for(a=e.length,r=0;r<a;r++){g=e[r];const o=i[g];null!=o&&null!=o.snap&&(o.leftright?(null==t.x||Math.abs(o.snap)<Math.abs(t.x))&&(t.x=o.snap,C.x=o.snap):(null==t.y||Math.abs(o.snap)<Math.abs(t.x))&&(t.y=o.snap,C.y=o.snap))}}for(g in i){const e=i[g];switch(null!=e&&null!=e.snap&&(e.leftright&&null==t.x?(null==C.x||Math.abs(e.snap)<Math.abs(C.x))&&(C.x=e.snap):null==t.y&&(null==C.y||Math.abs(e.snap)<Math.abs(C.y))&&(C.y=e.snap)),g){case"wall_left":i.left_center&&(i[g]=null);break;case"wall_right":i.right_center&&(i[g]=null);break;case"wall_top":i.above_center&&(i[g]=null);break;case"wall_bottom":i.below_center&&(i[g]=null)}}for(g in i){const t=i[g];null!=t&&null!=t.snap&&(t.leftright?null==C.x||ve.IsEqual(t.snap,C.x,.5)||(i[g]=null):null==C.y||ve.IsEqual(t.snap,C.y,.5)||(i[g]=null))}for(g in i){const t=i[g];null!=t&&(b(t),D(t))}}return C}}static DynamicSnapsUpdateGuides(t,e,i){if(null!=ws.GetObjectPtr(e,!1)){let e,o,n,s,a;const r=ye.opt.dynamicGuides,l=bi.TextJust;o=i.y+i.height,n=i.x+i.width,s=i.x+i.width/2,a=i.y+i.height/2;const h={x:0,y:0},c=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),p="#2C75F9",d=Oe.DeepCopy(ye.opt.header.DimensionFontStyle);d.color=p;const u=ye.opt.svgDoc.docInfo.docToScreenScale;d.size/=u;const g=function(t){const e=t+"label",i=t+"back",o=ye.opt.svgHighlightLayer.GetElementById(t),n=ye.opt.svgHighlightLayer.GetElementById(e),s=ye.opt.svgHighlightLayer.GetElementById(i);o&&ye.opt.svgHighlightLayer.RemoveElement(o),n&&ye.opt.svgHighlightLayer.RemoveElement(n),s&&ye.opt.svgHighlightLayer.RemoveElement(s)},y=function(e,r){const u=ws.GetObjectPtr(e.ID,!1);if(null!=u){let g,y,S;const m=u.GetSnapRect(),b=m.y+m.height,D=m.x+m.width,f=1/ye.opt.svgDoc.GetWorkArea().docScale,x=3*f+","+6*f,C=12*f+","+6*f;let P,T=ye.opt.svgHighlightLayer.GetElementById(r),O=!1,v=null;if(e.leftright?e.edge===l.Left?(e.label&&(v=Ve.GetLengthInRulerUnits(e.distance,!1,0,0),h.x=i.x),e.aboveleft?null!=e.pt?(g={x:i.x,y:e.pt.y},y={x:i.x,y:m.y},h.y=e.pt.y-e.distance/2):(g={x:i.x,y:o},y={x:i.x,y:m.y},h.y=i.y-e.distance/2):null!=e.pt?(g={x:i.x,y:e.pt.y},y={x:i.x,y:b},h.y=e.pt.y+e.distance/2):(S=t.above_left?o:i.y,g={x:i.x,y:S},y={x:i.x,y:b},h.y=o+e.distance/2)):e.edge===l.Right?(e.label&&(v=Ve.GetLengthInRulerUnits(e.distance,!1,0,0),h.x=n),e.aboveleft?null!=e.pt?(g={x:n,y:e.pt.y},y={x:n,y:m.y},h.y=e.pt.y-e.distance/2):(g={x:n,y:o},y={x:n,y:m.y},h.y=i.y-e.distance/2):null!=e.pt?(g={x:n,y:e.pt.y},y={x:n,y:b},h.y=e.pt.y+e.distance/2):(S=t.above_left?o:i.y,g={x:n,y:S},y={x:n,y:b},h.y=o+e.distance/2)):e.edge===l.Center&&(O=!0,h.x=s,-1===e.aboveleft?(null!=e.pt?(g={x:s,y:i.y},y={x:s,y:e.pt.y}):(g={x:s,y:i.y},y={x:s,y:m.y}),h.y=i.y-e.distance/2):-2===e.aboveleft?(null!=e.pt?(g={x:s,y:o},y={x:s,y:e.pt.y}):(g={x:s,y:o},y={x:s,y:b}),h.y=o+e.distance/2):e.aboveleft?null!=e.pt?(g={x:s,y:e.pt.y},y={x:s,y:b},h.y=e.pt.y-e.distance/2):(g={x:s,y:i.y},y={x:s,y:b},h.y=i.y-e.distance/2):null!=e.pt?(g={x:s,y:e.pt.y},y={x:s,y:m.y},h.y=e.pt.y+e.distance/2):(g={x:s,y:o},y={x:s,y:m.y},h.y=o+e.distance/2),v=Ve.GetLengthInRulerUnits(e.distance,!1,0,0)):e.edge===l.Top?(e.label&&(v=Ve.GetLengthInRulerUnits(e.distance,!1,0,0),h.y=i.y),e.aboveleft?null!=e.pt?(g={x:e.pt.x,y:i.y},y={x:m.x,y:i.y},h.x=e.pt.x-e.distance/2):(g={x:n,y:i.y},y={x:m.x,y:i.y},h.x=i.x-e.distance/2):null!=e.pt?(g={x:e.pt.x,y:i.y},y={x:D,y:i.y},h.x=e.pt.x+e.distance/2):(S=t.left_top?n:i.x,g={x:S,y:i.y},y={x:D,y:i.y},h.x=n+e.distance/2)):e.edge===l.Bottom?(e.label&&(v=Ve.GetLengthInRulerUnits(e.distance,!1,0,0),h.y=o),e.aboveleft?null!=e.pt?(g={x:e.pt.x,y:o},y={x:m.x,y:o},h.x=e.pt.x-e.distance/2):(g={x:n,y:o},y={x:m.x,y:o},h.x=i.x-e.distance/2):null!=e.pt?(g={x:e.pt.x,y:o},y={x:D,y:o},h.x=e.pt.x+e.distance/2):(S=t.left_bottom?n:i.x,g={x:S,y:o},y={x:D,y:o},h.x=n+e.distance/2)):e.edge===l.Center&&(O=!0,h.y=a,-1===e.aboveleft?(null!=e.pt?(g={x:i.x,y:a},y={x:e.pt.x,y:a}):(g={x:i.x,y:a},y={x:m.x,y:a}),h.x=i.x-e.distance/2):-2===e.aboveleft?(null!=e.pt?(g={x:n,y:a},y={x:e.pt.x,y:a}):(g={x:n,y:a},y={x:D,y:a}),h.x=n+e.distance/2):e.aboveleft?null!=e.pt?(g={x:e.pt.x,y:a},y={x:D,y:a},h.x=e.pt.x-e.distance/2):(g={x:i.x,y:a},y={x:D,y:a},h.x=i.x-e.distance/2):null!=e.pt?(g={x:e.pt.x,y:a},y={x:m.x,y:a},h.x=e.pt.x+e.distance/2):(g={x:n,y:a},y={x:m.x,y:a},h.x=n+e.distance/2),v=Ve.GetLengthInRulerUnits(e.distance,!1,0,0)),g){null==T&&(T=ye.opt.svgDoc.CreateShape(me.CSType.Line),T.SetFillColor("none"),T.SetStrokeColor(p),T.SetStrokeWidth(f),T.SetStrokePattern(O?C:x),T.SetID(r),ye.opt.svgHighlightLayer.AddElement(T)),T.SetPoints(g.x,g.y,y.x,y.y);const t=r+"label",e=r+"back";if(v){P=ye.opt.svgHighlightLayer.GetElementById(t);let i=ye.opt.svgHighlightLayer.GetElementById(e);if(null==P){i=ye.opt.svgDoc.CreateShape(me.CSType.Rect),i.SetID(e),i.SetStrokeWidth(0);const o=c.background.Paint.Color;i.SetFillColor(o),ye.opt.svgHighlightLayer.AddElement(i),P=ye.opt.svgDoc.CreateShape(me.CSType.Text),ye.opt.svgHighlightLayer.AddElement(P),P.SetID(t),P.SetRenderingEnabled(!1),P.SetText(v),P.SetFormat(d)}else P.SetRenderingEnabled(!1),P.SetText(v);P.SetRenderingEnabled(!0);const o=P.GetTextMinDimensions();i.SetPos(h.x-o.width/2-2,h.y-o.height/2-2),i.SetSize(o.width+4,o.height+4),P.SetPos(h.x-o.width/2,h.y-o.height/2)}else{P=ye.opt.svgHighlightLayer.GetElementById(t);const i=ye.opt.svgHighlightLayer.GetElementById(e);P&&ye.opt.svgHighlightLayer.RemoveElement(P),i&&ye.opt.svgHighlightLayer.RemoveElement(i)}}}};for(e in t){let i,o,n;const s=[];if(null!=t[e]){for(y(t[e],e),o=t[e].otherhits.length,i=0;i<o;i++)n=t[e].otherhits[i],n.label=t[e].label,s.push(n.ID),y(t[e].otherhits[i],e+n.ID.toString());if(r&&null!=r[e])for(o=r[e].otherhits.length,i=0;i<o;i++)n=r[e].otherhits[i],s.indexOf(n.ID)<0&&g(e+n.ID.toString())}else if(r&&null!=r[e]&&(g(e),r[e].otherhits))for(o=r[e].otherhits.length,i=0;i<o;i++)n=r[e].otherhits[i],g(e+n.ID.toString())}ye.opt.dynamicGuides=t}}static DynamicSnapsRemoveGuides(t){let e,i,o,n;if(t)for(e in t)if(t[e]){const s=e+"label",a=e+"back",r=ye.opt.svgHighlightLayer.GetElementById(e),l=ye.opt.svgHighlightLayer.GetElementById(s),h=ye.opt.svgHighlightLayer.GetElementById(a);if(r&&ye.opt.svgHighlightLayer.RemoveElement(r),l&&ye.opt.svgHighlightLayer.RemoveElement(l),h&&ye.opt.svgHighlightLayer.RemoveElement(h),t[e].otherhits)for(i=t[e].otherhits.length,o=0;o<i;o++){n=t[e].otherhits[o];const i=e+n.ID.toString()+"label",s=e+n.ID.toString()+"back",a=ye.opt.svgHighlightLayer.GetElementById(e+n.ID.toString()),r=ye.opt.svgHighlightLayer.GetElementById(i),l=ye.opt.svgHighlightLayer.GetElementById(s);a&&ye.opt.svgHighlightLayer.RemoveElement(a),r&&ye.opt.svgHighlightLayer.RemoveElement(r),l&&ye.opt.svgHighlightLayer.RemoveElement(l)}}t=null}}class rn{static LMStampPostRelease(t){let e;F.Debug("= U.LMEvtUtil LMStampPostRelease - Input:",{completeOperation:t}),ye.opt.linkParams&&ye.opt.linkParams.HiliteConnect>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteConnect,ye.opt.linkParams.ConnectPt,!1,!1,ye.opt.dragTargetId,ye.opt.linkParams.HiliteInside),ye.opt.linkParams.HiliteConnect=-1,ye.opt.linkParams.HiliteInside=null),ye.opt.linkParams&&ye.opt.linkParams.HiliteJoin>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteJoin,ye.opt.linkParams.ConnectPt,!1,!0,ye.opt.dragTargetId,null),ye.opt.linkParams.HiliteJoin=-1),Ps.SetEditMode(Se.EditState.Default),t&&(ye.opt.linkParams&&ye.opt.linkParams.JoinIndex>=0?en.PolyLJoin(ye.opt.linkParams.JoinIndex,ye.opt.linkParams.JoinData,ye.opt.dragTargetId,ye.opt.linkParams.JoinSourceData,!1):ye.opt.linkParams&&(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.InitialHook>=0)&&(ye.opt.linkParams.ConnectHookFlag===Se.HookFlags.LcAutoInsert?this.SD_AutoInsertShape(ye.opt.actionStoredObjectId,ye.opt.linkParams.ConnectIndex):ye.opt.linkParams.ConnectHookFlag===Se.HookFlags.LcHookReverse?this.LM_ReverseHook(ye.opt.actionStoredObjectId):(e=Yo.UpdateHook(ye.opt.actionStoredObjectId,ye.opt.linkParams.InitialHook,ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.HookIndex,ye.opt.linkParams.ConnectPt,ye.opt.linkParams.ConnectInside),!1==(0!==e&&void 0!==e)&&Ps.SetLinkFlag(ye.opt.linkParams.ConnectIndex,Ee.LinkFlags.Move)))),ye.opt.linkParams=null,F.Debug("= U.LMEvtUtil LMStampPostRelease - Output: Operation completed")}static LMStampPreTrack(){F.Debug("= U.LMEvtUtil LMStampPreTrack - Input: No parameters"),ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),ye.opt.linkParams=new nn,ye.opt.linkParams.AutoInsert=xs.AllowAutoInsert(),ye.opt.drawShape&&ye.opt.drawShape.flags&&ye.opt.drawShape.flags&Se.ObjFlags.DropOnBorder&&(ye.opt.linkParams.DropOnLine=!0),F.Debug("= U.LMEvtUtil LMStampPreTrack - Output: Link parameters initialized",{autoInsert:ye.opt.linkParams.AutoInsert,dropOnLine:ye.opt.linkParams.DropOnLine||!1})}static LMStampDuringTrack(t,e){let i;if(F.Debug("= U.LMEvtUtil LMStampDuringTrack - Input:",{position:t,drawingObject:null==e?void 0:e.BlockID}),ye.opt.actionStoredObjectId<0)return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: No action object ID",t),t;if(ye.opt.moveList&&ye.opt.moveList.length)return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: Using move list, returning original position",t),t;if(null==e)return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: No drawing object",t),t;if(i=Yo.MoveGetHookPoints(ye.opt.actionStoredObjectId,e,0,0),!i)return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: No hook points",t),t;ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0;const o=ye.opt.linkParams;if((o.DropOnLine||o.AutoInsert)&&Qo.FindConnect(ye.opt.actionStoredObjectId,e,o.cpt,!0,!0,!1,t)){const e={x:t.x+ye.opt.dragDeltaX,y:t.y+ye.opt.dragDeltaY};return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: Drop-on-line adjusted position",e),e}if(ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0,ye.opt.dragStartX=t.x,ye.opt.dragStartY=t.y,Qo.FindConnect(ye.opt.actionStoredObjectId,e,i,!0,!1,o.AllowJoin,t)||o.JoinIndex>=0){const e={x:t.x+ye.opt.dragDeltaX,y:t.y+ye.opt.dragDeltaY};return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: Connection/join adjusted position",e),e}return F.Debug("= U.LMEvtUtil LMStampDuringTrack - Output: No adjustments needed",t),t}static LMMoveDuringTrack(t){let e,i,o,n,s,a;F.Debug("= U.LMEvtUtil LMMoveDuringTrack - Input:",t);let r={},l=[];if(ye.opt.dragTargetId<0)return F.Debug("= U.LMEvtUtil LMMoveDuringTrack - Output: Invalid drag target"),t;if(i=ws.GetObjectPtr(ye.opt.dragTargetId,!1),null==i)return F.Debug("= U.LMEvtUtil LMMoveDuringTrack - Output: Target object not found"),t;if(ye.opt.linkParams&&ye.opt.linkParams.AutoHeal&&(s=Math.abs(t.x-ye.opt.dragStartX),a=Math.abs(t.y-ye.opt.dragStartY),s>50||a>50||ye.opt.linkParams.AutoInsert&&ye.opt.linkParams.ConnectIndex>=0)){n=this.HealLine(i,!1,l),ye.opt.linkParams.AutoHeal=!1,ye.opt.linkParams.AutoHealID=i.BlockID,n>=0&&(l.push(n),ws.DeleteObjects(l,!1));let t=ye.opt.dirtyList.indexOf(ye.opt.dragTargetId);t>=0&&(ye.opt.dirtyList.splice(t,1),Os.RenderDirtySVGObjects(),ws.AddToDirtyList(ye.opt.dragTargetId)),Qo.GetMoveList(ye.opt.dragTargetId,!0,!0,!1,ye.opt.moveBounds,!1)}if(ye.opt.pinRect&&this.PinMoveRect(t),o=Yo.MoveGetHookPoints(ye.opt.dragTargetId,i,t.x-ye.opt.dragStartX,t.y-ye.opt.dragStartY),o){if(ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0,ye.opt.linkParams.DropOnLine||ye.opt.linkParams.AutoInsert){r=Oe.DeepCopy(i.Frame),r.x+=t.x-ye.opt.dragStartX,r.y+=t.y-ye.opt.dragStartY;const o=i.Frame;if(i.Frame=r,e=Qo.FindConnect(ye.opt.dragTargetId,i,ye.opt.linkParams.cpt,!0,!0,!1,t),i.Frame=o,e)return t.x+=ye.opt.dragDeltaX,t.y+=ye.opt.dragDeltaY,F.Debug("= U.LMEvtUtil LMMoveDuringTrack - Output (drop connection):",t),t}ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0,e=Qo.FindConnect(ye.opt.dragTargetId,i,o,!0,!1,ye.opt.linkParams.AllowJoin,t),(e||ye.opt.linkParams.JoinIndex>=0)&&(t.x+=ye.opt.dragDeltaX,t.y+=ye.opt.dragDeltaY)}return F.Debug("= U.LMEvtUtil LMMoveDuringTrack - Output:",t),t}static LMMoveTrack(t,e){if(F.Debug("= U.LMEvtUtil LMMoveTrack - Input:",{event:t,skipScrolling:e}),Date.now()-ye.opt.eventTimestamp<250)return void F.Debug("= U.LMEvtUtil LMMoveTrack - Output: Throttled (skipping)");if(!ye.opt.dragGotMove){let e=ye.opt.moveList;if(e&&e.length){if(xs.DragDuplicate(t)){const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!0),i=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0);t.length=0;for(let r=0;r<e.length;r++)t.push(e[r]);const o=ws.GetObjectPtr(ye.opt.dragTargetId,!1);let n=-1,s=null;o&&(s=o.Frame,n=o.DrawingObjectBaseClass);const a=$o.DuplicateObjects(!0);t.length=0;for(let e=0;e<a.length;e++)t.push(a[e]);ye.opt.MoveDuplicated=!0,ye.opt.moveList.length=0,ye.opt.dragElementList.length=0,ye.opt.dragBBoxList.length=0,ye.opt.linkParams.lpCircList=[],ye.opt.linkParams.InitialHook=-1;for(let e=a.length-1;e>=0;e--){const t=ws.GetObjectPtr(a[e],!1);if(t){ye.opt.moveList.push(a[e]),ye.opt.linkParams.lpCircList.push(a[e]),ye.opt.dragElementList.push(a[e]);const o=t.GetSVGFrame();s&&ve.EqualRect(o,s,2)&&t.DrawingObjectBaseClass===n&&(ye.opt.dragTargetId=a[e],i.tselect=a[e]),ye.opt.dragBBoxList.push(o)}}e=ye.opt.moveList}const i=e.length;for(let t=0;t<i;t++){const i=e[t],o=ws.GetObjectPtr(i,!1);if(o){const t=ye.opt.svgObjectLayer.GetElementById(i);o.RemoveDimensionLines(t)}}}}ye.opt.dragGotMove=!0;const i=ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0;if(e)xs.ResetAutoScrollTimer();else if(!xs.AutoScrollCommon(t,!i,"HandleObjectDragDoAutoScroll"))return void F.Debug("= U.LMEvtUtil LMMoveTrack - Output: Auto-scroll in progress");const o=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),n=this.LMMoveDuringTrack(o,t);ye.opt.HandleObjectDragMoveCommon(n.x,n.y,e,t),F.Debug("= U.LMEvtUtil LMMoveTrack - Output: Objects moved to",n)}static LMMoveRelease(t,e){F.Debug("= U.LMEvtUtil LMMoveRelease - Input:",{event:t,moveData:e});let i=!1;if(!e&&(ve.StopPropagationAndDefaults(t),ye.opt.UnbindShapeMoveHammerEvents(),xs.ResetAutoScrollTimer(),Ps.SetEditMode(Se.EditState.Default),an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null,!ye.opt.dragGotMove||xs.CheckDragIsOverCustomLibrary(t)))return this.LMMovePostRelease(!1),Os.RenderAllSVGSelectionStates(),ye.opt.moveList=null,void F.Debug("= U.LMEvtUtil LMMoveRelease - Output: Early exit condition met");const o=ye.opt.moveList?ye.opt.moveList.length:0;if(0===o)return void F.Debug("= U.LMEvtUtil LMMoveRelease - Output: No objects to move");let n=null,s={};ye.opt.dragDeltaX,ye.opt.MoveDuplicated;for(let a=0;a<o;a++){const t=ye.opt.moveList[a],i=ye.stdObj.GetObject(t).Data;if(e)s=e.Data.thePointList[a];else{if(n=ye.opt.dragBBoxList[a],!n)continue;s={x:n.x+ye.opt.dragDeltaX,y:n.y+ye.opt.dragDeltaY}}if(i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&null===i.polylist&&i.StyleRecord.Line.BThick&&(s.x+=i.StyleRecord.Line.BThick,s.y+=i.StyleRecord.Line.BThick),e){const e="note_"+t,o=ye.opt.svgHighlightLayer.GetElementById(e);if(o){const t=o.GetPos(),e=s.x-i.Frame.x,n=s.y-i.Frame.y;t.x+=e,t.y+=n,o.SetPos(t.x,t.y)}}ye.opt.SetShapeOriginNoDirty(t,s.x,s.y),ye.opt.linkParams.ConnectHookFlag===Se.HookFlags.LcAutoInsert&&i.UpdateFrame(i.Frame),(i.Dimensions&Se.DimensionFlags.Always||i.Dimensions&Se.DimensionFlags.Select||e||i.Dimensions&Se.DimensionFlags.Area)&&ws.AddToDirtyList(t)}if(this.LMMovePostRelease(!0,e),!e&&ye.opt.lastOpDuplicate){i=!0;const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0);t.dupdisp.x+=ye.opt.dragDeltaX,t.dupdisp.y+=ye.opt.dragDeltaY}xs.CompleteOperation(),e||(i&&(ye.opt.lastOpDuplicate=!0),ye.opt.moveList=null),F.Debug("= U.LMEvtUtil LMMoveRelease - Output: Move operation completed")}static LMMovePostRelease(t,e){var i,o;F.Debug("= U.LMEvtUtil LMMovePostRelease - Input:",{completeOperation:t,moveData:e});let n=!1;const s=[];if(ye.opt.linkParams&&ye.opt.linkParams.HiliteConnect>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteConnect,ye.opt.linkParams.ConnectPt,!1,!1,ye.opt.dragTargetId,ye.opt.linkParams.ConnectPt,ye.opt.linkParams.HiliteInside),ye.opt.linkParams.HiliteConnect=-1,ye.opt.linkParams.HiliteInside=null),ye.opt.linkParams&&ye.opt.linkParams.HiliteJoin>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteJoin,ye.opt.linkParams.ConnectPt,!1,!0,ye.opt.dragTargetId,null),ye.opt.linkParams.HiliteJoin=-1),e||Ps.SetEditMode(Se.EditState.Default),t){let t=ws.GetObjectPtr(ye.opt.dragTargetId);if(t.objecttype===Se.FNObjectTypes.NgEvent||t.objecttype===Se.FNObjectTypes.NgEventLabel){let t=ye.opt.dragDeltaX,s=ye.opt.moveList;null!=(null==(i=null==e?void 0:e.Data)?void 0:i.dragDeltaX)&&(t=e.Data.dragDeltaX),null!=(null==(o=null==e?void 0:e.Data)?void 0:o.moveList)&&(s=e.Data.moveList),n=this.TimelineMoveEvent(ye.opt.dragTargetId,s,t,!0)}else if(ye.opt.linkParams.JoinIndex>=0)en.PolyLJoin(ye.opt.linkParams.JoinIndex,ye.opt.linkParams.JoinData,ye.opt.dragTargetId,ye.opt.linkParams.JoinSourceData,!1);else if(ye.opt.linkParams&&(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.InitialHook>=0))n||(ye.opt.linkParams.ConnectHookFlag===Se.HookFlags.LcAutoInsert?this.SD_AutoInsertShape(ye.opt.dragTargetId,ye.opt.linkParams.ConnectIndex):ye.opt.linkParams.ConnectHookFlag===Se.HookFlags.LcHookReverse?this.LM_ReverseHook(ye.opt.dragTargetId):(n=Yo.HandleMultipleSelectionHooks(),n||(Yo.UpdateHook(ye.opt.dragTargetId,ye.opt.linkParams.InitialHook,ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.HookIndex,ye.opt.linkParams.ConnectPt,ye.opt.linkParams.ConnectInside),Ps.SetLinkFlag(ye.opt.linkParams.ConnectIndex,Ee.LinkFlags.Move),Yo.CleanupHooks(ye.opt.dragTargetId,ye.opt.linkParams.ConnectIndex))));else{const t=Zo.GetGvSviOpt(ye.opt.dragTargetId)||ye.wallOpt;t instanceof ls&&t.EnsureCubicleBehindOutline(ye.opt.dragTargetId)}e||null==ye.opt.postMoveSelectId||(s.push(ye.opt.postMoveSelectId),Qo.SelectObjects(s,!1,!1),ye.opt.postMoveSelectId=null)}t&&ye.opt.UpdateLinks(),e||(ye.opt.linkParams=null,ye.opt.ob={},ye.opt.dragEnclosingRect=null,ye.opt.dragElementList=[],ye.opt.dragBBoxList=[]),F.Debug("= U.LMEvtUtil LMMovePostRelease - Output: Move post-processing completed")}static LMSetupMove(t){let e,i,o;F.Debug("= U.LMEvtUtil LMSetupMove - Input:",t);let n=null,s=null,a=!1;if(ye.opt.MoveDuplicated=!1,e=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget),!e)return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (No SVG element found)"),!1;i=e.GetTargetForEvent(t),ye.opt.eventTimestamp=Date.now(),ve.StopPropagationAndDefaults(t);const r=e.GetID(),l=ws.GetObjectPtr(r,!1);if(!(l&&l instanceof we.Shape.BaseDrawObject))return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Not a valid drawing object)"),!1;if(ye.opt.bInDimensionEdit)return ye.opt.CloseEdit(!1,!0),ye.opt.bInDimensionEdit=!1,F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Was in dimension edit)"),!1;if(i instanceof Text&&(i.ID===me.SVGElementClass.DimText||i.ID===me.SVGElementClass.DimTextNoEdit))return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Is dimension text)"),!1;if(i instanceof Image&&this.UserDataisIcon(i.GetUserData()))return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Is icon element)"),!1;if(ye.opt.crtOpt===me.OptTypes.FormatPainter){if(o=e.GetID(),this.FormatPainterClick(o,t))return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Format painter handled click)"),!1;e=ye.opt.svgObjectLayer.GetElementById(o)}const h=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);if(ye.opt.crtOpt!==me.OptTypes.FormatPainter||ye.opt.formatPainterMode!==Ne.FormatPainterModes.Object){const i=e.GetTargetForEvent(t);let o=i.GetID();i.GetUserData(),ye.opt.dragTargetId=e.GetID(),ye.opt.dragTargetId=this.GetEventShapeParent(ye.opt.dragTargetId),ye.opt.dragTargetId=Zo.SelectContainerParent(ye.opt.dragTargetId),n=ye.stdObj.GetObject(ye.opt.dragTargetId);const r=Ie.IsRightClick(t);if(n)if(s=n.Data,a=(s.TextFlags&Se.TextFlags.OneClick)>0,r)a=!1;else if(s.flags&Se.ObjFlags.Lock)return Qo.SelectObjectFromClick(t,e),F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Object is locked)"),!1;switch(o){case me.SVGElementClass.BackgroundImage:o="";break;case me.SVGElementClass.Slop:ye.opt.DeactivateAllTextEdit(!1),a=!1}switch(o){case me.SVGElementClass.BackgroundImage:break;case me.Common.HitAreas:const e=i.GetUserData();return this.LM_HitAreaClick(ye.opt.dragTargetId,e),t.gesture&&t.gesture.stopDetect(),F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Hit area click)"),!1}if(a)return on.ActivateTextEdit(e.svgObj.SDGObj,t,!1),F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Activated text edit)"),!1}if(!Qo.SelectObjectFromClick(t,e,!0))return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Selection failed)"),!1;if(n=ye.stdObj.GetObject(ye.opt.dragTargetId),null==n)return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Target object is null)"),!1;if(s=n.Data,Os.HideAllSVGSelectionStates(),xs.InitializeAutoGrowDrag(),s.InterceptMoveOperation(t))return F.Debug("= U.LMEvtUtil LMSetupMove - Output: false (Move intercepted by object)"),!1;const c={},p={};ye.opt.IsConnectorEndShape(s,null,c)?ye.opt.dragTargetId=c.id:ye.opt.IsGenogramPartner(s,p)&&(ye.opt.dragTargetId=p.id),ye.opt.moveBounds={x:0,y:0,width:0,height:0},ye.opt.pinRect=null,ye.opt.dynamicGuides=new We;let d=[];d=Qo.GetMoveList(ye.opt.dragTargetId,!0,!0,!1,ye.opt.moveBounds,!1),ye.opt.dragStartX=h.x,ye.opt.dragStartY=h.y;let u=d?d.length:0;ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.dragGotMove=!1;let g=[];for(let y=0;y<u;++y){const t=d[y],e=ws.GetObjectPtr(t,!1);!e||e instanceof we.Shape.Connector||e.flags&Se.ObjFlags.NotVisible||g.push(t)}for(let y=0;y<u;++y){const t=d[y],e=ws.GetObjectPtr(t,!1);if(e instanceof we.Shape.Connector)if(e.arraylist.styleflags&me.AStyles.FlowConn)g.push(t);else if(e.hooks.length){const i=e.hooks[0].objid;ws.GetObjectPtr(i)instanceof we.Shape.Connector?e.flags&Se.ObjFlags.NotVisible||g.push(t):e.flags&Se.ObjFlags.NotVisible&&(!e.hooks||-1===g.indexOf(i))||g.push(t)}else e.flags&Se.ObjFlags.NotVisible||g.push(t)}d=g,u=d.length,ye.opt.moveList=d;for(let y=0;y<u;++y){const t=d[y],e=ws.GetObjectPtr(t,!1).GetSVGFrame();ye.opt.dragBBoxList.push(e),ye.opt.dragElementList.push(t),ye.docUtil.docConfig.enableSnap&&t===ye.opt.dragTargetId&&(ye.opt.dragTargetBBox=Oe.DeepCopy(e))}return ye.opt.header.flags&me.HeaderFlags.NoAuto&&(ye.opt.dragEnclosingRect=ye.opt.GetListSRect(ye.opt.moveList)),this.LMMovePreTrack(d,t),F.Debug("= U.LMEvtUtil LMSetupMove - Output: true (Move setup complete)"),!0}static LMMoveExceptionCleanup(t){throw F.Debug("= U.LMEvtUtil LMMoveExceptionCleanup - Input:",t),ye.opt.linkParams=null,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.moveList=null,ye.opt.dragEnclosingRect=null,ye.opt.dragGotMove=!1,ye.opt.UnbindShapeMoveHammerEvents(),xs.ResetAutoScrollTimer(),F.Debug("= U.LMEvtUtil LMMoveExceptionCleanup - Output: Cleanup completed"),t}static LMMoveClick(t){if(F.Debug("= U.LMEvtUtil LMMoveClick - Input:",t),this.IsWheelClick(t)||Ae.DocContext.SpacebarDown)return Ls.Evt_WorkAreaHammerDragStart(t),ve.StopPropagationAndDefaults(t),void F.Debug("= U.LMEvtUtil LMMoveClick - Output: Wheel click or spacebar down detected, redirected to WorkAreaHammerDragStart");ve.StopPropagationAndDefaults(t);try{Ae.DocContext.HTMLFocusControl&&Ae.DocContext.HTMLFocusControl.blur&&Ae.DocContext.HTMLFocusControl.blur(),ye.opt.nudgeOpen&&ye.opt.CloseOpenNudge();const e=this.LMSetupMove(t);if(!0!==e)return-1===e?void F.Debug("= U.LMEvtUtil LMMoveClick - Output: Setup failed with -1, unlocked messages"):void F.Debug("= U.LMEvtUtil LMMoveClick - Output: Setup failed, unlocked and unblocked messages");ye.opt.crtOpt===me.OptTypes.None&&Ps.SetEditMode(Se.EditState.DragShape),ye.opt.WorkAreaHammer.on("drag",Ls.Evt_ShapeDrag),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_ShapeDragEnd);Ie.IsRightClick(t)||Ts.ShowContextMenu(!1,"WorkArea","Default"),F.Debug("= U.LMEvtUtil LMMoveClick - Output: Move operation set up successfully")}catch(e){throw this.LMMoveExceptionCleanup(e),ye.opt.ExceptionCleanup(e),F.Debug("= U.LMEvtUtil LMMoveClick - Error:",e),e}}static IsCtrlClick(t){F.Debug("= U.LMEvtUtil IsCtrlClick - Input:",t);let e=!1;return t.gesture&&(t=t.gesture.srcEvent),(t instanceof MouseEvent||"onpointerdown"in window&&t instanceof PointerEvent)&&(e=t.ctrlKey),F.Debug("= U.LMEvtUtil IsCtrlClick - Output:",e),e}static IsWheelClick(t){F.Debug("= U.LMEvtUtil IsWheelClick - Input:",t);let e=!1;return t.gesture&&(t=t.gesture.srcEvent),(t instanceof MouseEvent||"onpointerdown"in window&&t instanceof PointerEvent)&&(e=2===t.which),F.Debug("= U.LMEvtUtil IsWheelClick - Output:",e),e}static HandleKeyDown(t,e,i){F.Debug("= U.LMEvtUtil HandleKeyDown - Input:",{eventType:t.type,keyCode:e,altKey:i});let o=ye.opt.svgDoc.GetActiveEdit();if(o&&o.IsActive()){if(!ye.opt.bInNoteEdit){const t=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if(-1!==t.theActiveTextEditObjectID)switch(e){case Xe.Keys.Left_Arrow:case Xe.Keys.Right_Arrow:case Xe.Keys.Up_Arrow:case Xe.Keys.Down_Arrow:t.theTELastOp!==Se.TextElemLastOpt.Init&&on.RegisterLastTEOp(Se.TextElemLastOpt.Select);break;case Xe.Keys.Backspace:case Xe.Keys.Delete:on.RegisterLastTEOp(Se.TextElemLastOpt.Char)}}if(o.HandleKeyDownEvent(t))return F.Debug("= U.LMEvtUtil HandleKeyDown - Output: true (activeEdit handled event)"),!0}else if(32===e){const e=Qo.GetTargetSelect();if(-1!==e){const i=ws.GetObjectPtr(e,!1);if(i&&i.AllowTextEdit()){const i=ye.opt.svgObjectLayer.GetElementById(e);on.ActivateTextEdit(i),o=ye.opt.svgDoc.GetActiveEdit();const n=o.GetText().length;return o.SetSelectedRange(n,n),on.RegisterLastTEOp(Se.TextElemLastOpt.Char),o.HandleKeyDownEvent(t),F.Debug("= U.LMEvtUtil HandleKeyDown - Output: true (space activated text edit)"),!0}}}return F.Debug("= U.LMEvtUtil HandleKeyDown - Output: false"),!1}static HandleKeyPress(t,e){F.Debug("= U.LMEvtUtil HandleKeyPress - Input:",{eventType:t.type,keyCode:e});let i=ye.opt.svgDoc.GetActiveEdit();if(i&&i.IsActive()){if(!ye.opt.bInNoteEdit){-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID&&on.RegisterLastTEOp(Se.TextElemLastOpt.Char)}if(i.HandleKeyPressEvent(t))return t.preventDefault(),F.Debug("= U.LMEvtUtil HandleKeyPress - Output: true (activeEdit handled event)"),!0}else{const e=Qo.GetTargetSelect();if(-1!==e){const o=ws.GetObjectPtr(e,!1);if(o&&o.AllowTextEdit()){const o=ye.opt.svgObjectLayer.GetElementById(e);if(on.ActivateTextEdit(o),i=ye.opt.svgDoc.GetActiveEdit(),i){const e=i.GetText().length;return i.SetSelectedRange(0,e),on.RegisterLastTEOp(Se.TextElemLastOpt.Char),i.HandleKeyPressEvent(t),F.Debug("= U.LMEvtUtil HandleKeyPress - Output: true (activated text edit)"),!0}}}}return F.Debug("= U.LMEvtUtil HandleKeyPress - Output: false"),!1}static LMMovePreTrack(t,e){F.Debug("= U.LMEvtUtil LMMovePreTrack - Input:",{objectsToMove:t,event:e}),ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const i=e.gesture&&e.gesture.srcEvent&&e.gesture.srcEvent.altKey;if(ye.opt.linkParams=new nn,ye.opt.linkParams.AutoInsert=xs.AllowAutoInsert(),ye.opt.linkParams.AutoInsert){ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1).length>1&&(ye.opt.linkParams.AutoInsert=!1),e.gesture&&e.gesture.srcEvent&&e.gesture.srcEvent.altKey}const o=ws.GetObjectPtr(ye.opt.dragTargetId,!1);if(o){ye.opt.ob=Oe.DeepCopy(o),1===o.hooks.length&&0==(o.GetHookFlags()&Se.HookFlags.LcMoveTarget)&&t.indexOf(o.hooks[0].objid)<0&&(ye.opt.linkParams.ConnectIndex=o.hooks[0].objid,ye.opt.linkParams.PrevConnect=o.hooks[0].objid,ye.opt.linkParams.ConnectIndexHistory.push(o.hooks[0].objid),ye.opt.linkParams.ConnectPt.x=o.hooks[0].connect.x,ye.opt.linkParams.ConnectPt.y=o.hooks[0].connect.y,ye.opt.linkParams.ConnectInside=o.hooks[0].cellid,ye.opt.linkParams.HookIndex=o.hooks[0].hookpt,ye.opt.linkParams.InitialHook=0);const e=ws.GetObjectPtr(ye.opt.linksBlockId,!1);if(ye.opt.linkParams.lpCircList=Yo.GetHookList(e,ye.opt.linkParams.lpCircList,ye.opt.dragTargetId,o,Se.ListCodes.CircTarg,{}),Yo.JoinHookList(ye.opt.linkParams.lpCircList,t),ye.opt.linkParams.AutoInsert&&o instanceof we.Shape.BaseShape&&this.HealLine(o,!0,null)>0&&i&&(ye.opt.linkParams.lpCircList=[],ye.opt.linkParams.lpCircList.push(ye.opt.dragTargetId),ye.opt.moveList=[],ye.opt.moveList.push(ye.opt.dragTargetId),ye.opt.linkParams.AutoHeal=!0),xs.AllowSnapToShapes()){const t=o.GetSnapRect(),e=Oe.DeepCopy(t);e.x+=ye.opt.dragDeltaX,e.y+=ye.opt.dragDeltaY;const i={},n=o.CanSnapToShapes(i);if(n>=0){const t=ws.GetObjectPtr(n,!1).GetSnapRect(),e=Oe.DeepCopy(t),o=new We,s=[ye.opt.dragTargetId];an.DynamicSnapsGetSnapObjects(n,e,o,s,null,i),o&&an.DynamicSnapsUpdateGuides(o,n,e)}}}F.Debug("= U.LMEvtUtil LMMovePreTrack - Output: Link parameters initialized")}static UnbindActionClickHammerEvents(){F.Debug("= U.LMEvtUtil UnbindActionClickHammerEvents - Input:");const t=ye.opt.WorkAreaHammer;t&&(t.off("drag"),t.off("dragend"),t.off("doubletap")),F.Debug("= U.LMEvtUtil UnbindActionClickHammerEvents - Output: Events unbound")}static GetEventShapeParent(t){F.Debug("= U.LMEvtUtil GetEventShapeParent - Input:",t);const e=ws.GetObjectPtr(t);if(e&&e.objecttype===Se.FNObjectTypes.NgEventLabel){const t=ws.GetObjectPtr(e.associd);if(t&&t.objecttype===Se.FNObjectTypes.NgEvent)return F.Debug("= U.LMEvtUtil GetEventShapeParent - Output:",e.associd),e.associd}return F.Debug("= U.LMEvtUtil GetEventShapeParent - Output:",t),t}}class ln{constructor(t,e){a(this,"ImageDir"),a(this,"Bytes"),this.ImageDir=t,this.Bytes=e}}var hn=Object.defineProperty,cn=Object.getOwnPropertyDescriptor,pn=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?cn(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&hn(e,i,s),s};class dn{constructor(t){a(this,"Type"),a(this,"Frame"),a(this,"r"),a(this,"inside"),a(this,"trect"),a(this,"rtop"),a(this,"rleft"),a(this,"rbottom"),a(this,"rright"),a(this,"rwd"),a(this,"rht"),a(this,"rflags"),a(this,"RotationAngle"),a(this,"ShortRef"),a(this,"StyleRecord"),a(this,"Dimensions"),a(this,"bOverrideDefaultStyleOnDraw"),a(this,"UniqueID"),a(this,"flags"),a(this,"extraflags"),a(this,"hookflags"),a(this,"targflags"),a(this,"hooks"),a(this,"maxhooks"),a(this,"associd"),a(this,"attachpoint"),a(this,"hookdisp"),a(this,"TextFlags"),a(this,"DrawingObjectBaseClass"),a(this,"objecttype"),a(this,"subtype"),a(this,"dataclass"),a(this,"Layer"),a(this,"SequenceNumber"),a(this,"BusinessObjectID"),a(this,"NoteID"),a(this,"ExpandedViewID"),a(this,"DataID"),a(this,"tindent"),a(this,"TMargins"),a(this,"left_sindent"),a(this,"right_sindent"),a(this,"top_sindent"),a(this,"bottom_sindent"),a(this,"TableID"),a(this,"GraphID"),a(this,"ImageID"),a(this,"ContentType"),a(this,"ContentID"),a(this,"commentId"),a(this,"TextParams"),a(this,"TextGrow"),a(this,"TextAlign"),a(this,"colorfilter"),a(this,"colorchanges"),a(this,"moreflags"),a(this,"sizedim"),a(this,"ConnectPoints"),a(this,"ObjGrow"),a(this,"datasetType"),a(this,"datasetID"),a(this,"datasetTableID"),a(this,"datasetElemID"),a(this,"fieldDataDatasetID"),a(this,"fieldDataTableID"),a(this,"fieldDataElemID"),a(this,"dataStyleOverride"),a(this,"SymbolURL"),a(this,"ImageURL"),a(this,"ImageDir"),a(this,"BlobBytesID"),a(this,"EMFHash"),a(this,"EMFBlobBytesID"),a(this,"OleBlobBytesID"),a(this,"NativeID"),a(this,"SymbolData"),a(this,"nativeDataArrayBuffer"),a(this,"EMFBuffer"),a(this,"EMFBufferType"),a(this,"SymbolID"),a(this,"SVGFragment"),a(this,"ShapesInGroup"),a(this,"InitialGroupBounds"),a(this,"ImageHeader"),a(this,"OleHeader"),a(this,"nIcons"),a(this,"iconSize"),a(this,"iconShapeBottomOffset"),a(this,"iconShapeRightOffset"),a(this,"HyperlinkText"),a(this,"AttachmentInfo"),a(this,"ResizeAspectConstrain"),a(this,"ob"),a(this,"prevBBox"),a(this,"bInGroup"),a(this,"LineTextX"),a(this,"LineTextY"),a(this,"actionArrowHideTimerID"),a(this,"FramezList"),a(this,"ParentFrameID"),a(this,"StartPoint"),a(this,"EndPoint"),a(this,"LineType"),a(this,"BlockID"),a(this,"polylist"),a(this,"dimensionDeflectionH"),a(this,"dimensionDeflectionV"),a(this,"uniType"),a(this,"drawSetting"),a(this,"uniqueId"),t=t||{},this.Type=Ce.StoredObjectType.BaseDrawObject,this.Frame=t.Frame||{x:0,y:0,width:0,height:0},this.r=t.r||{x:0,y:0,width:0,height:0},this.inside=t.inside||{x:0,y:0,width:0,height:0},this.trect=t.trect||{x:0,y:0,width:0,height:0},this.rtop=t.rtop||0,this.rleft=t.rleft||0,this.rbottom=t.rbottom||0,this.rright=t.rright||0,this.rwd=t.rwd||0,this.rht=t.rht||0,this.rflags=t.rflags||0,this.RotationAngle=t.RotationAngle||0,this.ShortRef=t.ShortRef||0,this.StyleRecord=t.StyleRecord||null,this.Dimensions=t.Dimensions||0,this.bOverrideDefaultStyleOnDraw=t.bOverrideDefaultStyleOnDraw||!1,this.UniqueID=null==t.UniqueID?-1:t.UniqueID,this.flags=t.flags||0,this.extraflags=t.extraflags||0,this.hookflags=t.hookflags||[],this.targflags=t.targflags||[],this.hooks=t.hooks||[],this.maxhooks=t.maxhooks||1,this.associd=t.associd||-1,this.attachpoint=t.attachpoint||{x:me.Common.DimMax/2,y:me.Common.DimMax/2},this.hookdisp={x:0,y:0},this.TextFlags=t.TextFlags||0,this.DrawingObjectBaseClass=t.DrawingObjectBaseClass||me.DrawObjectBaseClass.Shape,this.objecttype=t.objecttype||0,this.subtype=t.subtype||0,this.dataclass=t.dataclass||0,this.Layer=t.Layer||0,this.SequenceNumber=t.SequenceNumber||-1,this.BusinessObjectID=t.BusinessObjectId||-1,this.NoteID=t.NoteID||-1,this.ExpandedViewID=t.ExpandedViewID||-1,this.DataID=t.DataID||-1,this.tindent=t.tindent||{top:0,left:0,bottom:0,right:0},this.TMargins=t.TMargins||{top:0,left:0,bottom:0,right:0},this.left_sindent=t.left_sindent||0,this.right_sindent=t.right_sindent||0,this.top_sindent=t.top_sindent||0,this.bottom_sindent=t.bottom_sindent||0,this.TableID=t.TableID||-1,this.GraphID=t.GraphID||-1,this.ImageID=t.ImageID||-1,this.ContentType=t.ContentType||me.ContentType.None,this.ContentID=t.ContentID||-1,this.commentId=t.commentId||-1,this.TextParams=t.TextParams||null,this.TextGrow=t.TextGrow||Se.TextGrowBehavior.ProPortional,this.TextAlign=t.TextAlign||bi.TextAlign.Center,this.colorfilter=t.colorfilter||0,this.colorchanges=t.colorchanges||0,this.moreflags=t.moreflags||0,this.sizedim=t.sizedim||{width:0,height:0},this.ConnectPoints=t.ConnectPoints||[],this.ObjGrow=t.ObjGrow||me.GrowBehavior.All,t.ResizeAspectConstrain=this.ObjGrow===me.GrowBehavior.ProPortional,this.datasetType=t.datasetType||-1,this.datasetID=t.datasetID||-1,this.datasetTableID=t.datasetTableID||-1,this.datasetElemID=t.datasetElemID||-1,this.fieldDataDatasetID=t.fieldDataDatasetID||-1,this.fieldDataTableID=t.fieldDataTableID||-1,this.fieldDataElemID=t.fieldDataElemID||-1,this.dataStyleOverride=null,this.SymbolURL=t.SymbolURL||"",this.ImageURL=t.ImageURL||"",this.ImageDir=t.ImageDir||null,this.BlobBytesID=t.BlobBytesID||-1,this.EMFHash=t.EMFHash||null,this.EMFBlobBytesID=t.EMFBlobBytesID||-1,this.OleBlobBytesID=t.OleBlobBytesID||-1,this.NativeID=t.NativeID||-1,this.SymbolData=null,this.nativeDataArrayBuffer=null,this.EMFBuffer=null,this.EMFBufferType=t.EMFBufferType||null,this.SymbolID=t.SymbolID,this.SVGFragment=t.SVGFragment||null,this.ShapesInGroup=t.ShapesInGroup||[],this.InitialGroupBounds=t.InitialGroupBounds||{x:0,y:0,width:0,height:0},this.ImageHeader=t.ImageHeader||null,this.OleHeader=t.OleHeader||null,this.nIcons=t.nIcons||0,this.iconSize=t.iconSize||18,this.iconShapeBottomOffset=t.iconShapeBottomOffset||me.Common.IconShapeBottomOffset,this.iconShapeRightOffset=t.iconShapeRightOffset||me.Common.iconShapeRightOffset,this.HyperlinkText=t.HyperlinkText||"",this.AttachmentInfo=t.AttachmentInfo||"",this.ResizeAspectConstrain=t.ResizeAspectConstrain||!1,this.ob={},this.prevBBox=t.prevBBox||{x:0,y:0,width:0,height:0},this.bInGroup=!1,this.LineTextX=t.LineTextX||0,this.LineTextY=t.LineTextX||0,this.actionArrowHideTimerID=-1,this.FramezList=null,this.ParentFrameID=-1,this.uniType=t.uniType||"",this.drawSetting=t.drawSetting||{},this.uniqueId=Oe.GenerateUUID()}GenericKnob(t){F.Debug("= S.BaseDrawObject: GenericKnob input:",t);let e=t.svgDoc.CreateShape(t.shapeType);if(t.shapeType===me.CSType.Polygon){if(t.polyPoints)e.SetPoints(t.polyPoints),t.polyPoints=null;else if("vertical"===t.polyType){const i=[{x:0,y:0},{x:t.knobSize/2,y:-t.knobSize},{x:t.knobSize,y:0},{x:t.knobSize/2,y:t.knobSize}];e.SetPoints(i)}else if("horizontal"===t.polyType){const i=[{x:-t.knobSize/2,y:0},{x:t.knobSize/2,y:-t.knobSize/2},{x:3*t.knobSize/2,y:0},{x:t.knobSize/2,y:t.knobSize/2}];e.SetPoints(i)}else{const i=[{x:0,y:t.knobSize/2},{x:t.knobSize/2,y:0},{x:t.knobSize,y:t.knobSize/2},{x:t.knobSize/2,y:t.knobSize}];e.SetPoints(i)}e.SetEventBehavior(me.EventBehavior.ALL)}return t.locked?(e.SetFillColor("gray"),e.SetID(0)):(e.SetFillColor(t.fillColor),e.SetID(t.knobID),e.SetCursor(t.cursorType)),e.SetSize(t.knobSize,t.knobSize),e.SetPos(t.x,t.y),e.SetFillOpacity(t.fillOpacity),e.SetStrokeWidth(t.strokeSize),e.SetStrokeColor(t.strokeColor),F.Debug("= S.BaseDrawObject: GenericKnob output:",e),e}CreateActionTriggers(t,e,i,o){F.Debug("= S.BaseDrawObject: CreateActionTriggers input:",{inputElement:t,triggerType:e,additionalInfo:i,options:o});return F.Debug("= S.BaseDrawObject: CreateActionTriggers output:",null),null}CreateShape(t,e){F.Debug("= S.BaseDrawObject: CreateShape input:",{shapeType:t,options:e});const i={type:t,options:e||{}};return F.Debug("= S.BaseDrawObject: CreateShape output:",i),i}MoveSVG(){F.Debug("= S.BaseDrawObject: MoveSVG input, BlockID:",this.BlockID);const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(t){const e=this.GetSVGFrame();F.Debug("= S.BaseDrawObject: MoveSVG retrieved frame:",e),t.SetPos(e.x,e.y),F.Debug(`= S.BaseDrawObject: MoveSVG output, SVG element position set to x: ${e.x}, y: ${e.y}`)}else F.Debug("= S.BaseDrawObject: MoveSVG output, no SVG element found for BlockID:",this.BlockID)}CreateConnectHilites(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: CreateConnectHilites input:",{hiliteElements:t,triggerType:e,additionalInfo:i,options:o,extraParam1:n,extraParam2:s});return F.Debug("= S.BaseDrawObject: CreateConnectHilites output:",null),null}CreateDimensionAdjustmentKnobs(t,e,i){F.Debug("= S.BaseDrawObject: CreateDimensionAdjustmentKnobs input:",t,e,i);let o=Oe.DeepCopy(i);const n=o.knobSize/2;o.knobID=me.ActionTriggerType.DimLineAdj;let s=ye.opt.svgDoc.docInfo.docToScreenScale;ye.opt.svgDoc.docInfo.docScale<=.5&&(s*=2),o.knobSize=me.Common.KnobSize/s,o.shapeType=me.CSType.Polygon,o.fillColor="black",o.fillOpacity=1;let a=this.GetDimensionPoints();const r=a.length;for(let l=1;l<r;l++){let i=this.GetDimensionLineDeflectionKnobUserData(e,l,a,n,o.knobSize/2);if(i){o.x=i.knobPoint.x,o.y=i.knobPoint.y;let e=Oe.CalcAngleFromPoints(a[l-1],a[l]);if(o.polyPoints=[{x:0,y:o.knobSize/2},{x:o.knobSize/2,y:0},{x:o.knobSize,y:o.knobSize/2},{x:o.knobSize/2,y:o.knobSize}],0!==e){let t={x:0,y:0,width:0,height:0};ve.GetPolyRect(t,o.polyPoints),si.RotatePointsAboutCenter(t,-e/(180/Se.Geometry.PI),o.polyPoints)}let n=e;this.RotationAngle&&0!==this.RotationAngle&&(n+=this.RotationAngle,n%=360),o.cursorType=this.CalcCursorForAngle(n,!0);let s=this.GenericKnob(o);s.SetUserData(i),t.AddElement(s)}}F.Debug("= S.BaseDrawObject: CreateDimensionAdjustmentKnobs output: created knobs for",r-1,"segments")}HitAreaClick(t){F.Debug("= S.BaseDrawObject: HitAreaClick input:",t),F.Debug("= S.BaseDrawObject: HitAreaClick output: no action taken")}ChangeTarget(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: ChangeTarget input:",{currentTarget:t,newTarget:e,action:i,options:o,extra1:n,extra2:s}),F.Debug("= S.BaseDrawObject: ChangeTarget output: completed")}OnConnect(t,e,i,o,n){F.Debug("= S.BaseDrawObject: OnConnect input:",{connectionPoint:t,targetObject:e,connectionData:i,options:o,context:n}),F.Debug("= S.BaseDrawObject: OnConnect output: completed")}OnDisconnect(t,e,i,o){F.Debug("= S.BaseDrawObject: OnDisconnect input:",{connectionPoint:t,targetObject:e,disconnectData:i,options:o}),F.Debug("= S.BaseDrawObject: OnDisconnect output: completed")}GetDimensionsRect(){F.Debug("= S.BaseDrawObject: GetDimensionsRect input, Dimensions:",this.Dimensions,"Frame:",this.Frame);let t=new wi,e=[];if(!(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select))return F.Debug("= S.BaseDrawObject: GetDimensionsRect output, dimension flags not set. Result:",t),t;const i=this.GetDimensionPoints();if(i.length<2)return F.Debug("= S.BaseDrawObject: GetDimensionsRect output, not enough dimension points. Result:",t),t;for(let n=1;n<i.length;n++){let t=this.GetDimensionFloatingPointValue(n);t||(t=this.GetDimensionTextForPoints(i[n-1],i[n]));const o=Oe.CalcAngleFromPoints(i[n-1],i[n]),s=this.GetPointsForDimension(o,t,i[n-1],i[n],n);s&&(e.push(s.left),e.push(s.right),e.push(s.textFrame))}const o=this.GetBoundingBoxesForSecondaryDimensions();e=e.concat(o);for(let n=0;n<e.length;n++)0===t.width&&0===t.height?ve.CopyRect(t,e[n]):t=ve.UnionRect(t,e[n],t);return t.x+=this.Frame.x,t.y+=this.Frame.y,F.Debug("= S.BaseDrawObject: GetDimensionsRect output, result:",t),t}GetBoundingBoxesForSecondaryDimensions(){F.Debug("= S.BaseDrawObject: GetBoundingBoxesForSecondaryDimensions input");const t=[];return F.Debug("= S.BaseDrawObject: GetBoundingBoxesForSecondaryDimensions output:",t),t}AddDimensionsToR(){F.Debug("= S.BaseDrawObject: AddDimensionsToR input");let t=this.GetDimensionsRect();F.Debug("= S.BaseDrawObject: AddDimensionsToR - dimensionsRect:",t),0!==t.width?(this.r=ve.UnionRect(this.r,t,this.r),F.Debug("= S.BaseDrawObject: AddDimensionsToR - updated r:",this.r)):F.Debug("= S.BaseDrawObject: AddDimensionsToR - dimensionsRect.width is 0, no updates made"),F.Debug("= S.BaseDrawObject: AddDimensionsToR output",this.r)}UpdateFrame(t){F.Debug("= S.BaseDrawObject: UpdateFrame input:",t),t&&(ve.CopyRect(this.Frame,t),ve.CopyRect(this.r,t),ve.CopyRect(this.inside,t),ve.CopyRect(this.trect,t)),F.Debug("= S.BaseDrawObject: UpdateFrame output:",{Frame:this.Frame,r:this.r,inside:this.inside,trect:this.trect})}SetSize(t,e){F.Debug("= S.BaseDrawObject: SetSize input:",{width:t,height:e}),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),F.Debug("= S.BaseDrawObject: SetSize output:",{rflags:this.rflags})}OffsetShape(t,e){F.Debug("= S.BaseDrawObject: OffsetShape input:",{dx:t,dy:e}),this.Frame.x+=t,this.Frame.y+=e,this.r.x+=t,this.r.y+=e,this.inside.x+=t,this.inside.y+=e,this.trect.x+=t,this.trect.y+=e,F.Debug("= S.BaseDrawObject: OffsetShape output:",{Frame:this.Frame,r:this.r,inside:this.inside,trect:this.trect})}SetShapeOrigin(t,e,i){F.Debug("= S.BaseDrawObject: SetShapeOrigin input:",{newX:t,newY:e,origin:i});const o=null!=t?t-this.Frame.x:0,n=null!=e?e-this.Frame.y:0;this.OffsetShape(o,n),F.Debug("= S.BaseDrawObject: SetShapeOrigin output: new Frame:",this.Frame)}ApplyCurvature(t){F.Debug("= S.BaseDrawObject: ApplyCurvature input:",t),F.Debug("= S.BaseDrawObject: ApplyCurvature output: completed")}ScaleObject(t,e,i,o,n,s,a){F.Debug("= S.BaseDrawObject: ScaleObject input:",{posOffsetX:t,posOffsetY:e,rotateCenter:i,rotationAngle:o,scaleX:n,scaleY:s,updateContainerStyle:a});let r=this.Frame;if(r.x=t+r.x*n,r.y=e+r.y*s,r.width*=n,r.height*=s,this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),o){const t={x:r.x+r.width/2,y:r.y+r.height/2},e=2*Math.PI*(o/360),n=ye.opt.RotatePointAroundPoint(i,t,e);r.x=n.x-r.width/2,r.y=n.y-r.height/2,this.RotationAngle+=o,this.RotationAngle>=360&&(this.RotationAngle-=360)}if(a){let t=n;s>t&&(t=s),this.StyleRecord.Line.Thickness*=t,this.StyleRecord.Line.BThick*=t}if(this.ContainerList){const t=this.ContainerList;t.HorizontalSpacing*=n,t.VerticalSpacing*=n,t.MinWidth*=n,t.MinHeight*=n,t.childwidth*=n,t.childheight*=n}this.UpdateFrame(r),this.sizedim.width=this.Frame.width,this.sizedim.height=this.Frame.height,F.Debug("= S.BaseDrawObject: ScaleObject output:",{Frame:this.Frame,RotationAngle:this.RotationAngle,sizedim:this.sizedim})}GetDragR(){let t=new wi;return ve.CopyRect(t,this.r),F.Debug("= S.BaseDrawObject: GetDragR output:",t),t}GetHitTestFrame(){F.Debug("= S.BaseDrawObject: GetHitTestFrame input");let t=new wi;return ve.CopyRect(t,this.r),F.Debug("= S.BaseDrawObject: GetHitTestFrame output:",t),t}GetSVGFrame(t){F.Debug("= S.BaseDrawObject: GetSVGFrame - input:",t);const e=new wi;return null==t&&(t=this.Frame),ve.CopyRect(e,t),F.Debug("= S.BaseDrawObject: GetSVGFrame - output:",e),e}LinkGrow(t,e){F.Debug("= S.BaseDrawObject: LinkGrow input:",{inputElement:t,growthFactor:e}),F.Debug("= S.BaseDrawObject: LinkGrow output: completed")}GetMoveRect(t){F.Debug("= S.BaseDrawObject: GetMoveRect input:",{useRelative:t});let e={};return t?(ve.CopyRect(e,this.r),ve.InflateRect(e,0,0)):ve.CopyRect(e,this.Frame),F.Debug("= S.BaseDrawObject: GetMoveRect output:",e),e}GetPositionRect(){F.Debug("= S.BaseDrawObject: GetPositionRect input");const t={};return ve.CopyRect(t,this.Frame),F.Debug("= S.BaseDrawObject: GetPositionRect output:",t),t}AdjustPinRect(t,e){F.Debug("= S.BaseDrawObject: AdjustPinRect input:",{inputRect:t,adjustment:e});const i=t;return F.Debug("= S.BaseDrawObject: AdjustPinRect output:",i),i}GetArrayRect(t){F.Debug("= S.BaseDrawObject: GetArrayRect input:",{useAlternateMapping:t});const e=this.StyleRecord.Line.BThick?2*this.StyleRecord.Line.BThick:this.StyleRecord.Line.Thickness/2;let i=Oe.DeepCopy(this.Frame);ve.InflateRect(i,e,e);const o=new fi;return t?(o.h=i.y,o.v=i.x,o.hdist=i.height,o.vdist=i.width):(o.h=i.x,o.hdist=i.width,o.v=i.y,o.vdist=i.height),F.Debug("= S.BaseDrawObject: GetArrayRect output:",o),o}GetTargetRect(t,e){F.Debug("= S.BaseDrawObject: GetTargetRect input:",{input:t,options:e});const i={x:0,y:0,width:0,height:0};return F.Debug("= S.BaseDrawObject: GetTargetRect output:",i),i}GetHookFlags(){F.Debug("= S.BaseDrawObject: GetHookFlags input");return F.Debug("= S.BaseDrawObject: GetHookFlags output:",0),0}AllowLink(){F.Debug("= S.BaseDrawObject: AllowLink input: none");return F.Debug("= S.BaseDrawObject: AllowLink output:",0),0}AllowSpell(){F.Debug("= S.BaseDrawObject: AllowSpell input, bInGroup:",this.bInGroup,"TextFlags:",this.TextFlags);const t=!this.bInGroup&&0==(this.TextFlags&Se.TextFlags.NoSpell);return F.Debug("= S.BaseDrawObject: AllowSpell output:",t),t}PreventLink(){F.Debug("= S.BaseDrawObject: PreventLink input");return F.Debug("= S.BaseDrawObject: PreventLink output:",false),false}AllowHeal(){F.Debug("= S.BaseDrawObject: AllowHeal input: none");return F.Debug("= S.BaseDrawObject: AllowHeal output:",false),false}AllowMaintainLink(){F.Debug("= S.BaseDrawObject: AllowMaintainLink input, no parameters");return F.Debug("= S.BaseDrawObject: AllowMaintainLink output:",true),true}GetHookPoints(){F.Debug("= S.BaseDrawObject: GetHookPoints input");return F.Debug("= S.BaseDrawObject: GetHookPoints output:",null),null}GetBestHook(t,e,i){F.Debug("= S.BaseDrawObject: GetBestHook - input:",{inputHook:t,targetHook:e,attachmentData:i});const o=e;return F.Debug("= S.BaseDrawObject: GetBestHook - output:",o),o}SetHookAlign(t,e){F.Debug("= S.BaseDrawObject: SetHookAlign input:",{hook:t,alignment:e}),F.Debug("= S.BaseDrawObject: SetHookAlign output: completed")}GetTargetPoints(t,e,i){F.Debug("= S.BaseDrawObject: GetTargetPoints input:",{targetPoint:t,hookFlags:e,extraParam:i});return F.Debug("= S.BaseDrawObject: GetTargetPoints output:",null),null}AllowHook(t,e,i){F.Debug("= S.BaseDrawObject: AllowHook input:",{hookData:t,target:e,attachment:i});return F.Debug("= S.BaseDrawObject: AllowHook output:",true),true}ConnectToHook(t,e){F.Debug("= S.BaseDrawObject: ConnectToHook input:",{sourceHook:t,targetHook:e});const i=e;return F.Debug("= S.BaseDrawObject: ConnectToHook output:",i),i}HookToPoint(t,e){F.Debug("= S.BaseDrawObject: HookToPoint input:",{point:t,target:e});const i={x:0,y:0};return F.Debug("= S.BaseDrawObject: HookToPoint output:",i),i}IsCoManager(t){F.Debug("= S.BaseDrawObject: IsCoManager input:",t);return F.Debug("= S.BaseDrawObject: IsCoManager output:",false),false}LinkNotVisible(){F.Debug("= S.BaseDrawObject: LinkNotVisible input: no parameters");const t=(this.flags&Se.ObjFlags.NotVisible)>0;return F.Debug("= S.BaseDrawObject: LinkNotVisible output:",t),t}IsAsstConnector(){F.Debug("= S.BaseDrawObject: IsAsstConnector input:");return F.Debug("= S.BaseDrawObject: IsAsstConnector output:",false),false}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: GetPerimPts input:",{unusedId:t,points:e,unusedParam:i,skipRotation:o,optionalParam:n,anotherOptionalParam:s});const a=e.length,r=[],l=tn.ShapeTypes.TRIANGLE,h=me.Common.DimMax;for(let c=0;c<a;c++){r[c]={x:0,y:0,id:0},r[c].x=e[c].x/h*this.Frame.width+this.Frame.x;const t=this.dataclass===l?h-e[c].y:e[c].y;r[c].y=t/h*this.Frame.height+this.Frame.y,null!=e[c].id&&(r[c].id=e[c].id)}if(!o){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,r)}return F.Debug("= S.BaseDrawObject: GetPerimPts output:",r),r}ChangeHook(t,e,i){F.Debug("= S.BaseDrawObject: ChangeHook input:",{sourceHook:t,targetHook:e,additionalData:i}),Yo.CNChangeHook(this,t,e,i),F.Debug("= S.BaseDrawObject: ChangeHook output:","Hook change applied")}ChangeShape(t,e,i,o,n){F.Debug("= S.BaseDrawObject: ChangeShape input:",{e:t,t:e,a:i,r:o,i:n});return F.Debug("= S.BaseDrawObject: ChangeShape output:",false),false}GetLineChangeFrame(){F.Debug("= S.BaseDrawObject: GetLineChangeFrame input:",this.Frame);let t=Oe.DeepCopy(this.Frame);return t.width<me.Common.SegDefLen&&(t.width=me.Common.SegDefLen),t.height<me.Common.SegDefLen&&(t.height=me.Common.SegDefLen),F.Debug("= S.BaseDrawObject: GetLineChangeFrame output:",t),t}DeleteObject(){F.Debug("= S.BaseDrawObject: DeleteObject input:",{TableID:this.TableID,DataID:this.DataID,NoteID:this.NoteID,NativeID:this.NativeID,BlobBytesID:this.BlobBytesID,EMFBlobBytesID:this.EMFBlobBytesID,OleBlobBytesID:this.OleBlobBytesID,commentId:this.commentId});let t=null,e=[];if(-1!==this.DataID&&(t=ye.stdObj.GetObject(this.DataID),t&&t.Delete()),-1!==this.NoteID&&(t=ye.stdObj.GetObject(this.NoteID),t&&t.Delete()),-1!==this.NativeID&&(t=ye.stdObj.GetObject(this.NativeID),t&&t.Delete()),-1!==this.BlobBytesID&&(t=ye.stdObj.GetObject(this.BlobBytesID),t&&t.Delete(),Ps.IsBlobURL(this.ImageURL)&&Ps.DeleteURL(this.ImageURL)),-1!==this.EMFBlobBytesID&&(t=ye.stdObj.GetObject(this.EMFBlobBytesID),t&&t.Delete()),-1!==this.OleBlobBytesID&&(t=ye.stdObj.GetObject(this.OleBlobBytesID),t&&t.Delete()),this.RemoveFieldData(!0),this.hooks.length>0){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);if(t&&t.objecttype===Se.FNObjectTypes.FlWall&&!(t.Dimensions&Se.DimensionFlags.HideHookedObjDimensions)){e=Oe.DeepCopy(this.hooks),this.hooks=[];const i=ye.opt.svgObjectLayer.GetElementById(t.BlockID);t.UpdateDimensionLines(i),this.hooks=e}}this.commentId>=0&&ye.opt.CommentObjectDelete(this),F.Debug("= S.BaseDrawObject: DeleteObject output: object deleted")}GetTextIDs(){F.Debug("= S.BaseDrawObject: GetTextIDs input");const t=[];return F.Debug("= S.BaseDrawObject: GetTextIDs output:",t),t}GetSegLFace(t,e,i){F.Debug("= S.BaseDrawObject: GetSegLFace input:",{segmentIndex:t,someParam:e,anotherParam:i});return F.Debug("= S.BaseDrawObject: GetSegLFace output:",0),0}GetSpacing(){F.Debug("= S.BaseDrawObject: GetSpacing input");const t={width:null,height:null};return F.Debug("= S.BaseDrawObject: GetSpacing output:",t),t}GetShapeConnectPoint(){F.Debug("= S.BaseDrawObject: GetShapeConnectPoint input:");const t={x:0,y:0};return F.Debug("= S.BaseDrawObject: GetShapeConnectPoint output:",t),t}ClosePolygon(t,e,i){F.Debug("= S.BaseDrawObject: ClosePolygon input:",{e:t,t:e,a:i});return F.Debug("= S.BaseDrawObject: ClosePolygon output:",false),false}Hit(t,e,i,o){F.Debug("= S.BaseDrawObject: Hit input:",{point:t,param2:e,param3:i,param4:o});const n=ve.pointInRect(this.Frame,t)?Se.HitCodes.Border:0;return F.Debug("= S.BaseDrawObject: Hit output:",n),n}AfterModifyShape(t,e){F.Debug("= S.BaseDrawObject: AfterModifyShape input:",{shape:t,additionalData:e}),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),F.Debug("= S.BaseDrawObject: AfterModifyShape output: links updated")}AfterRotateShape(t){F.Debug("= S.BaseDrawObject: AfterRotateShape input:",t),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),F.Debug("= S.BaseDrawObject: AfterRotateShape output: links updated")}PolyGetTargetPointList(t){F.Debug("= S.BaseDrawObject: PolyGetTargetPointList input:",t);let e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null);if(0!==this.RotationAngle){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,e)}return F.Debug("= S.BaseDrawObject: PolyGetTargetPointList output:",e),e}GetPolyPoints(t,e,i,o,n){F.Debug("= S.BaseDrawObject: GetPolyPoints input:",{dummy:t,applyAbsoluteOffset:e,unused:i,inflateRect:o,unused2:n});let s=[],a=new wi;const r=this.StyleRecord.Line.Thickness/2;if(ve.CopyRect(a,this.Frame),o&&ve.InflateRect(a,r,r),s.push(new De(0,0)),s.push(new De(a.width,0)),s.push(new De(a.width,a.height)),s.push(new De(0,a.height)),s.push(new De(0,0)),!e)for(let l=0;l<s.length;l++)s[l].x+=a.x,s[l].y+=a.y;return F.Debug("= S.BaseDrawObject: GetPolyPoints output:",s),s}RightClick(t){F.Debug("= S.BaseDrawObject: RightClick input:",t);const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);F.Debug("= S.BaseDrawObject: Converted window to doc coords:",e);const i=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);return F.Debug("= S.BaseDrawObject: Found SVG element:",i),Qo.SelectObjectFromClick(t,i)?(ye.opt.rClickParam=new Le,ye.opt.rClickParam.targetId=i.GetID(),ye.opt.rClickParam.hitPoint.x=e.x,ye.opt.rClickParam.hitPoint.y=e.y,ye.opt.rClickParam.locked=(this.flags&Se.ObjFlags.Lock)>0,F.Debug("= S.BaseDrawObject: Right click param set to:",ye.opt.rClickParam),ye.docUtil.IsReadOnly()?Ts.ShowContextMenu(!0,"DrawObject","ReadOnly"):Ts.ShowContextMenu(!0,"DrawObject","Editable"),F.Debug("= S.BaseDrawObject: RightClick output: Contextual menu shown"),!0):(F.Debug("= S.BaseDrawObject: RightClick output: Object selection failed"),!1)}AdjustTextEditBackground(t,e){F.Debug("= s.BaseDrawObject: AdjustTextEditBackground input:",{e:t,t:e})}SetTextContent(t){if(F.Debug("= S.BaseDrawObject: SetTextContent input:",t),t){const e=new ki({runtimeText:t}),i=ye.stdObj.CreateBlock(Ce.StoredObjectType.TextObject,e);if(null===i)throw"error: AddNewObject got a null new text block allocation";this.DataID=i.ID}F.Debug("= S.BaseDrawObject: SetTextContent output, DataID:",this.DataID)}SetNoteContent(t){if(F.Debug("= S.BaseDrawObject: SetNoteContent input:",t),t){const e=new ki({runtimeText:t}),i=ye.stdObj.CreateBlock(Ce.StoredObjectType.NotesObject,e);if(null===i)throw Uo.Error("= s.BaseDrawObject: SetNoteContent error: null new text block allocation"),"error: AddNewObject got a null new text block allocation";this.NoteID=i.ID,F.Debug("= S.BaseDrawObject: SetNoteContent output: NoteID set to",this.NoteID)}else F.Debug("= S.BaseDrawObject: SetNoteContent output: no note content provided")}GetArrowheadFormat(){F.Debug("= S.BaseDrawObject: GetArrowheadFormat input:");return F.Debug("= S.BaseDrawObject: GetArrowheadFormat output:",null),null}GetTextParaFormat(t){F.Debug("= S.BaseDrawObject: GetTextParaFormat input:",t);let e={};e.just=this.TextAlign,e.bullet="none",e.spacing=0;const i=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(this.DataID&&this.DataID>=0){const o=i.textElem;if(o){const i=o.GetVerticalAlignment(),n=o.GetSelectedParagraphStyle();if(n)if(e=new Ci,e.bullet=n.bullet,e.spacing=n.spacing,this instanceof we.Shape.BaseShape)if(e.vjust=i,t)switch(i){case"bottom":case"top":e.just=i+"-"+n.just;break;default:e.just=n.just}else e.just=n.just;else e.just=this.TextAlign}}return F.Debug("= S.BaseDrawObject: GetTextParaFormat output:",e),e}GetTextFormat(t,e){let i,o,n,s,a;F.Debug("= S.BaseDrawObject: GetTextFormat input:",{returnTextFormat:t,textOptions:e});let r=null;const l=bi.TextFace;let h=new Ue,c=new xi;const p=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(h=Oe.DeepCopy(this.StyleRecord.Text),h.FontId=-1,h.FontName=p.def.lf.fontName,null!==this.DataID&&this.DataID>=0){const p=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(p&&(r=p.textElem),e&&(e.hastext=!0),r){r.GetText();const e=r.GetSelectedFormat();if(e)return t?(h.FontSize=on.FontSizeToPoints(e.size),h.FontId=-1,h.FontName=e.font,i="bold"===e.weight,h.Face=ve.SetFlag(h.Face,l.Bold,i),o="italic"===e.style,h.Face=ve.SetFlag(h.Face,l.Italic,o),n="underline"===e.decoration,h.Face=ve.SetFlag(h.Face,l.Underline,n),s="super"===e.baseOffset,h.Face=ve.SetFlag(h.Face,l.Superscript,s),a="sub"===e.baseOffset,h.Face=ve.SetFlag(h.Face,l.Subscript,a),h.Paint.Color=e.color?e.color:"",e.colorTrans&&(h.Paint.Opacity=e.colorTrans),F.Debug("= S.BaseDrawObject: GetTextFormat output (TxtFmtData):",h),h):(c.font=e.font,c.size=e.size,c.weight=e.weight,c.style=e.style,c.decoration=e.decoration,c.baseOffset=e.baseOffset,c.color=e.color,c.colorTrans=e.colorTrans,F.Debug("= S.BaseDrawObject: GetTextFormat output (DefaultStyle):",c),c)}}return F.Debug("= S.BaseDrawObject: GetTextFormat output:",t?h:null),t?h:null}UseTextBlockColor(){F.Debug("= S.BaseDrawObject: UseTextBlockColor input: none");return F.Debug("= S.BaseDrawObject: UseTextBlockColor output:",false),false}SetTextObject(t){return F.Debug("= S.BaseDrawObject: SetTextObject input:",t),this.DataID=t,F.Debug("= S.BaseDrawObject: SetTextObject output: DataID set to",this.DataID),!0}GetTextObject(t,e){F.Debug("= S.BaseDrawObject: GetTextObject input:",{input:t,options:e});const i=this.DataID;return F.Debug("= S.BaseDrawObject: GetTextObject output:",i),i}SetTextFormat(t,e){F.Debug("= S.BaseDrawObject: SetTextFormat input:",{textFormat:t,options:e}),F.Debug("= S.BaseDrawObject: SetTextFormat output: completed")}ExtendLines(){F.Debug("= S.BaseDrawObject: ExtendLines input:"),F.Debug("= S.BaseDrawObject: ExtendLines output: complete")}ExtendCell(t,e,i){F.Debug("= S.BaseDrawObject: ExtendCell input:",{inputCell:t,additionalParam:e,anotherParam:i});return F.Debug("= S.BaseDrawObject: ExtendCell output:",null),null}SetShapeProperties(t){F.Debug("= S.BaseDrawObject: SetShapeProperties input:",t);let e=!1;switch(t.ClickFlag){case Se.TextFlags.OneClick:0==(this.TextFlags&Se.TextFlags.OneClick)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.OneClick,!0),this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.None,!1),e=!0);break;case Se.TextFlags.None:0==(this.TextFlags&Se.TextFlags.None)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.OneClick,!1),this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.None,!0),e=!0);break;case 0:(this.TextFlags&Se.TextFlags.None||this.TextFlags&Se.TextFlags.OneClick)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.OneClick,!1),this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.None,!1),e=!0)}switch(t.PositionFlag){case Se.TextFlags.AttachA:0==(this.TextFlags&Se.TextFlags.AttachA)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.AttachA,!0),this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.AttachB,!1),e=!0);break;case Se.TextFlags.AttachB:0==(this.TextFlags&Se.TextFlags.AttachB)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.AttachB,!0),this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.AttachA,!1),e=!0);break;case 0:0==(this.TextFlags&Se.TextFlags.AttachB)&&0==(this.TextFlags&Se.TextFlags.AttachA)||(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.AttachB,!1),this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.AttachA,!1),e=!0)}return!0===t.CRFlag?0==(this.TextFlags&Se.TextFlags.FormCR)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.FormCR,!0),e=!0):!1===t.CRFlag&&0!=(this.TextFlags&Se.TextFlags.FormCR)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.FormCR,!1),e=!0),!1===t.AllowSpell?0==(this.TextFlags&Se.TextFlags.NoSpell)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.NoSpell,!0),e=!0):!0===t.AllowSpell&&0!=(this.TextFlags&Se.TextFlags.NoSpell)&&(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.NoSpell,!1),e=!0),F.Debug("= S.BaseDrawObject: SetShapeProperties output:",e),e}SetShapeConnectionPoints(t,e,i){F.Debug("= S.BaseDrawObject: SetShapeConnectionPoints input:",{shape:t,connectionPoint:e,additionalInfo:i});return F.Debug("= S.BaseDrawObject: SetShapeConnectionPoints output:",false),false}GetClosestConnectPoint(t){F.Debug("= S.BaseDrawObject: GetClosestConnectPoint input:",t);return F.Debug("= S.BaseDrawObject: GetClosestConnectPoint output:",false),false}ScaleEndPoints(){F.Debug("= S.BaseDrawObject: ScaleEndPoints input:",{polylist:this.polylist,startPoint:this.StartPoint,endPoint:this.EndPoint}),this.polylist&&this.StartPoint&&this.EndPoint&&this.PolyLineScaleEndPoints(),F.Debug("= S.BaseDrawObject: ScaleEndPoints output: completed")}PolyLineScaleEndPoints(){F.Debug("= S.BaseDrawObject: PolyLineScaleEndPoints input:",{polylist:this.polylist,Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint});const t=this.Frame.width/this.polylist.dim.x,e=this.Frame.height/this.polylist.dim.y,i=this.Frame.x+this.Frame.width/2,o=this.Frame.y+this.Frame.height/2;if(1===t&&1===e)return void F.Debug("= S.BaseDrawObject: PolyLineScaleEndPoints output: no scaling required");let n=i-this.StartPoint.x;this.StartPoint.x=i-n*t;let s=o-this.StartPoint.y;this.StartPoint.y=o-s*e,n=i-this.EndPoint.x,this.EndPoint.x=i-n*t,s=o-this.EndPoint.y,this.EndPoint.y=o-s*e,F.Debug("= S.BaseDrawObject: PolyLineScaleEndPoints output:",{StartPoint:this.StartPoint,EndPoint:this.EndPoint})}ChangeLineThickness(t){F.Debug("= S.BaseDrawObject: ChangeLineThickness input:",t),this.UpdateFrame(null),F.Debug("= S.BaseDrawObject: ChangeLineThickness output: thickness changed")}ChangeEffect(){F.Debug("= S.BaseDrawObject: ChangeEffect input: no parameters"),this.UpdateFrame(null),F.Debug("= S.BaseDrawObject: ChangeEffect output: effect changed")}ChangeTextAttributes(t,e,i,o,n,s,a,r){F.Debug("= S.BaseDrawObject: ChangeTextAttributes input:",{fillColor:t,strokeColor:e,isBold:i,isItalic:o,paramI:n,paramN:s,paramO:a,paramS:r}),(t||e||i||o||r)&&ye.opt.ChangeObjectTextAttributes(this.BlockID,t,e,n,o,s,a,r),F.Debug("= S.BaseDrawObject: ChangeTextAttributes output: text attributes changed")}SetObjectStyle(t){F.Debug("= S.BaseDrawObject: SetObjectStyle input:",t);const e=ye.opt.ApplyColorFilter(t,this,this.StyleRecord,this.colorfilter),i=this.StyleRecord.Line.Thickness;return e.StyleRecord&&e.StyleRecord.Fill&&e.StyleRecord.Fill.Paint&&e.StyleRecord.Fill.Paint.Color&&void 0===e.StyleRecord.Name&&void 0===e.StyleRecord.Fill.Paint.FillType&&(this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Gradient?this.StyleRecord.Fill.Paint.Color.toUpperCase()===e.StyleRecord.Fill.Paint.Color.toUpperCase()&&(e.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Solid):e.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Solid),ye.opt.ApplyProperties(e,this),e.StyleRecord&&(e.StyleRecord.Line&&e.StyleRecord.Line.Thickness&&this.ChangeLineThickness(i),e.StyleRecord.OutsideEffect&&this.ChangeEffect()),F.Debug("= S.BaseDrawObject: SetObjectStyle output:",e),e}GetTextDefault(t){if(t&&(Rt.extend(!0,t,new Ci),t.bullet="none",t.spacing=0,t.just="center",t.vjust="middle",this.TextAlign)){const e=this.TextAlign.indexOf("-");e>=0?(t.vjust=this.TextAlign.slice(0,e),t.just=this.TextAlign.slice(e+1,this.TextAlign.length)):t.just=this.TextAlign}const e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),i=Oe.DeepCopy(this.StyleRecord.Text);return i.FontId=-1,i.FontName=e.def.lf.fontName,i}GetListOfEnclosedObjects(t){F.Debug("= S.BaseDrawObject: GetListOfEnclosedObjects input:",t);const e=[];return F.Debug("= S.BaseDrawObject: GetListOfEnclosedObjects output:",e),e}InterceptMoveOperation(t){F.Debug("= S.BaseDrawObject: InterceptMoveOperation input:",t);return F.Debug("= S.BaseDrawObject: InterceptMoveOperation output:",false),false}SetupInterceptMove(t){F.Debug("= S.BaseDrawObject: SetupInterceptMove input:",t);return F.Debug("= S.BaseDrawObject: SetupInterceptMove output:",false),false}IsSelected(){F.Debug("= S.BaseDrawObject: IsSelected input: none");const t=this.BlockID,e=ye.opt.selectObjsBlockId.Data,i=Rt.inArray(t,e)>=0;return F.Debug("= S.BaseDrawObject: IsSelected output:",i),i}RemoveDimensionLines(t){if(F.Debug("= S.BaseDrawObject: RemoveDimensionLines input:",t),null!=t){const e=[me.SVGElementClass.DimLine,me.SVGElementClass.DimText,me.SVGElementClass.AreaDimLine,me.SVGElementClass.DimTextNoEdit];for(let i=0;i<e.length;i++){const o=t.GetElementListWithId(e[i]);for(let e=0;e<o.length;e++)t.RemoveElement(o[e])}}F.Debug("= S.BaseDrawObject: RemoveDimensionLines output: completed")}RemoveCoordinateLines(t){if(F.Debug("= S.BaseDrawObject: RemoveCoordinateLines input:",t),null!=t){const e=[me.SVGElementClass.CoordinateLine];for(let i=0;i<e.length;i++){const o=t.GetElementListWithId(e[i]);for(let e=0;e<o.length;e++)t.RemoveElement(o[e])}}F.Debug("= S.BaseDrawObject: RemoveCoordinateLines output: completed")}SetDimensionLinesVisibility(t,e){function i(t,e,i){const o=t.GetElementListWithId(e);for(let n=0;n<o.length;n++)o[n].SetVisible(i)}F.Debug("= S.BaseDrawObject: SetDimensionLinesVisibility input:",{svgDoc:t,isVisible:e});const o=this.Dimensions===Se.DimensionFlags.Always||this.Dimensions===Se.DimensionFlags.Select;t&&o&&(i(t,me.SVGElementClass.DimLine,e),i(t,me.SVGElementClass.DimText,e),i(t,me.SVGElementClass.DimTextNoEdit,e)),F.Debug("= S.BaseDrawObject: SetDimensionLinesVisibility output: visibility set to",e)}NeedsAddLineThicknessToDimension(t){F.Debug("= S.BaseDrawObject: NeedsAddLineThicknessToDimension input:",t);return F.Debug("= S.BaseDrawObject: NeedsAddLineThicknessToDimension output:",false),false}GetLengthInRulerUnits(t,e){F.Debug("= S.BaseDrawObject: GetLengthInRulerUnits input:",{length:t,offset:e});const i=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);let o="",n=0,s=0,a=0,r=0,l=0,h="",c=1;const p=Math.pow(10,ye.docUtil.rulerConfig.dp);if(e&&(e*=100,ye.docUtil.rulerConfig.useInches||(e/=me.Common.MetricConv),t-=e),ye.docUtil.rulerConfig.showpixels)return o=Math.round(t).toString(),F.Debug("= S.BaseDrawObject: GetLengthInRulerUnits output:",o),o;if(ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units===Se.RulerUnit.Feet){let e=this.GetLengthInUnits(t,!0);if(e<0&&(c=-1,e=-e),n=Math.floor(e/12),s=Math.floor(e%12),a=e-(12*n+s),this.Dimensions&Se.DimensionFlags.ShowFeetAsInches&&(s+=12*n,n=0),a>0&&(l=this.GetFractionStringGranularity(i),r=Math.round(a/l),r>=1/l&&(r=0,12==++s&&(s=0,n++)),r>0)){for(;r%2==0;)r/=2,l*=2;h=`${r}/${Math.floor(1/l)}`}0!==n&&(o=n*c+"'"),(s>0||0===h.length)&&(o+=`${0!==n?" ":""}${s}`),h.length>0&&(o+=`${0!==n||0!==s?" ":""}${h}`),o+='"'}else if(ye.docUtil.rulerConfig.units===Se.RulerUnit.Inches){const e=this.GetLengthInUnits(t);o=(Math.round(e*p)/p).toString()}else{const e=this.GetLengthInUnits(t);ye.docUtil.rulerConfig.units===Se.RulerUnit.M||ye.docUtil.rulerConfig.units===Se.RulerUnit.Cm?o=(Math.round(e*p)/p).toString():ye.docUtil.rulerConfig.units===Se.RulerUnit.Mm&&(o=Math.round(e).toString())}return F.Debug("= S.BaseDrawObject: GetLengthInRulerUnits output:",o),o}GetDimensionTextForPoints(t,e){F.Debug("= S.BaseDrawObject: GetDimensionTextForPoints input:",{startPoint:t,endPoint:e});const i=360-Oe.CalcAngleFromPoints(t,e),o=2*Math.PI*(i/360),n=[new De(t.x,t.y),new De(e.x,e.y)];si.RotatePointsAboutCenter(this.Frame,-o,n);const s=Math.abs(n[0].x-n[1].x),a=Ve.GetLengthInRulerUnits(s);return F.Debug("= S.BaseDrawObject: GetDimensionTextForPoints output:",a),a}UpdateDimensionFromTextObj(t){if(F.Debug("= S.BaseDrawObject: UpdateDimensionFromTextObj input:",t),t&&t.userData){const{segment:e,hookedObjectInfo:i}=t.userData,o=t.GetText();i?this.UpdateDimensionsFromTextForHookedObject(t,o,i):e&&e.angleChange?this.UpdateLineAngleDimensionFromText(t,o,e):this.UpdateDimensionFromText(t,o,e)}F.Debug("= S.BaseDrawObject: UpdateDimensionFromTextObj output: completed")}UpdateDimensionFromText(t,e,i){F.Debug("= S.BaseDrawObject: UpdateDimensionFromText input:",{textObject:t,text:e,segment:i}),F.Debug("= S.BaseDrawObject: UpdateDimensionFromText output: completed")}MaintainProportions(t,e){F.Debug("= S.BaseDrawObject: MaintainProportions input:",{width:t,height:e});return F.Debug("= S.BaseDrawObject: MaintainProportions output:",null),null}CanUseRFlags(){F.Debug("= S.BaseDrawObject: CanUseRFlags input: none");return F.Debug("= S.BaseDrawObject: CanUseRFlags output:",true),true}UpdateDimensionsFromTextForHookedObject(t,e,i){F.Debug("= S.BaseDrawObject: UpdateDimensionsFromTextForHookedObject input:",{textObject:t,text:e,hookedObjectInfo:i});const o=i.segment;Os.ShowSVGSelectionState(this.BlockID,!1);const n=this.GetDimensionLengthFromString(e,o);if(n<=0)return ws.AddToDirtyList(this.BlockID),void Os.RenderDirtySVGObjects();const s=ws.GetObjectPtr(i.hookedObjectID,!0);if(!s)return void F.Debug("= S.BaseDrawObject: UpdateDimensionsFromTextForHookedObject output: hooked object not found");const a=s.hooks[0].connect,r=this.GetPerimPts(this.BlockID,[a],s.hooks[0].hookpt,!1,-1,s.BlockID),l=new De(i.start.x,i.start.y),h=new De(i.end.x,i.end.y),c=[l,h],p=ye.opt.GetCounterClockwiseAngleBetween2Points(l,h);si.RotatePointsAboutCenter(this.Frame,-p,c);let d=n-Math.abs(c[1].x-c[0].x);1===i.side&&(d=-d);const u=this.GetDimensionPoints();for(let b=0;b<u.length;b++)u[b].x+=this.inside.x,u[b].y+=this.inside.y;const g=[u[o-1],u[o],r[0]];si.RotatePointsAboutCenter(this.Frame,-p,g),d>0&&g[2].x+d-s.Frame.width/2>g[1].x?g[2].x=g[1].x-s.Frame.width/2-5:d<0&&g[2].x+d-s.Frame.width/2<g[0].x?g[2].x=g[0].x+s.Frame.width/2+5:g[2].x+=d,si.RotatePointsAboutCenter(this.Frame,p,g);const y=Oe.DeepCopy(this.Frame);ve.InflateRect(y,3,3);const S=ve.pointInRect(y,r[0]),m=this.GetTargetPoints(r[0],Se.HookFlags.LcNoSnaps|Se.HookFlags.LcHookNoExtra|Se.HookFlags.LcShapeOnLine,null);m&&S?(Yo.UpdateHook(s.BlockID,0,this.BlockID,s.hooks[0].hookpt,m[0]),Ps.SetLinkFlag(s.BlockID,Ee.LinkFlags.Move),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),Yo.UpdateHook(s.BlockID,0,this.BlockID,s.hooks[0].hookpt,m[0])):setTimeout((()=>{}),250),F.Debug("= S.BaseDrawObject: UpdateDimensionsFromTextForHookedObject output: completed")}UpdateDimensions(t,e,i){F.Debug("= S.BaseDrawObject: UpdateDimensions input:",{inputElement:t,triggerType:e,additionalInfo:i}),F.Debug("= S.BaseDrawObject: UpdateDimensions output: completed")}GetDimensions(){F.Debug("= S.BaseDrawObject: GetDimensions input: none");const t={width:this.Frame.width,height:this.Frame.height};return F.Debug("= S.BaseDrawObject: GetDimensions output:",t),t}GetDimensionsForDisplay(){F.Debug("= S.BaseDrawObject: GetDimensionsForDisplay input: none");const t={x:this.Frame.x,y:this.Frame.y,width:this.Frame.width,height:this.Frame.height};return F.Debug("= S.BaseDrawObject: GetDimensionsForDisplay output:",t),t}CreateDimension(t,e,i,o,n,s,a,r,l,h,c){let p,d=[],u=[],g=[],y=[],S=[];new wi;let m=new wi,b={left:-1,top:-1,right:-1,bottom:-1},D=this.flags&Se.ObjFlags.Lock,f=this.RotationAngle+o,x={segment:r,hookedObjectInfo:null,textFramePts:[]};if(c&&(x.hookedObjectInfo=c),t){if(p=ye.opt.svgDoc.CreateShape(me.CSType.Text),t.AddElement(p),p.SetRenderingEnabled(!1),p.SetText(n),ve.HasFlag(this.Dimensions,Se.DimensionFlags.Select)&&p.ExcludeFromExport(!0),p.SetUserData(x),this.LineType!==me.LineType.LINE&&(i||this.Dimensions&Se.DimensionFlags.Total||this.Dimensions&Se.DimensionFlags.EndPts||this.NoGrow())?p.SetID(me.SVGElementClass.DimTextNoEdit):(p.SetID(me.SVGElementClass.DimText),p.SetEditCallback(this.DimensionEditCallback,this)),p.SetFormat(ye.opt.header.DimensionFontStyle),p.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0),p.SetRenderingEnabled(!0),i){if(this.GetDimensionAreaTextInfo(p,o,d,u,g,y,S),d.length>0&&(ve.GetPolyRect(m,d),m.width>=this.Frame.width))return void t.RemoveElement(p);x.textFramePts=d,this.CreateDimensionLineArrowHead(t,e,u,b),this.CreateDimensionLineArrowHead(t,e,g,b),this.CreateDimensionLineArrowHead(t,e,y,b),this.CreateDimensionLineArrowHead(t,e,S,b)}else{if(this.GetDimensionTextInfo(s,a,o,p,r,d,u,g,h),x.textFramePts=Oe.DeepCopy(d),l&&ve.Sqrt((a.x-s.x)**2+(a.y-s.y)**2)<p.geometryBBox.width)return void t.RemoveElement(p);this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()&&!h?(this.CreateDimensionLineSegment(e,i,u,b),this.CreateDimensionLineSegment(e,i,g,b)):(this.CreateDimensionLineArrowHead(t,e,u,b,x),this.CreateDimensionLineArrowHead(t,e,g,b,x))}f>=360&&(f-=360);let c=[new De(d[0].x,d[0].y)];if(f>=89&&f<270){let t=360-o,e=2*Math.PI*(t/360);si.RotatePointsAboutCenter(this.Frame,-e,d),m={x:0,y:0,width:0,height:0},ve.GetPolyRect(m,d);let i={x:m.x+m.width,y:m.y+m.height};c=[new De(i.x,i.y)],si.RotatePointsAboutCenter(this.Frame,e,c),(o+=180)>360&&(o-=360)}p.SetPos(c[0].x,c[0].y);try{p.SetRotation(o,c[0].x,c[0].y)}catch(C){throw C}if(!i&&!D&&!this.NoGrow()){let t=Hammer(p.svgObj.SDGObj.DOMElement());t.on("tap",Ls.Evt_DimensionTextTapFactory(this,x,!1)),t.on("doubletap",Ls.Evt_DimensionTextTapFactory(this,x,!0)),p.SetEventProxy(t)}}}CreateCoordinateLine(t,e,i,o,n,s,a,r,l,h,c){let p,d=[],u=[],g=[],y=[],S=[];new wi;let m=new wi,b={left:-1,top:-1,right:-1,bottom:-1},D=this.flags&Se.ObjFlags.Lock,f=this.RotationAngle+o,x={segment:r,hookedObjectInfo:null,textFramePts:[]};if(c&&(x.hookedObjectInfo=c),!t)return;p=ye.opt.svgDoc.CreateShape(me.CSType.Text),t.AddElement(p),p.SetRenderingEnabled(!1),p.SetText(o);ve.HasFlag(this.Dimensions,Se.DimensionFlags.Select)&&p.ExcludeFromExport(!0),p.SetUserData(x);const C=this.LineType!==me.LineType.LINE,P=this.Dimensions&Se.DimensionFlags.Total||this.Dimensions&Se.DimensionFlags.EndPts;if(C&&(i||P||this.NoGrow())?p.SetID(me.SVGElementClass.DimTextNoEdit):(p.SetID(me.SVGElementClass.DimText),p.SetEditCallback(this.DimensionEditCallback,this)),p.SetFormat(ye.opt.header.DimensionFontStyle),p.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0),p.SetRenderingEnabled(!0),i){if(this.GetDimensionAreaTextInfo(p,o,d,u,g,y,S),d.length>0&&(ve.GetPolyRect(m,d),m.width>=this.Frame.width))return void t.RemoveElement(p);x.textFramePts=d,this.CreateDimensionLineArrowHead(t,e,u,b),this.CreateDimensionLineArrowHead(t,e,g,b),this.CreateDimensionLineArrowHead(t,e,y,b),this.CreateDimensionLineArrowHead(t,e,S,b)}else{this.GetCoordinateTextInfo(s,a,o,p,r,d,u,g,h),x.textFramePts=Oe.DeepCopy(d);const n=ve.Sqrt((a.x-s.x)**2+(a.y-s.y)**2)<p.geometryBBox.width;if(l&&n)return void t.RemoveElement(p);this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()&&!h?(F.Debug("=== wall CreateCoordinateLine.leftArrowPoints=",u),F.Debug("=== wall CreateCoordinateLine.rightArrowPoints=",g),this.CreateCoordinateLineSegment(e,i,u,b),this.CreateCoordinateLineSegment(e,i,g,b)):(this.CreateDimensionLineArrowHead(t,e,u,b,x),this.CreateDimensionLineArrowHead(t,e,g,b,x))}f>=360&&(f-=360);let T=[new De(d[0].x,d[0].y)];if(f>=89&&f<270){let t=360-o,e=2*Math.PI*(t/360);si.RotatePointsAboutCenter(this.Frame,-e,d),m={x:0,y:0,width:0,height:0},ve.GetPolyRect(m,d);let i={x:m.x+m.width,y:m.y+m.height};T=[new De(i.x,i.y)],si.RotatePointsAboutCenter(this.Frame,e,T),(o+=180)>360&&(o-=360)}p.SetPos(T[0].x,T[0].y);try{p.SetRotation(o,T[0].x,T[0].y)}catch(O){throw O}if(!i&&!D&&!this.NoGrow()){let t=Hammer(p.svgObj.SDGObj.DOMElement());t.on("tap",Ls.Evt_DimensionTextTapFactory(this,x,!1)),t.on("doubletap",Ls.Evt_DimensionTextTapFactory(this,x,!0)),p.SetEventProxy(t)}}DrawDimensionAngle(t,e,i,o){let n,s,a;F.Debug("= S.BaseDrawObject: DrawDimensionAngle input:",{container:t,pathCreator:e,segmentIndex:i,dimensionPoints:o});const r={angleChange:1,segment:i};if(n=this.GetDimensionAngleInfo(i,o),n){if(t.AddElement(n.text),n.text.SetRenderingEnabled(!1),n.text.SetUserData(r),n.text.SetID(me.SVGElementClass.DimText),n.text.SetEditCallback(this.DimensionEditCallback,this),n.text.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0),n.text.SetRenderingEnabled(!0),n.text.SetPos(n.textRect.x,n.textRect.y),0!==this.RotationAngle&&n.text.SetRotation(-this.RotationAngle),a=ve.GetDistanceBetween2Points(n.baseLinePts[1],n.targetLinePts[1]),s=n.text.GetTextMinDimensions(),a>s.width){const t=n.text.svgObj.SDGObj.DOMElement(),e=Hammer(t);e.on("tap",Ls.Evt_DimensionTextTapFactory(this,r,!1)),e.on("doubletap",Ls.Evt_DimensionTextTapFactory(this,r,!0)),n.text.SetEventProxy(e)}else t.RemoveElement(n.text);a>s.width+2*me.LineAngleDimensionDefs.ArrowHeadSize&&(ve.InflateRect(n.textRect,2,2),this.DrawDimensionAngleArc(t,e,n.targetLinePts[0],n.targetLinePts[1],n.textRect,n.baseLinePts[1]),this.DrawDimensionAngleArc(t,e,n.targetLinePts[0],n.targetLinePts[1],n.textRect,n.targetLinePts[1])),this.Dimensions&Se.DimensionFlags.InteriorAngles||(e.MoveTo(n.baseLinePts[0].x,n.baseLinePts[0].y),e.LineTo(n.baseLinePts[1].x,n.baseLinePts[1].y))}F.Debug("= S.BaseDrawObject: DrawDimensionAngle output: completed")}UpdateLineAngleDimensionFromText(t,e,i){F.Debug("= S.BaseDrawObject: UpdateLineAngleDimensionFromText input:",{textObject:t,text:e,segment:i});let o=parseFloat(e);isNaN(o)||o<-360||o>360?this.UpdateDimensionLines(t):(o<0&&(o+=360),this.SetSegmentAngle(t,i.segment,o)),F.Debug("= S.BaseDrawObject: UpdateLineAngleDimensionFromText output: completed")}SetSegmentAngle(t,e,i){F.Debug("= S.BaseDrawObject: SetSegmentAngle input:",{segment:t,angle:e,additionalData:i}),F.Debug("= S.BaseDrawObject: SetSegmentAngle output: completed")}DrawDimensionAngleArrowhead(t,e,i){F.Debug("= S.BaseDrawObject: DrawDimensionAngleArrowhead input:",{container:t,angle:e,point:i});const o=[],n=new wi;o.push(new De(i.x,i.y)),o.push(new De(i.x-me.LineAngleDimensionDefs.ArrowHeadSize,i.y+me.LineAngleDimensionDefs.ArrowHeadWidth)),o.push(new De(i.x-me.LineAngleDimensionDefs.ArrowHeadSize,i.y-me.LineAngleDimensionDefs.ArrowHeadWidth)),si.RotatePointsAboutPoint(i,e,o),ve.GetPolyRect(n,o);const s=ye.opt.svgDoc.CreateShape(me.CSType.Polygon);s.SetPoints(o),s.SetEventBehavior(me.EventBehavior.All),s.SetID(me.SVGElementClass.DimLine),s.SetPos(0,0),s.SetSize(n.width,n.height),s.SetFillColor(me.Common.DimLineColor),t.AddElement(s),F.Debug("= S.BaseDrawObject: DrawDimensionAngleArrowhead output: arrowhead drawn")}GetPerpendicularAngle(t,e,i){F.Debug("= S.BaseDrawObject: GetPerpendicularAngle input:",{point1:t,point2:e,isClockwise:i});let o=ye.opt.GetCounterClockwiseAngleBetween2Points(t,e);return o+=i?Math.PI/2:-Math.PI/2,o<0&&(o+=2*Math.PI),o>2*Math.PI&&(o-=2*Math.PI),F.Debug("= S.BaseDrawObject: GetPerpendicularAngle output:",o),o}DrawDimensionAngleArc(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: DrawDimensionAngleArc input:",{container:t,pathCreator:e,startPoint:i,endPoint:o,textRect:n,centerPoint:s});let a=ve.GetDistanceBetween2Points(i,o),r={x:n.x+n.width/2,y:n.y+n.height/2},l=ye.opt.GetCounterClockwiseAngleBetween2Points(i,r),h=ye.opt.GetCounterClockwiseAngleBetween2Points(i,s);l>Math.PI&&0===h&&(h=2*Math.PI),h-=l,h<0&&(h+=2*Math.PI);let c=h<=Math.PI,p=this.GetPerpendicularAngle(i,s,c),d=si.RotatePointsAboutPoint(i,-p,s),u=this.StyleRecord.Line.Thickness/2;d.x-=u,d=si.RotatePointsAboutPoint(i,p,d);let g=c?d:r,y=c?r:d,S=ye.opt.GetCounterClockwiseAngleBetween2Points(i,g),m=en.ArcToPoly(me.Common.MaxPolyPoints,i,a,g.y,y.y,i.x,!1);m=si.RotatePointsAboutPoint(i,-(Math.PI/2-S),m);for(let f=1;f<m.length;f++)e.MoveTo(m[f-1].x,m[f-1].y),e.LineTo(m[f].x,m[f].y);let b=c?m[0]:m[m.length-1];for(let f=0;f<m.length;f++){let t=c?f:m.length-1-f;if(ve.GetDistanceBetween2Points(b,m[t])>me.LineAngleDimensionDefs.ArrowHeadSize){b=m[t];break}}let D=ye.opt.GetCounterClockwiseAngleBetween2Points(b,m[0]);this.DrawDimensionAngleArrowhead(t,D,m[0]),F.Debug("= S.BaseDrawObject: DrawDimensionAngleArc output: completed")}GetDimensionAngleInfo(t,e){let i,o,n,s,a;F.Debug("= S.BaseDrawObject: GetDimensionAngleInfo input:",{segmentIndex:t,points:e});let r="",l=null,h=new wi(0,0,0,0),c=[],p=[],d=[],u=0,g=0,y=0;p.push(new De(e[t-1].x,e[t-1].y)),p.push(new De(e[t].x,e[t].y));const S=this.polylist?this.polylist.closed:e.length>2&&e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y;if(this.Dimensions&Se.DimensionFlags.InteriorAngles&&1===t&&!S)return null;if(this.polylist&&t>=1&&t<this.polylist.segs.length){const e=t>1?t-1:this.polylist.segs.length-1;if(this.polylist.segs[t].LineType!==me.LineType.LINE||this.polylist.segs[e].LineType!==me.LineType.LINE)return null}for(c.push(new De(p[0].x,p[0].y)),this.Dimensions&Se.DimensionFlags.InteriorAngles?1===t?c.push(new De(e[e.length-2].x,e[e.length-2].y)):c.push(new De(e[t-2].x,e[t-2].y)):(u=ve.GetDistanceBetween2Points(p[0],p[1]),c.push(new De(c[0].x+u,c[0].y))),i=ye.opt.GetCounterClockwiseAngleBetween2Points(p[0],p[1]),o=ye.opt.GetCounterClockwiseAngleBetween2Points(c[0],c[1]),i-=o,i<0&&(i+=2*Math.PI),g=i/2,i>Math.PI&&(i=2*Math.PI-i,g+=Math.PI,g>=2*Math.PI&&(g-=2*Math.PI)),i+=o,i>=2*Math.PI&&(i-=2*Math.PI),g+=o,g>=2*Math.PI&&(g-=2*Math.PI),d.push(new De(p[0].x,p[0].y)),d.push(new De(p[1].x,p[1].y)),si.RotatePointsAboutPoint(p[0],-i,d),n=Math.min(ve.GetDistanceBetween2Points(p[0],p[1]),ve.GetDistanceBetween2Points(c[0],c[1])),s=me.LineAngleDimensionDefs.PreferredBisectorLen<n?me.LineAngleDimensionDefs.PreferredBisectorLen:n,d[1].x=d[0].x+s,si.RotatePointsAboutPoint(p[0],g,d),y=Math.abs(i/(2*Math.PI)*360),y=Math.round(y),r=y.toString()+"",l=ye.opt.svgDoc.CreateShape(me.CSType.Text),l.SetFormat(ye.opt.header.DimensionFontStyle),l.SetText(r),a=l.GetTextMinDimensions();s<n&&Math.tan(i/2)*s<a.width/2+me.LineAngleDimensionDefs.PreferredArrowStemMin+me.LineAngleDimensionDefs.ArrowHeadSize;)s+=me.LineAngleDimensionDefs.PreferredBisectorLen,s>=n&&(s=n);ye.opt.SetLineLength(p[0],p[1],s),ye.opt.SetLineLength(c[0],c[1],s),ye.opt.SetLineLength(d[0],d[1],s),h=ve.SetRect(0,0,a.width,a.height),ve.OffsetRect(h,d[1].x,d[1].y),ve.OffsetRect(h,-a.width/2,-a.height/2);const m={text:l,textRect:h,baseLinePts:c,targetLinePts:p};return F.Debug("= S.BaseDrawObject: GetDimensionAngleInfo output:",m),m}GetPointsForDimension(t,e,i,o,n,s){let a;F.Debug("= S.BaseDrawObject: GetPointsForDimension input:",{angle:t,text:e,startPoint:i,endPoint:o,segmentIndex:n,isStandoff:s});const r=[],l=[],h=[],c=new wi,p=new wi,d=new wi;a=ye.opt.svgDoc.CreateShape(me.CSType.Text),a.SetText(e),a.SetFormat(ye.opt.header.DimensionFontStyle),a.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0),this.GetDimensionTextInfo(i,o,t,a,n,h,r,l,s),a=null,ve.GetPolyRect(c,r),ve.GetPolyRect(p,l),ve.GetPolyRect(d,h);const u={left:c,textFrame:d,right:p};return F.Debug("= S.BaseDrawObject: GetPointsForDimension output:",u),u}GetAreaDimension(t){let e;return F.Debug("= S.BaseDrawObject: GetAreaDimension input:",t),this.Dimensions&Se.DimensionFlags.Area?e=this.GetAreaDimensionText(t):this.Dimensions&Se.DimensionFlags.RectWithAndHeight&&(e=this.GetAreaWidthAndHeightText(t)),F.Debug("= S.BaseDrawObject: GetAreaDimension output:",e),e}GetAreaDimensionText(t){F.Debug("= S.BaseDrawObject: GetAreaDimensionText input:",t);let e=0,i="";e=t?this.CalculatePolygonArea(t):this.Frame.width*this.Frame.height;const o=ye.docUtil.rulerConfig.showpixels?e:this.GetLengthInUnits(e);return i=Ve.GetLengthInRulerUnits(o),F.Debug("= S.BaseDrawObject: GetAreaDimensionText output:",i),i}CalculatePolygonArea(t){let e=0,i=t.length-1;for(let o=0;o<t.length;o++)e+=(t[i].x+t[o].x)*(t[i].y-t[o].y),i=o;return Math.abs(e/2)}GetAreaWidthAndHeightText(t){F.Debug("= S.BaseDrawObject: GetAreaWidthAndHeightText input:",t);return F.Debug("= S.BaseDrawObject: GetAreaWidthAndHeightText output:",null),null}GetDimensionPoints(){F.Debug("= S.BaseDrawObject: GetDimensionPoints input");let t=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);if(this.RotationAngle){const e=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,e,t)}return F.Debug("= S.BaseDrawObject: GetDimensionPoints output:",t),t}GetCoordinateLinePoints(){F.Debug("= S.BaseDrawObject: GetCoordinateLinePoints input");let t=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);if(this.RotationAngle){const e=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,e,t)}return F.Debug("= S.BaseDrawObject: GetCoordinateLinePoints output:",t),t}GetHookedObjectDescList(t,e){F.Debug("= S.BaseDrawObject: GetHookedObjectDescList input:",{dimensionPoints:t,context:e});let i=[],o=ws.GetObjectPtr(ye.opt.linksBlockId,!1),n=new wi(0,0,0,0),s=[],a=null,r={x:0,y:0},l=0;if(o){let t=Ps.FindLink(o,this.BlockID,!0),e=o.length;for(;t>=0&&t<e&&o[t].targetid===this.BlockID;){if(a=ws.GetObjectPtr(o[t].hookid,!1),a)for(let e=0;e<a.hooks.length;e++)if(a.hooks[e].objid===this.BlockID){s.push(o[t].hookid);break}t++}}if(e&&e.linkParams){if(e.linkParams.ConnectIndex!==this.BlockID&&(e.linkParams.PrevConnect===this.BlockID||e.linkParams.ConnectIndexHistory.indexOf(this.BlockID)>=0)){let t=s.indexOf(e.movingShapeID);t>=0&&s.splice(t,1)}e.linkParams.ConnectIndex===this.BlockID&&s.indexOf(e.movingShapeID)<0&&s.push(e.movingShapeID)}for(let h=0;h<s.length;h++)if(a=ws.GetObjectPtr(s[h],!1),a instanceof we.Shape.BaseShape&&!(e&&e.linkParams&&e.movingShapeID===a.BlockID&&e.linkParams.ConnectIndex<0&&e.linkParams.PrevConnect===this.BlockID)){if(e&&e.linkParams&&e.movingShapeID===a.BlockID)r=e.linkParams.ConnectPt;else{if(!(a.hooks.length>0))continue;r=a.hooks[0].connect}let o=this.GetPerimPts(this.BlockID,[r]),s=this.Hit(o[0],!0,!1,{});if(!s){if(!(this instanceof we.Shape.BaseLine)||this instanceof we.Shape.PolyLine)continue;if(ve.IsEqual(o[0].x,this.StartPoint.x,2)&&ve.IsEqual(o[0].y,this.StartPoint.y,2))s.segment=0;else{if(!ve.IsEqual(o[0].x,this.EndPoint.x,2)||!ve.IsEqual(o[0].y,this.EndPoint.y,2))continue;s.segment=t.length>2?t.length-2:0}}let h=s.segment+1;if(h-1>=t.length)continue;let c=[new De(t[h-1].x,t[h-1].y),new De(t[h].x,t[h].y)],p=ye.opt.GetCounterClockwiseAngleBetween2Points(c[0],c[1]);si.RotatePointsAboutCenter(n,-p,c);let d=e&&e.movingShapeID===a.BlockID?ve.PolyFromRect(e.movingShapeBBox):a.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),u=e&&e.movingShapeID===a.BlockID?p:-a.RotationAngle/(180/Se.Geometry.PI),g=ve.GetPolyRect({},d),y=Oe.DeepCopy(o[0]);si.RotatePointsAboutCenter(g,u,[y]),ve.OffsetRect(g,o[0].x-y.x,o[0].y-y.y),d=ve.PolyFromRect(g),u&&si.RotatePointsAboutPoint(o[0],-u,d);for(let t=0;t<d.length;t++)d[t].x-=this.Frame.x,d[t].y-=this.Frame.y;si.RotatePointsAboutCenter(n,-p,d);let S=ve.GetPolyRect({},d),m=new De(S.x,c[0].y),b=new De(S.x+S.width,c[0].y);l=m.x,si.RotatePointsAboutCenter(n,p,[m,b]),i.push({id:a.BlockID,segment:h,segmentSortValue:l,start:{x:m.x,y:m.y},end:{x:b.x,y:b.y}})}return i.sort(((t,e)=>t.segment!==e.segment?t.segment<e.segment?-1:1:t.segmentSortValue<e.segmentSortValue?-1:1)),F.Debug("= S.BaseDrawObject: GetHookedObjectDescList output:",i),i}GetHookedObjectDimensionInfo(t){F.Debug("= S.BaseDrawObject: GetHookedObjectDimensionInfo input:",t);let e=-1,i=new De(0,0);const o=[],n=this.GetDimensionPoints(),s=this.GetHookedObjectDescList(n,t),a=s.length;for(let r=0;r<a;r++){const t=s[r];t.segment>e?(i=n[(e=t.segment)-1],o.push({hookedObjID:t.id,side:0,segment:e,start:{x:i.x,y:i.y},end:{x:t.start.x,y:t.start.y}})):o.length>0&&(o[o.length-1].end=t.start),o.push({hookedObjID:t.id,side:1,segment:e,start:{x:t.end.x,y:t.end.y},end:{x:n[e].x,y:n[e].y}}),i=t.end}return F.Debug("= S.BaseDrawObject: GetHookedObjectDimensionInfo output:",o),o}DimensionLineDeflectionAdjust(t,e,i,o,n){F.Debug("= S.BaseDrawObject: DimensionLineDeflectionAdjust input:",{element:t,segmentIndex:e,knobPoint:i,ccAngleRadians:o,adjustForKnob:n});let s=this.GetDimensionPoints(),a=this.GetDimensionDeflectionValue(e),r=new De(i.x+this.Frame.x-n,i.y+this.Frame.y-n),l=[s[e-1],s[e],r,new De(t.x,t.y)];si.RotatePointsAboutCenter(this.Frame,-o,l),this.IsReverseWinding()&&si.RotatePointsAboutCenter(this.Frame,Math.PI,l);let h=l[3].y-l[2].y;return this.polylist&&this.polylist.segs[e].dimTextAltPositioning?a-=h:a+=h,F.Debug("= S.BaseDrawObject: DimensionLineDeflectionAdjust output:",a),a}GetDimensionLineDeflectionKnobUserData(t,e,i,o,n){F.Debug("= S.BaseDrawObject: GetDimensionLineDeflectionKnobUserData input:",{element:t,segmentIndex:e,dimensionPoints:i,knobRadius:o,knobOffset:n});let s,a,r,l,h=null,c=!1;const p=[],d=t.GetElementListWithId(me.SVGElementClass.DimText);for(let b=0;b<d.length;b++)if(d[b].userData.segment===e&&void 0===d[b].userData.side){h=d[b];break}if(!h)return F.Debug("= S.BaseDrawObject: GetDimensionLineDeflectionKnobUserData output: null"),null;s=h.CalcBBox();const u={x:s.x+s.width+25,y:s.y+s.height/2};if(a=360-h.GetRotation(),360===a&&(a=0),r=2*Math.PI*(a/360),si.RotatePointsAboutPoint({x:s.x,y:s.y},r,[u]),p.push(new De(i[e-1].x,i[e-1].y)),p.push(new De(i[e].x,i[e].y)),p[0].x,p[1].x,p[0].y,p[1].y,l=ye.opt.GetCounterClockwiseAngleBetween2Points(i[e-1],i[e]),this instanceof we.Shape.Polygon&&this.polylist){const t=Oe.DeepCopy(this),e=ye.opt.ShapeToPolyLine(this.BlockID,!1,!0,t);e&&e.IsReverseWinding&&e.IsReverseWinding()&&(c=!0)}this.IsReverseWinding&&this.IsReverseWinding()&&(c=!0),c&&(l+=Math.PI,l%=2*Math.PI),p.push(new De(u.x,u.y));const g=new wi(0,0,0,0);ve.GetPolyRect(g,p),si.RotatePointsAboutCenter(g,-l,p),p[2].y,p[0].y;const y=Math.max(p[0].x,p[1].x),S=Math.min(p[0].x,p[1].x);(p[2].x>y||p[2].x<S)&&(p[2].x=Math.abs(l-r)<2?y:S,si.RotatePointsAboutCenter(g,l,p),u.x=p[2].x,u.y=p[2].y),u.x+=o-n,u.y+=o-n;const m={segmentIndex:e,knobPoint:u,ccAngleRadians:l,originalDeflection:this.GetDimensionDeflectionValue(e),adjustForKnob:o-n};return F.Debug("= S.BaseDrawObject: GetDimensionLineDeflectionKnobUserData output:",m),m}GetDimensionDeflectionValue(t){F.Debug("= S.BaseDrawObject: GetDimensionDeflectionValue input:",t);let e=0;return e=1===t?this.dimensionDeflectionH?this.dimensionDeflectionH:0:this.dimensionDeflectionV?this.dimensionDeflectionV:0,F.Debug("= S.BaseDrawObject: GetDimensionDeflectionValue output:",e),e}GetDimensionLineDeflection(t,e,i,o){F.Debug("= S.BaseDrawObject: GetDimensionLineDeflection input:",{knobPoint:t,x:e,y:i,deflectionData:o});let n=[],s=new De(0,0),a=this.GetDimensionPoints();for(let h=0;h<a.length;h++)a[h].x+=this.inside.x,a[h].y+=this.inside.y;s.x=o.knobPoint.x+this.Frame.x-o.adjustForKnob,s.y=o.knobPoint.y+this.Frame.y-o.adjustForKnob,n.push(a[o.segmentIndex-1]),n.push(a[o.segmentIndex]),n.push(new De(s.x,s.y)),n.push(new De(e,i)),si.RotatePointsAboutCenter(this.Frame,-o.ccAngleRadians,n),this.IsReverseWinding()&&si.RotatePointsAboutCenter(this.Frame,Math.PI,n);let r=n[3].y-n[2].y,l=this.polylist&&this.polylist.segs[o.segmentIndex].dimTextAltPositioning?o.originalDeflection-r:o.originalDeflection+r;return F.Debug("= S.BaseDrawObject: GetDimensionLineDeflection output:",l),l}UpdateDimensionLines(t,e){if(F.Debug("= S.BaseDrawObject: UpdateDimensionLines input:",{container:t,triggerType:e}),ye.opt.bBuildingSymbols)return t;if(null!=t){this.RemoveDimensionLines(t);(this.Dimensions&Se.DimensionFlags.Area||this.Dimensions&Se.DimensionFlags.RectWithAndHeight)&&this.UpdateAreaDimensionLines(t);return(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select||e)&&this.UpdateEdgeDimensionLines(t,e),F.Debug("= S.BaseDrawObject: UpdateDimensionLines output:",t),t}return F.Debug("= S.BaseDrawObject: UpdateDimensionLines output: null"),null}UpdateCoordinateLines(t,e){if(F.Debug("= S.BaseDrawObject: UpdateCoordinateLines input:",{container:t,triggerType:e}),ye.opt.bBuildingSymbols)return t;if(null!=t){this.RemoveCoordinateLines(t);return(this.Dimensions&Se.DimensionFlags.Area||this.Dimensions&Se.DimensionFlags.RectWithAndHeight)&&this.UpdateAreaDimensionLines(t),this.Dimensions&Se.DimensionFlags.Always||(this.Dimensions,Se.DimensionFlags.Select),F.Debug("= S.BaseDrawObject: UpdateCoordinateLines output:",t),t}return F.Debug("= S.BaseDrawObject: UpdateCoordinateLines output: null"),null}UpdateHookedObjectDimensionLines(t,e,i){if(F.Debug("= S.BaseDrawObject: UpdateHookedObjectDimensionLines input:",{container:t,pathCreator:e,dimensionInfo:i}),this.Dimensions&Se.DimensionFlags.AllSeg){const o=this.GetHookedObjectDimensionInfo(i);for(let i=0;i<o.length;i++)if(!ve.EqualPt(o[i].start,o[i].end)){const n=Oe.CalcAngleFromPoints(o[i].start,o[i].end),s=this.GetDimensionTextForPoints(o[i].start,o[i].end);this.CreateDimension(t,e,!1,n,s,o[i].start,o[i].end,o[i].segment,!0,!0,o[i])}}F.Debug("= S.BaseDrawObject: UpdateHookedObjectDimensionLines output: completed")}UpdateEdgeDimensionLines(t,e){let i,o,n,s,a;F.Debug("= S.BaseDrawObject: UpdateEdgeDimensionLines input:",{container:t,triggerType:e});let r=0,l=0,h="";if(!t)return void F.Debug("= S.BaseDrawObject: UpdateEdgeDimensionLines output: container is null");i=ye.opt.svgDoc.CreateShape(me.CSType.Path),t.AddElement(i),o=i.PathCreator(),i.SetID(me.SVGElementClass.DimLine),i.SetFillColor("none"),i.SetStrokeColor(me.Common.DimLineColor),i.SetStrokeOpacity(1),i.SetStrokeWidth(1),o.BeginPath();const c=this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select;if(n=this.GetDimensionPoints(),s=n.length,a=this instanceof we.Shape.Polygon,c)for(l=1;l<s;l++)ve.EqualPt(n[l-1],n[l])||(r=Oe.CalcAngleFromPoints(n[l-1],n[l]),h=this.GetDimensionFloatingPointValue(l)||this.GetDimensionTextForPoints(n[l-1],n[l]),this.CreateDimension(t,o,!1,r,h,n[l-1],n[l],l,!1,a));this.UpdateSecondaryDimensions(t,o,e),this.ShowOrHideDimensions(!1,e),o.Apply(),F.Debug("= S.BaseDrawObject: UpdateEdgeDimensionLines output: completed")}UpdateEdgeCoordinateLines(t,e){let i,o,n;F.Debug("= S.BaseDrawObject: UpdateEdgeCoordinateLines input:",{shapeContainer:t,triggerType:e}),t?(i=ye.opt.svgDoc.CreateShape(me.CSType.Path),t.AddElement(i),o=i.PathCreator(),i.SetID(me.SVGElementClass.CoordinateLine),i.SetFillColor("none"),i.SetStrokeColor(me.Common.CoordinateLineColor),i.SetStrokeOpacity(1),i.SetStrokeWidth(1),i.SetStrokePattern("5,5"),o.BeginPath(),n=this.GetCoordinateLinePoints(),F.Debug("= S.BaseDrawObject: coordinateLinePoints:",n),n.length,we.Shape.Polygon,this.UpdateSecondaryDimensions(t,o,e),this.ShowOrHideDimensions(!1,e),o.Apply(),F.Debug("= S.BaseDrawObject: UpdateEdgeCoordinateLines output: completed")):F.Debug("= S.BaseDrawObject: UpdateEdgeCoordinateLines output: shapeContainer is null")}UpdateSecondaryDimensions(t,e,i){F.Debug("= S.BaseDrawObject: UpdateSecondaryDimensions input:",{container:t,pathCreator:e,triggerType:i}),F.Debug("= S.BaseDrawObject: UpdateSecondaryDimensions output: completed")}HideOrShowSelectOnlyDimensions(t,e){let i;F.Debug("= S.BaseDrawObject: HideOrShowSelectOnlyDimensions input:",{show:t,context:e});let o=0,n=null,s=null,a=!1,r=!1;const l=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(null!==l){const h=[me.SVGElementClass.DimLine,me.SVGElementClass.DimText,me.SVGElementClass.AreaDimLine,me.SVGElementClass.DimTextNoEdit];for(o=l.ElementCount()-1;o>=1;o--)n=l.GetElementByIndex(o),i=n.GetID(),h.indexOf(i)>=0&&(a=!1,e&&(s=n.GetUserData())&&s.hookedObjectInfo&&s.hookedObjectInfo.hookedObjID===e.movingShapeID&&(a=!0),r=t,r=!!a||!!(this.Dimensions&Se.DimensionFlags.Always)||!!(this.Dimensions&Se.DimensionFlags.Select)&&t,n.SetOpacity(r?1:0))}F.Debug("= S.BaseDrawObject: HideOrShowSelectOnlyDimensions output: completed")}ShowOrHideDimensions(t,e){F.Debug("= S.BaseDrawObject: ShowOrHideDimensions input:",{show:t,context:e});let i=null;this.HideOrShowSelectOnlyDimensions(t,e),this.hooks.length>0&&e&&e.movingShapeID===this.BlockID&&(i=ws.GetObjectPtr(this.hooks[0].objid,!1),(!i||i.objecttype!==Se.FNObjectTypes.FlWall||i.Dimensions&Se.DimensionFlags.HideHookedObjDimensions)&&i.HideOrShowSelectOnlyDimensions(t,e)),F.Debug("= S.BaseDrawObject: ShowOrHideDimensions output: completed")}GetPointsForAreaDimension(){F.Debug("= S.BaseDrawObject: GetPointsForAreaDimension input: none");const t=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null);return F.Debug("= S.BaseDrawObject: GetPointsForAreaDimension output:",t),t}UpdateAreaDimensionLines(t){F.Debug("= S.BaseDrawObject: UpdateAreaDimensionLines input:",t);const e=ye.opt.svgDoc.CreateShape(me.CSType.Path);if(null!=t){t.AddElement(e);const i=e.PathCreator();e.SetID(me.SVGElementClass.AreaDimLine),e.SetFillColor("none"),e.SetStrokeColor(me.Common.DimLineColor),e.SetStrokeOpacity(1),e.SetStrokeWidth(1),i.BeginPath();const o=this.GetPointsForAreaDimension(),n=this.GetAreaDimension(o);n&&""!==n&&this.CreateDimension(t,i,!0,0,n),e.SetFillColor("#0000FF"),e.SetStrokeWidth(0),i.Apply()}F.Debug("= S.BaseDrawObject: UpdateAreaDimensionLines output: completed")}GetDimensionFloatingPointValue(t){F.Debug("= S.BaseDrawObject: GetDimensionFloatingPointValue input:",t);let e=0;const i=this.rflags&Se.FloatingPointDim.Width,o=this.rflags&Se.FloatingPointDim.Height;if(i||o){if(1===t&&i){e=this.GetDimensionLengthFromValue(this.rwd);const t=Ve.GetLengthInRulerUnits(e);return F.Debug("= S.BaseDrawObject: GetDimensionFloatingPointValue output:",t),t}if(2===t&&o){e=this.GetDimensionLengthFromValue(this.rht);const t=Ve.GetLengthInRulerUnits(e);return F.Debug("= S.BaseDrawObject: GetDimensionFloatingPointValue output:",t),t}}return F.Debug("= S.BaseDrawObject: GetDimensionFloatingPointValue output: null"),null}IsTextFrameOverlap(t,e){F.Debug("= S.BaseDrawObject: IsTextFrameOverlap input:",{textFrame:t,angle:e});return F.Debug("= S.BaseDrawObject: IsTextFrameOverlap output:",false),false}GetExteriorDimensionMeasurementLineThicknessAdjustment(t){F.Debug("= S.BaseDrawObject: GetExteriorDimensionMeasurementLineThicknessAdjustment input:",t);return F.Debug("= S.BaseDrawObject: GetExteriorDimensionMeasurementLineThicknessAdjustment output:",0),0}CanUseStandOffDimensionLines(){F.Debug("= S.BaseDrawObject: CanUseStandOffDimensionLines input: none");return F.Debug("= S.BaseDrawObject: CanUseStandOffDimensionLines output:",true),true}GetDimensionLengthFromString(t,e){F.Debug("= S.BaseDrawObject: GetDimensionLengthFromString input:",{input:t,someParam:e});let i=this.GetDimensionValueFromString(t,e),o=i<0?i:this.GetDimensionLengthFromValue(i);return F.Debug("= S.BaseDrawObject: GetDimensionLengthFromString output:",o),o}GetDimensionValueFromString(t,e){F.Debug("= S.BaseDrawObject: GetDimensionValueFromString input:",{input:t,someParam:e});let i=0;if(0===(t=t.trim()).length)return F.Debug("= S.BaseDrawObject: GetDimensionValueFromString output:",-1),-1;if(!t.match(/^[0-9. \/\'\"]+$/))return F.Debug("= S.BaseDrawObject: GetDimensionValueFromString output:",-1),-1;if(ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units===Se.RulerUnit.Feet&&!ye.docUtil.rulerConfig.showpixels){if(i=this.ConvertToFeet(t),i<0||isNaN(i))return F.Debug("= S.BaseDrawObject: GetDimensionValueFromString output:",-1),-1}else{if(!this.NumberIsFloat(t))return F.Debug("= S.BaseDrawObject: GetDimensionValueFromString output:",-1),-1;i=parseFloat(t)}const o=isNaN(i)?-1:i;return F.Debug("= S.BaseDrawObject: GetDimensionValueFromString output:",o),o}GetDimensionLengthFromValue(t){F.Debug("= S.BaseDrawObject: GetDimensionLengthFromValue input:",t);let e=0;return e=ye.docUtil.rulerConfig.showpixels?t:this.UnitsToCoord(t,0),(isNaN(e)||e>4e5)&&(e=-1),F.Debug("= S.BaseDrawObject: GetDimensionLengthFromValue output:",e),e}AdjustDimensionLength(t){F.Debug("= S.BaseDrawObject: AdjustDimensionLength input:",t);const e=t;return F.Debug("= S.BaseDrawObject: AdjustDimensionLength output:",e),e}GetDimensionAreaTextInfo(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: GetDimensionAreaTextInfo input:",{textShape:t,textFramePoints:e,leftArrowPoints:i,rightArrowPoints:o,topArrowPoints:n,bottomArrowPoints:s});const a=t.GetTextMinDimensions(),r={width:a.width,height:a.height,x:this.Frame.width/2-a.width/2,y:this.Frame.height/2-a.height/2};this.Frame2Poly(r,e);const l=.5*r.height,h=.5*l,c={x:0,y:0};c.x=r.x-h,c.y=r.y+(r.height-l)/2,i.push(new De(c.x,c.y)),c.y+=l,i.push(new De(c.x,c.y)),c.x-=l,c.y=r.y+r.height/2,i.push(new De(c.x,c.y)),i.push(new De(i[0].x,i[0].y)),c.x=r.x+r.width+h,c.y=r.y+(r.height-l)/2,o.push(new De(c.x,c.y)),c.y+=l,o.push(new De(c.x,c.y)),c.x+=l,c.y=r.y+r.height/2,o.push(new De(c.x,c.y)),o.push(new De(o[0].x,o[0].y)),c.x=r.x+r.width/2-h/2,c.y=r.y-h,n.push(new De(c.x,c.y)),c.x+=h,n.push(new De(c.x,c.y)),c.x-=h/2,c.y-=h,n.push(new De(c.x,c.y)),n.push(new De(n[0].x,n[0].y)),c.x=r.x+r.width/2-h/2,c.y=r.y+r.height+h,s.push(new De(c.x,c.y)),c.x+=h,s.push(new De(c.x,c.y)),c.x-=h/2,c.y+=h,s.push(new De(c.x,c.y)),s.push(new De(s[0].x,s[0].y)),F.Debug("= S.BaseDrawObject: GetDimensionAreaTextInfo output:",{textFramePoints:e,leftArrowPoints:i,rightArrowPoints:o,topArrowPoints:n,bottomArrowPoints:s})}GetFrameIntersects(t,e,i){F.Debug("= S.BaseDrawObject: GetFrameIntersects input:",{frame:t,point:e,tolerance:i});return F.Debug("= S.BaseDrawObject: GetFrameIntersects output:",false),false}AdjustAutoInsertShape(t){F.Debug("= S.BaseDrawObject: AdjustAutoInsertShape input:",t);return F.Debug("= S.BaseDrawObject: AdjustAutoInsertShape output:",false),false}GetDimensionTextInfo1(t,e,i,o,n,s,a,r,l){let h,c,p;F.Debug("= S.BaseDrawObject: GetDimensionTextInfo1 input:",{startPoint:t,endPoint:e,angle:i,textShape:o,segmentIndex:n,textFramePoints:s,leftArrowPoints:a,rightArrowPoints:r,isStandoff:l});const d=[];let u,g,y={x:0,y:0},S={x:0,y:0,width:0,height:0},m=0,b=!1,D=0,f=!1;p=o.GetTextMinDimensions(),S.height=p.height,S.width=p.width,d.push(new De(t.x,t.y)),d.push(new De(e.x,e.y)),h=360-i,c=2*Math.PI*(h/360),si.RotatePointsAboutCenter(this.Frame,-c,d),d[0].x<d[1].x?(u=Oe.DeepCopy(d[0]),g=Oe.DeepCopy(d[1])):(u=Oe.DeepCopy(d[1]),g=Oe.DeepCopy(d[0])),S.x=u.x+(g.x-u.x)/2,S.y=u.y+(g.y-u.y)/2,S.x-=S.width/2,S.y-=S.height/2,S.y-=S.height/2;if((this.Dimensions&Se.DimensionFlags.Exterior||this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness)&&(S.y-=this.StyleRecord.Line.Thickness),f=0!=(this.Dimensions&Se.DimensionFlags.Standoff)&&this.CanUseStandOffDimensionLines(),!l&&!(this.Dimensions&Se.DimensionFlags.HideHookedObjDimensions)&&this instanceof we.Shape.BaseLine&&this.ShortRef!=me.LineTypes.LsMeasuringTape&&this.objecttype===Se.FNObjectTypes.FlWall){const t=ws.GetObjectPtr(ye.opt.linksBlockId,!1);t&&Ps.FindLink(t,this.BlockID,!0)>=0&&(f=!0)}l&&(f=!1);const x=f?me.Common.DimDefaultStandoff:me.Common.DimDefaultNonStandoff;if(S.y-=x,m=me.Common.DimDefaultTextGap,(this.Dimensions&Se.DimensionFlags.Exterior||this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness)&&(m+=this.StyleRecord.Line.Thickness),this instanceof we.Shape.BaseLine&&(!this.polylist||2===this.polylist.segs.length)){const t=Math.floor((c-.01)/(Math.PI/2));b=1===t||2===t}else if(this.polylist&&!this.polylist.closed&&l){const t=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),e=[t[n-1],t[n]];si.RotatePointsAboutCenter(this.Frame,-c,e),e.push({x:S.x+S.width/2,y:S.y+S.height/2}),e[2].x=e[0].x+(e[1].x-e[0].x)/2,si.RotatePointsAboutCenter(this.Frame,c,e),ve.IsPointInPoly(t,e[2])&&(b=!0)}else this.IsTextFrameOverlap(S,i)&&(b=!0);b&&(S.y+=x,S.y+=S.height,this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness&&(S.y+=2*this.StyleRecord.Line.Thickness),S.y+=x);let C=this.Dimensions&Se.DimensionFlags.Standoff;if(C&&!this.CanUseStandOffDimensionLines()&&(C=!1),l&&(C=!1),C&&(D=(this instanceof we.Shape.PolyLine||this instanceof we.Shape.Polygon)&&this.polylist&&this.polylist.segs&&this.polylist.segs.length>n?this.polylist.segs[n].dimDeflection:this instanceof we.Shape.BaseLine?this.dimensionDeflectionH?this.dimensionDeflectionH:0:Math.abs(i%180)<5?this.dimensionDeflectionH:this.dimensionDeflectionV||0,S.y=b?S.y+D:S.y-D,this.polylist&&this.polylist.segs&&this.polylist.segs.length>n&&(this.polylist.segs[n].dimTextAltPositioning=b)),this.Frame2Poly(S,s),this.Dimensions&C)y.x=u.x,y.y=u.y>S.y?u.y-m:u.y+m,a.push(new De(y.x,y.y)),y.y=S.y+S.height/2,a.push(new De(y.x,y.y)),y.x=S.x-me.Common.DimDefaultTextGap,a.push(new De(y.x,y.y)),y.x=S.x+S.width+me.Common.DimDefaultTextGap,r.push(new De(y.x,y.y)),y.x=g.x,r.push(new De(y.x,y.y)),y.y=g.y>S.y?g.y-m:g.y+m,r.push(new De(y.x,y.y));else{const t=.5*S.height,e=.5*t;y.x=S.x-e,y.y=S.y+(S.height-t)/2,a.push(new De(y.x,y.y)),y.y+=t,a.push(new De(y.x,y.y)),y.x-=t,y.y=S.y+S.height/2,a.push(new De(y.x,y.y)),a.push(new De(a[0].x,a[0].y)),y.x=S.x+S.width+e,y.y=S.y+(S.height-t)/2,r.push(new De(y.x,y.y)),y.y+=t,r.push(new De(y.x,y.y)),y.x+=t,y.y=S.y+S.height/2,r.push(new De(y.x,y.y)),r.push(new De(r[0].x,r[0].y))}si.RotatePointsAboutCenter(this.Frame,c,s),si.RotatePointsAboutCenter(this.Frame,c,a),si.RotatePointsAboutCenter(this.Frame,c,r),F.Debug("= S.BaseDrawObject: GetDimensionTextInfo1 output:",{textDim:S,textFramePoints:s,leftArrowPoints:a,rightArrowPoints:r})}GetDimensionTextInfo(t,e,i,o,n,s,a,r,l){var h,c,p,d=[],u={x:0,y:0},g={x:0,y:0},y={x:0,y:0},S={x:0,y:0,width:0,height:0},m=0,b=!1,D=0,f=!1;p=o.GetTextMinDimensions(),S.height=p.height,S.width=p.width,d.push(new De(t.x,t.y)),d.push(new De(e.x,e.y)),h=360-i,c=2*Math.PI*(h/360),si.RotatePointsAboutCenter(this.Frame,-c,d),d[0].x<d[1].x?(u=Oe.DeepCopy(d[0]),g=Oe.DeepCopy(d[1])):(u=Oe.DeepCopy(d[1]),g=Oe.DeepCopy(d[0])),S.x=u.x+(g.x-u.x)/2,S.y=u.y+(g.y-u.y)/2,S.x-=S.width/2,S.y-=S.height/2,S.y-=S.height/2;(this.Dimensions&Se.DimensionFlags.Exterior||this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness)&&(S.y-=this.StyleRecord.Line.Thickness);f=0!=(this.Dimensions&Se.DimensionFlags.Standoff)&&this.CanUseStandOffDimensionLines();const x=this.Dimensions&Se.DimensionFlags.HideHookedObjDimensions;if(!l&&!x&&this instanceof we.Shape.BaseLine&&this.ShortRef!=me.LineTypes.LsMeasuringTape&&this.objecttype===Se.FNObjectTypes.FlWall){var C=ws.GetObjectPtr(ye.opt.linksBlockId,!1);if(C){Ps.FindLink(C,this.BlockID,!0)>=0&&(f=!0)}}l&&(f=!1);const P=f?me.Common.DimDefaultStandoff:me.Common.DimDefaultNonStandoff;if(S.y-=P,m=me.Common.DimDefaultTextGap,this.Dimensions&Se.DimensionFlags.Exterior||this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness&&(m+=this.StyleRecord.Line.Thickness),this instanceof we.Shape.BaseLine&&(!this.polylist||2===this.polylist.segs.length)){var T=Math.floor((c-.01)/(Math.PI/2));b=1==T||2==T}else if(this.polylist&&!this.polylist.closed&&l){var O=[(d=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null))[n-1],d[n]];si.RotatePointsAboutCenter(this.Frame,-c,O),O.push({x:S.x+S.width/2,y:S.y+S.height/2}),O[2].x=O[0].x+(O[1].x-O[0].x)/2,si.RotatePointsAboutCenter(this.Frame,c,O),ve.IsPointInPoly(d,O[2])&&(b=!0)}else this.IsTextFrameOverlap(S,i)&&(b=!0);b&&(S.y+=P,S.y+=S.height,this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness&&(S.y+=2*this.StyleRecord.Line.Thickness),S.y+=P);let v=!1;var w=this.Dimensions&Se.DimensionFlags.Standoff;if(w&&!this.CanUseStandOffDimensionLines()&&(v=!1),l&&(v=!1),v&&(D=(this instanceof we.Shape.PolyLine||this instanceof we.Shape.Polygon)&&this.polylist&&this.polylist.segs&&this.polylist.segs.length>n?this.polylist.segs[n].dimDeflection:this instanceof we.Shape.BaseLine?this.dimensionDeflectionH?this.dimensionDeflectionH:0:Math.abs(i%180)<5?this.dimensionDeflectionH:this.dimensionDeflectionV||0,b?S.y+=D:S.y-=D,this.polylist&&this.polylist.segs&&this.polylist.segs.length>n&&(this.polylist.segs[n].dimTextAltPositioning=b)),this.Frame2Poly(S,s),this.Dimensions&w)y.x=u.x,y.y=u.y>S.y?u.y-m:u.y+m,a.push(new De(y.x,y.y)),y.y=S.y+S.height/2,a.push(new De(y.x,y.y)),y.x=S.x-me.Common.DimDefaultTextGap,a.push(new De(y.x,y.y)),y.x=S.x+S.width+me.Common.DimDefaultTextGap,r.push(new De(y.x,y.y)),y.x=g.x,r.push(new De(y.x,y.y)),y.y=g.y>S.y?g.y-m:g.y+m,r.push(new De(y.x,y.y));else{var k=.5*S.height,L=.5*k;y.x=S.x-L,y.y=S.y+(S.height-k)/2,a.push(new De(y.x,y.y)),y.y+=k,a.push(new De(y.x,y.y)),y.x-=k,y.y=S.y+S.height/2,a.push(new De(y.x,y.y)),a.push(new De(a[0].x,a[0].y)),y.x=S.x+S.width+L,y.y=S.y+(S.height-k)/2,r.push(new De(y.x,y.y)),y.y+=k,r.push(new De(y.x,y.y)),y.x+=k,y.y=S.y+S.height/2,r.push(new De(y.x,y.y)),r.push(new De(r[0].x,r[0].y))}si.RotatePointsAboutCenter(this.Frame,c,s),si.RotatePointsAboutCenter(this.Frame,c,a),si.RotatePointsAboutCenter(this.Frame,c,r)}GetCoordinateTextInfo(t,e,i,o,n,s,a,r,l){var h,c,p,d=[],u={x:0,y:0},g={x:0,y:0},y={x:0,y:0},S={x:0,y:0,width:0,height:0},m=0,b=!1,D=0,f=!1;p=o.GetTextMinDimensions(),S.height=p.height,S.width=p.width,d.push(new De(t.x,t.y)),d.push(new De(e.x,e.y)),h=360-i,c=2*Math.PI*(h/360),si.RotatePointsAboutCenter(this.Frame,-c,d),d[0].x<d[1].x?(u=Oe.DeepCopy(d[0]),g=Oe.DeepCopy(d[1])):(u=Oe.DeepCopy(d[1]),g=Oe.DeepCopy(d[0])),S.x=u.x+(g.x-u.x)/2,S.y=u.y+(g.y-u.y)/2,S.x-=S.width/2,S.y-=S.height/2,S.y-=S.height/2;(this.Dimensions&Se.DimensionFlags.Exterior||this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness)&&(S.y-=this.StyleRecord.Line.Thickness);f=0!=(this.Dimensions&Se.DimensionFlags.Standoff)&&this.CanUseStandOffDimensionLines();const x=this.Dimensions&Se.DimensionFlags.HideHookedObjDimensions;if(!l&&!x&&this instanceof we.Shape.BaseLine&&this.ShortRef!=me.LineTypes.LsMeasuringTape&&this.objecttype===Se.FNObjectTypes.FlWall){var C=ws.GetObjectPtr(ye.opt.linksBlockId,!1);if(C){Ps.FindLink(C,this.BlockID,!0)>=0&&(f=!0)}}l&&(f=!1);const P=f?me.Common.CoordinateLineDefaultStandoff:me.Common.CoordinateLineDefaultNonStandoff;S.y-=P,m=me.Common.CoordinateLineDefaultTextGap;(this.Dimensions&Se.DimensionFlags.Exterior||this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness)&&(m+=this.StyleRecord.Line.Thickness);if(this instanceof we.Shape.BaseLine&&(!this.polylist||2===this.polylist.segs.length)){var T=Math.floor((c-.01)/(Math.PI/2));b=1==T||2==T}else if(this.polylist&&!this.polylist.closed&&l){var O=[(d=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null))[n-1],d[n]];si.RotatePointsAboutCenter(this.Frame,-c,O),O.push({x:S.x+S.width/2,y:S.y+S.height/2}),O[2].x=O[0].x+(O[1].x-O[0].x)/2,si.RotatePointsAboutCenter(this.Frame,c,O),ve.IsPointInPoly(d,O[2])&&(b=!0)}else this.IsTextFrameOverlap(S,i)&&(b=!0);b&&(S.y+=P,S.y+=S.height,this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness&&(S.y+=2*this.StyleRecord.Line.Thickness),S.y+=P);let v=!1;var w=this.Dimensions&Se.DimensionFlags.Standoff;if(w&&!this.CanUseStandOffDimensionLines()&&(v=!1),l&&(v=!1),v&&(D=(this instanceof we.Shape.PolyLine||this instanceof we.Shape.Polygon)&&this.polylist&&this.polylist.segs&&this.polylist.segs.length>n?this.polylist.segs[n].dimDeflection:this instanceof we.Shape.BaseLine?this.dimensionDeflectionH?this.dimensionDeflectionH:0:Math.abs(i%180)<5?this.dimensionDeflectionH:this.dimensionDeflectionV||0,b?S.y+=D:S.y-=D,this.polylist&&this.polylist.segs&&this.polylist.segs.length>n&&(this.polylist.segs[n].dimTextAltPositioning=b)),this.Frame2Poly(S,s),this.Dimensions&w)y.x=u.x,y.y=u.y>S.y?u.y-m:u.y+m,a.push(new De(y.x,y.y)),y.x=S.x-me.Common.CoordinateLineDefaultTextGap,a.push(new De(y.x,y.y)),y.x=S.x+S.width+me.Common.CoordinateLineDefaultTextGap,r.push(new De(y.x,y.y)),y.x=g.x,y.y=g.y>S.y?g.y-m:g.y+m,r.push(new De(y.x,y.y));else{var k=.5*S.height,L=.5*k;y.x=S.x-L,y.y=S.y+(S.height-k)/2,a.push(new De(y.x,y.y)),y.y+=k,a.push(new De(y.x,y.y)),y.x-=k,y.y=S.y+S.height/2,a.push(new De(y.x,y.y)),a.push(new De(a[0].x,a[0].y)),y.x=S.x+S.width+L,y.y=S.y+(S.height-k)/2,r.push(new De(y.x,y.y)),y.y+=k,r.push(new De(y.x,y.y)),y.x+=k,y.y=S.y+S.height/2,r.push(new De(y.x,y.y)),r.push(new De(r[0].x,r[0].y))}si.RotatePointsAboutCenter(this.Frame,c,s),si.RotatePointsAboutCenter(this.Frame,c,a),si.RotatePointsAboutCenter(this.Frame,c,r)}CreateDimensionLineSegment(t,e,i,o){F.Debug("=== wall ========================================================"),F.Debug("=== wall CreateDimensionLineSegment path,points,bounds",e,i,o);for(let n=0;n<i.length;n++)0===n?t.MoveTo(i[n].x,i[n].y):t.LineTo(i[n].x,i[n].y),(i[n].x<o.left||-1===o.left)&&(o.left=i[n].x),i[n].x>o.right&&(o.right=i[n].x),(i[n].y<o.top||-1===o.top)&&(o.top=i[n].y),i[n].y>o.bottom&&(o.bottom=i[n].y)}CreateCoordinateLineSegment(t,e,i,o){F.Debug("=== wall CreateCoordinateLineSegment points/bounds",i,o);for(let n=0;n<i.length;n++)0===n?t.MoveTo(i[n].x,i[n].y):t.LineTo(i[n].x,i[n].y),(i[n].x<o.left||-1===o.left)&&(o.left=i[n].x),i[n].x>o.right&&(o.right=i[n].x),(i[n].y<o.top||-1===o.top)&&(o.top=i[n].y),i[n].y>o.bottom&&(o.bottom=i[n].y)}CreateDimensionLineArrowHead(t,e,i,o,n){F.Debug("= S.BaseDrawObject: CreateDimensionLineArrowHead - Input:",{container:t,polygonCreator:e,arrowPoints:i,bounds:o,userData:n});const s=Oe.DeepCopy(i),a=s.length;for(let h=0;h<a;h++)o.left=Math.min(o.left,s[h].x),o.right=Math.max(o.right,s[h].x),o.top=Math.min(o.top,s[h].y),o.bottom=Math.max(o.bottom,s[h].y);const r=new wi(0,0,0,0);ve.GetPolyRect(r,s);for(let h=0;h<a;h++)s[h].x-=r.x,s[h].y-=r.y;const l=ye.opt.svgDoc.CreateShape(me.CSType.Polygon);l.SetPoints(i),l.SetEventBehavior(me.EventBehavior.All),l.SetID(me.SVGElementClass.DimLine),l.SetPos(0,0),l.SetSize(r.width,r.height),l.SetFillColor("black"),ve.HasFlag(this.Dimensions,Se.DimensionFlags.Select)&&l.ExcludeFromExport(!0),n&&l.SetUserData(n),t.AddElement(l),F.Debug("= S.BaseDrawObject: CreateDimensionLineArrowHead - Output: Polygon shape created",l)}ConvertToNative(t,e){F.Debug("= S.BaseDrawObject: ConvertToNative - Input:",{inputData:t,conversionOptions:e});return F.Debug("= S.BaseDrawObject: ConvertToNative - Output:",null),null}ContainsText(){F.Debug("= S.BaseDrawObject: ContainsText - Input: none");const t=this.DataID>=0;return F.Debug("= S.BaseDrawObject: ContainsText - Output:",t),t}GetToUnits(){F.Debug("= S.BaseDrawObject: GetToUnits - Input: none");const t=ye.docUtil.rulerConfig.major;let e=ye.docUtil.rulerConfig.majorScale/t;return ye.docUtil.rulerConfig.useInches||(e*=ye.docUtil.rulerConfig.metricConv),F.Debug("= S.BaseDrawObject: GetToUnits - Output:",e),e}GetLengthInUnits(t,e=!1){F.Debug("= S.BaseDrawObject: GetLengthInUnits input:",{value:t,round:e});let i=t*this.GetToUnits();if(!e){const t=Math.pow(10,ye.docUtil.rulerConfig.dp);i=Math.round(i*t)/t}return F.Debug("= S.BaseDrawObject: GetLengthInUnits output:",i),i}GetFractionStringGranularity(t){F.Debug("= S.BaseDrawObject: GetFractionStringGranularity input:",{input:t});const e=ye.docUtil.rulerConfig;let i;return i=e.denom>=1?1/e.denom:e.majorScale<=1?1/16:e.majorScale<=2?1/8:e.majorScale<=4?1/4:e.majorScale<=8?.5:1,F.Debug("= S.BaseDrawObject: GetFractionStringGranularity output:",i),i}NumberIsFloat(t){F.Debug("= S.BaseDrawObject: NumberIsFloat input:",t);const e="9".charCodeAt(0),i="0".charCodeAt(0),o=".".charCodeAt(0);for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);if(!(s>=i&&s<=e||s===o))return F.Debug("= S.BaseDrawObject: NumberIsFloat output:",!1),!1}return F.Debug("= S.BaseDrawObject: NumberIsFloat output:",!0),!0}ParseInchesString(t){F.Debug("= S.BaseDrawObject: ParseInchesString input:",t);let e=0;const i=(t=t.trim()).indexOf(" ");if(i>=0){const o=t.substring(0,i),n=t.substring(i+1),s=parseFloat(o);e=isNaN(s)?0:s;const a=n.indexOf("/");if(a>=0){const t=n.substring(0,a),i=n.substring(a+1),o=parseFloat(t),s=parseFloat(i);isNaN(o)||isNaN(s)||0===s||(e+=o/s)}else{const t=parseFloat(n);isNaN(t)||(e+=t)}}else e=parseFloat(t);return F.Debug("= S.BaseDrawObject: ParseInchesString output:",e),e}ConvertToFeet(t){F.Debug("= S.BaseDrawObject: ConvertToFeet - Input:",t);let e=t.trim(),i=e.indexOf("'");i>=0&&i<e.length-1&&" "!==e.charAt(i+1)&&(e=e.substr(0,i+1)+" "+e.substr(i+1));const o=e.split(" ");let n="",s="",a="";o[o.length-1].indexOf("/")>=0?(n=o[o.length-1],o.length>=2&&o[o.length-2].endsWith("'")&&(a=o[o.length-2],s=""),o.length>=3&&(a=o[o.length-3])):2===o.length?(a=o[0],s=o[1]):o[0].endsWith('"')?s=o[0]:a=o[0],a.endsWith("'")&&(a=a.substring(0,a.length-1)),s.endsWith('"')&&(s=s.substring(0,s.length-1)),n.endsWith('"')&&(n=n.substring(0,n.length-1));let r=a.length>0?parseFloat(a):0,l=s.length>0?parseFloat(s):0;if(n.length>0){const t=n.split("/"),e=parseInt(t[0],10),i=parseInt(t[1],10);0!==e&&0!==i&&(l+=e/i)}return l>=12&&0===r?this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.ShowFeetAsInches,!0):r>0&&(this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.ShowFeetAsInches,!1)),r+=l/12,F.Debug("= S.BaseDrawObject: ConvertToFeet - Output:",r),r}UnitsToCoord(t,e){F.Debug("= S.BaseDrawObject: UnitsToCoord - Input:",{value:t,offset:e}),ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const i=this.GetToUnits(),o=(t+=e*ye.docUtil.rulerConfig.majorScale)/i;return F.Debug("= S.BaseDrawObject: UnitsToCoord - Output:",o),o}ConvToUnits(t,e){F.Debug("= S.BaseDrawObject: ConvToUnits input:",{value:t,offset:e}),ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const i=t*this.GetToUnits()-e*ye.docUtil.rulerConfig.majorScale;return F.Debug("= S.BaseDrawObject: ConvToUnits output:",i),i}Frame2Poly(t,e){e.push(new De(t.x,t.y)),e.push(new De(t.x+t.width,t.y)),e.push(new De(t.x+t.width,t.y+t.height)),e.push(new De(t.x,t.y+t.height))}SetBackgroundImageURL(t){}CalcTextPosition(t){F.Debug("= S.BaseDrawObject: CalcTextPosition - Input:",t);const e={x:0,y:0};return F.Debug("= S.BaseDrawObject: CalcTextPosition - Output:",e),e}GetBlobBytes(){F.Debug("= S.BaseDrawObject: GetBlobBytes input: none");let t=null;return this.BlobBytesID>=0&&(t=ws.GetObjectPtr(this.BlobBytesID,!1)),F.Debug("= S.BaseDrawObject: GetBlobBytes output:",t),t}GetEMFBlobBytes(){F.Debug("= S.BaseDrawObject: GetEMFBlobBytes input: EMFBlobBytesID =",this.EMFBlobBytesID);let t=null;return this.EMFBlobBytesID>=0&&(t=ws.GetObjectPtr(this.EMFBlobBytesID,!1)),F.Debug("= S.BaseDrawObject: GetEMFBlobBytes output:",t),t}GetOleBlobBytes(){F.Debug("= S.BaseDrawObject: GetOleBlobBytes input:",{OleBlobBytesID:this.OleBlobBytesID});let t=null;return this.OleBlobBytesID>=0&&(t=ws.GetObjectPtr(this.OleBlobBytesID,!1)),F.Debug("= S.BaseDrawObject: GetOleBlobBytes output:",t),t}GetGraph(t=!1){F.Debug("= S.BaseDrawObject: GetGraph input:",{preserve:t});let e=null;return this.GraphID>=0&&(e=ws.GetObjectPtr(this.GraphID,t)),F.Debug("= S.BaseDrawObject: GetGraph output:",e),e}SetGraph(t){if(F.Debug("= S.BaseDrawObject: SetGraph input:",t),this.GraphID>=0)if(null==t){const t=ye.stdObj.GetObject(this.GraphID);t&&t.Delete(),this.GraphID=-1}else{const e=ye.stdObj.PreserveBlock(this.GraphID);e&&(e.Data=t)}else{const e=ye.stdObj.CreateBlock(Ce.StoredObjectType.GraphObject,t);e&&(this.GraphID=e.ID)}F.Debug("= S.BaseDrawObject: SetGraph output:",this.GraphID)}Flip(t){F.Debug("= S.BaseDrawObject: Flip - Input:",{isHorizontalFlip:t}),F.Debug("= S.BaseDrawObject: Flip - Output: Completed")}NoFlip(){F.Debug("= S.BaseDrawObject: NoFlip - Input: {}");const t=this.hooks.length>0;return F.Debug("= S.BaseDrawObject: NoFlip - Output:",t),t}NoRotate(){F.Debug("= S.BaseDrawObject: NoRotate - Input: none");return F.Debug("= S.BaseDrawObject: NoRotate - Output:",false),false}NoGrow(){F.Debug("= S.BaseDrawObject: NoGrow input: none");const t=(this.colorfilter&Ne.ColorFilters.NCResize)>0;return F.Debug("= S.BaseDrawObject: NoGrow output:",t),t}MaintainPoint(t,e,i,o,n){F.Debug("= S.BaseDrawObject: MaintainPoint - Input:",{currentPoint:t,targetPoint:e,adjustmentX:i,adjustmentY:o,shouldApply:n});return F.Debug("= S.BaseDrawObject: MaintainPoint - Output:",false),false}AllowTextEdit(){return F.Debug("= S.BaseDrawObject: AllowTextEdit - Input:",{TextFlags:this.TextFlags,objecttype:this.objecttype,flags:this.flags,FromEditShapeOutline:this.FromEditShapeOutline}),(this.TextFlags&Se.TextFlags.None)>0?(F.Debug("= S.BaseDrawObject: AllowTextEdit - Output: false (None flag is set)"),!1):this.objecttype===Se.FNObjectTypes.ShapeContainer&&0==(this.TextFlags&Se.TextFlags.AttachA)&&0==(this.TextFlags&Se.TextFlags.AttachB)?(F.Debug("= S.BaseDrawObject: AllowTextEdit - Output: false (Shape container without attach flags)"),!1):this.flags&Se.ObjFlags.Lock?(F.Debug("= S.BaseDrawObject: AllowTextEdit - Output: false (Object is locked)"),!1):this.FromEditShapeOutline?(F.Debug("= S.BaseDrawObject: AllowTextEdit - Output: false (FromEditShapeOutline is true)"),!1):(F.Debug("= S.BaseDrawObject: AllowTextEdit - Output: true (No table present)"),!0)}AllowDoubleClick(){return!1}ChangeBackgroundColor(t,e){F.Debug("= S.BaseDrawObject: ChangeBackgroundColor - Input:",{desiredColor:t,applyImmediately:e});return F.Debug("= S.BaseDrawObject: ChangeBackgroundColor - Output:",false),false}UseEdges(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: UseEdges - Input:",{edgeData:t,threshold:e,isActive:i,radius:o,importance:n,extraParam:s});return F.Debug("= S.BaseDrawObject: UseEdges - Output:",false),false}ApplyStyle(t,e){F.Debug("= S.BaseDrawObject: ApplyStyle - Input:",{style:t,applyTextStyle:e});let i=Oe.DeepCopy(t),o=si.FindStyle(me.Common.TextBlockStyle);if(!(this.colorfilter&Ne.ColorFilters.NCStyle)){let t={Color:i.Text.Paint.Color},n={color:i.Text.Paint.Color};e&&(this.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Shape?(i.Fill=Oe.DeepCopy(this.StyleRecord.Fill),i.Text=Oe.DeepCopy(o.Text),t={Color:o.Text.Paint.Color},n={color:o.Text.Paint.Color}):this.UseTextBlockColor()&&(i.Text=Oe.DeepCopy(o.Text),t={Color:o.Text.Paint.Color},n={color:o.Text.Paint.Color})),this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent&&(i.Fill.Paint.FillType=Se.FillTypes.Transparent,i.Fill.Hatch=0),0===this.StyleRecord.Line.Thickness&&(i.Line.Thickness=0),0===i.Line.LinePattern&&(i.Line.LinePattern=this.StyleRecord.Line.LinePattern),i.Fill.Paint.Opacity=this.StyleRecord.Fill.Paint.Opacity,i.Fill.Paint.EndOpacity=this.StyleRecord.Fill.Paint.EndOpacity,i.Line.Paint.Opacity=this.StyleRecord.Line.Paint.Opacity,i.Line.Paint.EndOpacity=this.StyleRecord.Line.Paint.EndOpacity,i.Text.Paint.Opacity=this.StyleRecord.Text.Paint.Opacity,i.Text.Paint.EndOpacity=this.StyleRecord.Text.Paint.EndOpacity,this.ChangeTextAttributes(n,t),this.StyleRecord=i}F.Debug("= S.BaseDrawObject: ApplyStyle - Output:",{StyleRecord:this.StyleRecord})}GenericIcon(t){F.Debug("= S.BaseDrawObject: GenericIcon - Input:",t);const e=t.svgDoc.CreateShape(me.CSType.Image);return null!=t.userData?e.SetUserData(t.userData):e.SetUserData(me.SVGElementClass.Icon),e.SetSize(t.iconSize,t.iconSize),e.SetPos(t.x,t.y),e.SetURL(t.imageURL),e.SetFillOpacity(1),e.SetStrokeWidth(0),e.SetID(t.iconID),e.SetCursor(t.cursorType),e.ExcludeFromExport(!0),F.Debug("= S.BaseDrawObject: GenericIcon - Output:",e),e}AddIcon(t,e,i){if(F.Debug("= S.BaseDrawObject: AddIcon - Input:",{svgDoc:t,container:e,iconParams:i}),e){const t=this.Frame;i.x=t.width-this.iconShapeRightOffset-this.iconSize-this.nIcons*this.iconSize,i.y=t.height-this.iconShapeBottomOffset-this.iconSize;const o=this.GenericIcon(i);return this.nIcons++,e.AddElement(o),F.Debug("= S.BaseDrawObject: AddIcon - Output:",o),o}return F.Debug("= S.BaseDrawObject: AddIcon - Output: container not provided"),null}GetIconShape(){return this.BlockID}HasIcons(){}AddIcons(t,e){if(F.Debug("= S.BaseDrawObject: AddIcons - Input:",{svgDoc:t,container:e}),e){this.nIcons=0;let i={svgDoc:t,iconSize:this.iconSize,cursorType:ze.CursorType.Pointer};if(this.nIcons=0,!this.bInGroup){if(this.commentId>=0){i.iconID=me.ShapeIconType.Comment,i.imageURL=Constants.FilePath_Icons+Constants.Icon_Comment;const o=this.AddIcon(t,e,i),n=me.SVGElementClass.Icon+"."+this.BlockID;o.SetUserData(n)}if(this.HyperlinkText&&Oe.ResolveHyperlink(this.HyperlinkText)){i.iconID=me.ShapeIconType.HyperLink,i.imageURL=Constants.FilePath_Icons+Constants.Icon_Hyperlink;const o=this.AddIcon(t,e,i);o.SetHyperlinkAttribute(this.HyperlinkText),o.SetTooltip(Oe.ResolveHyperlinkForDisplay(this.HyperlinkText))}if(this.AttachmentInfo&&(i.iconID=me.ShapeIconType.Attachment,i.imageURL="../../../Styles/Img/Icons/attachment_icon.png",this.AddIcon(t,e,i)),this.ExpandedViewID>=0){i.iconID=me.ShapeIconType.ExpandedView,i.imageURL=Constants.FilePath_Icons+Constants.Icon_ExpandedView;this.AddIcon(t,e,i).SetCustomAttribute("_expextendtt_",this.ExpandedViewID)}if(-1!==this.NoteID||on.NoteIsShowing(this.BlockID,null)){let o,n;i.iconID=me.ShapeIconType.Notes,i.imageURL=Constants.FilePath_Icons+Constants.Icon_Note,this.moreflags&me.ObjMoreFlags.UseInfoNoteIcon&&(i.imageURL=Constants.FilePath_Icons+Constants.Icon_Info),o=this.AddIcon(t,e,i),o.SetCustomAttribute("_expnotett_",this.NoteID);const s=this,a=o.DOMElement();Rt(a).hover((function(){n=setTimeout((()=>{ye.opt.bInNoteEdit||ye.opt.ShowNote(s.BlockID,null)}),750)}),(function(){ye.opt.bInNoteEdit||ye.opt.HideNote(s.BlockID,null),clearTimeout(n)}))}}}F.Debug("= S.BaseDrawObject: AddIcons - Output: Completed")}HideAllIcons(t,e){F.Debug("= S.BaseDrawObject: HideAllIcons - Input: svgLayer =",e),this.nIcons=0;const i=e.GetElementById(me.ShapeIconType.HyperLink),o=e.GetElementById(me.ShapeIconType.Notes),n=e.GetElementById(me.ShapeIconType.Comment),s=e.GetElementById(me.ShapeIconType.FieldData);i&&e.RemoveElement(i),o&&e.RemoveElement(o),n&&e.RemoveElement(n),s&&e.RemoveElement(s),F.Debug("= S.BaseDrawObject: HideAllIcons - Output: Icons hidden")}GetHyperlink(t){if(F.Debug("= S.BaseDrawObject: GetHyperlink - Input:",t),t&&"string"==typeof t&&t.split){const e=t.split(".");e[1]&&parseInt(e[1],10)}let e;return e=this.HyperlinkText,F.Debug("= S.BaseDrawObject: GetHyperlink - Output:",e),e}SetCursors(){F.Debug("= S.BaseDrawObject: SetCursors - Input: BlockID =",this.BlockID);const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);let e=!1;if(this.flags&Se.ObjFlags.Lock||!t)this.ClearCursors();else if(Ps.GetEditMode()===Se.EditState.Default){const i=t.GetElementById(me.SVGElementClass.Shape);i&&(this.objecttype===Se.FNObjectTypes.FrameContainer?i.SetCursor(ze.CursorType.Default):i.SetCursor(ze.CursorType.Add));let o=t.GetElementById(me.ShapeIconType.HyperLink);o&&o.SetCursor(ze.CursorType.Pointer),o=t.GetElementById(me.ShapeIconType.Notes),o&&o.SetCursor(ze.CursorType.Pointer),o=t.GetElementById(me.ShapeIconType.ExpandedView),o&&o.SetCursor(ze.CursorType.Pointer),o=t.GetElementById(me.ShapeIconType.Comment),o&&o.SetCursor(ze.CursorType.Pointer),o=t.GetElementById(me.ShapeIconType.Attachment),o&&o.SetCursor(ze.CursorType.Pointer),o=t.GetElementById(me.ShapeIconType.FieldData),o&&o.SetCursor(ze.CursorType.Pointer);const n=t.GetElementById(me.SVGElementClass.Slop);n&&n.SetCursor(ze.CursorType.Add);const s=ye.opt.svgDoc.GetActiveEdit();if(this.DataID&&this.DataID>=0&&t.textElem&&(t.textElem===s?(i&&i.SetCursor(ze.CursorType.Text),t.textElem.SetCursorState(ze.CursorState.EditLink)):t.textElem.SetCursorState(ze.CursorState.LinkOnly)),(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&this.IsSelected()){const o=t.GetElementListWithId(me.SVGElementClass.DimText);for(let t=0;t<o.length;t++)o[t].SetCursorState(ze.CursorState.EditOnly),o[t]===s&&(e=!0);e&&(i&&i.SetCursor(null),n&&n.SetCursor(null))}}else this.ClearCursors();F.Debug("= S.BaseDrawObject: SetCursors - Output: Completed")}ClearCursors(){F.Debug("= S.BaseDrawObject: ClearCursors - Input: {}");const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&(t.ClearAllCursors(),t.textElem&&t.textElem.SetCursorState(ze.CursorState.None)),F.Debug("= S.BaseDrawObject: ClearCursors - Output: Completed")}PostCreateShapeCallback(t,e,i,o){F.Debug("= S.BaseDrawObject PostCreateShapeCallback - Input:",{shape:t,container:e,config:i,additionalInfo:o}),F.Debug("= S.BaseDrawObject PostCreateShapeCallback - Output: completed")}SVGTokenizerHook(t){if(F.Debug("= S.BaseDrawObject: SVGTokenizerHook - Input:",t),ye.opt.bTokenizeStyle){const e=this.colorfilter;if(t=Oe.DeepCopy(t),e===Ne.ColorFilters.NCAll)return F.Debug("= S.BaseDrawObject: SVGTokenizerHook - Output (NCAll):",t),t;e&Ne.ColorFilters.NCFill||(t.Fill.Paint.FillType===Se.FillTypes.Gradient&&(t.Fill.Paint.FillType=Se.FillTypes.Solid),t.Fill.Paint.Color=Basic.Symbol.CreatePlaceholder(Basic.Symbol.Placeholder.FillColor,t.Fill.Paint.Color)),e&Ne.ColorFilters.NCLine||(t.Line.Paint.Color=Basic.Symbol.CreatePlaceholder(Basic.Symbol.Placeholder.LineColor,t.Line.Paint.Color)),e&Ne.ColorFilters.NCLineThick||(t.Line.Thickness=Basic.Symbol.CreatePlaceholder(Basic.Symbol.Placeholder.LineThick,t.Line.Thickness))}return F.Debug("= S.BaseDrawObject: SVGTokenizerHook - Output:",t),t}CancelObjectDraw(){return F.Debug("= S.BaseDrawObject: CancelObjectDraw - Input: {}"),rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer(),F.Debug("= S.BaseDrawObject: CancelObjectDraw - Output: true"),!0}GetAlignRect(){F.Debug("= S.BaseDrawObject: GetAlignRect - Input:",{Frame:this.Frame});const t=Oe.DeepCopy(this.Frame);return F.Debug("= S.BaseDrawObject: GetAlignRect - Output:",{alignRect:t}),t}GetCustomConnectPointsDirection(){return null}GetTextures(t){F.Debug("= S.BaseDrawObject: GetTextures - Input:",{textures:t});const e=Se.FillTypes.Texture;if(this.StyleRecord.Fill.Paint.FillType===e){const e=this.StyleRecord.Fill.Paint.Texture;-1===t.indexOf(e)&&t.push(e)}if(this.StyleRecord.Line.Paint.FillType===e){const e=this.StyleRecord.Line.Paint.Texture;-1===t.indexOf(e)&&t.push(e)}if(this.StyleRecord.Text.Paint.FillType===e){const e=this.StyleRecord.Text.Paint.Texture;-1===t.indexOf(e)&&t.push(e)}F.Debug("= S.BaseDrawObject: GetTextures - Output:",{textures:t})}GetContrastingColorName(t){F.Debug("= S.BaseDrawObject: GetContrastingColorName - Input:",t);const e=this.StyleRecord.Line.Paint.Color,i=(299*parseInt(e.substr(1,2),16)+587*parseInt(e.substr(3,2),16)+114*parseInt(e.substr(5,2),16))/1e3>=128?"black":"white";return F.Debug("= S.BaseDrawObject: GetContrastingColorName - Output:",i),i}SetRuntimeEffects(t){F.Debug("= S.BaseDrawObject: SetRuntimeEffects - Input:",{effectParams:t});const e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);e&&this.ApplyEffects(e,t,!1),F.Debug("= S.BaseDrawObject: SetRuntimeEffects - Output: Completed")}ApplyEffects(t,e,i){}SetEffects(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: SetEffects - Input:",{targetElement:t,flagOverrideGlow:e,isSecondary:i,styleOverride:o,skipOutsideEffects:n,skipInsideEffects:s});const a=this.Frame;let r=[],l=null;if(t){const h=o||this.StyleRecord;if(null!=h){this.dataStyleOverride&&this.dataStyleOverride.glowColor&&(l=this.dataStyleOverride.glowColor);const o=this.CalcEffectSettings(a,h,i);n||(o.outside.type&&(e&&o.outside.type.id===ai.EffectType.GLOW.id?r.push({type:o.outside.type,params:o.outside.settings}):e||r.push({type:o.outside.type,params:o.outside.settings})),e?r.push({type:ai.EffectType.GLOW,params:{color:"#FFD64A",size:4,asSecondary:!0}}):this.collabGlowColor?r.push({type:ai.EffectType.GLOW,params:{color:this.collabGlowColor,size:6,asSecondary:!0}}):l&&r.push({type:ai.EffectType.GLOW,params:{color:l,size:4,asSecondary:!0}})),o.inside.type&&!s&&r.push({type:o.inside.type,params:o.inside.settings}),t.Effects().SetEffects(r,a)}}F.Debug("= S.BaseDrawObject: SetEffects - Output:",{appliedEffects:r,frame:a})}CalcEffectSettings(t,e,i){let o,n,s;F.Debug("= S.BaseDrawObject CalcEffectSettings - Input:",{frame:t,style:e,isSecondary:i});const a=t.width,r=t.height,l={left:0,top:0,right:0,bottom:0},h={};let c=e.Line.Thickness;i&&c<2&&(c=2);let p=a+c,d=r+c;if(o=Math.min(p,d),o=i?c:Math.min(o,50),h.inside={},h.outside={},e.OutsideEffect&&e.OutsideEffect.OutsideType)switch(h.outside.settings={},e.OutsideEffect.OutsideType){case Ne.OutEffect.Drop:l.left=o*e.OutsideEffect.OutsideExtent_Left,l.top=o*e.OutsideEffect.OutsideExtent_Top,l.right=o*e.OutsideEffect.OutsideExtent_Right,l.bottom=o*e.OutsideEffect.OutsideExtent_Bottom,i&&(l.left&&(l.left=Math.min(l.left,2)),l.top&&(l.top=Math.min(l.top,2)),l.right&&(l.right=Math.min(l.right,2)),l.bottom&&(l.bottom=Math.min(l.bottom,2))),h.outside.type=ai.EffectType.DROPSHADOW,h.outside.settings.size=Math.min(Math.max((l.left+l.right)/2,2),50),h.outside.settings.xOff=l.right/2-l.left/2,h.outside.settings.yOff=l.bottom/2-l.top/2,h.outside.settings.color=e.OutsideEffect.Color,h.outside.settings.asSecondary=!0,l.left=Math.max(-h.outside.settings.xOff+h.outside.settings.size,0),l.top=Math.max(-h.outside.settings.yOff+h.outside.settings.size,0),l.right=Math.max(h.outside.settings.xOff+h.outside.settings.size,0),l.bottom=Math.max(h.outside.settings.yOff+h.outside.settings.size,0);break;case Ne.OutEffect.Glow:l.left=l.top=l.right=l.bottom=Math.max(o*e.OutsideEffect.OutsideExtent_Left,2),h.outside.type=ai.EffectType.GLOW,h.outside.settings.size=Math.min(Math.max((l.left+l.right)/2,2),50),h.outside.settings.color=e.OutsideEffect.Color,h.outside.settings.asSecondary=!0,l.left=l.top=l.right=l.bottom=h.outside.settings.size;break;case Ne.OutEffect.Refl:l.left=p*e.OutsideEffect.OutsideExtent_Left,l.right=p*e.OutsideEffect.OutsideExtent_Right,l.bottom=d*e.OutsideEffect.OutsideExtent_Bottom,h.outside.type=ai.EffectType.REFLECT,h.outside.settings.xOff=l.right-l.left,h.outside.settings.yOff=l.bottom,h.outside.settings.asSecondary=!0,n=Di.Effects.CalcSecondaryEffectOffset(h.outside.settings.xOff,h.outside.settings.yOff),l.left=Math.max(-n,0),l.right=Math.max(n,0);break;case Ne.OutEffect.Cast:l.left=p*e.OutsideEffect.OutsideExtent_Left,l.right=p*e.OutsideEffect.OutsideExtent_Right,l.bottom=d*e.OutsideEffect.OutsideExtent_Bottom,h.outside.type=ai.EffectType.CASTSHADOW,h.outside.settings.xOff=l.right-l.left,h.outside.settings.yOff=l.bottom,h.outside.settings.size=Math.min(Math.max(.1*Math.abs(l.bottom),2),25),h.outside.settings.asSecondary=!0,n=Di.Effects.CalcSecondaryEffectOffset(h.outside.settings.xOff,h.outside.settings.yOff),l.left=Math.max(-n+h.outside.settings.size,0),l.right=Math.max(n+h.outside.settings.size,0),l.bottom=Math.max(h.outside.settings.yOff+h.outside.settings.size,0)}if(e.Fill.FillEffect&&!i)switch(o=Math.min(p,d),h.inside.settings={},e.Fill.FillEffect){case Ne.FillEffect.Gloss:if(h.inside.type=ai.EffectType.GLOSS,h.inside.settings.size=Math.min(p,d),h.inside.settings.type=Di.Effects.GlossType.Soft,h.inside.settings.dir=Di.Effects.FilterDirection.TOP,h.inside.settings.color=e.Fill.EffectColor,e.Fill.LParam)switch(e.Fill.LParam){case 1:h.inside.settings.dir=Di.Effects.FilterDirection.LEFTTOP;break;case 2:h.inside.settings.dir=Di.Effects.FilterDirection.RIGHTTOP;break;case 3:h.inside.settings.dir=Di.Effects.FilterDirection.CENTER}e.Fill.WParam&&(h.inside.settings.type=Di.Effects.GlossType.Hard);break;case Ne.FillEffect.Bevel:if(o=Math.max(Math.min(o,50)/10,2),h.inside.type=ai.EffectType.BEVEL,h.inside.settings.size=o,h.inside.settings.type=Di.Effects.BevelType.SOFT,h.inside.settings.dir=Di.Effects.FilterDirection.LEFTTOP,void 0!==e.Fill.WParam)switch(e.Fill.WParam){case 0:h.inside.settings.type=Di.Effects.BevelType.HARD;break;case 1:h.inside.settings.type=Di.Effects.BevelType.SOFT;break;case 2:h.inside.settings.type=Di.Effects.BevelType.BUMP}switch(e.Fill.LParam){case 0:h.inside.settings.dir=Di.Effects.FilterDirection.LEFT;break;case 1:h.inside.settings.dir=Di.Effects.FilterDirection.LEFTTOP;break;case 2:h.inside.settings.dir=Di.Effects.FilterDirection.TOP;break;case 3:h.inside.settings.dir=Di.Effects.FilterDirection.RIGHTTOP;break;case 4:h.inside.settings.dir=Di.Effects.FilterDirection.RIGHT;break;case 5:h.inside.settings.dir=Di.Effects.FilterDirection.RIGHTBOTTOM;break;case 6:h.inside.settings.dir=Di.Effects.FilterDirection.BOTTOM;break;case 7:h.inside.settings.dir=Di.Effects.FilterDirection.LEFTBOTTOM;break;case 8:h.inside.settings.dir=Di.Effects.FilterDirection.CENTER}break;case Ne.FillEffect.InShadow:o=Math.min(o,50)/2,e.Fill.WParam?(s=e.Fill.WParam,(s<0||s>100)&&(s=20),o=o*s/100):o/=5,h.inside.type=Si.EffectType.INNERSHADOW,h.inside.settings.size=o,h.inside.settings.dir=Di.Effects.FilterDirection.LEFTTOP;break;case Ne.FillEffect.InGlow:o=Math.min(o,50)/2,e.Fill.WParam?(s=e.Fill.WParam,(s<0||s>100)&&(s=20),o=o*s/100):o/=5,h.inside.type=Si.EffectType.INNERGLOW,h.inside.settings.size=o,h.inside.settings.color=e.Fill.EffectColor}return h.extent=l,F.Debug("= S.BaseDrawObject CalcEffectSettings - Output:",h),h}CreateGradientRecord(t,e,i,o,n){F.Debug("= S.BaseDrawObject: CreateGradientRecord - Input:",{flags:t,color1:e,opacity1:i,color2:o,opacity2:n});let s={type:ai.GradientStyle.Linear,startPos:ai.GradientPos.LeftTop,stops:[]},a={color:e,opacity:i},r={color:o,opacity:n};return t&Ae.GradientStyle.GradRev&&(a={color:o,opacity:n},r={color:e,opacity:i}),t&Ae.GradientStyle.GradMiddle?(s.stops.push({offset:0,color:a.color,opacity:a.opacity}),s.stops.push({offset:50,color:r.color,opacity:r.opacity}),s.stops.push({offset:100,color:a.color,opacity:a.opacity})):(s.stops.push({offset:0,color:a.color,opacity:a.opacity}),s.stops.push({offset:100,color:r.color,opacity:r.opacity})),t&Ae.GradientStyle.GradRadial?(s.type=ai.GradientStyle.Radial,s.startPos=ai.GradientPos.Center):t&Ae.GradientStyle.GradShape?(s.type=ai.GradientStyle.Radialfill,s.startPos=ai.GradientPos.Center):(s.type=ai.GradientStyle.Linear,t&Ae.GradientStyle.GradTlbr?s.startPos=ai.GradientPos.LeftTop:t&Ae.GradientStyle.GradTrbl?s.startPos=ai.GradientPos.RightTop:t&Ae.GradientStyle.GradVert?s.startPos=ai.GradientPos.Top:t&Ae.GradientStyle.GradHoriz?s.startPos=ai.GradientPos.Left:s.startPos=ai.GradientPos.LeftTop),F.Debug("= S.BaseDrawObject: CreateGradientRecord - Output:",s),s}CreateRichGradientRecord(t){if(F.Debug("= S.BaseDrawObject: CreateRichGradientRecord - Input:",{index:t}),t<0||t>=ye.opt.richGradients.length)return F.Debug("= S.BaseDrawObject: CreateRichGradientRecord - Output:",null,"(Invalid index)"),null;const e=ye.opt.richGradients[t];let i={type:ai.GradientStyle.Linear,startPos:ai.GradientPos.LeftTop,stops:[]};switch(e.gradienttype){case Ne.RichGradientTypes.Linear:i.type=ai.GradientStyle.Linear,i.angle=e.angle;break;case Ne.RichGradientTypes.BR:case Ne.RichGradientTypes.RectBR:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.RightBottom;break;case Ne.RichGradientTypes.BL:case Ne.RichGradientTypes.RectBL:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.LeftBottom;break;case Ne.RichGradientTypes.RadialCenter:case Ne.RichGradientTypes.RectCenter:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.Center;break;case Ne.RichGradientTypes.RadialTR:case Ne.RichGradientTypes.RectTR:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.RightTop;break;case Ne.RichGradientTypes.RadialTL:case Ne.RichGradientTypes.RectTL:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.LeftTop;break;case Ne.RichGradientTypes.RadialBC:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.Bottom;break;case Ne.RichGradientTypes.RadialTC:i.type=ai.GradientStyle.Radial,i.startPos=ai.GradientPos.Top;break;case Ne.RichGradientTypes.Shape:i.type=ai.GradientStyle.Radialfill,i.startPos=ai.GradientPos.Center}for(let o=0;o<e.stops.length;o++){const t=e.stops[o];i.stops.push({color:t.color,opacity:t.opacity,offset:t.stop})}return F.Debug("= S.BaseDrawObject: CreateRichGradientRecord - Output:",i),i}CalcLineHops(t){}AddHopPoint(t,e,i,o,n,s){F.Debug("= S.BaseDrawObject: AddHopPoint input:",{pointA:t,pointB:e,hopIndex:i,radius:o,angle:n,flag:s});const a={bSuccess:!1,tindex:-1};return F.Debug("= S.BaseDrawObject: AddHopPoint output:",a),a}ResetAutoScrollTimer(){F.Debug("= S.BaseDrawObject: ResetAutoScrollTimer - Input: {}"),-1!==ye.opt.autoScrollTimerId?(ye.opt.autoScrollTimer.clearTimeout(ye.opt.autoScrollTimerId),ye.opt.autoScrollTimer.obj=ye.opt,ye.opt.autoScrollTimerId=-1,F.Debug("= S.BaseDrawObject: ResetAutoScrollTimer - Output: Timer has been reset")):F.Debug("= S.BaseDrawObject: ResetAutoScrollTimer - Output: No active timer to reset")}GetActionButtons(){return null}GetArrowheadSelection(t){F.Debug("= S.BaseDrawObject: GetArrowheadSelection - Input:",{selection:t});return F.Debug("= S.BaseDrawObject: GetArrowheadSelection - Output:",false),false}SetRolloverActions(t,e){if(F.Debug("= S.BaseDrawObject SetRolloverActions - Input:",{rolloverElement:t,eventObj:e}),-1!==ye.opt.curHiliteShape&&ye.opt.curHiliteShape!==this.BlockID){const t=ws.GetObjectPtr(ye.opt.curHiliteShape,!1);t&&(F.Debug("= S.BaseDrawObject SetRolloverActions - Clearing previous shape:",ye.opt.curHiliteShape),t.SetRuntimeEffects(!1),t.ClearCursors())}this.SetRuntimeEffects(!0),this.SetCursors(),ye.opt.curHiliteShape=this.BlockID;const i=this;e.svgObj.mouseout((function(){F.Debug("= S.BaseDrawObject SetRolloverActions - MouseOut Triggered for BlockID:",i.BlockID),i.SetRuntimeEffects(!1),i.ClearCursors(),ye.opt.curHiliteShape===i.BlockID&&(ye.opt.curHiliteShape=-1),F.Debug("= S.BaseDrawObject SetRolloverActions - MouseOut Completed for BlockID:",i.BlockID)})),F.Debug("= S.BaseDrawObject SetRolloverActions - Output: Completed setup for BlockID",this.BlockID)}CalcCursorForAngle(t,e){F.Debug("= S.BaseDrawObject: CalcCursorForAngle - Input:",{angle:t,swap:e}),t=10*Math.round(t/10);let i=ze.CursorType.ResizeLR;if(t>0&&t<90||t>180&&t<270?i=ze.CursorType.NwseResize:t>90&&t<180||t>270&&t<360?i=ze.CursorType.NeswResize:90!==t&&270!==t||(i=ze.CursorType.ResizeTB),e)switch(i){case ze.CursorType.ResizeLR:i=ze.CursorType.ResizeTB;break;case ze.CursorType.ResizeTB:i=ze.CursorType.ResizeLR;break;case ze.CursorType.NwseResize:i=ze.CursorType.NeswResize;break;case ze.CursorType.NeswResize:i=ze.CursorType.NwseResize}return F.Debug("= S.BaseDrawObject: CalcCursorForAngle - Output:",i),i}FoundText(t,e,i){if(F.Debug("= S.BaseDrawObject FoundText - Input:",{searchText:t,selectionLength:e,targetBlockId:i}),this.BlockID===i)return F.Debug("= S.BaseDrawObject FoundText - Output:",!1,"Same BlockID"),!1;let o=!1;if(this.DataID>=0){const i=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(i){const n=i.textElem;if(n){const s=n.GetText(0).search(t);s>=0&&(on.ActivateTextEdit(i),n.SetSelectedRange(s,s+e),o=!0)}}}return F.Debug("= S.BaseDrawObject FoundText - Output:",o),o}MoveBehindAllLinked(){F.Debug("= S.BaseDrawObject MoveBehindAllLinked - Input: {}");let t=!1,e=vs.FrontMostLayerZListPreserve(),i=this.BlockID,o=Rt.inArray(i,e),n=ws.GetObjectPtr(ye.opt.linksBlockId,!0);if(n){let s=Ps.FindLink(n,i,!0);for(;s>=0&&s<n.length&&n[s].targetid===i;){let a=n[s].hookid,r=Rt.inArray(a,e);o>r&&(e[r]=i,e[o]=a,o=r,t=!0),s++}}return F.Debug("= S.BaseDrawObject MoveBehindAllLinked - Output: { hasMoved: "+t+" }"),t}HookedObjectMoving(t){F.Debug("= S.BaseDrawObject HookedObjectMoving - Input:",{event:t});return F.Debug("= S.BaseDrawObject HookedObjectMoving - Output:",false),false}CustomSnap(t,e,i,o,n){F.Debug("= S.BaseDrawObject CustomSnap - Input:",{snapTarget:t,snapOptions:e,tolerance:i,additionalData:o,flag:n});return F.Debug("= S.BaseDrawObject CustomSnap - Output:",false),false}GetSnapRect(){F.Debug("= S.BaseDrawObject GetSnapRect - Input:",{frame:this.Frame});const t={};return ve.CopyRect(t,this.Frame),F.Debug("= S.BaseDrawObject GetSnapRect - Output:",t),t}CanSnapToShapes(){F.Debug("= S.BaseDrawObject CanSnapToShapes - Input: {}");return F.Debug("= S.BaseDrawObject CanSnapToShapes - Output:",-1),-1}IsSnapTarget(){F.Debug("= S.BaseDrawObject IsSnapTarget - Input:",{});return F.Debug("= S.BaseDrawObject IsSnapTarget - Output:",false),false}GuideDistanceOnly(){F.Debug("= S.BaseDrawObject GuideDistanceOnly - Input:",{});return F.Debug("= S.BaseDrawObject GuideDistanceOnly - Output:",false),false}ActionApplySnaps(t,e){F.Debug("= S.BaseDrawObject ActionApplySnaps - Input:",{snapTarget:t,snapOptions:e});return F.Debug("= S.BaseDrawObject ActionApplySnaps - Output:",null),null}GetNotePos(t,e){F.Debug("= S.BaseDrawObject GetNotePos - Input:",{source:t,container:e});let i=Oe.DeepCopy(t.Frame);e&&(i.x+=e.frame.x,i.y+=e.frame.y,i.width=e.frame.width-5,i.height=e.frame.height-6);const o=i.width,n=i.height,s={x:i.x+o,y:i.y+n+t.StyleRecord.Line.Thickness/2+1};return F.Debug("= S.BaseDrawObject GetNotePos - Output:",s),s}RefreshFromRuleChange(t,e){F.Debug("= S.BaseDrawObject RefreshFromRuleChange - Input:",{fieldDataTableID:t,fieldDataElementID:e}),this.HasFieldDataRecord(t,e,!0)?(this.GetFieldDataStyleOverride(),ws.AddToDirtyList(this.BlockID),F.Debug("= S.BaseDrawObject RefreshFromRuleChange - Output: Rule change refreshed",{BlockID:this.BlockID})):F.Debug("= S.BaseDrawObject RefreshFromRuleChange - Output: No matching field data record",{fieldDataTableID:t,fieldDataElementID:e})}IsShapeContainer(t){F.Debug("= S.BaseDrawObject IsShapeContainer - Input:",t);return F.Debug("= S.BaseDrawObject IsShapeContainer - Output:",false),false}HasFieldData(){}HasFieldDataForTable(t){}HasFieldDataInText(t){}SetFieldDataRecord(t,e,i){}NewFieldDataRecord(t){}HasFieldDataRecord(t,e,i){}ChangeFieldDataTable(t){}RemoveFieldData(t,e){}GetFieldDataTable(){}GetFieldDataRecord(){}HasFieldDataRules(t){}GetFieldDataStyleOverride(){if(F.Debug("= S.BaseDrawObject: GetFieldDataStyleOverride input"),this.HasFieldData()&&this.fieldDataElemID>=0?this.dataStyleOverride=TODO.STData.FieldedDataProcessRulesForRecord(this.fieldDataTableID,this.fieldDataElemID):this.dataStyleOverride=null,this.bInGroup){const t=ye.opt.FindParentGroup(this.BlockID);if(t){const e=t.GetFieldDataStyleOverride();if(e){const t=Oe.DeepCopy(e);t.glowColor=null,t.iconID=null,this.dataStyleOverride?this.dataStyleOverride=Rt.extend(!0,{},t,this.dataStyleOverride):this.dataStyleOverride=t}}}return F.Debug("= S.BaseDrawObject: GetFieldDataStyleOverride output:",this.dataStyleOverride),this.dataStyleOverride}RefreshFromFieldData(t){}RefreshFromRuleChange(t,e){}RemapDataFields(t){}RegisterForDataDrop(t){}GetFieldDataStyleOverride(){}SetBlobBytes(t,e){var i=new ln(e,t);if(this.BlobBytesID>=0){var o=ye.stdObj.PreserveBlock(this.BlobBytesID);o&&(o.Data=i)}else{var n=ye.stdObj.CreateBlock(Ce.StoredObjectType.BlobBytesObject,i);n&&(this.BlobBytesID=n.ID)}}}pn([jt((()=>ni))],dn.prototype,"StyleRecord",2),pn([jt((()=>De))],dn.prototype,"prevBBox",2),pn([jt((()=>De))],dn.prototype,"StartPoint",2),pn([jt((()=>De))],dn.prototype,"EndPoint",2),pn([jt((()=>vi))],dn.prototype,"polylist",2);const un=class{constructor(t){a(this,"context"),this.context=t||window}setInterval(t,e){const i=un.getNewTimerId();if(un.timerRegistry[i]={},"string"==typeof t){const o=t;un.timerRegistry[i].timer=window.setInterval((()=>{this.context&&this.context[o]&&this.context[o]()}),e)}else un.timerRegistry[i].timer=window.setInterval((()=>{t.call(this.context)}),e);return i}setTimeout(t,e,...i){const o=un.getNewTimerId();if(un.timerRegistry[o]={},"string"==typeof t){const n=t;un.timerRegistry[o].timer=window.setTimeout((()=>{this.context&&this.context[n]&&this.context[n](...i),un.timerRegistry[o]=null}),e)}else un.timerRegistry[o].timer=window.setTimeout((()=>{t.call(this.context,...i),un.timerRegistry[o]=null}),e);return o}clearInterval(t){un.timerRegistry[t]&&(window.clearInterval(un.timerRegistry[t].timer),un.timerRegistry[t]=null)}clearTimeout(t){un.timerRegistry[t]&&(window.clearTimeout(un.timerRegistry[t].timer),un.timerRegistry[t]=null)}static getNewTimerId(){let t=0;for(;un.timerRegistry[t];)t++;return t}};let gn=un;a(gn,"timerRegistry",[]);class yn{static ClearAllActionArrowTimers(){F.Debug("O.Opt ClearAllActionArrowTimers: input");const t=vs.VisibleZList();for(let e=0;e<t.length;e++){const i=ws.GetObjectPtr(t[e],!1);i&&-1!==i.actionArrowHideTimerID&&(ye.opt.actionArrowHideTimer.clearTimeout(i.actionArrowHideTimerID),i.actionArrowHideTimerID=-1)}F.Debug("O.Opt ClearAllActionArrowTimers: output")}static RemoveAllActionArrows(){F.Debug("O.Opt RemoveAllActionArrows - Input: no parameters");const t=vs.VisibleZList();for(let e=0;e<t.length;e++)this.RemoveActionArrows(t[e],!0);F.Debug("O.Opt RemoveAllActionArrows - Output: Removed arrows from",t.length,"objects")}static ClearActionArrowTimer(t){if(F.Debug("O.Opt ClearActionArrowTimer - Input:",t),t>=0){const e=ws.GetObjectPtr(t,!1);e?e.actionArrowHideTimerID>=0?(ye.opt.actionArrowHideTimer.clearTimeout(e.actionArrowHideTimerID),e.actionArrowHideTimerID=-1,F.Debug("O.Opt ClearActionArrowTimer - Timer cleared for object",t)):F.Debug("O.Opt ClearActionArrowTimer - No active timer for object",t):F.Debug("O.Opt ClearActionArrowTimer - No target object found for id",t)}else F.Debug("O.Opt ClearActionArrowTimer - Invalid objectId:",t);F.Debug("O.Opt ClearActionArrowTimer - Output: Completed")}static RemoveActionArrows(t,e){F.Debug("O.Opt RemoveActionArrows - Input:",{objectId:t,clearTimer:e});const i="actionArrow"+t;if(e)this.ClearActionArrowTimer(t);else{const e=ws.GetObjectPtr(t,!1);e&&(e.actionArrowHideTimerID=-1)}ye.opt.fromOverlayLayer?setTimeout((()=>{this.SetActionArrowTimer(t)}),0):Os.ClearOverlayElementsByID(i),F.Debug("O.Opt RemoveActionArrows - Output: Completed")}static SetActionArrowTimer(t){if(F.Debug("O.Opt SetActionArrowTimer - Input:",t),t>=0){const e=ws.GetObjectPtr(t,!1);e?(this.ClearActionArrowTimer(t),e.actionArrowHideTimerID=ye.opt.actionArrowHideTimer.setTimeout("RemoveActionArrows",500,t),F.Debug("O.Opt SetActionArrowTimer - Timer set for object",t)):F.Debug("O.Opt SetActionArrowTimer - No target object found for id",t)}else F.Debug("O.Opt SetActionArrowTimer - Invalid objectId:",t);F.Debug("O.Opt SetActionArrowTimer - Output: Completed")}}const Sn=t=>({value:t}),mn=Sn({isShow:!1,from:"",type:""}),bn=Sn(!1),Dn=Sn(!1),fn=Sn(""),xn=Sn(!1),Cn=Sn([0,0]),Pn=Sn(!1),Tn=Sn(null),On=Sn({...Mo[0],type:"default"}),vn=["Duct","Wall","Int_Ext_Wall"];const wn=Sn(!1),kn=Sn(!1),Ln=Sn("Auto"),An=Sn("Off"),In=Sn(!1),En=Sn(!1),Fn=Sn(!1),Gn=Sn(!1),Rn=Sn(0),jn=Sn({active:!1,data:{settings:null==(e=Mo.find((t=>"Gauge"===t.name)))?void 0:e.settings}}),Bn=Sn(0),Mn=Sn({x:0,y:0}),Hn=Sn(null),_n=Sn({addedCount:0,active:!1,uploadBtnLoading:!1,data:null}),Un=Sn(!1),Nn=Sn(1),Vn=Sn(!1),zn=Sn(!1),Wn=Sn(!0),Kn=Sn(!0),Yn=Sn(!0);class Xn{constructor(t,e,i,o,n={}){a(this,"type"),a(this,"message"),a(this,"isShow"),a(this,"msgType"),a(this,"extral"),this.type=t||"info",this.message=e||"",this.isShow=i||!1,this.msgType=o||"",this.extral=n||{}}}const qn=class{static setDependencies(t,e,i){qn.webClient=t,qn.deviceOpt=e,qn.wsClient=i}static getLinkedEntries(){return 0===po.value.items.length?[]:po.value.items.filter((t=>t.t3Entry))}static refreshMoveableGuides(){po.value.elementGuidelines=[];const t=document.querySelectorAll(`.moveable-item-wrapper:not(moveable-item-index-${po.value.activeItemIndex}) .moveable-item`);Array.from(t).forEach((function(t){po.value.elementGuidelines.push(t)}))}static getEntryRange(t){if(null==t?void 0:t.range){const e=t.type.toLowerCase();let i=t.digital_analog?ho.analog[e].find((e=>e.id===t.range)):ho.digital.find((e=>e.id===t.range));if(!i){const e=vo.value.panelsRanges.filter((e=>e.pid===t.pid));i=t.digital_analog?e.find((e=>"analog"===e.type&&e.index===t.range)):e.find((e=>"digital"===e.type&&e.index===t.range)),!i&&t.range>100&&(i=e.find((e=>"MSV"===e.type&&e.index===t.range)))}if(i)return i}return{label:"Unused",unit:""}}static getObjectActiveValue(t){var e,i,o,n;let s=!1;if(!t.t3Entry||void 0===(null==(e=t.settings)?void 0:e.active))return!1;if("OUTPUT"===t.t3Entry.type&&1===t.t3Entry.hw_switch_status)s=!!t.t3Entry.hw_switch_status;else if(t.t3Entry.range){const e=t.t3Entry.digital_analog,a=qn.getEntryRange(t.t3Entry);a&&(s=!!(!e&&(1===(null==(i=t.t3Entry)?void 0:i.control)&&!a.direct||0===(null==(o=t.t3Entry)?void 0:o.control)&&a.direct)||e&&(null==(n=t.t3Entry)?void 0:n.value)>0))}else"PROGRAM"===t.t3Entry.type?s=!!t.t3Entry.status:"SCHEDULE"===t.t3Entry.type?s=!!t.t3Entry.output:"HOLIDAY"===t.t3Entry.type&&(s=!!t.t3Entry.value);return s}static refreshLinkedEntries(t){t.find((t=>"TRL11111"===t.label)),po.value.items.filter((t=>{var e;return null==(e=t.t3Entry)?void 0:e.type})).forEach(((e,i)=>{const o=t.find((t=>t.index===e.t3Entry.index&&t.type===e.t3Entry.type&&t.pid===e.t3Entry.pid));if(o&&o.id){o.value;let t=o.value>=1e3?o.value/1e3:o.value;o.value=t,e.t3Entry=o,qn.refreshObjectStatus(e)}}))}static refreshLinkedEntries2(t){uo.value.items.filter((t=>{var e;return null==(e=t.t3Entry)?void 0:e.type})).forEach((e=>{const i=t.find((t=>t.index===e.t3Entry.index&&t.type===e.t3Entry.type&&t.pid===e.t3Entry.pid));if(i&&i.id){let t=i.value>=1e3?i.value/1e3:i.value;i.value=t,e.t3Entry=i,qn.refreshObjectStatus(e)}}))}static refreshObjectStatus(t){var e,i;t.t3Entry&&void 0!==(null==(e=t.settings)?void 0:e.active)&&(t.settings.active=qn.getObjectActiveValue(t)),t.t3Entry&&void 0!==t.t3Entry.decom&&void 0!==(null==(i=t.settings)?void 0:i.inAlarm)&&(t.settings.inAlarm=!!t.t3Entry.decom)}static saveLib(){const t=Do.value.images.filter((t=>!t.online)),e=Do.value.objLib.filter((t=>!t.online));if(fo.value)qn.webClient.SaveLibraryData(null,null,{...Do.value,images:t,objLib:e});else{const i=qn.deviceOpt.getCurrentDevice(),o=null==i?void 0:i.panelId,n=null==i?void 0:i.graphicId;qn.wsClient.SaveLibraryData(o,n,{...Do.value,images:t,objLib:e})}}static saveNewLib(){const t=Do.value.images.filter((t=>!t.online)),e=Do.value.objLib.filter((t=>!t.online));if(fo.value)qn.webClient.SaveNewLibraryData(null,null,{...Do.value,images:t,objLib:e});else{const i=qn.deviceOpt.getCurrentDevice(),o=null==i?void 0:i.panelId,n=null==i?void 0:i.graphicId;qn.wsClient.SaveNewLibraryData(o,n,{...Do.value,images:t,objLib:e})}}static saveGraphicData(t,e){var i,o,n;if(!0===(null==(i=t.data)?void 0:i.status)){if(!Io.value)return;F.Debug("= IdxUtils Saved successfully."),null==(o=qn.deviceOpt)||o.refreshCurrentDevice(),null==(n=qn.deviceOpt)||n.refreshCurrentDeviceCount()}else e.notify({message:"Error, not saved!",color:"negative",icon:"error",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]})}static getUnitText(t){var e;const i=qn.getEntryRange(t);let o="";if(t.range>100){const n=null==(e=i.options)?void 0:e.find((e=>e.value===t.value));o=(null==n?void 0:n.name)||""}else 1===t.digital_analog?o=(null==i?void 0:i.unit)||"":0===t.digital_analog&&(o=t.control?(null==i?void 0:i.on)||"":(null==i?void 0:i.off)||"");return o}};let Jn=qn;a(Jn,"webClient"),a(Jn,"deviceOpt"),a(Jn,"wsClient");class $n{constructor(){a(this,"$q")}initQuasar(t){this.$q=t}setGlobalMsg(t,e,i,o,n){const s=Ro.value.findIndex((t=>t.msgType===o));if(-1!==s)Ro.value[s].type=t,Ro.value[s].message=e,Ro.value[s].isShow=i,Ro.value[s].msgType=o,Ro.value[s].extral=n||{};else{const s=new Xn;s.type=t||"info",s.message=e||"",s.isShow=i||!1,s.msgType=o||"",s.extral=n||{},Ro.value.push(s)}F.Debug("= U.QuasarUtil setGlobalMsg",{...Ro.value})}clearGlobalMsg(t){Ro.value=Ro.value.filter((e=>e.msgType!==t)),F.Debug("= U.QuasarUtil clearGlobalMsg",{...Ro.value})}clearAllGlobalMsg(){Ro.value=[]}ShowLOAD_GRAPHIC_ENTRY_RESSuccess(){F.Debug("= U.QuasarUtil Graphic loaded successfully")}ShowGET_INITIAL_DATA_RESSuccess(){F.Debug("= U.QuasarUtil Initial data loaded successfully")}ShowWebSocketError(t){this.$q.notify({message:t,color:"negative",icon:"error",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]})}setLocalSettings(t,e){jo.value[t]=e,localStorage.setItem("localSettings",JSON.stringify(jo.value))}getLocalSettings(t){const e=localStorage.getItem("localSettings");if(e)return JSON.parse(e)[t]}static ShowContextMenu(t,e,i){F.Debug("= u.QuasarUtil ShowContextMenu/","isShow,from,type,rClickParam=>",t,e,i,ye.opt.rClickParam),mn.value={isShow:t,from:e,type:i},bn.value=!1}static ShowObjectConfig(t){F.Debug("= U.QuasarUtil ShowObjectConfig","show=>",t),bn.value=t}static UpdateCurrentObjectPos(t){var e,i;if(t){const o=null!=(i=null==(e=null==uo?void 0:uo.value)?void 0:e.activeItemIndex)?i:"-1";if("-1"!==o){let e=uo.value.items[o];void 0!==e&&null!=e&&(uo.value.items[o].translate=[t.x,t.y],uo.value.items[o].width=t.width,uo.value.items[o].height=t.height,uo.value.items[o].rotate=t.rotate)}}}static LinkT3EntryDialogActionV2(){var t,e;F.Debug("= U.QuasarUtil P.IDX2 linkT3EntryDialogAction","open linkT3EntryDialog V2"),Ao.value.active=!0,(null==(t=uo.value.items[uo.value.activeItemIndex])?void 0:t.t3Entry)&&(Ao.value.data=h.exports.cloneDeep(null==(e=uo.value.items[uo.value.activeItemIndex])?void 0:e.t3Entry))}static LinkT3EntrySaveV2(){F.Debug("= U.QuasarUtil Idx linkT3EntrySave linkT3EntryDialog.value.data=",Ao.value.data),uo.value.items[uo.value.activeItemIndex].settings.t3EntryDisplayField||(void 0===uo.value.items[uo.value.activeItemIndex].label?uo.value.items[uo.value.activeItemIndex].settings.t3EntryDisplayField="description":uo.value.items[uo.value.activeItemIndex].settings.t3EntryDisplayField="label");if(void 0!==Ao.value.data.value&&null!==Ao.value.data.value&&Ao.value.data.value>=1e3&&(Ao.value.data.value=Ao.value.data.value/1e3),uo.value.items[uo.value.activeItemIndex].t3Entry=h.exports.cloneDeep(Ao.value.data),"Icon"===uo.value.items[uo.value.activeItemIndex].type){let t="fa-solid fa-camera-retro";"GRP"===Ao.value.data.type?t="fa-solid fa-camera-retro":"SCHEDULE"===Ao.value.data.type?t="schedule":"PROGRAM"===Ao.value.data.type?t="fa-solid fa-laptop-code":"HOLIDAY"===Ao.value.data.type&&(t="calendar_month"),uo.value.items[uo.value.activeItemIndex].settings.icon=t}Jn.refreshObjectStatus(uo.value.items[uo.value.activeItemIndex]),Ao.value.data=null,Ao.value.active=!1,_o.SaveAppStateV2(),Os.RenderAllSVGObjects(),F.Debug("= U.QuasarUtil P.IDX2 linkT3EntryDialogAction","close linkT3EntryDialog V2",uo.value)}static AddCurrentObjectToAppState(){let t=Qo.GetTargetSelect();var e=ws.GetObjectPtr(t,!1);F.Debug("= U.QuasarUtil AddCurrentObjectToAppState targetObject:",e);var i={x:e.Frame.x,y:e.Frame.y,width:e.Frame.width,height:e.Frame.height},o=e.uniqueId,n=e.uniType;F.Debug("= U.QuasarUtil AddCurrentObjectToAppState uniqueId:|uniType:",i,o,n);const s=Mo.find((t=>t.name===n));this.AddToAppStateV2(i,s,o),this.SetAppStateV2SelectIndex(s),_o.SaveAppStateV2()}static AddToAppStateV2(t,e,i){const o={width:t.width,height:t.height},n={clientX:t.x,clientY:t.y,top:t.x,left:t.y},s=this.drawObject(o,n,e,i);F.Debug("= U.QuasarUtil AddToAppStateV2",s,uo.value)}static drawObject(t,e,i,o){var n;const s=h.exports.cloneDeep(null==(n=Mo.find((t=>t.name===(null==i?void 0:i.name))))?void 0:n.settings)||{},a=Object.keys(s).reduce(((t,e)=>(t[e]=s[e].value,t)),{}),r={title:null,active:!1,type:null==i?void 0:i.name,translate:[e.clientX,e.clientY],width:t.width,height:t.height,rotate:0,scaleX:1,scaleY:1,settings:a,zindex:1,t3Entry:null,showDimensions:!0};return this.addObject(r,o)}static addObject(t,e,i,o=!0){return uo.value.itemsCount++,t.id=uo.value.itemsCount,t.uniqueId=e,t.group=i,t.settings.titleColor=t.settings.titleColor||"inherit",t.settings.bgColor=t.settings.bgColor||"inherit",t.settings.textColor=t.settings.textColor||"inherit",t.settings.fontSize=t.settings.fontSize||13,uo.value.items.push(t),uo.value.elementGuidelines=[],t}static SetAppStateV2SelectIndex(t){var e,i;let o="";if(t)o=null!=(e=null==t?void 0:t.name)?e:"";else{let t=Qo.GetTargetSelect();var n=ws.GetObjectPtr(t,!1);n&&(o=null!=(i=null==n?void 0:n.uniqueId)?i:"")}uo.value.activeItemIndex=uo.value.items.findIndex((t=>`${t.uniqueId}`===o)),F.Debug("= U.QuasarUtil SetAppStateV2SelectIndex",uo.value)}static GetItemFromAPSV2(t){let e=uo.value.items.find((e=>e.uniqueId===t));return e||(F.Debug(`= U.QuasarUtil Item with id ${t} not found in appStateV2`),null)}static UpdateSvgElementSettings(t,e){F.Debug("= U.QuasarUtil UpdateSvgElementSettings Input: key,value",t,e,ye.stdObj);var i=Qo.GetSelectedObject(),o=i.selectedObject.GetDrawSetting();(o=o||{})[t]=e,F.Debug(`= U.QuasarUtil Updated drawSetting: ${t}=${e}`,o),i.selectedObject.SetDrawSetting(o)}}a($n,"quasar");class Zn extends dn{constructor(t){F.Debug("= S.BaseShape - constructor input:",t),(t=t||{}).DrawingObjectBaseClass=me.DrawObjectBaseClass.Shape,0!==t.hookflags&&(t.hookflags=Se.HookFlags.LcShape|Se.HookFlags.LcAttachToLine),0!==t.targflags&&(t.targflags=Se.HookFlags.LcShape|Se.HookFlags.LcLine),super(t),a(this,"ShapeType"),a(this,"shapeparam"),a(this,"SVGDim"),a(this,"zListIndex"),this.ShapeType=t.ShapeType,this.shapeparam=t.shapeparam||0,this.SVGDim=t.SVGDim||{},F.Debug("= S.BaseShape - constructor output:",this)}CreateActionTriggers(t,e,i,o){F.Debug("= S.BaseShape - CreateActionTriggers input:",{svgDocument:t,triggerIdentifier:e,rotationProvider:i,comparisonTrigger:o});const n=[ze.CursorType.ResizeLT,ze.CursorType.ResizeT,ze.CursorType.ResizeRT,ze.CursorType.ResizeR,ze.CursorType.ResizeRB,ze.CursorType.ResizeB,ze.CursorType.ResizeLB,ze.CursorType.ResizeL],s=t.CreateShape(me.CSType.Group),a=me.Common.KnobSize,r=me.Common.RKnobSize;let l=this.extraflags&me.ExtraFlags.SideKnobs&&this.dataclass===tn.ShapeTypes.POLYGON;const h=me.Common.MinSidePointLength;let c=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(c*=2);const p=a/c,d=r/c,u=this.Frame;let g=u.width+p,y=u.height+p;const S=Oe.DeepCopy(u);S.x-=p/2,S.y-=p/2,S.width+=p,S.height+=p;let m=i.GetRotation()+22.5;m>=360&&(m=0);const b=Math.floor(m/45),D=n.slice(b).concat(n.slice(0,b));let f=!0,x=!l,C=!l;switch(this.ObjGrow){case me.GrowBehavior.Horiz:f=!1,C=!1;break;case me.GrowBehavior.Vertical:f=!1,x=!1;break;case me.GrowBehavior.ProPortional:f=!0,x=!1,C=!1}const P={svgDoc:t,shapeType:me.CSType.Rect,x:0,y:0,knobSize:p,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",locked:!1};if(e!==o&&(P.fillColor="white",P.strokeSize=1,P.strokeColor="black",P.fillOpacity=0),this.flags&Se.ObjFlags.Lock)P.fillColor="gray",P.locked=!0,l=!1;else if(this.NoGrow()){P.fillColor="red",l=!1,P.strokeColor="red";for(let t=0;t<8;t++)D[t]=ze.CursorType.Default}let T;f&&(P.knobID=me.ActionTriggerType.TopLeft,P.cursorType=D[0],T=this.GenericKnob(P),s.AddElement(T),P.x=g-p,P.y=0,P.cursorType=D[2],P.knobID=me.ActionTriggerType.TopRight,T=this.GenericKnob(P),s.AddElement(T),P.x=g-p,P.y=y-p,P.cursorType=D[4],P.knobID=me.ActionTriggerType.BottomRight,T=this.GenericKnob(P),s.AddElement(T),P.x=0,P.y=y-p,P.cursorType=D[6],P.knobID=me.ActionTriggerType.BottomLeft,T=this.GenericKnob(P),s.AddElement(T)),C&&(P.x=g/2-p/2,P.y=0,P.cursorType=D[1],P.knobID=me.ActionTriggerType.TopCenter,T=this.GenericKnob(P),s.AddElement(T),P.x=g/2-p/2,P.y=y-p,P.cursorType=D[5],P.knobID=me.ActionTriggerType.BottomCenter,T=this.GenericKnob(P),s.AddElement(T)),x&&(P.x=0,P.y=y/2-p/2,P.cursorType=D[7],P.knobID=me.ActionTriggerType.CenterLeft,T=this.GenericKnob(P),s.AddElement(T),P.x=g-p,P.y=y/2-p/2,P.cursorType=D[3],P.knobID=me.ActionTriggerType.CenterRight,T=this.GenericKnob(P),s.AddElement(T));const O=function(t){let e=null;if(t.hooks.length){const i=ws.GetObjectPtr(t.hooks[0].objid,!1);i&&(i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector||i&&i instanceof we.Shape.ShapeContainer)&&(e=i.PrGetShapeConnectorInfo(t.hooks[0]))}return e}(this);if(O&&O.length){const e={svgDoc:t,iconSize:14,imageURL:null,iconID:0,userData:0,cursorType:0};for(let t=0,i=O.length;t<i;t++)"right"===O[t].position?e.x=g-14-1-p:e.x=p+1,"bottom"===O[t].position?e.y=y-14-1-p:e.y=p+1,e.cursorType=O[t].cursorType,e.iconID=O[t].knobID,e.imageURL="vertical"===O[t].polyType?me.Common.ConMoveVerticalPath:me.Common.ConMoveHorizontalPath,e.userData=O[t].knobData,T=this.GenericIcon(e),s.AddElement(T),e.x+=16}if(l){const t=Oe.DeepCopy(this);t.inside=Oe.DeepCopy(t.Frame);const e=ye.opt.ShapeToPolyLine(this.BlockID,!1,!0,t).GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,[]);if(e){P.shapeType=me.CSType.Oval,P.knobID=me.ActionTriggerType.MovePolySeg,P.fillColor="green",P.strokeColor="green";for(let t=1,i=e.length;t<i;t++){const i=e[t].x-e[t-1].x,o=e[t].y-e[t-1].y;ve.Sqrt(i*i+o*o)>h&&(P.cursorType=i*i>o*o?ze.CursorType.ResizeTB:ze.CursorType.ResizeLR,P.x=e[t-1].x+i/2,P.y=e[t-1].y+o/2,T=this.GenericKnob(P),T.SetUserData(t),s.AddElement(T))}}}const v=u.width<44;let w=this.hooks.length>0;if(w){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);t&&t.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Connector&&(w=!1)}if(!(this.NoRotate()||this.NoGrow()||P.locked||v||w)){const t=this.TextGrow===Se.TextGrowBehavior.Horizontal&&this.flags&Se.ObjFlags.TextOnly&&Vo.TextAlignToWin(this.TextAlign).just===bi.TextJust.Left;P.shapeType=me.CSType.Oval,P.x=t?g+d:g-3*d,P.y=y/2-d/2,P.cursorType=ze.CursorType.Rotate,P.knobID=me.ActionTriggerType.Rotate,P.fillColor="white",P.fillOpacity=.001,P.strokeSize=1.5,P.strokeColor="black",T=this.GenericKnob(P),s.AddElement(T)}if(this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.CreateDimensionAdjustmentKnobs(s,t,P)}return s.SetSize(g,y),s.SetPos(S.x,S.y),s.isShape=!0,s.SetID(me.Common.Action+e),F.Debug("= S.BaseShape - CreateActionTriggers output:",s),s}CreateConnectHilites(t,e,i,o,n,s){F.Debug("= S.BaseShape - CreateConnectHilites input:",{svgDoc:t,triggerId:e,targetParam:i,additionalParam:o,extraParam:n,connectionHint:s});const a=t.CreateShape(me.CSType.Group);let r=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(r*=2);const l=me.Common.ConnPointDim/r;let h=[];this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints;const c=this.flags&Se.ObjFlags.ContConn||null!=s;if(c)h.push(i);else if(h=this.GetTargetPoints(null,Se.HookFlags.LcNoSnaps,null),null==h)return;const p=this.GetPerimPts(e,h,null,!c,s,n),d=this.Frame;let u=d.width,g=d.height;const y=Oe.DeepCopy(d);y.x-=l/2,y.y-=l/2,y.width+=l,y.height+=l,u+=l,g+=l;const S={svgDoc:t,shapeType:me.CSType.Oval,x:0,y:0,knobSize:l,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",KnobID:0,cursorType:ze.CursorType.Anchor};let m;if(c)y.x=p[0].x,y.y=p[0].y,y.x-=l,y.y-=l,S.x=l/2,S.y=l/2,m=this.GenericKnob(S),a.AddElement(m),a.SetSize(y.width,y.height),a.SetPos(y.x,y.y);else{for(let t=0;t<p.length;t++)S.x=p[t].x-this.Frame.x,S.y=p[t].y-this.Frame.y,m=this.GenericKnob(S),a.AddElement(m);a.SetSize(u,g),a.SetPos(y.x,y.y)}return a.isShape=!0,a.SetEventBehavior(me.EventBehavior.None),a.SetID("hilite_"+e),F.Debug("= S.BaseShape - CreateConnectHilites output:",a),a}SetCursors(){F.Debug("= S.BaseShape - SetCursors input, BlockID:",this.BlockID);const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.TextFlags,Se.TextFlags.OneClick;switch(Ps.GetEditMode()){case Se.EditState.Default:super.SetCursors();break;case Se.EditState.FormatPaint:{F.Debug("= S.BaseShape - SetCursors: FORMATPAINT mode");const e=t.GetElementById(me.SVGElementClass.Shape);e&&e.SetCursor(ze.CursorType.Paint);const i=t.GetElementById(me.SVGElementClass.Slop);i&&i.SetCursor(ze.CursorType.Paint);break}default:F.Debug("= S.BaseShape - SetCursors: Default mode, calling super.SetCursors()"),super.SetCursors()}F.Debug("= S.BaseShape - SetCursors output, BlockID:",this.BlockID)}GetTextObject(t,e){F.Debug("= S.BaseShape - GetTextObject input:",{clickEvent:t,skipTableRelease:e});const i=this.GetGraph(!1);if(i){this.DataID=i.selectedText;const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&(t.textElem=t.GetElementById(me.SVGElementClass.Text,this.DataID))}else this.DataID>=0&&null==ws.GetObjectPtr(this.DataID,!1)&&(this.DataID=-1);return F.Debug("= S.BaseShape - GetTextObject output:",{DataID:this.DataID}),this.DataID}UseTextBlockColor(){F.Debug("= S.BaseShape - UseTextBlockColor input:",{TextFlags:this.TextFlags,FillPaintType:this.StyleRecord.Fill.Paint.FillType,TextPaintColor:this.StyleRecord.Text.Paint.Color,FillColor:this.StyleRecord.Fill.Paint.Color});const t=this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachB,e=this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent,i=this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Solid&&this.StyleRecord.Text.Paint.Color.toUpperCase()===this.StyleRecord.Fill.Paint.Color.toUpperCase(),o=t||e||i;return F.Debug("= S.BaseShape - UseTextBlockColor output:",o),o}SetTextObject(t){if(F.Debug("= S.BaseShape - SetTextObject input:",t),this.UseTextBlockColor()){const t=si.FindStyle(me.Common.TextBlockStyle);t&&(this.StyleRecord.Text.Paint=Oe.DeepCopy(t.Text.Paint))}return this.DataID=t,F.Debug("= S.BaseShape - SetTextObject output:",this.DataID),!0}GetTextParams(t){F.Debug("= S.BaseShape - GetTextParams input:",{eventData:t});let e={};const i=this.GetGraph(!1);return i&&i.selectedText>=0?e=ye.opt.Graph_GetTRect(this,i,t):(e.trect=Oe.DeepCopy(this.trect),e.sizedim=Oe.DeepCopy(this.sizedim),e.tsizedim={width:this.sizedim.width-(this.Frame.width-this.trect.width),height:this.sizedim.height-(this.Frame.height-this.trect.height)}),F.Debug("= S.BaseShape - GetTextParams output:",e),e}GetTextDefault(t){F.Debug("= S.BaseShape - GetTextDefault input:",{eventData:t});const e=super.GetTextDefault(t);return F.Debug("= S.BaseShape - GetTextDefault output:",e),e}SetTextGrow(t){if(F.Debug("= S.BaseShape - SetTextGrow input:",t),this.TextGrow=t,this.DataID>=0){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(t){const e=t.textElem;if(this.TextGrow===Se.TextGrowBehavior.Horizontal)e.SetConstraints(ye.opt.header.MaxWorkDim.x,this.trect.width,this.trect.height),F.Debug("= S.BaseShape - SetTextGrow applied Horizontal constraints");else{const t=Oe.DeepCopy(this),i=Oe.DeepCopy(this.Frame);i.width=this.sizedim.width,t.UpdateFrame(i),e.SetConstraints(t.trect.width,t.trect.width,this.trect.height),F.Debug("= S.BaseShape - SetTextGrow applied Vertical constraints")}}ye.opt.TextResizeCommon(this.BlockID,!0),F.Debug("= S.BaseShape - SetTextGrow: TextResizeCommon called"),F.Debug("= S.BaseShape - SetTextGrow output:",this.TextGrow)}}ChangeShape(t,e,i,o,n){let s,a,r;F.Debug("= S.BaseShape - ChangeShape input:",{newDataClass:t,newShapeType:e,shapeParam:o,preserveAspect:n});const l=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(this.SymbolURL&&this.SymbolURL.length>0)return F.Debug("= S.BaseShape - ChangeShape output: SymbolURL exists, returning false"),!1;if(t!==this.dataclass||e===tn.ShapeTypes.RECTANGLE){const h=Oe.DeepCopy(this);if(n){const t=h.Frame.x+h.Frame.width/2,e=h.Frame.y+h.Frame.height/2;h.Frame.width>h.Frame.height?(h.Frame.x=t-h.Frame.height/2,h.Frame.width=h.Frame.height):(h.Frame.y=e-h.Frame.width/2,h.Frame.height=h.Frame.width)}switch(e){case tn.ShapeTypes.RECTANGLE:case tn.ShapeTypes.MEASURE_AREA:s=new we.Shape.Rect(h);break;case tn.ShapeTypes.ROUNDED_RECTANGLE:h.shapeparam=l.def.rrectparam,s=new we.Shape.RRect(h),s.moreflags=ve.SetFlag(s.moreflags,me.ObjMoreFlags.FixedRR,!0),o=l.def.rrectparam;break;case tn.ShapeTypes.OVAL:case tn.ShapeTypes.CIRCLE:s=new we.Shape.Oval(h);break;case tn.ShapeTypes.POLYGON:const t=i(this.Frame,o);h.VertexArray=t,s=new we.Shape.Polygon(h),s.NeedsSIndentCount=!0}if(a=ye.stdObj.PreserveBlock(this.BlockID),s.dataclass=t,s.shapeparam=o,s.ResizeAspectConstrain=n,""===s.ImageURL&&(s.extraflags=ve.SetFlag(s.extraflags,me.ExtraFlags.FlipHoriz|me.ExtraFlags.FlipVert,!1)),s.ObjGrow=n?me.GrowBehavior.ProPortional:me.GrowBehavior.All,s.BlockID=a.Data.BlockID,s.left_sindent=0,s.top_sindent=0,s.right_sindent=0,s.bottom_sindent=0,a.Data=s,s.moreflags=ve.SetFlag(s.moreflags,me.ObjMoreFlags.FixedRR,!1),s.DataID>=0){s.UpdateFrame(s.Frame),s.sizedim.width=s.Frame.width,s.sizedim.height=s.Frame.height;const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);let e;if(t&&(e=t.textElem),r=Oe.DeepCopy(s.trect),e){let t=e.CalcTextFit(r.width);t.height>r.height?(t=ye.opt.FitProp(s,e,t.height-r.height,-1),s.Frame.width=t.x,s.Frame.height=t.y):s.TRectToFrame(r,!1)}}return s.SetSize(s.Frame.width,s.Frame.height,0),F.Debug("= S.BaseShape - ChangeShape output:",{result:!0,newShape:s}),!0}return F.Debug("= S.BaseShape - ChangeShape output: condition not met, returning false"),!1}SetShapeProperties(t){F.Debug("= S.BaseShape - SetShapeProperties input:",t);let e=!1,i=0,o=0,n=!1;const s=this.TextFlags,a=Se.TextFlags;if(super.SetShapeProperties(t)&&(e=!0,(this.TextFlags&a.AttachA+a.AttachB)!=(s&a.AttachA+a.AttachB)&&this.DataID>=0)){let t;n=!0,t=this.TextFlags&a.AttachA+a.AttachB?si.FindStyle(me.Common.TextBlockStyle):ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).def.style;const e={StyleRecord:{Text:{Paint:{Color:t.Text.Paint.Color}}}},i={Color:e.StyleRecord.Text.Paint.Color},o={color:e.StyleRecord.Text.Paint.Color};this.ChangeTextAttributes(o,i)}if(null!=t.tmargin&&this.TMargins.left!==t.tmargin){this.TMargins.left=t.tmargin,this.TMargins.right=t.tmargin,this.TMargins.top=t.tmargin,this.TMargins.bottom=t.tmargin,e=!0;const s=Oe.DeepCopy(this.Frame);this.UpdateFrame(s),this.trect.width<0&&(i=-this.trect.width),this.trect.height<0&&(o=-this.trect.height),(i||o)&&(ve.InflateRect(this.trect,i/2,o/2),this.TRectToFrame(this.trect,!0),ws.AddToDirtyList(this.BlockID)),this.DataID>=0&&(n=!0),e=!0}return null!=t.SideConn&&this.ShapeType===me.ShapeType.Polygon&&t.AdjSides!==(this.extraflags&me.ExtraFlags.SideKnobs)>0&&(this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.SideKnobs,t.SideConn),ws.AddToDirtyList(this.BlockID),e=!0),null!=t.Container&&t.Container!==(this.moreflags&me.ObjMoreFlags.SED_MF_Container)>0&&(this.moreflags=ve.SetFlag(this.moreflags,me.ObjMoreFlags.SED_MF_Container,t.Container),e=!0),null!=t.ObjGrow&&t.ObjGrow!==this.ObjGrow&&(this.ObjGrow=t.ObjGrow,ws.AddToDirtyList(this.BlockID),e=!0,this.ResizeAspectConstrain=this.ObjGrow===me.GrowBehavior.ProPortional),null!=t.TextGrow&&t.TextGrow!==this.TextGrow&&(this.SetTextGrow(t.TextGrow),e=!0,n=!1),n&&(this.SetTextGrow(this.TextGrow),e=!0),F.Debug("= S.BaseShape - SetShapeProperties output:",e),e}ApplyStyle(t,e){F.Debug("= S.BaseShape - ApplyStyle input:",{style:t,options:e});let i=null;this.objecttype!==Se.FNObjectTypes.ShapeContainer&&(t&&t.Line&&t.Border&&(i=Oe.DeepCopy(t.Line),t.Line=Oe.DeepCopy(t.Border)),super.ApplyStyle(t,e),null!=i&&(t.Line=Oe.DeepCopy(i))),F.Debug("= S.BaseShape - ApplyStyle output:",{style:t,options:e})}SetObjectStyle(t){F.Debug("= S.BaseShape.SetObjectStyle input:",t);let e=null;t.StyleRecord&&t.StyleRecord.Line&&t.StyleRecord.Border&&(e=Oe.DeepCopy(t.StyleRecord.Line),t.StyleRecord.Line=Oe.DeepCopy(t.StyleRecord.Border));const i=super.SetObjectStyle(t);return i.StyleRecord&&i.StyleRecord.Line&&i.StyleRecord.Line.Thickness&&this.SetSize(this.Frame.width,this.Frame.height,me.ActionTriggerType.LineThickness),null!=e&&(t.StyleRecord.Line=Oe.DeepCopy(e)),i.StyleRecord&&i.StyleRecord.Fill&&i.StyleRecord.Fill.FillType&&(ye.opt.ClearImage(this.BlockID,!1,!0),this.flags&Se.ObjFlags.TextOnly&&this.StyleRecord.Fill.Paint.FillType!==Se.FillTypes.Transparent&&(this.flags=ve.SetFlag(this.flags,Se.ObjFlags.TextOnly,!1))),F.Debug("= S.BaseShape.SetObjectStyle output:",i),i}SetShapeConnectionPoints(t,e,i){F.Debug("= S.BaseShape - SetShapeConnectionPoints input:",{connectionType:t,connectionPoints:e,newAttachPoint:i});let o=!1;switch(this.attachpoint.x===i.x&&this.attachpoint.y===i.y||(this.attachpoint.x=i.x,this.attachpoint.y=i.y,o=!0),t){case Se.ObjFlags.ContConn:0==(this.flags&t)&&(this.flags=ve.SetFlag(this.flags,Se.ObjFlags.UseConnect,!1),this.flags=ve.SetFlag(this.flags,Se.ObjFlags.ContConn,!0),o=!0);break;case Se.ObjFlags.UseConnect:this.flags=ve.SetFlag(this.flags,Se.ObjFlags.ContConn,!1),this.flags=ve.SetFlag(this.flags,Se.ObjFlags.UseConnect,!0),this.ConnectPoints=Oe.DeepCopy(e),o=!0;break;default:(this.flags&Se.ObjFlags.ContConn||this.flags&Se.ObjFlags.UseConnect)&&(this.flags=ve.SetFlag(this.flags,Se.ObjFlags.UseConnect,!1),this.flags=ve.SetFlag(this.flags,Se.ObjFlags.ContConn,!1),o=!0)}return F.Debug("= S.BaseShape - SetShapeConnectionPoints output:",o),o}GetClosestConnectPoint(t){F.Debug("= S.BaseShape - GetClosestConnectPoint input:",t);const e=this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints;let i=[];const o=me.Common.DimMax;if(e){const t={x:0,y:0,width:o,height:o};if(i=Oe.DeepCopy(this.ConnectPoints),ye.opt.FlipPoints(t,this.extraflags,i),0!==this.RotationAngle){const e=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(t,e,i)}}if(e){let e,o;for(let n=0;n<i.length;n++){const s=i[n],a=t.x-s.x,r=t.y-s.y,l=a*a+r*r;(void 0===e||l<e)&&(e=l,o=s)}return t.x=o.x,t.y=o.y,F.Debug("= S.BaseShape - GetClosestConnectPoint output:",t),!0}return F.Debug("= S.BaseShape - GetClosestConnectPoint output:",!1),!1}GetPolyList(){let t;F.Debug("= S.BaseShape - GetPolyList input:",{});let e,i,o=new vi;const n=tn.ShapeTypes,s=me.LineType;switch(this.dataclass){case n.RECTANGLE:t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width,this.inside.height),o.segs.push(t),t=new Pi(s.LINE,0,this.inside.height),o.segs.push(t),t=new Pi(s.LINE,0,0),o.segs.push(t);break;case n.ROUNDED_RECTANGLE:e=this.Frame.width,this.Frame.height<e&&(e=this.Frame.height),i=this.GetCornerSize(),t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width-2*i,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-i,i),t.ShortRef=me.ArcQuad.PLA_TL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.LINE,this.inside.width-i,this.inside.height-i),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-2*i,this.inside.height),o.segs.push(t),t.ShortRef=me.ArcQuad.SD_PLA_BR,t=new Pi(s.LINE,0,this.inside.height),o.segs.push(t),t=new Pi(s.ARCSEGLINE,-i,this.inside.height-i),t.ShortRef=me.ArcQuad.PLA_BL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.LINE,-i,i),o.segs.push(t),t=new Pi(s.ARCSEGLINE,0,0),o.segs.push(t),o.offset.x=i,o.offset.y=0;break;case n.OVAL:case n.CIRCLE:t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width/2,this.inside.height/2),o.segs.push(t),t.ShortRef=me.ArcQuad.SD_PLA_BR,t.param=-Math.PI/2,t=new Pi(s.ARCSEGLINE,0,this.inside.height),t.ShortRef=me.ArcQuad.PLA_BL,o.segs.push(t),t=new Pi(s.ARCSEGLINE,-this.inside.width/2,this.inside.height/2),o.segs.push(t),t.ShortRef=me.ArcQuad.PLA_TL,t.param=-Math.PI/2,t=new Pi(s.ARCSEGLINE,0,0),o.segs.push(t),t.ShortRef=me.ArcQuad.PLA_TL,o.offset.x=this.inside.width/2,o.offset.y=0;break;case n.DOCUMENT:i=this.shapeparam,t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width,this.inside.height-i),o.segs.push(t),t=new Pi(s.ARCLINE,this.inside.width/2,this.inside.height-i),t.param=i,o.segs.push(t),t=new Pi(s.ARCLINE,0,this.inside.height-i),t.param=-i,o.segs.push(t),t=new Pi(s.LINE,0,0),o.segs.push(t);break;case n.TERMINAL:this.inside.width>this.inside.height?(i=this.inside.height/2,t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width-2*i,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-i,i),t.ShortRef=me.ArcQuad.PLA_TL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-2*i,this.inside.height),o.segs.push(t),t.ShortRef=me.ArcQuad.SD_PLA_BR,t=new Pi(s.LINE,0,this.inside.height),o.segs.push(t),t=new Pi(s.ARCSEGLINE,-i,this.inside.height-i),t.ShortRef=me.ArcQuad.PLA_BL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.ARCSEGLINE,0,0),t.ShortRef=me.ArcQuad.PLA_TL,o.segs.push(t)):(i=this.inside.width/2,t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-i,i),t.ShortRef=me.ArcQuad.PLA_TL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.LINE,this.inside.width-i,this.inside.height-i),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-2*i,this.inside.height),o.segs.push(t),t.ShortRef=me.ArcQuad.SD_PLA_BR,t=new Pi(s.ARCSEGLINE,-i,this.inside.height-i),t.ShortRef=me.ArcQuad.PLA_BL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.LINE,-i,i),o.segs.push(t),t=new Pi(s.ARCSEGLINE,0,0),t.ShortRef=me.ArcQuad.PLA_TL,o.segs.push(t)),o.offset.x=i,o.offset.y=0;break;case n.STORAGE:i=this.shapeparam,t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width-i,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-2*i,this.inside.height/2),t.ShortRef=me.ArcQuad.PLA_TL,t.param=-Math.PI/2,o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-i,this.inside.height),o.segs.push(t),t.ShortRef=me.ArcQuad.PLA_BL,t=new Pi(s.LINE,0,this.inside.height),o.segs.push(t),t=new Pi(s.ARCSEGLINE,-i,this.inside.height/2),t.ShortRef=me.ArcQuad.PLA_BL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.ARCSEGLINE,0,0),t.ShortRef=me.ArcQuad.PLA_TL,o.segs.push(t),o.offset.x=i,o.offset.y=0;break;case n.DELAY:i=this.shapeparam,t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width-i,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width,this.inside.height/2),t.ShortRef=me.ArcQuad.PLA_TL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-i,this.inside.height),o.segs.push(t),t.ShortRef=me.ArcQuad.SD_PLA_BR,t=new Pi(s.LINE,0,this.inside.height),o.segs.push(t),t=new Pi(s.LINE,0,0),o.offset.x=0,o.offset.y=0;break;case n.DISPLAY:i=this.shapeparam,t=new Pi(s.LINE,0,0),o.segs.push(t),t=new Pi(s.LINE,this.inside.width-2*i,0),o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-i,this.inside.height/2),t.ShortRef=me.ArcQuad.PLA_TL,t.param=Math.PI/2,o.segs.push(t),t=new Pi(s.ARCSEGLINE,this.inside.width-2*i,this.inside.height),o.segs.push(t),t.ShortRef=me.ArcQuad.SD_PLA_BR,t=new Pi(s.LINE,0,this.inside.height),o.segs.push(t),t=new Pi(s.LINE,-i,this.inside.height/2),o.segs.push(t),t=new Pi(s.LINE,0,0),o.offset.x=i,o.offset.y=0;break;default:const a=this.Frame;this.Frame=this.inside;const r=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);if(this.Frame=a,r.length>0){o.offset.x=r[0].x,o.offset.y=r[0].y;for(let e=0;e<r.length;e++)t=new Pi(s.LINE,r[e].x-o.offset.x,r[e].y-o.offset.y),o.segs.push(t)}}return o.closed=!0,o.dim.x=this.inside.width,o.dim.y=this.inside.height,o.wasline=!1,F.Debug("= S.BaseShape - GetPolyList output:",o),o}GetListOfEnclosedObjects(t){F.Debug("= S.BaseShape - GetListOfEnclosedObjects input:",{isRecursive:t});let e=[];const i=me.ObjMoreFlags.SED_MF_Container;if(this.moreflags&i){let o=vs.VisibleZList(),n={};const s=o.length;let a=this.trect,r=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);if(0!==this.RotationAngle){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,r)}let l=this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent;l=!1;let h=0;if(!l)for(let t=0;t<s;t++)if(o[t]===this.BlockID){h=t+1;break}let c=[];for(let p=h;p<s;p++){const s=o[p];if(s!==this.BlockID){let o,l,h=ws.GetObjectPtr(s,!1);if(0!==h.RotationAngle){o=h.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);const t=-h.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(h.Frame,t,o),ve.GetPolyRect(n,o)}else l=Oe.DeepCopy(h.Frame),n=l;let p=!1;if(p=0!==this.RotationAngle?0!==h.RotationAngle?ve.IsAllPolyPointsInPoly(r,o):ve.IsAllFrameCornersInPoly(r,n):0!==h.RotationAngle?ve.IsAllPolyPointsInPoly(r,o):ve.RectInsideRect(a,n),p&&(e.push(s),2===h.hooks.length&&c.push(s),h.moreflags&i&&t)){const t=h.GetListOfEnclosedObjects(!0);t.length&&(e=e.concat(t))}}}for(let t=0;t<c.length;t++){const i=ws.GetObjectPtr(c[t],!1),o=i.hooks[0].objid,n=i.hooks[1].objid;if((e.indexOf(o)<0||e.indexOf(n)<0)&&e.indexOf(c[t])>=0){const i=e.indexOf(c[t]);e.splice(i,1)}}}return F.Debug("= S.BaseShape - GetListOfEnclosedObjects output:",e),e}PinProportional(t){F.Debug("= S.BaseShape PinProportional - Input:",t);const e=me.Common.KnobSize;let i={};if(0!==this.RotationAngle){const t=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),e=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,e,t),ve.GetPolyRect(i,t)}else i=this.Frame;const o={left:i.x-this.r.x+e/2,top:i.y-this.r.y+e/2,right:this.r.x+this.r.width-(i.x+i.width),bottom:this.r.y+this.r.height-(i.y+i.height)};if(t.y<o.top){const e=o.top-t.y,i=e*(ye.opt.actionAspectRatioWidth/ye.opt.actionAspectRatioHeight);t.height-=e,t.width-=i,t.y=o.left}if(t.x<o.left){const e=o.left-t.x,i=e*(ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth);t.height-=i,t.width-=e,t.x=o.left}F.Debug("= S.BaseShape PinProportional - Output:",t)}HandleActionTriggerTrackCommon(t,e,i){let o,n,s,a,r={x:t,y:e};let l=t-ye.opt.actionStartX,h=e-ye.opt.actionStartY;const c=Oe.DeepCopy(ye.opt.actionBBox),p=Oe.DeepCopy(ye.opt.actionBBox),d=this,u=ye.opt.OverrideSnaps(i),g=function(t){let e;if(d.RotationAngle){const i=ve.PolyFromRect(t),o=-d.RotationAngle/(180/Se.Geometry.PI);e=Oe.DeepCopy(t),si.RotatePointsAboutCenter(d.Frame,o,i),ve.GetPolyRect(e,i)}else e=t;if(Math.floor(e.x)<0)return!0;if(Math.floor(e.y)<0)return!0;if(ye.opt.header.flags&me.HeaderFlags.NoAuto){const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(e.x+e.width>t.dim.x)return!0;if(e.y+e.height>t.dim.y)return!0}return!1};switch(ye.opt.actionTriggerId){case me.ActionTriggerType.TopLeft:if(o=p.x-t,n=p.y-e,p.x=t,p.y=e,p.width+=o,p.height+=n,ye.opt.actionLockAspectRatio?(p.width<0&&(p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,p.width=-p.width),s=p.width*ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth,p.height<0?(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,p.height=s):(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height-s,p.height=s),this.PinProportional(p)):(p.width<0&&(p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,p.width=-p.width),p.height<0&&(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,p.height=-p.height)),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.TopCenter:if(n=p.y-e,p.y=e,p.height=p.height+n,ye.opt.actionLockAspectRatio?(p.height<0&&(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,p.height=-p.height),a=p.height*ye.opt.actionAspectRatioWidth/ye.opt.actionAspectRatioHeight,p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width/2-a/2,p.width=a,this.PinProportional(p)):p.height<0&&(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,p.height=-p.height),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.TopRight:if(n=p.y-e,p.y=e,p.height=p.height+n,p.width=t-p.x,ye.opt.actionLockAspectRatio?(p.width<0&&(p.x=t,p.width=-p.width),s=p.width*ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth,p.height<0?(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,p.height=s):(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height-s,p.height=s),this.PinProportional(p)):(p.width<0&&(p.x=t,p.width=-p.width),p.height<0&&(p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,p.height=-p.height)),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.CenterRight:if(p.width=t-p.x,ye.opt.actionLockAspectRatio?(p.width<0&&(p.x=t,p.width=-p.width),s=p.width*ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth,p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height/2-s/2,p.height=s,this.PinProportional(p)):p.width<0&&(p.x=t,p.width=-p.width),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.BottomRight:if(p.width=t-p.x,p.height=e-p.y,ye.opt.actionLockAspectRatio?(p.width<0&&(p.x=t,p.width=-p.width),s=p.width*ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth,p.height<0&&(p.y=c.y-s),p.height=s,this.PinProportional(p)):(p.width<0&&(p.x=t,p.width=-p.width),p.height<0&&(p.y=e,p.height=-p.height)),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.BottomCenter:if(p.height=e-p.y,ye.opt.actionLockAspectRatio?(p.height<0&&(p.y=e,p.height=-p.height),a=p.height*ye.opt.actionAspectRatioWidth/ye.opt.actionAspectRatioHeight,p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width/2-a/2,p.width=a,this.PinProportional(p)):p.height<0&&(p.y=e,p.height=-p.height),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.MovePolySeg:r.x=t,r.y=e;let d=ws.GetObjectPtr(this.BlockID,!1);const y=Oe.DeepCopy(d.Frame);ye.docUtil.docConfig.enableSnap&&!u&&(r=ye.docUtil.SnapToGrid(r)),Ps.ShapeToPolyLine(this.BlockID,!0,!0),d=ws.GetObjectPtr(this.BlockID,!1),d.MovePolySeg(ye.opt.actionSvgObject,r.x,r.y,ye.opt.actionTriggerId,ye.opt.actionTriggerData),ye.opt.PolyLineToShape(d.BlockID,!0),d=ws.GetObjectPtr(this.BlockID,!1);const S=d.trect,m=this.TextGrow===Se.TextGrowBehavior.Horizontal?ye.opt.header.MaxWorkDim.x:S.width;if(ye.opt.actionSvgObject&&ye.opt.actionSvgObject.textElem){const t=ye.opt.actionSvgObject.textElem.CalcTextFit(m),e=t.width;if(t.height>S.height||e>S.width){Ps.ShapeToPolyLine(this.BlockID,!0,!0);const t=ws.GetObjectPtr(this.BlockID,!1);r.x=ye.opt.actionTableLastX,r.y=ye.opt.actionTableLastY,t.MovePolySeg(ye.opt.actionSvgObject,r.x,r.y,ye.opt.actionTriggerId,ye.opt.actionTriggerData),ye.opt.PolyLineToShape(this.BlockID,!0),d=ws.GetObjectPtr(this.BlockID,!1)}}if(ye.opt.actionNewBBox=Oe.DeepCopy(d.Frame),d.HandleActionTriggerCallResize(ye.opt.actionNewBBox,me.ActionTriggerType.MovePolySeg,r),ye.opt.actionTableLastX=r.x,ye.opt.actionTableLastY=r.y,d.RotationAngle){const t=ye.opt.actionSvgObject.GetRotation(),e=Oe.DeepCopy(d.Frame),i=ye.opt.svgDoc.CalculateRotatedOffsetForResize(y,e,t),o=ye.opt.actionSvgObject.GetPos();o.x+=i.x,o.y+=i.y,ye.opt.actionSvgObject.SetPos(o.x,o.y),ye.opt.actionBBox.x+=i.x,ye.opt.actionBBox.y+=i.y,ye.opt.actionStartX+=i.x,ye.opt.actionStartY+=i.y,d.Frame.x+=i.x,d.Frame.y+=i.y}break;case me.ActionTriggerType.BottomLeft:if(p.height=e-p.y,o=p.x-t,p.x=t,p.width+=o,ye.opt.actionLockAspectRatio?(p.width<0&&(p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,p.width=-p.width),s=p.width*ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth,p.height<0&&(p.y=c.y-s),p.height=s,this.PinProportional(p)):(p.width<0&&(p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,p.width=-p.width),p.height<0&&(p.y=e,p.height=-p.height)),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.CenterLeft:if(o=p.x-t,p.x=t,p.width+=o,ye.opt.actionLockAspectRatio?(p.width<0&&(p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,p.width=-p.width),s=p.width*ye.opt.actionAspectRatioHeight/ye.opt.actionAspectRatioWidth,p.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height/2-s/2,p.height=s,this.PinProportional(p)):p.width<0&&(p.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,p.width=-p.width),g(p))break;ye.opt.actionNewBBox=Oe.DeepCopy(p),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,r);break;case me.ActionTriggerType.ContainerAdj:let b,D,f,x;for(b=ye.opt.dragElementList.length,ye.opt.theActionContainerArrangement===Se.ContainerListArrangements.Column?(-h>ye.opt.actionOldExtra&&(h=-ye.opt.actionOldExtra),ye.opt.actionTableLastY=h,l=0):(-l>ye.opt.actionOldExtra&&(l=-ye.opt.actionOldExtra),ye.opt.actionTableLastY=l,h=0),D=0;D<b;D++)x=ye.opt.dragBBoxList[D],f=Os.GetSVGDragElement(D),f&&f.SetPos(x.x+l,x.y+h);break;case me.ActionTriggerType.Rotate:let C=0;const P=t-ye.opt.rotatePivotX,T=e-ye.opt.rotatePivotY;if(0===P&&0===T)C=0;else if(0===P)C=T>0?90:270;else if(P>=0&&T>=0)C=Math.atan(T/P)*(180/Se.Geometry.PI);else if(P<0&&(T>=0||T<0)){C=180+Math.atan(T/P)*(180/Se.Geometry.PI)}else if(P>=0&&T<0){C=360+Math.atan(T/P)*(180/Se.Geometry.PI)}if(ye.docUtil.docConfig.enableSnap&&!u){const t=ye.opt.EnhanceSnaps(i)?ye.opt.enhanceRotateSnap:ye.opt.rotateSnap;C=Math.round(C/t)*t}const O=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),v=-C/(180/Se.Geometry.PI),w={};if(si.RotatePointsAboutCenter(this.Frame,v,O),ve.GetPolyRect(w,O),w.x<0)break;if(w.y<0)break;if(ye.opt.header.flags&me.HeaderFlags.NoAuto){const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(w.x+w.width>t.dim.x)break;if(w.y+w.height>t.dim.y)break}ye.opt.rotateEndRotation=C,this.Rotate(ye.opt.actionSvgObject,C);break;case me.ActionTriggerType.DimLineAdj:this.DimensionLineDeflectionAdjust(ye.opt.actionSvgObject,t,e,ye.opt.actionTriggerId,ye.opt.actionTriggerData)}}HandleActionTriggerCallResize(t,e,i,o){let n;this.prevBBox=o?Oe.DeepCopy(o):Oe.DeepCopy(this.Frame);const s=Oe.DeepCopy(this.Frame);if(t.width<me.Common.MinDim&&(t.width=me.Common.MinDim),t.height<me.Common.MinDim&&(t.height=me.Common.MinDim),this.UpdateFrame(t),e===me.ActionTriggerType.LineLength&&(e=0),e===me.ActionTriggerType.LineThickness&&(e=0),ye.opt.actionStoredObjectId===this.BlockID&&i&&Ts.UpdateDisplayCoordinates(t,i,ze.CursorTypes.Grow,this),-1===e&&(e=!0),-1!==this.DataID&&!(this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachB)){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(t){let i;const o=t.textElem;n=this.trect;const a=this.TextGrow===Se.TextGrowBehavior.Horizontal?ye.opt.header.MaxWorkDim.x:n.width;i=o?o.CalcTextFit(a):{width:0,height:0};const r=ve.TrimDP(i.width,ye.docUtil.rulerConfig.dp),l=ve.TrimDP(i.height,ye.docUtil.rulerConfig.dp),h=ve.TrimDP(i.width,0),c=ve.TrimDP(i.height,0),p=ve.TrimDP(n.height,0),d=ve.TrimDP(n.width,0);let u=c,g=h;if(0!==c&&Math.abs(p-c)<=1&&(u=p),0!==h&&Math.abs(d-h)<=1&&(g=d),u>p||g>d)return e||(n=Oe.DeepCopy(this.trect),l>n.height&&(n.height=l),r>n.width&&(n.width=r),this.TRectToFrame(n,e)),void this.UpdateFrame(s)}}if(e&&ye.opt.actionSvgObject&&ye.opt.actionStoredObjectId===this.BlockID){const t=this.Resize(ye.opt.actionSvgObject,ye.opt.actionNewBBox,this,e);ye.opt.actionBBox.x+=t.x,ye.opt.actionBBox.y+=t.y,ye.opt.actionStartX+=t.x,ye.opt.actionStartY+=t.y,this.Frame.x+=t.x,this.Frame.y+=t.y,this.inside.x+=t.x,this.inside.y+=t.y,this.trect.x+=t.x,this.trect.y+=t.y}}HandleActionTriggerDoAutoScroll(){ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("HandleActionTriggerDoAutoScroll",100);let t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);if(this.PinAction(t),t=xs.DoAutoGrowDrag(t),ye.docUtil.ScrollToPosition(t.x,t.y),ye.opt.actionTriggerId!==me.ActionTriggerType.Rotate&&ye.opt.rotateObjectRadians){let e=t.x,i=t.y;const o={x:e,y:i},n={},s=ws.GetObjectPtr(ye.opt.actionStoredObjectId,!1).Frame;n.x=s.x+s.width/2,n.y=s.y+s.height/2;const a=ye.opt.RotatePointAroundPoint(n,o,ye.opt.rotateObjectRadians);e=a.x,i=a.y,t.x=e,t.y=i}this.HandleActionTriggerTrackCommon(t.x,t.y)}AutoScrollCommon(t,e,i){F.Debug("= S.BaseShape - AutoScrollCommon input:",{event:t,enableSnap:e,autoScrollCallback:i});let o=!1;ye.opt.OverrideSnaps(t)&&(e=!1);const n=t.gesture.center.clientX,s=t.gesture.center.clientY;let a=n,r=s;const l=ye.opt.svgDoc.docInfo;if(n>=l.dispX+l.dispWidth-4?(o=!0,a=l.dispX+l.dispWidth-4+32):n<l.dispX&&(o=!0,a=l.dispX-32),s>=l.dispY+l.dispHeight-4?(o=!0,r=l.dispY+l.dispHeight-4+32):s<l.dispY&&(o=!0,r=l.dispY-32),o){if(e&&ye.docUtil.docConfig.enableSnap){const t=ye.docUtil.SnapToGrid({x:a,y:r});a=t.x,r=t.y}return ye.opt.autoScrollXPos=a,ye.opt.autoScrollYPos=r,-1!==ye.opt.autoScrollTimerId?(F.Debug("= S.BaseShape - AutoScrollCommon output: false (timer already set)"),!1):(ye.opt.autoScrollTimer=new gn(this),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout(i,0),F.Debug("= S.BaseShape - AutoScrollCommon output: false (timer started)"),!1)}return this.ResetAutoScrollTimer(),F.Debug("= S.BaseShape - AutoScrollCommon output: true"),!0}PinAction(t){F.Debug("= S.BaseShape - PinAction input:",t);const e=me.Common.KnobSize;let i={},o={};if(0!==this.RotationAngle){const t=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),e=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,e,t),ve.GetPolyRect(o,t)}else o=this.Frame;if(i.left=o.x-this.r.x+e/2,i.top=o.y-this.r.y+e/2,i.right=this.r.x+this.r.width-(o.x+o.width)+e/2,i.bottom=this.r.y+this.r.height-(o.y+o.height)+e/2,t.x<i.left&&(t.x=i.left),t.y<i.top&&(t.y=i.top),ye.opt.header.flags&me.HeaderFlags.NoAuto){const e=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;t.x>e.dim.x-i.right&&(t.x=e.dim.x-i.right),t.y>e.dim.y-i.bottom&&(t.y=e.dim.y-i.bottom)}return F.Debug("= S.BaseShape - PinAction output:",t),t}ActionApplySnaps(t,e){F.Debug("= S.BaseShape - ActionApplySnaps input:",{coords:t,triggerType:e});let i=this.GetSnapRect(),o=!1,n=[],s={},a={x:null,y:null};const r=me.ActionTriggerType;let l;const h=e=>{s.x=e.x,s.y=e.y,s.width=e.width,s.height=t.y-e.y,s.height<0?(s.y=t.y,s.height=e.y-t.y,n.push("left_top","right_top")):n.push("left_bottom","right_bottom"),o=!0},c=e=>{s.x=e.x,s.y=t.y,s.width=e.width,s.height=e.y+e.height-t.y,s.height<0?(s.y=e.y,s.height=t.y-e.y,n.push("left_bottom","right_bottom")):n.push("left_top","right_top"),o=!0},p=e=>{s.y=e.y,s.x=t.x,s.height=e.height,s.width=e.x+e.width-t.x,s.width<0?(s.x=e.x,s.width=t.x-e.x,n.push("above_right","below_right")):n.push("above_left","below_left"),o=!0},d=e=>{s.y=e.y,s.x=e.x,s.height=e.height,s.width=t.x-e.x,s.width<0?(s.x=t.x,s.width=e.x-t.x,n.push("above_left","below_left")):n.push("above_right","below_right"),o=!0};if(xs.AllowSnapToShapes()){switch(e){case r.BottomCenter:h(i);break;case r.BottomLeft:h(i),p(Oe.DeepCopy(s));break;case r.BottomRight:h(i),d(Oe.DeepCopy(s));break;case r.CenterLeft:p(i);break;case r.CenterRight:d(i);break;case r.TopCenter:c(i);break;case r.TopRight:c(i),d(Oe.DeepCopy(s));break;case r.TopLeft:c(i),p(Oe.DeepCopy(s))}o&&(l=new We,this.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&(a=an.DynamicSnapsGetSnapObjects(this.BlockID,s,l,null,n),null!==a.x&&(t.x+=a.x),null!==a.y&&(t.y+=a.y)))}if(ye.docUtil.docConfig.enableSnap){const e=ye.docUtil.SnapToGrid(t);null===a.x&&(t.x=e.x),null===a.y&&(t.y=e.y)}return F.Debug("= S.BaseShape - ActionApplySnaps output:",l),l}LMActionTrack(t){if(ve.StopPropagationAndDefaults(t),-1==ye.opt.actionStoredObjectId)return!1;let e=null;const i=me.ActionTriggerType;e=ws.GetObjectPtr(ye.opt.actionStoredObjectId,!1),ye.opt.actionTriggerId!=me.ActionTriggerType.Rotate&&e.SetDimensionLinesVisibility(ye.opt.actionSvgObject,!1);const o=e.Frame;let n=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);this.PinAction(n),n=xs.DoAutoGrowDrag(n);const s=ye.opt.OverrideSnaps(t);let a=!1;switch(ye.opt.actionTriggerId){case i.MODIFYSHAPE:case i.ROTATE:a=!0}let r=null;a||s||(r=this.ActionApplySnaps(n,ye.opt.actionTriggerId));let l=n.x,h=n.y;if(ye.opt.actionTriggerId!=me.ActionTriggerType.Rotate&&ye.opt.rotateObjectRadians){const t={x:l,y:h},e={x:o.x+o.width/2,y:o.y+o.height/2},i=ye.opt.RotatePointAroundPoint(e,t,ye.opt.rotateObjectRadians);l=i.x,h=i.y,n.x=l,n.y=h}if(this.AutoScrollCommon(t,!0,"HandleActionTriggerDoAutoScroll")&&(n=this.LMActionDuringTrack(n),this.HandleActionTriggerTrackCommon(n.x,n.y,t),ye.opt.actionTriggerId!=me.ActionTriggerType.Rotate&&e&&e.SetDimensionLinesVisibility(ye.opt.actionSvgObject,!0),r)){const t=Oe.DeepCopy(this.Frame);this.Frame=ye.opt.actionNewBBox;const e=this.GetSnapRect();this.Frame=t,an.DynamicSnapsUpdateGuides(r,this.BlockID,e)}}LMActionRelease(t,e){F.Debug("S.BasicShape - LMActionRelease input:",{event:t,additionalData:e});try{let t=!1,i=!1;const o=ws.GetObjectPtr(ye.opt.actionStoredObjectId,!1);if(null==o)return;if(null==e){if(rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer(),null==ye.opt.actionSvgObject)return;if(ye.opt.actionStoredObjectId<0)return;let t;switch(i=!1,t={BlockID:ye.opt.actionStoredObjectId,ActionTriggerID:ye.opt.actionTriggerId,ActionData:ye.opt.actionTriggerData},t.Frame=Oe.DeepCopy(o.Frame),t.rotateEndRotation=ye.opt.rotateEndRotation,an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null,ye.opt.actionTriggerId){case me.ActionTriggerType.MovePolySeg:i=!0;{const e=ws.GetObjectPtr(this.BlockID,!1);t.left_sindent=e.left_sindent,t.right_sindent=e.right_sindent,t.top_sindent=e.top_sindent,t.bottom_sindent=e.bottom_sindent,t.tindent={},t.tindent.left=e.tindent.left,t.tindent.right=e.tindent.right,t.tindent.top=e.tindent.top,t.tindent.bottom=e.tindent.bottom,e.polylist&&(t.polylist=Oe.DeepCopy(e.polylist)),e.VertexArray&&(t.VertexArray=Oe.DeepCopy(e.VertexArray))}break;case me.ActionTriggerType.DimLineAdj:t.dimensionDeflectionH=this.dimensionDeflectionH,t.dimensionDeflectionV=this.dimensionDeflectionV;break;case me.ActionTriggerType.ContainerAdj:t.actionTableLastY=ye.opt.actionTableLastY}o.SetDimensionLinesVisibility(ye.opt.actionSvgObject,!1)}else ye.opt.actionTriggerId===me.ActionTriggerType.MovePolySeg&&(i=!0);if(ye.opt.actionTriggerId===me.ActionTriggerType.ContainerAdj)ye.opt.moveList=[],ye.opt.dragElementList.length=0,ye.opt.dragBBoxList.length=0,ye.opt.actionOldExtra=0,this.PrUpdateExtra(ye.opt.actionTableLastY);else if(ye.opt.actionTriggerId===me.ActionTriggerType.Rotate)ye.opt.rotateEndRotation=ye.opt.rotateEndRotation%360,ye.opt.SetObjectAttributes(ye.opt.actionStoredObjectId,{RotationAngle:ye.opt.rotateEndRotation}),ye.opt.SetObjectFrame(ye.opt.actionStoredObjectId,o.Frame),this.UpdateDimensionLines(ye.opt.actionSvgObject);else if(!i){const e=Oe.DeepCopy(o.Frame);ye.opt.SetObjectFrame(ye.opt.actionStoredObjectId,e),this.polylist&&this.ShapeType===me.ShapeType.Polygon&&this.ScaleObject(0,0,0,0,0,0),t=!0}this.LMActionPostRelease(ye.opt.actionStoredObjectId),null==e&&o.SetDimensionLinesVisibility(ye.opt.actionSvgObject,!0),(""!==this.HyperlinkText||-1!==this.NoteID||this.HasFieldData())&&ws.AddToDirtyList(ye.opt.actionStoredObjectId),ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,vs.ShowOverlayLayer(),xs.CompleteOperation(),F.Debug("S.BasicShape - LMActionRelease output: completed")}catch(i){throw this.LMActionClickExpCleanup(i),ye.opt.ExceptionCleanup(i),i}}LMActionPreTrack(t,e){this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1))}LMActionDuringTrack(t){return t}LMActionPostRelease(t){switch(ye.opt.linkParams=null,Ps.SetEditMode(Se.EditState.Default),ye.opt.actionTriggerId){case me.ActionTriggerType.CenterLeft:case me.ActionTriggerType.CenterRight:this.sizedim.width=this.Frame.width;break;case me.ActionTriggerType.TopCenter:case me.ActionTriggerType.BottomCenter:this.sizedim.height=this.Frame.height;break;default:this.sizedim.width=this.Frame.width,this.sizedim.height=this.Frame.height}}LMSetupActionClick(t,e,i,o,n){let s;ye.opt.eventTimestamp=Date.now();const a=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),r=xs.DoAutoGrowDrag(a),l=r.x,h=r.y;if(o){const t=ws.GetObjectPtr(i,!1);t&&t.RotationAngle}else{const e=ye.opt.svgOverlayLayer.FindElementByDOMElement(t.currentTarget);if(null===e)return!1;const n=e.GetID();i=parseInt(n.substring(me.Common.Action.length,n.length),10);const a=e.GetTargetForEvent(t);if(null==a)return!1;o=a.GetID(),s=a.GetUserData(),ye.opt.SetControlDragMode(a)}ye.opt.actionStoredObjectId=i;const c=ws.GetObjectPtr(i,!0);ye.opt.actionTriggerId=o,ye.opt.actionTriggerData=s;const p=me.ActionTriggerType;switch(o){case p.CONNECTOR_PERP:case p.CONNECTOR_ADJ:case p.CONNECTOR_HOOK:case p.LINESTART:case p.LINEEND:const e=this.getConnectedObject();return e&&(ye.opt.actionStoredObjectId=e.BlockID,this.ConnectorLMActionClick(t,!0)),!1}o===me.ActionTriggerType.MovePolySeg&&(ye.opt.actionTriggerData={hitSegment:s,moveAngle:9999}),ye.opt.actionSvgObject=ye.opt.svgObjectLayer.GetElementById(i),c.SetDimensionLinesVisibility(ye.opt.actionSvgObject,!1),this.LMActionPreTrack(i,o),(""!==this.HyperlinkText||-1!==this.NoteID||this.HasFieldData())&&this.HideAllIcons(ye.opt.svgDoc,ye.opt.actionSvgObject),ye.opt.actionLockAspectRatio=t.gesture.srcEvent.shiftKey,this.ResizeAspectConstrain&&(ye.opt.actionLockAspectRatio=!ye.opt.actionLockAspectRatio);const d=c.Frame;if(ye.opt.actionLockAspectRatio&&(0===d.height?ye.opt.actionLockAspectRatio=!1:(ye.opt.actionAspectRatioWidth=d.width,ye.opt.actionAspectRatioHeight=d.height)),ye.opt.actionBBox=Oe.DeepCopy(d),ye.opt.actionNewBBox=Oe.DeepCopy(d),vs.HideOverlayLayer(),ye.opt.rotateObjectRadians=-this.RotationAngle/(180/Se.Geometry.PI),ye.opt.actionTriggerId===me.ActionTriggerType.ContainerAdj){const t={x:l,y:h};ye.opt.actionStartX=t.x,ye.opt.actionStartY=t.y;const e=this.PrGetAdjustShapeList();if(!e)return!1;ye.opt.moveList=e.list,ye.opt.dragElementList=e.svglist,ye.opt.dragBBoxList=e.framelist,ye.opt.actionTableLastY=0,ye.opt.actionOldExtra=e.oldextra,ye.opt.theActionContainerArrangement=e.arrangement}else if(ye.opt.actionTriggerId===me.ActionTriggerType.Rotate)ye.opt.rotateKnobCenterDivisor=this.RotateKnobCenterDivisor(),ye.opt.rotateStartRotation=this.RotationAngle,ye.opt.rotateEndRotation=ye.opt.rotateStartRotation,ye.opt.rotatePivotX=d.x+d.width/ye.opt.rotateKnobCenterDivisor.x,ye.opt.rotatePivotY=d.y+d.height/ye.opt.rotateKnobCenterDivisor.y,ye.opt.actionStartX=l,ye.opt.actionStartY=h;else{const t={x:l,y:h},e={x:d.x+d.width/2,y:d.y+d.height/2},i=ye.opt.RotatePointAroundPoint(e,t,ye.opt.rotateObjectRadians);ye.opt.actionStartX=i.x,ye.opt.actionStartY=i.y,ye.opt.actionTableLastX=i.x,ye.opt.actionTableLastY=i.y}return!0}getConnectedObject(){if(this.hooks.length){const t=this.hooks[0].objid;return ws.GetObjectPtr(t,!1)}return null}ConnectorLMActionClick(t,e){F.Debug("= S.BaseShape - ConnectorLMActionClick input:",{event:t,triggerElement:e}),this.BaseLineLMActionClick(t,e),F.Debug("= S.BaseShape - ConnectorLMActionClick output")}BaseLineLMActionClick(t,e){F.Debug("= S.BaseShape - BaseLineLMActionClick input:",{event:t,triggerElement:e});try{const i=this.BlockID,o=ws.GetObjectPtr(i,!1);if(!(o&&o instanceof dn))return F.Debug("= S.BaseShape - BaseLineLMActionClick output: base object not valid"),!1;if(xs.InitializeAutoGrowDrag(0,this.BlockID),!this.LMSetupActionClick(t,e))return void F.Debug("= S.BaseShape - BaseLineLMActionClick output: LMSetupActionClick failed");const n=ws.GetObjectPtr(this.BlockID,!1);ye.opt.WorkAreaHammer.on("drag",Ls.Evt_ActionTrackHandlerFactory(n)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_ActionReleaseHandlerFactory(n)),F.Debug("= S.BaseShape - BaseLineLMActionClick output: completed successfully")}catch(i){throw this.LMActionClickExpCleanup(i),ye.opt.ExceptionCleanup(i),i}}LMActionClickExpCleanup(t){F.Debug("= S.BaseShape - LMActionClickExpCleanup input:",t),rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer(),ye.opt.ob={},ye.opt.linkParams=null,ye.opt.actionTriggerId=-1,ye.opt.actionTriggerData=null,ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,vs.HideOverlayLayer(),F.Debug("= S.BaseShape - LMActionClickExpCleanup output: cleanup complete")}LMActionClick(t,e,i,o,n){F.Debug("= S.BaseShape - LMActionClick input:",{event:t,triggerElement:e,additionalId:i,autoGrowParam:o,extraParam:n}),ve.StopPropagationAndDefaults(t);try{const s=this.BlockID,a=ws.GetObjectPtr(s,!1);if(!(a&&a instanceof dn))return F.Debug("= S.BaseShape - LMActionClick output: Invalid drawing object"),!1;if(xs.InitializeAutoGrowDrag(o),!this.LMSetupActionClick(t,e,i,o,n))return void F.Debug("= S.BaseShape - LMActionClick output: LMSetupActionClick failed");const r=ws.GetObjectPtr(this.BlockID,!1);ye.opt.WorkAreaHammer.on("drag",Ls.Evt_ActionTrackHandlerFactory(r)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_ActionReleaseHandlerFactory(r)),F.Debug("= S.BaseShape - LMActionClick output: completed successfully")}catch(s){throw this.LMActionClickExpCleanup(s),ye.opt.ExceptionCleanup(s),s}}StartNewObjectDrawTrackCommon(t,e,i){F.Debug("= S.BaseShape - StartNewObjectDrawTrackCommon input:",{currentX:t,currentY:e,event:i});let o=t-ye.opt.actionStartX,n=e-ye.opt.actionStartY,s=Oe.DeepCopy(ye.opt.actionBBox);s.width=s.width+o,s.height=s.height+n;let a={x:s.x+s.width,y:s.y+s.height},r=ye.opt.OverrideSnaps(i);ye.docUtil.docConfig.enableSnap&&!r&&(a=ye.docUtil.SnapToGrid(a),s.width=a.x-s.x,s.height=a.y-s.y),s.width<0&&(s.x=t,s.width=-s.width),s.height<0&&(s.y=e,s.height=-s.height),ye.opt.actionNewBBox=Oe.DeepCopy(s),this.UpdateFrame(ye.opt.actionNewBBox),this.Resize(ye.opt.actionSvgObject,s,this),F.Debug("= S.BaseShape - StartNewObjectDrawTrackCommon output:",ye.opt.actionNewBBox)}StartNewObjectDrawDoAutoScroll(){F.Debug("= S.BaseShape - StartNewObjectDrawDoAutoScroll input"),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("StartNewObjectDrawDoAutoScroll",100);let t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);t=xs.DoAutoGrowDrag(t),ye.docUtil.ScrollToPosition(t.x,t.y),this.StartNewObjectDrawTrackCommon(t.x,t.y,null),F.Debug("= S.BaseShape - StartNewObjectDrawDoAutoScroll output:",t)}LMDrawTrack(t){if(F.Debug("= S.BaseShape - LMDrawTrack input:",t),-1===ye.opt.actionStoredObjectId)return F.Debug("= S.BaseShape - LMDrawTrack output: No action stored object, returning false"),!1;let e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),i=ye.opt.OverrideSnaps(t);ye.docUtil.docConfig.enableSnap&&!i&&(e=ye.docUtil.SnapToGrid(e)),e=xs.DoAutoGrowDrag(e);let o=e.x,n=e.y;this.AutoScrollCommon(t,!0,"StartNewObjectDrawDoAutoScroll")&&(this.LMDrawDuringTrack(o,n),this.StartNewObjectDrawTrackCommon(o,n,t)),F.Debug("= S.BaseShape - LMDrawTrack output:",{posX:o,posY:n})}LMDrawRelease(t){F.Debug("= S.BaseShape - LMDrawRelease input:",t),rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer();const e={x:ye.opt.actionNewBBox.x,y:ye.opt.actionNewBBox.y,width:ye.opt.actionNewBBox.width,height:ye.opt.actionNewBBox.height};ye.opt.SetObjectFrame(ye.opt.actionStoredObjectId,e),this.LMDrawPostRelease(ye.opt.actionStoredObjectId);xs.PostObjectDraw(),F.Debug("= S.BaseShape - LMDrawRelease output:",{newBoundingBox:e,collaborationData:{}})}LMDrawPreTrack(){F.Debug("= S.BaseShape - LMDrawPreTrack - Input:");return F.Debug("= S.BaseShape - LMDrawPreTrack - Output:",true),true}LMDrawDuringTrack(t,e){F.Debug("= S.BaseShape - LMDrawDuringTrack input:",{posX:t,posY:e});const i={x:t,y:e};return F.Debug("= S.BaseShape - LMDrawDuringTrack output:",i),i}LMDrawPostRelease(){}LMDrawClickExceptionCleanup(t){F.Debug("= S.BaseShape - LMDrawClickExceptionCleanup input:",t),rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer(),ye.opt.linkParams=null,ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart),F.Debug("= S.BaseShape - LMDrawClickExceptionCleanup output: cleanup complete")}LMDrawClick(t,e){F.Debug("= S.BaseShape - LMDrawClick input:",{initialX:t,initialY:e});try{this.Frame.x=t,this.Frame.y=e,this.prevBBox=Oe.DeepCopy(this.Frame),ye.opt.WorkAreaHammer.on("drag",Ls.Evt_DrawTrackHandlerFactory(this)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_DrawReleaseHandlerFactory(this)),F.Debug("= S.BaseShape - LMDrawClick output:",{Frame:this.Frame,prevBBox:this.prevBBox})}catch(i){throw this.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),i}}RotateKnobCenterDivisor(){F.Debug("= S.BaseShape - RotateKnobCenterDivisor input: no parameters");const t={x:2,y:2};return F.Debug("= S.BaseShape - RotateKnobCenterDivisor output:",t),t}OffsetShape(t,e,i,o){if(F.Debug("= S.BaseShape - OffsetShape input:",{offsetX:t,offsetY:e,childShapes:i,linkFlags:o}),this.moreflags&me.ObjMoreFlags.Container&&i)for(let n=0;n<i.length;n++){const s=i[n],a=ws.GetObjectPtr(s,!0);if(a){const i=o?o[a.BlockID]:null;a.OffsetShape(t,e,i),Ps.SetLinkFlag(s,Ee.LinkFlags.Move),ws.AddToDirtyList(s)}}this.Frame.x+=t,this.Frame.y+=e,this.r.x+=t,this.r.y+=e,this.inside.x+=t,this.inside.y+=e,this.trect.x+=t,this.trect.y+=e,this.GetGraph(!0)&&ye.opt.GraphShift(this,t,e),F.Debug("= S.BaseShape - OffsetShape output:",{Frame:this.Frame,r:this.r,inside:this.inside,trect:this.trect})}SetShapeOrigin(t,e,i){F.Debug("= S.BaseShape - SetShapeOrigin input:",{newX:t,newY:e,childShapes:i});let o=0,n=0;null!=t&&(o=t-this.Frame.x),null!=e&&(n=e-this.Frame.y),this.OffsetShape(o,n,i),F.Debug("= S.BaseShape - SetShapeOrigin output:",{offsetX:o,offsetY:n})}SetShapeIndent(t){F.Debug("= S.BaseShape - SetShapeIndent input:",{applyIndents:t});let e=this.inside.width,i=this.inside.height,o=1,n=1,s=1,a=1;t&&(o=1-(this.left_sindent+this.right_sindent),n=1-(this.bottom_sindent+this.top_sindent),s=1-(this.left_sindent+this.right_sindent),a=1-(this.bottom_sindent+this.top_sindent)),this.tindent.left=this.left_sindent*e/o,this.tindent.top=this.top_sindent*i/n,this.tindent.right=this.right_sindent*e/s,this.tindent.bottom=this.bottom_sindent*i/a,F.Debug("= S.BaseShape - SetShapeIndent output:",this.tindent)}UpdateFrame(t){F.Debug("= S.BaseShape - UpdateFrame input:",t);let e=0,i=0;t&&super.UpdateFrame(t),ve.CopyRect(this.r,this.Frame),this.StyleRecord&&(this.objecttype!==Se.FNObjectTypes.FlWall&&(this.StyleRecord.Line.BThick=0),this.StyleRecord.Line.BThick?null==this.polylist?e=0:i=this.StyleRecord.Line.Thickness/2:i=e=this.StyleRecord.Line.Thickness/2,this.CalcEffectSettings(this.Frame,this.StyleRecord,!1)),ye.opt.SetShapeR(this),ve.CopyRect(this.inside,this.Frame),ve.InflateRect(this.inside,-e,-e),ve.CopyRect(this.trect,this.Frame),ve.InflateRect(this.trect,-i,-i),this.SetShapeIndent(!1),ve.SubRect(this.trect,this.tindent),F.Debug("= S.BaseShape - UpdateFrame output:",{r:this.r,inside:this.inside,trect:this.trect,Frame:this.Frame})}GetSVGFrame(t=this.Frame){F.Debug("= S.BaseShape - GetSVGFrame input:",t);const e={};return ve.CopyRect(e,t),this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(e,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),F.Debug("= S.BaseShape - GetSVGFrame output:",e),e}GetSnapRect(){F.Debug("= S.BaseShape - GetSnapRect input");const t={};if(0!==this.RotationAngle){const e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),i=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,i,e),ve.GetPolyRect(t,e)}else ve.CopyRect(t,this.Frame);return F.Debug("= S.BaseShape - GetSnapRect output:",t),t}CanSnapToShapes(){F.Debug("= S.BaseShape - CanSnapToShapes input");const t=Se.FNObjectTypes;let e;if(this.objecttype===t.ShapeContainer)e=-1;else e=this.BlockID;return F.Debug("= S.BaseShape - CanSnapToShapes output:",e),e}IsSnapTarget(){F.Debug("= S.BaseShape - IsSnapTarget input");const t=Se.FNObjectTypes;let e;if(this.objecttype===t.ShapeContainer)e=!1;else e=!(this.hooks.length||ye.opt.FindChildArray(this.BlockID,-1)>=0);return F.Debug("= S.BaseShape - IsSnapTarget output:",e),e}GetAlignRect(){F.Debug("= S.BaseShape - GetAlignRect input");const t=Oe.DeepCopy(this.Frame);if(0!==this.RotationAngle){const e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),i=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,i,e),ve.GetPolyRect(t,e)}return F.Debug("= S.BaseShape - GetAlignRect output:",t),t}GetCustomConnectPointsDirection(t){F.Debug("= S.BaseShape - GetCustomConnectPointsDirection input:",{direction:t});let e,i=-1,o=null,n=this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints,s=this.GetTargetPoints(null,Se.HookFlags.LcNoSnaps|Se.HookFlags.LcForceEnd,null),a=1,r=1,l=1,h=1;const c=me.Common.DimMax,p=me.ActionArrow;let d={x:0,y:0,width:c,height:c};if(this.RotationAngle){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(d,t,s)}const u=(t,n)=>{null===o?(i=n,o=Math.abs(t-c/2)):(e=Math.abs(t-c/2),e<o&&(i=n,o=e))};if(s.length,n){a=r=l=h=0,d=new wi(0,0,0,0);const e=s.length;ve.GetPolyRect(d,s);for(let t=0;t<e;t++)s[t].x-=d.x,s[t].y-=d.y;if(d.width<1e3&&ve.InflateRect(d,1e3,0),d.height<1e3&&ve.InflateRect(d,0,1e3),d.height>d.width)for(let i=0;i<e;i++)s[i].y<d.height/6?(a++,t===p.Up&&u(s[i].x,i)):s[i].y>=5*d.height/6?(r++,t===p.Down&&u(s[i].x,i)):s[i].x<d.width/6?(l++,t===p.Left&&u(s[i].y,i)):s[i].x>=5*d.width/6&&(h++,t===p.Right&&u(s[i].y,i));else for(let i=0;i<e;i++)s[i].x<d.width/6?(l++,t===p.Left&&u(s[i].y,i)):s[i].x>=5*d.width/6?(h++,t===p.Right&&u(s[i].y,i)):s[i].y<d.height/6?(a++,t===p.Up&&u(s[i].x,i)):s[i].y>=5*d.height/6&&(r++,t===p.Down&&u(s[i].x,i))}const g={left:l,right:h,top:a,bottom:r,index:i};return F.Debug("= S.BaseShape - GetCustomConnectPointsDirection output:",g),g}AdjustAutoInsertShape(t,e,i){F.Debug("= S.BaseShape - AdjustAutoInsertShape input:",{event:t,isVertical:e,isRotated:i});let o=this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints,n=0,s=0,a=0,r=0,l=!1,h=this.GetTargetPoints(null,Se.HookFlags.LcNoSnaps|Se.HookFlags.LcForceEnd,null),c=h.length<2,p=!1,d=[this.BlockID];if(c?(ye.opt.linkParams&&(ye.opt.linkParams.AutoSinglePoint=!0),l=!0):(ye.opt.linkParams&&(ye.opt.linkParams.AutoSinglePoint=!1),l=!1),o){let t=new wi(0,0,0,0),o=h.length;ve.GetPolyRect(t,h);for(let e=0;e<o;e++)h[e].x-=t.x,h[e].y-=t.y;if(t.width<1e3&&ve.InflateRect(t,1e3,0),t.height<1e3&&ve.InflateRect(t,0,1e3),t.height>t.width){for(let e=0;e<o;e++)h[e].y<t.height/6?n++:h[e].y>=5*t.height/6?s++:h[e].x<t.width/6?a++:h[e].x>=5*t.width/6&&r++;(0===a&&0===r&&n&&s||0===a&&0===r&&l&&(n||s))&&(p=!0)}else{for(let e=0;e<o;e++)h[e].x<t.width/6?a++:h[e].x>=5*t.width/6?r++:h[e].y<t.height/6?n++:h[e].y>=5*t.height/6&&s++;(0===n&&0===s&&a&&r||0===n&&0===s&&l&&(a||r))&&(p=!0)}if(!l)if(p){if(e){if(0!==this.RotationAngle&&180!==this.RotationAngle){if(!i){$o.RotateShapes(0,d);let t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&this.Rotate(t,0)}p=!0}}else if(-90!==this.RotationAngle&&90!==this.RotationAngle){if(!i){$o.RotateShapes(-90,d);let t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&this.Rotate(t,-90)}p=!0}}else if(e){if(-90!==this.RotationAngle&&90!==this.RotationAngle){if(!i){$o.RotateShapes(-90,d);let t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&this.Rotate(t,-90)}p=!0}}else if(0!==this.RotationAngle&&180!==this.RotationAngle){if(!i){$o.RotateShapes(0,d);let t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&this.Rotate(t,0)}p=!0}}return F.Debug("= S.BaseShape - AdjustAutoInsertShape output:",p),p}TRectToFrame(t,e){F.Debug("= S.BaseShape - TRectToFrame input:",{rect:t,maintainSize:e});let i=0,o=0,n=0;this.StyleRecord.Line.BThick&&null==this.polylist?(this.StyleRecord.Line.Thickness,i=0):i=this.StyleRecord.Line.Thickness/2,this.trect=Oe.DeepCopy(t);const s=Oe.DeepCopy(this.Frame);if(this.inside=new wi(t.x,t.y,t.width,t.height),this.SetShapeIndent(!0),ve.Add2Rect(this.inside,this.tindent),this.Frame=Oe.DeepCopy(this.inside),ve.InflateRect(this.Frame,i,i),e||(this.Frame.width<this.sizedim.width&&(o=this.sizedim.width-this.Frame.width,this.Frame.x=s.x),this.Frame.height<this.sizedim.height&&(n=this.sizedim.height-this.Frame.height,this.Frame.y=s.y)),o>0||n>0){const t=Oe.DeepCopy(this.Frame);t.width+=o,t.height+=n,this.UpdateFrame(t)}else ve.CopyRect(this.r,this.Frame),ye.opt.SetShapeR(this);F.Debug("= S.BaseShape - TRectToFrame output:",{Frame:this.Frame,r:this.r,inside:this.inside})}SetSize(t,e,i){F.Debug("= S.BaseShape - SetSize input:",{newWidth:t,newHeight:e,actionType:i});let o={x:this.Frame.x,y:this.Frame.y,width:this.Frame.width,height:this.Frame.height};if(t&&(o.width=t),e&&(o.height=e),t||e){const n=ye.opt.actionBBox,s=ye.opt.actionNewBBox;ye.opt.actionBBox=Oe.DeepCopy(this.Frame),ye.opt.actionNewBBox=Oe.DeepCopy(this.Frame),this.HandleActionTriggerCallResize(o,i,null),ye.opt.actionBBox=n,ye.opt.actionNewBBox=s,i!==me.ActionTriggerType.LineThickness&&(t&&(this.sizedim.width=this.Frame.width),e&&(this.sizedim.height=this.Frame.height)),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);for(let t=0;t<this.hooks.length;t++)Ps.SetLinkFlag(this.hooks[t].objid,Ee.LinkFlags.Move);if(this instanceof we.Shape.Polygon){const t=this.RegenerateVectors(o.width,o.height);t&&(this.VertexArray=t),this.polylist&&this.ShapeType===me.ShapeType.Polygon&&this.ScaleObject(0,0,0,0,0,0)}ws.AddToDirtyList(this.BlockID),this.rflags&&(t&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1)),e&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)))}F.Debug("= S.BaseShape - SetSize output:",{Frame:this.Frame,sizedim:this.sizedim,rflags:this.rflags})}UpdateDimensions(t,e,i){F.Debug("= S.BaseShape - UpdateDimensions input:",{newWidth:t,newHeight:e,maintainAspectRatio:i});const o={x:this.Frame.x,y:this.Frame.y,width:this.Frame.width,height:this.Frame.height};t&&(o.width=t),e&&(o.height=e),this.UpdateFrame(o),F.Debug("= S.BaseShape - UpdateDimensions output:",o)}GetHookFlags(){F.Debug("= S.BaseShape - GetHookFlags input");const t=Se.HookFlags.LcShape|Se.HookFlags.LcArrayMod|Se.HookFlags.LcAttachToLine;return F.Debug("= S.BaseShape - GetHookFlags output:",t),t}AllowLink(){F.Debug("= S.BaseShape - AllowLink input");let t,e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),i=this.flags&Se.ObjFlags.DropOnTable;return e&&(t=e.flags&me.SessionFlags.SLink||e.flags&me.SessionFlags.AttLink||i),F.Debug("= S.BaseShape - AllowLink output:",t),t}GetHookPoints(){F.Debug("= S.BaseShape - GetHookPoints input");let t=this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints;if(t){let t=this.ConnectPoints,e=[];for(let i=0;i<t.length;i++)e.push({x:t[i].x,y:t[i].y,id:me.HookPts.CustomBase+i});return F.Debug("= S.BaseShape - GetHookPoints output:",e),e}let e=[{x:me.Common.DimMax/2,y:0,id:me.HookPts.KTC},{x:me.Common.DimMax,y:me.Common.DimMax/2,id:me.HookPts.KRC},{x:me.Common.DimMax/2,y:me.Common.DimMax,id:me.HookPts.KBC},{x:0,y:me.Common.DimMax/2,id:me.HookPts.KLC}];return F.Debug("= S.BaseShape - GetHookPoints output:",e),e}SetHookAlign(t,e){let i,o,n;switch(F.Debug("= S.BaseShape - SetHookAlign input:",{hookPoint:t,alignType:e}),t){case me.HookPts.AKCL:i=ye.opt.FindChildArray(this.BlockID,-1),i>=0&&(o=ws.GetObjectPtr(i,!1),o&&(n=o.arraylist.styleflags&me.AStyles.FlowConn&&!(o.arraylist.styleflags&me.AStyles.Linear),o.hooks.length&&0===o.hooks[0].connect.x&&!n&&o.SetDirection(!0,!1,!1)));break;case me.HookPts.AKCR:i=ye.opt.FindChildArray(this.BlockID,-1),i>=0&&(o=ws.GetObjectPtr(i,!1),o&&(n=o.arraylist.styleflags&me.AStyles.FlowConn&&!(o.arraylist.styleflags&me.AStyles.Linear),o.hooks.length&&o.hooks[0].connect.x===me.Common.DimMax&&!n&&o.SetDirection(!0,!1,!1)))}F.Debug("= S.BaseShape - SetHookAlign output")}HookToPoint(t,e){F.Debug("= S.BaseShape - HookToPoint input:",{hookId:t,hookFlags:e});let i=[],o=[{x:0,y:0}],n={},s=-1,a=0;const r=me.HookPts,l=me.Common.DimMax,h=Se.HookFlags;if(this.flags&Se.ObjFlags.Obj1&&this.PrFormat&&this.PrFormat(this.BlockID),t===r.KAT)o[0].x=this.attachpoint.x,o[0].y=this.attachpoint.y,this.extraflags&me.ExtraFlags.FlipHoriz&&(o[0].x=l-o[0].x),this.extraflags&me.ExtraFlags.FlipVert&&(o[0].y=l-o[0].y);else if(t===r.KATD)o[0].x=this.attachpoint.x,o[0].y=this.attachpoint.y;else switch(t){case r.KCTL:o[0].x=0,o[0].y=0;break;case r.KCTR:o[0].x=l,o[0].y=0;break;case r.KCBL:o[0].x=0,o[0].y=l;break;case r.KCBR:o[0].x=l,o[0].y=l;break;case r.KCT:o[0].x=l/2,o[0].y=0,a=h.LcVOnly;break;case r.KCB:o[0].x=l/2,o[0].y=l,a=h.LcVOnly;break;case r.KCL:o[0].x=0,o[0].y=l/2,a=h.LcHOnly;break;case r.KCC:o[0].x=l/2,o[0].y=l/2;break;case r.KCR:o[0].x=l,o[0].y=l/2,a=h.LcHOnly;break;default:if(i=this.GetHookPoints(),!i)return null;for(let e=0;e<i.length;e++)if(t===i[e].id){s=e,o[0].x=i[e].x,o[0].y=i[e].y;break}if(s<0)switch(t){case 1:s=1,o[0].x=l/2,o[0].y=0;break;case 2:s=1,o[0].x=l,o[0].y=l/2;break;case 3:s=1,o[0].x=l/2,o[0].y=l;break;case 4:s=1,o[0].x=0,o[0].y=l/2}if(s<0)return null}return this.RotationAngle||(this.extraflags,me.ExtraFlags.FlipHoriz,me.ExtraFlags.FlipVert),n=this.GetPerimPts(-1,o,t,!1,null,-1),t===r.KATD&&(n[0].x-=this.hookdisp.x,n[0].y-=this.hookdisp.y),F.Debug("= S.BaseShape - HookToPoint output:",n[0]),n[0]}IsCoManager(t){F.Debug("= S.BaseShape - IsCoManager input:",t);let e=!1;if(this.hooks&&this.hooks.length){const i=ws.GetObjectPtr(this.hooks[0].objid,!1);i&&i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&(e=i.IsCoManager(t))}return F.Debug("= S.BaseShape - IsCoManager output:",e),e}RRectGetCornerSize(t){F.Debug("= S.BaseShape - RRectGetCornerSize input:",{customSize:t});let e=this.Frame.width,i=this.Frame.height,o=e;if(i<o&&(o=i),t&&(o=t),this.moreflags&me.ObjMoreFlags.FixedRR){let t=me.Common.RRectFixedDim*this.shapeparam,e=.4*o;return t>e&&(t=e),F.Debug("= S.BaseShape - RRectGetCornerSize output:",t),t}let n=o*this.shapeparam;return F.Debug("= S.BaseShape - RRectGetCornerSize output:",n),n}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.BaseShape - GetPerimPts input:",{points:t,targetPoints:e,hookId:i,rotate:o,table:n,needRotate:s});let a=0,r=[],l={};if(this.ShapeType===me.ShapeType.Rect&&(a=this.RRectGetCornerSize(),a>0))return this.RRectGetPerimPts(t,e,i,o,n,s);if(1===e.length&&e[0].y===-me.AStyles.CoManager&&this.IsCoManager(l))return r.push(new De(l.x,l.y)),null!=e[0].id&&(r[0].id=e[0].id),F.Debug("= S.BaseShape - GetPerimPts output:",r),r;for(let h=0;h<e.length;h++)r[h]={x:e[h].x/me.Common.DimMax*this.Frame.width+this.Frame.x,y:e[h].y/me.Common.DimMax*this.Frame.height+this.Frame.y,id:null!=e[h].id?e[h].id:0};if(!o){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,r)}return F.Debug("= S.BaseShape - GetPerimPts output:",r),r}RRectGetPerimPts(t,e,i,o,n,s){F.Debug("= S.BaseShape - RRectGetPerimPts input:",{e:t,targetPoints:e,hookId:i,rotate:o,table:n,needRotate:s});let a,r,l,h=[0,0];const c=me.Common.DimMax;let p=[],d={};if(1===e.length&&e[0].y===-me.AStyles.CoManager&&this.IsCoManager(d))return p.push(new De(d.x,d.y)),null!=e[0].id&&(p[0].id=e[0].id),F.Debug("= S.BaseShape - RRectGetPerimPts output:",p),p;if(i===me.HookPts.KAT&&null==n)return p=new dn(this).GetPerimPts(t,e,i,!1,n,s),F.Debug("= S.BaseShape - RRectGetPerimPts output:",p),p;if(this.flags&Se.ObjFlags.UseConnect)for(let u=0;u<e.length;u++)p[u]={x:e[u].x/c*this.Frame.width+this.Frame.x,y:e[u].y/c*this.Frame.height+this.Frame.y,id:null!=e[u].id?e[u].id:0};else{p=new dn(this).GetPerimPts(t,e,i,!0,n,s),a=this.GetCornerSize()*me.Common.RoundFactor,r=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null);for(let t=0;t<p.length;t++)0===e[t].x&&0===e[t].y?(p[t].x+=a,p[t].y+=a):0===e[t].x&&e[t].y===c?(p[t].x+=a,p[t].y-=a):e[t].x===c&&0===e[t].y?(p[t].x-=a,p[t].y+=a):e[t].x===c&&e[t].y===c?(p[t].x-=a,p[t].y-=a):e[t].x<c/4?(l=en.PolyGetIntersect(r,p[t].y,h,null,!1),l&&(p[t].x=h[0],l>1&&h[1]<p[t].x&&(p[t].x=h[1]))):e[t].x>3*c/4?(l=en.PolyGetIntersect(r,p[t].y,h,null,!1),l&&(p[t].x=h[0],l>1&&h[1]>p[t].x&&(p[t].x=h[1]))):e[t].y<c/4?(l=en.PolyGetIntersect(r,p[t].x,h,null,!0),l&&(p[t].y=h[0],l>1&&h[1]<p[t].y&&(p[t].y=h[1]))):e[t].y>3*c/4&&(l=en.PolyGetIntersect(r,p[t].x,h,null,!0),l&&(p[t].y=h[0],l>1&&h[1]>p[t].y&&(p[t].y=h[1]))),null!=e[t].id&&(p[t].id=e[t].id)}if(!o){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,p)}return F.Debug("= S.BaseShape - RRectGetPerimPts output:",p),p}ChangeTarget(t,e,i,o,n,s){if(F.Debug("= S.BaseShape - ChangeTarget input:",{eventType:t,targetID:e,additionalData:i,flag:o,coordinates:n,needChangeTarget:s}),s){let t=Zo.GetGvSviOpt(this.BlockID);null===t&&(t=ye.wallOpt)}F.Debug("= S.BaseShape - ChangeTarget output")}GetTargetPoints(t,e,i){F.Debug("= S.BaseShape - GetTargetPoints input:",{event:t,triggerType:e,objectID:i});const o=[{x:0,y:0},{x:me.Common.DimMax/4,y:0},{x:me.Common.DimMax/2,y:0},{x:3*me.Common.DimMax/4,y:0},{x:me.Common.DimMax,y:0},{x:me.Common.DimMax,y:me.Common.DimMax/4},{x:me.Common.DimMax,y:me.Common.DimMax/2},{x:me.Common.DimMax,y:3*me.Common.DimMax/4},{x:me.Common.DimMax,y:me.Common.DimMax},{x:3*me.Common.DimMax/4,y:me.Common.DimMax},{x:me.Common.DimMax/2,y:me.Common.DimMax},{x:me.Common.DimMax/4,y:me.Common.DimMax},{x:0,y:me.Common.DimMax},{x:0,y:3*me.Common.DimMax/4},{x:0,y:me.Common.DimMax/2},{x:0,y:me.Common.DimMax/4}];let n=[];const s=this.flags&Se.ObjFlags.ContConn&&null!==t,a=this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints,r=me.Common.DimMax;if(i>=0&&ws.GetObjectPtr(i,!1),s){const i=this.PolyGetTargets(t,e,this.Frame);return F.Debug("= S.BaseShape - GetTargetPoints output:",i),i}if(a){const t=this.ConnectPoints;for(let e=0;e<t.length;e++)n.push({x:t[e].x,y:t[e].y});if(this.extraflags&(me.ExtraFlags.FlipHoriz|me.ExtraFlags.FlipVert)){const t=new wi(0,0,r,r);ye.opt.FlipPoints(t,this.extraflags,n)}return F.Debug("= S.BaseShape - GetTargetPoints output:",n),n}return F.Debug("= S.BaseShape - GetTargetPoints output:",o),o}GetSegLFace(t,e,i){F.Debug("= S.BaseShape - GetSegLFace input:",{point:t,table:e,hookFlags:i});const o=me.Common.DimMax,n=(t,e)=>{const i=t.x-e.x,o=t.y-e.y;return i*i+o*o};let s=this.RotationAngle,a={...t};if(s){const t=-s/(180/Se.Geometry.PI),e={x:0,y:0,width:o,height:o};si.RotatePointsAboutCenter(e,t,[a])}const r=this.flags&Se.ObjFlags.UseConnect;let l=[];if(r){if(l=this.ConnectPoints,s){const t=-s/(180/Se.Geometry.PI),e={x:0,y:0,width:o,height:o};si.RotatePointsAboutCenter(e,t,l)}const t=new wi(0,0,0,0);ve.GetPolyRect(t,l);const e=[{x:o/2,y:0},{x:o/2,y:o},{x:0,y:o/2},{x:o,y:o/2}],i=[{x:t.x+t.width/2,y:t.y},{x:t.x+t.width/2,y:t.y+t.height},{x:t.x,y:t.y+t.height/2},{x:t.x+t.width,y:t.y+t.height/2}],r=t.height<1e3||t.width<1e3?e:i;let h=o*o*o,c=0;for(let o=0;o<r.length;o++){const t=n(r[o],a);t<h&&(h=t,c=o)}const p=me.HookPts.KTC+c;return F.Debug("= S.BaseShape - GetSegLFace output:",p),p}const h=a.x,c=o-a.x,p=a.y,d=o-a.y;let u=Se.SegLDir.Klc;return c<h?(u=Se.SegLDir.Krc,p<c?(u=Se.SegLDir.Ktc,d<p&&(u=Se.SegLDir.Kbc)):d<c&&(u=Se.SegLDir.Kbc)):p<h?(u=Se.SegLDir.Ktc,d<p&&(u=Se.SegLDir.Kbc)):d<h&&(u=Se.SegLDir.Kbc),F.Debug("= S.BaseShape - GetSegLFace output:",u),u}Resize(t,e,i,o,n){if(F.Debug("= S.BaseShape - Resize input:",{element:t,newSize:e,drawingObject:i,actionType:o,previousBBox:n}),null!=t){i.SetDimensionLinesVisibility(t,!1);const s=t.GetRotation();null==n&&(n=this.prevBBox),Oe.DeepCopy(this.trect);const a=Oe.DeepCopy(n),r=Oe.DeepCopy(e),l=Oe.DeepCopy(e),h=ye.opt.svgDoc.CalculateRotatedOffsetForResize(a,r,s);if(this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(l,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),o!==me.ActionTriggerType.MovePolySeg){t.SetSize(l.width,l.height),t.SetPos(l.x+h.x,l.y+h.y);let e=0;this.ShapeType===me.ShapeType.Rect&&(e=this.RRectGetCornerSize());const i=t.GetElementById(me.SVGElementClass.Shape);i.SetSize(l.width,l.height);const o=t.GetElementById(me.SVGElementClass.Slop);o&&o.SetSize(l.width,l.height);const n=t.GetElementById(me.SVGElementClass.Hatch);n&&n.SetSize(l.width,l.height),e>0&&i.SetRRectSize&&(i.SetRRectSize(l.width,l.height,e,e),o&&o.SetRRectSize&&o.SetRRectSize(l.width,l.height,e,e),n&&n.SetRRectSize&&n.SetRRectSize(l.width,l.height,e,e))}const c=this.GetGraph(!0);return c?(ye.opt.GraphFormat(this,c,this.Frame,!0),ws.AddToDirtyList(this.BlockID),Os.RenderDirtySVGObjects()):this.LMResizeSVGTextObject(t,i,e),t.SetRotation(s),this.UpdateDimensionLines(t),F.Debug("= S.BaseShape - Resize output:",h),h}}ResizeInTextEdit(t,e){F.Debug("= S.BaseShape - ResizeInTextEdit input:",{element:t,newSize:e});const i=t.GetRotation();this.SetDimensionLinesVisibility(t,!1);const o=Oe.DeepCopy(this.Frame),n=Oe.DeepCopy(e),s=Oe.DeepCopy(e),a=ye.opt.svgDoc.CalculateRotatedOffsetForResize(o,n,i);this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(s,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),t.SetSize(s.width,s.height),t.SetPos(s.x+a.x,s.y+a.y);let r=0;this.ShapeType===me.ShapeType.Rect&&(r=this.RRectGetCornerSize());const l=t.GetElementById(me.SVGElementClass.Shape);l&&l.SetSize(s.width,s.height);const h=t.GetElementById(me.SVGElementClass.Slop);h&&h.SetSize(s.width,s.height);const c=t.GetElementById(me.SVGElementClass.Hatch);return c&&c.SetSize(e.width,e.height),r>0&&(l&&l.SetRRectSize&&l.SetRRectSize(s.width,s.height,r,r),h&&h.SetRRectSize&&h.SetRRectSize(s.width,s.height,r,r),c&&c.SetRRectSize&&c.SetRRectSize(s.width,s.height,r,r)),t.SetRotation(i),Ts.UpdateDisplayCoordinates(e,null,null,this),this.UpdateDimensionLines(t),F.Debug("= S.BaseShape - ResizeInTextEdit output:",a),a}Rotate(t,e){F.Debug("= S.BaseShape - Rotate input:",{element:t,angle:e}),t.SetRotation(e),F.Debug("= S.BaseShape - Rotate output")}ApplyStyles(t,e){F.Debug("= S.BaseShape - ApplyStyles input:",{element:t,styleRecord:e});let i=e.Fill.Paint.FillType,o=e.Line.Paint.FillType;const n=""!==this.ImageURL;let s=e.Fill.Paint.Color,a=e.Line.Paint.Color;if(!this.SymbolURL)if(n){let i="PROPFILL";const o={x:0,y:0,width:0,height:0};if(this.ImageHeader&&(this.ImageHeader.croprect&&(o.x=this.ImageHeader.croprect.left,o.y=this.ImageHeader.croprect.top,o.width=this.ImageHeader.croprect.right-this.ImageHeader.croprect.left,o.height=this.ImageHeader.croprect.bottom-this.ImageHeader.croprect.top),void 0!==this.ImageHeader.imageflags&&(this.ImageHeader.imageflags===Se.ImageScales.AlwaysFit?i="NOPROP":this.ImageHeader.imageflags===Se.ImageScales.PropFit&&(i="PROPFIT"))),-1!==this.BlobBytesID){const e=ws.GetObjectPtr(this.BlobBytesID,!1);e&&e.ImageDir===Ne.ImageDir.Svg?(null==this.SVGDim.width&&(this.SVGDim=ve.ParseSVGDimensions(e.Bytes)),t.SetImageFill(this.ImageURL,{scaleType:i,cropRect:o,imageWidth:this.SVGDim.width,imageHeight:this.SVGDim.height})):t.SetImageFill(this.ImageURL,{scaleType:i,cropRect:o})}else"SVG"===this.ImageURL.slice(-3).toUpperCase()?t.SetImageFill(this.ImageURL,{scaleType:i,cropRect:o,imageWidth:this.SVGDim.width,imageHeight:this.SVGDim.height}):t.SetImageFill(this.ImageURL,{scaleType:i,cropRect:o});const n=(this.extraflags&me.ExtraFlags.FlipHoriz)>0,s=(this.extraflags&me.ExtraFlags.FlipVert)>0;n&&t.SetMirror(n),s&&t.SetFlip(s),t.SetFillOpacity(e.Fill.Paint.Opacity)}else{switch(i){case Se.FillTypes.Gradient:t.SetGradientFill(this.CreateGradientRecord(e.Fill.Paint.GradientFlags,s,e.Fill.Paint.Opacity,e.Fill.Paint.EndColor,e.Fill.Paint.EndOpacity));break;case Se.FillTypes.RichGradient:t.SetGradientFill(this.CreateRichGradientRecord(e.Fill.Paint.GradientFlags));break;case Se.FillTypes.Texture:const i={url:"",scale:1,alignment:e.Fill.Paint.TextureScale.AlignmentScalar},o=e.Fill.Paint.Texture;ye.opt.TextureList.Textures[o]&&(i.dim=ye.opt.TextureList.Textures[o].dim,i.url=ye.opt.TextureList.Textures[o].ImageURL,i.scale=ye.opt.CalcTextureScale(e.Fill.Paint.TextureScale,i.dim.x),e.Fill.Paint.TextureScale.Scale=i.scale,i.url||(i.url=Constants.FilePath_CMSRoot+Constants.FilePath_Textures+ye.opt.TextureList.Textures[o].filename),t.SetTextureFill(i),t.SetFillOpacity(e.Fill.Paint.Opacity));break;case Se.FillTypes.Transparent:t.SetFillColor("none");break;default:0===e.Fill.Paint.Color.indexOf("#0102")?(t.SetFillColor("none"),ye.opt.Test3DGraph(t.parent,this.Frame.width,this.Frame.height,e.Fill.Paint.Color)):(t.SetFillColor(s),t.SetFillOpacity(e.Fill.Paint.Opacity))}switch(o){case Se.FillTypes.Gradient:t.SetGradientStroke(this.CreateGradientRecord(e.Line.Paint.GradientFlags,a,e.Line.Paint.Opacity,e.Line.Paint.EndColor,e.Line.Paint.EndOpacity));break;case Se.FillTypes.RichGradient:t.SetGradientStroke(this.CreateRichGradientRecord(e.Line.Paint.GradientFlags));break;case Se.FillTypes.Texture:const i={url:"",scale:e.Line.Paint.TextureScale.Scale,alignment:e.Line.Paint.TextureScale.AlignmentScalar},o=e.Line.Paint.Texture;i.dim=ye.opt.TextureList.Textures[o].dim,i.url=ye.opt.TextureList.Textures[o].ImageURL,i.url||(i.url=Constants.FilePath_CMSRoot+Constants.FilePath_Textures+ye.opt.TextureList.Textures[o].filename),t.SetTextureStroke(i),t.SetStrokeOpacity(e.Line.Paint.Opacity);break;default:t.SetStrokeColor(a),t.SetStrokeOpacity(e.Line.Paint.Opacity)}}F.Debug("= S.BaseShape - ApplyStyles output")}SetFillHatch(t,e,i){if(F.Debug("= S.BaseShape - SetFillHatch input:",{element:t,hatchType:e,color:i}),-1!==e&&0!==e){let o=e-1;const n={},s=[];o<10&&(o="0"+o),n.url=Constants.FilePath_Hatches+Constants.HatchName+o+".png",n.scale=1,n.alignment=0,n.dim={x:128,y:128},t.SetTextureFill(n);let a=this.StyleRecord.Line.Paint.Color;i&&(a=i),s.push({type:ai.EffectType.RECOLOR,params:{color:a}}),t.Effects().SetEffects(s,this.Frame)}else t.SetFillColor("none");F.Debug("= S.BaseShape - SetFillHatch output")}IsTransparent(){F.Debug("= S.BaseShape - IsTransparent input");const t=this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent;return F.Debug("= S.BaseShape - IsTransparent output:",t),t}GetTargetRect(){F.Debug("= S.BaseShape - GetTargetRect input");const t={};return ve.CopyRect(t,this.Frame),F.Debug("= S.BaseShape - GetTargetRect output:",t),t}Hit(t,e,i,o){let n,s,a;F.Debug("= S.BaseShape - Hit input:",{point:t,isBorderOnly:e,isTransparent:i,hitResult:o});const r=[{x:t.x,y:t.y}];let l={};const h=this.StyleRecord.Line.Thickness/2;this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints&&(e=!1),0!==this.RotationAngle&&(n=this.RotationAngle/(180/Se.Geometry.PI),si.RotatePointsAboutCenter(this.Frame,n,r));const c={x:r[0].x,y:r[0].y};return ve.CopyRect(l,this.Frame),ve.InflateRect(l,h,h),a=ve.pointInRect(l,c)?Se.HitCodes.Border:0,a&&(s=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),ye.opt.fromOverlayLayer||en.PolyPtInPolygon(s,c)?(a=Se.HitCodes.Inside,(this.IsTransparent()||e)&&(a=0,e=!0),s=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),e&&si.LineDStyleHit(s,c,h,0,null)&&(a=Se.HitCodes.Border)):a=0),o&&(o.hitcode=a),F.Debug("= S.BaseShape - Hit output:",a),a}AllowMaintainLink(){F.Debug("= S.BaseShape - AllowMaintainLink input");const t=!!(this instanceof we.Shape.Polygon&&this.hookflags&Se.HookFlags.LcAttachToLine);return F.Debug("= S.BaseShape - AllowMaintainLink output:",t),t}PolyGetTargetPointList(t){F.Debug("= S.BaseShape - PolyGetTargetPointList input:",{rotationAngle:t});let e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),i=0;return 0!==t&&(i=-t/(180/Se.Geometry.PI),si.RotatePointsAboutCenter(this.Frame,i,e)),F.Debug("= S.BaseShape - PolyGetTargetPointList output:",e),e}PolyGetTargets(t,e,i){F.Debug("= S.BaseShape - PolyGetTargets input:",{event:t,hookFlags:e,frame:i});let o=-1,n=me.Common.LongIntMax;const s=[{x:0,y:0}],a=[],r={x:t.x,y:t.y},l={...i},h=this.PolyGetTargetPointList(e);if(!t)return null;!ye.docUtil.docConfig.enableSnap||e&Se.HookFlags.LcNoSnaps||(r.x=ye.docUtil.SnapToGrid(r).x,r.y=ye.docUtil.SnapToGrid(r).y,r.y=Math.max(r.y,i.y),r.y=Math.min(r.y,i.y+i.height),r.x=Math.max(r.x,i.x),r.x=Math.min(r.x,i.x+i.width));for(let c=1;c<h.length;c++){const t=h[c-1],e=h[c];if(ve.EqualPt(t,e))continue;const i=e.x-t.x||1,a=e.y-t.y||1;let l,p,d;Math.abs(a/i)>1?(p=r.y,l=t.x+(p-t.y)*(i/a),d=Math.abs(l-r.x)):(l=r.x,p=t.y+(l-t.x)*(a/i),d=Math.abs(p-r.y));const u=ve.Pt2Rect(t,e);ve.InflateRect(u,1,1),ve.pointInRect(u,{x:l,y:p})&&d<n&&(n=d,o=c,s[0].x=l,s[0].y=p)}if(o>=0){if(0!==this.RotationAngle){const t=this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(l,t,s)}const t=(s[0].x-i.x)/i.width*me.Common.DimMax,e=(s[0].y-i.y)/i.height*me.Common.DimMax;return a.push(new De(t,e)),F.Debug("= S.BaseShape - PolyGetTargets output:",a),a}return F.Debug("= S.BaseShape - PolyGetTargets output: null"),null}LMAddSVGTextObject(t,e){F.Debug("= S.BaseShape - LMAddSVGTextObject input:",{svgDocument:t,targetElement:e});const i=Oe.DeepCopy(this.Frame),o=Oe.DeepCopy(this.trect);const n=ye.stdObj.GetObject(this.DataID);if(null!=n){const s=t.CreateShape(me.CSType.Text);s.SetRenderingEnabled(!1),s.SetID(me.SVGElementClass.Text),s.SetUserData(-1);const a=this.StyleRecord;a.Line.BThick&&null==this.polylist&&ve.InflateRect(i,a.Line.BThick,a.Line.BThick),s.SetSpellCheck(this.AllowSpell()),s.InitDataSettings(this.fieldDataTableID,this.fieldDataElemID,this.dataStyleOverride),this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachB||(s.SetPos(o.x-i.x,o.y-i.y),s.SetSize(o.width,o.height)),e&&(e.AddElement(s),e.isText=!0,e.textElem=s),n.Data.runtimeText?s.SetRuntimeText(n.Data.runtimeText):(s.SetText(""),s.SetParagraphAlignment(this.TextAlign),s.SetVerticalAlignment("middle")),n.Data.runtimeText||(n.Data.runtimeText=s.GetRuntimeText());let r=null;if(this.bInGroup&&s.DisableHyperlinks(!0),this.TextFlags&Se.TextFlags.AttachA)switch(s.SetRenderingEnabled(!0),s.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0),r=s.GetTextMinDimensions(),this.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:s.SetPos(0,-r.height-this.TMargins.top),s.SetParagraphAlignment(bi.TextAlign.Left);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:s.SetPos(this.Frame.width-r.width,-r.height-this.TMargins.top),s.SetParagraphAlignment(bi.TextAlign.Right);break;default:s.SetPos(this.Frame.width/2-r.width/2,-r.height-this.TMargins.top),s.SetParagraphAlignment(bi.TextAlign.Center)}else if(this.TextFlags&Se.TextFlags.AttachB)switch(s.SetRenderingEnabled(!0),s.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0),r=s.GetTextMinDimensions(),this.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:s.SetPos(0,this.Frame.height+this.TMargins.bottom),s.SetParagraphAlignment(bi.TextAlign.Left);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:s.SetPos(this.Frame.width-r.width,this.Frame.height+this.TMargins.bottom),s.SetParagraphAlignment(bi.TextAlign.Right);break;default:s.SetPos(this.Frame.width/2-r.width/2,this.Frame.height+this.TMargins.bottom),s.SetParagraphAlignment(bi.TextAlign.Center)}else this.TextGrow==Se.TextGrowBehavior.Horizontal?s.SetConstraints(ye.opt.header.MaxWorkDim.x,o.width,o.height):s.SetConstraints(o.width,o.width,o.height);s.SetRenderingEnabled(!0),s.SetEditCallback(ye.opt.TextCallback,e),F.Debug("= S.BaseShape - LMAddSVGTextObject output:",{textElement:s})}}LMResizeSVGTextObject(t,e,i){if(F.Debug("= S.BaseShape - LMResizeSVGTextObject input:",{svgElement:t,drawingObject:e,newDimensions:i}),-1!==e.DataID){const o=t.GetElementById(me.SVGElementClass.Text);if(o){const t=e.trect;let n=null;if(this.TextFlags&Se.TextFlags.AttachA){switch(n=o.GetTextMinDimensions(),this.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:o.SetPos(0,-n.height-this.TMargins.top),o.SetParagraphAlignment(bi.TextAlign.Left);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:o.SetPos(i.width-n.width,-n.height-this.TMargins.top),o.SetParagraphAlignment(bi.TextAlign.Right);break;default:o.SetPos(i.width/2-n.width/2,-n.height-this.TMargins.top),o.SetParagraphAlignment(bi.TextAlign.Center)}o.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0)}else if(this.TextFlags&Se.TextFlags.AttachB){switch(n=o.GetTextMinDimensions(),this.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:o.SetPos(0,i.height+this.TMargins.bottom),o.SetParagraphAlignment(bi.TextAlign.Left);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:o.SetPos(i.width-n.width,i.height+this.TMargins.bottom),o.SetParagraphAlignment(bi.TextAlign.Right);break;default:o.SetPos(i.width/2-n.width/2,i.height+this.TMargins.bottom),o.SetParagraphAlignment(bi.TextAlign.Center)}o.SetConstraints(ye.opt.header.MaxWorkDim.x,0,0)}else{o.SetPos(t.x-i.x,t.y-i.y);let e=t.width;this.TextGrow==Se.TextGrowBehavior.Horizontal&&(e=ye.opt.header.MaxWorkDim.x),o.SetConstraints(e,t.width,t.height)}}}F.Debug("= S.BaseShape - LMResizeSVGTextObject output:",{textResized:!0})}GetIconShape(){return this.BlockID}PostCreateShapeCallback(t,e,i,o){this.UpdateDimensionLines(e),this.AddIcons(t,e)}GetDimensionPoints(){F.Debug("= S.BaseShape - GetDimensionPoints input:",{});let t=[];t.push(new De(this.Frame.x,this.Frame.y)),this.Frame.width>0&&t.push(new De(this.Frame.x+this.Frame.width,this.Frame.y)),this.Frame.height>0&&t.push(new De(this.Frame.x+this.Frame.width,this.Frame.y+this.Frame.height)),this.RotationAngle;for(let e=0;e<t.length;e++)t[e].x-=this.Frame.x,t[e].y-=this.Frame.y;return F.Debug("= S.BaseShape - GetDimensionPoints output:",t),t}GetDimensionLineDeflection(t,e,i,o){F.Debug("S.BaseShape - GetDimensionLineDeflection input:",{unusedSvgElement:t,pointX:e,pointY:i,deflectionConfig:o});let n,s,a=0,r=[],l=new De(0,0),h=this.GetDimensionPoints();for(n=h.length,a=0;a<n;a++)h[a].x+=this.inside.x,h[a].y+=this.inside.y;l.x=o.knobPoint.x+this.Frame.x-o.adjustForKnob,l.y=o.knobPoint.y+this.Frame.y-o.adjustForKnob,r.push(h[o.segmentIndex-1]),r.push(h[o.segmentIndex]),r.push(new De(l.x,l.y)),r.push(new De(e,i)),si.RotatePointsAboutCenter(this.Frame,-o.ccAngleRadians,r),si.RotatePointsAboutCenter(this.Frame,Math.PI,r),s=r[3].y-r[2].y;const c=o.originalDeflection+s;return F.Debug("S.BaseShape - GetDimensionLineDeflection output:",c),c}DimensionLineDeflectionAdjust(t,e,i,o,n){F.Debug("= S.BaseShape - DimensionLineDeflectionAdjust input:",{svgElement:t,xCoord:e,yCoord:i,additionalParam:o,segmentInfo:n});const s=this.GetDimensionLineDeflection(t,e,i,n);1===n.segmentIndex?this.dimensionDeflectionH=s:this.dimensionDeflectionV=s,this.UpdateDimensionLines(t),this.Dimensions&Se.DimensionFlags.Select&&this.HideOrShowSelectOnlyDimensions(!0),F.Debug("= S.BaseShape - DimensionLineDeflectionAdjust output:",{dimensionDeflectionH:this.dimensionDeflectionH,dimensionDeflectionV:this.dimensionDeflectionV})}MaintainProportions(t,e){F.Debug("= S.BaseShape - MaintainProportions input:",{newWidth:t,newHeight:e});const i=this.Frame.width,o=this.Frame.height;let n=null;if(this.ResizeAspectConstrain){if(null!=t&&i>0)return n=t*(o/i),F.Debug("= S.BaseShape - MaintainProportions output:",n),n;if(null!=e&&o>0)return n=e*(i/o),F.Debug("= S.BaseShape - MaintainProportions output:",n),n}return F.Debug("= S.BaseShape - MaintainProportions output:",n),n}UpdateDimensionFromTextObj(t,e){let i,o;F.Debug("= S.BaseShape - UpdateDimensionFromTextObj input:",{textComponent:t,textData:e}),ye.stdObj.PreserveBlock(this.BlockID);let n,s,a=-1,r=null,l=null;if(e?(n=e.text,s=e.userData):(n=t.GetText(),s=t.GetUserData()),i=s.segment,o=this.GetDimensionValueFromString(n,i),o>=0&&(a=this.GetDimensionLengthFromValue(o)),a<0)return ws.AddToDirtyList(this.BlockID),Os.RenderDirtySVGObjects(),void F.Debug("= S.BaseShape - UpdateDimensionFromTextObj output: Invalid dimension length");1===i?(r=this.MaintainProportions(a,null),this.SetSize(a,r,me.ActionTriggerType.LineLength),this.GetDimensionsForDisplay().width===a&&(this.rwd=o,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!0))):(l=this.MaintainProportions(null,a),this.SetSize(l,a,me.ActionTriggerType.LineLength),this.GetDimensionsForDisplay().height===a&&(this.rht=o,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!0))),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);for(let h=0,c=this.hooks.length;h<c;h++)Ps.SetLinkFlag(this.hooks[h].objid,Ee.LinkFlags.Move);ws.AddToDirtyList(this.BlockID),(this.Frame.x<0||this.Frame.y<0)&&ye.opt.ScrollObjectIntoView(this.BlockID,!1),xs.CompleteOperation(),F.Debug("= S.BaseShape - UpdateDimensionFromTextObj output: update complete")}DimensionEditCallback(t,e,i,o){F.Debug("S.BaseShape - DimensionEditCallback input:",{actionType:t,eventData:e,textObject:i,shapeObject:o});let n=o;switch(t){case"edit":break;case"keyend":if(e.keyCode===Xe.Keys.Tab||e.keyCode===Xe.Keys.Enter)return ye.opt.CloseEdit(),void F.Debug("S.BaseShape - DimensionEditCallback output:",!0);break;case"charfilter":if(ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units===Se.RulerUnit.Feet){if(-1===e.search(/(\d|\.|'|"| )/))return void F.Debug("S.BaseShape - DimensionEditCallback output:",!1)}else if(-1===e.search(/(\d|\.)/))return void F.Debug("S.BaseShape - DimensionEditCallback output:",!1);break;case"activate":{let t=i.svgObj.SDGObj.svgObj.trans.rotation;if(t+=n.RotationAngle,t>=360&&(t-=360),0!==t){let t=n.GetDimensionPoints(),e=[],o=i.userData.segment,s=Oe.CalcAngleFromPoints(t[o-1],t[o]);n.GetDimensionTextInfo(t[o-1],t[o],s,i,o,e,[],[]);let a=360-n.RotationAngle,r=2*Math.PI*(a/360);si.RotatePointsAboutCenter(n.Frame,r,e);let l={};ve.GetPolyRect(l,e);let h={},c=[];h.x=l.x+l.width/2-i.lastFmtSize.width/2,h.y=l.y+l.height/2-i.lastFmtSize.height/2,c.push(new De(h.x,h.y)),si.RotatePointsAboutCenter(n.Frame,-r,c),i.SetPos(c[0].x,c[0].y),i.SetRotation(-n.RotationAngle,c[0].x,c[0].y)}break}case"deactivate":ye.opt.bInDimensionEdit=!1;Oe.DeepCopy(i.GetUserData());n.BlockID,i.GetText(),ws.GetObjectPtr(n.BlockID,!0),n=ws.GetObjectPtr(n.BlockID,!1),n.UpdateDimensionFromTextObj(i);break}F.Debug("S.BaseShape - DimensionEditCallback output: completed")}NoFlip(){let t;return F.Debug("= S.BaseShape - NoFlip input:"),t=this.hooks.length?this.hooks[0].hookpt!==me.HookPts.KAT&&!(this.hooks[0].hookpt>me.HookPts.AK):Boolean(this.extraflags&me.ExtraFlags.NoRotate),F.Debug("= S.BaseShape - NoFlip output:",t),t}Flip(t){if(F.Debug("= S.BaseShape - Flip input:",{flipFlags:t}),""!==this.SymbolURL||""!==this.ImageURL){if(t&me.ExtraFlags.FlipHoriz){const t=0!=(this.extraflags&me.ExtraFlags.FlipHoriz);this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.FlipHoriz,!t)}if(t&me.ExtraFlags.FlipVert){const t=0!=(this.extraflags&me.ExtraFlags.FlipVert);this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.FlipVert,!t)}F.Debug("= S.BaseShape - Flip output:",{extraflags:this.extraflags})}else F.Debug("= S.BaseShape - Flip output: no symbol or image found, nothing flipped")}NoRotate(){F.Debug("= S.BaseShape: NoRotate input: {}");const t=Yo.FindAllChildConnectors(this.BlockID);let e;if(this.hooks.length&&(e=ws.GetObjectPtr(this.hooks[0].objid,!1))&&e.objecttype===Se.FNObjectTypes.ShapeContainer)return F.Debug("= S.BaseShape: NoRotate output: true (hook object is a SHAPECONTAINER)"),!0;if(this.extraflags&me.ExtraFlags.NoRotate)return F.Debug("= S.BaseShape: NoRotate output: true (extraflags SEDE_NoRotate set)"),!0;const i=t.length;for(let o=0;o<i;o++)if(e=ws.GetObjectPtr(t[o],!1),!e.IsFlowChartConnector()&&e.arraylist.hook.length-me.ConnectorDefines.NSkip>0)return F.Debug("= S.BaseShape: NoRotate output: true (child connector condition met at index "+o+")"),!0;return F.Debug("= S.BaseShape: NoRotate output: false"),!1}MaintainPoint(t,e,i,o,n){F.Debug("= S.BaseShape - MaintainPoint input:",{currentPoint:t,targetPoint:e,deltaValue:i,mode:o,extraFlag:n});return F.Debug("= S.BaseShape - MaintainPoint output:",false),false}AddIcon(t,e,i){if(F.Debug("= S.BaseShape - AddIcon input:",{iconData:t,containerElement:e,iconPosition:i}),e){let t=e.GetID(),o=this.Frame;if(t!==this.BlockID){const e=ws.GetObjectPtr(t,!1);e&&(o=e.Frame)}i.x=o.width-this.iconShapeRightOffset-this.iconSize-this.nIcons*this.iconSize,i.y=o.height-this.iconShapeBottomOffset-this.iconSize;const n=this.GenericIcon(i);return this.nIcons++,e.AddElement(n),F.Debug("= S.BaseShape - AddIcon output:",n),n}return F.Debug("= S.BaseShape - AddIcon output:",null),null}GetActionButtons(){F.Debug("= S.BaseShape - GetActionButtons input:",{});if(ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).moreflags&Se.SessionMoreFlags.NoActionButton)return F.Debug("= S.BaseShape - GetActionButtons output:",null),null;if(this.flags&Se.ObjFlags.Lock)return F.Debug("= S.BaseShape - GetActionButtons output:",null),null;const t=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if(this.BlockID===t.theActiveTextEditObjectID||this.BlockID===t.theActiveTableObjectID||this.BlockID===t.theActiveOutlineObjectID)return F.Debug("= S.BaseShape - GetActionButtons output:",null),null;const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);if(e&&e.layers[e.activelayer].flags&Se.LayerFlags.UseEdges)return F.Debug("= S.BaseShape - GetActionButtons output:",null),null;let i=Zo.GetGvSviOpt(this.BlockID);null==i&&(i=ye.wallOpt);let o=null,n=!1,s=!1,a=!1,r=!1,l=!1;i&&!Zo.ShapeCannotHaveActionButtons(this)&&(o=i.AllowActionButtons(this),o&&(n=o.up,s=o.down,a=o.left,r=o.right,o.custom&&(l=!0),o.table&&(l=!0)));const h=n||s||a||r||l?{left:a,right:r,up:n,down:s,custom:l}:null;return F.Debug("= S.BaseShape - GetActionButtons output:",h),h}SetRolloverActions(t,e,i){F.Debug("S.BaseShape - SetRolloverActions input:",{svgEvent:t,rolloverElement:e,domEvent:i});const o=ws.GetObjectPtr(this.BlockID,!1);if(o&&o instanceof dn){const o=Se.FNObjectTypes;switch(this.objecttype){case o.FrameContainer:if(i){const e=ye.opt.svgObjectLayer.FindElementByDOMElement(i.currentTarget).GetTargetForEvent(i);e.GetID()===me.SVGElementClass.Slop&&super.SetRolloverActions(t,e)}return this.SetCursors(),void F.Debug("S.BaseShape - SetRolloverActions output:","Handled SWIMLANE/FRAME_CONTAINER rollover");case o.ShapeContainer:return}if(-1!==ye.opt.curHiliteShape&&ye.opt.curHiliteShape!==this.BlockID){const t=ws.GetObjectPtr(ye.opt.curHiliteShape,!1);t&&(t.SetRuntimeEffects(!1),t.ClearCursors())}const n="actionArrow"+this.BlockID;this.actionArrowHideTimerID>=0&&ye.opt.ClearActionArrowTimer(this.BlockID),yn.RemoveActionArrows(this.BlockID,!0);const s=this.GetActionButtons();if(s){const i=!(s.up||s.left||s.down||s.right||s.custom);if(this.flags&Se.ObjFlags.TextOnly||i)super.SetRolloverActions(t,e);else{const i=this.BlockID,o=this;this.SetRuntimeEffects(!0),this.SetCursors(),ye.opt.curHiliteShape=this.BlockID;let a=[],r=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(r*=2);const l=me.Common.BaseArrowSlop/r,h=me.Common.ConnectorArrowSlop/r;let c=0;const p=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);p&&-1!==p.indexOf(i)&&(c=me.Common.KnobSize/2);let d=0,u=0;if(-1!==ye.opt.actionStoredObjectId||0!==ye.opt.dragBBoxList.length||ye.opt.optSlt)e.svgObj.mouseout((()=>{o.SetRuntimeEffects(!1),o.ClearCursors(),ye.opt.curHiliteShape=-1}));else{let p=l,g=l,y=l,S=l,m=null;const b={lindex:-1,id:-1,hookpt:0};for(;ye.opt.FindChildArrayByIndex(this.BlockID,b)>0;){m=ws.GetObjectPtr(b.id,!1);const t=(m.arraylist.styleflags&me.AStyles.CoManager)>0,e=m.IsChildOfAssistant(),i=m.IsFlowChartConnector();let o=m.arraylist.hook.length-me.ConnectorDefines.NSkip;if(o<0&&(o=0),0!==o&&!i&&!t&&!e&&b.hookpt)switch(b.hookpt){case me.HookPts.LL:g=h,d+=h-l;break;case me.HookPts.LR:p=h,d-=h-l;break;case me.HookPts.LT:S=h,u+=h-l;break;case me.HookPts.LB:y=h,u-=h-l}}const D=t.CreateShape(me.CSType.Group);D.SetID(n),D.SetUserData(i);const f=me.Common.ActionArrowSizeV/r,x=me.Common.ActionArrowSizeH/r;let C;C.x-=f+g+c,C.y-=f+y+c,C.width+=2*f+(g+p)+2*c,C.height+=2*f+(y+S)+2*c;const P=C.width/2-d/2,T=C.height/2-u/2;if(s.custom){const e=(new LineDraw).CreateCustomActionButtons(t,this,0,this.BlockID);if(e){Oe.DeepCopy(this.Frame);for(let t=0;t<e.length;t++){const o=e[t];o.SetID(me.ActionArrow.Custom+t),o.SetUserData(i),D.AddElement(o),a.push(o.DOMElement())}}}if(s.left){let e=(new LineDraw).CreateActionButton(t,g,T,this.BlockID);if(null==e){e=t.CreateShape(me.CSType.Path);const i=e.PathCreator();i.BeginPath(),i.MoveTo(0,T),i.LineTo(f,T-x/2),i.LineTo(f,T+x/2),i.LineTo(0,T),i.ClosePath(),i.Apply(),e.SetFillColor("#FF0000"),e.SetStrokeWidth(0),e.SetCursor(ze.CursorType.AddLeft)}e.SetID(me.ActionArrow.Left),e.SetUserData(i),D.AddElement(e),a.push(e.DOMElement())}if(s.up){let e=(new LineDraw).CreateActionButton(t,P,y,this.BlockID);if(null==e){e=t.CreateShape(me.CSType.Path);const i=e.PathCreator();i.BeginPath(),i.MoveTo(P,0),i.LineTo(P-x/2,f),i.LineTo(P+x/2,f),i.LineTo(P,0),i.ClosePath(),i.Apply(),e.SetFillColor("#FFD64A"),e.SetStrokeWidth(0),e.SetCursor(ze.CursorType.AddUp)}e.SetID(me.ActionArrow.Up),e.SetUserData(i),D.AddElement(e),a.push(e.DOMElement())}if(s.right){let e=(new LineDraw).CreateActionButton(t,C.width-g,T,this.BlockID);if(null==e){e=t.CreateShape(me.CSType.Path);const i=e.PathCreator();i.BeginPath(),i.MoveTo(C.width,T),i.LineTo(C.width-f,T-x/2),i.LineTo(C.width-f,T+x/2),i.LineTo(C.width,T),i.ClosePath(),i.Apply(),e.SetFillColor("#FFD64A"),e.SetStrokeWidth(0),e.SetCursor(ze.CursorType.AddRight)}e.SetID(me.ActionArrow.Right),e.SetUserData(i),D.AddElement(e),a.push(e.DOMElement())}if(s.down){let e=(new LineDraw).CreateActionButton(t,P,C.height-y,this.BlockID);if(null==e){e=t.CreateShape(me.CSType.Path);const i=e.PathCreator();i.BeginPath(),i.MoveTo(P,C.height),i.LineTo(P-x/2,C.height-f),i.LineTo(P+x/2,C.height-f),i.LineTo(P,C.height),i.ClosePath(),i.Apply(),e.SetFillColor("#FFD64A"),e.SetStrokeWidth(0),e.SetCursor(ze.CursorType.AddDown)}e.SetID(me.ActionArrow.Down),e.SetUserData(i),D.AddElement(e),a.push(e.DOMElement())}D.SetSize(C.width,C.height),D.SetPos(C.x,C.y),(new LineDraw).RotateActionButtons()&&D.SetRotation(this.RotationAngle),ye.opt.svgOverlayLayer.AddElement(D);const O=function(t){ve.StopPropagationAndDefaults(t);const e=ye.opt.svgOverlayLayer.FindElementByDOMElement(t.currentTarget);if(e){const i=e.GetTargetForEvent(t);if(i){const o=i.GetID(),n=e.GetUserData(),s=ws.GetObjectPtr(n,!1);s&&s instanceof dn&&null!=o&&null!=n&&(new LineDraw).ActionClick(t,n,o,null)}}},v=function(t){if(rn.IsWheelClick(t)||Ae.DocContext.SpacebarDown)return Ls.Evt_WorkAreaHammerDragStart(t),ve.StopPropagationAndDefaults(t),!1;Ae.DocContext.HTMLFocusControl&&Ae.DocContext.HTMLFocusControl.blur&&Ae.DocContext.HTMLFocusControl.blur();const e=ye.opt.svgOverlayLayer.FindElementByDOMElement(t.currentTarget);if(e){const i=e.GetTargetForEvent(t);if(i){const o=i.GetID(),n=e.GetUserData(),s=ws.GetObjectPtr(n,!1);if(!(s&&s instanceof dn))return!1;switch(o){case me.ActionArrow.Up:AddAbove(t,n);break;case me.ActionArrow.Left:AddLeft(t,n);break;case me.ActionArrow.Down:AddBelow(t,n);break;case me.ActionArrow.Right:AddRight(t,n);break;default:o>=me.ActionArrow.Custom&&AddCustom(t,n,o-me.ActionArrow.Custom)}return!1}}},w=function(t){yn.SetActionArrowTimer(i)},k=function(t){yn.ClearActionArrowTimer(i)};for(let t=0;t<a.length;t++){const e=a[t],i=new Hammer(e);i.on("dragstart",v),i.on("click",O),e.onmouseout=w,e.onmouseover=k}e.svgObj.mouseout((()=>{yn.SetActionArrowTimer(i),o.SetRuntimeEffects(!1),o.ClearCursors(),ye.opt.curHiliteShape=-1}))}}}else super.SetRolloverActions(t,e)}F.Debug("S.BaseShape - SetRolloverActions output:","Completed rollover actions setup")}UseEdges(t,e,i,o,n,s){let a;F.Debug("S.ArcSegmentedLine - UseEdges input:",{isHorizontalExplicit:t,isVerticalExplicit:e,horizontalCondition:i,verticalCondition:o,oldPoint:n,newPoint:s});let r=0,l=0,h=0,c=0,p=0,d=0,u=!1;if(n.x!==s.x&&(t&&i?(r=s.x-n.x,u=!0):(a=this.Frame.x+this.Frame.width/2,Math.abs(a-n.x/2)<100?(p=(s.x-n.x)/2,u=!0):this.Frame.x>n.x/2&&(p=s.x-n.x,u=!0))),n.y!==s.y&&(e&&o?(l=s.y-n.y,u=!0):(a=this.Frame.y+this.Frame.height/2,Math.abs(a-n.y/2)<100?(d=(s.y-n.y)/2,u=!0):this.Frame.y>n.y/2&&(d=s.y-n.y,u=!0))),u){ws.GetObjectPtr(this.BlockID,!0),(p||d)&&this.OffsetShape(p,d);const t=this.Frame.y+this.Frame.height;return(r||l)&&(r&&(h=this.Frame.width+r),l&&(c=this.Frame.height+l),this.SetSize(h,c,me.ActionTriggerType.LineLength),this.objecttype===Se.FNObjectTypes.Annotation&&(d=t-(this.Frame.y+this.Frame.height),p=0,(p||d)&&this.OffsetShape(p,d))),ws.AddToDirtyList(this.BlockID),F.Debug("S.ArcSegmentedLine - UseEdges output:",!0),!0}return F.Debug("S.ArcSegmentedLine - UseEdges output:",!1),!1}PrUpdateExtra(t){F.Debug("S.BaseShape - prUpdateExtra input:",{extraAmount:t,currentBlockId:this.BlockID});const e=this.BlockID,i=ws.GetObjectPtr(this.hooks[0].objid,!0);if(i&&i instanceof we.Shape.ShapeContainer){const o=i.ContainerList;if(!(o.flags&Se.ContainerListFlags.Sparse)){const n=o.List.length;for(let s=0;s<n;s++)if(o.List[s].id===e)return o.List[s].extra+=t,o.List[s].extra<0&&(o.List[s].extra=0),Ps.SetLinkFlag(i.BlockID,Ee.LinkFlags.Move),i.flags=ve.SetFlag(i.flags,Se.ObjFlags.Obj1,!0),void F.Debug("S.BaseShape - prUpdateExtra output:",{updatedExtra:o.List[s].extra})}}F.Debug("S.BaseShape - prUpdateExtra output: no update performed")}PrGetAdjustShapeList(){F.Debug("S.ArcSegmentedLine - PrGetAdjustShapeList input:");let t=[],e=[],i=[],o=!1;const n=function(o){const n=ws.GetObjectPtr(o,!1);if(n){const s=n.GetSVGFrame();i.push(s),t.push(o),e.push(o)}};if(this.hooks.length>0){const s=this.BlockID;let a=0;const r=ws.GetObjectPtr(this.hooks[0].objid,!1);if(r&&r instanceof we.Shape.ShapeContainer){const l=r.ContainerList;if(!(l.flags&Se.ContainerListFlags.Sparse)){const r=l.List.length;for(let t=0;t<r;t++)l.List[t].id===s?(a=l.List[t].extra,n(s),o=!0):o&&n(l.List[t].id);return F.Debug("S.ArcSegmentedLine - PrGetAdjustShapeList output:",{list:t,svglist:e,framelist:i,oldextra:a,arrangement:l.Arrangement}),{list:t,svglist:e,framelist:i,oldextra:a,arrangement:l.Arrangement}}}}return F.Debug("S.ArcSegmentedLine - PrGetAdjustShapeList output: null"),null}OnDisconnect(t,e,i,o){if(F.Debug("S.ArcSegmentedLine - OnDisconnect input:",{elementId:t,container:e,disconnectData:i,reason:o}),e instanceof we.Shape.ShapeContainer&&null!=this.zListIndex&&this.zListIndex>=0){const e=ye.opt.svgObjectLayer.GetElementById(t);e&&(ye.opt.svgObjectLayer.RemoveElement(e),ye.opt.svgObjectLayer.AddElement(e,this.zListIndex),this.zListIndex=-1)}F.Debug("S.ArcSegmentedLine - OnDisconnect output: completed")}RightClick(t){F.Debug("= s.BaseShape: RightClick/ - RightClick input:",t);const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),i=me.ShapeType,o=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);let n=o.GetID(),s=ws.GetObjectPtr(n,!1);if(s&&s instanceof dn){if(!Qo.SelectObjectFromClick(t,o))return!1;if(ye.docUtil.IsReadOnly())return ye.opt.rClickParam=new Le,ye.opt.rClickParam.targetId=o.GetID(),ye.opt.rClickParam.hitPoint.x=e.x,ye.opt.rClickParam.hitPoint.y=e.y,ye.opt.rClickParam.locked=(this.flags&Se.ObjFlags.Lock)>0,Ts.ShowContextMenu(!0,"Shape","ReadOnly"),!1;const a=o.GetID(),r=o.GetTargetForEvent(t).GetID();if(s=ws.GetObjectPtr(a,!1),s){let e=(s.TextFlags&Se.TextFlags.OneClick)>0&&r!==me.SVGElementClass.Slop;if((s.AllowTextEdit()||(e=!1))&&(s.GetTextObject(t,!0)>=0||e)){const i=o.textElem;let n=-1;(i||e)&&(i&&(n=i.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY)),(n>=0||e)&&on.ActivateTextEdit(o,t,!0))}}ye.opt.rClickParam=new Le,ye.opt.rClickParam.targetId=o.GetID(),ye.opt.rClickParam.hitPoint.x=e.x,ye.opt.rClickParam.hitPoint.y=e.y,ye.opt.rClickParam.locked=(this.flags&Se.ObjFlags.Lock)>0;if(null!=on.GetActiveTextEdit()){const e=ye.opt.svgDoc.GetActiveEdit();e.GetSelectedRange(),e&&e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY)}else switch(ye.opt.rClickParam.targetId=n,s=ws.GetObjectPtr(n,!1),s.objecttype){case Se.FNObjectTypes.FrameContainer:Ts.ShowContextMenu(!0,"FrameContainer","Default");break;case Se.FNObjectTypes.Multiplicity:Ts.ShowContextMenu(!0,"Multiplicity","Default");break;case Se.FNObjectTypes.ShapeContainer:Ts.ShowContextMenu(!0,"ShapeContainer","Default");default:if(s.ShapeType===i.RRect)s.ImageURL&&s.ImageURL.length||s.EMFHash&&s.EMFHash.length?$n.ShowContextMenu(!0,"Image","Default"):$n.ShowContextMenu(!0,"RRect","Default");else Ts.ShowContextMenu(!0,"Shape","Default"),F.Debug("S.BaseShape - RightClick: Displayed Quasar context menu")}}}}class Qn extends Zn{constructor(t){F.Debug("= S.Rect constructor Input:",t),(t=t||{}).ShapeType=me.ShapeType.Rect,t.moreflags|=me.ObjMoreFlags.FixedRR,t.uniType="Rect",super(t),this.dataclass=t.dataclass||tn.ShapeTypes.RECTANGLE,this.nativeDataArrayBuffer=t.nativeDataArrayBuffer||null,this.SymbolData=t.SymbolData||null,F.Debug("= S.Rect constructor Output:",this)}CreateShape(t,e){if(this.flags&Se.ObjFlags.NotVisible)return null;const i=t.CreateShape(me.CSType.ShapeContainer),o={...this.Frame},n=this.StyleRecord;n.Line.BThick&&null===this.polylist&&ve.InflateRect(o,n.Line.BThick,n.Line.BThick);const s=this.SVGTokenizerHook(n),a=s.Line.Paint.Color,r=s.Line.Thickness,l=s.Line.LinePattern,h=s.Line.Paint.Opacity,c=o.width,p=o.height;i.SetSize(c,p),i.SetPos(o.x,o.y);const d=this.RRectGetCornerSize();let u;if(this.SymbolURL){const e=t.CreateShape(me.CSType.Rect);e.SetID(me.SVGElementClass.Shape),e.SetSize(c,p),e.SetImageFill(this.SymbolURL,{scaleType:"NOPROP"});const o=(this.extraflags&me.ExtraFlags.FlipHoriz)>0,n=(this.extraflags&me.ExtraFlags.FlipVert)>0;o&&e.SetMirror(o),n&&e.SetFlip(n),i.AddElement(e),this.GetFieldDataStyleOverride()}else d>0?(u=t.CreateShape(me.CSType.RRect),u.SetRRectSize(c,p,d,d)):u=t.CreateShape(me.CSType.Rect),u.SetStrokeColor(a),u.SetStrokeOpacity(h),u.SetStrokeWidth(r),0!==l&&u.SetStrokePattern(l),u.SetID(me.SVGElementClass.Shape),u.SetSize(c,p),i.AddElement(u);if(this.ApplyStyles(u,s),this.ApplyEffects(i,!1,!1),!(this instanceof we.Shape.ShapeContainer)){let o=me.Common.Slop;const n=p,a=c;let l;if(d>0?(l=t.CreateShape(me.CSType.RRect),l.SetRRectSize(a,n,d,d)):l=t.CreateShape(me.CSType.Rect),l.SetStrokeColor("white"),l.SetFillColor("none"),l.SetOpacity(0),l.SetStrokeWidth(r+o),e){const t=this.SymbolURL||s.Fill.Paint.FillType===Se.FillTypes.Transparent&&this.DataID>=0;l.SetEventBehavior(t?me.EventBehavior.HiddenAll:me.EventBehavior.HiddenOut)}else l.SetEventBehavior(me.EventBehavior.None);l.SetID(me.SVGElementClass.Slop),l.ExcludeFromExport(!0),l.SetSize(a||1,n),i.AddElement(l)}const g=s.Fill.Hatch;if(g&&0!==g){let e;d>0?(e=t.CreateShape(me.CSType.RRect),e.SetRRectSize(c,p,d,d)):e=t.CreateShape(me.CSType.Rect),e.SetID(me.SVGElementClass.Hatch),e.SetSize(c,p),e.SetStrokeWidth(0),this.SetFillHatch(e,g),i.AddElement(e)}return i.isShape=!0,this.DataID>=0&&this.LMAddSVGTextObject(t,i),i}GetCornerSize(t){F.Debug("= S.Rect GetCornerSize Input:",t);const e=this.RRectGetCornerSize(t);return F.Debug("= S.Rect GetCornerSize Output:",e),e}RRectGetCornerSize(t){F.Debug("= S.Rect RRectGetCornerSize Input:",t);let e=this.Frame.width,i=this.Frame.height,o=e<i?e:i;if(t&&(o=t),this.moreflags&me.ObjMoreFlags.FixedRR){let t=me.Common.RRectFixedDim*this.shapeparam,e=.4*o;return t>e&&(t=e),F.Debug("= S.Rect RRectGetCornerSize Output:",t),t}let n=o*this.shapeparam;return F.Debug("= S.Rect RRectGetCornerSize Output:",n),n}GetPolyPoints(t,e,i,o,n){F.Debug("= S.Rect GetPolyPoints Input:",{event:t,type:e,arg:i,rect:o,index:n});let s;return s=this.RRectGetCornerSize()>0?this.RRectGetPolyPoints(t,e,i,o,n):this.BaseDrawingObjectGetPolyPoints(t,e,i,o,n),F.Debug("= S.Rect GetPolyPoints Output:",s),s}RRectGetPolyPoints(t,e,i,o,n){F.Debug("= S.Rect RRectGetPolyPoints Input:",{event:t,type:e,arg:i,rect:o,index:n});let s=[],a={},r={};ve.CopyRect(a,this.Frame);let l=this.StyleRecord.Line.Thickness/2;o&&ve.InflateRect(a,l,l);let h=this.GetCornerSize();if(r.x=0,r.y=0,r.width=h,r.height=2*h,en.PolyYCurve(s,r,t/2,0,0,0,h,!0),r.x=0,r.y=a.height-2*h,r.width=h,r.height=2*h,en.PolyYCurve(s,r,t/2,0,0,h,0,!0),r.x=a.width-h,r.y=a.height,r.width=h,r.height=-2*h,en.PolyYCurve(s,r,t/2,0,0,0,-h,!1),r.x=a.width-h,r.y=2*h,r.width=h,r.height=-2*h,en.PolyYCurve(s,r,t/2,0,0,-h,0,!1),s.push(new De(s[0].x,s[0].y)),!e)for(let c=0,p=s.length;c<p;c++)s[c].x+=a.x,s[c].y+=a.y;return F.Debug("= S.Rect RRectGetPolyPoints Output:",s),s}BaseDrawingObjectGetPolyPoints(t,e,i,o,n){F.Debug("= S.Rect BaseDrawingObjectGetPolyPoints Input:",{event:t,type:e,arg:i,rect:o,index:n});let s=[],a={};ve.CopyRect(a,this.Frame);let r=this.StyleRecord.Line.Thickness/2;if(o&&ve.InflateRect(a,r,r),s.push(new De(0,0)),s.push(new De(a.width,0)),s.push(new De(a.width,a.height)),s.push(new De(0,a.height)),s.push(new De(0,0)),!e)for(let l=0,h=s.length;l<h;l++)s[l].x+=a.x,s[l].y+=a.y;return F.Debug("= S.Rect BaseDrawingObjectGetPolyPoints Output:",s),s}ExtendLines(t){F.Debug("= S.Rect ExtendLines Input:",t),this.RRectGetCornerSize(),F.Debug("= S.Rect ExtendLines Output")}SetShapeIndent(t){F.Debug("= S.Rect SetShapeIndent Input:",t);let e;return this.RRectGetCornerSize()>0?e=this.RRectSetShapeIndent(t):(this.left_sindent=0,this.right_sindent=0,this.top_sindent=0,this.bottom_sindent=0,e=super.SetShapeIndent(t)),F.Debug("= S.Rect SetShapeIndent Output:",e),e}RRectSetShapeIndent(t){F.Debug("= S.Rect RRectSetShapeIndent Input:",t);let e=this.inside.width,i=this.inside.height,o=e<i?e:i,n=this.shapeparam;if(this.moreflags&me.ObjMoreFlags.FixedRR){let e=o;t&&(e+=this.GetCornerSize()*me.Common.RoundFactor*2,e=o+this.GetCornerSize(e)*me.Common.RoundFactor*2),n=this.GetCornerSize(e)/e}this.left_sindent=n*me.Common.RoundFactor,this.top_sindent=this.left_sindent,this.right_sindent=this.left_sindent,this.bottom_sindent=this.left_sindent;let s=1,a=1,r=1,l=1;t&&(s=a=r=l=1-2*this.left_sindent),this.tindent.left=this.left_sindent*e/s,this.tindent.top=this.top_sindent*i/a,this.tindent.right=this.right_sindent*e/r,this.tindent.bottom=this.bottom_sindent*i/l,F.Debug("= S.Rect RRectSetShapeIndent Output:",{left_sindent:this.left_sindent,top_sindent:this.top_sindent,right_sindent:this.right_sindent,bottom_sindent:this.bottom_sindent,tindent:this.tindent})}SetShapeProperties(t){F.Debug("= S.Rect SetShapeProperties Input:",t);let e=!1;const i=me.ObjMoreFlags.FixedRR;if(t.hasrrectselected){const o=(this.moreflags&i)>0!==t.rrectfixed,n=t.rrectparam!==this.shapeparam;(o||n)&&(this.moreflags=ve.SetFlag(this.moreflags,i,t.rrectfixed),this.shapeparam=t.rrectparam,0===this.shapeparam&&(this.left_sindent=0,this.top_sindent=0,this.right_sindent=0,this.bottom_sindent=0,this.tindent.left=0,this.tindent.top=0,this.tindent.right=0,this.tindent.bottom=0),this.SetSize(this.Frame.width,0,me.ActionTriggerType.LineLength),0===this.shapeparam&&this.ExtendLines(!0),e=!0)}return we.Shape.BaseShape.prototype.SetShapeProperties.call(this,t)&&(e=!0),F.Debug("= S.Rect SetShapeProperties Output:",e),e}ApplyCurvature(t){F.Debug("= S.Rect ApplyCurvature Input:",t);var e={hasrrectselected:!0,rrectfixed:!0,rrectparam:t};this.SetShapeProperties(e),F.Debug("= S.Rect ApplyCurvature Output: Shape properties updated")}}class ts{constructor(){a(this,"StartArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowID"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),this.StartArrowID=0,this.StartArrowDisp=!1,this.EndArrowID=0,this.EndArrowDisp=!1,this.ArrowSizeIndex=1}}class es extends dn{constructor(t){F.Debug("= S.BaseLine: constructor called with input:",t),(t=t||{}).DrawingObjectBaseClass=me.DrawObjectBaseClass.Line,t.maxhooks=2,void 0===t.targflags&&(t.targflags=Se.HookFlags.LcLine|Se.HookFlags.LcAttachToLine),void 0===t.hookflags&&(t.hookflags=Se.HookFlags.LcShape|Se.HookFlags.LcLine),super(t),a(this,"LineType"),a(this,"linetrect"),a(this,"theMinTextDim"),a(this,"TextWrapWidth"),a(this,"polylist"),a(this,"StartArrowID"),a(this,"EndArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),this.LineType=t.LineType,this.linetrect={x:0,y:0,width:0,height:0},this.theMinTextDim={width:0,height:0},this.TextWrapWidth=0,this.iconShapeBottomOffset=20,this.iconShapeRightOffset=0,F.Debug("= S.BaseLine: constructor output:",this)}checkIfPolyLine(t){F.Debug("= S.BaseLine: checkIfPolyLine called with input:",t);const e=t instanceof we.Shape.PolyLine;return F.Debug("= S.BaseLine: checkIfPolyLine output:",e),e}CalcFrame(t){F.Debug("= S.BaseLine: CalcFrame called with inputFlag =",t);let e=!1;this.Frame=ve.Pt2Rect(this.StartPoint,this.EndPoint),F.Debug("= S.BaseLine: Initial Frame calculated as",this.Frame),this.LineType===me.LineType.SEGLINE&&(e=!0,F.Debug("= S.BaseLine: LineType is SEGLINE, setting isSegLine to",e));const i=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,e,!1,null);F.Debug("= S.BaseLine: Retrieved polyPoints:",i),i&&i.length&&(ve.GetPolyRect(this.Frame,i),F.Debug("= S.BaseLine: Updated Frame using polyPoints:",this.Frame)),this.UpdateFrame(this.Frame,t),F.Debug("= S.BaseLine: Final Frame after UpdateFrame:",this.Frame)}GetArrowheadFormat(){F.Debug("= S.BaseLine: GetArrowheadFormat called"),F.Debug("= S.BaseLine: Input this =",this);const t=new ts;return Vo.LineIsReversed(this,null,!1)?(F.Debug("= S.BaseLine: Line is reversed"),t.StartArrowID=this.EndArrowID,t.EndArrowID=this.StartArrowID,t.StartArrowDisp=this.EndArrowDisp,t.EndArrowDisp=this.StartArrowDisp):(F.Debug("= S.BaseLine: Line is not reversed"),t.StartArrowID=this.StartArrowID,t.EndArrowID=this.EndArrowID,t.StartArrowDisp=this.StartArrowDisp,t.EndArrowDisp=this.EndArrowDisp),t.ArrowSizeIndex=this.ArrowSizeIndex,F.Debug("= S.BaseLine: Output ArrowheadRecord =",t),t}GetSVGFrame(t){F.Debug("= S.BaseLine: GetSVGFrame called with input:",t);let e={};return null!=t?ve.CopyRect(e,t):e=ve.Pt2Rect(this.StartPoint,this.EndPoint),F.Debug("= S.BaseLine: GetSVGFrame output:",e),e}GetPositionRect(){F.Debug("= S.BaseLine: GetPositionRect called with StartPoint:",this.StartPoint,"and EndPoint:",this.EndPoint);const t=ve.Pt2Rect(this.StartPoint,this.EndPoint);return F.Debug("= S.BaseLine: GetPositionRect output:",t),t}AdjustPinRect(t,e,i){F.Debug("= S.BaseLine: AdjustPinRect called with",{pinRect:t,offset:e,additional:i});const o=t;return F.Debug("= S.BaseLine: AdjustPinRect output:",o),o}GetDimensions(){F.Debug("= S.BaseLine: GetDimensions called with StartPoint:",this.StartPoint,"and EndPoint:",this.EndPoint);const t=this.EndPoint.x-this.StartPoint.x,e=this.EndPoint.y-this.StartPoint.y,i={x:ve.Sqrt(t*t+e*e),y:0};return F.Debug("= S.BaseLine: GetDimensions output:",i),i}GetDimensionsForDisplay(){F.Debug("= S.BaseLine: GetDimensionsForDisplay called with no input parameters");const t=this.GetDimensions();F.Debug("= S.BaseLine: Dimensions retrieved:",t);const e={x:this.Frame.x,y:this.Frame.y,width:t.x,height:t.y};return F.Debug("= S.BaseLine: GetDimensionsForDisplay output:",e),e}GetSnapRect(){F.Debug("= S.BaseLine: GetSnapRect called with no input");let t={};if(ve.CopyRect(t,this.Frame),F.Debug("= S.BaseLine: Initial snapRect copied from Frame:",t),this.objecttype===Se.FNObjectTypes.FlWall){let e=0,i=0;0===t.width&&(e=this.StyleRecord.Line.Thickness/2),0===t.height&&(i=this.StyleRecord.Line.Thickness/2),ve.InflateRect(t,e,i),F.Debug("= S.BaseLine: snapRect after inflation for wall opt wall:",t)}return F.Debug("= S.BaseLine: GetSnapRect returning:",t),t}CanSnapToShapes(t){if(F.Debug("= S.BaseLine: CanSnapToShapes called with input:",t),t&&this.objecttype===Se.FNObjectTypes.FlWall){if(ve.IsEqual(this.StartPoint.x,this.EndPoint.x,this.StyleRecord.Line.BThick))return t.distanceonly=Se.GuideDistanceTypes.Vertical_Wall,F.Debug("= S.BaseLine: CanSnapToShapes output:",this.BlockID,"for Vertical_Wall"),this.BlockID;if(ve.IsEqual(this.StartPoint.y,this.EndPoint.y,this.StyleRecord.Line.BThick))return t.distanceonly=Se.GuideDistanceTypes.Horizontal_Wall,F.Debug("= S.BaseLine: CanSnapToShapes output:",this.BlockID,"for Horizontal_Wall"),this.BlockID}return F.Debug("= S.BaseLine: CanSnapToShapes output: -1"),-1}IsSnapTarget(){F.Debug("= S.BaseLine: IsSnapTarget called with no input");return F.Debug("= S.BaseLine: IsSnapTarget output:",false),false}GuideDistanceOnly(){F.Debug("= S.BaseLine: GuideDistanceOnly called");const t=!!(this.objecttype===Se.FNObjectTypes.FlWall)&&Se.GuideDistanceTypes.PolyWall;return F.Debug("= S.BaseLine: GuideDistanceOnly returning",t),t}CreateDimension(t,e,i,o,n,s,a,r,l,h,c){if(F.Debug("= S.BaseLine: CreateDimension called with input:",{startPoint:t,endPoint:e,dimensionParam:i,extraParam1:o,extraParam2:n,extraParam3:s,extraParam4:a,extraParam5:r,extraParam6:l,extraParam7:h,extraParam8:c}),!i||this instanceof we.Shape.PolyLine&&this.polylist&&this.polylist.closed){const p=super.CreateDimension(t,e,i,o,n,s,a,r,l,h,c);return F.Debug("= S.BaseLine: CreateDimension output:",p),p}F.Debug("= S.BaseLine: CreateDimension condition not met, returning undefined.")}GetDimensionTextForPoints(t,e){F.Debug("= S.BaseDrawObject: GetDimensionTextForPoints input:",{startPoint:t,endPoint:e});let i=0;if(this.Dimensions&Se.DimensionFlags.Total){const t=this.GetPolyPoints(200,!0,!1,!1,null);for(let e=1;e<t.length;e++){const o=Math.abs(t[e].x-t[e-1].x),n=Math.abs(t[e].y-t[e-1].y);0===o&&0===n||(i+=Math.sqrt(o*o+n*n))}}else{const o=360-Oe.CalcAngleFromPoints(t,e),n=2*Math.PI*(o/360),s=[new De(t.x,t.y),new De(e.x,e.y)];si.RotatePointsAboutCenter(this.Frame,-n,s),i=Math.abs(s[0].x-s[1].x)}const o=Ve.GetLengthInRulerUnits(i);return F.Debug("= S.BaseDrawObject: GetDimensionTextForPoints output:",o),o}EnforceMinimum(t){F.Debug("= S.BaseDrawObject: EnforceMinimum input:",{isPrimary:t,StartPoint:this.StartPoint,EndPoint:this.EndPoint});const e=me.Common.MinDim;if(ve.IsEqual(this.EndPoint.x,this.StartPoint.x)){const i=this.EndPoint.y-this.StartPoint.y;Math.abs(i)<e&&this.hooks.length<2&&(i>=0?t?this.StartPoint.y=this.EndPoint.y-e:this.EndPoint.y=this.StartPoint.y+e:t?this.StartPoint.y=this.EndPoint.y+e:this.EndPoint.y=this.StartPoint.y-e)}else if(ve.IsEqual(this.EndPoint.y,this.StartPoint.y)){const i=this.EndPoint.x-this.StartPoint.x;Math.abs(i)<e&&this.hooks.length<2&&(i>=0?t?this.StartPoint.x=this.EndPoint.x-e:this.EndPoint.x=this.StartPoint.x+e:t?this.StartPoint.x=this.EndPoint.x+e:this.EndPoint.x=this.StartPoint.x-e)}else{const i=this.EndPoint.x-this.StartPoint.x,o=this.EndPoint.y-this.StartPoint.y;Math.abs(i)<e&&Math.abs(o)<e&&this.hooks.length<2&&(Math.abs(i)>=Math.abs(o)?i>=0?t?this.StartPoint.x=this.EndPoint.x-e:this.EndPoint.x=this.StartPoint.x+e:t?this.StartPoint.x=this.EndPoint.x+e:this.EndPoint.x=this.StartPoint.x-e:o>=0?t?this.StartPoint.y=this.EndPoint.y-e:this.EndPoint.y=this.StartPoint.y+e:t?this.StartPoint.y=this.EndPoint.y+e:this.EndPoint.y=this.StartPoint.y-e)}F.Debug("= S.BaseDrawObject: EnforceMinimum output:",{StartPoint:this.StartPoint,EndPoint:this.EndPoint})}UpdateDimensions(t,e,i){F.Debug("= S.BaseLine: UpdateDimensions called with input:",{newLength:t,unusedParam1:e,unusedParam2:i});let o=0,n=0,s=0,a=0,r=0;const l=[],h=ve.Pt2Rect(this.StartPoint,this.EndPoint);l.push(new De(this.StartPoint.x-h.x,this.StartPoint.y-h.y)),l.push(new De(this.EndPoint.x-h.x,this.EndPoint.y-h.y)),o=360-Oe.CalcAngleFromPoints(l[0],l[1]);const c=2*Math.PI*(o/360);si.RotatePointsAboutCenter(this.Frame,-c,l),l[0].x<l[1].x?l[1].x=l[0].x+t:l[1].x=l[0].x-t,si.RotatePointsAboutCenter(this.Frame,c,l),n=l[1].x+h.x,s=l[1].y+h.y,n<0&&(a=-n,n=0),s<0&&(r+=-s,(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&(r+=me.Common.DimDefaultStandoff),s+=r);const p=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.AdjustLineEnd(p,n,s,me.ActionTriggerType.LineEnd,!0),(a>0||r>0)&&(n=this.StartPoint.x+a,s=this.StartPoint.y+r,this.AdjustLineStart(p,n,s,me.ActionTriggerType.LineStart,!0)),F.Debug("= S.BaseLine: UpdateDimensions output: StartPoint:",this.StartPoint,"EndPoint:",this.EndPoint)}OffsetShape(t,e){F.Debug("= S.BaseLine: OffsetShape called with offsetX:",t,"offsetY:",e),this.Frame.x+=t,this.Frame.y+=e,this.r.x+=t,this.r.y+=e,this.StartPoint.x+=t,this.StartPoint.y+=e,this.EndPoint.x+=t,this.EndPoint.y+=e,this.CalcFrame(),F.Debug("= S.BaseLine: OffsetShape updated Frame:",this.Frame,"StartPoint:",this.StartPoint,"EndPoint:",this.EndPoint)}SetShapeOrigin(t,e,i){F.Debug("= S.BaseLine: SetShapeOrigin called with newX:",t,"newY:",e,"additionalParam:",i);const o=this.GetSVGFrame();let n=0,s=0;null!=t&&(n=o.x-t),null!=e&&(s=o.y-e),this.StartPoint.x-=n,this.StartPoint.y-=s,this.EndPoint.x-=n,this.EndPoint.y-=s,this.CalcFrame(),F.Debug("= S.BaseLine: SetShapeOrigin updated StartPoint:",this.StartPoint,"EndPoint:",this.EndPoint)}UpdateFrame(t,e){var i,o,n;let s,a;F.Debug("= S.BaseLine: UpdateFrame called with inputFrame:",t,"shouldRedraw:",e);let r=t||this.Frame,l=this.LineTextX?Oe.DeepCopy(this.trect):null,h=(null==(o=null==(i=this.StyleRecord)?void 0:i.Line)?void 0:o.Thickness)||0,c=Math.max(h,me.Common.MinWidth);super.UpdateFrame(r);let p=Oe.DeepCopy(this.linetrect);if(p.x+=this.Frame.x,p.y+=this.Frame.y,null==(null==(n=this.StartPoint)?void 0:n.x)&&(e=!1),ye.opt&&(a=ye.opt.svgObjectLayer.GetElementById(this.BlockID),e?(a&&ye.opt.svgObjectLayer.RemoveElement(a),a=this.CreateShape(ye.opt.svgDoc,!1)):a&&(r=this.GetSVGFrame(),a=a.GetElementById(me.SVGElementClass.Shape)),a&&(s=a.GetArrowheadBounds(),s&&s.length)))for(let d=0;d<s.length;d++)s[d].x+=r.x,s[d].y+=r.y,this.r=ve.UnionRect(s[d],this.r,this.r);if(ve.InflateRect(this.r,c/2,c/2),this.StyleRecord){let t=this.CalcEffectSettings(this.Frame,this.StyleRecord,!1);t&&ve.Add2Rect(this.r,t.extent)}if(this.DataID>=0&&this.linetrect.width&&(this.r=ve.UnionRect(p,this.r,this.r)),this.AddDimensionsToR(),this.TextGrow===Se.TextGrowBehavior.Vertical&&!this.LineTextX){let t=this.GetTextOnLineParams(this.BlockID),e=ve.Pt2Rect(t.StartPoint,t.EndPoint);if(!this.TextWrapWidth){let t=Math.sqrt(r.width**2+r.height**2);this.TextWrapWidth=t/2}let i=e.width-this.TextWrapWidth;switch(Vo.TextAlignToWin(this.TextAlign).just){case bi.TextJust.Left:this.trect.x=e.x,this.trect.width=this.TextWrapWidth;break;case bi.TextJust.Right:this.trect.x=e.x+e.width-this.TextWrapWidth,this.trect.width=this.TextWrapWidth;break;default:this.trect.x=e.x+i/2,this.trect.width=this.TextWrapWidth}}l&&(this.trect.width=l.width,this.trect.height=l.height),F.Debug("= S.BaseLine: UpdateFrame output:",this.Frame,this.r)}GetHitTestFrame(){F.Debug("= S.BaseLine: GetHitTestFrame called");let t={};ve.CopyRect(t,this.Frame),F.Debug("= S.BaseLine: Initial hitTestFrame copied from Frame:",t);const e=me.Common.KnobSize;return ve.InflateRect(t,e/2,e/2),F.Debug("= S.BaseLine: Inflated hitTestFrame by knob size:",t),t=ve.UnionRect(t,this.r,t),F.Debug("= S.BaseLine: Final hitTestFrame after union with main rectangle:",t),t}GetMoveRect(t){F.Debug("= S.BaseLine: GetMoveRect called with includeInflation:",t);const e={};return t?(ve.CopyRect(e,this.r),ve.InflateRect(e,0,0)):ve.CopyRect(e,this.Frame),F.Debug("= S.BaseLine: GetMoveRect output:",e),e}SetSize(t,e,i){F.Debug("= S.BaseLine: SetSize called with newWidth:",t,"newHeight:",e,"actionType:",i);let o=!1,n=0,s=0;if(i!==me.ActionTriggerType.LineLength||null==t){null!=t&&(n=t-this.Frame.width),null!=e&&(s=e-this.Frame.height),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),(this.StartPoint.x<this.EndPoint.x||ve.IsEqual(this.StartPoint.x,this.EndPoint.x)&&this.StartPoint.y<this.EndPoint.y)&&(o=!0);const i=ye.opt.svgObjectLayer.GetElementById(this.BlockID);o?this.AdjustLineEnd(i,this.EndPoint.x+n,this.EndPoint.y+s,0,!0):this.AdjustLineStart(i,this.StartPoint.x+n,this.StartPoint.y+s,0,!0),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move)}else this.UpdateDimensions(t);F.Debug("= S.BaseLine: SetSize completed with updated StartPoint:",this.StartPoint,"EndPoint:",this.EndPoint)}AdjustForLineAngleSnap(t,e){F.Debug("= S.BaseLine: AdjustForLineAngleSnap called with startPoint:",t,"endPoint:",e);let i=Oe.CalcAngleFromPoints(t,e),o=!1;return(i>=358||i<=3||i>=178&&i<=183)&&(e.y=t.y,o=!0),(i>=88&&i<=93||i>=268&&i<=273)&&(e.x=t.x,o=!0),F.Debug("= S.BaseLine: AdjustForLineAngleSnap output endPoint:",e,"adjusted:",o),o}GetAngle(t){F.Debug("= S.BaseLine: GetAngle called with params:",t);let e=0;const i=this.GetTextOnLineParams(t);let o=i.StartPoint,n=i.EndPoint;if(this.LineType===me.LineType.LINE){o.x>n.x&&(o=i.EndPoint,n=i.StartPoint);const t=Math.abs(o.x-n.x),s=Math.abs(o.y-n.y);if(s<1)e=0;else if(t<1)e=90;else{const i=Math.atan(s/t);e=o.y<n.y?180-(e=180*i/Math.PI):180*i/Math.PI}}else e=ye.opt.GetClockwiseAngleBetween2PointsInDegrees(o,n);return F.Debug("= S.BaseLine: GetAngle output:",e),e}GetDrawNormalizedAngle(t,e){F.Debug("= S.BaseLine: GetDrawNormalizedAngle called with startPoint:",t,"endPoint:",e);let i=Oe.CalcAngleFromPoints(t,e),o=!1;return this.polylist?this.checkIfPolyLine(this)?o=this.IsReverseWinding():void 0!==this.IsReversed&&(o=this.IsReversed):i>=180&&(o=!0),o&&(i-=180,i<0&&(i+=360)),F.Debug("= S.BaseLine: GetDrawNormalizedAngle output:",i),i}GetApparentAngle(t){F.Debug("= S.BaseLine: GetApparentAngle called with params:",t);const e=this.GetDrawNormalizedAngle(this.StartPoint,this.EndPoint);return F.Debug("= S.BaseLine: GetApparentAngle output:",e),e}IsReverseWinding(){F.Debug("= S.BaseLine: IsReverseWinding called");let t=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);if(F.Debug("= S.BaseLine: Retrieved points:",t),2===t.length){const e=t[0].x>t[1].x;return F.Debug("= S.BaseLine: IsReverseWinding output (2 points):",e),e}let e=0;for(let o=0,n=t.length-1;o<t.length;n=o++)e+=(t[n].x+t[o].x)*(t[n].y-t[o].y);const i=.5*e>=0;return F.Debug("= S.BaseLine: IsReverseWinding output:",i),i}LinkGrow(t,e,i){switch(F.Debug("= S.BaseLine: LinkGrow called with blockID:",t,"hookPoint:",e,"newPoint:",i),e){case me.HookPts.KTL:this.StartPoint.x=i.x,this.StartPoint.y=i.y;break;case me.HookPts.KTR:this.EndPoint.x=i.x,this.EndPoint.y=i.y}this.CalcFrame(!0),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ws.AddToDirtyList(t),F.Debug("= S.BaseLine: LinkGrow updated StartPoint:",this.StartPoint,"EndPoint:",this.EndPoint)}HandleActionTriggerTrackCommon(t,e,i,o){F.Debug("= S.BaseLine: HandleActionTriggerTrackCommon called with input:",{newX:t,newY:e,redrawFlag:i,eventObj:o}),ye.opt.actionStartX,ye.opt.actionStartY,Oe.DeepCopy(ye.opt.actionBBox);let n={};function s(t,e,i){const o={x:t,y:e};return i.x<0&&(o.x-=i.x),i.y<0&&(o.y-=i.y),o}switch(ye.opt.actionTriggerId){case me.ActionTriggerType.LineStart:this.AdjustLineStart(ye.opt.actionSvgObject,t,e,ye.opt.actionTriggerId,i),(this.r.x<0||this.r.y<0)&&(n=s(this.StartPoint.x,this.StartPoint.y,this.r),this.AdjustLineStart(ye.opt.actionSvgObject,n.x,n.y,ye.opt.actionTriggerId,i));break;case me.ActionTriggerType.PolyEnd:case me.ActionTriggerType.LineEnd:this.AdjustLineEnd(ye.opt.actionSvgObject,t,e,ye.opt.actionTriggerId,i),(this.r.x<0||this.r.y<0)&&(n=s(this.EndPoint.x,this.EndPoint.y,this.r),this.AdjustLineEnd(ye.opt.actionSvgObject,n.x,n.y,ye.opt.actionTriggerId,i));break;case me.ActionTriggerType.Rotate:this.AdjustRotate(t,e,o);break;case me.ActionTriggerType.ModifyShape:case me.ActionTriggerType.SeglOne:case me.ActionTriggerType.SeglTwo:case me.ActionTriggerType.SeglThree:case me.ActionTriggerType.PolyNode:case me.ActionTriggerType.PolyAdj:case me.ActionTriggerType.TopLeft:case me.ActionTriggerType.TopRight:case me.ActionTriggerType.BottomLeft:case me.ActionTriggerType.BottomRight:this.ModifyShape(ye.opt.actionSvgObject,t,e,ye.opt.actionTriggerId,ye.opt.actionTriggerData,i),this.UpdateFrame(),(this.r.x<0||this.r.y<0)&&(n=s(t,e,this.r),this.ModifyShape(ye.opt.actionSvgObject,n.x,n.y,ye.opt.actionTriggerId,ye.opt.actionTriggerData),this.UpdateFrame());break;case me.ActionTriggerType.MovePolySeg:this.MovePolySeg(ye.opt.actionSvgObject,t,e,ye.opt.actionTriggerId,ye.opt.actionTriggerData);break;case me.ActionTriggerType.DimLineAdj:this.DimensionLineDeflectionAdjust(ye.opt.actionSvgObject,t,e,ye.opt.actionTriggerId,ye.opt.actionTriggerData)}F.Debug("= S.BaseLine: HandleActionTriggerTrackCommon completed with updated StartPoint:",this.StartPoint,"and EndPoint:",this.EndPoint)}AdjustRotate(t,e,i){F.Debug("= S.BaseLine: AdjustRotate called with mouseX:",t,"mouseY:",e,"event:",i);let o=t-ye.opt.rotatePivotX,n=e-ye.opt.rotatePivotY,s=0;0===o&&0===n?s=0:0===o?s=n>0?90:270:o>=0&&n>=0?s=Math.atan(n/o)*(180/Se.Geometry.PI):o<0&&n>=0||o<0&&n<0?s=180+Math.atan(n/o)*(180/Se.Geometry.PI):o>=0&&n<0&&(s=360+Math.atan(n/o)*(180/Se.Geometry.PI));const a=ye.opt.OverrideSnaps(i);if(ye.docUtil.docConfig.enableSnap&&!a){const t=ye.opt.EnhanceSnaps(i)?ye.opt.enhanceRotateSnap:ye.opt.rotateSnap;s=Math.round(s/t)*t}this.Rotate(ye.opt.actionSvgObject,s)&&(ye.opt.rotateEndRotation=s),F.Debug("= S.BaseLine: AdjustRotate output angle:",s)}DimensionLineDeflectionAdjust(t,e,i,o,n){F.Debug("= S.BaseLine: DimensionLineDeflectionAdjust called with",{svgDoc:t,mouseX:e,mouseY:i,actionTriggerID:o,triggerData:n}),this.dimensionDeflectionH=this.GetDimensionLineDeflection(t,e,i,n),F.Debug("= S.BaseLine: Calculated dimensionDeflectionH:",this.dimensionDeflectionH),this.UpdateDimensionLines(t),F.Debug("= S.BaseLine: Dimension lines updated");const s=this.Dimensions&Se.DimensionFlags.Select;F.Debug("= S.BaseLine: isDimSelect:",s),s&&(this.HideOrShowSelectOnlyDimensions(!0),F.Debug("= S.BaseLine: Select-only dimensions shown")),F.Debug("= S.BaseLine: DimensionLineDeflectionAdjust completed")}ScaleObject(t,e,i,o,n,s,a){if(F.Debug("= S.BaseLine: ScaleObject called with",{offsetX:t,offsetY:e,rotationCenter:i,rotationAngle:o,scaleX:n,scaleY:s,adjustThickness:a}),this.StartPoint.x=t+this.StartPoint.x*n,this.StartPoint.y=e+this.StartPoint.y*s,this.EndPoint.x=t+this.EndPoint.x*n,this.EndPoint.y=e+this.EndPoint.y*s,o){const t=2*Math.PI*(o/360);this.StartPoint=ye.opt.RotatePointAroundPoint(i,this.StartPoint,t),this.EndPoint=ye.opt.RotatePointAroundPoint(i,this.EndPoint,t)}if(this.CurveAdjust&&(this.CurveAdjust*=(n+s)/2),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),a){const t=Math.max(n,s);this.StyleRecord.Line.Thickness*=t,this.StyleRecord.Line.BThick*=t}this.CalcFrame(),F.Debug("= S.BaseLine: ScaleObject output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,CurveAdjust:this.CurveAdjust,StyleRecord:this.StyleRecord})}CanUseStandOffDimensionLines(){F.Debug("= S.BaseLine: CanUseStandOffDimensionLines called");return F.Debug("= S.BaseLine: CanUseStandOffDimensionLines output:",true),true}GetDimensionLineDeflection(t,e,i,o){F.Debug("= S.BaseLine: GetDimensionLineDeflection called with",{svgDoc:t,mouseX:e,mouseY:i,triggerData:o});let n=0;const s=[],a=new De(0,0),r=this.GetDimensionPoints();for(let l=0;l<r.length;l++)r[l].x+=this.inside.x,r[l].y+=this.inside.y;if(a.x=o.knobPoint.x+this.Frame.x-o.adjustForKnob,a.y=o.knobPoint.y+this.Frame.y-o.adjustForKnob,s.push(r[o.segmentIndex-1]),s.push(r[o.segmentIndex]),s.push(new De(a.x,a.y)),s.push(new De(e,i)),si.RotatePointsAboutCenter(this.Frame,-o.ccAngleRadians,s),this instanceof we.Shape.BaseLine&&(!this.polylist||2===this.polylist.segs.length)){const t=Math.floor((o.ccAngleRadians-.01)/(Math.PI/2));1!==t&&2!==t&&si.RotatePointsAboutCenter(this.Frame,Math.PI,s)}else this.polylist&&this.IsReverseWinding()&&si.RotatePointsAboutCenter(this.Frame,Math.PI,s);return n=s[3].y-s[2].y,n=this.polylist&&this.polylist.segs[o.segmentIndex].dimTextAltPositioning?o.originalDeflection-n:o.originalDeflection+n,F.Debug("= S.BaseLine: GetDimensionLineDeflection output:",n),n}HandleActionTriggerCallResize(t,e){F.Debug("= S.BaseLine: HandleActionTriggerCallResize called with event:",t,"triggerData:",e);const i=this.Resize(ye.opt.actionSvgObject,ye.opt.actionNewBBox);ye.opt.actionBBox.x+=i.x,ye.opt.actionBBox.y+=i.y,ye.opt.actionStartX+=i.x,ye.opt.actionStartY+=i.y,F.Debug("= S.BaseLine: HandleActionTriggerCallResize output resizeAdjustment:",i)}HandleActionTriggerDoAutoScroll(){F.Debug("= S.BaseLine: HandleActionTriggerDoAutoScroll called"),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("HandleActionTriggerDoAutoScroll",100);const t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);F.Debug("= S.BaseLine: Converted document coordinates:",t),ye.opt.pinRect&&ye.opt.PinTrackPoint(t);const e=xs.DoAutoGrowDrag(t);F.Debug("= S.BaseLine: Adjusted coordinates after auto-grow drag:",e),ye.docUtil.ScrollToPosition(e.x,e.y),this.HandleActionTriggerTrackCommon(e.x,e.y),F.Debug("= S.BaseLine: HandleActionTriggerDoAutoScroll completed")}AutoScrollCommon(t,e,i){let o,n;F.Debug("= S.BaseLine: AutoScrollCommon called with event:",t,"enableSnap:",e,"autoScrollCallback:",i);let s=!1;ye.opt.OverrideSnaps(t)&&(e=!1),t.gesture?(o=t.gesture.center.clientX,n=t.gesture.center.clientY):(o=t.clientX,n=t.clientY);let a=o,r=n;const l=ye.opt.svgDoc.docInfo;if(o>=l.dispX+l.dispWidth-4&&(s=!0,a=l.dispX+l.dispWidth-4+32),o<l.dispX&&(s=!0,a=l.dispX-32),n>=l.dispY+l.dispHeight-4&&(s=!0,r=l.dispY+l.dispHeight-4+32),n<l.dispY&&(s=!0,r=l.dispY-4-32),s){if(e&&ye.docUtil.docConfig.enableSnap){const t=ye.docUtil.SnapToGrid({x:a,y:r});a=t.x,r=t.y}return ye.opt.autoScrollXPos=a,ye.opt.autoScrollYPos=r,-1===ye.opt.autoScrollTimerId&&(ye.opt.autoScrollTimer=new gn(this),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout(i,0)),F.Debug("= S.BaseLine: AutoScrollCommon output: shouldAutoScroll = false"),!1}return this.ResetAutoScrollTimer(),F.Debug("= S.BaseLine: AutoScrollCommon output: shouldAutoScroll = true"),!0}LMActionTrack(t){let e;if(F.Debug("= S.BaseLine: LMActionTrack called with event:",t),ve.StopPropagationAndDefaults(t),-1==ye.opt.actionStoredObjectId)return!1;const i=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),o=t.gesture.srcEvent.altKey;ye.opt.pinRect&&ye.opt.PinTrackPoint(i);const n=xs.DoAutoGrowDrag(i);let s=this.LMActionDuringTrack(n);if(e=ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0,ye.opt.OverrideSnaps(t)&&(e=!0),ye.opt.actionTriggerId!==me.ActionTriggerType.ModifyShape&&ye.docUtil.docConfig.enableSnap&&!e){const t=s.x-ye.opt.actionStartX,e=s.y-ye.opt.actionStartY,i=ye.opt.actionTriggerId===me.ActionTriggerType.MovePolySeg;ye.opt.actionTriggerId===me.ActionTriggerType.Rotate||this.CustomSnap(this.Frame.x,this.Frame.y,t,e,i,s)||i||(s=ye.docUtil.SnapToGrid(s))}this.AutoScrollCommon(t,!e,"HandleActionTriggerDoAutoScroll")&&this.HandleActionTriggerTrackCommon(s.x,s.y,o,t),F.Debug("= S.BaseLine: LMActionTrack completed with updated coordinates:",s)}LMActionRelease(t,e){switch(F.Debug("= S.BaseLine: LMActionRelease called with event:",t,"isSecondary:",e),e||(rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer()),ye.opt.actionTriggerId){case me.ActionTriggerType.Rotate:this.AfterRotateShape(ye.opt.actionStoredObjectId);break;case me.ActionTriggerType.ModifyShape:case me.ActionTriggerType.SeglOne:case me.ActionTriggerType.SeglTwo:case me.ActionTriggerType.SeglThree:case me.ActionTriggerType.PolyNode:case me.ActionTriggerType.PolyAdj:case me.ActionTriggerType.PolyEnd:case me.ActionTriggerType.MovePolySeg:this.AfterModifyShape(ye.opt.actionStoredObjectId,ye.opt.actionTriggerId);break;default:ye.opt.ob.Frame&&(Yo.MaintainLink(ye.opt.actionStoredObjectId,this,ye.opt.ob,ye.opt.actionTriggerId),ye.opt.ob={},Ps.SetLinkFlag(ye.opt.actionStoredObjectId,Ee.LinkFlags.Move),ye.opt.UpdateLinks())}this.LMActionPostRelease(ye.opt.actionStoredObjectId),(""!==this.HyperlinkText||-1!==this.NoteID||-1!==this.commentId||this.HasFieldData())&&ws.AddToDirtyList(ye.opt.actionStoredObjectId),e||(ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null),vs.ShowOverlayLayer(),xs.CompleteOperation(),F.Debug("= S.BaseLine: LMActionRelease completed")}LMActionPreTrack(t,e){F.Debug("= S.BaseLine: LMActionPreTrack called with actionStoredObjectID:",t,"actionTriggerID:",e);let i,o,n,s=-1;if(i=ws.GetObjectPtr(t,!1),!i)return void F.Debug("= S.BaseLine: LMActionPreTrack - objectPtr not found");switch(ye.opt.ob=Oe.DeepCopy(i),e){case me.ActionTriggerType.LineStart:for(let t=0;t<i.hooks.length;t++)if(i.hooks[t].hookpt===me.HookPts.KTL||i.hooks[t].hookpt===me.HookPts.WTL||i.hooks[t].hookpt===me.HookPts.WTR){s=t;break}break;case me.ActionTriggerType.LineEnd:for(let t=0;t<i.hooks.length;t++)if(i.hooks[t].hookpt===me.HookPts.KTR||i.hooks[t].hookpt===me.HookPts.WBL||i.hooks[t].hookpt===me.HookPts.WBR){s=t;break}break;default:return void F.Debug("= S.BaseLine: LMActionPreTrack - invalid actionTriggerID")}this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),n=new nn,ye.opt.linkParams=n,o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),this.AllowLink()||(n.ArraysOnly=!0),o&&(n.AllowJoin=o.flags&me.SessionFlags.FreeHand),s>=0&&(n.ConnectIndex=i.hooks[s].objid,n.PrevConnect=i.hooks[s].objid,n.ConnectPt.x=i.hooks[s].connect.x,n.ConnectPt.y=i.hooks[s].connect.y,n.ConnectInside=i.hooks[s].cellid,n.HookIndex=i.hooks[s].hookpt,n.InitialHook=s);const a=ws.GetObjectPtr(ye.opt.linksBlockId,!1);return n.lpCircList=Yo.GetHookList(a,n.lpCircList,t,i,Se.ListCodes.CircTarg,{}),s<0&&1===i.hooks.length&&n.lpCircList&&n.lpCircList.push(i.hooks[0].objid),F.Debug("= S.BaseLine: LMActionPreTrack completed with linkParams:",n),!0}LMActionDuringTrack(t){F.Debug("= S.BaseLine: LMActionDuringTrack called with event:",t);const e=[{x:0,y:0}];return ye.opt.linkParams&&(e[0].x=t.x,e[0].y=t.y,this.objecttype===Se.FNObjectTypes.FlWall&&(e[0].id=ye.opt.actionTriggerId===me.ActionTriggerType.LineStart?me.HookPts.KTL:me.HookPts.KTR,ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0,Qo.FindConnect(ye.opt.actionStoredObjectId,this,e,!0,!1,ye.opt.linkParams.AllowJoin,t)&&(t.x+=ye.opt.dragDeltaX,t.y+=ye.opt.dragDeltaY))),F.Debug("= S.BaseLine: LMActionDuringTrack output event:",t),t}AfterRotateShape(t){if(F.Debug("= S.BaseLine: AfterRotateShape called with blockID:",t),this.r.x<0||this.r.y<0)return F.Debug("= S.BaseLine: Rectangle coordinates are negative, performing undo operation"),void $o.Undo();ye.opt.ob.Frame&&(F.Debug("= S.BaseLine: Maintaining link with frame:",ye.opt.ob.Frame),Yo.MaintainLink(t,this,ye.opt.ob,me.ActionTriggerType.Rotate),ye.opt.ob={}),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),F.Debug("= S.BaseLine: AfterRotateShape completed for blockID:",t)}AfterModifyShape(t,e){if(F.Debug("= S.BaseLine: AfterModifyShape called with blockID:",t,"actionTriggerID:",e),ye.opt.actionSvgObject){const t=ye.opt.actionSvgObject.GetElementById(me.Common.EllipseAxes);null!=t&&(ye.opt.actionSvgObject.RemoveElement(t),F.Debug("= S.BaseLine: Removed ellipseAxesElement:",t))}ye.opt.ob.Frame&&(Yo.MaintainLink(t,this,ye.opt.ob,e),ye.opt.ob={},F.Debug("= S.BaseLine: Maintained link and reset ob.Frame")),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1),F.Debug("= S.BaseLine: Reset floating point dimensions flags")),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),F.Debug("= S.BaseLine: Set link flag and updated links"),this.arcobj&&(this.arcobj=null,F.Debug("= S.BaseLine: Reset arcobj to null")),F.Debug("= S.BaseLine: AfterModifyShape completed for blockID:",t)}LMActionPostRelease(t){F.Debug("= S.BaseLine: LMActionPostRelease called with blockID:",t),Ps.SetEditMode(Se.EditState.Default),ye.opt.linkParams&&(ye.opt.linkParams.HiliteConnect>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteConnect,ye.opt.linkParams.ConnectPt,!1,!1,this.BlockID,ye.opt.linkParams.HiliteInside),ye.opt.linkParams.HiliteConnect=-1,ye.opt.linkParams.HiliteInside=null),ye.opt.linkParams.HiliteJoin>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteJoin,ye.opt.linkParams.ConnectPt,!1,!0,this.BlockID,null),ye.opt.linkParams.HiliteJoin=-1),ye.opt.linkParams.JoinIndex>=0?en.PolyLJoin(ye.opt.linkParams.JoinIndex,ye.opt.linkParams.JoinData,t,ye.opt.linkParams.JoinSourceData,!1):(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.InitialHook>=0)&&Yo.UpdateHook(t,ye.opt.linkParams.InitialHook,ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.HookIndex,ye.opt.linkParams.ConnectPt,ye.opt.linkParams.ConnectInside),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),ye.opt.linkParams=null),F.Debug("= S.BaseLine: LMActionPostRelease completed for blockID:",t)}LMSetupActionClick(t,e){let i,o,n;if(F.Debug("= S.BaseLine: LMSetupActionClick called with event:",t,"isSecondary:",e),e)i=ye.opt.actionStoredObjectId,o=ye.opt.actionTriggerId,ye.opt.pinRect=null,ye.stdObj.PreserveBlock(i);else{ye.opt.eventTimestamp=Date.now(),t.stopPropagation();const e=ye.opt.svgOverlayLayer.FindElementByDOMElement(t.currentTarget);if(null===e)return!1;const s=e.GetID();if(i=parseInt(s.substring(me.Common.Action.length),10),ye.opt.actionStoredObjectId=i,n=e.GetTargetForEvent(t),null==n)return!1;ye.stdObj.PreserveBlock(i),o=n.GetID(),ye.opt.actionTriggerId=o,ye.opt.actionTriggerData=n.GetUserData(),ye.opt.pinRect=null}e||ye.opt.SetControlDragMode(n),this.LMActionPreTrack(i,o),ye.opt.actionSvgObject=ye.opt.svgObjectLayer.GetElementById(i),(""!==this.HyperlinkText||-1!==this.NoteID||-1!==this.commentId||this.HasFieldData())&&this.HideAllIcons(ye.opt.svgDoc,ye.opt.actionSvgObject);let s=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),a=ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0;ye.opt.OverrideSnaps(t)&&(a=!0),ye.docUtil.docConfig.enableSnap&&!a&&(s=ye.docUtil.SnapToGrid(s)),s=xs.DoAutoGrowDrag(s);const r=s.x,l=s.y;ye.opt.actionLockAspectRatio=t.gesture.srcEvent.shiftKey,this.ResizeAspectConstrain&&(ye.opt.actionLockAspectRatio=!ye.opt.actionLockAspectRatio);const h=this.GetSVGFrame();return ye.opt.actionLockAspectRatio&&(0===h.height?ye.opt.actionLockAspectRatio=!1:(ye.opt.actionAspectRatioWidth=h.width,ye.opt.actionAspectRatioHeight=h.height)),ye.opt.actionBBox=Oe.DeepCopy(h),ye.opt.actionNewBBox=Oe.DeepCopy(h),vs.HideOverlayLayer(),ye.opt.actionStartX=r,ye.opt.actionStartY=l,ye.opt.actionTriggerId===me.ActionTriggerType.Rotate?this.BeforeRotate(h):ye.opt.actionTriggerId!==me.ActionTriggerType.ModifyShape&&ye.opt.actionTriggerId!==me.ActionTriggerType.PolyAdj||this.BeforeModifyShape(r,l,ye.opt.actionTriggerData),F.Debug("= S.BaseLine: LMSetupActionClick output:",!0),!0}BeforeRotate(t){F.Debug("= S.BaseLine: BeforeRotate called with frame:",t),ye.opt.rotateKnobCenterDivisor=this.RotateKnobCenterDivisor();const e=this.EndPoint.x-this.StartPoint.x,i=this.EndPoint.y-this.StartPoint.y;ye.opt.rotateStartRotation=180*Math.atan2(i,e)/Math.PI,ye.opt.rotateEndRotation=ye.opt.rotateStartRotation,ye.opt.rotatePivotX=t.x+t.width/ye.opt.rotateKnobCenterDivisor.x,ye.opt.rotatePivotY=t.y+t.height/ye.opt.rotateKnobCenterDivisor.y,ye.opt.rotateStartPoint=Oe.DeepCopy(this.StartPoint),ye.opt.rotateEndPoint=Oe.DeepCopy(this.EndPoint),F.Debug("= S.BaseLine: BeforeRotate output:",{rotateStartRotation:ye.opt.rotateStartRotation,rotateEndRotation:ye.opt.rotateEndRotation,rotatePivotX:ye.opt.rotatePivotX,rotatePivotY:ye.opt.rotatePivotY,rotateStartPoint:ye.opt.rotateStartPoint,rotateEndPoint:ye.opt.rotateEndPoint})}LMActionClickExpCleanup(t){F.Debug("= S.BaseLine: LMActionClickExpCleanup called with error:",t),rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer(),ye.opt.ob={},ye.opt.linkParams=null,ye.opt.actionTriggerId=-1,ye.opt.actionTriggerData=null,ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,F.Debug("= S.BaseLine: LMActionClickExpCleanup completed")}LMActionClick(t,e){F.Debug("= S.BaseLine: LMActionClick called with event:",t,"isSecondary:",e);try{const i=this.BlockID,o=ws.GetObjectPtr(i,!1);if(!(o&&o instanceof dn))return F.Debug("= S.BaseLine: LMActionClick - objectPtr is not an instance of BaseDrawObject"),!1;if(xs.InitializeAutoGrowDrag(0,i),!this.LMSetupActionClick(t,e))return void F.Debug("= S.BaseLine: LMActionClick - LMSetupActionClick returned false");const n=ws.GetObjectPtr(i,!1);ye.opt.WorkAreaHammer.on("drag",Ls.Evt_ActionTrackHandlerFactory(n)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_ActionReleaseHandlerFactory(n)),F.Debug("= S.BaseLine: LMActionClick setup completed for blockID:",i)}catch(i){throw Uo.Error("= s.BaseLine: LMActionClick encountered an error:",i),this.LMActionClickExpCleanup(i),ye.opt.ExceptionCleanup(i),i}}Rotate(t,e){F.Debug("= S.BaseLine: Rotate called with svgElement:",t,"endRotation:",e);const i={x:ye.opt.rotatePivotX,y:ye.opt.rotatePivotY},o=(e-ye.opt.rotateStartRotation)/(180/Se.Geometry.PI),n=ye.opt.RotatePointAroundPoint(i,ye.opt.rotateStartPoint,o),s=ye.opt.RotatePointAroundPoint(i,ye.opt.rotateEndPoint,o);if(F.Debug("= S.BaseLine: Rotated points calculated as rotatedStartPoint:",n,"rotatedEndPoint:",s),n.x<0||n.y<0||s.x<0||s.y<0)return F.Debug("= S.BaseLine: Rotation resulted in negative coordinates, returning false"),!1;if(ye.opt.header.flags&me.HeaderFlags.NoAuto){const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(n.x>t.dim.x||n.y>t.dim.y||s.x>t.dim.x||s.y>t.dim.y)return F.Debug("= S.BaseLine: Rotation resulted in coordinates outside session dimensions, returning false"),!1}return this.AdjustLineStart(t,n.x,n.y,0,!0),this.AdjustLineEnd(t,s.x,s.y,me.ActionTriggerType.LineEnd,!0),F.Debug("= S.BaseLine: Rotate completed successfully"),!0}RotateKnobCenterDivisor(){F.Debug("= S.BaseLine: RotateKnobCenterDivisor called");const t={x:2,y:2};return F.Debug("= S.BaseLine: RotateKnobCenterDivisor output:",t),t}GetHookFlags(){F.Debug("= S.BaseLine: GetHookFlags called");const t=Se.HookFlags.LcShape|Se.HookFlags.LcLine|Se.HookFlags.LcCHook;return F.Debug("= S.BaseLine: GetHookFlags output:",t),t}AllowLink(){const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),i=t&&t.activelayer>=0&&t.layers[t.activelayer].flags&Se.LayerFlags.UseEdges,o=ye.opt.fromOverlayLayer,n=e&&e.flags&me.SessionFlags.LLink;return!i&&(o||n)}GetHookPoints(){F.Debug("= S.BaseLine: GetHookPoints called");const t=me.Common.DimMax,e=[{x:0,y:0,id:me.HookPts.KTL},{x:t,y:t,id:me.HookPts.KTR}];return F.Debug("= S.BaseLine: GetHookPoints output:",e),e}PrGetWidthAdjustment(){F.Debug("= S.BaseLine: PrGetWidthAdjustment called");const t=this.StyleRecord.Line.Thickness/2;let e=this.GetAngle(null);e>=90&&(e=180-e);const i=e/180*Math.PI,o={deltax:Math.sin(i)*t,deltay:Math.cos(i)*t};return F.Debug("= S.BaseLine: PrGetWidthAdjustment output:",o),o}GetConnectLine(){F.Debug("= S.BaseLine: GetConnectLine called");return F.Debug("= S.BaseLine: GetConnectLine output:",null),null}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.BaseLine: GetPerimPts called with",{hookPoints:t,targetPoints:e,targetID:i,isRelative:o,additionalParam:n,hookIndex:s});let a=[],r={},l={};const h=me.HookPts,c=e.length;if(this.objecttype===Se.FNObjectTypes.FlWall&&s<0&&c>1){this.StyleRecord.Line.Thickness;const t=this.PrGetWidthAdjustment();for(let i=0;i<c;i++){let o={};switch(e[i].id){case h.WTL:o={x:this.StartPoint.x-t.deltax,y:this.StartPoint.y-t.deltay,id:e[i].id};break;case h.WTR:o={x:this.StartPoint.x+t.deltax,y:this.StartPoint.y-t.deltay,id:e[i].id};break;case h.WBL:o={x:this.EndPoint.x-t.deltax,y:this.EndPoint.y+t.deltay,id:e[i].id};break;case h.WBR:o={x:this.EndPoint.x+t.deltax,y:this.EndPoint.y+t.deltay,id:e[i].id};break;case h.KTL:o={x:this.StartPoint.x,y:this.StartPoint.y,id:e[i].id};break;case h.KTR:o={x:this.EndPoint.x,y:this.EndPoint.y,id:e[i].id}}a.push(o)}return F.Debug("= S.BaseLine: GetPerimPts output:",a),a}if(s>=0){const t=ws.GetObjectPtr(s,!1);if(t&&t.objecttype===Se.FNObjectTypes.Multiplicity){let i=5,o=5;i+=t.Frame.width/2;let n=this.GetAngle(null);n>=90&&(n=180-n);const s=n/180*Math.PI;let r=0;if(n<=45)t.subtype==Se.ObjectSubTypes.SubtMultiplicityFilpped&&(o=-t.Frame.height-5),r=Math.tan(s)*i,0===e[0].x?this.StartPoint.y<this.EndPoint.y?o-=r:o+=r:this.StartPoint.y<this.EndPoint.y?o+=r:o-=r,o=-o,this.StartPoint.x>=this.EndPoint.x&&(i=-i);else{t.subtype==Se.ObjectSubTypes.SubtMultiplicityFilpped&&(i=-i);const n=Math.tan(Math.PI/2-s);0===e[0].x?(this.StartPoint.y>=this.EndPoint.y?o=-o:o+=t.Frame.height,r=n*Math.abs(o),this.StartPoint.x<this.EndPoint.x?i+=r:i-=r):(this.StartPoint.y>=this.EndPoint.y?o+=t.Frame.height:o=-o,r=n*Math.abs(o),this.StartPoint.x<this.EndPoint.x?i-=r:i+=r,i=-i)}return 0===e[0].x?(a.push(new De(this.StartPoint.x+i,this.StartPoint.y+o)),a[0].id=e[0].id):(a.push(new De(this.EndPoint.x-i,this.EndPoint.y+o)),a[0].id=e[0].id),F.Debug("= S.BaseLine: GetPerimPts output:",a),a}if(t&&t.objecttype===Se.FNObjectTypes.ExtraTextLable&&1===c){const t=e[0].x/me.Common.DimMax,i=this.GetPointOnLine(t);return a.push(i),a[0].id=e[0].id,F.Debug("= S.BaseLine: GetPerimPts output:",a),a}}const p=this.GetConnectLine();p?(r=p.startpt,l=p.endpt):(r=this.StartPoint,l=this.EndPoint);for(let d=0;d<c;d++){if(a[d]={x:0,y:0,id:0},0===e[d].x&&0===e[d].y)a[d].x=r.x,a[d].y=r.y;else if(e[d].x===me.Common.DimMax&&e[d].y===me.Common.DimMax)a[d].x=l.x,a[d].y=l.y;else{const t=l.x-r.x,i=l.y-r.y;a[d].x=e[d].x/me.Common.DimMax*t+r.x,a[d].y=e[d].y/me.Common.DimMax*i+r.y}null!=e[d].id&&(a[d].id=e[d].id)}return F.Debug("= S.BaseLine: GetPerimPts output:",a),a}GetPointOnLine(t){F.Debug("= S.BaseLine: GetPointOnLine called with proportion:",t);const e=(t,e)=>{const i=t.x-e.x,o=t.y-e.y;return ve.Sqrt(i*i+o*o)},i={x:this.StartPoint.x,y:this.StartPoint.y},o=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),n=[];let s=0;for(let l=1;l<o.length;l++){const t=o[l-1],i=o[l],a=e(t,i);n.push({pt1:t,pt2:i,len:a}),s+=a}const a=(t=Math.max(0,Math.min(1,t)))*s;let r=0;for(const l of n){const{pt1:t,pt2:e,len:o}=l;if(r+o>=a){const n=(a-r)/o;i.x=t.x+(e.x-t.x)*n,i.y=t.y+(e.y-t.y)*n;break}r+=o}return F.Debug("= S.BaseLine: GetPointOnLine output:",i),i}GetTargetPoints(t,e,i){F.Debug("= S.BaseLine: GetTargetPoints called with",{hookPoint:t,hookFlags:e,targetID:i});let o=!1,n=!1;const s=[{x:0,y:0}];let a={x:0,y:0};const r=me.HookPts;if(null!=i&&i>=0){if(ws.GetObjectPtr(i,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)switch(t.id){case r.SED_KTC:case r.SED_KBC:case r.SED_KRC:case r.SED_KLC:const t=Vo.LineIsReversed(this,null,!1);if(0===this.hooks.length)return t?(s[0].x=me.Common.DimMax,s[0].y=me.Common.DimMax,s.push({x:0,y:0})):(s[0].x=0,s[0].y=0,s.push({x:me.Common.DimMax,y:me.Common.DimMax})),F.Debug("= S.BaseLine: GetTargetPoints output:",s),s;if(1===this.hooks.length){if(this.hooks[0].hookpt===r.SED_KTR)return s[0].x=0,s[0].y=0,F.Debug("= S.BaseLine: GetTargetPoints output:",s),s;if(this.hooks[0].hookpt===r.SED_KTL)return s[0].x=me.Common.DimMax,s[0].y=me.Common.DimMax,F.Debug("= S.BaseLine: GetTargetPoints output:",s),s}return[]}}let l=this.EndPoint.x-this.StartPoint.x;ve.IsEqual(l,0)&&(l=0),0===l&&(o=!0);let h=this.EndPoint.y-this.StartPoint.y;ve.IsEqual(h,0)&&(h=0),0===h&&(n=!0);let c=o?0:h/l;if(a.x=t.x,a.y=t.y,o||Math.abs(c)>1||e&Se.HookFlags.LcHOnly&&!n){if(ye.docUtil.docConfig.enableSnap&&!(e&Se.HookFlags.LcNoSnaps)){a=ye.docUtil.SnapToGrid(a);const t=ve.Pt2Rect(this.StartPoint,this.EndPoint);a.y<t.y&&(a.y=t.y),a.y>t.y+t.height&&(a.y=t.y+t.height)}const t=a.y-this.StartPoint.y;var p=o?t:t/c}else{if(ye.docUtil.docConfig.enableSnap&&!(e&Se.HookFlags.LcNoSnaps)){a=ye.docUtil.SnapToGrid(a);const t=ve.Pt2Rect(this.StartPoint,this.EndPoint);a.x<t.x&&(a.x=t.x),a.x>t.x+t.width&&(a.x=t.x+t.width)}var d=(a.x-this.StartPoint.x)*c}return n||(s[0].y=d/h*me.Common.DimMax),s[0].x=o?s[0].y:p/l*me.Common.DimMax,n&&(s[0].y=s[0].x),s[0].x>me.Common.DimMax&&(s[0].x=me.Common.DimMax),s[0].y>me.Common.DimMax&&(s[0].y=me.Common.DimMax),s[0].x<0&&(s[0].x=0),s[0].y<0&&(s[0].y=0),F.Debug("= S.BaseLine: GetTargetPoints output:",s),s}AllowHook(t,e,i){F.Debug("= S.BaseLine: AllowHook called with hookPoint:",t,"targetID:",e,"distance:",i);const o=me.HookPts;if(null!=e&&e>=0){if(ws.GetObjectPtr(e,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)switch(t.id){case o.KTC:case o.KBC:case o.KRC:case o.KLC:if(i>200)return F.Debug("= S.BaseLine: AllowHook output: false (distance > 200)"),!1;break;default:if(t.id>=o.CustomBase&&t.id<o.CustomBase+100&&i>200)return F.Debug("= S.BaseLine: AllowHook output: false (custom hook point and distance > 200)"),!1}}return F.Debug("= S.BaseLine: AllowHook output: true"),!0}DeleteObject(){if(F.Debug("= S.BaseLine: DeleteObject called"),super.DeleteObject(),this.objecttype===Se.FNObjectTypes.NgEvent)F.Debug("= S.BaseLine: Handling NgEvent"),this.hooks.length&&ws.GetObjectPtr(this.hooks[0].objid,!1);else F.Debug("= S.BaseLine: No specific handling for objecttype:",this.objecttype);F.Debug("= S.BaseLine: DeleteObject completed")}GetSegLFace(t,e,i){let o;return F.Debug("= S.BaseLine: GetSegLFace called with objectType:",t,"point:",e,"referencePoint:",i),o=this.Frame.width>=this.Frame.height?e.y>=i.y?me.HookPts.KBC:me.HookPts.KTC:e.x>=i.x?me.HookPts.KRC:me.HookPts.KLC,F.Debug("= S.BaseLine: GetSegLFace output:",o),o}GetSpacing(){F.Debug("= S.BaseLine: GetSpacing called");const t=ve.Pt2Rect(this.StartPoint,this.EndPoint),e={width:null,height:null};if(2===this.hooks.length){const i=ws.GetObjectPtr(this.hooks[0].objid,!1),o=ws.GetObjectPtr(this.hooks[1].objid,!1);t.width<t.height?(e.height=Math.abs(this.StartPoint.y-this.EndPoint.y),i&&o&&(e.height=i.Frame.y<o.Frame.y?o.Frame.y-(i.Frame.y+i.Frame.height):i.Frame.y-(o.Frame.y+o.Frame.height))):(e.width=Math.abs(this.StartPoint.x-this.EndPoint.x),i&&o&&(e.width=i.Frame.x<o.Frame.x?o.Frame.x-(i.Frame.x+i.Frame.width):i.Frame.x-(o.Frame.x+o.Frame.width)))}return F.Debug("= S.BaseLine: GetSpacing output:",e),e}GetShapeConnectPoint(t){F.Debug("= S.BaseLine: GetShapeConnectPoint called with hookPointID:",t);const e={x:0,y:0},i={x:0,y:0},o=me.Common.DimMax,n=ve.Pt2Rect(this.StartPoint,this.EndPoint);n.width<n.height?(e.x=o/2,i.x=o/2,this.EndPoint.y<this.StartPoint.y?(e.y=o,i.y=0):(e.y=0,i.y=o)):(e.y=o/2,i.y=o/2,this.EndPoint.x<this.StartPoint.x?(e.x=o,i.x=0):(e.x=0,i.x=o));const s=t===me.HookPts.KTL?i:e;return F.Debug("= S.BaseLine: GetShapeConnectPoint output:",s),s}GetBestHook(t,e,i){const o=me.Common.DimMax,n=ve.Pt2Rect(this.StartPoint,this.EndPoint),s=me.HookPts;let a=!1;const r=ws.GetObjectPtr(t,!1);if(r&&r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)switch(e){case s.KTC:case s.KBC:case s.KRC:case s.KLC:return n.width<n.height?(a=n.y===this.EndPoint.y,(null==i?void 0:i.y)<o/2?a?s.KTC:s.KBC:a?s.KBC:s.KTC):(a=n.x===this.EndPoint.x,(null==i?void 0:i.x)<o/2?a?s.KLC:s.KRC:a?s.KRC:s.KLC);default:return e}return e}CreateConnectHilites(t,e,i,o,n,s){F.Debug("= S.BaseLine: CreateConnectHilites called with",{svgDoc:t,targetPoint:e,hookPoint:i,isJoin:o,hookIndex:n,additionalParam:s});const a=t.CreateShape(me.CSType.Group);let r=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(r*=2);let l=me.Common.ConnPointLineDim/r;o&&(l=me.Common.JoinPointLineDim/r);const h=[],c={x:0,y:0,width:0,height:0};if(null!=i){h.push(i);const s=this.GetPerimPts(e,h,null,!0,null,n);o&&(0===i.x&&0===i.y?(s[0].x=this.StartPoint.x,s[0].y=this.StartPoint.y):i.x===me.Common.DimMax&&i.y===me.Common.DimMax&&(s[0].x=this.EndPoint.x,s[0].y=this.EndPoint.y)),c.x=s[0].x-l,c.y=s[0].y-l,c.width=l,c.height=l;let r=null;r={svgDoc:t,shapeType:me.CSType.Oval,x:l/2,y:l/2,knobSize:l,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",KnobID:0,cursorType:ze.CursorType.Anchor},o&&(r.fillColor="none",r.strokeSize=1,r.strokeColor="black",r.cursorType=ze.CursorType.Default);const p=this.GenericKnob(r);return a.AddElement(p),a.SetPos(c.x,c.y),a.SetSize(c.width,c.height),a.isShape=!0,a.SetID("hilite_"+e),F.Debug("= S.BaseLine: CreateConnectHilites output:",a),a}}HookToPoint(t,e){F.Debug("= S.BaseLine: HookToPoint input, hookId:",t,"outRect:",e);let i={x:0,y:0,id:0};const o=me,n=this.PrGetWidthAdjustment();switch(t){case o.HookPts.KTL:i.x=this.StartPoint.x,i.y=this.StartPoint.y;break;case o.HookPts.KTR:i.x=this.EndPoint.x,i.y=this.EndPoint.y;break;case o.HookPts.WTL:i.x=this.StartPoint.x-n.deltax,i.y=this.StartPoint.y-n.deltay;break;case o.HookPts.WTR:i.x=this.StartPoint.x+n.deltax,i.y=this.StartPoint.y-n.deltay;break;case o.HookPts.WBL:i.x=this.EndPoint.x-n.deltax,i.y=this.EndPoint.y+n.deltay;break;case o.HookPts.WBR:i.x=this.EndPoint.x+n.deltax,i.y=this.EndPoint.y+n.deltay;break;default:i.x=this.EndPoint.x,i.y=this.EndPoint.y}if(e){const t=ve.Pt2Rect(this.StartPoint,this.EndPoint);e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}return F.Debug("= S.BaseLine: HookToPoint output, resultPoint:",i,"outRect:",e),i}MaintainPoint(t,e,i,o,n){F.Debug("= S.BaseLine: MaintainPoint input:",{point:t,targetId:e,distance:i,lineObj:o,offset:n});let s=-1,a=o;const r={};let l={};if(a.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line){switch(a.LineType){case me.LineType.SEGLINE:case me.LineType.ARCSEGLINE:case me.LineType.POLYLINE:for(let t=0;t<a.hooks.length;t++)if(a.hooks[t].targetid===e){a.HookToPoint(a.hooks[t].hookpt,r),s=0;break}if(0!==s)return F.Debug("= S.BaseLine: MaintainPoint output: returning true early (no matching hook)"),!0;l=Oe.DeepCopy(a),ve.CopyRect(l.Frame,r),l.StartPoint.x=r.x,l.StartPoint.y=r.y,l.EndPoint.x=r.x+r.width,l.EndPoint.y=r.y+r.height,a=l}if(ye.opt.LineCheckPoint(this,t))return F.Debug("= S.BaseLine: MaintainPoint output: returning true early (LineCheckPoint true)"),!0;if(ye.opt.LinesIntersect(this,a,t))return F.Debug("= S.BaseLine: MaintainPoint output: returning true early (LinesIntersect true)"),!0;en.LinesMaintainDist(this,i,n,t)}else en.LinesMaintainDist(this,i,n,t);return F.Debug("= S.BaseLine: MaintainPoint output: returning true"),!0}ChangeTarget(t,e,i,o,n,s){F.Debug("= S.BaseLine: ChangeTarget called with e:",t,"targetId:",e,"a:",i,"r:",o,"i:",n,"n:",s);let a=0,r=ws.GetObjectPtr(e,!1);if(this.TextFlags&Se.TextFlags.HorizText&&r instanceof we.Shape.BaseShape){a=this.GetApparentAngle(-1),a=Math.abs(a)%180;let t=Math.abs(r.RotationAngle%180);F.Debug("= S.BaseLine: ChangeTarget computed apparentAngle:",a,"targetRotation:",t),Math.abs(t-a)>2&&Math.abs(t-(a-180))>2?(r.RotationAngle=a,Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move|Ee.LinkFlags.Change),ws.AddToDirtyList(e),F.Debug("= S.BaseLine: ChangeTarget updated targetObj.RotationAngle to:",a)):F.Debug("= S.BaseLine: ChangeTarget rotation difference within tolerance, no update performed")}ws.AddToDirtyList(this.BlockID),F.Debug("= S.BaseLine: ChangeTarget completed for BlockID:",this.BlockID)}GetPolyPoints(t,e,i,o,n){F.Debug("= S.BaseLine: GetPolyPoints called with:",{numPoints:t,isRelative:e,a:i,r:o,i:n});const s=[new De(this.StartPoint.x,this.StartPoint.y),new De(this.EndPoint.x,this.EndPoint.y)];if(e)for(const a of s)a.x-=this.Frame.x,a.y-=this.Frame.y;return F.Debug("= S.BaseLine: GetPolyPoints output:",s),s}Hit(t,e,i,o,n){let s,a,r;F.Debug("= S.BaseLine: Hit called with input:",{point:t,t:e,isKnob:i,hitResult:o,hookPointID:n});const l=me.Common.KnobSize;let h=ye.opt.svgDoc.docInfo.docToScreenScale;if(ye.opt.svgDoc.docInfo.docScale<=.5&&(h*=2),i){const e=2*l/h;if(a=ve.InflatePoint(this.StartPoint,e),r=ve.InflatePoint(this.EndPoint,e),n&&(n===me.HookPts.KTL&&(a=null),n===me.HookPts.KTR&&(r=null)),this.hooks)for(let t=0;t<this.hooks.length;t++)this.hooks[t].hookpt===me.HookPts.KTL&&(a=null),this.hooks[t].hookpt===me.HookPts.KTR&&(r=null);if(a&&ve.pointInRect(a,t)){const t=ws.GetObjectPtr(o.objectid,!1);if(!(t&&t.polylist&&t.polylist.closed))return o&&(o.hitcode=Se.HitCodes.PLApp,o.segment=me.HookPts.KTL,o.pt.x=this.StartPoint.x,o.pt.y=this.StartPoint.y),F.Debug("= S.BaseLine: Hit output:",Se.HitCodes.PLApp),Se.HitCodes.PLApp}if(r&&ve.pointInRect(r,t)){const t=ws.GetObjectPtr(o.objectid,!1);if(!(t&&t.polylist&&t.polylist.closed))return o&&(o.hitcode=Se.HitCodes.PLApp,o.segment=me.HookPts.KTR,o.pt.x=this.EndPoint.x,o.pt.y=this.EndPoint.y),F.Debug("= S.BaseLine: Hit output:",Se.HitCodes.PLApp),Se.HitCodes.PLApp}}const c=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,[]),p={x:t.x,y:t.y},d={};if(s=si.LineDStyleHit(c,p,this.StyleRecord.Line.Thickness,0,d),void 0!==d.lpHit&&o){for(let t=0;t<c.length;t++)if(d.lpHit<c[t]){d.lpHit=t;break}o.segment=d.lpHit}return o&&(o.hitcode=s),F.Debug("= S.BaseLine: Hit output:",s),s}StartNewObjectDrawDoAutoScroll(){F.Debug("= S.BaseLine: StartNewObjectDrawDoAutoScroll called"),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("StartNewObjectDrawDoAutoScroll",100),F.Debug("= S.BaseLine: autoScrollTimerId set to",ye.opt.autoScrollTimerId);let t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);F.Debug("= S.BaseLine: Converted window coords to docCoords:",t),t=xs.DoAutoGrowDrag(t),F.Debug("= S.BaseLine: After DoAutoGrowDrag, docCoords:",t),ye.docUtil.ScrollToPosition(t.x,t.y),F.Debug("= S.BaseLine: Scrolled to position:",t),this.StartNewObjectDrawTrackCommon(t.x,t.y,null),F.Debug("= S.BaseLine: Called StartNewObjectDrawTrackCommon with coords:",t.x,t.y)}StartNewObjectDrawTrackCommon(t,e,i){F.Debug("= S.BaseLine: StartNewObjectDrawTrackCommon called with x:",t,"y:",e,"extraFlag:",i);const o=t-ye.opt.actionStartX,n=e-ye.opt.actionStartY,s=Math.sqrt(o*o+n*n);F.Debug("= S.BaseLine: Computed deltaX:",o,"deltaY:",n,"distance:",s);const a=Oe.DeepCopy(ye.opt.actionBBox);F.Debug("= S.BaseLine: actionBBox:",a),this.AdjustLineEnd(ye.opt.actionSvgObject,t,e,me.ActionTriggerType.LineEnd,i),F.Debug("= S.BaseLine: AdjustLineEnd called with x:",t,"y:",e,"trigger:",me.ActionTriggerType.LineEnd,"extraFlag:",i)}LMDrawTrack(t){let e;F.Debug("= S.BaseLine: LMDrawTrack called with event:",t),ve.StopPropagationAndDefaults(t);let i=0;if(-1===ye.opt.actionStoredObjectId)return F.Debug("= S.BaseLine: LMDrawTrack aborted, actionStoredObjectId is -1"),!1;t.gesture?(e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),i=t.gesture.srcEvent.altKey):e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.clientX,t.clientY),F.Debug("= S.BaseLine: LMDrawTrack input point (before track):",e),e=this.LMDrawDuringTrack(e),F.Debug("= S.BaseLine: After LMDrawDuringTrack, trackPoint:",e);let o=ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0;if(ye.opt.OverrideSnaps(t)&&(o=!0),ye.docUtil.docConfig.enableSnap&&!o){const t=e.x-ye.opt.actionStartX,i=e.y-ye.opt.actionStartY;F.Debug("= S.BaseLine: Calculated delta for snapping:",{deltaX:t,deltaY:i}),this.CustomSnap(this.Frame.x,this.Frame.y,t,i,!1,e)||(e=ye.docUtil.SnapToGrid(e),F.Debug("= S.BaseLine: After SnapToGrid, trackPoint:",e))}e=xs.DoAutoGrowDrag(e),F.Debug("= S.BaseLine: After DoAutoGrowDrag, trackPoint:",e),this.AutoScrollCommon(t,!o,"StartNewObjectDrawDoAutoScroll")?(F.Debug("= S.BaseLine: AutoScrollCommon returned true. Calling StartNewObjectDrawTrackCommon with:",{x:e.x,y:e.y,altKey:i}),this.StartNewObjectDrawTrackCommon(e.x,e.y,i)):F.Debug("= S.BaseLine: AutoScrollCommon returned false, not calling StartNewObjectDrawTrackCommon"),F.Debug("= S.BaseLine: LMDrawTrack completed with final trackPoint:",e)}CancelObjectDraw(){return F.Debug("= S.BaseLine: CancelObjectDraw called"),rn.UnbindActionClickHammerEvents(),ye.opt.lineStamp&&(ye.opt.WorkAreaHammer&&ye.opt.WorkAreaHammer.off("mousemove"),ye.opt.lineStamp=!1),ye.opt.fromOverlayLayer=!1,ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),this.ResetAutoScrollTimer(),F.Debug("= S.BaseLine: CancelObjectDraw completed with output: true"),!0}LMDrawRelease(t,e){F.Debug("= S.BaseLine: LMDrawRelease called with input:",{event:t,touch:e});try{let i,o={x:0,y:0};let n,s,a=me.Common.SegDefLen;e?(o={x:e.x,y:e.y},i=ye.opt.svgDoc.ConvertWindowToDocCoords(e.x,e.y)):t.gesture?(o={x:t.gesture.center.clientX,y:t.gesture.center.clientY},i=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY)):(o={x:t.clientX,y:t.clientY},i=ye.opt.svgDoc.ConvertWindowToDocCoords(t.clientX,t.clientY)),F.Debug("= S.BaseLine: LMDrawRelease - pointerPos:",o,"conversionPoint:",i),t&&ve.StopPropagationAndDefaults(t);const r=2*me.Common.MinDim;if(ye.opt.fromOverlayLayer?(n=ye.opt.lineDrawStartX-i.x,s=ye.opt.lineDrawStartY-i.y,a-=20):(n=ye.opt.drawStartX-i.x,s=ye.opt.drawStartY-i.y),F.Debug("= S.BaseLine: LMDrawRelease - deltaX:",n,"deltaY:",s,"minLength:",a),!ye.opt.lineStamp&&Math.abs(n)<r&&Math.abs(s)<r)return ye.opt.lineStamp=!0,ye.opt.WorkAreaHammer&&ye.opt.WorkAreaHammer.on("mousemove",Ls.Evt_DrawTrackHandlerFactory(this)),void F.Debug("= S.BaseLine: LMDrawRelease - negligible movement; early exit.");ye.opt.WorkAreaHammer&&(rn.UnbindActionClickHammerEvents(),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick)),t&&t.gesture&&t.gesture.stopDetect(),this.ResetAutoScrollTimer();Oe.DeepCopy(ye.opt.linkParams);const l=this.LMDrawPostRelease(ye.opt.actionStoredObjectId);ye.opt.fromOverlayLayer,l?xs.PostObjectDraw(null):xs.PostObjectDraw(this.LMDrawRelease),ye.opt.lineStamp&&(ye.opt.WorkAreaHammer&&ye.opt.WorkAreaHammer.off("mousemove"),ye.opt.lineStamp=!1),ye.opt.fromOverlayLayer&&(ye.opt.fromOverlayLayer=!1),F.Debug("= S.BaseLine: LMDrawRelease output: completed successfully")}catch(i){throw Ps.CancelOperation(),this.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),Uo.Error("= s.BaseLine: LMDrawRelease encountered error:",i),i}}LMDrawPreTrack(t){F.Debug("= S.BaseLine: LMDrawPreTrack called with event:",t);let e,i=this.GetHookFlags(),o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),n=[{x:0,y:0}],s={};return this.AllowLink()?(ye.opt.linkParams=new nn,o&&(ye.opt.fromOverlayLayer||(ye.opt.linkParams.AllowJoin=o.flags&me.SessionFlags.FreeHand)),i&Se.HookFlags.LcCHook&&(n[0].id=me.HookPts.KTL,n[0].x=t.x,n[0].y=t.y,ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0,e=ws.GetObjectPtr(ye.opt.linksBlockId,!1),Qo.FindConnect(ye.opt.actionStoredObjectId,this,n,!1,!1,ye.opt.linkParams.AllowJoin,t)?(ye.opt.linkParams.SConnectIndex=ye.opt.linkParams.ConnectIndex,ye.opt.linkParams.SConnectHookFlag=ye.opt.linkParams.ConnectHookFlag,ye.opt.linkParams.SConnectInside=ye.opt.linkParams.ConnectInside,ye.opt.linkParams.SConnectPt.x=ye.opt.linkParams.ConnectPt.x,ye.opt.linkParams.SConnectPt.y=ye.opt.linkParams.ConnectPt.y,ye.opt.linkParams.ConnectIndex=-1,ye.opt.linkParams.Hookindex=-1,ye.opt.linkParams.ConnectInside=0,ye.opt.linkParams.ConnectHookFlag=0,t.x+=ye.opt.dragDeltaX,t.y+=ye.opt.dragDeltaY,this.StartPoint.x+=ye.opt.dragDeltaX,this.StartPoint.y+=ye.opt.dragDeltaY,this.EndPoint.x=this.StartPoint.x,this.EndPoint.y=this.StartPoint.y,ye.opt.linkParams.lpCircList=Yo.GetHookList(e,ye.opt.linkParams.lpCircList,ye.opt.linkParams.SConnectIndex,this,Se.ListCodes.TargOnly,s)):ye.opt.linkParams.JoinIndex>=0&&(ye.opt.linkParams.SJoinIndex=ye.opt.linkParams.JoinIndex,ye.opt.linkParams.SJoinData=ye.opt.linkParams.JoinData,ye.opt.linkParams.SJoinSourceData=ye.opt.linkParams.JoinSourceData,ye.opt.linkParams.SConnectPt.x=ye.opt.linkParams.ConnectPt.x,ye.opt.linkParams.SConnectPt.y=ye.opt.linkParams.ConnectPt.y,ye.opt.linkParams.JoinIndex=-1,ye.opt.linkParams.JoinData=0,ye.opt.linkParams.JoinSourceData=0,ye.opt.linkParams.lpCircList=Yo.GetHookList(e,ye.opt.linkParams.lpCircList,ye.opt.linkParams.SJoinIndex,this,Se.ListCodes.CircTarg,s)))):o&&(this instanceof we.Shape.PolyLine||o.flags&me.SessionFlags.FreeHand)&&(ye.opt.linkParams=new nn,ye.opt.linkParams.ArraysOnly=!0,ye.opt.linkParams.AllowJoin=o.flags&me.SessionFlags.FreeHand),F.Debug("= S.BaseLine: LMDrawPreTrack returning:",!0),!0}LMDrawDuringTrack(t){let e;F.Debug("= S.BaseLine: LMDrawDuringTrack called with input:",t);let i=[{x:0,y:0}],o=!1;if(null==ye.opt.linkParams)return F.Debug("= S.BaseLine: LMDrawDuringTrack output (no linkParams):",t),t;if(i[0].x=t.x,i[0].y=t.y,i[0].id=me.HookPts.KTR,ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0,Qo.FindConnect(ye.opt.actionStoredObjectId,this,i,!0,!1,ye.opt.linkParams.AllowJoin,t)&&(t.x+=ye.opt.dragDeltaX,t.y+=ye.opt.dragDeltaY),ye.opt.linkParams.SJoinIndex>=0&&ye.opt.linkParams.JoinIndex<0){let i=ws.GetObjectPtr(ye.opt.linkParams.SJoinIndex);this.checkIfPolyLine(i)&&(e=new Wo(-1,0,null),e.hitcode=i.Hit(t,!1,!0,e),e&&e.hitcode===Se.HitCodes.PLApp&&ye.opt.linkParams.SJoinData!=e.segment&&(o=!0),o?(ye.opt.linkParams.JoinIndex=i.BlockID,ye.opt.linkParams.JoinData=e.segment,ye.opt.linkParams.HiliteJoin<0&&(ye.opt.linkParams.hiliteJoin=i.BlockID,Ps.GetEditMode()!=Se.EditState.LinkJoin&&(Ps.SetEditMode(Se.EditState.LinkJoin,null,!1),i.SetCursors(),Ps.SetEditMode(Se.EditState.LinkJoin,null,!1)))):(ye.opt.linkParams.HiliteJoin>=0&&(Yo.HiliteConnect(ye.opt.linkParams.HiliteJoin,ye.opt.linkParams.ConnectPt,!1,!0,this.BlockID,null),ye.opt.linkParams.HiliteJoin=-1),Ps.SetEditMode(Se.EditState.Default)))}return F.Debug("= S.BaseLine: LMDrawDuringTrack output:",t),t}LMDrawPostRelease(t){if(F.Debug("= S.BaseLine: LMDrawPostRelease input:",t),null!=ye.opt.linkParams){const e=ye.opt.linkParams;if(e.SHiliteConnect>=0&&(Yo.HiliteConnect(e.SHiliteConnect,e.SConnectPt,!1,!1,this.BlockID,e.SHiliteInside),e.SHiliteConnect=-1,e.SHiliteInside=null),e.HiliteConnect>=0&&(Yo.HiliteConnect(e.HiliteConnect,e.ConnectPt,!1,!1,this.BlockID,e.HiliteInside),e.HiliteConnect=-1,e.HiliteInside=null),e.SHiliteJoin>=0&&(Yo.HiliteConnect(e.SHiliteJoin,e.SConnectPt,!1,!0,this.BlockID,null),e.SHiliteJoin=-1),e.HiliteJoin>=0&&(Yo.HiliteConnect(e.HiliteJoin,e.ConnectPt,!1,!0,this.BlockID,null),e.HiliteJoin=-1),Ps.SetEditMode(Se.EditState.Default),e.SJoinIndex>=0){let i=en.PolyLJoin(e.SJoinIndex,e.SJoinData,t,e.SJoinSourceData,!1);if(i!==t&&i>=0){t=i,e.ConnectIndex>=0&&(e.ConnectIndex=-1);const o=ws.GetObjectPtr(i,!1);ve.EqualPt(this.EndPoint,o.StartPoint)?e.JoinSourceData=1:e.JoinSourceData=2}}let i=0;return e.JoinIndex>=0?i=-2===en.PolyLJoin(e.JoinIndex,e.JoinData,t,e.JoinSourceData,!1)?1:0:e.ConnectIndex>=0&&Yo.UpdateHook(t,e.InitialHook,e.ConnectIndex,e.HookIndex,e.ConnectPt,e.ConnectInside),this.hookflags=ve.SetFlag(this.hookflags,Se.HookFlags.LcNoContinuous,!1),ye.opt.UpdateLinks(),ye.opt.linkParams=null,F.Debug("= S.BaseLine: LMDrawPostRelease output:",i),i}return 0}LMDrawClickExceptionCleanup(t){F.Debug("= S.BaseLine: LMDrawClickExceptionCleanup called with input:",t),rn.UnbindActionClickHammerEvents(),ye.opt.lineStamp&&(ye.opt.WorkAreaHammer&&ye.opt.WorkAreaHammer.off("mousemove"),ye.opt.lineStamp=!1),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),this.ResetAutoScrollTimer(),ye.opt.linkParams=null,ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,ye.opt.lineStamp=!1,ye.opt.fromOverlayLayer=!1,ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart),F.Debug("= S.BaseLine: LMDrawClickExceptionCleanup output: cleanup complete")}LMDrawClick(t,e){F.Debug("3 ========= LMDrawClick 1 draw click e=>",t,e);try{this.Frame.x=t,this.Frame.y=e,this.StartPoint={x:t,y:e},this.EndPoint={x:t,y:e},ye.opt.WorkAreaHammer.on("drag",Ls.Evt_DrawTrackHandlerFactory(this)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_DrawReleaseHandlerFactory(this)),ye.opt.WorkAreaHammer.off("tap")}catch(i){throw F.Debug("3 ========= LMDrawClick 2 eRRdraw click e=>",i),this.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),i}}ChangeBackgroundColor(t,e){F.Debug("= S.BaseLine: ChangeBackgroundColor called with newColor:",t,"currentColor:",e),this.StyleRecord.Fill.Paint.FillType!==Se.FillTypes.Transparent&&this.StyleRecord.Fill.Paint.Color===e?(F.Debug("= S.BaseLine: Condition met. Updating background color."),ws.GetObjectPtr(this.BlockID,!0),this.StyleRecord.Fill.Paint.Color=t,F.Debug("= S.BaseLine: Background color updated to:",this.StyleRecord.Fill.Paint.Color)):F.Debug("= S.BaseLine: Condition not met. Background color remains:",this.StyleRecord.Fill.Paint.Color)}ResizeInTextEdit(t,e){F.Debug("= S.BaseLine: ResizeInTextEdit called with input:",{textObject:t,newSize:e});const i={x:0,y:0};return F.Debug("= S.BaseLine: ResizeInTextEdit output:",i),i}CalcTextPosition(t){F.Debug("= S.BaseLine: CalcTextPosition input:",t);const e=t.Frame.x+t.Frame.width/2,i=t.Frame.y+t.Frame.height/2,o=[{x:this.StartPoint.x,y:this.StartPoint.y},{x:this.EndPoint.x,y:this.EndPoint.y}],n={x:this.Frame.x+this.Frame.width/2,y:this.Frame.y+this.Frame.height/2},s=this.GetAngle(null);let a=t.RotationAngle;this.LineType===me.LineType.LINE&&(a=s+a,a%=180,Math.abs(a)<1&&(a=0));const r=this.EndPoint.x-this.StartPoint.x,l=this.EndPoint.y-this.StartPoint.y,h=s%180;ve.IsEqual(h,0)||0!==a||(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.HorizText,!0));const c=Math.sqrt(r*r+l*l);this.TextWrapWidth=c;const p=-s*Se.Geometry.PI/180;si.RotatePointsAboutPoint(n,p,o),this.LineTextX=(e-o[0].x)/c,this.LineTextX<0&&(this.LineTextX=1+this.LineTextX),this.LineTextY=i-o[0].y,this.LineTextX&&(this.trect=Oe.DeepCopy(t.trect)),F.Debug("= S.BaseLine: CalcTextPosition output:",{LineTextX:this.LineTextX,LineTextY:this.LineTextY,TextWrapWidth:this.TextWrapWidth,trect:this.trect})}SetTextObject(t){F.Debug("= S.BaseLine: SetTextObject called with newDataId =",t),this.DataID=t;const e=Vo.TextAlignToWin(this.TextAlign),i=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);return this.StyleRecord.Fill.Paint.Color=i.background.Paint.Color,e.vjust===bi.TextJust.Center?(this.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Solid,this.StyleRecord.Fill.Paint.Opacity=1):this.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Transparent,F.Debug("= S.BaseLine: SetTextObject output, DataID =",this.DataID,"StyleRecord.Fill =",this.StyleRecord.Fill),!0}GetTextOnLineParams(t){F.Debug("= S.BaseLine: GetTextOnLineParams called with input:",t);let e={Frame:new Qn,StartPoint:new De,EndPoint:new De};return e.StartPoint.x=this.StartPoint.x,e.StartPoint.y=this.StartPoint.y,e.EndPoint.x=this.EndPoint.x,e.EndPoint.y=this.EndPoint.y,e.Frame=ve.Pt2Rect(e.StartPoint,e.EndPoint),0!==this.LineTextX&&(e.CenterProp=this.LineTextX,e.Displacement=this.LineTextY),F.Debug("= S.BaseLine: GetTextOnLineParams output:",e),e}TextDirectionCommon(t,e,i,o){F.Debug("= S.BaseLine: TextDirectionCommon input:",{textObj:t,bgObj:e,useOriginal:i,extraParam:o});let n=t.GetTextMinDimensions(),s=n.width,a=n.height,r=this.GetTextOnLineParams(o),l=r.StartPoint.x,h=r.Frame.x,c=r.EndPoint.x,p=r.StartPoint.y,d=r.Frame.y,u=r.EndPoint.y,g=en.GetClockwiseAngleBetween2PointsInRadians(r.StartPoint,r.EndPoint),y=g*(180/Se.Geometry.PI),S=!1,m=.5,b={},f=0,x=0,C=0,P=0;if(t.SetVerticalAlignment("top"),this.linetrect=Oe.DeepCopy(this.Frame),this.LineTextY&&(f=this.LineTextY*Math.cos(g),x=-this.LineTextY*Math.sin(g)),y>90&&y<270&&(y-=180,S=!0),!i&&this.TextDirection){g=0,y=0;var T=this.TextAlign,O=this.TextDirection}if(this.LineTextX||this.LineTextY){if(n){this.theMinTextDim.width=s,this.theMinTextDim.height=a,i&&(this.TextAlign=T);let o=Vo.TextAlignToJust(this.TextAlign);if(S&&this.LineType===me.LineType.LINE)switch(o.just){case bi.TextAlign.Left:o.just=bi.TextAlign.Right;break;case bi.TextAlign.Right:o.just=bi.TextAlign.Left}e&&e.SetSize(s+2,a+2),m=D.CenterProp=r.CenterProp;let n=l+(c-l)*m-h+x,g=p+(u-p)*m-d+f;0===this.trect.height&&(this.trect.height=3*a);let O=this.trect.height>a?this.trect.height:a;if(C=this.TextGrow===Se.TextGrowBehavior.Horizontal?n-s/2:n-this.trect.width/2,P=g-O/2,t.SetPos(C,P),t.SetVerticalAlignment(o.vjust),t.SetParagraphAlignment(o.just),this.TextDirection?t.SetRotation(y,n,g):t.SetRotation(0,n,g),b={x:n,y:g},e){let t={};switch(o.just){case bi.TextAlign.Left:t.x=C-1;break;case bi.TextAlign.Right:t.x=C-1+this.trect.width-s;break;default:t.x=n-s/2-1}switch(o.vjust){case"top":t.y=P-1-O/2;break;case"bottom":t.y=P-a/2-1+O/2;break;default:t.y=P-a/2-1}e.SetPos(t.x,t.y)}this.linetrect.x=C+this.Frame.x,this.linetrect.y=P+this.Frame.y,this.linetrect.width=s+2,this.linetrect.height=a+2,this.TextDirection?(e&&e.SetRotation(y,n,g),this.linetrect=$o.RotateRect(this.linetrect,b,y)):e&&e.SetRotation(0,n,g),this.UpdateFrame()}}else if(n){switch(this.theMinTextDim.width=s,this.theMinTextDim.height=a,e.SetSize(s+2,a+2),this.TextAlign){case bi.TextAlign.TopLeft:C=l-h+s/2*Math.cos(g),P=p-d+s/2*Math.sin(g),e.SetPos(C-s/2-1,P-a-this.StyleRecord.Line.Thickness/2-2),C-=s/2,P=P-a-this.StyleRecord.Line.Thickness/2-1,t.SetPos(C,P),t.SetRotation(y,C+s/2,P+a/2),b={x:C+s/2,y:P+a/2},e.SetRotation(y,C+s/2,P+a/2),this.TextGrow===Se.TextGrowBehavior.Vertical&&(S=!1),S?t.SetParagraphAlignment(bi.TextAlign.Right):t.SetParagraphAlignment(bi.TextAlign.Left);break;case bi.TextAlign.Left:C=l-h+s/2*Math.cos(g),P=p-d+s/2*Math.sin(g),e.SetPos(C-s/2-1,P-a/2-1),C-=s/2,P-=a/2,t.SetPos(C,P),t.SetRotation(y,C+s/2,P+a/2),b={x:C+s/2,y:P+a/2},e.SetRotation(y,C+s/2,P+a/2),this.TextGrow===Se.TextGrowBehavior.Vertical&&(S=!1),S?t.SetParagraphAlignment(bi.TextAlign.Right):t.SetParagraphAlignment(bi.TextAlign.Left);break;default:C=(l+c)/2-h,P=(p+u)/2-d,e.SetPos(C,P),t.SetPos(C,P),t.SetRotation(y,C,P),b={x:C,y:P},e.SetRotation(y,C,P),t.SetParagraphAlignment(bi.TextAlign.Center)}this.linetrect.x=C+this.Frame.x,this.linetrect.y=P+this.Frame.y,this.linetrect.width=s,this.linetrect.height=a,b.x+=this.Frame.x,b.y+=this.Frame.y,this.linetrect=$o.RotateRect(this.linetrect,b,y),Oe.DeepCopy(this.linetrect),on.TextPinFrame(this.linetrect,a),this.linetrect.x=this.linetrect.x-this.Frame.x,this.linetrect.y=this.linetrect.y-this.Frame.y,this.UpdateFrame()}i&&(this.TextDirection=O,this.TextAlign=T),F.Debug("= S.BaseLine: TextDirectionCommon output:",{linerect:this.linetrect})}LMAddSVGTextObject(t,e){F.Debug("= S.BaseLine: LMAddSVGTextObject input:",{svgDoc:t,container:e});const i=this.trect,o=t.CreateShape(me.CSType.Rect);o.SetID(me.SVGElementClass.TextBackground),o.SetStrokeWidth(0);let n=this.StyleRecord.Fill.Paint.Color;o.SetFillColor(n),this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent?o.SetOpacity(0):o.SetOpacity(this.StyleRecord.Fill.Paint.Opacity);const s=t.CreateShape(me.CSType.Text);s.SetID(me.SVGElementClass.Text),s.SetRenderingEnabled(!1),s.SetSize(i.width,i.height),s.SetSpellCheck(this.AllowSpell()),e.isText=!0,e.textElem=s;const a=ye.stdObj.GetObject(this.DataID);a.Data.runtimeText?s.SetRuntimeText(a.Data.runtimeText):(s.SetText(""),s.SetParagraphAlignment(this.TextAlign),s.SetVerticalAlignment("top")),a.Data.runtimeText||(a.Data.runtimeText=s.GetRuntimeText()),this.TextGrow!==Se.TextGrowBehavior.Vertical&&s.SetConstraints(ye.opt.header.MaxWorkDim.x,0,i.height),this.bInGroup&&s.DisableHyperlinks(!0),s.SetRenderingEnabled(!0);const r=s.GetTextMinDimensions();r.height;if(this.TextDirection&&this.StyleRecord.Line.Thickness>=r.height&&o&&(n=this.StyleRecord.Line.Paint.Color,o.SetOpacity(0)),this.LineTextY||this.LineTextX){switch(Vo.TextAlignToWin(this.TextAlign).vjust){case bi.TextJust.Top:case bi.TextJust.Bottom:this.trect.height,this.LineTextY;break;default:this.LineTextY}}o&&e.AddElement(o),e.AddElement(s),this.TextDirectionCommon(s,o,!1,null),s.SetEditCallback(ye.opt.TextCallback,e),F.Debug("= S.BaseLine: LMAddSVGTextObject output:",{addedTextElement:s})}LMResizeSVGTextObject(t,e,i){if(F.Debug("= S.BaseLine: LMResizeSVGTextObject called with input:",{svgDoc:t,textContainer:e,extraData:i}),-1!==e.DataID){const i=t.GetElementById(me.SVGElementClass.TextBackground),o=t.GetElementById(me.SVGElementClass.Text);o&&e.TextDirectionCommon(o,i,!1,null)}F.Debug("= S.BaseLine: LMResizeSVGTextObject completed")}AdjustTextEditBackground(t,e){if(F.Debug("= S.BaseLine: AdjustTextEditBackground called with input:",{elementId:t,container:e}),-1!==this.DataID){const i=e||ye.opt.svgObjectLayer.GetElementById(t);F.Debug("= S.BaseLine: Retrieved svgContainer:",i);const o=i.GetElementById(me.SVGElementClass.TextBackground),n=i.GetElementById(me.SVGElementClass.Text);if(F.Debug("= S.BaseLine: Retrieved textBackgroundElement:",o,"and textElement:",n),n){const t=null==e;this.TextDirectionCommon(n,o,t,null),F.Debug("= S.BaseLine: TextDirectionCommon applied with useOriginal =",t)}else F.Debug("= S.BaseLine: No text element found in the SVG container.")}else F.Debug("= S.BaseLine: Skipped AdjustTextEditBackground because DataID is -1.");F.Debug("= S.BaseLine: AdjustTextEditBackground completed.")}AddCorner(t,e){F.Debug("= S.BaseLine: AddCorner called with input:",{cornerIndex:t,cornerData:e}),F.Debug("= S.BaseLine: AddCorner completed with no output (void)")}SVGTokenizerHook(t){return F.Debug("= S.BaseLine: SVGTokenizerHook called with input:",t),ye.opt.bTokenizeStyle&&((t=Oe.DeepCopy(t)).Fill.Paint.Color=Basic.Symbol.CreatePlaceholder(Basic.Symbol.Placeholder.SolidFill,t.Fill.Paint.Color),t.Line.Paint.Color=Basic.Symbol.CreatePlaceholder(Basic.Symbol.Placeholder.LineColor,t.Line.Paint.Color),0===this.StartArrowID&&0===this.EndArrowID&&(t.Line.Thickness=Basic.Symbol.CreatePlaceholder(Basic.Symbol.Placeholder.LineThick,t.Line.Thickness))),F.Debug("= S.BaseLine: SVGTokenizerHook output:",t),t}GetDimensionPoints(){F.Debug("= S.BaseLine: GetDimensionPoints called, input: none");const t=[],e=ve.Pt2Rect(this.StartPoint,this.EndPoint);F.Debug("= S.BaseLine: Computed rect =",e);const i=new De(this.StartPoint.x-e.x,this.StartPoint.y-e.y);F.Debug("= S.BaseLine: Computed relative start point =",i);const o=new De(this.EndPoint.x-e.x,this.EndPoint.y-e.y);return F.Debug("= S.BaseLine: Computed relative end point =",o),t.push(i),t.push(o),F.Debug("= S.BaseLine: GetDimensionPoints output =",t),t}PostCreateShapeCallback(t,e,i,o){F.Debug("= S.BaseLine: PostCreateShapeCallback input:",{svgDoc:t,shapeContainer:e,flag:i,extra:o});const n=e.GetElementById(me.SVGElementClass.Shape),s=e.GetElementById(me.SVGElementClass.Slop);F.Debug("= S.BaseLine: Retrieved shapeElement and slopElement",{shapeElement:n,slopElement:s});let a=ye.arrowHlkTable[this.StartArrowID],r=ye.arrowHlkTable[this.EndArrowID];const l=ye.arrowHsTable[this.ArrowSizeIndex];F.Debug("= S.BaseLine: Arrow lookup:",{startArrow:a,endArrow:r,arrowSize:l}),0===a.id&&(a=null),0===r.id&&(r=null),F.Debug("= S.BaseLine: Arrow after check:",{startArrow:a,endArrow:r}),a||r?(n.SetArrowheads(a,l,r,l,this.StartArrowDisp,this.EndArrowDisp),s.SetArrowheads(a,l,r,l,this.StartArrowDisp,this.EndArrowDisp),F.Debug("= S.BaseLine: Arrowheads set on shapeElement and slopElement")):F.Debug("= S.BaseLine: No arrowheads to set (both null)"),this.DataID>=0?(this.LMAddSVGTextObject(t,e),F.Debug("= S.BaseLine: SVG text object added")):F.Debug("= S.BaseLine: DataID is invalid, skipping text object addition"),this.UpdateDimensionLines(e,null),F.Debug("= S.BaseLine: Dimension lines updated"),F.Debug("= S.BaseLine: Coordinate lines updated"),F.Debug("= S.BaseLine: PostCreateShapeCallback completed")}CreateActionTriggers(t,e,i,o){F.Debug("= S.BaseLine: CreateActionTriggers input:",{svgDoc:t,triggerTarget:e,unusedParam:i,secondaryTarget:o});let n,s=!0,a=t.CreateShape(me.CSType.Group),r=me.Common.KnobSize,l=me.Common.RKnobSize;if(!(this instanceof we.Shape.Line&&this.objecttype===Se.FNObjectTypes.FlWall&&(ye.wallOpt&&ye.wallOpt.IsAddingWalls&&ye.wallOpt.IsAddingWalls()||Ae.DocContext.UsingWallTool))){let i=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(i*=2);const h=r/i*(this.objecttype===Se.FNObjectTypes.FlWall?2:1),c=l/i,p=this.Frame;let d=p.width+h,u=p.height+h,g=Oe.DeepCopy(p);g.x-=h/2,g.y-=h/2,g.width+=h,g.height+=h;let y,S={svgDoc:t,shapeType:me.CSType.Rect,knobSize:h,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",cursorType:this.CalcCursorForSegment(this.StartPoint,this.EndPoint,!1),locked:!1};e!==o&&(S.fillColor="white",S.strokeSize=1,S.strokeColor="black",S.fillOpacity=0),this.flags&Se.ObjFlags.Lock?(S.fillColor="gray",S.locked=!0):this.NoGrow()&&(S.fillColor="red",S.strokeColor="red",S.cursorType=ze.CursorType.Default),S.x=this.StartPoint.x-this.Frame.x,S.y=this.StartPoint.y-this.Frame.y,S.knobID=me.ActionTriggerType.LineStart;const m=ws.GetObjectPtr(e,!1);if(m&&m.hooks)for(y=0;y<m.hooks.length;y++)if(m.hooks[y].hookpt===me.HookPts.KTL){S.shapeType=me.CSType.Oval,s=!1;break}if(this.objecttype===Se.FNObjectTypes.FlWall&&(S.shapeType=me.CSType.Image),n=this.GenericKnob(S),this.objecttype===Se.FNObjectTypes.FlWall&&n.SetURL&&(n.SetURL(S.cursorType===ze.CursorType.NwseResize?ze.Knob.Path+ze.Knob.DiagonLeft:ze.Knob.Path+ze.Knob.DiagonRight),n.ExcludeFromExport(!0)),a.AddElement(n),S.shapeType=me.CSType.Rect,m&&m.hooks)for(y=0;y<m.hooks.length;y++)if(m.hooks[y].hookpt===me.HookPts.KTR){S.shapeType=me.CSType.Oval,s=!1;break}if(S.x=this.EndPoint.x-this.Frame.x,S.y=this.EndPoint.y-this.Frame.y,S.knobID=me.ActionTriggerType.LineEnd,this.objecttype===Se.FNObjectTypes.FlWall&&(S.shapeType=me.CSType.Image),n=this.GenericKnob(S),this.objecttype===Se.FNObjectTypes.FlWall&&n.SetURL&&(n.SetURL(S.cursorType===ze.CursorType.NwseResize?ze.Knob.Path+ze.Knob.DiagonLeft:ze.Knob.Path+ze.Knob.DiagonRight),n.ExcludeFromExport(!0)),a.AddElement(n),s&&!S.locked&&!this.NoGrow()){S.shapeType=me.CSType.Oval;let t=Math.atan((this.EndPoint.y-this.StartPoint.y)/(this.EndPoint.x-this.StartPoint.x));t<0&&(t=Math.abs(t)),this.EndPoint.x>=this.StartPoint.x?S.x=this.EndPoint.x-3*c*Math.cos(t)-this.Frame.x+h/2-c/2:S.x=this.EndPoint.x+3*c*Math.cos(t)-this.Frame.x+h/2-c/2,this.EndPoint.y>=this.StartPoint.y?S.y=this.EndPoint.y-3*c*Math.sin(t)-this.Frame.y+h/2-c/2:S.y=this.EndPoint.y+3*c*Math.sin(t)-this.Frame.y+h/2-c/2,S.cursorType=ze.CursorType.Rotate,S.knobID=me.ActionTriggerType.Rotate,S.fillColor="white",S.fillOpacity=.001,S.strokeSize=2.5,S.knobSize=c,S.strokeColor="white",n=this.GenericKnob(S),a.AddElement(n),S.strokeSize=1,S.strokeColor="black",n=this.GenericKnob(S),a.AddElement(n),S.knobSize=h}if(this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.CreateDimensionAdjustmentKnobs(a,t,S)}return a.SetSize(d,u),a.SetPos(g.x,g.y),a.isShape=!0,a.SetID(me.Common.Action+e),F.Debug("= S.BaseLine: CreateActionTriggers output:",a),a}}CalcCursorForSegment(t,e,i){F.Debug("= S.BaseLine: CalcCursorForSegment input:",{startPoint:t,endPoint:e,flag:i});const o=Oe.CalcAngleFromPoints(t,e);F.Debug("= S.BaseLine: Calculated angle:",o);const n=this.CalcCursorForAngle(o,i);return F.Debug("= S.BaseLine: CalcCursorForSegment output:",{cursor:n}),n}NoRotate(){F.Debug("= S.BaseLine: NoRotate called, input: none");const t=this.hooks.length>1;return F.Debug("= S.BaseLine: NoRotate output:",t),t}SetRuntimeEffects(t){F.Debug("= S.BaseLine: SetRuntimeEffects called with input:",t);const e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);e?(F.Debug("= S.BaseLine: Retrieved SVG element for BlockID",this.BlockID,":",e),this.ApplyEffects(e,t,!0),F.Debug("= S.BaseLine: Applied runtime effects with input:",t)):F.Debug("= S.BaseLine: No SVG element found for BlockID",this.BlockID)}ApplyStyles(t,e){F.Debug("= S.BaseLine: ApplyStyles called with input:",{element:t,styleObj:e});const i=e.Fill.Paint.FillType,o=e.Line.Paint.FillType,n=""!==this.ImageURL;if(this.polylist&&this.polylist.closed){if(n){let i="PROPFILL",o={x:0,y:0,width:0,height:0};this.ImageHeader&&(this.ImageHeader.croprect&&(o.x=this.ImageHeader.croprect.left,o.y=this.ImageHeader.croprect.top,o.width=this.ImageHeader.croprect.right-this.ImageHeader.croprect.left,o.height=this.ImageHeader.croprect.bottom-this.ImageHeader.croprect.top),void 0!==this.ImageHeader.imageflags&&this.ImageHeader.imageflags===Se.ImageScales.AlwaysFit&&(i="NOPROP")),F.Debug("= S.BaseLine: Applying image fill with",{url:this.ImageURL,scaleType:i,cropRect:o}),t.SetImageFill(this.ImageURL,{scaleType:i,cropRect:o}),t.SetFillOpacity(e.Fill.Paint.Opacity)}}else if(i===Se.FillTypes.Gradient){const i=this.CreateGradientRecord(e.Fill.Paint.GradientFlags,e.Fill.Paint.Color,e.Fill.Paint.Opacity,e.Fill.Paint.EndColor,e.Fill.Paint.EndOpacity);F.Debug("= S.BaseLine: Applying gradient fill with record:",i),t.SetGradientFill(i)}else if(i===Se.FillTypes.RichGradient){const i=this.CreateRichGradientRecord(e.Fill.Paint.GradientFlags);F.Debug("= S.BaseLine: Applying rich gradient fill with record:",i),t.SetGradientFill(i)}else if(i===Se.FillTypes.Texture){const i={url:"",scale:1,alignment:e.Fill.Paint.TextureScale.AlignmentScalar},o=e.Fill.Paint.Texture;ye.opt.TextureList.Textures[o]&&(i.dim=ye.opt.TextureList.Textures[o].dim,i.url=ye.opt.TextureList.Textures[o].ImageURL,i.scale=ye.opt.CalcTextureScale(e.Fill.Paint.TextureScale,i.dim.x),e.Fill.Paint.TextureScale.Scale=i.scale,i.url||(i.url=Constants.FilePath_CMSRoot+Constants.FilePath_Textures+ye.opt.TextureList.Textures[o].filename),F.Debug("= S.BaseLine: Applying texture fill with params:",i),t.SetTextureFill(i),t.SetFillOpacity(e.Fill.Paint.Opacity))}else i===Se.FillTypes.Transparent?(F.Debug("= S.BaseLine: Applying transparent fill"),t.SetFillColor("none")):(F.Debug("= S.BaseLine: Applying solid fill with color:",e.Fill.Paint.Color),t.SetFillColor(e.Fill.Paint.Color),t.SetFillOpacity(e.Fill.Paint.Opacity));if(o===Se.FillTypes.Gradient){const i=this.CreateGradientRecord(e.Line.Paint.GradientFlags,e.Line.Paint.Color,e.Line.Paint.Opacity,e.Line.Paint.EndColor,e.Line.Paint.EndOpacity);F.Debug("= S.BaseLine: Applying gradient stroke with record:",i),t.SetGradientStroke(i)}else if(o===Se.FillTypes.RichGradient){const i=this.CreateRichGradientRecord(e.Line.Paint.GradientFlags);F.Debug("= S.BaseLine: Applying rich gradient stroke with record:",i),t.SetGradientStroke(i)}else if(o===Se.FillTypes.Texture){const i={url:"",scale:e.Line.Paint.TextureScale.Scale,alignment:e.Line.Paint.TextureScale.AlignmentScalar},o=e.Line.Paint.Texture;i.dim=ye.opt.TextureList.Textures[o].dim,i.url=ye.opt.TextureList.Textures[o].ImageURL,i.url||(i.url=Constants.FilePath_CMSRoot+Constants.FilePath_Textures+ye.opt.TextureList.Textures[o].filename),F.Debug("= S.BaseLine: Applying texture stroke with params:",i),t.SetTextureStroke(i),t.SetStrokeOpacity(e.Line.Paint.Opacity)}else o===Se.FillTypes.Solid?(F.Debug("= S.BaseLine: Applying solid stroke with color:",e.Line.Paint.Color),t.SetStrokeColor(e.Line.Paint.Color),t.SetStrokeOpacity(e.Line.Paint.Opacity)):(F.Debug("= S.BaseLine: No stroke to apply, setting stroke color to none"),t.SetStrokeColor("none"));F.Debug("= S.BaseLine: ApplyStyles completed for element:",t)}CalcLineHops(t,e){F.Debug("= S.BaseLine: CalcLineHops called with targetShape =",t,"and hopData =",e);const i=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null);let o=i.length,n=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),s=n.length;for(let a=0;a<o;++a){if(this.hoplist.nhops>me.Common.MaxHops)return void F.Debug("= S.BaseLine: Maximum hop count exceeded, exiting CalcLineHops");let t,o;a>0?(t=i[a-1],o=i[a]):(t=i[a],o=i[a+1],a++),F.Debug("= S.BaseLine: Processing base segment between",t,"and",o);let r=this.AddHopPoint(t,o,n,s,a,e);if(null==r){F.Debug("= S.BaseLine: AddHopPoint returned null, breaking out of loop");break}if(F.Debug("= S.BaseLine: AddHopPoint result =",r),r.bSuccess){let i=r.tindex;if(i>=1&&s>2){if(F.Debug("= S.BaseLine: First hop success with tindex =",i,"; refining target poly points"),n=n.slice(i),s-=i,r=this.AddHopPoint(t,o,n,s,a,e),null==r){F.Debug("= S.BaseLine: Second AddHopPoint returned null, breaking out of loop");break}i=r.tindex,F.Debug("= S.BaseLine: Refined hop result, new tindex =",i)}if(i<s-1){if(F.Debug("= S.BaseLine: tindex =",i,"is less than targetPointCount - 1 =",s-1,"; further refining target poly points"),n=n.slice(i),s-=i,r=this.AddHopPoint(t,o,n,s,a,e),null==r){F.Debug("= S.BaseLine: Third AddHopPoint returned null, breaking out of loop");break}i=r.tindex,F.Debug("= S.BaseLine: Final hop refinement, new tindex =",i)}}}F.Debug("= S.BaseLine: CalcLineHops completed")}DebugLineHops(t){F.Debug("= S.BaseLine: DebugLineHops called with input:",t);const e=this.hoplist.nhops;let i=null,o=!1;const n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(0!=(n.flags&me.SessionFlags.AllowHops)){let s=n.hopdim.x,a=0,r=0,l=0;for(let h=0;h<e;h++)if(i=this.hoplist.hops[h],i.cons)o=!0,l++,a+=i.pt.x,r+=i.pt.y;else{let e;o?(e="green",s=3*n.hopdim.x,l++,a+=i.pt.x,r+=i.pt.y,a/=l,r/=l,o=!1):(e="red",s=n.hopdim.x,a=i.pt.x,r=i.pt.y);const h=ve.Pt2Rect(this.StartPoint,this.EndPoint),c={svgDoc:t,shapeType:me.CSType.Oval,x:h.x+(a-s/2),y:h.y+(r-s/2),knobSize:s,fillColor:"none",fillOpacity:1,strokeSize:1,strokeColor:e,KnobID:0,cursorType:ze.CursorType.Cross};F.Debug("= S.BaseLine: DebugLineHops knobParams:",c);const p=this.GenericKnob(c);p.SetID("hoptarget"),ye.opt.svgOverlayLayer.AddElement(p),a=0,r=0,l=0}}F.Debug("= S.BaseLine: DebugLineHops completed")}AddHopPoint(t,e,i,o,n,s){F.Debug("= S.BaseLine: AddHopPoint called with input:",{startPoint:t,endPoint:e,polyPoints:i,numPoints:o,segmentIndex:n,hopIndex:s});let a,r,l,h,c,p=0,d=0;if(this.hoplist.nhops>me.Common.MaxHops)return F.Debug("= S.BaseLine: Maximum hops exceeded, no hop added."),{bSuccess:!1,tindex:0};const u=i;i=u.slice(p);let g=ye.opt.PolyLIntersect(t,e,i,o);for(r=g.ipt,c=g.lpseg;g.bSuccess;){if(a=ve.Pt2Rect(t,e),ve.InflateRect(a,2,2),r.x>=a.x&&r.x<=a.x+a.width&&r.y>=a.y&&r.y<=a.y+a.height){c+=p,l=r.x-e.x,h=r.y-e.y;const t={segment:n,index:s,pt:r,dist:ve.Sqrt(l*l+h*h),cons:!1};this.hoplist.hops.push(t),this.hoplist.nhops++;const i={bSuccess:!0,tindex:c};return F.Debug("= S.BaseLine: AddHopPoint output:",i),i}if(p+=c,p>o-1)break;if(++d>o)break;o=(i=u.slice(p)).length,g=ye.opt.PolyLIntersect(t,e,i,o),c=g.lpseg,r=g.ipt}const y={bSuccess:!1,tindex:c};return F.Debug("= S.BaseLine: AddHopPoint output:",y),y}RightClick(t){F.Debug("= S.BaseLine: RightClick called with input:",t);const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);F.Debug("= S.BaseLine: Converted document coords:",e);const i=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);if(F.Debug("= S.BaseLine: Found target element:",i),!Qo.SelectObjectFromClick(t,i))return F.Debug("= S.BaseLine: RightClick - selection failed, returning false"),!1;const o=i.GetID();let n=ws.GetObjectPtr(o,!1);if(F.Debug("= S.BaseLine: Retrieved object:",n),n&&n.GetTextObject()>=0){const e=i.textElem;if(e){const o=e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY);F.Debug("= S.BaseLine: Spell index at location:",o),o>=0&&on.ActivateTextEdit(i,t,!0)}}if(ye.opt.rClickParam=new Le,ye.opt.rClickParam.targetId=i.GetID(),ye.opt.rClickParam.hitPoint.x=e.x,ye.opt.rClickParam.hitPoint.y=e.y,ye.opt.rClickParam.locked=(this.flags&Se.ObjFlags.Lock)>0,F.Debug("= S.BaseLine: Set Right click param:",ye.opt.rClickParam),null!=on.GetActiveTextEdit()){const e=ye.opt.svgDoc.GetActiveEdit();let i=-1;e&&(i=e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY)),F.Debug("= S.BaseLine: Active edit spell index:",i),i>=0?ye.opt.svgDoc.GetSpellCheck().ShowSpellMenu(e,i,t.gesture.center.clientX,t.gesture.center.clientY):Ts.ShowContextMenu(!0,"Line","Default")}else Ts.ShowContextMenu(!0,"Line","Default");F.Debug("= S.BaseLine: RightClick completed")}SetObjectStyle(t){F.Debug("= S.BaseLine: SetObjectStyle called with input:",t);let e=Oe.DeepCopy(t),i=!1;this.LineType!==me.LineType.SEGLINE&&null!=e.segl&&delete e.segl,null==t.EndArrowID&&null==t.StartArrowID||(this.StartPoint.x<this.EndPoint.x?i=!1:(this.StartPoint.x>this.EndPoint.x||this.StartPoint.y>this.EndPoint.y)&&(i=!0),i&&(e.EndArrowID=this.EndArrowID,e.StartArrowID=this.StartArrowID,e.EndArrowDisp=this.EndArrowDisp,e.StartArrowDisp=this.StartArrowDisp,null!=t.EndArrowID&&(e.StartArrowID=t.EndArrowID,e.StartArrowDisp=t.EndArrowDisp),null!=t.StartArrowID&&(e.EndArrowID=t.StartArrowID,e.EndArrowDisp=t.StartArrowDisp))),this.polylist&&this.polylist.closed||e&&e.StyleRecord&&e.StyleRecord.Fill&&e.StyleRecord.Fill.Hatch&&(e.StyleRecord.Fill.Hatch=0);let o=super.SetObjectStyle(e);return o.StyleRecord&&o.StyleRecord.Fill&&(this.ImageURL=""),F.Debug("= S.BaseLine: SetObjectStyle output:",o),o}GetArrowheadSelection(t){if(F.Debug("= S.BaseLine: GetArrowheadSelection - input:",t),t){(function(t){if(Math.abs(t.EndPoint.x-t.StartPoint.x)<.01)return t.EndPoint.y<t.StartPoint.y;const e=ve.Pt2Rect(t.EndPoint,t.StartPoint);return Math.abs(t.EndPoint.x-e.x)<.01&&Math.abs(t.EndPoint.y-e.y)<.01||Math.abs(t.EndPoint.x-e.x)<.01&&Math.abs(t.EndPoint.y-(e.y+e.height))<.01})(this)?(t.StartArrowID=this.EndArrowID,t.StartArrowDisp=this.EndArrowDisp,t.EndArrowID=this.StartArrowID,t.EndArrowDisp=this.StartArrowDisp):(t.StartArrowID=this.StartArrowID,t.StartArrowDisp=this.StartArrowDisp,t.EndArrowID=this.EndArrowID,t.EndArrowDisp=this.EndArrowDisp),t.ArrowSizeIndex=this.ArrowSizeIndex}return F.Debug("= S.BaseLine: GetArrowheadSelection - output:",t),!0}UpdateDimensionFromTextObj(t,e){F.Debug("= S.BaseLine: UpdateDimensionFromTextObj called with input:",{sourceElement:t,textData:e});let i="",o=-1;ye.stdObj.PreserveBlock(this.BlockID),Os.ShowSVGSelectionState(this.BlockID,!1);const n=ye.opt.svgObjectLayer.GetElementById(this.BlockID);F.Debug("= S.BaseLine: Retrieved SVG element for BlockID",this.BlockID,n),e?(i=e.text,o=e.userData):(i=t.GetText(),o=t.GetUserData()),F.Debug("= S.BaseLine: Determined text content and userData:",{textContent:i,userData:o}),this.UpdateDimensionFromText(n,i,o),F.Debug("= S.BaseLine: UpdateDimensionFromText completed"),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),F.Debug("= S.BaseLine: Set link flag for BlockID",this.BlockID);for(let s=0;s<this.hooks.length;s++)Ps.SetLinkFlag(this.hooks[s].objid,Ee.LinkFlags.Move),F.Debug("= S.BaseLine: Set link flag for hook object with id",this.hooks[s].objid);(""!==this.HyperlinkText||-1!==this.NoteID||-1!==this.commentId||this.HasFieldData())&&(ws.AddToDirtyList(this.BlockID),F.Debug("= S.BaseLine: Added BlockID to dirty list",this.BlockID)),xs.CompleteOperation(),F.Debug("= S.BaseLine: Completed operation for BlockID",this.BlockID),(this.Frame.x<0||this.Frame.y<0)&&(ye.opt.ScrollObjectIntoView(this.BlockID,!1),F.Debug("= S.BaseLine: Scrolled object into view for BlockID",this.BlockID)),F.Debug("= S.BaseLine: UpdateDimensionFromTextObj completed for BlockID",this.BlockID)}UpdateDimensionFromText(t,e,i){let o,n,s;F.Debug("= S.BaseLine: UpdateDimensionFromText called with input:",{inputElement:t,textValue:e,options:i});let a=-1;if(i.hookedObjectInfo){const o=this.UpdateDimensionsFromTextForHookedObject(t,e,i);F.Debug("= S.BaseLine: UpdateDimensionFromText (hooked) output:",o)}else{if(n=i.segment,o=this.GetDimensionValueFromString(e,n),o>=0&&(a=this.GetDimensionLengthFromValue(o)),a<0)return ws.AddToDirtyList(this.BlockID),Os.RenderDirtySVGObjects(),void F.Debug("= S.BaseLine: UpdateDimensionFromText output: invalid dimensionLength (< 0), early return");for(this.UpdateDimensions(a,null,null),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move|Ee.LinkFlags.Change),s=0;s<this.hooks.length;s++)Ps.SetLinkFlag(this.hooks[s].objid,Ee.LinkFlags.Move|Ee.LinkFlags.Change);ye.opt.UpdateLinks(),this.GetDimensionsForDisplay().width===a&&(this.rwd=o,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!0)),this.UpdateDimensionLines(t),F.Debug("= S.BaseLine: UpdateDimensionFromText completed, output dimensionLength:",a)}}UpdateSecondaryDimensions(t,e,i){F.Debug("= S.BaseLine: UpdateSecondaryDimensions called with input:",{container:t,creator:e,forcedUpdate:i});const o=this.objecttype===Se.FNObjectTypes.FlWall,n=!(this.Dimensions&Se.DimensionFlags.HideHookedObjDimensions),s=Boolean(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select||i);o&&n&&s&&this.UpdateHookedObjectDimensionLines(t,e,i),F.Debug("= S.BaseLine: UpdateSecondaryDimensions completed")}GetBoundingBoxesForSecondaryDimensions(){F.Debug("= S.BaseLine: GetBoundingBoxesForSecondaryDimensions called, input: none");const t=this.GetHookedObjectDimensionInfo();F.Debug("= S.BaseLine: Retrieved hookedInfo:",t);const e=[];if(this.objecttype===Se.FNObjectTypes.FlWall&&!(this.Dimensions&Se.DimensionFlags.HideHookedObjDimensions)&&this.Dimensions&Se.DimensionFlags.AllSeg){F.Debug("= S.BaseLine: Conditions met for processing secondary dimensions.");for(let i=0,o=t.length;i<o;i++){const o=t[i];if(F.Debug(`= S.BaseLine: Processing hookedInfo[${i}]:`,o),ve.EqualPt(o.start,o.end)){F.Debug(`= S.BaseLine: Skipping index ${i} as start and end points are equal.`);continue}const n=Oe.CalcAngleFromPoints(o.start,o.end);F.Debug(`= S.BaseLine: Calculated angle at index ${i}:`,n);const s=this.GetDimensionTextForPoints(o.start,o.end);F.Debug(`= S.BaseLine: Retrieved dimensionText at index ${i}:`,s);const a=this.GetPointsForDimension(n,s,o.start,o.end,o.segment,!0);F.Debug(`= S.BaseLine: Retrieved dimensionPoints at index ${i}:`,a),a&&(e.push(a.left),e.push(a.right),e.push(a.textFrame),F.Debug(`= S.BaseLine: Added bounding boxes from index ${i}.`))}}else F.Debug("= S.BaseLine: Conditions not met for processing secondary dimensions.");return F.Debug("= S.BaseLine: GetBoundingBoxesForSecondaryDimensions output:",e),e}AddIcon(t,e,i){let o,n;F.Debug("= S.BaseLine: AddIcon called with input:",{eventData:t,svgContainer:e,iconPositionCoords:i});const s=this.GetPolyPoints(me.Common.MaxPolyPoints,!0),a=s.length;if(this.DataID>=0)2===a?(o=s[1].x,n=s[1].y):3===a?(o=s[2].x,n=s[2].y):(o=s[a-1].x,n=s[a-1].y),this instanceof we.Shape.Line||we.Shape.ArcLine,o-=this.iconSize,i.y=n-2*this.iconSize,i.x=o-this.iconSize*this.nIcons;else{if(2===a)o=(s[0].x+s[1].x)/2,n=(s[0].y+s[1].y)/2;else if(3===a)o=s[1].x,n=s[1].y;else{const t=Math.floor(a/2);o=s[t].x,n=s[t].y}this instanceof we.Shape.Line?(o+=this.iconSize/2,i.y=n+this.iconSize/4):this instanceof we.Shape.ArcLine?(o+=this.iconSize/2,i.y=n+this.iconSize/2):this instanceof we.Shape.SegmentedLine?i.y=n+this.iconSize/2:i.y=n-this.iconSize/2,i.x=o-this.iconSize*this.nIcons}const r=this.GenericIcon(i);return this.nIcons++,e.AddElement(r),F.Debug("= S.BaseLine: AddIcon output:",r),r}GetNotePos(t,e){F.Debug("= S.BaseLine: GetNotePos called with input:",{event:t,param:e});const i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0),o=i.length;let n,s,a,r={x:0,y:0};if(this.DataID>=0){2===o?(n=i[1].x,s=i[1].y):3===o?(n=i[2].x,s=i[2].y):(n=i[o-1].x,s=i[o-1].y),this instanceof we.Shape.Line||we.Shape.ArcLine,n-=this.iconSize,r.y=s-2*this.iconSize,r.x=n-this.iconSize*this.nIcons,1===this.nIcons&&(r.x+=2*this.iconSize),a=this.GetSVGFrame();const t={x:a.x+r.x,y:a.y+r.y+this.iconSize};return F.Debug("= S.BaseLine: GetNotePos output (DataID valid):",t),t}{if(2===o)n=(i[0].x+i[1].x)/2,s=(i[0].y+i[1].y)/2;else if(3===o)n=i[1].x,s=i[1].y;else{const t=Math.floor(o/2);n=i[t].x,s=i[t].y}this instanceof we.Shape.Line?(n+=this.iconSize/2,r.y=s+this.iconSize/4):this instanceof we.Shape.ArcLine?(n+=this.iconSize/2,r.y=s+this.iconSize/2):this instanceof we.Shape.SegmentedLine?r.y=s+this.iconSize/2:r.y=s-this.iconSize/2,1===this.nIcons&&(n+=this.iconSize),r.x=n,a=this.GetSVGFrame();const t={x:a.x+r.x,y:a.y+r.y+this.iconSize};return F.Debug("= S.BaseLine: GetNotePos output (DataID invalid):",t),t}}PolyLinePrPolyLGetArcQuadrant(t,e,i){F.Debug("= S.BaseLine: PolyLinePrPolyLGetArcQuadrant - input:",{startPoint:t,endPoint:e,angle:i});let o={param:0,ShortRef:0},n=[new De(t.x,t.y),new De(e.x,e.y)];F.Debug("= S.BaseLine: Points array before rotation:",n);let s={x:t.x,y:t.y};if(F.Debug("= S.BaseLine: Center of rotation:",s),Math.abs(i)>=.01){const t=Math.sin(i),e=Math.cos(i);let o=Math.asin(t);e<0&&(o=-o),F.Debug("= S.BaseLine: rotationAngle computed:",o),si.RotatePointsAboutPoint(s,o,n),F.Debug("= S.BaseLine: Points array after rotation:",n)}else F.Debug("= S.BaseLine: Angle less than threshold, no rotation applied.");const a=n[0],r=n[1];return F.Debug("= S.BaseLine: Rotated start point:",a),F.Debug("= S.BaseLine: Rotated end point:",r),r.x>a.x?r.y>a.y?(o.param=-Se.Geometry.PI/2,o.ShortRef=me.ArcQuad.PLA_BL,F.Debug("= S.BaseLine: Condition: rotatedEnd.x > rotatedStart.x and rotatedEnd.y > rotatedStart.y"),e.notclockwise&&(o.param=0,F.Debug("= S.BaseLine: endPoint.notclockwise is true, setting result.param to 0"))):(o.ShortRef=me.ArcQuad.PLA_TL,F.Debug("= S.BaseLine: Condition: rotatedEnd.x > rotatedStart.x and rotatedEnd.y <= rotatedStart.y"),e.notclockwise&&(o.ShortRef=me.ArcQuad.PLA_TR,o.param=Se.Geometry.PI/2,F.Debug("= S.BaseLine: endPoint.notclockwise is true, setting result.ShortRef to SD_PLA_TR and result.param to PI/2"))):r.y>a.y?(o.ShortRef=me.ArcQuad.SD_PLA_BR,F.Debug("= S.BaseLine: Condition: rotatedEnd.x <= rotatedStart.x and rotatedEnd.y > rotatedStart.y"),e.notclockwise&&(o.ShortRef=me.ArcQuad.PLA_BL,o.param=Se.Geometry.PI/2,F.Debug("= S.BaseLine: endPoint.notclockwise is true, setting result.ShortRef to SD_PLA_BL and result.param to PI/2"))):(o.param=-Se.Geometry.PI/2,o.ShortRef=me.ArcQuad.PLA_TR,F.Debug("= S.BaseLine: Condition: rotatedEnd.x <= rotatedStart.x and rotatedEnd.y <= rotatedStart.y"),e.notclockwise&&(o.param=0,F.Debug("= S.BaseLine: endPoint.notclockwise is true, setting result.param to 0"))),F.Debug("= S.BaseLine: PolyLinePrPolyLGetArcQuadrant - output:",o),o}FieldDataAllowed(){F.Debug("= S.BaseLine: FieldDataAllowed called, input: none");return F.Debug("= S.BaseLine: FieldDataAllowed output:",false),false}}var is=Object.defineProperty,os=Object.getOwnPropertyDescriptor;const ns=class extends es{constructor(t){F.Debug("S.PolyLine: constructor input",t),(t=t||{}).DrawingObjectBaseClass=me.DrawObjectBaseClass.Line,t.LineType=t.LineType||me.LineType.POLYLINE,super(t),a(this,"polylist"),a(this,"StartPoint"),a(this,"EndPoint"),a(this,"hoplist"),a(this,"ArrowheadData"),a(this,"StartArrowID"),a(this,"EndArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),a(this,"RotateKnobPt"),a(this,"TextDirection"),this.polylist=t.polylist||new vi,this.polylist.flags=Ee.PolyListFlags.FreeHand,this.StartPoint=t.StartPoint||{x:0,y:0},this.EndPoint=t.EndPoint||{x:0,y:0},this.hoplist=t.hoplist||{nhops:0,hops:[]},this.ArrowheadData=t.ArrowheadData||[],this.StartArrowID=t.StartArrowID||0,this.EndArrowID=t.EndArrowID||0,this.StartArrowDisp=t.StartArrowDisp||!1,this.EndArrowDisp=t.EndArrowDisp||!1,this.ArrowSizeIndex=t.ArrowSizeIndex||0,this.RotateKnobPt={x:0,y:0},this.TextDirection=t.TextDirection||!1,this.CalcFrame(),F.Debug("S.PolyLine: constructor output",this)}CreateShape(t,e){var i;if(F.Debug("S.PolyLine: CreateShape input",t,e),this.flags&Se.ObjFlags.NotVisible)return null;const o=t.CreateShape(me.CSType.ShapeContainer),n=t.CreateShape(me.CSType.Path);n.SetID(me.SVGElementClass.Shape);const s=t.CreateShape(me.CSType.Polyline);s.SetID(me.SVGElementClass.Slop),s.ExcludeFromExport(!0),this.CalcFrame();const a=this.Frame;let r=this.StyleRecord;r=this.SVGTokenizerHook(r)||(null==(i=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1))?void 0:i.def.style);const l=r.Line.Paint.Color;let h=r.Line.Thickness;h>0&&h<1&&(h=1);const c=r.Line.Paint.Opacity,p=r.Line.LinePattern,d=a.width,u=a.height;o.SetSize(d,u),o.SetPos(a.x,a.y),n.SetSize(d,u);const g=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);this.UpdateSVG(n,g),n.SetFillColor("none"),n.SetStrokeColor(l),n.SetStrokeOpacity(c),n.SetStrokeWidth(h),0!==p&&n.SetStrokePattern(p),s.SetSize(d,u),this.UpdateSVG(s,g),s.SetStrokeColor("white"),s.SetFillColor("none"),s.SetOpacity(0),s.SetEventBehavior(e?me.EventBehavior.HiddenOut:me.EventBehavior.None),s.SetStrokeWidth(h+me.Common.Slop),o.AddElement(n),o.AddElement(s),this.ApplyStyles(n,r),this.ApplyEffects(o,!1,!0);const y=r.Fill.Hatch;if(y&&0!==y&&this.polylist&&this.polylist.closed){const e=t.CreateShape(me.CSType.Polygon);e.SetPoints(g),e.SetID(me.SVGElementClass.Hatch),e.SetSize(d,u),e.SetStrokeWidth(0),this.SetFillHatch(e,y),o.AddElement(e)}return o.isShape=!0,this.AddIcons(t,o),F.Debug("S.PolyLine: CreateShape output",o),o}PostCreateShapeCallback(t,e,i,o){F.Debug("= S.PolyLine PostCreateShapeCallback input",t,e,i,o);const n=e.GetElementById(me.SVGElementClass.Shape),s=e.GetElementById(me.SVGElementClass.Slop);let a=ye.arrowHlkTable[this.StartArrowID],r=ye.arrowHlkTable[this.EndArrowID];const l=ye.arrowHsTable[this.ArrowSizeIndex];0===a.id&&(a=null),0===r.id&&(r=null),(a||r)&&(n.SetArrowheads(a,l,r,l,this.StartArrowDisp,this.EndArrowDisp),s.SetArrowheads(a,l,r,l,this.StartArrowDisp,this.EndArrowDisp)),this.DataID>=0&&this.LMAddSVGTextObject(t,e),this.polylist&&this.polylist.segs&&this.polylist.segs.length>1&&this.UpdateDimensionLines(e),F.Debug("= S.PolyLine PostCreateShapeCallback output",e)}UpdateSVG(t,e){F.Debug("S.PolyLine: UpdateSVG input",t,e);const i=e.length;if(t&&t.PathCreator){const o=t.PathCreator();if(o.BeginPath(),i>1){o.MoveTo(e[0].x,e[0].y);for(let t=1;t<i;t++)o.LineTo(e[t].x,e[t].y)}this.polylist.closed&&o.ClosePath(),o.Apply()}F.Debug("S.PolyLine: UpdateSVG output",t)}SetFillHatch(t,e,i){if(F.Debug("S.PolyLine: SetFillHatch input",t,e,i),-1!==e&&0!==e){let o=e-1,n={},s=[];o<10&&(o="0"+o),n.url=Constants.FilePath_Hatches+Constants.HatchName+o+".png",n.scale=1,n.alignment=0,n.dim={x:128,y:128},t.SetTextureFill(n);let a=this.StyleRecord.Line.Paint.Color;i&&(a=i),s.push({type:ai.EffectType.RECOLOR,params:{color:a}}),t.Effects().SetEffects(s,this.Frame)}else t.SetFillColor("none");F.Debug("S.PolyLine: SetFillHatch output",t)}GetDimensionPoints(){F.Debug("S.PolyLine: GetDimensionPoints input");var t=[],e=[],i=0,o=0,n=0,s={},a={};if(!this.polylist.closed&&this.Dimensions&Se.DimensionFlags.EndPts)t.push(new De(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y)),t.push(new De(this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y));else if(!this.polylist.closed&&this.Dimensions&Se.DimensionFlags.Total){e=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);for(var r=1;r<e.length;r++)o=Math.abs(e[r-1].x-e[r].x),n=Math.abs(e[r-1].y-e[r].y),i+=Math.sqrt(o*o+n*n);var l={x:this.Frame.width/2,y:this.Frame.height/2};s.x=l.x-i/2,s.y=l.y,t.push(new De(s.x,s.y)),a.x=l.x+i/2,a.y=l.y,t.push(new De(a.x,a.y));var h=ye.opt.GetCounterClockwiseAngleBetween2Points(new De(0,0),new De(this.Frame.width,this.Frame.height));si.RotatePointsAboutPoint(l,h,t)}else t=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);return F.Debug("S.PolyLine: GetDimensionPoints output",t),t}AdjustDimensionLineDeflection(t,e,i,o,n){F.Debug("S.PolyLine: adjustDimensionLineDeflection input",t,e,i,o,n);const s=n.segmentIndex;this.polylist&&this.polylist.segs&&0!==this.polylist.segs.length&&s>=0&&s<this.polylist.segs.length&&(this.polylist.segs[s].dimDeflection=this.getDimensionLineDeflection(t,e,i,n),this.updateDimensionLines(t),this.Dimensions&Se.DimensionFlags.Select&&this.hideOrShowSelectOnlyDimensions(!0)),F.Debug("S.PolyLine: adjustDimensionLineDeflection output",this.polylist)}GetDimensionDeflectionValue(t){if(F.Debug("S.PolyLine: GetDimensionDeflectionValue input",t),this.polylist&&this.polylist.segs&&this.polylist.segs.length>0&&t>=0&&t<this.polylist.segs.length){const e=this.polylist.segs[t].dimDeflection;return F.Debug("S.PolyLine: GetDimensionDeflectionValue output",e),e}return F.Debug("S.PolyLine: GetDimensionDeflectionValue output",null),null}GetDimensionFloatingPointValue(t){F.Debug("S.PolyLine: GetDimensionFloatingPointValue input",t);let e=0,i={};if(!(this.rflags&Se.FloatingPointDim.Width||this.rflags&Se.FloatingPointDim.Height))return F.Debug("S.PolyLine: GetDimensionFloatingPointValue output",null),null;if(!this.GetPolyRectangularInfo(i))return F.Debug("S.PolyLine: GetDimensionFloatingPointValue output",null),null;if(i.wdDim===t||i.wdDim+2===t){if(this.rflags&Se.FloatingPointDim.Width){e=this.GetDimensionLengthFromValue(this.rwd);const t=Ve.GetLengthInRulerUnits(e);return F.Debug("S.PolyLine: GetDimensionFloatingPointValue output",t),t}}else if((i.htDim===t||i.htDim+2===t)&&this.rflags&Se.FloatingPointDim.Height){e=this.GetDimensionLengthFromValue(this.rht);const t=Ve.GetLengthInRulerUnits(e);return F.Debug("S.PolyLine: GetDimensionFloatingPointValue output",t),t}return F.Debug("S.PolyLine: GetDimensionFloatingPointValue output",null),null}UpdateDrawing(t){F.Debug("S.PolyLine: UpdateDrawing input",t),F.Debug("S.PolyLine: UpdateDrawing - Starting update of dimensions and lines");const e=t.GetElementById(me.SVGElementClass.Shape),i=t.GetElementById(me.SVGElementClass.Slop);this.CalcFrame();const o=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(this.Frame.x,this.Frame.y),e.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(e,o),i.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(i,o);const n=t.GetElementById(me.SVGElementClass.Hatch);n&&(n.SetPoints(o),n.SetSize(this.Frame.width,this.Frame.height)),null!=this.polylist&&null!=this.polylist.segs&&this.polylist.segs.length>1&&this.UpdateDimensionLines(t),F.Debug("S.PolyLine: UpdateDrawing output",t)}ScaleEndPoints(){F.Debug("S.PolyLine: ScaleEndPoints input",{Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint});let t=this.Frame.width/this.polylist.dim.x,e=this.Frame.height/this.polylist.dim.y;if(1===t&&1===e)return void F.Debug("S.PolyLine: ScaleEndPoints output - no scaling performed",{Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint});let i=this.Frame.x+this.Frame.width/2,o=this.Frame.y+this.Frame.height/2,n=i-this.StartPoint.x;this.StartPoint.x=i-n*t;let s=o-this.StartPoint.y;this.StartPoint.y=o-s*e,n=i-this.EndPoint.x,this.EndPoint.x=i-n*t,s=o-this.EndPoint.y,this.EndPoint.y=o-s*e,F.Debug("S.PolyLine: ScaleEndPoints output",{Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint})}UpdateFrame(t){F.Debug("S.PolyLine: UpdateFrame input",t),super.UpdateFrame(t),this.polylist.closed&&this.StyleRecord&&this.StyleRecord.Line,F.Debug("S.PolyLine: UpdateFrame output",this.Frame)}CalcFrame(){let t;F.Debug("S.PolyLine: CalcFrame input");let e=[],i={};this.polylist&&(this.polylist.dim.x=0,this.polylist.dim.y=0,e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),e&&e.length&&(ve.GetPolyRect(i,e),i.width<1&&(i.width=1),i.height<1&&(i.height=1),this.polylist.closed?(this.polylist.dim.x=i.width,this.polylist.dim.y=i.height,this.StyleRecord&&this.StyleRecord.Line&&(this.StyleRecord.Line.BThick||this instanceof we.Shape.PolyLineContainer)?(this.inside=Oe.DeepCopy(i),this.Frame=Oe.DeepCopy(i),t=this.StyleRecord.Line.Thickness,ve.InflateRect(this.inside,-t/2,-t/2)):(this.inside=Oe.DeepCopy(i),this.Frame=Oe.DeepCopy(i),this.StyleRecord&&this.StyleRecord.Line&&(t=this.StyleRecord.Line.Thickness))):this.Frame=Oe.DeepCopy(i))),this.UpdateFrame(this.Frame),F.Debug("S.PolyLine: CalcFrame output",this.Frame)}GetSVGFrame(t){F.Debug("S.PolyLine:GetSVGFrame input:",t);let e={};return null==t&&(t=this.Frame),ve.CopyRect(e,t),F.Debug("S.PolyLine:GetSVGFrame output:",e),e}GetDimensions(){F.Debug("S.PolyLine: GetDimensions input - Frame:",this.Frame);const t={x:this.Frame.width,y:this.Frame.height};return F.Debug("S.PolyLine: GetDimensions output:",t),t}SetSize(t,e,i){F.Debug("S.PolyLine: SetSize input",{newWidth:t,newHeight:e,extraParam:i});let o=1,n=1,s=!1,a=!1,r=0,l=0;const h=this.polylist.segs.length,c={x:0,y:0};if(t&&!ve.IsEqual(this.Frame.width,0)&&(o=t/this.Frame.width),e&&!ve.IsEqual(this.Frame.height,0)&&(n=e/this.Frame.height),1!==o||1!==n)for(let p=0;p<h;p++)this.polylist.segs[p].pt.x*=o,this.polylist.segs[p].pt.y*=n;this.StartPoint.x<=this.EndPoint.x&&(s=!0),this.StartPoint.y<=this.EndPoint.y&&(a=!0),c.x=this.EndPoint.x,c.y=this.EndPoint.y,this.EndPoint.x=this.StartPoint.x+this.polylist.segs[h-1].pt.x,this.EndPoint.y=this.StartPoint.y+this.polylist.segs[h-1].pt.y,s||(r=c.x-this.EndPoint.x,r&&(this.StartPoint.x+=r,this.EndPoint.x+=r)),a||(l=c.y-this.EndPoint.y,l&&(this.StartPoint.y+=l,this.EndPoint.y+=l)),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),this.CalcFrame(),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),F.Debug("S.PolyLine: SetSize output",{frame:this.Frame,startPoint:this.StartPoint,endPoint:this.EndPoint})}UpdateDimensions(t,e,i){F.Debug("S.PolyLine: UpdateDimensions input",{svgDocument:t,xOffset:e,yOffset:i});const o=ye.opt.svgObjectLayer.GetElementById(this.BlockID),n=e?this.StartPoint.x+e:this.EndPoint.x,s=i?this.StartPoint.y+i:this.EndPoint.y;this.AdjustLineEnd(o,n,s,me.ActionTriggerType.LineEnd),F.Debug("S.PolyLine: UpdateDimensions output",{newX:n,newY:s})}GetApparentAngle(t){F.Debug("S.PolyLine: GetApparentAngle input:",t);const e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),i=this.PolyHitSeg(t);let o=0;return o=i<0?0:this.GetDrawNormalizedAngle(e[i-1],e[i]),F.Debug("S.PolyLine: GetApparentAngle output:",o),o}SnapPointToSegment(t,e){F.Debug("S.PolyLine: SnapPointToSegment input",{segmentIndex:t,pointToSnap:e});const i={},o=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);let n=360-Oe.CalcAngleFromPoints(o[t-1],o[t]);n>=360&&(n=0);const s=2*Math.PI*(n/360);ve.GetPolyRect(i,o),si.RotatePointsAboutCenter(i,-s,o),si.RotatePointsAboutCenter(i,-s,[e]),e.y=o[t].y,si.RotatePointsAboutCenter(i,s,[e]),F.Debug("S.PolyLine: SnapPointToSegment output",{pointToSnap:e})}CalcTextPosition(t){F.Debug("S.PolyLine: CalcTextPosition input",{svgShape:t});let e,i,o=0,n=[],s={},a={},r={},l={},h={},c=[],p=0,d=Oe.DeepCopy(this);d.BlockID=-1;const u=d.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,n),g={x:t.Frame.x+t.Frame.width/2,y:t.Frame.y+t.Frame.height/2};e=n.length;const y=(t,e,i)=>{let o,n,s=0;for(let a=e;a<i;a++)o=t[a-1].x-t[a].x,n=t[a-1].y-t[a].y,s+=ve.Sqrt(o*o+n*n);return s};let S=0;for(let m=0;m<e;m++){let e;if(0===m)s.x=u[0].x,s.y=u[0].y,e=0;else{if(n[m]===n[m-1])continue;s.x=u[n[m-1]].x,s.y=u[n[m-1]].y,e=n[m-1]}a.x=u[n[m]].x,a.y=u[n[m]].y;const d=n[m]+1;let b={};if(ve.GetPolyRect(b,u,e,d),o=y(u,e+1,d),0===b.width&&ve.InflateRect(b,5,0),0===b.height&&ve.InflateRect(b,0,5),r.x=g.x,r.y=b.y,l.x=b.x,l.y=g.y,ve.pointInRect(b,r)||ve.pointInRect(b,l)){let n=0;for(let o=e+1;o<d;o++){s.x=u[o-1].x,s.y=u[o-1].y,a.x=u[o].x,a.y=u[o].y;const e=s.x-a.x,r=s.y-a.y,l=Math.sqrt(e*e+r*r);h={x:(s.x+a.x)/2,y:(s.y+a.y)/2},c=[],c.push({...s});const p=Oe.DeepCopy(g);c.push(p),c.push({...a});let d=en.GetClockwiseAngleBetween2PointsInRadians(s,a),y=d*(180/Se.Geometry.PI)%180;ve.IsEqual(y,0)||0!==t.RotationAngle||(this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.HorizText,!0)),si.RotatePointsAboutPoint(h,d,c);let m=c[1].y-c[0].y;(void 0===i||Math.abs(m)<Math.abs(i))&&(i=m,S=0+n+(c[1].x-s.x)),n+=l}p+=o}else p+=o}0===S&&(S=p/2),this.LineTextX=S/p,this.LineTextY=i,this.LineTextX&&(this.trect=Oe.DeepCopy(t.trect)),F.Debug("S.PolyLine: CalcTextPosition output",{LineTextX:this.LineTextX,LineTextY:this.LineTextY,trect:this.trect})}GetTextOnLineParams(t){F.Debug("S.PolyLine: GetTextOnLineParams input:",{textPositionFactor:t});let e,i,o={Frame:new we.Shape.Rect,StartPoint:new De,EndPoint:new De},n=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),s=n.length;n[0].x<n[s-1].x?(e=0,i=s-2):(e=s-2,i=0);let a=Math.round((s-1.1)/2),r=.5,l=this.TextAlign;switch(this.LineTextX&&(r=this.LineTextX,l=bi.TextAlign.Center),l){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:o.StartPoint.x=n[e].x,o.StartPoint.y=n[e].y,o.EndPoint.x=n[e+1].x,o.EndPoint.y=n[e+1].y;break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:o.StartPoint.x=n[i].x,o.StartPoint.y=n[i].y,o.EndPoint.x=n[i+1].x,o.EndPoint.y=n[i+1].y;break;default:a=function(t,e){let i=0,o=[];for(let r=1;r<s;r++){let t=n[r],e=n[r-1],s=t.x-e.x,a=t.y-e.y,l=ve.Sqrt(s*s+a*a);o.push(l),i+=l}let a=t*i;for(let n=0;n<s-1;n++){if(a<o[n])return e.CenterProp=a/o[n],n;a-=o[n]}return Math.round((s-1.1)/2)}(r,o),o.StartPoint.x=n[a].x,o.StartPoint.y=n[a].y,o.EndPoint.x=n[a+1].x,o.EndPoint.y=n[a+1].y}return o.Frame=Oe.DeepCopy(this.Frame),F.Debug("S.PolyLine: GetTextOnLineParams output:",o),o}AddCorner(t,e){let i,o,n,s,a,r,l,h,c,p;F.Debug("S.PolyLine: AddCorner - input:",{svgElement:t,cornerPoint:e});let d=!1;const u=this.PolyHitSeg(e),g=ws.GetObjectPtr(ye.opt.linksBlockId,!1);let y=[];if(null==t&&(t=ye.opt.svgObjectLayer.GetElementById(this.BlockID)),null!=t&&void 0!==this.polylist.segs[u]){for(y=Yo.GetHookList(g,y,this.BlockID,this,Se.ListCodes.MoveHook,{}),p=0;p<y.length;p++)ye.stdObj.PreserveBlock(y[p]);if(this.polylist.segs[u].LineType===me.LineType.LINE&&this.SnapPointToSegment(u,e),s=u+1,this.polylist.closed||1===u&&(s=1,d=!0)||u===this.polylist.segs.length-1&&(d=!0)){const t=[],i={x:this.polylist.segs[u-1].pt.x,y:this.polylist.segs[u-1].pt.y};t.push(i);const o={x:this.polylist.segs[u].pt.x,y:this.polylist.segs[u].pt.y};t.push(o);const s={x:e.x-this.StartPoint.x,y:e.y-this.StartPoint.y};t.push(s),c=Oe.CalcAngleFromPoints(t[0],t[1]);let r=360-c;if(r>=360&&(r-=360),a=2*Math.PI*(r/360),si.RotatePointsAboutCenter(this.Frame,-a,t),n=new Pi(this.polylist.segs[u].LineType,e.x-this.StartPoint.x,e.y-this.StartPoint.y),this.polylist.segs.splice(u,0,n),1===u){t[0].x=t[2].x,t[0].y+=50,si.RotatePointsAboutCenter(this.Frame,a,t);const e=t[0].x+this.StartPoint.x,i=t[0].y+this.StartPoint.y;this.polylist.segs[0].pt.x=0,this.polylist.segs[0].pt.y=0,this.AdjustLineStart(null,e,i,me.ActionTriggerType.LineStart)}else{t[1].x=t[2].x,t[1].y+=50,si.RotatePointsAboutCenter(this.Frame,a,t);const e=t[1].x+this.StartPoint.x,i=t[1].y+this.StartPoint.y;this.AdjustLineEnd(null,e,i,me.ActionTriggerType.LineEnd)}}else{switch(n=new Pi(this.polylist.segs[u].LineType,e.x-this.StartPoint.x,e.y-this.StartPoint.y),this.polylist.segs.splice(u,0,n),d||(n=new Pi(this.polylist.segs[u].LineType,e.x-this.StartPoint.x,e.y-this.StartPoint.y),this.polylist.segs.splice(u,0,n)),r=Number(ye.docUtil.rulerConfig.majorScale),ye.docUtil.rulerConfig.units){case Se.RulerUnit.Feet:l=Math.abs(r-this.polylist.segs.length),l%=r,l++,h=l.toString()+"'";break;case Se.RulerUnit.Inches:l=Math.abs(r-this.polylist.segs.length),l%=r,l++,h=l.toString()+'"';break;default:l=Math.abs(r-this.polylist.segs.length),l%=r,l++,h=l.toString()}const i=this.Dimensions;this.UpdateDimensionFromText(t,h,{segment:s}),this.Dimensions=i}Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);const S=this.hooks.length;for(p=0;p<S;p++)Ps.SetLinkFlag(this.hooks[p].objid,Ee.LinkFlags.Move);if(ye.opt.ActionTriggerData=u,this.Frame.x<0||this.Frame.y<0){const t=this.Frame;t.x<0&&(i=-t.x,t.x+=i),t.y<0&&(o=-t.y,(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&(o+=me.Common.DimDefaultStandoff),t.y+=o),this.StartPoint.x+=i,this.StartPoint.y+=o,this.EndPoint.x+=i,this.EndPoint.y+=o,ye.opt.SetObjectFrame(this.BlockID,t)}if(this.UpdateDrawing(t),-1!=this.DataID){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.LMResizeSVGTextObject(t,this,this.Frame)}Os.ShowSVGSelectionState(t.GetID(),!0),xs.CompleteOperation()}F.Debug("S.PolyLine: AddCorner - output: Corner added successfully")}GetKnobSize(t){F.Debug("S.PolyLine: GetKnobSize input",t);const e=me.Common.KnobSize;return F.Debug("S.PolyLine: GetKnobSize output",e),e}GetCornerKnobImages(){F.Debug("S.PolyLine: GetCornerKnobImages input");return F.Debug("S.PolyLine: GetCornerKnobImages output",null),null}CreateActionTriggers(t,e,i,o){F.Debug("S.PolyLine: CreateActionTriggers input",{svgDocument:t,targetObject:e,additionalData:i,actionId:o}),this.NoRotate();let n=this.GetCornerKnobImages(),s=this.GetKnobSize(t);const a=me.Common.RKnobSize;let r=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(r*=2);let l=s/r,h=a/r,c=this.polylist&&this.polylist.segs?this.polylist.segs.length:0,p=t.CreateShape(me.CSType.Group),d=this.Frame,u=Oe.DeepCopy(d);u.x-=l/2,u.y-=l/2,u.width+=l,u.height+=l;let g=ws.GetObjectPtr(e,!1),y=d.width+l,S=d.height+l;Oe.DeepCopy(d);let m={svgDoc:t,shapeType:me.CSType.Rect,knobSize:l,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",cursorType:this.CalcCursorForSegment(this.StartPoint,this.EndPoint,!1),locked:!1};if(n&&(m.strokeSize=0,delete m.strokeColor,delete m.fillColor,m.shapeType=me.CSType.Image),e!==o&&(m.fillColor="white",m.fillOpacity=0,m.strokeSize=1,m.strokeColor="black"),this.flags&Se.ObjFlags.Lock?(m.fillColor="gray",m.locked=!0):this.NoGrow()&&(m.fillColor="red",m.strokeColor="red",m.cursorType=ze.CursorType.Default),!this.polylist.closed){if(m.x=this.StartPoint.x-d.x,m.y=this.StartPoint.y-d.y,m.knobID=me.ActionTriggerType.LineStart,c>1&&(m.cursorType=this.CalcCursorForSegment(this.polylist.segs[0].pt,this.polylist.segs[1].pt,!1)),g&&g.hooks)for(let e=0;e<g.hooks.length;e++)if(g.hooks[e].hookpt===me.HookPts.KTL){m.shapeType=me.CSType.Oval;break}this.NoGrow()&&(m.cursorType=ze.CursorType.Default);let t=this.GenericKnob(m);n&&t&&t.SetURL&&t.SetURL(m.cursorType===ze.CursorType.NwseResize?n.nwse:n.nesw),p.AddElement(t)}if(m.shapeType=me.CSType.Rect,n&&(m.shapeType=me.CSType.Image),g&&g.hooks)for(let C=0;C<g.hooks.length;C++)if(g.hooks[C].hookpt===me.HookPts.KTR){m.shapeType=me.CSType.Oval;break}m.x=this.EndPoint.x-d.x,m.y=this.EndPoint.y-d.y,this.polylist.closed?(m.knobID=me.ActionTriggerType.PolyEnd,c>3?m.cursorType=this.CalcCursorForSegment(this.polylist.segs[1].pt,this.polylist.segs[c-2].pt,!0):c>1&&(m.cursorType=this.CalcCursorForSegment(this.polylist.segs[c-1].pt,this.polylist.segs[c-2].pt,!1))):(m.knobID=me.ActionTriggerType.LineEnd,c>1&&(m.cursorType=this.CalcCursorForSegment(this.polylist.segs[c-1].pt,this.polylist.segs[c-2].pt,!1))),this.NoGrow()&&(m.cursorType=ze.CursorType.Default);let b=this.GenericKnob(m);n&&b.SetURL&&(b.SetURL(m.cursorType===ze.CursorType.NwseResize?n.nwse:n.nesw),b.ExcludeFromExport(!0)),p.AddElement(b),m.shapeType=me.CSType.Rect,n&&(m.shapeType=me.CSType.Image);for(let C=1;C<c-1;C++){if(1===C)switch(this.polylist.segs[C].LineType){case me.LineType.QUADBEZ:case me.LineType.CUBEBEZ:case me.LineType.NURBS:case me.LineType.ELLIPSE:case me.LineType.SPLINE:continue}if(2===C)switch(this.polylist.segs[C].LineType){case me.LineType.NURBSSEG:case me.LineType.SPLINECON:continue}m.x=this.polylist.segs[C].pt.x+this.StartPoint.x-d.x,m.y=this.polylist.segs[C].pt.y+this.StartPoint.y-d.y,m.cursorType=this.CalcCursorForSegment(this.polylist.segs[C-1].pt,this.polylist.segs[C+1].pt,!0),this.NoGrow()&&(m.cursorType=ze.CursorType.Default),m.knobID=me.ActionTriggerType.PolyNode;let t=this.GenericKnob(m);t&&(t.SetUserData(C),n&&t.SetURL&&(t.SetURL(m.cursorType===ze.CursorType.NwseResize?n.nwse:n.nesw),t.ExcludeFromExport(!0)),p.AddElement(t))}let D={StartPoint:new De(0,0),EndPoint:new De(0,0)};D.StartPoint.x=0,D.StartPoint.y=0,D.EndPoint.x=0,D.EndPoint.y=0;let f=d.x,x=d.y;d&&this.StartPoint&&(f=this.StartPoint.x-d.x,x=this.StartPoint.y-d.y),m.shapeType=me.CSType.Oval,m.knobID=me.ActionTriggerType.PolyAdj,m.fillColor="white",m.fillOpacity=.001,m.strokeSize=1,m.strokeColor="green";for(let C=1;C<c;C++)if(this.polylist.segs[C].LineType===me.LineType.ARCLINE){D.StartPoint.x=1*this.polylist.segs[C-1].pt.x+f,D.StartPoint.y=1*this.polylist.segs[C-1].pt.y+x,D.EndPoint.x=1*this.polylist.segs[C].pt.x+f,D.EndPoint.y=1*this.polylist.segs[C].pt.y+x,this.polylist.segs[C].param>=0?(D.CurveAdjust=this.polylist.segs[C].param,D.IsReversed=!0):(D.CurveAdjust=-this.polylist.segs[C].param,D.IsReversed=!1),D.FromPolygon=!0;let t=new we.Shape.ArcLine(D);t.Frame=ve.Pt2Rect(D.StartPoint,D.EndPoint);let e=t.CalcRadiusAndCenter(t.StartPoint.x,t.StartPoint.y,t.EndPoint.x,t.EndPoint.y,t.CurveAdjust,t.IsReversed);m.x=e.actionX,m.y=e.actionY;let i=this.GenericKnob(m);i.SetUserData(C),p.AddElement(i)}else if(this.polylist.segs[C].LineType===me.LineType.PARABOLA){let t=this.PrPolyLGetParabolaAdjPoint(!0,C);if(t){m.x=t.x+this.StartPoint.x-d.x,m.y=t.y+this.StartPoint.y-d.y;let e=this.GenericKnob(m);e.SetUserData(C),p.AddElement(e)}}else if(this.polylist.segs[C].LineType===me.LineType.ARCSEGLINE){let t=this.PrPolyLGetEllipseAdjPoint(!0,C);m.x=t.x+this.StartPoint.x-d.x,m.y=t.y+this.StartPoint.y-d.y;let e=this.GenericKnob(m);e.SetUserData(C),p.AddElement(e)}if(!m.locked&&!this.NoGrow()){m.shapeType=me.CSType.Oval,d.width<d.height?(m.x=d.width/2,m.y=d.height-2*h):(m.y=d.height/2,m.x=d.width-2*h),this.RotateKnobPt.x=m.x+d.x,this.RotateKnobPt.y=m.y+d.y,m.cursorType=ze.CursorType.Rotate,m.knobID=me.ActionTriggerType.Rotate,m.fillColor="white",m.fillOpacity=.5,m.strokeSize=1.5,m.strokeColor="black",m.knobSize=h;let t=this.GenericKnob(m);p.AddElement(t),m.knobSize=l}return this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()&&this.CreateDimensionAdjustmentKnobs(p,i,m),p.SetSize(y,S),p.SetPos(u.x,u.y),p.isShape=!0,p.SetID(me.Common.Action+e),F.Debug("S.PolyLine: CreateActionTriggers output",p),p}ScaleObject(t,e,i,o,n,s,a){let r,l,h,c;F.Debug("S.PolyLine: ScaleObject input",{offsetX:t,offsetY:e,rotationCenter:i,rotationAngleDegrees:o,scaleX:n,scaleY:s,adjustLineThickness:a});let p={x:0,y:0},d={x:0,y:0},u={x:0,y:0},g=[];if(0===n){if(!(this.polylist.dim.x>0&&this.polylist.dim.y>0))return;n=this.inside.width/this.polylist.dim.x,s=this.inside.height/this.polylist.dim.y,this.StartPoint.x=this.Frame.x+this.polylist.offset.x,this.StartPoint.y=this.Frame.y+this.polylist.offset.y}if(this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),1!==n||1!==s){if(a){let t=n;s>t&&(t=s),this.StyleRecord.Line.Thickness=t*this.StyleRecord.Line.Thickness,this.StyleRecord.Line.BThick=t*this.StyleRecord.Line.BThick}for(p.x=this.StartPoint.x-this.Frame.x,p.y=this.StartPoint.y-this.Frame.y,d.x=p.x*n,d.y=p.y*s,l=this.polylist.segs.length,r=1;r<l;r++)switch(this.polylist.segs[r].LineType){case me.LineType.PARABOLA:0!==this.polylist.segs[r].param&&r>0&&(h=this.PrPolyLGetParabolaAdjPoint(!0,r),h?(h.x+=this.StartPoint.x,h.y+=this.StartPoint.y,g[r]=new De(h.x,h.y)):(this.polylist.segs[r].param=0,this.polylist.segs[r].ShortRef=0));break;case me.LineType.ARCLINE:0!==this.polylist.segs[r].param&&r>0&&(c=this.PrPolyLGetArc(r,p),g[r]=c.pt)}for(this.StartPoint.x=this.StartPoint.x*n,this.StartPoint.y=this.StartPoint.y*s,this.EndPoint.x=this.EndPoint.x*n,this.EndPoint.y=this.EndPoint.y*s,r=0;r<l;r++)switch(this.polylist.segs[r].LineType){case me.LineType.PARABOLA:if(this.polylist.segs[r].pt.x*=n,this.polylist.segs[r].pt.y*=s,0!==this.polylist.segs[r].param&&r>0){let t={x:g[r].x*n,y:g[r].y*s};this.PrPolyLGetParabolaParam(t,r)}break;case me.LineType.ARCLINE:this.polylist.segs[r].pt.x*=n,this.polylist.segs[r].pt.y*=s,0!==this.polylist.segs[r].param&&r>0&&(c=this.PrPolyLGetArc(r,d),u.x=g[r].x*n,u.y=g[r].y*s,this.PrPolyLGetArcParam(c.arcobj,u,r));break;default:this.polylist.segs[r].pt.x*=n,this.polylist.segs[r].pt.y*=s}if(this instanceof Zn)return this.polylist.offset.x=d.x,this.polylist.offset.y=d.y,this.polylist.dim.x=this.inside.width,this.polylist.dim.y=this.inside.height,void F.Debug("S.PolyLine: ScaleObject output (BaseShape scaling applied)",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,Frame:this.Frame})}else if(this instanceof Zn)return;let y=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);for(l=y.length,r=0;r<l;r++)y[r].x+=t,y[r].y+=e;if(o){let t=2*Math.PI*(o/360);si.RotatePointsAboutPoint(i,2*Math.PI-t,y)}for(this.StartPoint.x=y[0].x,this.StartPoint.y=y[0].y,r=0;r<l;r++)this.polylist.segs[r].pt.x=y[r].x-this.StartPoint.x,this.polylist.segs[r].pt.y=y[r].y-this.StartPoint.y;this.EndPoint.x=y[l-1].x,this.EndPoint.y=y[l-1].y,this.CalcFrame(),F.Debug("S.PolyLine: ScaleObject output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,Frame:this.Frame})}GetScale(){let t,e,i;F.Debug("S.PolyLine: GetScale input",{});let o={x:0,y:0};return this.polylist.closed&&this.polylist.dim.x&&this.polylist.dim.y?(t=this.polylist.dim.x,e=this.polylist.dim.y<1?1:this.polylist.dim.y,t<1&&(t=1),i=this.inside.width/t,this.inside.height):i=1,o.x=i,o.y=i,F.Debug("S.PolyLine: GetScale output",o),o}GetPolyPoints(t,e,i,o,n){F.Debug("S.PolyLine: GetPolyPoints input",{pointCount:t,includeFrameOffset:e,includeAllSegments:i,includeClosedSegments:o,segmentIndices:n});let s=[],a=1,r=1,l=this.StartPoint.x-this.Frame.x,h=this.StartPoint.y-this.Frame.y;if(this.polylist&&this.polylist.segs.length){if(this.polylist.closed&&this.polylist.dim.x&&this.polylist.dim.y){let t=this.polylist.dim.x,e=this.polylist.dim.y<1?1:this.polylist.dim.y;t=t<1?1:t,a=this.inside.width/t,r=this.inside.height/e}const o=this.polylist.segs.length;if(i)for(let t=0;t<o;t++)s.push(new De(this.polylist.segs[t].pt.x*a+l,this.polylist.segs[t].pt.y*r+h));else{s.push(new De(this.polylist.segs[0].pt.x*a+l,this.polylist.segs[0].pt.y*r+h));for(let e=1;e<o;e++){switch(this.polylist.segs[e].LineType){case me.LineType.LINE:case me.LineType.MOVETO:case me.LineType.MOVETO_NEWPOLY:s.push(new De(this.polylist.segs[e].pt.x*a+l,this.polylist.segs[e].pt.y*r+h));break;case me.LineType.NURBS:if(e<o-1&&this.polylist.segs[e+1].LineType==me.LineType.NURBSSEG){let i=0;for(let t=e;t<o&&this.polylist.segs[t].LineType==me.LineType.NURBSSEG;t++){let e=this.polylist.segs[t].pt.x-this.polylist.segs[t-1].pt.x,o=this.polylist.segs[t].pt.y-this.polylist.segs[t-1].pt.y;i+=Math.sqrt(e*e+o*o)}const n=ye.opt.svgDoc.docInfo.docScale;let c=Math.floor(i/8*n);c=c<t?t:c;const p=this.PrGetNURBSPoints(e,c,l,h,a,r);s=s.concat(p)}break;case me.LineType.QUADBEZ:const i=this.PrGetQuadraticBezierPoints(e,t,l,h,a,r);s=s.concat(i);break;case me.LineType.CUBEBEZ:const n=this.PrGetCubicBezierPoints(e,t,l,h,a,r);s=s.concat(n);break;case me.LineType.ELLIPSE:const c=this.PrGetEllipticalArcPoints(e,t,l,h,a,r);s=s.concat(c);break;case me.LineType.SPLINE:if(e<o-1&&this.polylist.segs[e+1].LineType==me.LineType.SPLINECON){let i=0;for(let t=e;t<o&&this.polylist.segs[t].LineType==me.LineType.SPLINECON;t++){let e=this.polylist.segs[t].pt.x-this.polylist.segs[t-1].pt.x,o=this.polylist.segs[t].pt.y-this.polylist.segs[t-1].pt.y;i+=Math.sqrt(e*e+o*o)}const n=ye.opt.svgDoc.docInfo.docScale;let c=Math.floor(i/8*n);c=c<t?t:c;const p=this.PrGetSPLINEPoints(e,c,l,h,a,r);s=s.concat(p)}break;case me.LineType.PARABOLA:const p=this.PrGetParabolaPoints(t,!0,e,this.polylist.segs[e].param,this.polylist.segs[e].ShortRef,a,r);s=s.concat(p),s.push(new De(this.polylist.segs[e].pt.x*a+l,this.polylist.segs[e].pt.y*r+h));break;case me.LineType.ARCSEGLINE:const d=this.PrGetEllipsePoints(t,!0,e,this.polylist.segs[e].param,this.polylist.segs[e].ShortRef,a,r);s=s.concat(d),s.push(new De(this.polylist.segs[e].pt.x*a+l,this.polylist.segs[e].pt.y*r+h));break;case me.LineType.ARCLINE:if(0===this.polylist.segs[e].param)s.push(new De(this.polylist.segs[e].pt.x*a+l,this.polylist.segs[e].pt.y*r+h));else{const t={StartPoint:new De(this.polylist.segs[e-1].pt.x,this.polylist.segs[e-1].pt.y),EndPoint:new De(this.polylist.segs[e].pt.x,this.polylist.segs[e].pt.y),CurveAdjust:Math.abs(this.polylist.segs[e].param),IsReversed:this.polylist.segs[e].param>=0,FromPolygon:!0},i=new we.Shape.ArcLine(t);i.Frame=ve.Pt2Rect(t.StartPoint,t.EndPoint);const o=i.GetPolyPoints(Math.ceil(me.Common.MaxPolyPoints/2),!1,!1,!1,null);for(let e=0;e<o.length;e++)o[e].x=o[e].x*a+l,o[e].y=o[e].y*r+h;s=s.concat(o),s.push(new De(this.polylist.segs[e].pt.x*a+l,this.polylist.segs[e].pt.y*r+h))}}n&&n.push(s.length-1)}}if(!e)for(let t=0;t<s.length;t++)s[t].x+=this.Frame.x,s[t].y+=this.Frame.y}else s=super.GetPolyPoints(t,e,!0);return F.Debug("S.PolyLine: GetPolyPoints output",s),s}BeforeModifyShape(t,e,i){F.Debug("S.PolyLine: BeforeModifyShape input",{event:t,x:e,y:i});let o,n,s,a,r,l={};if(o=this.polylist&&this.polylist.segs?this.polylist.segs.length:0,0!==o){if(this.polylist.closed&&this.polylist.dim.x&&this.polylist.dim.y){let t=this.polylist.dim.x,e=this.polylist.dim.y<1?1:this.polylist.dim.y;t=t<1?1:t,n=this.Frame.width/t,s=this.Frame.height/e}else n=1,s=1;if(a=this.StartPoint.x,r=this.StartPoint.y,i>0&&i<=o-1)switch(this.polylist.segs[i].LineType){case me.LineType.PARABOLA:break;case me.LineType.ARCLINE:l.StartPoint=new De(this.polylist.segs[i-1].pt.x*n+a,this.polylist.segs[i-1].pt.y*s+r),l.EndPoint=new De(this.polylist.segs[i].pt.x*n+a,this.polylist.segs[i].pt.y*s+r);let o=this.polylist.segs[i].param;o>=0?(l.CurveAdjust=o,l.IsReversed=!0):(l.CurveAdjust=-o,l.IsReversed=!1),l.FromPolygon=!0,this.arcobj=new we.Shape.ArcLine(l),this.arcobj.Frame=ve.Pt2Rect(l.StartPoint,l.EndPoint),this.arcobj.BeforeModifyShape(t,e,i)}}F.Debug("S.PolyLine: BeforeModifyShape output",{arcParams:l})}SnapNewPointTo90Degrees(t,e){F.Debug("S.PolyLine: SnapNewPointTo90Degrees input",{segmentIndex:t,newPoint:e});let i=-1,o=-1,n=!1;if(!window.event||!window.event.ctrlKey){const s=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);t-1>=0?i=t-1:this.polylist.closed&&this.polylist.segs.length>2&&(i=this.polylist.segs.length-2),i>=0&&this.AdjustForLineAngleSnap(s[i],e)&&(n=!0),o=t+1,o>=this.polylist.segs.length&&(o=this.polylist.closed?1:-1),o>=0&&this.AdjustForLineAngleSnap(s[o],e)&&(n=!0)}return F.Debug("S.PolyLine: SnapNewPointTo90Degrees output",n),n}ModifyShape(t,e,i,o,n,s){F.Debug("S.PolyLine: ModifyShape input",{event:t,x:e,y:i,actionType:o,segmentIndex:n,snapToGrid:s});let a=this.polylist&&this.polylist.segs?this.polylist.segs.length:0,r={},l=null;if(0!==a){if(o===me.ActionTriggerType.PolyNode)n>=1&&n<a&&(l=new De(e,i),!s&&this.SnapNewPointTo90Degrees(n,l)&&(e=l.x,i=l.y),this.polylist.segs[n].pt.x=e-this.StartPoint.x,this.polylist.segs[n].pt.y=i-this.StartPoint.y,this.polylist.segs[n].LineType===me.LineType.ARCSEGLINE&&(r=this.PrPolyLGetArcQuadrant(this.polylist.segs[n-1].pt,this.polylist.segs[n].pt,this.polylist.segs[n].param),this.polylist.segs[n].ShortRef=r.ShortRef),n<a-1&&this.polylist.segs[n+1].LineType===me.LineType.ARCSEGLINE&&(r=this.PrPolyLGetArcQuadrant(this.polylist.segs[n].pt,this.polylist.segs[n+1].pt,this.polylist.segs[n+1].param),this.polylist.segs[n+1].ShortRef=r.ShortRef));else if(o===me.ActionTriggerType.PolyAdj&&n>0&&n<=a-1)switch(this.polylist.segs[n].LineType){case me.LineType.PARABOLA:r.x=e,r.y=i,this.PrPolyLGetParabolaParam(r,n);break;case me.LineType.ARCSEGLINE:r.x=e,r.y=i,this.PrPolyLGetEllipseParam(r,n,t);break;case me.LineType.ARCLINE:this.arcobj&&(this.arcobj.ModifyShape(null,e,i,o,n),this.polylist.segs[n].param=this.arcobj.IsReversed?this.arcobj.CurveAdjust:-this.arcobj.CurveAdjust)}const h={x:e,y:i},c=this.GetDimensionsForDisplay();Ts.UpdateDisplayCoordinates(c,h,ze.CursorTypes.Grow,this),this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)}F.Debug("S.PolyLine: ModifyShape output",{polylist:this.polylist,Frame:this.Frame})}BeforeRotate(t){F.Debug("S.PolyLine: BeforeRotate input",t);const e=this.Frame;ye.opt.rotateKnobCenterDivisor=this.RotateKnobCenterDivisor(),ye.opt.rotateStartRotation=0,ye.opt.rotateEndRotation=ye.opt.rotateStartRotation,ye.opt.rotateStartPoint.x=this.RotateKnobPt.x,ye.opt.rotateStartPoint.y=this.RotateKnobPt.y,ye.opt.rotatePivotX=e.x+e.width/ye.opt.rotateKnobCenterDivisor.x,ye.opt.rotatePivotY=e.y+e.height/ye.opt.rotateKnobCenterDivisor.y,F.Debug("S.PolyLine: BeforeRotate output",{rotateKnobCenterDivisor:ye.opt.rotateKnobCenterDivisor,rotateStartRotation:ye.opt.rotateStartRotation,rotateEndRotation:ye.opt.rotateEndRotation,rotateStartPoint:ye.opt.rotateStartPoint,rotatePivotX:ye.opt.rotatePivotX,rotatePivotY:ye.opt.rotatePivotY})}AdjustRotate(t,e,i){let o;F.Debug("S.PolyLine: AdjustRotate input",{mouseX:t,mouseY:e,event:i});const n=ye.opt.rotatePivotX,s=ye.opt.rotatePivotY,a=ye.opt.rotateStartPoint.x,r=ye.opt.rotateStartPoint.y;let l=t-n,h=e-s;if(a===n)Math.abs(h)<1e-4&&(h=1e-4),o=180*-Math.atan(l/h)/Se.Geometry.PI,h<0&&(o+=180);else{if(r!==s)return;Math.abs(l)<1e-4&&(l=1e-4),o=180*Math.atan(h/l)/Se.Geometry.PI,l<0&&(o+=180)}const c=ye.opt.OverrideSnaps(i);ye.docUtil.docConfig.enableSnap&&!c&&(o=Math.round(o/ye.opt.rotateSnap)*ye.opt.rotateSnap),o<0&&(o+=360);const p=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);si.RotatePointsAboutCenter(this.Frame,o/360*(2*Math.PI),p);const d={};if(ve.GetPolyRect(d,p),d.x>=0&&d.y>=0){if(ye.opt.header.flags&me.HeaderFlags.NoAuto){const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(d.x+d.width>t.dim.x||d.y+d.height>t.dim.y)return}ye.opt.rotateEndRotation=o,this.Rotate(ye.opt.actionSvgObject,o)}F.Debug("S.PolyLine: AdjustRotate output",{rotationAngle:o})}Rotate(t,e){F.Debug("S.PolyLine: Rotate input",{svgElement:t,rotationAngle:e}),t.SetRotation(e,ye.opt.rotatePivotX,ye.opt.rotatePivotY),F.Debug("S.PolyLine: Rotate output",{svgElement:t,rotationAngle:e})}AfterRotateShape(t,e){F.Debug("S.PolyLine: AfterRotateShape input",{event:t,actionType:e});const i=ye.opt.rotateEndRotation,o={x:ye.opt.rotatePivotX,y:ye.opt.rotatePivotY},n=-(i-ye.opt.rotateStartRotation)/(180/Se.Geometry.PI);ye.opt.RotatePointAroundPoint(o,ye.opt.rotateStartPoint,n);const s=this.polylist.segs.length;for(let l=0;l<s;++l)this.polylist.segs[l].LineType===me.LineType.ELLIPSE&&(this.polylist.segs[l].weight+=10*i);const a=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);si.RotatePointsAboutPoint(o,n,a);const r=a.length;this.StartPoint.x=a[0].x,this.StartPoint.y=a[0].y;for(let l=0;l<r;l++)this.polylist.segs[l].pt.x=a[l].x-this.StartPoint.x,this.polylist.segs[l].pt.y=a[l].y-this.StartPoint.y;if(this.EndPoint.x=a[r-1].x,this.EndPoint.y=a[r-1].y,e!==me.ActionTriggerType.MovePolySeg){if(this.CalcFrame(),ws.AddToDirtyList(t),Os.RenderDirtySVGObjects(),this.UpdateFrame(),this.r.x<0||this.r.y<0)return void $o.Undo();ye.opt.ob&&ye.opt.ob.Frame&&(Yo.MaintainLink(t,this,ye.opt.ob,me.ActionTriggerType.Rotate),ye.opt.ob={}),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),ws.AddToDirtyList(t)}F.Debug("S.PolyLine: AfterRotateShape output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,Frame:this.Frame})}IsAdjustingToClosed(t,e){F.Debug("S.PolyLine: isAdjustingToClosed input",{x:t,y:e});const i=new Wo(-1,0,null),o={id:ye.opt.actionTriggerId===me.ActionTriggerType.LineStart?me.HookPts.KTL:me.HookPts.KTR,x:t,y:e},n=this.ClosePolygon(this.BlockID,[o],i);return F.Debug("S.PolyLine: isAdjustingToClosed output",n),n}AdjustLine(t,e,i,o,n){F.Debug("S.PolyLine: AdjustLine input",{event:t,newX:e,newY:i,actionType:o,snapToGrid:n});let s=this.polylist.segs.length,a={},r=new De(e,i);switch(this.polylist.closed&&o===me.ActionTriggerType.PolyEnd&&(o=me.ActionTriggerType.LineStart),o){case me.ActionTriggerType.LineEnd:!n&&this.SnapNewPointTo90Degrees(s-1,r)&&(e=r.x,i=r.y),this.polylist.segs[s-1].pt.x=e-this.StartPoint.x,this.polylist.segs[s-1].pt.y=i-this.StartPoint.y,this.EndPoint.x=e,this.EndPoint.y=i,this.polylist.segs[s-1].LineType===me.LineType.ARCSEGLINE&&(a=this.PrPolyLGetArcQuadrant(this.polylist.segs[s-2].pt,this.polylist.segs[s-1].pt,this.polylist.segs[s-1].param),this.polylist.segs[s-1].ShortRef=a.ShortRef);break;case me.ActionTriggerType.LineStart:!n&&this.SnapNewPointTo90Degrees(0,r)&&(e=r.x,i=r.y);let t=e-this.StartPoint.x,o=i-this.StartPoint.y;this.StartPoint.x=e,this.StartPoint.y=i;for(let e=1;e<s;e++)this.polylist.segs[e].pt.x-=t,this.polylist.segs[e].pt.y-=o;switch(this.polylist.closed&&(this.EndPoint.x=this.StartPoint.x,this.EndPoint.y=this.StartPoint.y,this.polylist.segs[s-1].pt.x=0,this.polylist.segs[s-1].pt.y=0),this.polylist.segs[1].LineType){case me.LineType.ARCSEGLINE:a=this.PrPolyLGetArcQuadrant(this.polylist.segs[0].pt,this.polylist.segs[1].pt,this.polylist.segs[1].param),this.polylist.segs[1].ShortRef=a.ShortRef;break;case me.LineType.QUADBEZ:case me.LineType.CUBEBEZ:case me.LineType.ELLIPSE:this.polylist.segs[1].pt.x=this.polylist.segs[0].pt.x,this.polylist.segs[1].pt.y=this.polylist.segs[0].pt.y;break;case me.LineType.NURBS:case me.LineType.SPLINE:this.polylist.segs[1].pt.x=this.polylist.segs[0].pt.x,this.polylist.segs[1].pt.y=this.polylist.segs[0].pt.y,this.polylist.segs[2].pt.x=this.polylist.segs[0].pt.x,this.polylist.segs[2].pt.y=this.polylist.segs[0].pt.y}}t?(this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)):this.CalcFrame();const l=this.GetDimensionsForDisplay();Ts.UpdateDisplayCoordinates(l,r,ze.CursorTypes.Grow,this),F.Debug("S.PolyLine: AdjustLine output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,Frame:this.Frame})}AdjustLineEnd(t,e,i,o,n){if(F.Debug("S.PolyLine: AdjustLineEnd input",{event:t,newX:e,newY:i,actionType:o,snapToGrid:n}),2===this.polylist.segs.length){const t={x:this.EndPoint.x,y:this.EndPoint.y};this.EndPoint.x=e,this.EndPoint.y=i,this.EnforceMinimum(!1),e=this.EndPoint.x,i=this.EndPoint.y,this.EndPoint.x=t.x,this.EndPoint.y=t.y}this.AdjustLine(t,e,i,o,n),F.Debug("S.PolyLine: AdjustLineEnd output",{EndPoint:this.EndPoint})}AdjustLineStart(t,e,i,o,n){if(F.Debug("S.PolyLine: AdjustLineStart input",{event:t,newX:e,newY:i,actionType:o,snapToGrid:n}),2===this.polylist.segs.length){const t={x:this.StartPoint.x,y:this.StartPoint.y};this.StartPoint.x=e,this.StartPoint.y=i,this.EnforceMinimum(!0),e=this.StartPoint.x,i=this.StartPoint.y,this.StartPoint.x=t.x,this.StartPoint.y=t.y}this.AdjustLine(t,e,i,me.ActionTriggerType.LineStart,n),F.Debug("S.PolyLine: AdjustLineStart output",{StartPoint:this.StartPoint})}Flip(t,e){F.Debug("S.PolyLine: Flip input",{flags:t,isTemporary:e});let i,o,n,s,a=!1;const r=[],l=[],h={};if(e||(ye.opt.ob=Oe.DeepCopy(this)),i=this.polylist.segs.length,o=this.Frame,this.polylist.closed&&this.polylist.dim.x&&this.polylist.dim.y?(n=this.polylist.dim.x,s=this.polylist.dim.y,this instanceof we.Shape.Polygon&&(this.StartPoint.x=this.Frame.x+this.polylist.offset.x,this.StartPoint.y=this.Frame.y+this.polylist.offset.y)):(n=o.width,s=o.height),t&me.ExtraFlags.FlipVert){a=!0;const t=this.StartPoint.y-o.y;for(let n=0;n<i;n++)r.push(new De(this.polylist.segs[n].pt.x,this.polylist.segs[n].pt.y+t)),this.polylist.segs[n].LineType===me.LineType.PARABOLA&&(l[n]=this.PrPolyLGetParabolaAdjPoint(!1,n),l[n].y-=o.y);for(let n=0;n<i;n++)r[n].y=s-r[n].y,l[n]&&(l[n].y=s-l[n].y,l[n].y+=o.y);const e=r[0].y;for(let o=0;o<i;o++)this.polylist.segs[o].pt.y=r[o].y-e;this.StartPoint.y=r[0].y+this.Frame.y,this.EndPoint.y=r[i-1].y+this.Frame.y}if(t&me.ExtraFlags.FlipHoriz){a=!0;const t=this.StartPoint.x-o.x;for(let n=0;n<i;n++)r.push(new De(this.polylist.segs[n].pt.x+t,this.polylist.segs[n].pt.y)),this.polylist.segs[n].LineType===me.LineType.PARABOLA&&n>0&&(l[n]=this.PrPolyLGetParabolaAdjPoint(!1,n),l[n].x-=o.x);for(let s=0;s<i;s++)r[s].x=n-r[s].x,l[s]&&(l[s].x=n-l[s].x,l[s].x+=o.x);const e=r[0].x;for(let o=0;o<i;o++)this.polylist.segs[o].pt.x=r[o].x-e;this.StartPoint.x=r[0].x+this.Frame.x,this.EndPoint.x=r[i-1].x+this.Frame.x}if(a){for(let t=0;t<i;t++)switch(this.polylist.segs[t].LineType){case me.LineType.ARCLINE:this.polylist.segs[t].param=-this.polylist.segs[t].param;break;case me.LineType.ARCSEGLINE:const e=this.PrPolyLGetArcQuadrant(this.polylist.segs[t-1].pt,this.polylist.segs[t].pt,this.polylist.segs[t].param);this.polylist.segs[t].ShortRef=e.ShortRef;break;case me.LineType.PARABOLA:l[t]&&(h.x=l[t].x,h.y=l[t].y,this.PrPolyLGetParabolaParam(h,t));break;case me.LineType.ELLIPSE:let i=this.polylist.segs[t].weight;i=3600-i,this.polylist.segs[t].weight=i}e||(ye.opt.ob&&ye.opt.ob.Frame&&Yo.MaintainLink(this.BlockID,this,ye.opt.ob,me.ActionTriggerType.Flip),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move)),this.polylist.closed&&(this.polylist.offset.x=this.StartPoint.x-this.Frame.x,this.polylist.offset.y=this.StartPoint.y-this.Frame.y)}ye.opt.ob={},F.Debug("S.PolyLine: Flip output",this)}LinkGrow(t,e,i){switch(F.Debug("S.PolyLine: LinkGrow input",{blockID:t,hookPoint:e,newPoint:i}),e){case me.HookPts.KTL:this.AdjustLineStart(null,i.x,i.y);break;case me.HookPts.KTR:this.AdjustLineEnd(null,i.x,i.y,me.ActionTriggerType.LineEnd)}Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ws.AddToDirtyList(t),F.Debug("S.PolyLine: LinkGrow output",{blockID:t,hookPoint:e,newPoint:i})}ClosePolygon(t,e,i){if(F.Debug("S.PolyLine: ClosePolygon input",{blockID:t,hookPoints:e,hitResult:i}),e&&e.length&&this.polylist&&this.polylist.segs.length>3&&!this.polylist.closed&&(this.Hit(e[0],!1,!0,i,e[0].id),i.hitcode===Se.HitCodes.PLApp)){if(e[0].id===me.HookPts.KTL&&i.segment===me.HookPts.KTR)return i.objectid=t,i.pt.x=this.polylist.segs[this.polylist.segs.length-1].pt.x+this.StartPoint.x,i.pt.y=this.polylist.segs[this.polylist.segs.length-1].pt.y+this.StartPoint.y,F.Debug("S.PolyLine: ClosePolygon output",!0),!0;if(e[0].id===me.HookPts.KTR&&i.segment===me.HookPts.KTL)return i.objectid=t,i.pt.x=this.polylist.segs[0].pt.x+this.StartPoint.x,i.pt.y=this.polylist.segs[0].pt.y+this.StartPoint.y,F.Debug("S.PolyLine: ClosePolygon output",!0),!0}return F.Debug("S.PolyLine: ClosePolygon output",!1),!1}PolyGetTargetPointList(t){F.Debug("S.PolyLine: PolyGetTargetPointList input",{hookFlags:t});let e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!0,null),i=[],o=0;if(this.polylist&&this.polylist.closed&&this.StyleRecord.Line.BThick&&!(t&Se.HookFlags.LcShapeOnLine)){let t=ye.opt.InflateLine(e,this.StyleRecord.Line.BThick,!0,!0),o=ye.opt.InflateLine(e,this.StyleRecord.Line.BThick,!0,!1);i=t.concat(o),e=e.concat(i)}else 0!==this.RotationAngle&&(o=-this.RotationAngle/(180/Se.Geometry.PI),si.RotatePointsAboutCenter(this.Frame,o,e));return F.Debug("S.PolyLine: PolyGetTargetPointList output",e),e}GetTargetPoints(t,e,i){F.Debug("S.PolyLine: GetTargetPoints input",{hookPoint:t,hookFlags:e,targetObjectID:i});const o=me.HookPts;if(null!=i&&i>=0&&ws.GetObjectPtr(i,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)switch(t.id){case o.KTC:case o.KBC:case o.KRC:case o.KLC:return F.Debug("S.PolyLine: GetTargetPoints output",null),null}const n=this.BaseShapePolyGetTargets(t,e,this.Frame);return F.Debug("S.PolyLine: GetTargetPoints output",n),n}BaseShapePolyGetTargets(t,e,i){F.Debug("S.PolyLine: BaseShapePolyGetTargets input",{hookPoint:t,hookFlags:e,targetFrame:i});let o=-1,n=me.Common.LongIntMax,s={x:0,y:0};const a=this.PolyGetTargetPointList(e);if(!t)return null;let r={x:t.x,y:t.y};const l=ye.docUtil.docConfig.enableSnap&&!(e&Se.HookFlags.LcNoSnaps);l&&(r=ye.docUtil.SnapToGrid(r),r.y=Math.max(i.y,Math.min(r.y,i.y+i.height)),r.x=Math.max(i.x,Math.min(r.x,i.x+i.width)));for(let h=1;h<a.length;h++){const e=a[h-1],i=a[h];if(ve.EqualPt(e,i))continue;let c,p={x:t.x,y:t.y};if(Math.abs((i.y-e.y)/(i.x-e.x))>1){l&&(p.y=r.y);const t=(i.x-e.x)/(i.y-e.y)*(p.y-e.y)+e.x;if(c=Math.abs(t-p.x),p.x=t,t<Math.min(e.x,i.x)||t>Math.max(e.x,i.x))c=me.Common.LongIntMax;else{const t=ve.Pt2Rect(e,i);ve.InflateRect(t,1,1),ve.pointInRect(t,p)||(c=me.Common.LongIntMax)}}else{l&&(p.x=r.x);const t=(i.y-e.y)/(i.x-e.x)*(p.x-e.x)+e.y;if(c=Math.abs(t-p.y),p.y=t,t<Math.min(e.y,i.y)||t>Math.max(e.y,i.y))c=me.Common.LongIntMax;else{const t=ve.Pt2Rect(e,i);ve.InflateRect(t,1,1),ve.pointInRect(t,p)||(c=me.Common.LongIntMax)}}c<n&&(o=h,n=c,s={x:p.x,y:p.y})}if(o>=0){const t=[{x:s.x,y:s.y}];if(0!==this.RotationAngle){const e=this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(i,e,t)}const e=i.width,o=i.height,n=0===e?0:(t[0].x-i.x)/e,a=0===o?0:(t[0].y-i.y)/o,r=[new De(n*me.Common.DimMax,a*me.Common.DimMax)];return F.Debug("S.PolyLine: BaseShapePolyGetTargets output",r),r}return F.Debug("S.PolyLine: BaseShapePolyGetTargets output",null),null}GetPerimeterPoints(t,e,i,o,n,s){F.Debug("S.PolyLine: GetPerimeterPoints input",{event:t,hookPoints:e,hookPointID:i,rotationAngle:o,scaleFactor:n,targetObjectID:s});let a=[],r=this.Frame;if(e&&2===e.length&&e[0].id===me.HookPts.KTL&&e[1].id===me.HookPts.KTR)return a.push(new De(this.StartPoint.x,this.StartPoint.y)),a[0].id=e[0].id,a.push(new De(this.EndPoint.x,this.EndPoint.y)),a[1].id=e[1].id,F.Debug("S.PolyLine: GetPerimeterPoints output",a),a;let l=ws.GetObjectPtr(s,!1);if(l&&l.objecttype===Se.FNObjectTypes.Multiplicity&&e){let r,l=this.GetPolyPoints(1,!1,!0,!1,null),h={},c=l.length;return 0===e[0].x?(h.StartPoint=l[0],h.EndPoint=l[1],h.LineType=me.LineType.LINE,r=new es(h),r.StartPoint=h.StartPoint,r.EndPoint=h.EndPoint,r.Frame=ve.Pt2Rect(h.StartPoint,h.EndPoint),a=super.GetPerimeterPoints(t,e,i,o,n,s)):(h.StartPoint=l[c-2],h.EndPoint=l[c-1],h.LineType=me.LineType.LINE,r=new es(h),r.StartPoint=h.StartPoint,r.EndPoint=h.EndPoint,r.Frame=ve.Pt2Rect(h.StartPoint,h.EndPoint),a=super.GetPerimeterPoints(t,e,i,o,n,s)),F.Debug("S.PolyLine: GetPerimeterPoints output",a),a}if(l&&l.objecttype===Se.FNObjectTypes.ExtraTextLable&&1===e.length)return a=super.GetPerimeterPoints(t,e,i,o,n,s),F.Debug("S.PolyLine: GetPerimeterPoints output",a),a;if(i>=me.HookPts.KCTL&&i<=me.HookPts.KCC){if(0===e[0].x)return a[0]={x:this.StartPoint.x,y:this.StartPoint.y,id:e[0].id||0},F.Debug("S.PolyLine: GetPerimeterPoints output",a),a;if(e[0].x===me.Common.DimMax)return a[0]={x:this.EndPoint.x,y:this.EndPoint.y,id:e[0].id||0},F.Debug("S.PolyLine: GetPerimeterPoints output",a),a}for(let h=0;h<e.length;h++){a[h]={x:0,y:0,id:0};let t=r.width,i=r.height;a[h].x=e[h].x/me.Common.DimMax*t+r.x,a[h].y=e[h].y/me.Common.DimMax*i+r.y,null!=e[h].id&&(a[h].id=e[h].id)}return F.Debug("S.PolyLine: GetPerimeterPoints output",a),a}HookToPoint(t,e){let i;F.Debug("S.PolyLine: HookToPoint input",{hookPoint:t,rect:e});const o={x:0,y:0},n={x:0,y:0};if(t===me.HookPts.KTL){if(o.x=this.StartPoint.x,o.y=this.StartPoint.y,n.x=this.StartPoint.x+this.polylist.segs[1].pt.x,n.y=this.StartPoint.y+this.polylist.segs[1].pt.y,e){const t=ve.Pt2Rect(this.StartPoint,n);e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}}else if(o.x=this.EndPoint.x,o.y=this.EndPoint.y,i=this.polylist.segs.length,n.x=this.StartPoint.x+this.polylist.segs[i-2].pt.x,n.y=this.StartPoint.y+this.polylist.segs[i-2].pt.y,e){const t=ve.Pt2Rect(this.EndPoint,n);e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}return F.Debug("S.PolyLine: HookToPoint output",o),o}GetSegmentLineFace(t,e,i){F.Debug("S.PolyLine: GetSegmentLineFace input",{event:t,targetPoint:e,anchorPoint:i});let o=0;const n={x:i.x,y:i.y},s=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),a={};if(si.LineDStyleHit(s,n,this.StyleRecord.Line.Thickness,0,a)&&a.lpHit>=0){const t=ve.Pt2Rect(s[a.lpHit],s[a.lpHit+1]);o=t.width>=t.height?e.y>=i.y?me.HookPts.KBC:me.HookPts.KTC:e.x>=i.x?me.HookPts.KRC:me.HookPts.KLC}return F.Debug("S.PolyLine: GetSegmentLineFace output",o),o}PolyHitSeg(t){F.Debug("S.PolyLine: PolyHitSeg input",{point:t});let e=[],i=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,e),o={},n={x:t.x,y:t.y};if(si.LineDStyleHit(i,n,this.StyleRecord.Line.Thickness,0,o)&&o.lpHit>=0){let t=e.length;for(let n=0;n<t;n++)if(o.lpHit<e[n]){o.lpHit=n;break}const i=o.lpHit+1;return F.Debug("S.PolyLine: PolyHitSeg output",i),i}return F.Debug("S.PolyLine: PolyHitSeg output",-1),-1}MaintainPoint(t,e,i,o,n){F.Debug("S.PolyLine: MaintainPoint input",{point:t,targetID:e,targetObject:i,drawingObject:o,actionType:n});let s,a,r,l={},h={},c=[],p={};if(o.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line)switch(o.LineType){case me.LineType.SEGLINE:case me.LineType.ARCSEGLINE:case me.LineType.POLYLINE:for(s=-1,a=0;a<o.hooks.length;a++)if(o.hooks[a].objid===e){o.HookToPoint(o.hooks[a].hookpt,l),s=0;break}if(0!==s)return!0;h=Oe.DeepCopy(o),ve.CopyRect(h.Frame,l),h.StartPoint.x=l.x,h.StartPoint.y=l.y,h.EndPoint.x=l.x+l.width,h.EndPoint.y=l.y+l.height,o=h}let d=i.PolyHitSeg(t);if(i.polylist.segs.length!==this.polylist.segs.length||n===me.ActionTriggerType.Flip?(s=this.PolyHitSeg(t),s<0&&(s=i.PolyHitSeg(t)),s>=this.polylist.segs.length&&(s=this.polylist.segs.length-1)):s=d,r=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),this.polylist&&this.polylist.closed&&this.StyleRecord.Line.BThick&&o instanceof es){let e={},o=i.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),n=si.LineDStyleHit(o,{x:t.x,y:t.y},2,-12,e);if(!n||e.lpHit<0){let s=ye.opt.InflateLine(o,i.StyleRecord.Line.BThick,!0,!1);if(n=si.LineDStyleHit(s,{x:t.x,y:t.y},2,-12,e),n&&e.lpHit>=0)r=ye.opt.InflateLine(r,this.StyleRecord.Line.BThick,!0,!1);else{let s=ye.opt.InflateLine(o,i.StyleRecord.Line.BThick,!0,!0);n=si.LineDStyleHit(s,{x:t.x,y:t.y},2,-12,e),n&&e.lpHit>=0&&(r=ye.opt.InflateLine(r,this.StyleRecord.Line.BThick,!0,!0))}}}if(s>=0&&d>=0){if(l=ve.Pt2Rect(r[s],r[s-1]),h=Oe.DeepCopy(this),ve.CopyRect(h.Frame,l),h.StartPoint.x=r[s-1].x,h.StartPoint.y=r[s-1].y,h.EndPoint.x=r[s].x,h.EndPoint.y=r[s].y,c=i.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),p=Oe.DeepCopy(i),l=ve.Pt2Rect(c[d],c[d-1]),ve.CopyRect(p.Frame,l),p.StartPoint.x=c[d-1].x,p.StartPoint.y=c[d-1].y,p.EndPoint.x=c[d].x,p.EndPoint.y=c[d].y,o.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)return ye.opt.LineCheckPoint(h,t)||en.LinesMaintainDist(h,p,n,t),!0;switch(n){case me.ActionTriggerType.PolyNode:n=ye.opt.actionTriggerData!==s-1&&ye.opt.actionTriggerData!==s||h.StartPoint.x!==r[ye.opt.actionTriggerData].x||h.StartPoint.y!==r[ye.opt.actionTriggerData].y?me.ActionTriggerType.LineEnd:me.ActionTriggerType.LineStart;break;case me.ActionTriggerType.Rotate:return en.LinesMaintainDist(h,p,n,t),!0;default:n=me.ActionTriggerType.LineEnd}return!!ye.opt.LineCheckPoint(h,t)||(i.polylist.segs.length===this.polylist.segs.length?(ye.opt.LinesMaintainDistWithinSegment(this,i,s,t),!0):(ye.opt.LinesIntersect(h,o,t)||en.LinesMaintainDist(h,p,n,t),!0))}return F.Debug("S.PolyLine: MaintainPoint output",!0),!0}ChangeTarget(t,e,i,o,n,s){F.Debug("S.PolyLine: ChangeTarget input",{objectHookID:t,objectTargetID:e,paramA:i,paramR:o,paramI:n,paramN:s});let a=0,r=null;const l={};let h=null,c=0;if(r=ws.GetObjectPtr(e,!1),this.TextFlags&Se.TextFlags.HorizText&&r instanceof Zn){for(c=0;c<r.hooks.length;c++)if(r.hooks[c].objid===t){h=r.HookToPoint(r.hooks[c].hookpt,l);break}if(null!=h&&this.PolyHitSeg(h)>=0){a=this.GetApparentAngle(h),a=Math.abs(a)%180;const t=Math.abs(r.RotationAngle%180);Math.abs(t-a)>2&&Math.abs(t-(a-180))>2&&(r.RotationAngle=a,Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move|Ee.LinkFlags.Change),ws.AddToDirtyList(e))}}ws.AddToDirtyList(this.BlockID),F.Debug("S.PolyLine: ChangeTarget output",{angle:a,hookedPoint:h,loopIndex:c})}LMDrawPreTrack(t){return F.Debug("S.PolyLine: LMDrawPreTrack input",{event:t}),ye.opt.linkParams&&(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.JoinIndex>=0)?(this.LMDrawRelease(),F.Debug("S.PolyLine: LMDrawPreTrack output",!1),!1):(super.LMDrawPreTrack(t),F.Debug("S.PolyLine: LMDrawPreTrack output",!0),!0)}LMDrawClickExceptionCleanup(t){F.Debug("S.PolyLine: LMDrawClickExceptionCleanup input",{event:t}),rn.UnbindActionClickHammerEvents(),Rt(window).unbind("mousemove"),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),this.ResetAutoScrollTimer(),ye.opt.linkParams=null,ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart),F.Debug("S.PolyLine: LMDrawClickExceptionCleanup output",{})}LMDrawClick(t,e){F.Debug("S.PolyLine: LMDrawClick input",{initialX:t,initialY:e});try{this.Frame.x=t,this.Frame.y=e,this.Frame.width=0,this.Frame.height=0,this.StartPoint={x:t,y:e},this.EndPoint={x:t,y:e};const i=this;ye.opt.WorkAreaHammer.off("dragstart"),ye.opt.WorkAreaHammer.on("doubletap",Ls.Evt_DrawReleaseHandlerFactory(this)),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_PolyLineDrawExtendHandlerFactory(this)),ye.opt.WorkAreaHammer.on("drag",Ls.Evt_DrawTrackHandlerFactory(this)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_PolyLineDrawExtendHandlerFactory(this)),Rt(window).bind("mousemove",(function(t){try{i.LMDrawTrack(t)}catch(e){throw i.LMDrawClickExceptionCleanup(e),ye.opt.ExceptionCleanup(e),e}})),F.Debug("S.PolyLine: LMDrawClick output",{message:"Click handled successfully"})}catch(i){throw this.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),i}}LMDrawRelease(t){F.Debug("S.PolyLine: LMDrawRelease input",{event:t}),t&&t.gesture&&t.gesture.stopDetect(),rn.UnbindActionClickHammerEvents(),Rt(window).unbind("mousemove"),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick);const e=this.polylist.segs.length,i=this.polylist.segs[e-2].pt.x-this.polylist.segs[e-1].pt.x,o=this.polylist.segs[e-2].pt.y-this.polylist.segs[e-1].pt.y,n=Math.sqrt(i*i+o*o);e>2&&n<5&&this.polylist.segs.pop(),this.ResetAutoScrollTimer(),this.LMDrawPostRelease(ye.opt.actionStoredObjectId),xs.PostObjectDraw(),F.Debug("S.PolyLine: LMDrawRelease output",{segmentCount:e,segmentDistance:n})}LMDrawExtend(t){if(F.Debug("S.PolyLine: LMDrawExtend input",t),ye.opt.linkParams&&(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.JoinIndex>=0))this.LMDrawRelease(t);else{let e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),i=this.polylist.segs.length,o={x:this.polylist.segs[i-2].pt.x+this.StartPoint.x,y:this.polylist.segs[i-2].pt.y+this.StartPoint.y},n=e.x-o.x,s=e.y-o.y;if(Math.sqrt(n*n+s*s)>=10){let i=e.x-this.StartPoint.x,o=e.y-this.StartPoint.y;this.polylist.segs.push(new Pi(me.LineType.LINE,i,o)),this.polylist.segs.length>=me.Common.MaxPolySegs&&this.LMDrawRelease(t)}}F.Debug("S.PolyLine: LMDrawExtend output",{polySegments:this.polylist.segs})}RightClick(t){let e,i;const o=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),n=new Wo(-1,0,null),s=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);if(!Qo.SelectObjectFromClick(t,s))return!1;const a=s.GetID();if((e=ws.GetObjectPtr(a,!1))&&e.GetTextObject()>=0){const e=s.textElem;e&&(i=e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY),i>=0&&on.ActivateTextEdit(s,t,!0))}ye.opt.rClickParam=new Le,ye.opt.rClickParam.targetId=s.GetID(),ye.opt.rClickParam.hitPoint.x=o.x,ye.opt.rClickParam.hitPoint.y=o.y,ye.opt.rClickParam.locked=(this.flags&Se.ObjFlags.Lock)>0,this.Hit(o,!1,!1,n),n.hitcode&&(ye.opt.rClickParam.segment=n.segment);if(null!=on.GetActiveTextEdit()){const e=ye.opt.svgDoc.GetActiveEdit();i=-1,e&&(i=e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY))}else this.objecttype,Se.FNObjectTypes.FlWall}PrGetNURBSPoints(t,e,i,o,n,s){function a(){let t=(g[d-1]-g[0])/e,i=0,o=g[0];for(let n=0;n<e;n++){for(;o>=g[i];)i++;let e=i-1+l*n;b[e]=1;for(let t=2;t<=c;t++){let n=i-t+1;n<0&&(n=0);for(let s=n;s<=i-1;s++){let i=g[s+t-1]-g[s],n=g[s+t]-g[s+1];0===i&&(i=1e-11),0===n&&(n=1e-11),s+e+1<b.length&&(b[s+e]=b[s+e]*(o-g[s])/i+b[s+1+e]*(g[s+t]-o)/n)}}let s=0;for(let t=0;t<u;t++)s+=p[t]*b[t+e];for(let t=0;t<u;t++)b[t+e]=p[t]*b[t+e]/s;o+=t}return b}F.Debug("S.PolyLine: PrGetNURBSPoints input",{startSegmentIndex:t,numPoints:e,xOffset:i,yOffset:o,scaleX:n,scaleY:s});let r=t,l=0,h=!1;for(r=t;r<this.polylist.segs.length&&(this.polylist.segs[r].LineType===me.LineType.NURBS||this.polylist.segs[r].LineType===me.LineType.NURBSSEG);r++){if(this.polylist.segs[r].LineType===me.LineType.NURBS){if(h)break;h=!0}this.polylist.segs[r].LineType===me.LineType.NURBSSEG&&l++}let c=this.polylist.segs[t].ShortRef+1,p=[];for(let T=0;T<l;T++)p.push(this.polylist.segs[T+t+1].weight);let d,u=l,g=[];if(-1===this.polylist.segs[t].param){let t=0;for(let i=0;i<c;i++)g.push(t),t++;t++;for(let i=c;i<l+1;i++)g.push(t),t++;let e=g[g.length-1]-g[0];for(let i=1;i<c;i++)g.push(e);d=g.length}else{for(let o=0;o<l-1;o++)g.push(this.polylist.segs[o+t+1].param);g.push(this.polylist.segs[t].param);let e=this.polylist.segs[l+t+1].param;g.push(e);let i=e-g[0];for(let t=0;t<c-1;t++)g.push(g[t+1]+i);d=l+c}let y=[],S=[];for(let T=0;T<l;T++)y.push(this.polylist.segs[T+t+1].pt.x),S.push(this.polylist.segs[T+t+1].pt.y);const m=u*e;let b=new Float64Array(m),D=new Float64Array(y),f=new Float64Array(S);p=new Float64Array(p),g=new Float64Array(g);let x=g[0],C=g[d-1]-x;for(let T=0;T<d;T++)g[T]=(g[T]-x)/C;for(let T=0;T<g.length;T++)g[T]=Math.floor(1e4*g[T])/1e4,T>0?g[T]<g[T-1]&&(g[T]=g[T-1]):g[0]>g[1]&&(g[0]=0);this.polylist.closed?a():null==this.polylist.segs[t].UserData||this.polylist.segs[t].UserData.nPoints!==e||0===this.polylist.segs[t].UserData.basis.length?(a(),this.polylist.segs[t].UserData={nPoints:e,basis:b}):b=this.polylist.segs[t].UserData.basis;let P=[];{let t=(g[d-1]-g[0])/e,a=(Math.floor((g[c-1]-g[0])/t)+1)*u,r=0,l=0;for(let e=0;e<u;e++){let t=p[e]*b[e+a];r+=D[e]*t,l+=f[e]*t}P.push(new De(r*n+i,l*s+o));for(let e=c-1;e<u;e++)if(Math.floor((g[e+1]-g[0])/t),a+=u,a+u-1<m){r=0,l=0;for(let t=0;t<u;t++){let e=b[t+a];r+=D[t]*e,l+=f[t]*e}P.push(new De(r*n+i,l*s+o))}}return F.Debug("S.PolyLine: PrGetNURBSPoints output",P),P}PrGetSPLINEPoints(t,e,i,o,n,s){function a(){let t,i,o,n,s=(g[d-1]-g[0])/e;i=0,o=g[0];for(let a=0;a<e;a++){for(;o>=g[i];)i++;let e=i-1+S*a;b[e]=1;for(let n=2;n<=c;n++){let s=i-n+1;for(s<0&&(s=0),t=s;t<=i-1;t++){let i=g[t+n-1]-g[t],s=g[t+n]-g[t+1];0===i&&(i=1e-11),0===s&&(s=1e-11),t+e+1<m&&(b[t+e]=b[t+e]*(o-g[t])/i+b[t+1+e]*(g[t+n]-o)/s)}}n=0;for(let t=0;t<p;t++)n+=u[t]*b[t+e];for(let t=0;t<p;t++)b[t+e]=u[t]*b[t+e]/n;o+=s}}let r;F.Debug("S.PolyLine: PrGetSPLINEPoints input",{startSegmentIndex:t,numPoints:e,xOffset:i,yOffset:o,scaleX:n,scaleY:s});let l=[],h=[],c=this.polylist.segs[t].ShortRef+1,p=1;for(r=t+1;r<this.polylist.segs.length&&this.polylist.segs[r].LineType===me.LineType.SPLINECON;r++)p++;let d,u=[];for(r=0;r<p;r++)u.push(1);let g=[];g.push(this.polylist.segs[t].param),g.push(this.polylist.segs[t].weight);const y=this.polylist.segs[t].dataclass;for(r=2;r<p;r++)g.push(this.polylist.segs[r+t].weight);for(g.push(y),r=0;r<c-1;r++)g.push(y);d=g.length;const S=p;for(l.push(this.polylist.segs[t].pt.x),h.push(this.polylist.segs[t].pt.y),r=1;r<p;r++)l.push(this.polylist.segs[r+t].pt.x),h.push(this.polylist.segs[r+t].pt.y);const m=p*e;let b=new Float64Array(m);const D=new Float64Array(l),f=new Float64Array(h);u=new Float64Array(u);let x=(g=g.map((t=>t)))[0],C=g[d-1]-x;for(r=0;r<d;r++)g[r]=(g[r]-x)/C;for(r=0;r<g.length;r++)g[r]=Math.floor(1e4*g[r])/1e4,r>0&&g[r]<g[r-1]?g[r]=g[r-1]:0===r&&g[0]>g[1]&&(g[0]=0);this.polylist.closed?a():null==this.polylist.segs[t].UserData||this.polylist.segs[t].UserData.nPoints!==e||0===this.polylist.segs[t].UserData.basis.length?(a(),this.polylist.segs[t].UserData={nPoints:e,basis:b}):b=this.polylist.segs[t].UserData.basis;let P=[];{g[d-1],g[0];let t=0,a=0,l=(Math.floor((g[c-1]-g[0])/e)+1)*S;for(r=0;r<p;r++){let e=u[r]*b[r+l];t+=D[r]*e,a+=f[r]*e}P.push(new De(t*n+i,a*s+o))}return F.Debug("S.PolyLine: PrGetSPLINEPoints output",P),P}PrGetQuadraticBezierPoints(t,e,i,o,n,s){F.Debug("S.PolyLine: PrGetQuadraticBezierPoints input",{startIndex:t,pointCount:e,xOffset:i,yOffset:o,scaleX:n,scaleY:s});const a=this.polylist.segs[t].pt.x,r=this.polylist.segs[t].pt.y,l=this.polylist.segs[t+1].pt.x,h=this.polylist.segs[t+1].pt.y,c=this.polylist.segs[t+2].pt.x,p=this.polylist.segs[t+2].pt.y,d=[],u=1/(e-1);let g=0;for(let y=0;y<e;y++){const t=1-g,e=t*t*a+2*t*g*l+g*g*c,y=t*t*r+2*t*g*h+g*g*p;d.push(new De(e*n+i,y*s+o)),g+=u}return F.Debug("S.PolyLine: PrGetQuadraticBezierPoints output",d),d}PrGetCubicBezierPoints(t,e,i,o,n,s){F.Debug("S.PolyLine: PrGetCubicBezierPoints input",{startSegmentIndex:t,pointCount:e,xOffset:i,yOffset:o,scaleX:n,scaleY:s});const a=this.polylist.segs[t].pt.x,r=this.polylist.segs[t].pt.y,l=this.polylist.segs[t+1].pt.x,h=this.polylist.segs[t+1].pt.y,c=this.polylist.segs[t+2].pt.x,p=this.polylist.segs[t+2].pt.y,d=this.polylist.segs[t+3].pt.x,u=this.polylist.segs[t+3].pt.y,g=1/(e-1);let y=0;const S=[];for(let m=0;m<e;m++){const t=1-y,e=t*t,m=e*t,b=y*y,D=b*y,f=new De((m*a+3*e*y*l+3*t*b*c+D*d)*n+i,(m*r+3*e*y*h+3*t*b*p+D*u)*s+o);S.push(f),y+=g}return F.Debug("S.PolyLine: PrGetCubicBezierPoints output",S),S}PrGetEllipticalArcPoints(t,e,i,o,n,s){F.Debug("S.PolyLine: PrGetEllipticalArcPoints input",{segmentIndex:t,pointCount:e,xOffset:i,yOffset:o,scaleX:n,scaleY:s});const a=[];let r=Math.floor(this.polylist.segs[t].pt.x),l=Math.floor(this.polylist.segs[t].pt.y),h=Math.floor(this.polylist.segs[t+1].pt.x),c=Math.floor(this.polylist.segs[t+1].pt.y),p=Math.floor(this.polylist.segs[t+2].pt.x),d=Math.floor(this.polylist.segs[t+2].pt.y);if(h===r&&c===l||h===p&&c===d)return a.push(new De(r*n+i,l*s+o)),a.push(new De(p*n+i,d*s+o)),F.Debug("S.PolyLine: PrGetEllipticalArcPoints output",a),a;const u=this.polylist.segs[t].weight/10,g=this.polylist.segs[t].param,y=((t,e,i,o,n,s)=>{if(t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),o=Math.floor(o),n=Math.floor(n),s=Math.floor(s),t===i)return n<t?o>e?1:-1:n>t?o>e?-1:1:0;if(e===o)return s<e?i>t?-1:1:s>e?i>t?1:-1:0;const a=(o-e)/(i-t),r=a*n+(e-a*t);return Math.abs(s-r)>.001&&0!==a?s>r?i>t?1:-1:i>t?-1:1:0})(r,l,p,d,h,c);if(0===y)return a.push(new De(h*n+i,c*s+o)),a.push(new De(p*n+i,d*s+o)),F.Debug("S.PolyLine: PrGetEllipticalArcPoints output",a),a;const S=((t,e,i,o,n,s,a,r)=>{const l={},h=2*Math.PI*(a/360),c=Math.sqrt(t*t+e*e),p=Math.atan2(e,t),d=c*Math.cos(p-h),u=c*Math.sin(p-h),g=Math.sqrt(i*i+o*o),y=Math.atan2(o,i),S=g*Math.cos(y-h),m=g*Math.sin(y-h),b=Math.sqrt(n*n+s*s),D=Math.atan2(s,n),f=b*Math.cos(D-h),x=b*Math.sin(D-h);let C=(d-S)*(d+S)*(m-x)-(S-f)*(S+f)*(u-m)+r*r*(u-m)*(m-x)*(u-x),P=(d-S)*(S-f)/(r*r)+(S-f)*(u-m)*(u+m)-(d-S)*(m-x)*(m+x);const T=d,O=u;C/=2*((d-S)*(m-x)-(S-f)*(u-m)),P/=2*((S-f)*(u-m)-(d-S)*(m-x));const v=Math.sqrt(C*C+P*P);C=v*Math.cos(Math.atan2(P,C)+h),P=v*Math.sin(Math.atan2(P,C)+h);const w=Math.sqrt((T-C)*(T-C)+(O-P)*(O-P)*(r*r)),k=w/r;return l.centerX=C,l.centerY=P,l.majorAxis=w,l.minorAxis=k,l.angle=h,l.eccentricity=r,l})(r,l,p,d,h,c,u,g),m=S.centerX,b=S.centerY,D=S.majorAxis,f=S.minorAxis;let x,C;const P=-2*Math.PI*(u/360),T=2*Math.PI;if(0===P)x=Math.atan2(b-l,(r-m)/g),C=Math.atan2(b-d,(p-m)/g);else{const t=[{x:r,y:l},{x:h,y:c},{x:p,y:d}];!function(t,e,i){for(let o=0;o<i.length;o++){const n=i[o].x-t.x,s=i[o].y-t.y,a=Math.cos(e),r=Math.sin(e);i[o].x=n*a-s*r+t.x,i[o].y=n*r+s*a+t.y}}({x:m,y:b},-P,t),x=Math.atan2(b-t[0].y,(t[0].x-m)/g),C=Math.atan2(b-t[2].y,(t[2].x-m)/g)}C<x&&(C+=T);const O=((t,e,a,r,l,h,c,p,d)=>{const u=[];let g;g=p?(c-h)/(d-1):-(T-(c-h))/(d-1);let y=h;for(let S=0;S<d;S++){const h=a+t*Math.cos(y)*Math.cos(l)-e*Math.sin(y)*Math.sin(l),c=r+t*Math.cos(y)*Math.sin(-l)-e*Math.sin(y)*Math.cos(l);u.push(new De(h*n+i,c*s+o)),y+=g}return u})(D,f,m,b,P,x,C,1===y,e);return F.Debug("S.PolyLine: PrGetEllipticalArcPoints output",O),O}PrGetParabolaPoints(t,e,i,o,n,s,a){F.Debug("S.PolyLine: PrGetParabolaPoints input",{numPoints:t,isClosed:e,segmentIndex:i,param:o,shortRef:n,scaleX:s,scaleY:a});let r,l,h,c={},p=!1,d=[],u=[],g=this.StartPoint.x-this.Frame.x,y=this.StartPoint.y-this.Frame.y;if(e||(g=this.StartPoint.x,y=this.StartPoint.y),Math.abs(o)<1)return u.push(new De(this.polylist.segs[i-1].pt.x*s+g,this.polylist.segs[i-1].pt.y*a+y)),u.push(new De(this.polylist.segs[i].pt.x*s+g,this.polylist.segs[i].pt.y*a+y)),F.Debug("S.PolyLine: PrGetParabolaPoints output",u),u;if(d.push(new De(this.polylist.segs[i-1].pt.x*s+g,this.polylist.segs[i-1].pt.y*a+y)),d.push(new De(this.polylist.segs[i].pt.x*s+g,this.polylist.segs[i].pt.y*a+y)),r=d[1].x-d[0].x,l=d[1].y-d[0].y,h=Math.sqrt(r*r+l*l),h<1)return F.Debug("S.PolyLine: PrGetParabolaPoints output",u),u;if(Math.round(6*Math.abs(l))>=1){p=!0;const t=l/h,e=r/h;let i=Math.asin(t);e<0&&(i=-i,o=-o,n=-n),c.x=(d[0].x+d[1].x)/2,c.y=(d[0].y+d[1].y)/2,si.RotatePointsAboutPoint(c,i,d)}d.push(new De((d[0].x+d[1].x)/2,d[0].y+o));const S=d[2].x,m=d[2].y;for(let x=0;x<3;x++)d[x].x-=S,d[x].y-=m;c.x=(d[0].x+d[1].x)/2,c.y=(d[0].y+d[1].y)/2;const b=d[0].y/(d[0].x*d[0].x),D=n/o,f=(d[1].x-d[0].x)/(t-1);for(let x=0;x<t;x++){let t=d[0].x+f*x;t+=D*(o+b*t*t);let e=b*t*t;if(p){const i={x:t,y:e};si.RotatePointsAboutPoint(c,-rotationAngle,[i]),t=i.x,e=i.y}u.push(new De(t+S+g,e+m+y))}return F.Debug("S.PolyLine: PrGetParabolaPoints output",u),u}PrPolyLGetParabolaAdjPoint(t,e){F.Debug("S.PolyLine: PrPolyLGetParabolaAdjPoint input",{event:t,segmentIndex:e});let i,o,n,s,a,r={},l=!1,h=[],c={};if(h.push(new De(this.polylist.segs[e-1].pt.x,this.polylist.segs[e-1].pt.y)),h.push(new De(this.polylist.segs[e].pt.x,this.polylist.segs[e].pt.y)),i=h[1].x-h[0].x,o=h[1].y-h[0].y,n=Math.sqrt(i*i+o*o),n<1)return F.Debug("S.PolyLine: PrPolyLGetParabolaAdjPoint output",c),c;if(s=this.polylist.segs[e].param,a=this.polylist.segs[e].ShortRef,Math.abs(o)>=1){l=!0;const t=o/n,e=i/n;let c=Math.asin(t);e<0&&(c=-c,s=-s,a=-a),r.x=(h[0].x+h[1].x)/2,r.y=(h[0].y+h[1].y)/2,si.RotatePointsAboutPoint(r,c,h)}return h.push(new De((h[0].x+h[1].x)/2+a,h[0].y+s)),l&&si.RotatePointsAboutPoint(r,-rotationAngle,h),c.x=h[2].x,c.y=h[2].y,t||(c.x+=this.StartPoint.x,c.y+=this.StartPoint.y),F.Debug("S.PolyLine: PrPolyLGetParabolaAdjPoint output",c),c}PrPolyLGetParabolaParam(t,e){F.Debug("S.PolyLine: PrPolyLGetParabolaParam input",{event:t,segmentIndex:e});let i,o,n,s,a={},r=1,l=[];if(l.push(new De(this.polylist.segs[e-1].pt.x,this.polylist.segs[e-1].pt.y)),l.push(new De(this.polylist.segs[e].pt.x,this.polylist.segs[e].pt.y)),i=l[1].x-l[0].x,o=l[1].y-l[0].y,n=Math.sqrt(i*i+o*o),n>=1){const h=t.x-this.StartPoint.x,c=t.y-this.StartPoint.y;l.push(new De(h,c)),Math.abs(o)>=1?(s=Math.asin(o/n),i<0&&(s=-s,r=-r),a.x=(l[0].x+l[1].x)/2,a.y=(l[0].y+l[1].y)/2,si.RotatePointsAboutPoint(a,s,l)):s=0;const p=(l[0].x+l[1].x)/2,d=l[0].y;this.polylist.segs[e].param=(l[2].y-d)*r,this.polylist.segs[e].ShortRef=(l[2].x-p)*r;let u=6*this.polylist.segs[e].ShortRef;u=Math.floor(u),this.polylist.segs[e].ShortRef=u/6}F.Debug("S.PolyLine: PrPolyLGetParabolaParam output",{param:this.polylist.segs[e].param,ShortRef:this.polylist.segs[e].ShortRef})}PrPolyLGetArc(t,e){F.Debug("S.PolyLine: PrPolyLGetArc input",{segmentIndex:t,offset:e});let i,o,n={},s={},a={},r={arcObject:null,point:{x:0,y:0}};n.x=this.polylist.segs[t-1].pt.x+e.x,n.y=this.polylist.segs[t-1].pt.y+e.y,s.x=this.polylist.segs[t].pt.x+e.x,s.y=this.polylist.segs[t].pt.y+e.y,i=this.polylist.segs[t].param>=0?{StartPoint:n,EndPoint:s,CurveAdjust:this.polylist.segs[t].param,IsReversed:!0,FromPolygon:!0}:{StartPoint:n,EndPoint:s,CurveAdjust:-this.polylist.segs[t].param,IsReversed:!1,FromPolygon:!0};const l=new we.Shape.ArcLine(i);return l.Frame=ve.Pt2Rect(n,s),o=l.CalcRadiusAndCenter(n.x,n.y,s.x,s.y,i.CurveAdjust,i.IsReversed),a.x=o.actionX,a.y=o.actionY,l.BeforeModifyShape(a.x,a.y,0),r.arcObject=l,r.point=a,F.Debug("S.PolyLine: PrPolyLGetArc output",r),r}PrPolyLGetArcParam(t,e,i){F.Debug("S.PolyLine: PrPolyLGetArcParam input",{shape:t,targetPoint:e,segmentIndex:i}),t&&(t.ModifyShape(null,e.x,e.y,-1,0),t.IsReversed?this.polylist.segs[i].param=t.CurveAdjust:this.polylist.segs[i].param=-t.CurveAdjust),F.Debug("S.PolyLine: PrPolyLGetArcParam output",this.polylist.segs[i].param)}PrGetEllipsePoints(t,e,i,o,n,s,a){F.Debug("S.PolyLine: PrGetEllipsePoints input",{numPoints:t,isClosed:e,segmentIndex:i,rotationAngle:o,arcQuadrant:n,scaleX:s,scaleY:a});let r,l,h,c,p,d,u={},g=[],y=[],S={},m=this.StartPoint.x-this.Frame.x,b=this.StartPoint.y-this.Frame.y;if(g.push(new De(this.polylist.segs[i-1].pt.x+m,this.polylist.segs[i-1].pt.y+b)),g.push(new De(this.polylist.segs[i].pt.x+m,this.polylist.segs[i].pt.y+b)),r=g[1].x-g[0].x,l=g[1].y-g[0].y,h=Math.sqrt(r*r+l*l),u.x=this.polylist.segs[i-1].pt.x,u.y=this.polylist.segs[i-1].pt.y,e||(m=this.StartPoint.x,b=this.StartPoint.y),h<1)return y.push(new De(this.polylist.segs[i-1].pt.x*s+m,this.polylist.segs[i-1].pt.y*a+b)),y.push(new De(this.polylist.segs[i].pt.x*s+m,this.polylist.segs[i].pt.y*a+b)),F.Debug("S.PolyLine: PrGetEllipsePoints output",y),y;Math.abs(o)>=.01&&(c=Math.sin(o),p=Math.cos(o),d=Math.asin(c),si.RotatePointsAboutPoint(u,d,g));let D,f,x=1;switch(n){case me.ArcQuad.PLA_TL:case me.ArcQuad.PLA_TR:D=g[1].x,f=g[0].y,x=-1;break;case me.ArcQuad.PLA_BR:default:D=g[1].x,f=g[0].y}for(let O=0;O<2;O++)g[O].x-=D,g[O].y-=f;let C=Math.abs(g[1].x-g[0].x),P=Math.abs(g[1].y-g[0].y);if(C*=C,C<1e-4)return y.push(new De(this.polylist.segs[i-1].pt.x*s+m,this.polylist.segs[i-1].pt.y*a+b)),y.push(new De(this.polylist.segs[i].pt.x*s+m,this.polylist.segs[i].pt.y*a+b)),F.Debug("S.PolyLine: PrGetEllipsePoints output",y),y;let T=(g[1].x-g[0].x)/(t-1);for(let O=0;O<t;O++){let t=g[0].x+T*O,e=x*Math.sqrt(1-t*t/C)*P;Math.abs(o)>=.01?(S.x=(t+D-u.x)*p-(e+f-u.y)*c+u.x,S.y=(t+D-u.x)*c+(e+f-u.y)*p+u.y):(S.x=t+D,S.y=e+f),y.push(new De(S.x*s+m,S.y*a+b))}return F.Debug("S.PolyLine: PrGetEllipsePoints output",y),y}PrPolyLGetEllipseAdjPoint(t,e){F.Debug("S.PolyLine: PrPolyLGetEllipseAdjPoint input",{event:t,segmentIndex:e});let i,o,n,s=[],a={},r={};s.push(new De(this.polylist.segs[e-1].pt.x,this.polylist.segs[e-1].pt.y)),s.push(new De(this.polylist.segs[e].pt.x,this.polylist.segs[e].pt.y)),a.x=this.polylist.segs[e-1].pt.x,a.y=this.polylist.segs[e-1].pt.y;const l=this.polylist.segs[e].param;return Math.abs(l)>=.01&&(i=Math.sin(l),o=Math.cos(l),n=Math.asin(i),o<0&&(n=-n),si.RotatePointsAboutPoint(a,n,s)),s.push(new De(s[1].x,s[0].y)),Math.abs(l)>=.01&&si.RotatePointsAboutPoint(a,-n,s),r.x=s[2].x,r.y=s[2].y,t||(r.x+=this.StartPoint.x,r.y+=this.StartPoint.y),F.Debug("S.PolyLine: PrPolyLGetEllipseAdjPoint output",r),r}PrPolyLGetEllipseParam(t,e,i){F.Debug("S.PolyLine: PrPolyLGetEllipseParam input",{event:t,segmentIndex:e,svgDocument:i});let o,n,s,a,r,l,h=[],c={},p={};if(h.push(new De(this.polylist.segs[e-1].pt.x,this.polylist.segs[e-1].pt.y)),h.push(new De(this.polylist.segs[e].pt.x,this.polylist.segs[e].pt.y)),o=h[1].x-h[0].x,n=h[1].y-h[0].y,Math.sqrt(o*o+n*n)>=1&&Math.abs(n)>1){const d=t.x-this.StartPoint.x,u=t.y-this.StartPoint.y;h.push(new De(d,u)),n=h[2].y-h[0].y,o=h[2].x-h[0].x,Math.abs(o)<.001?a=Se.Geometry.PI/2:(s=n/o,a=Math.atan(s)),this.polylist.segs[e].param=a,r=this.PrPolyLGetArcQuadrant(h[0],h[1],a),r.ShortRef!==this.polylist.segs[e].ShortRef&&(this.polylist.segs[e].ShortRef=r.ShortRef),l=this.PrPolyLGetEllipseAdjPoint(!0,e),h.pop(),h.splice(1,0,l),ve.GetPolyRect(c,h);const g=this.StartPoint.x-this.Frame.x,y=this.StartPoint.y-this.Frame.y,S=me.Common.EllipseAxes;if(p=i.GetElementById(S),p||(p=ye.opt.svgDoc.CreateShape(me.CSType.Polyline),p.SetFillColor("none"),p.SetStrokeColor("green"),p.SetStrokePattern("4,2"),p.SetID(S),i.AddElement(p)),p){p.SetSize(c.width,c.height);for(let t=0;t<h.length;t++)h[t].x+=g,h[t].y+=y;p.SetPoints(h)}}F.Debug("S.PolyLine: PrPolyLGetEllipseParam output",{polyPoints:h,boundingRect:c,ellipseAxesElement:p})}PrPolyLGetArcQuadrant(t,e,i){F.Debug("S.PolyLine: PrPolyLGetArcQuadrant input",{startPoint:t,endPoint:e,angle:i});let o,n,s,a=[],r={param:0,ShortRef:0},l={};a.push(new De(t.x,t.y)),a.push(new De(e.x,e.y)),l.x=t.x,l.y=t.y,Math.abs(i)>=.01&&(o=Math.sin(i),n=Math.cos(i),s=Math.asin(o),n<0&&(s=-s),si.RotatePointsAboutPoint(l,s,a));const h=a[0],c=a[1];return c.x>h.x?c.y>h.y?(r.param=-Se.Geometry.PI/2,r.ShortRef=me.ArcQuad.PLA_BL,e.notclockwise&&(r.param=0)):(r.ShortRef=me.ArcQuad.PLA_TL,e.notclockwise&&(r.ShortRef=me.ArcQuad.PLA_TR,r.param=Se.Geometry.PI/2)):c.y>h.y?(r.ShortRef=me.ArcQuad.SD_PLA_BR,e.notclockwise&&(r.ShortRef=me.ArcQuad.PLA_BL,r.param=Se.Geometry.PI/2)):(r.param=-Se.Geometry.PI/2,r.ShortRef=me.ArcQuad.PLA_TR,e.notclockwise&&(r.param=0)),F.Debug("S.PolyLine: PrPolyLGetArcQuadrant output",r),r}NeedsAddLineThicknessToDimension(t,e){F.Debug("S.PolyLine: NeedsAddLineThicknessToDimension input",{event:t,target:e});const i=!!this.polylist.closed;return F.Debug("S.PolyLine: NeedsAddLineThicknessToDimension output",i),i}GetExteriorDimensionMeasurementLineThicknessAdjustment(t){F.Debug("S.PolyLine: GetExteriorDimensionMeasurementLineThicknessAdjustment input",{segmentIndex:t});let e=this.ConvToUnits(this.StyleRecord.Line.Thickness,ye.docUtil.rulerConfig.originx);return e/=2,this.IsTerminalSegment(t)||(e*=2),F.Debug("S.PolyLine: GetExteriorDimensionMeasurementLineThicknessAdjustment output",e),e}CanUseStandOffDimensionLines(){F.Debug("S.PolyLine: CanUseStandOffDimensionLines input");const t=!(!this.polylist.closed&&(this.Dimensions&Se.DimensionFlags.Total||this.Dimensions&Se.DimensionFlags.EndPts));return F.Debug("S.PolyLine: CanUseStandOffDimensionLines output",t),t}GetDimensionTextForPoints(t,e){F.Debug("S.PolyLine: GetDimensionTextForPoints input",{startPoint:t,endPoint:e});let i=[],o=0,n=0,s=0,a=0,r=0;if(!this.polylist.closed&&this.Dimensions&Se.DimensionFlags.Total){i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);for(let t=1;t<i.length;t++)n=Math.abs(i[t-1].x-i[t].x),s=Math.abs(i[t-1].y-i[t].y),o+=Math.sqrt(n*n+s*s)}else a=360-Oe.CalcAngleFromPoints(t,e),r=2*Math.PI*(a/360),i.push(new De(t.x,t.y)),i.push(new De(e.x,e.y)),si.RotatePointsAboutCenter(this.Frame,-r,i),o=Math.abs(i[0].x-i[1].x);const l=Ve.GetLengthInRulerUnits(o);return F.Debug("S.PolyLine: GetDimensionTextForPoints output",l),l}UpdateSecondaryDimensions(t,e,i){F.Debug("S.PolyLine: UpdateSecondaryDimensions input",{event:t,target:e,additionalData:i});let o=[],n=0;const s=this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select;if((this.objecttype!==Se.FNObjectTypes.FlWall||this.Dimensions&Se.DimensionFlags.HideHookedObjDimensions||(s||i)&&this.UpdateHookedObjectDimensionLines(t,e,i))&&s&&this.Dimensions&Se.DimensionFlags.ShowLineAngles&&this.polylist){o=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),n=o.length;for(let i=1;i<n;i++)this.DrawDimensionAngle(t,e,i,o)}F.Debug("S.PolyLine: UpdateSecondaryDimensions output",{polyPoints:o,pointCount:n})}GetBoundingBoxesForSecondaryDimensions(){F.Debug("S.PolyLine: GetBoundingBoxesForSecondaryDimensions input");let t=super.GetBoundingBoxesForSecondaryDimensions();if(!(this.Dimensions&Se.DimensionFlags.ShowLineAngles))return F.Debug("S.PolyLine: GetBoundingBoxesForSecondaryDimensions output",t),t;const e=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),i=e.length;for(let o=1;o<i;o++){const i=this.GetDimensionAngleInfo(o,e);i&&(i.text=null,t.push(i.textRect))}return F.Debug("S.PolyLine: GetBoundingBoxesForSecondaryDimensions output",t),t}GetAreaWidthAndHeightText(t){F.Debug("S.PolyLine: GetAreaWidthAndHeightText input",{polyPoints:t});let e,i,o,n,s,a="";return this.polylist&&this.polylist.closed&&ye.opt.IsRectangularPolygon(t)&&(s=ye.opt.GetCounterClockwiseAngleBetween2Points(t[0],t[1]),s<Math.PI/4||s>1.5*Math.PI||s>.75*Math.PI&&s<1.25*Math.PI?(o=1,n=2):(o=2,n=1),e=ve.GetDistanceBetween2Points(t[o-1],t[o]),i=ve.GetDistanceBetween2Points(t[n-1],t[n]),a=Ve.GetLengthInRulerUnits(i)+" x "+Ve.GetLengthInRulerUnits(e)),F.Debug("S.PolyLine: GetAreaWidthAndHeightText output",a),a}SetSegmentAngle(t,e,i){F.Debug("S.PolyLine: SetSegmentAngle input",{event:t,segmentIndex:e,angle:i});let o,n,s=[],a=[],r=-1,l=0,h=0;if(e<=0||e>=this.polylist.segs.length)return void F.Debug("S.PolyLine: SetSegmentAngle output",!1);ws.GetObjectPtr(this.BlockID,!0);const c=Oe.DeepCopy(this);if(s.push(new De(this.polylist.segs[e-1].pt.x,this.polylist.segs[e-1].pt.y)),s.push(new De(this.polylist.segs[e].pt.x,this.polylist.segs[e].pt.y)),s[0].x+=this.StartPoint.x,s[1].x+=this.StartPoint.x,s[0].y+=this.StartPoint.y,s[1].y+=this.StartPoint.y,new De(s[1].x,s[1].y),o=ye.opt.GetCounterClockwiseAngleBetween2Points(s[0],s[1]),si.RotatePointsAboutPoint(s[0],-o,s),this.Dimensions&Se.DimensionFlags.InteriorAngles){if(a.push(new De(s[0].x,s[0].y)),1===e){if(!this.polylist.closed)return void F.Debug("S.PolyLine: SetSegmentAngle output",!1);a.push(new De(this.polylist.segs[this.polylist.segs.length-2].pt.x,this.polylist.segs[this.polylist.segs.length-2].pt.y))}else a.push(new De(this.polylist.segs[e-2].pt.x,this.polylist.segs[e-2].pt.y));a[1].x+=this.StartPoint.x,a[1].y+=this.StartPoint.y,n=ye.opt.GetCounterClockwiseAngleBetween2Points(a[0],a[1]),si.RotatePointsAboutPoint(s[0],n,s)}else n=0;let p=i/360*(2*Math.PI),d=o-n;d<0&&(d+=2*Math.PI),d>Math.PI&&(p=2*Math.PI-p),si.RotatePointsAboutPoint(s[0],p,s),e===this.polylist.segs.length-1?(r=this.polylist.closed?me.ActionTriggerType.PolyEnd:me.ActionTriggerType.LineEnd,this.AdjustLineEnd(t,s[1].x,s[1].y,r)):0===e?this.AdjustLineStart(t,s[1].x,s[1].y,me.ActionTriggerType.LineStart):this.ModifyShape(t,s[1].x,s[1].y,me.ActionTriggerType.PolyNode,e),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);for(let u=0;u<this.hooks.length;u++)Ps.SetLinkFlag(this.hooks[u].objid,Ee.LinkFlags.Move);if(ye.opt.ActionTriggerData=e,Yo.MaintainLink(this.BlockID,this,c,me.ActionTriggerType.PolyNode),this.Frame.x<0||this.Frame.y<0){const t=this.Frame;t.x<0&&(l=-t.x,t.x+=l),t.y<0&&(h=-t.y,(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&(h+=me.Common.DimDefaultStandoff),t.y+=h),this.StartPoint.x+=l,this.StartPoint.y+=h,this.EndPoint.x+=l,this.EndPoint.y+=h,ye.opt.SetObjectFrame(this.BlockID,t)}this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),F.Debug("S.PolyLine: SetSegmentAngle output",!0)}IsTextFrameOverlap(t,e){F.Debug("S.PolyLine: IsTextFrameOverlap input",{textFrame:t,rotationAngle:e});const i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),o=360-e,n=2*Math.PI*(o/360);si.RotatePointsAboutCenter(this.Frame,-n,i);const s=ve.IsFrameCornersInPoly(i,t);return F.Debug("S.PolyLine: IsTextFrameOverlap output",s),s}IsTerminalSegment(t){F.Debug("S.PolyLine: IsTerminalSegment input",{segmentIndex:t});const e=!this.polylist.closed&&(1===t||t===this.polylist.segs.length-1);return F.Debug("S.PolyLine: IsTerminalSegment output",e),e}UpdateDimensionFromTextObj(t,e){F.Debug("S.PolyLine: UpdateDimensionFromTextObj input",{event:t,textObject:e});let i="",o=null;ye.stdObj.PreserveBlock(this.BlockID),e?(i=e.text,o=e.userData):(i=t.GetText(),o=t.GetUserData());const n=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.UpdateDimensionFromText(n,i,o),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);for(let s=0;s<this.hooks.length;s++)Ps.SetLinkFlag(this.hooks[s].objid,Ee.LinkFlags.Move);(""!==this.HyperlinkText||-1!==this.NoteID||-1!==this.commentId||this.HasFieldData())&&ws.AddToDirtyList(this.BlockID),xs.CompleteOperation(),F.Debug("S.PolyLine: UpdateDimensionFromTextObj output",{text:i,userData:o})}UpdateEndPointDimensionFromText(t,e){F.Debug("S.PolyLine: UpdateEndPointDimensionFromText input",{event:t,dimensionLength:e});const i=[this.StartPoint,this.EndPoint];if(!this.closed){let t=Oe.CalcAngleFromPoints(this.StartPoint,this.EndPoint);t=360-t;const o=2*Math.PI*(t/360);si.RotatePointsAboutCenter(this.Frame,-o,i),i[1].x=i[0].x+e,si.RotatePointsAboutCenter(this.Frame,o,i),this.AdjustLineEnd(null,i[1].x,i[1].y,me.ActionTriggerType.LineEnd)}F.Debug("S.PolyLine: UpdateEndPointDimensionFromText output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint})}UpdateTotalDimensionFromText(t,e){F.Debug("S.PolyLine: UpdateTotalDimensionFromText input",{event:t,dimensionLength:e});let i=0,o=0,n=0,s=0;const a=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);for(let c=1;c<a.length;c++)o=Math.abs(a[c-1].x-a[c].x),n=Math.abs(a[c-1].y-a[c].y),s=Math.sqrt(o*o+n*n),i+=s;const r=e/i;let l=-(this.Frame.x*r-this.Frame.x);l-=(this.Frame.width*r-this.Frame.width)/2;let h=-(this.Frame.y*r-this.Frame.y);h-=(this.Frame.height*r-this.Frame.height)/2,this.ScaleObject(l,h,null,0,r,r,!1),F.Debug("S.PolyLine: UpdateTotalDimensionFromText output",{Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint})}UpdateSegmentDimensionFromText(t,e,i){let o,n,s,a,r,l,h,c,p,d;F.Debug("S.PolyLine: UpdateSegmentDimensionFromText input",{event:t,dimensionLength:e,segmentIndex:i});const u=new Wo(-1,0,null);if(ye.opt.ob=Oe.DeepCopy(this),o=Oe.CalcAngleFromPoints(this.polylist.segs[i-1].pt,this.polylist.segs[i].pt),this.polylist.segs[i-1].pt.x===this.polylist.segs[i].pt.x&&this.polylist.segs[i-1].pt.y===this.polylist.segs[i].pt.y){const t=1===i?2:i-1;o=Oe.CalcAngleFromPoints(this.polylist.segs[t-1].pt,this.polylist.segs[t].pt),o=o+90>=360?o-270:o+90}n=360-o;const g=2*Math.PI*(n/360);s=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),a=this.polylist.closed&&this instanceof we.Shape.PolyLineContainer?ye.opt.InflateLine(s,this.StyleRecord.Line.BThick,this.polylist.closed,this.Dimensions&Se.DimensionFlags.Exterior):Oe.DeepCopy(s),a.forEach((t=>{t.x+=this.Frame.x,t.y+=this.Frame.y}));let y=i,S=i-1;if(!this.polylist.closed&&1===i&&a.length>2&&(y=0,S=1),r=a[y].x,l=a[y].y,si.RotatePointsAboutCenter(this.Frame,-g,a),a[S].x=a[y].x<a[S].x?a[y].x+e:a[y].x-e,si.RotatePointsAboutCenter(this.Frame,g,a),h=a[y].x,c=a[y].y,i===this.polylist.segs.length-1){if(this.AdjustLineEnd(null,h,c,this.polylist.closed?me.ActionTriggerType.PolyEnd:me.ActionTriggerType.LineEnd),!this.polylist.closed){const t=[{id:me.HookPts.KTR,x:h,y:c}];this.ClosePolygon(this.BlockID,t,u)&&(this.polylist.segs[this.polylist.segs.length-1].pt=Oe.DeepCopy(this.polylist.segs[0].pt),this.polylist.closed=!0,this instanceof ns&&this.MaintainDimensionThroughPolygonOpennessChange(this.polylist.closed))}}else if(this.polylist.closed||1!==i)if(p=h-r,d=c-l,this.polylist.closed&&this.polylist.dim.x&&this.polylist.dim.y){const t=this.polylist.dim.x,e=this.polylist.dim.y<1?1:this.polylist.dim.y,o=this.Frame.width/t,n=this.Frame.height/e;this.polylist.segs[i].pt.x+=p*o,this.polylist.segs[i].pt.y+=d*n}else this.polylist.segs[i].pt.x+=p,this.polylist.segs[i].pt.y+=d;else{this.AdjustLineStart(null,h,c,me.ActionTriggerType.LineStart);const t=[{id:me.HookPts.KTL,x:h,y:c}];this.ClosePolygon(this.BlockID,t,u)&&(this.polylist.segs[0].pt=Oe.DeepCopy(this.polylist.segs[this.polylist.segs.length-1].pt),this.polylist.closed=!0,this instanceof ns&&this.MaintainDimensionThroughPolygonOpennessChange(this.polylist.closed))}F.Debug("S.PolyLine: UpdateSegmentDimensionFromText output",{polylist:this.polylist,Frame:this.Frame})}UpdateDimensionFromText(t,e,i){F.Debug("S.PolyLine: UpdateDimensionFromText input",{event:t,dimensionText:e,dimensionData:i});let o=-1,n=0,s=0;if(i.angleChange)return void this.UpdateLineAngleDimensionFromText(t,e,i);const a=i.segment;Os.ShowSVGSelectionState(this.BlockID,!1);const r=this.GetDimensionValueFromString(e,a);if(r>=0&&(o=this.GetDimensionLengthFromValue(r)),o<0)return ws.AddToDirtyList(this.BlockID),void Os.RenderDirtySVGObjects();const l=Oe.DeepCopy(this);if(!(this.Dimensions&Se.DimensionFlags.AllSeg)&&(this.Dimensions&Se.DimensionFlags.EndPts||this.Dimensions&Se.DimensionFlags.Total))this.Dimensions&Se.DimensionFlags.EndPts?this.UpdateEndPointDimensionFromText(t,o):this.Dimensions&Se.DimensionFlags.Total&&this.UpdateTotalDimensionFromText(t,o);else{this.UpdateSegmentDimensionFromText(t,o,a);const e={wdDim:-1,htDim:-1};this.GetPolyRectangularInfo(e)?a===e.wdDim||a===e.wdDim+2?(this.rwd=r,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!0)):a!==e.htDim&&a!==e.htDim+2||(this.rht=r,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!0)):(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1))}Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);for(let h=0;h<this.hooks.length;h++)Ps.SetLinkFlag(this.hooks[h].objid,Ee.LinkFlags.Move);if(ye.opt.ActionTriggerData=a,Yo.MaintainLink(this.BlockID,this,l,me.ActionTriggerType.PolyNode),this.Frame.x<0||this.Frame.y<0){const t=this.Frame;t.x<0&&(n=-t.x,t.x+=n),t.y<0&&(s=-t.y,(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&(s+=me.Common.DimDefaultStandoff),t.y+=s),this.StartPoint.x+=n,this.StartPoint.y+=s,this.EndPoint.x+=n,this.EndPoint.y+=s,ye.opt.SetObjectFrame(this.BlockID,t)}this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),F.Debug("S.PolyLine: UpdateDimensionFromText output",{Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint})}GetLineChangeFrame(){F.Debug("S.PolyLine: GetLineChangeFrame input");let t=ve.Pt2Rect(this.StartPoint,this.EndPoint);return t.width<me.Common.SegDefLen&&(t.width=me.Common.SegDefLen),t.height<me.Common.SegDefLen&&(t.height=me.Common.SegDefLen),F.Debug("S.PolyLine: GetLineChangeFrame output",t),t}CancelObjectDraw(){return F.Debug("S.PolyLine: CancelObjectDraw input"),rn.UnbindActionClickHammerEvents(),ye.opt.WorkAreaHammer.off("doubletap"),Rt(window).unbind("mousemove"),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),this.ResetAutoScrollTimer(),ws.AddToDirtyList(this.BlockID),Os.RenderDirtySVGObjects(),Qo.SelectObjects([this.BlockID],!1,!0),F.Debug("S.PolyLine: CancelObjectDraw output",!0),!0}GetBoundingBox(){F.Debug("S.PolyLine: GetBoundingBox input");const t=this.Frame;return F.Debug("S.PolyLine: GetBoundingBox output",t),t}IsRightAngle(t,e){F.Debug("S.PolyLine: IsRightAngle input",{segmentIndex:t,tolerance:e});let i=t-1;if(i<0){if(!this.polylist.closed)return F.Debug("S.PolyLine: IsRightAngle output",!1),!1;i=this.polylist.segs.length-1}let o=t+1;if(o>this.polylist.segs.length-1){if(!this.polylist.closed)return F.Debug("S.PolyLine: IsRightAngle output",!1),!1;o=1}const n=Oe.CalcAngleFromPoints(this.polylist.segs[i].pt,this.polylist.segs[t].pt),s=Oe.CalcAngleFromPoints(this.polylist.segs[t].pt,this.polylist.segs[o].pt),a=Math.abs(n-s),r=Math.abs(90-a)<=e||Math.abs(270-a)<=e;return F.Debug("S.PolyLine: IsRightAngle output",r),r}GetPolyRectangularInfo(t){F.Debug("S.PolyLine: GetPolyRectangularInfo input:",t);let e=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),i=!0;if(5!==this.polylist.segs.length||!this.polylist.closed)return F.Debug("S.PolyLine: GetPolyRectangularInfo output:",!1),!1;let o=[];const n=e.length;for(let u=0;u<n;u++)u<n-1&&e[u].x===e[u+1].x&&e[u].y===e[u+1].y||o.push(e[u]);if(e=o,5!==e.length)return F.Debug("S.PolyLine: GetPolyRectangularInfo output:",!1),!1;let s=0;for(let u=0;u<e.length-1&&i;u++){let t=ye.opt.GetCounterClockwiseAngleBetween2Points(e[u],e[u+1]);if(u>0){let e=t-s;e<0&&(e+=2*Math.PI),e>Math.PI&&(e-=Math.PI),e>=Math.PI/2-.052&&e<=Math.PI/2+.052||(i=!1)}s=t}let a=ve.GetDistanceBetween2Points(e[0],e[1]),r=ve.GetDistanceBetween2Points(e[2],e[3]),l=a/r;if(l<=.99||l>=1.01)return F.Debug("S.PolyLine: GetPolyRectangularInfo output:",!1),!1;a=ve.GetDistanceBetween2Points(e[1],e[2]),r=ve.GetDistanceBetween2Points(e[3],e[4]);let h=a/r;if(h<=.99||h>=1.01)return F.Debug("S.PolyLine: GetPolyRectangularInfo output:",!1),!1;let c,p,d=ye.opt.GetCounterClockwiseAngleBetween2Points(e[0],e[1]);return d<Math.PI/4||d>1.5*Math.PI||d>.75*Math.PI&&d<1.25*Math.PI?(c=1,p=2):(c=2,p=1),t&&(t.wdDim=c,t.htDim=p),F.Debug("S.PolyLine: GetPolyRectangularInfo output:",!0),!0}GetSegmentsBeforeAndAfter(t,e){F.Debug("S.PolyLine: GetSegmentsBeforeAndAfter input:",{segmentIndex:t,segmentsInfo:e}),e.segAfter=t+1,e.segAfter>=this.polylist.segs.length&&(e.segAfter=this.polylist.closed?1:-1),e.segBefore=t-1,0===e.segBefore&&(e.segBefore=this.polylist.closed?this.polylist.segs.length-1:-1),F.Debug("S.PolyLine: GetSegmentsBeforeAndAfter output:",e)}MaintainDimensionThroughPolygonOpennessChange(t){F.Debug("S.PolyLine: MaintainDimensionThroughPolygonOpennessChange input:",t),t&&(this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.Total|Se.DimensionFlags.EndPts,!1),this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.AllSeg,!0)),F.Debug("S.PolyLine: MaintainDimensionThroughPolygonOpennessChange output:",this.Dimensions)}GetUnrotatedBoundingBoxOfProposedFrame(t){F.Debug("S.PolyLine: GetUnrotatedBoundingBoxOfProposedFrame input:",t);let e=Oe.DeepCopy(t),i=this.GetDimensionsRect(),o=0,n=0;return i.width>0?(o=i.width-this.Frame.width,n=i.height-this.Frame.height):this.StyleRecord&&this.StyleRecord.Line&&this.StyleRecord.Line.Thickness>me.Common.KnobSize?(o=this.StyleRecord.Line.Thickness,n=this.StyleRecord.Line.Thickness):(o=me.Common.KnobSize,n=me.Common.KnobSize),ve.InflateRect(e,o/2,n/2),F.Debug("S.PolyLine: GetUnrotatedBoundingBoxOfProposedFrame output:",e),e}AdjustPolySeg(t,e,i,o,n,s,a,r,l){F.Debug("S.PolyLine: AdjustPolylineSegment input:",{event:t,initialX:e,initialY:i,newPointX:o,newPointY:n,moveData:s,offsetEnabled:a,minDistance:r,maxDistance:l});let h=Oe.DeepCopy(this.polylist),c=Oe.DeepCopy(this.Frame),p=Oe.DeepCopy(this.StartPoint),d=Oe.DeepCopy(this.EndPoint);const u=this.GetUnrotatedBoundingBoxOfProposedFrame(this.Frame),g=u.x<0||u.y<0;let y=[];const S={x:e,y:i},m={x:o,y:n};y.push(S),y.push(m);let b=s.moveAngle;const D=s.hitSegment;9999===b&&(b=this.GetSegmentAdjustAngle(D),s.moveAngle=b),b=360-b;const f=2*Math.PI*b/360;let x=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);const C=x[D].x,P=x[D].y;if(si.RotatePointsAboutCenter(this.Frame,-f,x),si.RotatePointsAboutCenter(this.Frame,-f,y),Math.abs(y[1].x-y[0].x)<r)return F.Debug("S.PolyLine: AdjustPolylineSegment output: false (<minDistance)"),!1;if(l&&l>0&&Math.abs(y[1].x-y[0].x)>l)return F.Debug("S.PolyLine: AdjustPolylineSegment output: false (>maxDistance)"),!1;if(isNaN(y[1].x-y[0].x))return F.Debug("S.PolyLine: AdjustPolylineSegment output: false (NaN difference)"),!1;const T=y[1].x-y[0].x;x[D-1].x+=T,x[D].x+=T,si.RotatePointsAboutCenter(this.Frame,f,x);const O=x[D].x-C,v=x[D].y-P,w=this.GetScale();if(D-1!=0){const t={x:this.polylist.segs[D-1].pt.x+O/w.x,y:this.polylist.segs[D-1].pt.y+v/w.y};this.polylist.segs[D-1].pt=Oe.DeepCopy(t)}if(D!==this.polylist.segs.length-1){const t={x:this.polylist.segs[D].pt.x+O/w.x,y:this.polylist.segs[D].pt.y+v/w.y};this.polylist.segs[D].pt=Oe.DeepCopy(t)}const k=ye.opt.svgObjectLayer.GetElementById(this.BlockID);let L=!1;D-1==0&&(this.AdjustLineStart(k,x[D-1].x,x[D-1].y,me.ActionTriggerType.LineStart),L=!0),D===this.polylist.segs.length-1&&(this.AdjustLineEnd(k,x[D].x,x[D].y,this.polylist.closed?me.ActionTriggerType.PolyEnd:me.ActionTriggerType.LineEnd),L=!0),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),L?this.CalcFrame():(this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame));const A=this.GetUnrotatedBoundingBoxOfProposedFrame(this.Frame);if(!g&&(A.x<0||A.y<0))if(a){let e={x:0,y:0};A.x<0&&(e.x=-A.x),A.y<0&&(e.y=-A.y),this.OffsetShape(e.x,e.y);const i=this.GetListOfEnclosedObjects(!1);for(let t=0;t<i.length;t++)ws.GetObjectPtr(i[t],!0).OffsetShape(e.x,e.y),Ps.SetLinkFlag(i[t],Ee.LinkFlags.Move),ws.AddToDirtyList(i[t]);this.UpdateDrawing(t)}else this.polylist=Oe.DeepCopy(h),this.Frame=Oe.DeepCopy(c),this.StartPoint=Oe.DeepCopy(p),this.EndPoint=Oe.DeepCopy(d),this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame);const I=this.GetDimensionsForDisplay(),E=new Ke;return E.width=I.width,E.height=I.height,E.left=I.x,E.top=I.y,Ts.UpdateDisplayCoordinates(I,m,ze.CursorTypes.Grow,this),F.Debug("S.PolyLine: AdjustPolylineSegment output:",{polylist:this.polylist,Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint}),!0}GetSegmentAdjustAngle(t){F.Debug("S.PolyLine: GetSegmentAdjustAngle input:",t);let e=9999,i={segBefore:0,segAfter:0},o=0;if(this.polylist.segs.length<=5){this.GetSegmentsBeforeAndAfter(t,i);let n=i.segAfter;if(o=i.segBefore,-1!=o&&(this.GetSegmentsBeforeAndAfter(o,i),-1!=i.segBefore&&this.IsRightAngle(i.segBefore,3)&&(e=Oe.CalcAngleFromPoints(this.polylist.segs[o-1].pt,this.polylist.segs[o].pt))),9999===e&&-1!=n&&this.IsRightAngle(n,3)&&(e=Oe.CalcAngleFromPoints(this.polylist.segs[n-1].pt,this.polylist.segs[n].pt)),9999!==e){((t,e)=>{let i=90-t;return t+=i,(e+=i)>=360&&(e-=360),e<0&&(e+=360),Math.abs(90-e)<5||Math.abs(180-e)<5})(Oe.CalcAngleFromPoints(this.polylist.segs[t-1].pt,this.polylist.segs[t].pt),e)&&(e=9999)}}return 9999===e&&(e=Oe.CalcAngleFromPoints(this.polylist.segs[t-1].pt,this.polylist.segs[t].pt),e+=90,e>=360&&(e-=360)),F.Debug("S.PolyLine: GetSegmentAdjustAngle output:",e),e}};let ss=ns;((t,e,i,o)=>{for(var n,s=o>1?void 0:o?os(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&is(e,i,s)})([jt((()=>vi))],ss.prototype,"polylist",2);class as extends ss{constructor(t){F.Debug("= S.PolyLineContainer: Input parameters:",t),(t=t||{}).Dimensions=void 0===t.Dimensions?Se.DimensionFlags.Always:t.Dimensions,t.objecttype=void 0===t.objecttype?Se.FNObjectTypes.FlWall:t.objecttype,t.TextFlags=void 0===t.TextFlags?0:t.TextFlags,t.TextFlags=ve.SetFlag(t.TextFlags,Se.TextFlags.None,!0),super(t),a(this,"T3Type"),this.T3Type="PolyLineContainer",null!==this.StyleRecord&&void 0!==this.StyleRecord||(this.StyleRecord=new ni),F.Debug("= S.PolyLineContainer: Output instance:",this)}CreateShape(t,e){F.Debug("= S.PolyLineContainer: Input parameters:",t,e);const i=super.CreateShape(t,e);return F.Debug("= S.PolyLineContainer: Output result:",i),i}NoRotate(){F.Debug("= S.PolyLineContainer: Checking if rotation is allowed");const t=this.polylist.closed;return F.Debug("= S.PolyLineContainer: Rotation allowed:",t),!t}GetKnobSize(t){F.Debug("= S.PolyLineContainer: Input event:",t);const e=1*me.Common.KnobSize/1*2;return F.Debug("= S.PolyLineContainer: Output knobSize:",e),e}GetCornerKnobImages(){F.Debug("= S.PolyLineContainer: Fetching corner knob images");const t={nwse:ze.Knob.Path+ze.Knob.DiagonLeft,nesw:ze.Knob.Path+ze.Knob.DiagonRight};return F.Debug("= S.PolyLineContainer: Corner knob images:",t),t}CreateActionTriggers(t,e,i,o){F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i,o);let n,s=0,a=0,r=null,l=null,h=0;const c=-1!=navigator.userAgent.toLowerCase().indexOf("firefox");if(this.objecttype===Se.FNObjectTypes.FlWall&&(wallOpt&&wallOpt.IsAddingWalls&&wallOpt.IsAddingWalls()||Ae.DocContext.UsingWallTool))return null;s=this.GetKnobSize(t);let p=t.docInfo.docToScreenScale;if(t.docInfo.docScale<=.5&&(p*=2),s/=p,!(l=super.CreateActionTriggers.call(this,t,e,i,o)))return null;h=s/2;const d={svgDoc:t,shapeType:me.CSType.Image,knobSize:s,fillOpacity:1,strokeSize:0,knobID:me.ActionTriggerType.MovePolySeg,cursorType:this.CalcCursorForSegment(this.StartPoint,this.EndPoint,!1),locked:!1};if(this.flags&Se.ObjFlags.Lock?(d.fillColor="gray",d.locked=!0):this.NoGrow()&&(d.fillColor="red",d.strokeColor="red",d.cursorType=ze.CursorType.Default),0!==(n=this.polylist.segs.length)){if(n>2&&0==(this.flags&Se.ObjFlags.Lock))for(let t=1;t<n;t++){switch(d.cursorType=this.CalcCursorForAngle(this.GetSegmentAdjustAngle(t)),this.NoGrow()&&(d.cursorType=ze.CursorType.Default),this.polylist.segs[t].LineType){case me.LineType.LINE:d.x=this.polylist.segs[t-1].pt.x+(this.polylist.segs[t].pt.x-this.polylist.segs[t-1].pt.x)/2+h+(this.StartPoint.x-this.Frame.x),d.y=this.polylist.segs[t-1].pt.y+(this.polylist.segs[t].pt.y-this.polylist.segs[t-1].pt.y)/2+h+(this.StartPoint.y-this.Frame.y),d.x-=s/2,d.y-=s/2;break;case me.LineType.ARCLINE:case me.LineType.PARABOLA:case me.LineType.ARCSEGLINE:const e=l.GetElementById(me.ActionTriggerType.PolyAdj,t);if(e){const i=e.GetPos(),o=[new De(this.polylist.segs[t-1].pt.x,this.polylist.segs[t-1].pt.y),i,new De(this.polylist.segs[t].pt.x,this.polylist.segs[t].pt.y)];a=ye.opt.GetCounterClockwiseAngleBetween2Points(o[0],o[2]),si.RotatePointsAboutPoint(o[1],-a,o);const n=new De(o[1].x,o[1].y),s=e.GetGeometryBBox();n.x+=s.width+3,o.push(n),si.RotatePointsAboutPoint(o[1],a,o),d.x=o[3].x,d.y=o[3].y}}r=this.GenericKnob(d),r.SetUserData({hitSegment:t,moveAngle:9999}),r&&r.SetURL&&(r.SetURL(ze.Knob.Path+ze.Knob.ExpandVert),r.ExcludeFromExport(!0)),a=Oe.CalcAngleFromPoints(this.polylist.segs[t-1].pt,this.polylist.segs[t].pt),0!==a&&(c?(a>=45&&a<=135||a>=235&&a<315)&&r&&r.SetURL&&r.SetURL(ze.Knob.Path+ze.Knob.ExpandHoriz):r.SetRotation(a)),l.AddElement(r)}return F.Debug("= S.PolyLineContainer: Output actionTriggers:",l),l}}PostCreateShapeCallback(t,e,i,o){F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i,o);const n=super.PostCreateShapeCallback(t,e,i,o);return F.Debug("= S.PolyLineContainer: Output result:",n),n}UpdateSVG(t,e){F.Debug("= S.PolyLineContainer: Input parameters:",t,e);const i=t.PathCreator();if(i.BeginPath(),e.length>1){i.MoveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)i.LineTo(e[t].x,e[t].y)}this.polylist.closed&&i.ClosePath(),i.Apply(),F.Debug("= S.PolyLineContainer: Updated SVG path")}MostlyContains(t){F.Debug("= S.PolyLineContainer: Input shape:",t);let e=0,i=!1;const o={},n=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1);if(vs.ActiveVisibleZList().indexOf(t.BlockID)<0)return!1;0!==t.RotationAngle&&(e=-t.RotationAngle/(180/Se.Geometry.PI),si.RotatePointsAboutCenter(t.Frame,e,n));const s=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1),a=n.length;for(let h=0;h<a;h++)if(en.PolyPtInPolygon(s,n[h])){i=!0;break}if(!i)return!1;if(!ve.GetPolyRect(o,n))return!1;0===o.width&&(o.width=1),0===o.height&&(o.height=1);const r=ve.IntersectRect(this.Frame,o),l=!!r&&r.width*r.height>o.width*o.height*.75;return F.Debug("= S.PolyLineContainer: Output result:",l),l}InterceptMoveOperation(t){F.Debug("= S.PolyLineContainer: Input event:",t);let e,i=[],o=vs.ZList(),n=!1;try{if(e=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget),!e)return!1;const s=e.GetTargetForEvent(t).GetID(),a=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);if(s===me.SVGElementClass.DimText)return!0;if(-1===this.PolyHitSeg(a)&&(n=!0),n){Qo.ClearSelectionClick(),i.push(this.BlockID);for(let t=0;t<o.length;t++){const e=ws.GetObjectPtr(o[t],!1);this.BlockID===e.BlockID||e.hooks.length||this.MostlyContains(e)&&i.push(e.BlockID)}return Qo.SelectObjects(i,!1,!1),ye.opt.postMoveSelectId=this.BlockID,Os.HideAllSVGSelectionStates(),F.Debug("= S.PolyLineContainer: Output selectedObjects:",i),!1}return!1}catch(s){throw this.LMActionClickExpCleanup(s),ye.opt.ExceptionCleanup(s),s}}SetupInterceptMove(t){F.Debug("= S.PolyLineContainer: Input event:",t),ye.opt.eventTimestamp=Date.now(),t.stopPropagation();const e=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);if(null===e)return!1;const i=e.ID;ye.opt.actionStoredObjectId=i,ye.stdObj.PreserveBlock(i);const o=me.ActionTriggerType.MovePolySeg;ye.opt.actionTriggerId=o,this.LMActionPreTrack(i,o),ye.opt.actionSvgObject=e;let n=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);n=xs.DoAutoGrowDrag(n);const s=new Wo(-1,0,null);this.Hit(n,!1,!1,s),ye.opt.actionTriggerData={hitSegment:s.segment+1,moveAngle:9999};const a=n.x,r=n.y,l=this.GetSVGFrame();ye.opt.actionBBox=Oe.DeepCopy(l),ye.opt.actionNewBBox=Oe.DeepCopy(l),Os.HideAllSVGSelectionStates(),ye.opt.actionStartX=a,ye.opt.actionStartY=r;const h=new Wo(-1,0,null);return this.Hit(n,!1,!1,h),F.Debug("= S.PolyLineContainer: Output result:",!0),!0}Inflate(t,e,i){F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i);const o={},n=[],s=Oe.DeepCopy(t);function a(t,e){const i=t.x-e.x,o=t.y-e.y;return ve.Sqrt(i*i+o*o)}function r(t,e,i){for(let o=e+1;o<t.length;o++)if(a(t[e],t[o])>1e-5)return o;return i&&e===t.length-1&&a(t[e],t[1])>1e-5?1:-1}function l(t,e){for(let i=e-1;i>=0;i--)if(a(t[e],t[i])>1e-5)return i;return-1}function h(t,e,i,o){const n=360-Oe.CalcAngleFromPoints(e,i),s=2*Math.PI*(n/360),a=[{x:e.x,y:e.y},{x:i.x,y:i.y}];return si.RotatePointsAboutCenter(t,-s,a),a[0].y+=o,a[1].y+=o,si.RotatePointsAboutCenter(t,s,a),a}function c(t,e){const i={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2},o=360-Oe.CalcAngleFromPoints(t[0],t[1]),n=2*Math.PI*(o/360);si.RotatePointsAboutPoint(i,-n,t);const s=Math.abs(e);t[0].x<t[1].x?(t[0].x-=s,t[1].x+=s):(t[0].x+=s,t[1].x-=s),si.RotatePointsAboutPoint(i,n,t)}function p(t,e,i,o){const n=360-Oe.CalcAngleFromPoints(t[i],t[e]);return 360-Oe.CalcAngleFromPoints(t[i],t[o])-n}ve.GetPolyRect(o,t);for(let d=0;d<t.length;d++){const t=l(s,d),a=r(s,d,i),u=t>=0?h(o,s[t],s[d],e):[],g=a>=0?h(o,s[d],s[a],e):[],y=[];if(t>=0&&a>=0){let i=p(s,t,d,a);if(i<0&&(i+=360),i>=30&&i<=330){const t={x:0,y:0};ye.opt.GetIntersectPt(u[0],u[1],g[0],g[1],null,t)&&y.push(new De(t.x,t.y))}else c(u,e),y.push(new De(u[1].x,u[1].y)),c(g,e),y.push(new De(g[0].x,g[0].y))}0===y.length&&(t>=0?y.push(new De(u[1].x,u[1].y)):a>=0&&y.push(new De(g[0].x,g[0].y))),n.push(...y)}return i&&n.length>0&&(n[0]=n[n.length-1]),F.Debug("= S.PolyLineContainer: Output inflatedPoints:",n),n}InflatePolyLine(t,e,i){F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i);let o=this.Inflate(t,-e,i);return ve.IsPointInPoly(t,o[1])&&(o=this.Inflate(t,e,i)),F.Debug("= S.PolyLineContainer: Output inflatedPoints:",o),o}MovePolySeg(t,e,i,o,n){F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i,o,n);const s=this.AdjustPolySeg(t,ye.opt.actionStartX,ye.opt.actionStartY,e,i,n,!1,2,1e3);s&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1),ye.opt.actionStartX=e,ye.opt.actionStartY=i),F.Debug("= S.PolyLineContainer: Output adjusted:",s)}AfterModifyShape(t,e){if(F.Debug("= S.PolyLineContainer: Input parameters:",t,e),e===me.ActionTriggerType.MovePolySeg){(t=>{let e=0,i=-1,o=!1;const n=this.StyleRecord.Line.Thickness;let s=ye.opt.actionTriggerData.moveAngle;const a=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),r=a.length;if(0!==s){s=360-s;const t=2*Math.PI*(s/360);si.RotatePointsAboutCenter(this.Frame,-t,a)}const l=a[t].x;if(this.polylist.closed){let t=!0;for(let e=0;e<r;e++)if(!ve.IsEqual(a[e].x,l,n)){t=!1;break}if(t)return}for(let c=t+1;c<r&&ve.IsEqual(a[c].x,l,n);c++)e++;let h=!0;if(0===e&&1===t&&ve.IsEqual(a[r-1].x,l,n)&&ve.IsEqual(a[r-2].x,l,n)&&(t=r-2,e=1,ve.IsEqual(a[0].y,a[r-2].y,n)||(h=!1)),e>0&&h&&(this.polylist.segs.splice(t,e),o=!0,t+1+e>=r&&1===e&&this.polylist.closed&&ve.IsEqual(a[0].x,l,n))){this.polylist.segs.splice(0,1);const t=this.polylist.segs[0].pt.x+this.StartPoint.x,e=this.polylist.segs[0].pt.y+this.StartPoint.y;this.polylist.segs[0].pt.x=0,this.polylist.segs[0].pt.y=0,this.AdjustLineStart(null,t,e,me.ActionTriggerType.LineStart)}for(let c=t-2;c>0&&ve.IsEqual(a[c].x,l,n);c--)i=c;if(!this.polylist.closed&&t===r-1&&3===r&&i<0&&ve.IsEqual(a[0].x,l,n)&&(i=0),this.polylist.closed&&1===i?ve.IsEqual(a[0].x,l,n)&&(i=0):1===i&&this.polylist.segs.length>2&&ve.IsEqual(a[0].x,l,n)&&(i=0),i>=0&&(this.polylist.segs.splice(i+1,t-1-i),o=!0),this.polylist.closed&&0===e&&i<0&&(t===r-1||t<=2)){const e=a[2].x;let i=!0;if(2!==t||ve.IsEqual(a[1].y,a[0].y,n)||(i=!1),ve.IsEqual(a[1].x,e,n)&&ve.IsEqual(a[0].x,e,n)&&i){this.polylist.segs.splice(0,2),o=!0;const t=this.polylist.segs[0].pt.x+this.StartPoint.x,e=this.polylist.segs[0].pt.y+this.StartPoint.y;this.polylist.segs[0].pt.x=0,this.polylist.segs[0].pt.y=0,this.AdjustLineStart(null,t,e,me.ActionTriggerType.LineStart)}else if(t===r-1){const e=a[t].x;if(ve.IsEqual(a[1].x,e,n)&&ve.IsEqual(a[0].x,e,n)){this.polylist.segs.splice(0,1),o=!0;const t=this.polylist.segs[0].pt.x+this.StartPoint.x,e=this.polylist.segs[0].pt.y+this.StartPoint.y;this.polylist.segs[0].pt.x=0,this.polylist.segs[0].pt.y=0,this.AdjustLineStart(null,t,e,me.ActionTriggerType.LineStart)}}else 2===t&&ve.IsEqual(a[1].x,e,n)&&ve.IsEqual(a[0].x,e,n)&&(this.polylist.segs.splice(1,1),o=!0)}o&&ws.AddToDirtyList(this.BlockID)})(ye.opt.actionTriggerData.hitSegment)}this.BaseLineAfterModifyShape(t,e),F.Debug("= S.PolyLineContainer: Output result:",!0)}BaseLineAfterModifyShape(t,e){if(F.Debug("= S.PolyLineContainer: Input parameters:",t,e),ye.opt.actionSvgObject){const t=ye.opt.actionSvgObject.GetElementById(me.Common.EllipseAxes);null!=t&&ye.opt.actionSvgObject.RemoveElement(t)}ye.opt.ob.Frame&&(Yo.MaintainLink(t,this,ye.opt.ob,e),ye.opt.ob={}),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),this.arcobj&&(this.arcobj=null),F.Debug("= S.PolyLineContainer: Output result:",!0)}UpdateDimensionFromText(t,e,i){let o,n,s,a,r,l,h,c,p;F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i);let d={hitSegment:0,moveAngle:0},u=Oe.DeepCopy(this),g=this.polylist.closed,y=!1,S=-1;if(i.hookedObjectInfo)return this.UpdateDimensionsFromTextForHookedObject(t,e,i);if(i.angleChange)return this.UpdateLineAngleDimensionFromText(t,e,i);if(s=i.segment,ye.opt.ob=u,ws.GetObjectPtr(this.BlockID,!0),Os.ShowSVGSelectionState(this.BlockID,!1),o=this.GetDimensionValueFromString(e,s),o>=0&&(n=this.GetDimensionLengthFromValue(o)),n<=0||o<0)return ws.AddToDirtyList(this.BlockID),void Os.RenderDirtySVGObjects();d.hitSegment=s+1,d.hitSegment>=this.polylist.segs.length&&(d.hitSegment=g?1:s,y=!g),g||1!==s&&s!==this.polylist.segs.length-1||(d.hitSegment=s,y=!0),d.moveAngle=this.GetSegmentAdjustAngle(d.hitSegment),l=360-d.moveAngle,h=2*Math.PI*(l/360),a=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),r=g&&this instanceof as?ye.opt.InflateLine(a,this.StyleRecord.Line.BThick,g,this.Dimensions&Se.DimensionFlags.Exterior):Oe.DeepCopy(a);for(let C=0;C<r.length;C++)r[C].x+=this.Frame.x,r[C].y+=this.Frame.y;c=r[s].x,p=r[s].y,si.RotatePointsAboutCenter(this.Frame,-h,r);let m=Math.abs(r[s].y-r[s-1].y);if(Math.abs(n)<=m||y)return this.Dimensions&Se.DimensionFlags.AllSeg||(S=this.Dimensions,this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.AllSeg,!0),this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.Total,!1),this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.EndPts,!1)),super.UpdateDimensionFromText(t,e,i),void(S>0&&(this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.AllSeg,S&Se.DimensionFlags.AllSeg),this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.Total,S&Se.DimensionFlags.Total),this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.EndPts,S&Se.DimensionFlags.EndPts)));let b=0===m?n:Math.sqrt(Math.pow(n,2)-Math.pow(m,2));r[s].x=r[s].x>r[s-1].x?r[s-1].x+b:r[s-1].x-b,si.RotatePointsAboutCenter(this.Frame,h,r);let D=r[s].x,f=r[s].y;this.AdjustPolySeg(t,c,p,D,f,d,!0,0),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);for(let C=0;C<this.hooks.length;C++)Ps.SetLinkFlag(this.hooks[C].objid,Ee.LinkFlags.Move);ye.opt.ActionTriggerData=s,Yo.MaintainLink(this.BlockID,this,u,me.ActionTriggerType.PolyNode);let x={wdDim:-1,htDim:-1};if(this.GetPolyRectangularInfo(x)?s===x.wdDim||s===x.wdDim+2?(this.rwd=o,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!0)):s!==x.htDim&&s!==x.htDim+2||(this.rht=o,this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!0)):(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),this.Frame.x<0||this.Frame.y<0){let t={x:0,y:0};this.Frame.x<0&&(t.x=-this.Frame.x,this.Frame.x+=t.x),this.Frame.y<0&&(t.y=-this.Frame.y,(this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&(t.y+=me.Common.DimDefaultStandoff),this.Frame.y+=t.y),this.StartPoint.x+=t.x,this.StartPoint.y+=t.y,this.EndPoint.x+=t.x,this.EndPoint.y+=t.y,ye.opt.SetObjectFrame(this.BlockID,this.Frame)}this.UpdateDrawing(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),F.Debug("= S.PolyLineContainer: Output result:",!0)}GetDimensionsForDisplay(){if(F.Debug("= S.PolyLineContainer: Getting dimensions for display"),this.objecttype!==Se.FNObjectTypes.FlWall){const t=this.BaseLineGetDimensions();return F.Debug("= S.PolyLineContainer: Output dimensions:",t),t}const t=this.GetDimensionPoints(),e={};ve.GetPolyRect(e,t);const i={x:e.x,y:e.y,width:e.width,height:e.height};return F.Debug("= S.PolyLineContainer: Output result:",i),i}BaseLineGetDimensions(){F.Debug("= S.PolyLineContainer: Getting base line dimensions");let t=this.EndPoint.x-this.StartPoint.x,e=this.EndPoint.y-this.StartPoint.y,i={x:ve.Sqrt(t*t+e*e),y:0};return F.Debug("= S.PolyLineContainer: Output dimensions:",i),i}CanSnapToShapes(t){let e;return F.Debug("= S.PolyLineContainer: Input shape:",t),t&&!this.polylist.closed?(t.distanceonly=Se.GuideDistanceTypes.PolyWall,e=this.BlockID):e=this.BlockID,F.Debug("= S.PolyLineContainer: Output result:",e),e}IsSnapTarget(){F.Debug("= S.PolyLineContainer: Checking if it is a snap target");return F.Debug("= S.PolyLineContainer: Output result:",false),false}GuideDistanceOnly(){F.Debug("= S.PolyLineContainer: Checking guide distance type");const t=this.polylist.closed?Se.GuideDistanceTypes.Room:Se.GuideDistanceTypes.PolyWall;return F.Debug("= S.PolyLineContainer: Output guide distance type:",t),t}SetCursors(){F.Debug("= S.PolyLineContainer: Setting cursors");const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(ye.opt.crtOpt===me.OptTypes.AddCorner){const e=t.GetElementById(me.SVGElementClass.Slop);e&&e.SetCursor(ze.CursorType.Cross)}else this.BaseShapeSetCursors();F.Debug("= S.PolyLineContainer: Cursors set")}BaseShapeSetCursors(){F.Debug("= S.PolyLineContainer: Setting cursors");const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID),e=(this.TextFlags&Se.TextFlags.OneClick)>0;switch(Ps.GetEditMode()){case Se.EditState.Default:if(this.BaseDrawingObjectSetCursors(),e){const e=t.GetElementById(me.SVGElementClass.Shape);e&&e.SetCursor(ze.CursorType.Text),t.GetElementById(me.SVGElementClass.Slop)}break;case Se.EditState.FormatPaint:const i=t.GetElementById(me.SVGElementClass.Shape);i&&i.SetCursor(ze.CursorType.Paint);const o=t.GetElementById(me.SVGElementClass.Slop);o&&o.SetCursor(ze.CursorType.Paint);break;default:this.BaseDrawingObjectSetCursors()}F.Debug("= S.PolyLineContainer: Cursors set")}BaseDrawingObjectSetCursors(){F.Debug("= S.PolyLineContainer: Setting cursors");const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);let e=!1;if(!(this.flags&Se.ObjFlags.Lock)&&t)if(Ps.GetEditMode()===Se.EditState.Default){const i=t.GetElementById(me.SVGElementClass.Shape);i&&(this.objecttype===Se.FNObjectTypes.FrameContainer?i.SetCursor(ze.CursorType.Default):i.SetCursor(ze.CursorType.Add));[me.ShapeIconType.HyperLink,me.ShapeIconType.Notes,me.ShapeIconType.ExpandedView,me.ShapeIconType.Comment,me.ShapeIconType.Attachment,me.ShapeIconType.FieldData].forEach((e=>{const i=t.GetElementById(e);i&&i.SetCursor(ze.CursorType.Pointer)}));const o=t.GetElementById(me.SVGElementClass.Slop);o&&o.SetCursor(ze.CursorType.Add);const n=ye.opt.svgDoc.GetActiveEdit();if(this.DataID&&this.DataID>=0&&t.textElem&&(t.textElem===n?(i.SetCursor(ze.CursorType.Text),t.textElem.SetCursorState(ze.CursorState.EditLink)):t.textElem.SetCursorState(ze.CursorState.LinkOnly)),this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select&&this.IsSelected()){t.GetElementListWithId(me.SVGElementClass.DimText).forEach((t=>{t.SetCursorState(ze.CursorState.EditOnly),t===n&&(e=!0)})),e&&(i.SetCursor(null),o&&o.SetCursor(null))}}else this.ClearCursors();F.Debug("= S.PolyLineContainer: Cursors set")}GetListOfEnclosedObjects(t,e){F.Debug("= S.PolyLineContainer: Input parameters:",t,e);const i=vs.ActiveVisibleZList(),o=[];if(!this.polylist.closed)return F.Debug("= S.PolyLineContainer: Output enclosedObjects:",o),o;this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!0,null);for(let n=0;n<i.length;n++){const s=ws.GetObjectPtr(i[n],!1);if(this.BlockID!==s.BlockID){const i=e&&1===s.hooks.length&&s.hooks[0].objid===this.BlockID;(!t&&s.hooks.length||this.MostlyContains(s)||i)&&o.push(s.BlockID)}}return F.Debug("= S.PolyLineContainer: Output enclosedObjects:",o),o}AfterRotateShape(t){F.Debug("= S.PolyLineContainer: Input event:",t);const e=ye.opt.rotateEndRotation;this.RotateAllInContainer(t,e),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),ws.AddToDirtyList(t),Os.RenderDirtySVGObjects(),F.Debug("= S.PolyLineContainer: Output result:",!0)}RotateAllInContainer(t,e){F.Debug("= S.PolyLineContainer: Input parameters:",t,e),vs.ActiveVisibleZList();let i=[];ye.stdObj.PreserveBlock(ye.opt.selectObjsBlockId);let o=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,n=Oe.DeepCopy(o);if(Qo.ClearSelectionClick(),i=this.GetListOfEnclosedObjects(!1,!0),i.push(this.BlockID),i.length<=1){let o=ye.opt.rotateStartRotation,n=ye.opt.rotateEndRotation;return ye.opt.ob=Oe.DeepCopy(this),ye.opt.rotateStartRotation=0,ye.opt.rotateEndRotation=e,ye.opt.rotateStartPoint.x=this.RotateKnobPt.x,ye.opt.rotateStartPoint.y=this.RotateKnobPt.y,ye.opt.rotatePivotX=this.Frame.x+this.Frame.width/2,ye.opt.rotatePivotY=this.Frame.y+this.Frame.height/2,super.AfterRotateShape(t),ye.opt.rotateStartRotation=o,ye.opt.rotateEndRotation=n,Qo.SelectObjects(i,!1,!1),ye.opt.ob={},F.Debug("= S.PolyLineContainer: Output enclosedObjects:",i),i}Qo.SelectObjects(i,!1,!1);let s=$o.GroupSelected(!0,null,!1,!1,!1);o=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data;let a=ws.GetObjectPtr(s,!0);if(null===a)return;ye.opt.svgObjectLayer.GetElementById(a.BlockID).SetRotation(e),a.RotationAngle=e,$o.UngroupShape(s,!0);let r=i.pop();Qo.SelectObjects(n,!1,!1);let l=ws.GetObjectPtr(r,!1);return l.UpdateFrame(),l&&(l.r.x<0||l.r.y<0)&&$o.Undo(),F.Debug("= S.PolyLineContainer: Output enclosedObjects:",i),i}GetPointsForAreaDimension(){F.Debug("= S.PolyLineContainer: Getting points for area dimension");const t=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),e=this.Dimensions&Se.DimensionFlags.Exterior?ye.opt.InflateLine(t,this.StyleRecord.Line.BThick,this.polylist.closed,!0):ye.opt.InflateLine(t,this.StyleRecord.Line.BThick,this.polylist.closed,!1);return F.Debug("= S.PolyLineContainer: Output points for area dimension:",e),e}GetDimensionPoints(){F.Debug("= S.PolyLineContainer: Getting dimension points");let t=[],e=[],i=0,o=0,n=0,s={x:this.Frame.width/2,y:this.Frame.height/2},a={},r={};if(!this.polylist.closed&&this.Dimensions&Se.DimensionFlags.EndPts)t.push(new De(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y)),t.push(new De(this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y));else if(!this.polylist.closed&&this.Dimensions&Se.DimensionFlags.Total){e=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);for(let t=1;t<e.length;t++)o=Math.abs(e[t-1].x-e[t].x),n=Math.abs(e[t-1].y-e[t].y),i+=Math.sqrt(o*o+n*n);a.x=s.x-i/2,a.y=s.y,t.push(new De(a.x,a.y)),r.x=s.x+i/2,r.y=s.y,t.push(new De(r.x,r.y));const l=ye.opt.GetCounterClockwiseAngleBetween2Points(new De(0,0),new De(this.Frame.width,this.Frame.height));si.RotatePointsAboutPoint(s,l,t)}else e=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),t=this.polylist.closed?ye.opt.InflateLine(e,this.StyleRecord.Line.BThick,this.polylist.closed,this.Dimensions&Se.DimensionFlags.Exterior):Oe.DeepCopy(e);return F.Debug("= S.PolyLineContainer: Output dimension points:",t),t}CustomSnap(t,e,i,o,n,s){var a,r;F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i,o,n,s);let l=32768,h=32768,c=32768,p=-1;const d=vs.ZList(),u=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);for(let y=0;y<u.length;y++)u[y].x+=t,u[y].y+=e;if(s){const t={};si.LineDStyleHit(u,{x:s.x+i,y:s.y+o},this.StyleRecord.Line.Thickness,0,t)&&t.lpHit>=0&&(p=t.lpHit)}for(let y=0;y<u.length;y++)u[y].x+=i,u[y].y+=o;const g={};ve.GetPolyRect(g,u);for(let y=0;y<d.length;y++)if(d[y]!==this.BlockID){if(ye.opt.moveList&&ye.opt.moveList.includes(d[y]))continue;const t=ws.GetObjectPtr(d[y],!1);if(t instanceof as){const e=p>=0?p:1,i=p>=0?p+1:u.length;for(let o=e;o<i;o++){const e=new Wo(-1,0,null);let i={x:null==(a=u[o-1])?void 0:a.x,y:null==(r=u[o-1])?void 0:r.y};if(!t.Hit(i,!1,!1,e)&&(i={x:u[o].x,y:u[o].y},!t.Hit(i,!1,!1,e)))continue;const n=e.segment+1,s=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),p=90-Oe.CalcAngleFromPoints(u[o-1],u[o])+Oe.CalcAngleFromPoints(s[n-1],s[n]);if(Math.abs(90-p)<=1||Math.abs(270-p)<=1){const e={x:i.x,y:i.y};t.SnapPointToSegment(n,e);const s=e.x-i.x,a=e.y-i.y;let r=ye.opt.GetCounterClockwiseAngleBetween2Points(u[o-1],u[o])/(2*Math.PI)*360;r>180&&(r-=180),r%90<1||r%90>89?r>=89&&r<=91?(Math.abs(s)>.02&&Math.abs(h)>Math.abs(s)&&(h=s),c=32768,Math.abs(t.Frame.y-g.y)<10?c=t.Frame.y-g.y:Math.abs(t.Frame.y-(g.y+g.height))<10?c=t.Frame.y-(g.y+g.height):Math.abs(t.Frame.y+t.Frame.height-g.y)<10?c=t.Frame.y+t.Frame.height-g.y:Math.abs(t.Frame.y+t.Frame.height-(g.y+g.height))<10&&(c=t.Frame.y+t.Frame.height-(g.y+g.height)),Math.abs(l)>Math.abs(c)&&(l=c)):Math.abs(a)>.02&&Math.abs(l)>Math.abs(a)&&(l=a,h=32768,Math.abs(t.Frame.x-g.x)<10?h=t.Frame.x-g.x:Math.abs(t.Frame.x-(g.x+g.width))<10?h=t.Frame.x-(g.x+g.width):Math.abs(t.Frame.x+t.Frame.width-g.x)<10?h=t.Frame.x+t.Frame.width-g.x:Math.abs(t.Frame.x+t.Frame.width-(g.x+g.width))<10&&(h=t.Frame.x+t.Frame.width-(g.x+g.width)),Math.abs(h),Math.abs(h)):(Math.abs(s)>.02||Math.abs(a)>.02)&&(Math.abs(h)>Math.abs(s)&&(h=s),Math.abs(l)>Math.abs(a)&&(l=a))}}}}return 32768!==h||32768!==l?(h<32768&&(s.x+=h),l<32768&&(s.y+=l),F.Debug("= S.PolyLineContainer: Output result:",!0),!0):(F.Debug("= S.PolyLineContainer: Output result:",!1),!1)}CanUseRFlags(){F.Debug("= S.PolyLineContainer: Checking if RFlags can be used");const t=this.GetPolyRectangularInfo(null);return F.Debug("= S.PolyLineContainer: Output result:",t),t}SetSize(t,e,i){if(F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i),null!==t){if(null===e&&1===Math.abs(t-this.Frame.width))return!0}else if(null!==e&&null===t&&1===Math.abs(e-this.Frame.height))return!0;this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1));const o=super.SetSize(t,e,i);return F.Debug("= S.PolyLineContainer: Output result:",o),o}AdjustDimensionLength(t){F.Debug("= S.PolyLineContainer: Input dimensionLength:",t);let e=t;if(this.polylist&&this.polylist.closed&&null!==this.GetPolyRectangularInfo(null)){const i=this.Dimensions&Se.DimensionFlags.Exterior?-this.StyleRecord.Line.Thickness:this.StyleRecord.Line.Thickness;null!==t&&(e+=i)}return F.Debug("= S.PolyLineContainer: Output adjustedLength:",e),e}GetDimensionsForDisplay(){F.Debug("= S.PolyLineContainer: Getting dimensions for display");const t={width:this.Frame.width,height:this.Frame.height,x:this.Frame.x,y:this.Frame.y};return this.polylist&&this.polylist.closed&&(this.Dimensions&Se.DimensionFlags.Exterior?(t.x-=this.StyleRecord.Line.Thickness/2,t.y-=this.StyleRecord.Line.Thickness/2,t.width+=this.StyleRecord.Line.Thickness,t.height+=this.StyleRecord.Line.Thickness):(t.x+=this.StyleRecord.Line.Thickness/2,t.y+=this.StyleRecord.Line.Thickness/2,t.width-=this.StyleRecord.Line.Thickness,t.height-=this.StyleRecord.Line.Thickness)),F.Debug("= S.PolyLineContainer: Output dimensions:",t),t}GetSnapRect(){F.Debug("= S.PolyLineContainer: Getting snap rect");const t=this.GetDimensionsForDisplay();return F.Debug("= S.PolyLineContainer: Output dimensions:",t),t}GetDragR(){F.Debug("= S.PolyLineContainer: Getting drag rectangle");let t=new wi;if(ve.CopyRect(t,this.r),this.polylist&&this.polylist.closed&&this.StyleRecord&&this.StyleRecord.Line){const e=this.StyleRecord.Line.BThick;ve.InflateRect(t,2*e,2*e)}return F.Debug("= S.PolyLineContainer: Output drag rectangle:",t),t}SetShapeOrigin(t,e,i,o){F.Debug("= S.PolyLineContainer: Input parameters:",t,e,i,o);let n=this.GetSVGFrame(),s=0,a=0;this.polylist&&this.polylist.closed&&o&&(this.Dimensions&Se.DimensionFlags.Exterior?(n.x-=this.StyleRecord.Line.Thickness/2,n.y-=this.StyleRecord.Line.Thickness/2,n.width+=this.StyleRecord.Line.Thickness,n.height+=this.StyleRecord.Line.Thickness):(n.x+=this.StyleRecord.Line.Thickness/2,n.y+=this.StyleRecord.Line.Thickness/2,n.width-=this.StyleRecord.Line.Thickness,n.height-=this.StyleRecord.Line.Thickness)),null!==t&&(s=n.x-t),null!==e&&(a=n.y-e),this.StartPoint.x-=s,this.StartPoint.y-=a,this.EndPoint.x-=s,this.EndPoint.y-=a,this.CalcFrame(),F.Debug("= S.PolyLineContainer: Output frame:",n)}MaintainDimensionThroughPolygonOpennessChange(t){F.Debug("= S.PolyLineContainer: Input isClosed:",t);let e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1),i=!1;t&&(this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.Total|Se.DimensionFlags.EndPts,!1),this.Dimensions=ve.SetFlag(this.Dimensions,Se.DimensionFlags.AllSeg,!0)),i=t?!(this.Dimensions&Se.DimensionFlags.Exterior):this.Dimensions&Se.DimensionFlags.Exterior;let o=ye.opt.InflateLine(e,this.StyleRecord.Line.Thickness/2,!0,i);if(o&&o.length===this.polylist.segs.length){this.StartPoint.x=o[0].x,this.StartPoint.y=o[0].y,this.EndPoint.x=o[o.length-1].x,this.EndPoint.y=o[o.length-1].y;for(let t=0;t<this.polylist.segs.length;t++)this.polylist.segs[t].pt.x=o[t].x-this.StartPoint.x,this.polylist.segs[t].pt.y=o[t].y-this.StartPoint.y}F.Debug("= S.PolyLineContainer: Output inflatedPoints:",o)}ChangeLineThickness(t){F.Debug("= S.PolyLineContainer: Input newThickness:",t);let e,i,o,n,s,a=[],r=[],l=this.StyleRecord.Line.Thickness;if(this.UpdateFrame(null),s=(l-t)/2,n=this,n.StyleRecord.Line.BThick&&n.polylist&&n.polylist.closed&&n.polylist.segs&&n.polylist.segs.length){if(n instanceof we.Shape.Polygon){let t={};t.Frame=n.Frame,i=new we.Shape.PolyLine(t),i.polylist=n.polylist,i.StartPoint=n.StartPoint,i.EndPoint=n.EndPoint}else i=n;if(o=i.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,r),r.length>0)for(a.push(new De(o[0].x,o[0].y)),e=0;e<r.length;e++)a.push(new De(o[r[e]].x,o[r[e]].y));else a=Oe.DeepCopy(o);o=ye.opt.InflateLine(a,Math.abs(s),!0,s>=0),n.StartPoint.x=o[0].x,n.StartPoint.y=o[0].y,n.EndPoint.x=o[o.length-1].x,n.EndPoint.y=o[o.length-1].y;let t=Oe.DeepCopy(n.polylist.segs);for(n.polylist.segs=[],e=0;e<o.length;e++)n.polylist.segs.push(new Pi(1,o[e].x-n.StartPoint.x,o[e].y-n.StartPoint.y)),e<t.length&&(n.polylist.segs[e].LineType=t[e].LineType,n.polylist.segs[e].ShortRef=t[e].ShortRef,n.polylist.segs[e].dataclass=t[e].dataclass,n.polylist.segs[e].dimDeflection=t[e].dimDeflection,n.polylist.segs[e].flags=t[e].flags,n.polylist.segs[e].param=t[e].param,n.polylist.segs[e].weight=t[e].weight);if(n instanceof we.Shape.BaseLine)n.CalcFrame();else if(n instanceof we.Shape.Polygon){l=n.StyleRecord.Line.BThick;let t=n.Frame.width/(n.Frame.width+2*l),e=n.Frame.height/(n.Frame.height+2*l),i=n.Frame.x*t-n.Frame.x+l,o=n.Frame.y*e-n.Frame.y+l;n.ScaleObject(i,o,null,0,t,e,!1)}}this.UpdateFrame(null),F.Debug("= S.PolyLineContainer: Output updated thickness:",t)}ChangeLineThickness(t){F.Debug("= S.PolyLineContainer: Input newThickness:",t);let e,i,o,n,s,a=[],r=[];const l=this.StyleRecord.Line.Thickness;if(this.UpdateFrame(null),s=(l-t)/2,n=this,n.StyleRecord.Line.BThick&&n.polylist&&n.polylist.closed&&n.polylist.segs&&n.polylist.segs.length){if(n instanceof we.Shape.Polygon){let t={};t.Frame=n.Frame,i=new we.Shape.PolyLine(t),i.polylist=n.polylist,i.StartPoint=n.StartPoint,i.EndPoint=n.EndPoint}else i=n;if(o=i.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,r),r.length>0)for(a.push(new De(o[0].x,o[0].y)),e=0;e<r.length;e++)a.push(new De(o[r[e]].x,o[r[e]].y));else a=Oe.DeepCopy(o);o=ye.opt.InflateLine(a,Math.abs(s),!0,s>=0),n.StartPoint.x=o[0].x,n.StartPoint.y=o[0].y,n.EndPoint.x=o[o.length-1].x,n.EndPoint.y=o[o.length-1].y;let t=Oe.DeepCopy(n.polylist.segs);for(n.polylist.segs=[],e=0;e<o.length;e++)n.polylist.segs.push(new Pi(1,o[e].x-n.StartPoint.x,o[e].y-n.StartPoint.y)),e<t.length&&(n.polylist.segs[e].LineType=t[e].LineType,n.polylist.segs[e].ShortRef=t[e].ShortRef,n.polylist.segs[e].dataclass=t[e].dataclass,n.polylist.segs[e].dimDeflection=t[e].dimDeflection,n.polylist.segs[e].flags=t[e].flags,n.polylist.segs[e].param=t[e].param,n.polylist.segs[e].weight=t[e].weight);if(n instanceof we.Shape.BaseLine)n.CalcFrame();else if(n instanceof we.Shape.Polygon){const t=n.StyleRecord.Line.BThick,e=n.Frame.width/(n.Frame.width+2*t),i=n.Frame.height/(n.Frame.height+2*t),o=n.Frame.x*e-n.Frame.x+t,s=n.Frame.y*i-n.Frame.y+t;n.ScaleObject(o,s,null,0,e,i,!1)}}this.UpdateFrame(null),F.Debug("= S.PolyLineContainer: Output updated thickness:",t)}}class rs extends es{constructor(t={}){(t=t||{}).LineType=me.LineType.LINE,super(t),a(this,"StartPoint"),a(this,"EndPoint"),a(this,"FixedPoint"),a(this,"LineOrientation"),a(this,"hoplist"),a(this,"ArrowheadData"),a(this,"ShortRef"),a(this,"shapeparam"),a(this,"StartArrowID"),a(this,"EndArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),a(this,"TextDirection"),this.StartPoint=t.StartPoint||{x:0,y:0},this.EndPoint=t.EndPoint||{x:0,y:0},this.FixedPoint=t.FixedPoint||[0,0],this.LineOrientation=t.LineOrientation||me.LineOrientation.None,this.hoplist=t.hoplist||{nhops:0,hops:[]},this.ArrowheadData=t.ArrowheadData||[],this.ShortRef=t.ShortRef||0,this.shapeparam=t.shapeparam||0,this.StartArrowID=t.StartArrowID||0,this.EndArrowID=t.EndArrowID||0,this.StartArrowDisp=t.StartArrowDisp||!1,this.EndArrowDisp=t.EndArrowDisp||!1,this.ArrowSizeIndex=t.ArrowSizeIndex||0,this.TextDirection=t.TextDirection||!1,this.CalcFrame()}GetLineShapePolyPoints(t,e){F.Debug("S.Line - Input:",{numPoints:t,adjustForFrame:e});let i=[],o=this.shapeparam,n=this.ShortRef;o<.01&&(n=0);let s=this.EndPoint.x-this.StartPoint.x,a=this.EndPoint.y-this.StartPoint.y,r=!1;switch(n){case 0:case me.LineTypes.LsMeasuringTape:i.push(new De(this.StartPoint.x,this.StartPoint.y)),i.push(new De(this.EndPoint.x,this.EndPoint.y));break;case 1:case 2:2===n&&(r=!0);let t=Math.sqrt(s*s+a*a);if(0===t)break;let e=a/t,l=s/t,h=o*(t>200?200:t)/2,c=(t-2*h)/2,p=new De(this.StartPoint.x,this.StartPoint.y);i.push(p);let d=new De(this.StartPoint.x+c*l,this.StartPoint.y+c*e);i.push(d);let u=new De(d.x+h*e,d.y-h*l);if(r){i.push(u);let t=new De(u.x+h*l,u.y+h*e);i.push(t);let o=new De(t.x-2*h*e,t.y+2*h*l);i.push(o);let n=new De(o.x+h*l,o.y+h*e);i.push(n);let s=new De(this.EndPoint.x,this.EndPoint.y);i.push(s)}else{let t=new De(u.x+h*l-h*l/2,u.y+h*e-h*e/2);i.push(t);let o=new De(t.x-2*h*e+2*h*l/2,t.y+2*h*l+2*h*e/2);i.push(o);let n=new De(o.x+h*l,o.y+h*e);i.push(n);let s=new De(this.EndPoint.x,this.EndPoint.y);i.push(s)}}if(e)for(let l=0;l<i.length;l++)i[l].x-=this.Frame.x,i[l].y-=this.Frame.y;return F.Debug("S.Line - Output:",i),i}CreateShape(t,e){if(F.Debug("S.Line - Input:",{svgContainer:t,isHidden:e}),this.flags&Se.ObjFlags.NotVisible)return null;let i=t.CreateShape(me.CSType.ShapeContainer),o=null,n=this.ShortRef,s="#000000",a=1,r=1,l=0;this.shapeparam<.01&&(n=0);let h=(0===n||n==me.LineTypes.LsMeasuringTape)&&0===this.hoplist.nhops;o=h?t.CreateShape(me.CSType.Line):t.CreateShape(me.CSType.Polyline),o.SetID(me.SVGElementClass.Shape);let c=h?t.CreateShape(me.CSType.Line):t.CreateShape(me.CSType.Polyline);c.SetID(me.SVGElementClass.Slop),c.ExcludeFromExport(!0),this.CalcFrame();let p=this.Frame,d=this.StyleRecord;if(null==d){let t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);t&&(d=t.def.style)}d&&(s=d.Line.Paint.Color,a=d.Line.Thickness,a>0&&a<1&&(a=1),r=d.Line.Paint.Opacity,l=d.Line.LinePattern);let u=p.width,g=p.height;i.SetSize(u,g),i.SetPos(this.Frame.x,this.Frame.y),o.SetSize(u,g);let y=[];if(h)o.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y);else{if(y=this.GetLineShapePolyPoints(me.Common.MaxPolyPoints,!0),0!==this.hoplist.nhops){let t=ye.opt.InsertHops(this,y,y.length);y=y.slice(0,t.npts)}o.SetPoints(y)}return o.SetFillColor("none"),o.SetStrokeColor(s),o.SetStrokeOpacity(r),o.SetStrokeWidth(a),0!==l&&o.SetStrokePattern(l),c.SetSize(u,g),h?c.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):c.SetPoints(y),c.SetStrokeColor("white"),c.SetFillColor("none"),c.SetOpacity(0),e?c.SetEventBehavior(me.EventBehavior.HiddenOut):c.SetEventBehavior(me.EventBehavior.None),c.SetStrokeWidth(a+me.Common.Slop),i.AddElement(o),i.AddElement(c),this.ApplyStyles(o,d),this.ApplyEffects(i,!1,!0),i.isShape=!0,this.AddIcons(t,i),F.Debug("S.Line - Output:",i),i}SetCursors(){let t;F.Debug("S.Line - Input:",{crtOpt:ye.opt.crtOpt});const e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);ye.opt.crtOpt===me.OptTypes.AddCorner?(t=e.GetElementById(me.SVGElementClass.Slop),t&&t.SetCursor(ze.CursorType.Cross)):this.BaseDrawingObjectSetCursors(),F.Debug("S.Line - Output:",{shapeElement:t})}BaseDrawingObjectSetCursors(){F.Debug("S.Line - Input:",{BlockID:this.BlockID,flags:this.flags});const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);let e=!1;if(!(this.flags&Se.ObjFlags.Lock)&&t)if(Ps.GetEditMode()===Se.EditState.Default){const i=t.GetElementById(me.SVGElementClass.Shape);i&&(this.objecttype===Se.FNObjectTypes.FrameContainer?i.SetCursor(ze.CursorType.Default):i.SetCursor(ze.CursorType.Add));const o=t.GetElementById(me.ShapeIconType.HyperLink);o&&o.SetCursor(ze.CursorType.Pointer);const n=t.GetElementById(me.ShapeIconType.Notes);n&&n.SetCursor(ze.CursorType.Pointer);const s=t.GetElementById(me.ShapeIconType.ExpandedView);s&&s.SetCursor(ze.CursorType.Pointer);const a=t.GetElementById(me.ShapeIconType.Comment);a&&a.SetCursor(ze.CursorType.Pointer);const r=t.GetElementById(me.ShapeIconType.Attachment);r&&r.SetCursor(ze.CursorType.Pointer);const l=t.GetElementById(me.ShapeIconType.FieldData);l&&l.SetCursor(ze.CursorType.Pointer);const h=t.GetElementById(me.SVGElementClass.Slop);h&&h.SetCursor(ze.CursorType.Add);const c=ye.opt.svgDoc.GetActiveEdit();if(this.DataID&&this.DataID>=0&&t.textElem&&(t.textElem===c?(i.SetCursor(ze.CursorType.Text),t.textElem.SetCursorState(ze.CursorState.EditLink)):t.textElem.SetCursorState(ze.CursorState.LinkOnly)),this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select&&this.IsSelected()){const o=t.GetElementListWithId(me.SVGElementClass.DimText);for(let t=0;t<o.length;t++)o[t].SetCursorState(ze.CursorState.EditOnly),o[t]===c&&(e=!0);e&&(i.SetCursor(null),h&&h.SetCursor(null))}}else this.ClearCursors();F.Debug("S.Line - Output:",{shapeContainer:t,isDimensionTextActive:e})}AdjustLineStart(t,e,i,o,n,s){F.Debug("S.Line - Input:",{svgContainer:t,startX:e,startY:i,endX:o,endY:n,enforceMinimum:s});let a=[],r=t.GetElementById(me.SVGElementClass.Shape),l=t.GetElementById(me.SVGElementClass.Slop);this.StartPoint.x=e,this.StartPoint.y=i,s||this.EnforceMinimum(!0);let h=!1;ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0&&(h=!0),n&&(h=!0),h||this.AdjustForLineAngleSnap(this.EndPoint,this.StartPoint),this.CalcFrame(),t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(this.Frame.x,this.Frame.y),r.SetSize(this.Frame.width,this.Frame.height);let c=[],p=(0===this.ShortRef||this.ShortRef==me.LineTypes.LsMeasuringTape)&&0===this.hoplist.nhops;p?r.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):(c=this.GetLineShapePolyPoints(me.Common.MaxPolyPoints,!0),r.SetPoints(c)),l.SetSize(this.Frame.width,this.Frame.height),p?l.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):l.SetPoints(c),this.CalcFrame(),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(this.Frame.x,this.Frame.y),r.SetSize(this.Frame.width,this.Frame.height),p?r.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):(c=this.GetLineShapePolyPoints(me.Common.MaxPolyPoints,!0),r.SetPoints(c)),l.SetSize(this.Frame.width,this.Frame.height),p?l.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):l.SetPoints(c),this.UpdateDimensionLines(t),new Ke;let d=ve.Pt2Rect(this.StartPoint,this.EndPoint);a.push(new De(this.StartPoint.x-d.x,this.StartPoint.y-d.y)),a.push(new De(this.EndPoint.x-d.x,this.EndPoint.y-d.y));let u=a[0].x-a[1].x,g=a[0].y-a[1].y;ve.Sqrt(u*u+g*g),Ts.UpdateDisplayCoordinates(this.Frame,this.StartPoint,ze.CursorTypes.Grow,this),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),F.Debug("S.Line - Output:",{shapeElement:r,slopElement:l,points:a})}AdjustLineEnd(t,e,i,o,n){F.Debug("S.Connector - Input:",{svgContainer:t,newEndPointX:e,newEndPointY:i,unusedParam:o,forceAngleSnap:n});let s,a,r=[];t&&(s=t.GetElementById(me.SVGElementClass.Shape),a=t.GetElementById(me.SVGElementClass.Slop)),this.EndPoint.x=e,this.EndPoint.y=i,this.EnforceMinimum(!1);const l=ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0;if((n||l)&&this.AdjustForLineAngleSnap(this.StartPoint,this.EndPoint),this.CalcFrame(),t){t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(this.Frame.x,this.Frame.y),s.SetSize(this.Frame.width,this.Frame.height);let e=[];const i=(0===this.ShortRef||this.ShortRef===me.LineTypes.LsMeasuringTape)&&0===this.hoplist.nhops;i?s.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):(e=this.GetLineShapePolyPoints(me.Common.MaxPolyPoints,!0),s.SetPoints(e)),a.SetSize(this.Frame.width,this.Frame.height),i?a.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):a.SetPoints(e),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),this.CalcFrame(),t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(this.Frame.x,this.Frame.y),s.SetSize(this.Frame.width,this.Frame.height),i?s.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):(e=this.GetLineShapePolyPoints(me.Common.MaxPolyPoints,!0),s.SetPoints(e)),a.SetSize(this.Frame.width,this.Frame.height),i?a.SetPoints(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y,this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y):a.SetPoints(e),this.UpdateDimensionLines(t),new Ke;const o=ve.Pt2Rect(this.StartPoint,this.EndPoint);r.push(new De(this.StartPoint.x-o.x,this.StartPoint.y-o.y)),r.push(new De(this.EndPoint.x-o.x,this.EndPoint.y-o.y));const n=r[0].x-r[1].x,l=r[0].y-r[1].y;ve.Sqrt(n*n+l*l);const h=Oe.DeepCopy(this.EndPoint);if(Ts.UpdateDisplayCoordinates(this.Frame,h,ze.CursorTypes.Grow,this),ye.opt.header.flags&me.HeaderFlags.NoAuto&&(h.x!==this.EndPoint.x||h.y!==this.EndPoint.y)){const t=new Error("bounds error");throw t.name="1",t}-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)}F.Debug("S.Connector - Output:",{shapeElement:t?t.GetElementById(me.SVGElementClass.Shape):null,slopElement:t?t.GetElementById(me.SVGElementClass.Slop):null})}Flip(t){let e;F.Debug("S.Line - Input:",{flipFlags:t});let i=!1;if(ye.opt.ob=Oe.DeepCopy(this),t&me.ExtraFlags.FlipVert&&(e=this.StartPoint.y,this.StartPoint.y=this.EndPoint.y,this.EndPoint.y=e,i=!0),t&me.ExtraFlags.FlipHoriz&&(e=this.StartPoint.x,this.StartPoint.x=this.EndPoint.x,this.EndPoint.x=e,i=!0),i){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.UpdateDimensionLines(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),ye.opt.ob.Frame&&Yo.MaintainLink(this.BlockID,this,ye.opt.ob,me.ActionTriggerType.Rotate),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move)}ye.opt.ob={},F.Debug("S.Line - Output:",{swapped:i})}AddCorner(t,e){F.Debug("S.Line - Input:",{event:t,point:e});let i,o=[],n=[],s=!1;ye.opt.ob=Oe.DeepCopy(this),o=[{x:this.StartPoint.x,y:this.StartPoint.y},{x:this.EndPoint.x,y:this.EndPoint.y}],o.push(new De(e.x,e.y)),i=360-Oe.CalcAngleFromPoints(o[0],o[1]),i>=360&&(i-=360);const a=2*Math.PI*(i/360);if(si.RotatePointsAboutCenter(this.Frame,-a,o),Math.abs(o[1].y-o[2].y)<=this.StyleRecord.Line.Thickness){o[2].y=o[0].y,Math.abs(o[1].x-o[2].x)>Math.abs(o[0].x-o[2].x)&&(s=!0);const t=i>=0&&i<=180?50:-50;o.push(new De(o[2].x,o[2].y+t)),si.RotatePointsAboutCenter(this.Frame,a,o),n.push(new De(o[2].x,o[2].y)),n.push(new De(o[3].x,o[3].y)),s?(this.StartPoint.x=n[0].x,this.StartPoint.y=n[0].y):(this.EndPoint.x=n[0].x,this.EndPoint.y=n[0].y),this.CalcFrame(),Yo.MaintainLink(this.BlockID,this,ye.opt.ob,me.ActionTriggerType.ModifyShape),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move|Ee.LinkFlags.Change),ye.opt.UpdateLinks();const e={StartPoint:{x:n[0].x,y:n[0].y},EndPoint:{x:n[1].x,y:n[1].y},Dimensions:this.Dimensions,TextFlags:this.TextFlags,objecttype:this.objecttype,StyleRecord:Oe.DeepCopy(this.StyleRecord)},r=new we.Shape.Line(e),l=xs.AddNewObject(r,!1,!0),h=s?en.PolyLJoin(l,me.HookPts.KTL,this.BlockID,me.HookPts.KTL,!1):en.PolyLJoin(l,me.HookPts.KTL,this.BlockID,me.HookPts.KTR,!1),c=ws.GetObjectPtr(h,!1),p=ye.opt.svgObjectLayer.GetElementById(h);let d=Number(ye.docUtil.rulerConfig.majorScale).toString();switch(ye.docUtil.rulerConfig.units){case Se.RulerUnit.Feet:this.Dimensions&Se.DimensionFlags.ShowFeetAsInches?d=12*ye.docUtil.rulerConfig.majorScale+'"':d+="'";break;case Se.RulerUnit.Inches:d+='"'}c.UpdateDimensionFromText(p,d,{segment:2}),ws.AddToDirtyList(this.BlockID),xs.CompleteOperation()}F.Debug("S.Line - Output:",{newPoints:o,tempPoints:n,isStartPoint:s})}UseEdges(t,e,i,o,n,s){F.Debug("S.Line - Input:",{enableX:t,enableY:e,alignX:i,alignY:o,startPoint:n,endPoint:s});let a=0,r=0,l=0,h=0,c=0,p=0,d=!1;if(n.x!==s.x)if(t&&i)ve.IsEqual(this.StartPoint.y,this.EndPoint.y)&&(a=s.x-n.x,d=!0);else{const t=this.Frame.x+this.Frame.width/2;Math.abs(t-n.x/2)<100?(c=(s.x-n.x)/2,d=!0):this.Frame.x>n.x/2&&(c=s.x-n.x,d=!0)}if(n.y!==s.y)if(e&&o)ve.IsEqual(this.StartPoint.x,this.EndPoint.x)&&(r=s.y-n.y,d=!0);else{const t=this.Frame.y+this.Frame.height/2;Math.abs(t-n.y/2)<100?(p=(s.y-n.y)/2,d=!0):this.Frame.y>n.y/2&&(p=s.y-n.y,d=!0)}return d&&(ws.GetObjectPtr(this.BlockID,!0),(c||p)&&this.OffsetShape(c,p),(a||r)&&(a&&(l=this.Frame.width+a),r&&(h=this.Frame.height+r),this.SetSize(l,h,0)),ws.AddToDirtyList(this.BlockID)),F.Debug("S.Line - Output:",{offsetX:a,offsetY:r,newWidth:l,newHeight:h,deltaX:c,deltaY:p,shouldAdjust:d}),d}}class ls{constructor(){a(this,"addingWalls")}AllowActionButtons(t){F.Debug("= U.WallUtil AllowActionButtons input:",t);return F.Debug("= U.WallUtil AllowActionButtons output:",null),null}ShapeSaveData(t,e){F.Debug("= U.WallUtil ShapeSaveData input:",{shapeObject:t,targetData:e}),F.Debug("= U.WallUtil ShapeSaveData completed")}AddWall(t,e){let i;F.Debug("= U.WallUtil AddWall input:",{event:t,additionalData:e});const o=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;o.def.wallThickness=8.33325;const n=Oe.DeepCopy(o.def.style),s=ye.opt.GetDrawingScale(ye.docUtil.rulerConfig);ye.docUtil.rulerConfig.useInches?o.def.wallThickness>0?n.Line.Thickness=o.def.wallThickness:(i=48,n.Line.Thickness=8.33333*i/s):o.def.wallThickness>0?n.Line.Thickness=o.def.wallThickness:(i=50,n.Line.Thickness=11.811023622047243*i/s),n.Line.BThick=n.Line.Thickness/2,n.Line.LinePattern=0,n.Line.Paint.Color="#000000",F.Debug("= WallOpt AddWall o",n);const a=o.dimensions,r=ve.SetFlag(a,Se.DimensionFlags.Area,!1),l={Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StyleRecord:n,bOverrideDefaultStyleOnDraw:!0,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:!1,Dimensions:r,TextFlags:Se.TextFlags.HorizText|Se.TextFlags.None,objecttype:Se.FNObjectTypes.FlWall},h=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),c=Oe.DeepCopy(h),p=new rs(l);xs.DrawNewObject(p,!0),Ps.SetEditMode(Se.EditState.Edit),Qo.SelectObjects(c,!1,!1),F.Debug("= U.WallUtil AddWall output:",{wallLine:p})}StopAddingWalls(t){F.Debug("= U.WallUtil StopAddingWalls input:",t);const e=me.OptTypes;if(this.IsAddingWalls()){this.ToggleAddingWalls();let t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);t&&t.length>0?(xs.ResetObjectDraw(),ye.wallOpt.PostObjectDrawHook()):Ps.CancelOperation(),Ps.SetEditMode(Se.EditState.Default);let e=[];t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),t&&t.length>0&&(e=Oe.DeepCopy(t),Qo.SelectObjects(e))}else if(ye.opt.crtOpt===e.AddCorner)ye.wallOpt.AddCornerCancel();else Ps.CancelOperation();F.Debug("= U.WallUtil StopAddingWalls output: completed")}CancelObjectDraw(){F.Debug("= U.WallUtil CancelObjectDraw input: none"),this.StopAddingWalls(),F.Debug("= U.WallUtil CancelObjectDraw output: completed")}ToggleAddingWalls(t){F.Debug("= U.WallUtil ToggleAddingWalls input:",t),this.addingWalls=void 0!==t?t:!this.addingWalls,F.Debug("= U.WallUtil ToggleAddingWalls output:",this.addingWalls)}IsAddingWalls(){F.Debug("= U.WallUtil IsAddingWalls input: none");const t=this.addingWalls;return F.Debug("= U.WallUtil IsAddingWalls output:",t),t}AddNewPolyLine(t,e){if(F.Debug("= U.WallUtil AddNewPolyLine input:",{objectType:t,parameters:e}),t!==Se.FNObjectTypes.FlWall)return F.Debug("= U.WallUtil AddNewPolyLine output: null"),null;const i=new as(e);return F.Debug("= U.WallUtil AddNewPolyLine output:",i),i}AddCornerCancel(){F.Debug("= U.WallUtil AddCornerCancel input: none"),Ps.SetEditMode(Se.EditState.Default),Ps.CancelOperation(),xs.ResetObjectDraw(),ye.wallOpt.PostObjectDrawHook(),Ps.SetEditMode(Se.EditState.Default),F.Debug("= U.WallUtil AddCornerCancel output: completed")}AddCorner(t){F.Debug("= U.WallUtil AddCorner input:",t);try{let e,i,o;t.stopPropagation(),t.preventDefault(),t.gesture?(e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),o=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget),i=o.GetID()):(e=Oe.DeepCopy(ye.opt.rClickParam.hitPoint),i=ye.opt.rClickParam.targetId,o=ye.opt.svgObjectLayer.GetElementById(i));const n=ws.GetObjectPtr(i,!0);return n&&"function"==typeof n.AddCorner&&n.AddCorner(o,e),Ps.SetEditMode(Se.EditState.Default),Ps.CancelOperation(),xs.ResetObjectDraw(),ye.wallOpt.PostObjectDrawHook(),Ps.SetEditMode(Se.EditState.Default),F.Debug("= U.WallUtil AddCorner output: false"),!1}catch(e){throw ye.opt.ExceptionCleanup(e),e}}AddCornerStart(t){F.Debug("= U.WallUtil AddCornerStart input:",t),this.StopAddingWalls(),ye.opt.CloseEdit(),Ps.CancelOperation(),Ps.SetEditMode(Se.EditState.Edit);const e=vs.ActiveVisibleZList();for(let i=0;i<e.length;i++){const t=e[i],o=ws.GetObjectPtr(t,!1);o.flags&Se.ObjFlags.Lock||o.objecttype===Se.FNObjectTypes.FlWall&&ye.opt.svgObjectLayer.GetElementById(t).svgObj.SDGObj.GetEventProxy().on("dragstart",this.AddCorner)}Ts.SetModalOperation(me.OptTypes.AddCorner),F.Debug("= U.WallUtil AddCornerStart output: completed")}PostObjectDrawHook(t){F.Debug("= U.WallUtil PostObjectDrawHook input:",t),this.addingWalls&&(t===es.prototype.LMDrawRelease?this.AddWall():this.StopAddingWalls()),F.Debug("= U.WallUtil PostObjectDrawHook output: completed")}NotifySetEditMode(t){if(F.Debug("= U.WallUtil NotifySetEditMode input:",t),t===Se.EditState.Edit||t===Se.EditState.Default||t===Se.EditState.LinkConnect||t===Se.EditState.LinkJoin)return F.Debug("= U.WallUtil NotifySetEditMode output:",!1),!1;this.addingWalls&&this.StopAddingWalls(),F.Debug("= U.WallUtil NotifySetEditMode output: completed")}AlwaysShowLayers(){F.Debug("= U.WallUtil AlwaysShowLayers input: none");return F.Debug("= U.WallUtil AlwaysShowLayers output:",true),true}EnsureCubicleBehindOutline(t){F.Debug("= U.WallUtil EnsureCubicleBehindOutline input:",t);const e=vs.ActiveVisibleZList();let i=null;const o=ws.GetObjectPtr(t,!1);function n(t,e){const i=e.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);let o=!1;for(let a=0;a<i.length;a++){const e=new Wo(-1,0,null);if(e.hitcode=t.Hit(i[a],!1,!0,e),e&&e.hitcode===Se.HitCodes.Border){o=!0;break}}if(!o)return!1;const n=ve.IntersectRect(t.Frame,e.Frame);if(!n)return!1;const s=e.Frame;return!(Math.abs(n.x-s.x)>1e-4||Math.abs(n.y-s.y)>1e-4||Math.abs(n.width-s.width)>1e-4||Math.abs(n.height-s.height)>1e-4)}if(o instanceof as)for(let s=0;s<e.length;s++){const a=e[s];if(t!==a&&(i=ws.GetObjectPtr(a,!1),i instanceof as&&n(i,o))){const t=e.indexOf(o.BlockID);if(t<0)return;if(t<s)return;return void ye.opt.PutBehindObject(i.BlockID,o.BlockID)}}F.Debug("= U.WallUtil EnsureCubicleBehindOutline output: completed")}AllowAutoInsert(){F.Debug("= U.WallUtil AllowAutoInsert input: none");return F.Debug("= U.WallUtil AllowAutoInsert output:",false),false}GetAutomationContext(){F.Debug("= U.WallUtil GetAutomationContext input: none");const t=Xe.Contexts.WallOpt;return F.Debug("= U.WallUtil GetAutomationContext output:",t),t}}class hs{constructor(){}static generateParallelogram(t,e){let i=e/t.width;return i>1&&(i=1),[{x:i,y:0},{x:1,y:0},{x:1-i,y:1},{x:0,y:1},{x:i,y:0}]}static generateDiamond(t,e){return[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5},{x:.5,y:0}]}static generateDocument(t,e){const i=[],o=t.width,n=t.height,s=e;i.push({x:0,y:(n-s)/n}),i.push({x:0,y:(n-s)/n}),i.length=85,i[84]={x:0,y:(n-s)/n},i[1]={x:0,y:0},i[2]={x:1,y:0},i[3]={x:1,y:(n-s-0)/n};const a=o/4,r=s,l=2*a/40;for(let h=1;h<=40;h++){let t=l*h,e=o-t,c=(a-t)/a,p=n-s-0-Math.sqrt(1-c*c)*r;i[h+3]={x:e/o,y:p/n}}for(let h=1;h<=40;h++){let t=l*h,e=o-(t+2*a),c=(a-t)/a,p=n-s+Math.sqrt(1-c*c)*r;i[h+43]={x:e/o,y:p/n}}return i}static generateTerminal(t,e){let i=[];const o=t.width,n=t.height;let s,a;return s=Math.floor(n/2),s>o/2&&(s=Math.floor(o/2)),a={left:0,top:0,right:s,bottom:2*s},i=ve.PolyYCurve(i,a,40,0,0,0,s,!0,o,n),a={left:0,top:n-2*s,right:s,bottom:n},i=ve.PolyYCurve(i,a,40,0,0,s,0,!0,o,n),a={left:o-s,top:n,right:o,bottom:n-2*s},i=ve.PolyYCurve(i,a,40,0,0,0,-s,!1,o,n),a={left:o-s,top:2*s,right:o,bottom:0},i=ve.PolyYCurve(i,a,40,0,0,-s,0,!1,o,n),i.push(new De(i[0].x,i[0].y)),i}static generateRightArrow(t,e){let i=e/t.width;return i>1&&(i=1),[{x:0,y:.15},{x:1-i,y:.15},{x:1-i,y:0},{x:1,y:.5},{x:1-i,y:1},{x:1-i,y:.85},{x:0,y:.85},{x:0,y:.15}]}static generateLeftArrow(t,e){let i=e/t.width;return i>1&&(i=1),[{x:0,y:.5},{x:i,y:0},{x:i,y:.15},{x:1,y:.15},{x:1,y:.85},{x:i,y:.85},{x:i,y:1},{x:0,y:.5}]}static generateTopArrow(t,e){let i=e/t.height;return i>1&&(i=1),[{x:.5,y:0},{x:0,y:i},{x:.15,y:i},{x:.15,y:1},{x:.85,y:1},{x:.85,y:i},{x:1,y:i},{x:.5,y:0}]}static generateBottomArrow(t,e){let i=e/t.height;return i>1&&(i=1),[{x:.15,y:0},{x:.15,y:1-i},{x:0,y:1-i},{x:.5,y:1},{x:1,y:1-i},{x:.85,y:1-i},{x:.85,y:0},{x:.15,y:0}]}static generateTriangle(t,e){return[{x:.5,y:0},{x:1,y:1},{x:0,y:1},{x:.5,y:0}]}static generateTriangleDown(t,e){return[{x:0,y:0},{x:1,y:0},{x:.5,y:1},{x:0,y:0}]}static generateInput(t,e){let i=e/t.height;return i>1&&(i=1),[{x:0,y:i},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:i}]}static generateTrapezoid(t,e){let i=e/t.width;return i>.5&&(i=.5),[{x:i,y:0},{x:1-i,y:0},{x:1,y:1},{x:0,y:1},{x:i,y:0}]}static generateTrapezoidDown(t,e){let i=e/t.width;return i>.5&&(i=.5),[{x:0,y:0},{x:1,y:0},{x:1-i,y:1},{x:i,y:1},{x:0,y:0}]}static generateOctagon(t,e,i){return[{x:e,y:0},{x:1-e,y:0},{x:1,y:i},{x:1,y:1-i},{x:1-e,y:1},{x:e,y:1},{x:0,y:1-i},{x:0,y:i},{x:e,y:0}]}static generateStorage(t,e,i){let o=[];const n=t.width,s=t.height,a=e,r={x:a/n,y:1};o.push(r);let l={left:0,top:0,right:a,bottom:s};o.length=42,o=ve.PolyYCurve(o,l,40,0,0,0,0,!0,n,s);for(let h=0;h<40;h++)o[40-h]=o[42+h];return o[41]={x:a/n,y:0},o[42]={x:1,y:0},l={left:n-a,top:0,right:n,bottom:s},a?(l.left-=0,l.right-=0,o.length=43,o=ve.PolyYCurve(o,l,40,0,0,0,0,!0,n,s),o.push({x:1,y:1})):(l.top+=0,l.bottom-=0,o=ve.PolyYCurve(o,l,40,0,0,0,0,!0,n,s),o.push({x:1,y:(s-0)/s}),o.push({x:1,y:1})),o}static generateHexagon(t,e){let i=e/t.width;return i>.5&&(i=.5),[{x:i,y:0},{x:1-i,y:0},{x:1,y:.5},{x:1-i,y:1},{x:i,y:1},{x:0,y:.5},{x:i,y:0}]}static generatePentagon(t,e){let i=e/t.height;return i>1&&(i=1),[{x:0,y:1-i},{x:0,y:0},{x:1,y:0},{x:1,y:1-i},{x:.5,y:1},{x:0,y:1-i}]}static generatePentagonLeft(t,e){let i=e/t.width;return i>1&&(i=1),[{x:i,y:0},{x:1,y:0},{x:1,y:1},{x:i,y:1},{x:0,y:.5},{x:i,y:0}]}static generateDelay(t,e){let i=[];const o=t.width,n=t.height,s=e;i[0]={x:0,y:1},i[1]={x:0,y:0},i[2]={x:(o-s)/o,y:0};const a={left:o-s,top:0,right:o,bottom:n};return i=ve.PolyYCurve(i,a,80,0,0,0,0,!1,o,n),i.push({x:(o-s)/o,y:1}),i}static generateDisplay(t,e){let i=[];const o=t.width,n=t.height,s=e;i[0]={x:s/o,y:1},i[1]={x:0,y:.5},i[2]={x:s/o,y:0},i[3]={x:(o-s)/o,y:0};const a={left:o-s,top:0,right:o,bottom:n};return i=ve.PolyYCurve(i,a,80,0,0,0,0,!1,o,n),i.push({x:(o-s)/o,y:1}),i.push({x:s/o,y:1}),i}}class cs extends Zn{constructor(t){F.Debug("S.Polygon: Constructor input:",t),(t=t||{}).ShapeType=me.ShapeType.Polygon,super(t),a(this,"VertexArray"),a(this,"FixedPoint"),a(this,"LineOrientation"),a(this,"hoplist"),a(this,"ArrowheadData"),this.VertexArray=t.VertexArray||[],this.FixedPoint=t.FixedPoint||[0,0],this.LineOrientation=t.LineOrientation||me.LineOrientation.None,this.hoplist=t.hoplist||{nhops:0,hops:[]},this.ArrowheadData=t.ArrowheadData||[],this.dataclass=tn.ShapeTypes.POLYGON,F.Debug("S.Polygon: Constructor output:",this)}ScaleGeometries(t,e,i,o){F.Debug("S.Polygon: scaleGeometries input:",{svgDoc:t,points:e,width:i,height:o});let n=null,s=null,a=null,r=null,l=null,h=0;const c=this.Geometries.length;for(let p=0;p<c;p++){const c=this.Geometries[p];if(n!==c.shapeid&&(s&&s.Apply(),a=t.GetElementById(me.SVGElementClass.Shape,c.shapeid),n=c.shapeid,a&&(a.SetSize(i,o),s=a.PathCreator(),s.BeginPath())),!c.NoFill||0===c.MoveTo.length){let t=e[c.Offset];s.MoveTo(t.x,t.y);for(let i=1;i<c.NPoints;i++)t=e[c.Offset+i],s.LineTo(t.x,t.y)}if(c.Closed&&s.ClosePath(),c.MoveTo.length>0){const s=`${n}.${h}`;if(h++,l=t.GetElementById(me.SVGElementClass.Shape,s),!l)continue;l.SetSize(i,o),r=l.PathCreator(),r.BeginPath();let a=0,p=1,d=e[c.Offset];for(;a<=c.MoveTo.length;){r.MoveTo(d.x,d.y);const t=a<c.MoveTo.length?c.MoveTo[a]:c.NPoints;for(let i=p;i<t;i++)d=e[c.Offset+i],r.LineTo(d.x,d.y);a++,a<c.MoveTo.length&&(d=e[c.MoveTo[a-1]+c.Offset],p=a<c.MoveTo.length?c.MoveTo[a]:c.NPoints)}r.Apply()}}s&&s.Apply(),F.Debug("S.Polygon: scaleGeometries output:",{svgDoc:t,points:e,width:i,height:o})}CreateShape(t,e){if(F.Debug("S.Polygon: CreateShape input:",{svgDoc:t,isInteractive:e}),this.flags&Se.ObjFlags.NotVisible)return F.Debug("S.Polygon: CreateShape output: null (not visible)"),null;const i=t.CreateShape(me.CSType.ShapeContainer);let o=t.CreateShape(me.CSType.Polygon);o.SetID(me.SVGElementClass.Shape);const n=Oe.DeepCopy(this.Frame);let s=this.StyleRecord;s.Line.BThick&&null==this.polylist&&ve.InflateRect(n,s.Line.BThick,s.Line.BThick),s=this.SVGTokenizerHook(s);const a=s.Line.Paint.Color;s.Line.Paint.Opacity;const r=s.Line.Thickness,l=s.Line.LinePattern;this.GetFieldDataStyleOverride();const h=n.width,c=n.height;i.SetSize(h,c),i.SetPos(n.x,n.y),o.SetSize(h,c);const p=this.VertexArray,d=p.length,u=[];for(let S=0;S<d;++S){const t=p[S];u.push({x:t.x*h,y:t.y*c})}if(this.Geometries&&this.Geometries.length){let e=1,o=0;const n=this.Geometries.length;let p=t.CreateShape(me.CSType.Path);p.SetID(me.SVGElementClass.Shape),p.SetUserData(e),p.SetSize(h,c);let d=p.PathCreator();d.BeginPath();let g=this.Geometries[0].NoFill,y=this.Geometries[0].NoLine||this.Geometries[0].MoveTo.length>0;for(let s=0;s<n;s++){const n=this.Geometries[s];if(n.NoFill===g&&(n.NoLine||n.MoveTo.length>0)===y||(d&&1===d.pathSegs.length&&"z"===d.pathSegs[0]?d=null:d&&d.Apply(),y?p.SetStrokeWidth(0):(p.SetStrokeColor(a),p.SetStrokeWidth(r),0!==l&&p.SetStrokePattern(l)),i.AddElement(p),p=t.CreateShape(me.CSType.Path),p.SetID(me.SVGElementClass.Shape),e++,p.SetUserData(e),p.SetSize(h,c),d=p.PathCreator(),d.BeginPath(),g=n.NoFill,y=n.NoLine||n.MoveTo.length>0),!g||0===n.MoveTo.length){const t=u[n.Offset];d.MoveTo(t.x,t.y);for(let e=1;e<n.NPoints;e++){const t=u[n.Offset+e];d.LineTo(t.x,t.y)}}if(n.Closed&&d.ClosePath(),n.MoveTo.length>0){const s=t.CreateShape(me.CSType.Path);s.SetID(me.SVGElementClass.Shape);const a=e+"."+o;o++,s.SetUserData(a),s.SetSize(h,c);const r=s.PathCreator();r.BeginPath();let l=0,p=1,d=u[n.Offset];for(;l<=n.MoveTo.length;){r.MoveTo(d.x,d.y);const t=l<n.MoveTo.length?n.MoveTo[l]:n.NPoints;for(let e=p;e<t;e++)d=u[n.Offset+e],r.LineTo(d.x,d.y);l++,l<n.MoveTo.length&&(d=u[n.MoveTo[l-1]+n.Offset],p=l<n.MoveTo.length?n.MoveTo[l]:n.NPoints)}r.Apply(),i.AddElement(s)}}d&&d.Apply(),y?p.SetStrokeWidth(0):(p.SetStrokeColor(a),p.SetStrokeWidth(r),0!==l&&p.SetStrokePattern(l)),i.AddElement(p),g?p.SetFillColor("none"):this.ApplyStyles(p,s)}else o.SetPoints(u),o.SetStrokeColor(a),o.SetStrokeWidth(r),0!==l&&o.SetStrokePattern(l),i.AddElement(o),this.ApplyStyles(o,s);this.ApplyEffects(i,!1,!1);const g=t.CreateShape(me.CSType.Polygon);g.SetPoints(u),g.SetStrokeColor("white"),g.SetFillColor("none"),g.SetOpacity(0),g.SetStrokeWidth(r+me.Common.Slop),e?g.SetEventBehavior(me.EventBehavior.HiddenOut):g.SetEventBehavior(me.EventBehavior.None),g.SetID(me.SVGElementClass.Slop),g.ExcludeFromExport(!0),g.SetSize(h,c),i.AddElement(g);const y=s.Fill.Hatch;if(y&&0!==y){const e=t.CreateShape(me.CSType.Polygon);e.SetPoints(u),e.SetID(me.SVGElementClass.Hatch),e.SetSize(h,c),e.SetStrokeWidth(0),this.SetFillHatch(e,y),i.AddElement(e)}return i.isShape=!0,this.DataID>=0&&this.LMAddSVGTextObject(t,i),F.Debug("S.Polygon: CreateShape output:",i),i}Resize(t,e,i,o){if(F.Debug("S.Polygon: Resize input:",{svgDoc:t,newSize:e,actionTriggerType:i,prevBBox:o}),null!=t){const o=t.GetRotation(),n=Oe.DeepCopy(this.prevBBox),s=Oe.DeepCopy(e),a=Oe.DeepCopy(e),r=ye.opt.svgDoc.CalculateRotatedOffsetForResize(n,s,o);if(this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(a,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),i!==me.ActionTriggerType.MovePolySeg){t.SetSize(a.width,a.height),t.SetPos(a.x+r.x,a.y+r.y);const i=t.GetElementById(me.SVGElementClass.Shape),o=this.RegenerateVectors(a.width,a.height);o&&(this.VertexArray=o);const n=this.VertexArray.map((t=>({x:t.x*a.width,y:t.y*a.height})));this.Geometries&&this.Geometries.length?this.ScaleGeometries(t,n,a.width,a.height):(i.SetPoints(n),i.SetSize(a.width,a.height));const s=t.GetElementById(me.SVGElementClass.Slop);s&&(s.SetPoints(n),s.SetSize(a.width,a.height));const l=t.GetElementById(me.SVGElementClass.Hatch);l&&(l.SetPoints(n),l.SetSize(e.width,e.height))}return this.LMResizeSVGTextObject(t,i,e),t.SetRotation(o),this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(e,null,null,this),F.Debug("S.Polygon: Resize output:",r),r}}ResizeInTextEdit(t,e){F.Debug("S.Polygon: ResizeInTextEdit input:",{svgDoc:t,newSize:e});const i=t.GetRotation();this.SetDimensionLinesVisibility(t,!1);const o=Oe.DeepCopy(this.Frame),n=Oe.DeepCopy(e),s=Oe.DeepCopy(e),a=ye.opt.svgDoc.CalculateRotatedOffsetForResize(o,n,i);this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(s,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),t.SetSize(s.width,s.height),t.SetPos(s.x+a.x,s.y+a.y);const r=t.GetElementById(me.SVGElementClass.Shape),l=this.RegenerateVectors(s.width,s.height);l&&(this.VertexArray=l),this.polylist&&this.ScaleObject(0,0,0,0,0,0);const h=this.VertexArray.map((t=>({x:t.x*s.width,y:t.y*s.height})));r&&(this.Geometries&&this.Geometries.length?this.ScaleGeometries(t,h,s.width,s.height):r.SetPoints(h),r.SetSize(s.width,s.height));const c=t.GetElementById(me.SVGElementClass.Slop);c&&(c.SetPoints(h),c.SetSize(s.width,s.height));const p=t.GetElementById(me.SVGElementClass.Hatch);return p&&(p.SetPoints(h),p.SetSize(e.width,e.height)),t.SetRotation(i),this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(e,null,null,this),F.Debug("S.Polygon: ResizeInTextEdit output:",a),a}GetTargetPoints(t,e,i){F.Debug("S.Polygon: GetTargetPoints input:",{target:t,hookFlags:e,objectID:i});const o=[{x:me.Common.DimMax/2,y:0},{x:me.Common.DimMax,y:me.Common.DimMax/2},{x:me.Common.DimMax/2,y:me.Common.DimMax},{x:0,y:me.Common.DimMax/2}],n=this.flags&Se.ObjFlags.ContConn&&null!==t&&0==(e&Se.HookFlags.LcNoContinuous),s=this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints;if(i>=0&&ws.GetObjectPtr(i,!1),n){const i=this.PolyGetTargets(t,e,this.Frame);return F.Debug("S.Polygon: GetTargetPoints output:",i),i}if(s){const t=s?this.ConnectPoints:ye.opt.TableGetRowConnectPoints(this,table),e=Oe.DeepCopy(t);return F.Debug("S.Polygon: GetTargetPoints output:",e),e}return F.Debug("S.Polygon: GetTargetPoints output:",o),o}ExtendLines(){}GetPerimeterPoints(t,e,i,o,n,s){F.Debug("S.Polygon: GetPerimeterPoints input:",{event:t,pointsArray:e,hookType:i,rotateFlag:o,tableID:n,additionalParams:s});let a,r,l=[],h={},c=[0,0];const p=me.Common.DimMax;if(1===e.length&&e[0].y===-me.AStyles.CoManager&&this.IsCoManager(h))return l.push(new Point(h.x,h.y)),null!=e[0].id&&(l[0].id=e[0].id),F.Debug("S.Polygon: GetPerimeterPoints output:",l),l;if(i===me.HookPts.KAT||i===me.HookPts.KATD)return l=this.BaseDrawingObject_GetPerimPts(t,e,i,!1,n),F.Debug("S.Polygon: GetPerimeterPoints output:",l),l;const d=e.length;if(this.flags&Se.ObjFlags.UseConnect)for(let u=0;u<d;u++)l[u]={x:0,y:0,id:0},l[u].x=e[u].x/p*this.Frame.width+this.Frame.x,l[u].y=e[u].y/p*this.Frame.height+this.Frame.y,null!=e[u].id&&(l[u].id=e[u].id);else{if(this.flags&Se.ObjFlags.ContConn&&!ye.opt.fromOverlayLayer)return l=this.BaseDrawingObject_GetPerimPts(t,e,i,o,n,s),F.Debug("S.Polygon: GetPerimeterPoints output:",l),l;l=this.BaseDrawingObject_GetPerimPts(t,e,i,!0,n,s);const r=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),h=r.length;ve.EqualPt(r[0],r[h-1])||r.push(new Point(r[0].x,r[0].y));for(let t=0;t<d;t++)e[t].x<p/4?(a=en.PolyGetIntersect(r,l[t].y,c,null,!1),a&&(l[t].x=c[0],a>1&&c[1]<l[t].x&&(l[t].x=c[1]))):e[t].x>3*p/4?(a=en.PolyGetIntersect(r,l[t].y,c,null,!1),a&&(l[t].x=c[0],a>1&&c[1]>l[t].x&&(l[t].x=c[1]))):e[t].y<p/4?(a=en.PolyGetIntersect(r,l[t].x,c,null,!0),a&&(l[t].y=c[0],a>1&&c[1]<l[t].y&&(l[t].y=c[1]))):e[t].y>3*p/4&&(a=en.PolyGetIntersect(r,l[t].x,c,null,!0),a&&(l[t].y=c[0],a>1&&c[1]>l[t].y&&(l[t].y=c[1]))),null!=e[t].id&&(l[t].id=e[t].id)}return o||(r=-this.RotationAngle/(180/Se.Geometry.PI),si.RotatePointsAboutCenter(this.Frame,r,l)),F.Debug("S.Polygon: GetPerimeterPoints output:",l),l}BaseDrawingObject_GetPerimPts(t,e,i,o,n,s){F.Debug("S.Polygon: BaseDrawingObject_GetPerimPts input:",{event:t,pointsArray:e,hookType:i,rotateFlag:o,tableID:n,additionalParams:s});const a=[],r=e.length,l=tn.ShapeTypes.TRIANGLE,h=me.Common.DimMax;for(let c=0;c<r;c++){a[c]={x:0,y:0,id:0},a[c].x=e[c].x/h*this.Frame.width+this.Frame.x;const t=this.dataclass===l?h-e[c].y:e[c].y;a[c].y=t/h*this.Frame.height+this.Frame.y,null!=e[c].id&&(a[c].id=e[c].id)}if(!o){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,a)}return F.Debug("S.Polygon: BaseDrawingObject_GetPerimPts output:",a),a}GetPolyPoints(t,e,i,o,n){F.Debug("S.Polygon: GetPolyPoints input:",{numPoints:t,includeFrameOffset:e,inflate:i,adjustForLineThickness:o,additionalParams:n});let s,a,r={},l=[];ve.CopyRect(r,this.Frame);const h=this.StyleRecord.Line.Thickness/2;o&&ve.InflateRect(r,h,h);for(let c=0;c<this.VertexArray.length;++c)s=this.VertexArray[c],a={x:s.x*r.width,y:s.y*r.height},l.push(a);if(!e)for(let c=0;c<l.length;c++)l[c].x+=r.x,l[c].y+=r.y;return F.Debug("S.Polygon: GetPolyPoints output:",l),l}SetShapeIndent(t){F.Debug("S.Polygon: SetShapeIndent input:",{isIndentNeeded:t});let e,i,o=1,n=1,s=1,a=1,r=[],l={};e=this.inside.width,i=this.inside.height,this.NeedsSIndentCount&&(r=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null),l=on.GuessTextIndents(r,this.Frame),this.left_sindent=l.left_sindent,this.right_sindent=l.right_sindent,this.top_sindent=l.top_sindent,this.bottom_sindent=l.bottom_sindent,this.NeedsSIndentCount=!1),t&&(o=1-(this.left_sindent+this.right_sindent),n=1-(this.left_sindent+this.right_sindent),s=1-(this.bottom_sindent+this.top_sindent),a=1-(this.bottom_sindent+this.top_sindent)),this.tindent.left=this.left_sindent*e/o,this.tindent.top=this.top_sindent*i/s,this.tindent.right=this.right_sindent*e/n,this.tindent.bottom=this.bottom_sindent*i/a,F.Debug("S.Polygon: SetShapeIndent output:",{left:this.tindent.left,top:this.tindent.top,right:this.tindent.right,bottom:this.tindent.bottom})}Flip(t){F.Debug("S.Polygon: Flip input:",{flipType:t});let e=!0;const i=tn.ShapeTypes,o=me.Common.DimMax;if(this.VertexArray=$o.FlipVertexArray(this.VertexArray,t),this.polylist&&we.Shape.PolyLine.prototype.Flip.call(this,t),t&me.ExtraFlags.FlipVert&&null!=this.dataclass){switch(this.dataclass){case i.ARROW_TOP:this.dataclass=i.ARROW_BOTTOM;break;case i.ARROW_BOTTOM:this.dataclass=i.ARROW_TOP;break;case i.TRIANGLE:this.dataclass=i.TRIANGLE_BOTTOM;break;case i.TRIANGLE_BOTTOM:this.dataclass=i.TRIANGLE;break;case i.TRAPEZOID:this.dataclass=i.TRAPEZOID_BOTTOM;break;case i.TRAPEZOID_BOTTOM:this.dataclass=i.TRAPEZOID;break;case i.POLYGON:case i.MEASURE_AREA:e=!1;break;default:this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.FlipVert,!(this.extraflags&me.ExtraFlags.FlipVert)),e=!1}if(e&&this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints)for(let t=0;t<this.ConnectPoints.length;t++)this.ConnectPoints[t].y=o-this.ConnectPoints[t].y}if(t&me.ExtraFlags.FlipHoriz&&null!=this.dataclass){switch(this.dataclass){case i.ARROW_LEFT:this.dataclass=i.ARROW_RIGHT;break;case i.ARROW_RIGHT:this.dataclass=i.ARROW_LEFT;break;case i.POLYGON:case i.MEASURE_AREA:e=!1;break;default:this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.FlipHoriz,!(this.extraflags&me.ExtraFlags.FlipHoriz)),e=!1}if(e&&this.flags&Se.ObjFlags.UseConnect&&this.ConnectPoints)for(let t=0;t<this.ConnectPoints.length;t++)this.ConnectPoints[t].x=o-this.ConnectPoints[t].x}Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move|Ee.LinkFlags.Change),this.hooks.length&&Ps.SetLinkFlag(this.hooks[0].objid,Ee.LinkFlags.Move),this.NeedsSIndentCount=!0,this.UpdateFrame(this.Frame),this.Resize(ye.opt.svgObjectLayer.GetElementById(this.BlockID),this.Frame,this),F.Debug("S.Polygon: Flip output:",{flipType:t})}RegenerateVectors(t,e){F.Debug("S.Polygon: RegenerateVectors input:",{width:t,height:e});let i,o,n,s=null,a=this.shapeparam;switch(this.dataclass){case tn.ShapeTypes.PARALLELOGRAM:s=hs.generateParallelogram(this.Frame,a);break;case tn.ShapeTypes.TERMINAL:s=hs.generateTerminal(this.Frame,a);break;case tn.ShapeTypes.PENTAGON:i=t/2,a=t/2*(a/i),s=hs.generatePentagon(this.Frame,a);break;case tn.ShapeTypes.PENTAGON_LEFT:i=e/2,a=e/2*(a/i),s=hs.generatePentagonLeft(this.Frame,a);break;case tn.ShapeTypes.HEXAGON:i=e/2,a=e/2*(a/i),s=hs.generateHexagon(this.Frame,a);break;case tn.ShapeTypes.OCTAGON:o=a*e,n=a*t,o<n&&(n=o),e&&(n=e*(n/e)),a=n/t,o=n/e,s=hs.generateOctagon(this.Frame,a,o);break;case tn.ShapeTypes.ARROW_RIGHT:s=hs.generateRightArrow(this.Frame,a);break;case tn.ShapeTypes.ARROW_LEFT:s=hs.generateLeftArrow(this.Frame,a);break;case tn.ShapeTypes.ARROW_TOP:s=hs.generateTopArrow(this.Frame,a);break;case tn.ShapeTypes.ARROW_BOTTOM:s=hs.generateBottomArrow(this.Frame,a);break;case tn.ShapeTypes.TRAPEZOID:s=hs.generateTrapezoid(this.Frame,a);break;case tn.ShapeTypes.TRAPEZOID_BOTTOM:s=hs.generateTrapezoidDown(this.Frame,a);break;case tn.ShapeTypes.INPUT:s=hs.generateInput(this.Frame,a);break;case tn.ShapeTypes.STORAGE:n=a,s=hs.generateStorage(this.Frame,a,n);break;case tn.ShapeTypes.DELAY:s=hs.generateDelay(this.Frame,a);break;case tn.ShapeTypes.DISPLAY:s=hs.generateDisplay(this.Frame,a)}const r=this.extraflags;return r&(me.ExtraFlags.FlipHoriz|me.ExtraFlags.FlipVert)&&s&&(s=$o.FlipVertexArray(s,r)),F.Debug("S.Polygon: RegenerateVectors output:",s),s}GetParabolaAdjustmentPoint(t,e){F.Debug("S.Polygon: GetParabolaAdjustmentPoint input:",{point:t,adjustment:e});const i=we.Shape.PolyLine.prototype.PrPolyLGetParabolaAdjPoint.call(this,t,e);return F.Debug("S.Polygon: GetParabolaAdjustmentPoint output:",i),i}GetArcParameters(t,e){F.Debug("S.Polygon: GetArcParameters input:",{startPoint:t,endPoint:e});const i=we.Shape.PolyLine.prototype.PrPolyLGetArc.call(this,t,e);return F.Debug("S.Polygon: GetArcParameters output:",i),i}GetParabolaParameters(t,e){F.Debug("S.Polygon: GetParabolaParameters input:",{event:t,target:e});const i=we.Shape.PolyLine.prototype.PrPolyLGetParabolaParam.call(this,t,e);return F.Debug("S.Polygon: GetParabolaParameters output:",i),i}GetArcParameters(t,e,i){F.Debug("S.Polygon: GetArcParameters input:",{event:t,target:e,additionalParams:i});const o=we.Shape.PolyLine.prototype.PrPolyLGetArcParam.call(this,t,e,i);return F.Debug("S.Polygon: GetArcParameters output:",o),o}GetArcQuadrant(t,e,i){F.Debug("S.Polygon: GetArcQuadrant input:",{event:t,target:e,additionalParams:i});const o=we.Shape.PolyLine.prototype.PrPolyLGetArcQuadrant.call(this,t,e,i);return F.Debug("S.Polygon: GetArcQuadrant output:",o),o}ScaleObject(t,e,i,o,n,s,a){F.Debug("S.Polygon: ScaleObject input:",{x:t,y:e,rotation:i,center:o,scaleX:n,scaleY:s,adjustLineThickness:a});let r=Oe.DeepCopy(this.Frame);if(n&&s&&(r.x=t+r.x*n,r.y=e+r.y*s,r.width*=n,r.height*=s),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),i){const t={x:r.x+r.width/2,y:r.y+r.height/2},e=2*Math.PI*(i/360),n=ye.opt.RotatePointAroundPoint(o,t,e);r.x=n.x-r.width/2,r.y=n.y-r.height/2,this.RotationAngle+=i,this.RotationAngle>=360&&(this.RotationAngle-=360)}if(a){let t=n;s>t&&(t=s),this.StyleRecord.Line.Thickness*=t,this.StyleRecord.Line.BThick*=t}this.UpdateFrame(r);const l=this.RegenerateVectors(r.width,r.height);l&&(this.VertexArray=l),this.polylist&&we.Shape.PolyLine.prototype.ScaleObject.call(this,0,0,0,0,0,0),n&&s&&(this.sizedim.width=this.Frame.width,this.sizedim.height=this.Frame.height),F.Debug("S.Polygon: ScaleObject output:",{frameCopy:r,regeneratedVectors:l})}UpdateSecondaryDimensions(t,e,i){F.Debug("S.Polygon: UpdateSecondaryDimensions input:",{svgDoc:t,dimensions:e,polyPoints:i});let o=[],n=0;if((this.Dimensions&Se.DimensionFlags.Always||this.Dimensions&Se.DimensionFlags.Select)&&this.Dimensions&Se.DimensionFlags.ShowLineAngles&&this.polylist){o=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),n=o.length;for(let i=1;i<n;i++)this.DrawDimensionAngle(t,e,i,o)}F.Debug("S.Polygon: UpdateSecondaryDimensions output:",{pointsArray:o,pointsCount:n})}SetSegmentAngle(t,e,i){F.Debug("S.Polygon: SetSegmentAngle input:",{segmentIndex:t,angle:e,additionalParams:i}),ye.opt.ShapeToPolyLine(this.BlockID,!1,!0);ws.GetObjectPtr(this.BlockID,!1).SetSegmentAngle(t,e,i),ye.opt.PolyLineToShape(this.BlockID),F.Debug("S.Polygon: SetSegmentAngle output:",{segmentIndex:t,angle:e,additionalParams:i})}DimensionLineDeflectionAdjust(t,e,i,o,n){if(F.Debug("S.Polygon: DimensionLineDeflectionAdjust input:",{event:t,target:e,angle:i,radius:o,index:n}),!this.polylist){const s=we.Shape.BaseShape.prototype.DimensionLineDeflectionAdjust.call(this,t,e,i,o,n);return F.Debug("S.Polygon: DimensionLineDeflectionAdjust output:",s),s}ye.opt.ShapeToPolyLine(this.BlockID,!1,!0);ws.GetObjectPtr(this.BlockID,!1).DimensionLineDeflectionAdjust(t,e,i,o,n),ye.opt.PolyLineToShape(this.BlockID),F.Debug("S.Polygon: DimensionLineDeflectionAdjust output: completed")}GetDimensionDeflectionValue(t){if(F.Debug("S.Polygon: GetDimensionDeflectionValue input:",{segmentIndex:t}),this.polylist){if(!this.polylist.segs||0===this.polylist.segs.length||t<0||t>=this.polylist.segs.length)return void F.Debug("S.Polygon: GetDimensionDeflectionValue output: undefined");const e=this.polylist.segs[t].dimDeflection;return F.Debug("S.Polygon: GetDimensionDeflectionValue output:",e),e}{const e=we.Shape.BaseShape.prototype.GetDimensionDeflectionValue.call(this,t);return F.Debug("S.Polygon: GetDimensionDeflectionValue output:",e),e}}UpdateDimensionFromTextObj(t,e){let i,o;F.Debug("S.Polygon: UpdateDimensionFromTextObj input:",{textObj:t,textData:e}),ye.stdObj.PreserveBlock(this.BlockID),e?(i=e.text,o=e.userData):(i=t.GetText(),o=t.GetUserData());const n=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(o.angleChange)return this.UpdateLineAngleDimensionFromText(n,i,o),ws.AddToDirtyList(this.BlockID),(this.Frame.x<0||this.Frame.y<0)&&ye.opt.ScrollObjectIntoView(this.BlockID,!1),xs.CompleteOperation(),void F.Debug("S.Polygon: UpdateDimensionFromTextObj output: angleChange handled");this.polylist&&(this.extraflags&me.ExtraFlags.SideKnobs)>0?(ye.opt.ShapeToPolyLine(this.BlockID,!1,!0),ws.GetObjectPtr(this.BlockID,!1).UpdateDimensionFromText(n,i,o),ye.opt.PolyLineToShape(this.BlockID)):we.Shape.BaseShape.prototype.UpdateDimensionFromTextObj.call(this,t,e),F.Debug("S.Polygon: UpdateDimensionFromTextObj output: dimension updated")}GetDimensionPoints(){let t;if(F.Debug("S.Polygon: GetDimensionPoints input"),this.polylist&&(this.extraflags&me.ExtraFlags.SideKnobs)>0){let e=Oe.DeepCopy(this);e=ye.opt.ShapeToPolyLine(this.BlockID,!1,!0,e),t=e.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null)}else t=we.Shape.BaseShape.prototype.GetDimensionPoints.call(this);return F.Debug("S.Polygon: GetDimensionPoints output:",t),t}GetPolyRectangularInfo(){F.Debug("S.Polygon: GetPolyRectangularInfo input");let t,e,i,o=[];if(!this.polylist)return null;if(o=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),5!==this.polylist.segs.length||!this.polylist.closed)return null;let n=[];const s=o.length;for(let p=0;p<s;p++)p<s-1&&o[p].x===o[p+1].x&&o[p].y===o[p+1].y||n.push(o[p]);if(o=n,!ve.IsRectangular(o)||5!==o.length)return null;const a=ve.GetDistanceBetween2Points(o[0],o[1]),r=ve.GetDistanceBetween2Points(o[2],o[3]);if(a/r<=.99||a/r>=1.01)return null;const l=ve.GetDistanceBetween2Points(o[1],o[2]),h=ve.GetDistanceBetween2Points(o[3],o[4]);if(l/h<=.99||l/h>=1.01)return null;i=ye.opt.GetCounterClockwiseAngleBetween2Points(o[0],o[1]),i<Math.PI/4||i>1.5*Math.PI||i>.75*Math.PI&&i<1.25*Math.PI?(t=1,e=2):(t=2,e=1);const c={wdDim:t,htDim:e};return F.Debug("S.Polygon: GetPolyRectangularInfo output:",c),c}GetDimensionFloatingPointValue(t){F.Debug("S.Polygon: GetDimensionFloatingPointValue input:",{dimensionType:t});let e=0;if(!this.polylist)return F.Debug("S.Polygon: GetDimensionFloatingPointValue output: null (no polylist)"),null;if(!(this.rflags&Se.FloatingPointDim.Width||this.rflags&Se.FloatingPointDim.Height))return F.Debug("S.Polygon: GetDimensionFloatingPointValue output: null (no floating point dimensions)"),null;const i=this.GetPolyRectangularInfo();if(!i)return F.Debug("S.Polygon: GetDimensionFloatingPointValue output: null (no poly rectangular info)"),null;if(i.wdDim===t||i.wdDim+2===t){if(this.rflags&Se.FloatingPointDim.Width){e=this.GetDimensionLengthFromValue(this.rwd);const t=Ve.GetLengthInRulerUnits(e);return F.Debug("S.Polygon: GetDimensionFloatingPointValue output:",t),t}}else if((i.htDim===t||i.htDim+2===t)&&this.rflags&Se.FloatingPointDim.Height){e=this.GetDimensionLengthFromValue(this.rht);const t=Ve.GetLengthInRulerUnits(e);return F.Debug("S.Polygon: GetDimensionFloatingPointValue output:",t),t}return F.Debug("S.Polygon: GetDimensionFloatingPointValue output: null"),null}IsTextFrameOverlap(t,e){if(F.Debug("S.Polygon: IsTextFrameOverlap input:",{textFrame:t,rotationAngle:e}),!this.polylist)return F.Debug("S.Polygon: IsTextFrameOverlap output: false (no polylist)"),!1;const i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),o=360-e,n=2*Math.PI*(o/360);si.RotatePointsAboutCenter(this.Frame,-n,i);const s=ve.IsFrameCornersInPoly(i,t);return F.Debug("S.Polygon: IsTextFrameOverlap output:",s),s}}class ps extends Zn{constructor(t){F.Debug("= S.RRect: constructor input:",t);const e=t||{};e.ShapeType=me.ShapeType.RRect,e.uniType="RRect",super(e),this.dataclass=tn.ShapeTypes.ROUNDED_RECTANGLE,F.Debug("= S.RRect: constructor output:",this)}GetCornerSize(t){F.Debug("= S.RRect: GetCornerSize input:",t);const e=this.Frame.width,i=this.Frame.height;let o=e;if(i<o&&(o=i),t&&(o=t),this.moreflags&me.ObjMoreFlags.FixedRR){let t=me.Common.RRectFixedDim*this.shapeparam;const e=.4*o;return t>e&&(t=e),F.Debug("= S.RRect: GetCornerSize output:",t),t}const n=o*this.shapeparam;return F.Debug("= S.RRect: GetCornerSize output:",n),n}CreateShape(t,e){if(F.Debug("= S.RRect: CreateShape input:",{svgDoc:t,addEventSlop:e}),this.flags&Se.ObjFlags.NotVisible)return F.Debug("= S.RRect: CreateShape output:",null),null;const i=t.CreateShape(me.CSType.ShapeContainer),o=t.CreateShape(me.CSType.RRect);o.SetID(me.SVGElementClass.Shape);const n=Oe.DeepCopy(this.Frame);let s=this.StyleRecord;s.Line.BThick&&ve.InflateRect(n,s.Line.BThick,s.Line.BThick),s=this.SVGTokenizerHook(s);const a=s.Line.Paint.Color,r=s.Line.Thickness,l=s.Line.LinePattern,h=n.width,c=n.height;i.SetSize(h,c),i.SetPos(n.x,n.y),o.SetSize(h,c);const p=this.GetCornerSize();o.SetRRectSize(h,c,p,p),o.SetStrokeColor(a),o.SetStrokeWidth(r),0!==l&&o.SetStrokePattern(l),i.AddElement(o),this.ApplyStyles(o,s),this.ApplyEffects(i,!1,!1);const d=t.CreateShape(me.CSType.RRect);d.SetStrokeColor("white"),d.SetFillColor("none"),d.SetOpacity(0),d.SetStrokeWidth(r+me.Common.Slop),e?d.SetEventBehavior(me.EventBehavior.HiddenOut):d.SetEventBehavior(me.EventBehavior.None),d.SetID(me.SVGElementClass.Slop),d.ExcludeFromExport(!0),d.SetRRectSize(h,c,p,p),i.AddElement(d);const u=s.Fill.Hatch;if(u&&0!==u){const e=t.CreateShape(me.CSType.RRect);e.SetID(me.SVGElementClass.Hatch),e.SetSize(h,c),e.SetRRectSize(h,c,p,p),e.SetStrokeWidth(0),this.SetFillHatch(e,u),i.AddElement(e)}return i.isShape=!0,this.DataID>=0&&this.LMAddSVGTextObject(t,i),F.Debug("= S.RRect: CreateShape output:",i),i}Resize(t,e,i){F.Debug("= S.RRect: Resize input:",{svgElement:t,newDimensions:e,drawingContainer:i}),i.SetDimensionLinesVisibility(t,!1);const o=t.GetRotation(),n=Oe.DeepCopy(this.prevBBox),s=Oe.DeepCopy(e),a=Oe.DeepCopy(e),r=ye.opt.svgDoc.CalculateRotatedOffsetForResize(n,s,o);this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(a,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),t.SetSize(a.width,a.height),t.SetPos(a.x+r.x,a.y+r.y);const l=t.GetElementById(me.SVGElementClass.Shape);l.SetSize(a.width,a.height);const h=t.GetElementById(me.SVGElementClass.Slop);h&&h.SetSize(a.width,a.height);const c=t.GetElementById(me.SVGElementClass.Hatch);c&&c.SetSize(e.width,e.height);const p=this.GetCornerSize();return l.SetRRectSize(a.width,a.height,p,p),c&&c.SetRRectSize(a.width,a.height,p,p),h&&h.SetRRectSize(a.width,a.height,p,p),this.LMResizeSVGTextObject(t,i,e),t.SetRotation(o),this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(e,null,null,this),F.Debug("= S.RRect: Resize output:",r),r}ResizeInTextEdit(t,e){F.Debug("= S.RRect: ResizeInTextEdit input:",{svgElement:t,newDimensions:e});const i=t.GetRotation();this.SetDimensionLinesVisibility(t,!1);const o=Oe.DeepCopy(this.Frame),n=Oe.DeepCopy(e),s=Oe.DeepCopy(e),a=ye.opt.svgDoc.CalculateRotatedOffsetForResize(o,n,i);this.StyleRecord.Line.BThick&&null==this.polylist&&ve.InflateRect(s,this.StyleRecord.Line.BThick,this.StyleRecord.Line.BThick),t.SetSize(s.width,s.height),t.SetPos(s.x+a.x,s.y+a.y);const r=t.GetElementById(me.SVGElementClass.Shape);r&&r.SetSize(s.width,s.height);const l=t.GetElementById(me.SVGElementClass.Slop);l&&l.SetSize(s.width,s.height);const h=t.GetElementById(me.SVGElementClass.Hatch);h&&h.SetSize(s.width,s.height),this.shapeparam;let c=s.width;s.height<c&&(c=s.height);const p=this.GetCornerSize();return r&&r.SetRRectSize(s.width,s.height,p,p),h&&h.SetRRectSize(s.width,s.height,p,p),l&&l.SetRRectSize(s.width,s.height,p,p),t.SetRotation(i),this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(e,null,null,this),F.Debug("= S.RRect: ResizeInTextEdit output:",a),a}GetPolyPoints(t,e,i,o,n){F.Debug("= S.RRect: GetPolyPoints input:",{divisionCount:t,applyPositionOffset:e,unusedParamA:i,shouldInflateFrame:o,unusedParamI:n});const s=[],a={},r={};ve.CopyRect(a,this.Frame);const l=this.StyleRecord.Line.Thickness/2;o&&ve.InflateRect(a,l,l);const h=this.GetCornerSize();if(r.x=0,r.y=0,r.width=h,r.height=2*h,en.PolyYCurve(s,r,t/2,0,0,0,h,!0),r.x=0,r.y=a.height-2*h,r.width=h,r.height=2*h,en.PolyYCurve(s,r,t/2,0,0,h,0,!0),r.x=a.width-h,r.y=a.height,r.width=h,r.height=-2*h,en.PolyYCurve(s,r,t/2,0,0,0,-h,!1),r.x=a.width-h,r.y=2*h,r.width=h,r.height=-2*h,en.PolyYCurve(s,r,t/2,0,0,-h,0,!1),s.push(new De(s[0].x,s[0].y)),!e)for(let c=0;c<s.length;c++)s[c].x+=a.x,s[c].y+=a.y;return F.Debug("= S.RRect: GetPolyPoints output:",s),s}ExtendLines(){}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.RRect: GetPerimPts input:",{eventObj:t,hookPoints:e,anchorType:i,keepRotation:o,optionalParam:n,eventData:s});let a=[];const r={},l=[0,0],h=me.Common.DimMax,c=e.length;if(1===c&&e[0].y===-me.AStyles.CoManager&&this.IsCoManager(r))return a.push(new De(r.x,r.y)),null!=e[0].id&&(a[0].id=e[0].id),F.Debug("= S.RRect: GetPerimPts output:",a),a;if(i===me.HookPts.KAT&&null==n)return F.Debug("= S.RRect: GetPerimPts output:",a),new we.Shape.BaseDrawObject(this).GetPerimPts(t,e,i,!1,n,s);if(!!(this.flags&Se.ObjFlags.UseConnect))for(let p=0;p<c;p++)a[p]={x:0,y:0,id:0},a[p].x=e[p].x/me.Common.DimMax*this.Frame.width+this.Frame.x,a[p].y=e[p].y/me.Common.DimMax*this.Frame.height+this.Frame.y,null!=e[p].id&&(a[p].id=e[p].id);else{a=new BaseDrawObject(this).GetPerimPts(t,e,i,!0,n,s);let o=this.Frame.width;this.Frame.height<o&&(o=this.Frame.height);const r=this.GetCornerSize()*me.Common.RoundFactor,c=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null);for(let t=0;t<a.length;t++){if(0===e[t].x&&0===e[t].y)a[t].x+=r,a[t].y+=r;else if(0===e[t].x&&e[t].y===h)a[t].x+=r,a[t].y-=r;else if(e[t].x===h&&0===e[t].y)a[t].x-=r,a[t].y+=r;else if(e[t].x===h&&e[t].y===h)a[t].x-=r,a[t].y-=r;else if(e[t].x<h/4){const e=en.PolyGetIntersect(c,a[t].y,l,null,!1);e&&(a[t].x=l[0],e>1&&l[1]<a[t].x&&(a[t].x=l[1]))}else if(e[t].x>3*h/4){const e=en.PolyGetIntersect(c,a[t].y,l,null,!1);e&&(a[t].x=l[0],e>1&&l[1]>a[t].x&&(a[t].x=l[1]))}else if(e[t].y<h/4){const e=en.PolyGetIntersect(c,a[t].x,l,null,!0);e&&(a[t].y=l[0],e>1&&l[1]<a[t].y&&(a[t].y=l[1]))}else if(e[t].y>3*h/4){const e=en.PolyGetIntersect(c,a[t].x,l,null,!0);e&&(a[t].y=l[0],e>1&&l[1]>a[t].y&&(a[t].y=l[1]))}null!=e[t].id&&(a[t].id=e[t].id)}}if(!o){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,a)}return F.Debug("= S.RRect: GetPerimPts output:",a),a}SetShapeIndent(t){F.Debug("= S.RRect: SetShapeIndent input:",t);const e=this.inside.width,i=this.inside.height,o=i>e?e:i;let n=this.shapeparam;const s=me.Common.RoundFactor;let a=o;this.moreflags&me.ObjMoreFlags.FixedRR&&(a=o,t&&(a=o+2*this.GetCornerSize()*s,a=o+2*this.GetCornerSize(a)*s),n=this.GetCornerSize(a)/a);const r=n*s;this.left_sindent=r,this.top_sindent=r,this.right_sindent=r,this.bottom_sindent=r;let l=1,h=1;t&&(l=1-2*this.left_sindent,h=l),this.tindent.left=this.left_sindent*e/l,this.tindent.top=this.top_sindent*i/h,this.tindent.right=this.right_sindent*e/l,this.tindent.bottom=this.bottom_sindent*i/h,F.Debug("= S.RRect: SetShapeIndent output:",{left_sindent:this.left_sindent,top_sindent:this.top_sindent,right_sindent:this.right_sindent,bottom_sindent:this.bottom_sindent,tint:this.tindent})}SetShapeProperties(t){F.Debug("= S.RRect: SetShapeProperties input:",t);let e=!1;const i=me.ObjMoreFlags.FixedRR;return t.hasrrectselected&&((this.moreflags&i)>0===t.rrectfixed&&t.rrectparam===this.shapeparam||(this.moreflags=ve.SetFlag(this.moreflags,i,t.rrectfixed),this.shapeparam=t.rrectparam,this.SetSize(this.Frame.width,0,me.ActionTriggerType.LineLength),e=!0)),super.SetShapeProperties(t)&&(e=!0),F.Debug("= S.RRect: SetShapeProperties output:",e),e}}class ds extends Zn{constructor(t){(t=t||{}).ShapeType=me.ShapeType.Oval,t.Frame,t.uniType="Oval",F.Debug("S.Oval: Input options:",t),super(t),this.dataclass=this.ObjGrow===me.GrowBehavior.ProPortional?tn.ShapeTypes.CIRCLE:tn.ShapeTypes.OVAL,F.Debug("S.Oval: Output dataclass:",this.dataclass)}CreateShape(t,e){if(this.flags&Se.ObjFlags.NotVisible)return null;F.Debug("S.Oval: Input renderer:",t,"isHidden:",e);const i=t.CreateShape(me.CSType.ShapeContainer),o=Oe.DeepCopy(this.Frame),n=this.StyleRecord;n.Line.BThick&&ve.InflateRect(o,n.Line.BThick,n.Line.BThick);const s=n.Line.Paint.Color,a=n.Line.Thickness,r=n.Line.LinePattern,l=o.width,h=o.height;i.SetSize(l,h),i.SetPos(o.x,o.y);const c=t.CreateShape(me.CSType.Oval);c.SetSize(l,h),c.SetStrokeColor(s),c.SetStrokeWidth(a),0!==r&&c.SetStrokePattern(r),c.SetID(me.SVGElementClass.Shape),i.AddElement(c),this.ApplyStyles(c,n),this.ApplyEffects(i,!1,!1);const p=t.CreateShape(me.CSType.Oval);p.SetStrokeColor("white"),p.SetFillColor("none"),p.SetOpacity(0),p.SetStrokeWidth(a+me.Common.Slop),e?p.SetEventBehavior(me.EventBehavior.HiddenOut):p.SetEventBehavior(me.EventBehavior.None),p.SetID(me.SVGElementClass.Slop),p.ExcludeFromExport(!0),p.SetSize(l,h),i.AddElement(p);const d=n.Fill.Hatch;if(d&&0!==d){const e=t.CreateShape(me.CSType.Oval);e.SetID(me.SVGElementClass.Hatch),e.SetSize(l,h),e.SetStrokeWidth(0),this.SetFillHatch(e,d),i.AddElement(e)}return i.isShape=!0,this.DataID>=0&&this.LMAddSVGTextObject(t,i),F.Debug("S.Oval: Output shapeContainer:",i),i}GetPolyPoints(t,e,i,o,n){F.Debug("S.Oval: Input parameters:",{curveType:t,frame:e,inflate:i,isClosed:o,isReversed:n});let s=[],a={},r=this.StyleRecord.Line.Thickness/2;ve.CopyRect(a,this.Frame),i&&ve.InflateRect(a,r,r);let l={x:a.width/2,y:0,width:a.width/2,height:a.height};en.PolyYCurve(s,l,t,0,0,0,0,!1),s.pop();let h={x:0,y:a.height,width:a.width/2,height:-a.height};if(en.PolyYCurve(s,h,t,0,0,0,0,!0),s.pop(),!e)for(let c=0;c<s.length;c++)s[c].x+=a.x,s[c].y+=a.y;return F.Debug("S.Oval: Output points:",s),s}ExtendLines(){F.Debug("S.Oval: ExtendLines called")}GetPerimeterPoints(t,e,i,o,n,s){F.Debug("S.Oval: Input parameters:",{event:t,points:e,hookType:i,isClosed:o,tableIndex:n,isReversed:s});let a=[],r=this.Frame.width,l=this.Frame.height,h=r/2,c=l/2,p=me.Common.DimMax;if(1===e.length&&e[0].y===-me.AStyles.CoManager&&this.IsCoManager({}))return a.push(new De(this.Frame.x,this.Frame.y)),null!=e[0].id&&(a[0].id=e[0].id),F.Debug("S.Oval: Output perimeterPoints:",a),a;if(i===me.HookPts.KAT)return a=this.BaseDrawingObject_GetPerimPts(t,e,i,!1,n,s),F.Debug("S.Oval: Output perimeterPoints:",a),a;if(this.flags&Se.ObjFlags.UseConnect)for(let d=0;d<e.length;d++)a[d]={x:e[d].x/p*r+this.Frame.x,y:e[d].y/p*l+this.Frame.y,id:e[d].id||0};else for(let d=0;d<e.length;d++){let t=r*(e[d].x-p/2)/p,i=l*(e[d].y-p/2)/p;if(0!==t&&0!==i){let e=i<0?-1:1,o=1/(t/i*(t/i)/(h*h)+1/(c*c));t=t/i*(i=Math.sqrt(o)*e)}a.push(new De(t+(this.Frame.x+this.Frame.x+r)/2,i+(this.Frame.y+this.Frame.y+l)/2)),null!=e[d].id&&(a[d].id=e[d].id)}if(!o){let t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,a)}return F.Debug("S.Oval: Output perimeterPoints:",a),a}BaseDrawingObject_GetPerimPts(t,e,i,o,n,s){F.Debug("S.Oval: Input parameters:",{event:t,points:e,hookType:i,isClosed:o,tableIndex:n,isReversed:s});const a=[],r=e.length,l=tn.ShapeTypes.TRIANGLE,h=me.Common.DimMax;for(let c=0;c<r;c++){const t={x:e[c].x/h*this.Frame.width+this.Frame.x,y:(this.dataclass===l?h-e[c].y:e[c].y)/h*this.Frame.height+this.Frame.y,id:e[c].id||0};a.push(t)}if(!o){const t=-this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(this.Frame,t,a)}return F.Debug("S.Oval: Output perimeterPoints:",a),a}SetShapeIndent(t){F.Debug("S.Oval: Input isIndented:",t);const e=me.Common.RoundFactor/2,i=this.inside.width,o=this.inside.height;this.leftIndent=e,this.topIndent=e,this.rightIndent=e,this.bottomIndent=e;let n=1,s=1,a=1,r=1;t&&(n=a=1-2*this.leftIndent,s=r=n),this.tindent.left=this.leftIndent*i/n,this.tindent.top=this.topIndent*o/s,this.tindent.right=this.rightIndent*i/a,this.tindent.bottom=this.bottomIndent*o/r,F.Debug("S.Oval: Output tindent:",this.tindent)}}class us extends Zn{constructor(t){F.Debug("S.BaseSymbol - Constructor input:",t),(t=t||{}).ObjGrow=me.GrowBehavior.All,t.ResizeAspectConstrain=!0,super(t),this.nativeDataArrayBuffer=t.nativeDataArrayBuffer||null,this.SymbolData=t.SymbolData||null,F.Debug("S.BaseSymbol - Constructor output:",this)}CreateActionTriggers2(t,e,i,o){F.Debug("S.BaseSymbol - CreateActionTriggers2 input:",{svgDocument:t,triggerId:e,actionHandler:i,releaseHandler:o});const n=super.CreateActionTriggers(t,e,i,o);return F.Debug("S.BaseSymbol - CreateActionTriggers2 output:",n),n}CreateActionTriggers(t,e,i,o){F.Debug("S.BaseSymbol - CreateActionTriggers input:",{svgDocument:t,triggerId:e,actionHandler:i,releaseHandler:o});const n=[ze.CursorType.ResizeLT,ze.CursorType.ResizeT,ze.CursorType.ResizeRT,ze.CursorType.ResizeR,ze.CursorType.ResizeRB,ze.CursorType.ResizeB,ze.CursorType.ResizeLB,ze.CursorType.ResizeL],s=t.CreateShape(me.CSType.Group),a=me.Common.KnobSize,r=me.Common.RKnobSize;let l=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(l*=2);const h=a/l,c=r/l,p=this.Frame;let d=p.width,u=p.height;d+=h,u+=h;const g=Oe.DeepCopy(p);g.x-=h/2,g.y-=h/2,g.width+=h,g.height+=h;let y=i.GetRotation()+22.5;y>=360&&(y=0);const S=Math.floor(y/45),m=n.slice(S).concat(n.slice(0,S)),b={svgDoc:t,shapeType:me.CSType.Rect,x:0,y:0,knobSize:h,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",locked:!1};if(e!==o&&(b.fillColor="white",b.strokeSize=1,b.strokeColor="black",b.fillOpacity=0),this.flags&Se.ObjFlags.Lock)b.fillColor="gray",b.locked=!0;else if(this.NoGrow()){b.fillColor="red",b.strokeColor="red";for(let t=0;t<8;t++)m[t]=ze.CursorType.Default}b.knobID=me.ActionTriggerType.TopLeft,b.cursorType=m[0];let D=this.GenericKnob(b);return s.AddElement(D),b.x=d-h,b.y=0,b.cursorType=m[2],b.knobID=me.ActionTriggerType.TopRight,D=this.GenericKnob(b),s.AddElement(D),b.x=d-h,b.y=u-h,b.cursorType=m[4],b.knobID=me.ActionTriggerType.BottomRight,D=this.GenericKnob(b),s.AddElement(D),b.x=0,b.y=u-h,b.cursorType=m[6],b.knobID=me.ActionTriggerType.BottomLeft,D=this.GenericKnob(b),s.AddElement(D),b.locked||this.NoGrow()||(b.shapeType=me.CSType.Oval,b.x=d-3*c,b.y=u/2-c/2,b.cursorType=ze.CursorType.Rotate,b.knobID=me.ActionTriggerType.Rotate,b.fillColor="white",b.fillOpacity=.001,b.strokeSize=1.5,b.strokeColor="#555555",D=this.GenericKnob(b),s.AddElement(D)),s.SetSize(d,u),s.SetPos(g.x,g.y),s.isShape=!0,s.SetID(me.Common.Action+e),F.Debug("S.BaseSymbol - CreateActionTriggers output:",s),s}ChangeShape(t,e,i,o,n){F.Debug("S.BaseSymbol - ChangeShape input:",{event:t,targetElement:e,newProperties:i,previousState:o,additionalData:n});return F.Debug("S.BaseSymbol - ChangeShape output:",false),false}Flip(t){if(F.Debug("S.BaseSymbol - Flip input:",t),ye.opt.svgObjectLayer.GetElementById(this.BlockID),t&me.ExtraFlags.FlipHoriz){const t=0!=(this.extraflags&me.ExtraFlags.FlipHoriz);this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.FlipHoriz,!t)}if(t&me.ExtraFlags.FlipVert){const t=0!=(this.extraflags&me.ExtraFlags.FlipVert);this.extraflags=ve.SetFlag(this.extraflags,me.ExtraFlags.FlipVert,!t)}F.Debug("S.BaseSymbol - Flip output:",this.extraflags)}LMActionPreTrack(t,e){F.Debug("S.BaseSymbol - LMActionPreTrack input:",{event:t,trigger:e}),-1!==this.DataID&&(this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachB)&&ye.opt.actionSvgObject.textElem.SetVisible(!1),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),F.Debug("S.BaseSymbol - LMActionPreTrack output: completed")}LMActionPostRelease(t){F.Debug("S.BaseSymbol - LMActionPostRelease input:",t),-1!==this.DataID&&(this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachB)&&ye.opt.actionSvgObject.textElem.SetVisible(!0),Ps.SetEditMode(Se.EditState.Default),ye.opt.UpdateLinks(),ye.opt.linkParams=null,this.sizedim.width=this.Frame.width,this.sizedim.height=this.Frame.height,F.Debug("S.BaseSymbol - LMActionPostRelease output: completed")}}class gs extends us{constructor(t){(t=t||{}).ShapeType=me.ShapeType.SvgSymbol,t.drawSetting=t.drawSetting||{},super(t),F.Debug("= S.SvgSymbol | Constructor Input/Output:",t.this)}CreateShape(t,e){if(F.Debug("= S.SvgSymbol | CreateShape Input:",{svgDocument:t,enableEvents:e}),this.flags&Se.ObjFlags.NotVisible)return null;const i=t.CreateShape(me.CSType.ShapeContainer),o=t.CreateShape(me.CSType.Symbol);o.SetDrawSetting(this.drawSetting),o.SetSymbolName(this.uniType),o.InitSymbolSource(),o.SetID(me.SVGElementClass.Shape);const n=this.Frame,s=this.StyleRecord;let a=s.Line.Paint.Color;const r=s.Line.Thickness;let l=this.GetFieldDataStyleOverride();l&&l.strokeColor&&(a=l.strokeColor),(l||this.colorchanges&(Ne.ColorFilters.NCLine|Ne.ColorFilters.NCStyle))&&o.SetStrokeColor(a),this.colorchanges&(Ne.ColorFilters.NCLineThick|Ne.ColorFilters.NCStyle)&&o.SetStrokeWidth(r),o.SetFillOpacity(s.Fill.Paint.Opacity),o.SetStrokeOpacity(s.Line.Paint.Opacity);const h=n.width,c=n.height;o.SetSize(h,c),o.SetScale(h/this.InitialGroupBounds.width,c/this.InitialGroupBounds.height),i.SetSize(h,c),i.SetPos(n.x,n.y);const p=(this.extraflags&me.ExtraFlags.FlipHoriz)>0,d=(this.extraflags&me.ExtraFlags.FlipVert)>0;p&&o.SetMirror(p),d&&o.SetFlip(d),i.AddElement(o),this.ApplyStyles(o,s),this.ApplyEffects(i,!1,!1);const u=t.CreateShape(me.CSType.Rect);u.SetStrokeColor("white"),u.SetFillColor("none"),u.SetOpacity(0),u.SetStrokeWidth(0),e?u.SetEventBehavior(me.EventBehavior.HiddenAll):u.SetEventBehavior(me.EventBehavior.None),u.SetID(me.SVGElementClass.Slop),u.ExcludeFromExport(!0),u.SetSize(h,c),i.AddElement(u),i.isShape=!0;var g=$n.GetItemFromAPSV2(this.uniqueId);if(F.Debug("= S.SvgSymbol | CreateShape apsItem:",g),g&&g.t3Entry){F.Debug("= S.SvgSymbol | CreateShape apsItem:",g);const e=class{static CreateVueCircle(t){let e=null==t?ye.opt.svgDoc:t;const i=e.CreateVueComponent(60,60,null,{message:"Hello from SVG!",color:"blue"});i.SetPos(0,-50);const o=e.CreateShape(me.CSType.ShapeContainer);return o.AddElement(i),o.SetID(111),o.SetSize(100,100),o.SetPos(0,0),i}static CreateVueObjectType(t,e){let i=null==t?ye.opt.svgDoc:t;F.Debug("ForeignObjUtil=CreateVueObjectType",e);var o=e.width;const n=i.CreateVueComponent(o,40,null,{item:{title:"==== Test Pump ====",active:!1,type:"Pump",translate:[284,72],width:60,height:60,rotate:0,scaleX:1,scaleY:1,settings:{fillColor:"#659dc5",active:!0,inAlarm:!0,titleColor:"inherit",bgColor:"inherit",textColor:"inherit",fontSize:16,t3EntryDisplayField:"description"},zindex:1,t3Entry:{auto_manual:1,calibration_h:0,calibration_l:0,calibration_sign:1,command:"199IN1",control:1,decom:1,description:"V",digital_analog:1,filter:5,id:"IN1",index:0,label:"IN1",pid:199,range:19,type:"INPUT",unit:19,value:30},showDimensions:!0,cat:"Pipe",id:2},showArrows:!0});n.SetPos(0,-50);const s=i.CreateShape(me.CSType.ShapeContainer);return s.AddElement(n),s.SetSize(o,40),s.SetPos(0,0),s}static CreateVueObject(t,e,i){let o=null==t?ye.opt.svgDoc:t;var n={item:i,showArrows:!1};const s=o.CreateVueComponent(300,30,null,n);s.SetPos(0,-40);const a=o.CreateShape(me.CSType.ShapeContainer);return a.AddElement(s),a.SetSize(300,30),a.SetPos(0,0),a}}.CreateVueObject(t,n,g);i.AddElement(e)}return-1!==this.DataID&&this.LMAddSVGTextObject(t,i),F.Debug("= S.SvgSymbol | CreateShape Output:",i),i}ApplyStyles(t,e){F.Debug("S.SvgSymbol | ApplyStyles Input:",{shapeElement:t,styleRecord:e});const i=this.GetFieldDataStyleOverride(),o=i&&i.fillColor;if(o||this.colorchanges&(Ne.ColorFilters.NCFill|Ne.ColorFilters.NCStyle)){let n=e.Fill.Paint.FillType,s=e.Fill.Paint.Color;o&&(n=Se.FillTypes.Solid,s=i.fillColor),n===Se.FillTypes.Gradient?(t.SetFillColor(e.Fill.Paint.Color),t.SetGradientFill(this.CreateGradientRecord(e.Fill.Paint.GradientFlags,s,e.Fill.Paint.Opacity,e.Fill.Paint.EndColor,e.Fill.Paint.EndOpacity)),t.fillPaintType=n):n===Se.FillTypes.Transparent?t.SetFillColor("none"):(t.SetFillColor(s),t.SetFillOpacity(e.Fill.Paint.Opacity))}F.Debug("S.SvgSymbol | ApplyStyles Output:",{shapeElement:t})}Resize(t,e,i){F.Debug("= S.SvgSymbol | Resize Input:",{shapeElement:t,newBoundingBox:e,eventInfo:i});const o=t.GetRotation(),n=Oe.DeepCopy(this.prevBBox),s=Oe.DeepCopy(e),a=ye.opt.svgDoc.CalculateRotatedOffsetForResize(n,s,o);t.SetSize(s.width,s.height),t.SetPos(s.x+a.x,s.y+a.y);const r=t.GetElementById(me.SVGElementClass.Shape);r.SetSize(s.width,s.height),r.SetScale(s.width/this.InitialGroupBounds.width,s.height/this.InitialGroupBounds.height);const l=t.GetElementById(me.SVGElementClass.Slop);return l&&l.SetSize(s.width,s.height),this.LMResizeSVGTextObject(t,i,s),t.SetRotation(o),this.UpdateDimensionLines(t),F.Debug("= S.SvgSymbol | Resize Output:",{offset:a,shapeElement:t}),a}ResizeInTextEdit(t,e){if(F.Debug("= S.SvgSymbol | ResizeInTextEdit Input:",{shapeElement:t,newBoundingBox:e}),t){const i=t.GetID();if(i>=0){const o=ws.GetObjectPtr(i,!1);this.prevBBox=Oe.DeepCopy(this.Frame);const n=this.Resize(t,e,o);return F.Debug("= S.SvgSymbol | ResizeInTextEdit Output:",{offset:n}),n}}const i={x:0,y:0};return F.Debug("= S.SvgSymbol | ResizeInTextEdit Output:",{offset:i}),i}CreateActionTriggers(t,e,i,o){F.Debug("= S.SvgSymbol | CreateActionTriggers Input:",{svgDocument:t,triggerType:e,actionHandler:i,additionalParameters:o});const n=super.CreateActionTriggers2(t,e,i,o);return F.Debug("= S.SvgSymbol | CreateActionTriggers Output:",n),n}BaseShapeCreateActionTriggers(t,e,i,o){F.Debug("= S.SvgSymbol | BaseShapeCreateActionTriggers Input:",{svgDoc:t,triggerId:e,shape:i,additionalParams:o});const n=[ze.CursorType.ResizeLT,ze.CursorType.ResizeT,ze.CursorType.ResizeRT,ze.CursorType.ResizeR,ze.CursorType.ResizeRB,ze.CursorType.ResizeB,ze.CursorType.ResizeLB,ze.CursorType.ResizeL];let s,a,r=t.CreateShape(me.CSType.Group),l=me.Common.KnobSize,h=me.Common.RKnobSize,c=this.extraflags&me.ExtraFlags.SideKnobs&&this.dataclass===tn.ShapeTypes.POLYGON,p=me.Common.MinSidePointLength,d=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(d*=2);const u=l/d,g=h/d;let{x:y,y:S,width:m,height:b}=this.Frame;m+=u,b+=u;const D=Oe.DeepCopy(this.Frame);D.x-=u/2,D.y-=u/2,D.width+=u,D.height+=u;let f=i.GetRotation()+22.5;f>=360&&(f=0);const x=Math.floor(f/45);let C=n.slice(x).concat(n.slice(0,x)),P=!0,T=!c,O=!c;switch(this.ObjGrow){case me.GrowBehavior.Horiz:P=!1,O=!1;break;case me.GrowBehavior.Vertical:P=!1,T=!1;break;case me.GrowBehavior.ProPortional:P=!0,T=!1,O=!1}const v={svgDoc:t,shapeType:me.CSType.Rect,x:0,y:0,knobSize:u,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",locked:!1};if(e!==o&&(v.fillColor="white",v.strokeSize=1,v.strokeColor="black",v.fillOpacity=0),this.flags&Se.ObjFlags.Lock?(v.fillColor="gray",v.locked=!0,c=!1):this.NoGrow()&&(v.fillColor="red",c=!1,v.strokeColor="red",C=[ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default]),P){v.knobID=me.ActionTriggerType.TopLeft,v.cursorType=C[0];let t=this.GenericKnob(v);r.AddElement(t),v.x=m-u,v.y=0,v.cursorType=C[2],v.knobID=me.ActionTriggerType.TopRight,t=this.GenericKnob(v),r.AddElement(t),v.x=m-u,v.y=b-u,v.cursorType=C[4],v.knobID=me.ActionTriggerType.BottomRight,t=this.GenericKnob(v),r.AddElement(t),v.x=0,v.y=b-u,v.cursorType=C[6],v.knobID=me.ActionTriggerType.BottomLeft,t=this.GenericKnob(v),r.AddElement(t)}if(O){v.x=m/2-u/2,v.y=0,v.cursorType=C[1],v.knobID=me.ActionTriggerType.TopCenter;let t=this.GenericKnob(v);r.AddElement(t),v.x=m/2-u/2,v.y=b-u,v.cursorType=C[5],v.knobID=me.ActionTriggerType.BottomCenter,t=this.GenericKnob(v),r.AddElement(t)}if(T){v.x=0,v.y=b/2-u/2,v.cursorType=C[7],v.knobID=me.ActionTriggerType.CenterLeft;let t=this.GenericKnob(v);r.AddElement(t),v.x=m-u,v.y=b/2-u/2,v.cursorType=C[3],v.knobID=me.ActionTriggerType.CenterRight,t=this.GenericKnob(v),r.AddElement(t)}if(s=function(t){let e,i=null;return t.hooks.length&&(e=ws.GetObjectPtr(t.hooks[0].objid,!1),(e&&e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector||e&&e instanceof we.Shape.ShapeContainer)&&(i=e.PrGetShapeConnectorInfo(t.hooks[0]))),i}(this),s&&s.length){const e={svgDoc:t,iconSize:14,imageURL:null,iconID:0,userData:0,cursorType:0};for(let t=s.length,i=0;i<t;i++)"right"===s[i].position?e.x=m-14-1-u:"bottom"===s[i].position?e.y=b-14-1-u:(e.x=u+1,e.y=u+1),e.cursorType=s[i].cursorType,e.iconID=s[i].knobID,e.imageURL="vertical"===s[i].polyType?me.Common.ConMoveVerticalPath:me.Common.ConMoveHorizontalPath,e.userData=s[i].knobData,a=this.GenericIcon(e),r.AddElement(a),e.x+=16}if(c){const t=Oe.DeepCopy(this);t.inside=Oe.DeepCopy(t.Frame);const e=ye.opt.ShapeToPolyLine(this.BlockID,!1,!0,t).GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,[]);if(e)for(let i=1,o=e.length;i<o;i++){const t=e[i].x-e[i-1].x,o=e[i].y-e[i-1].y;if(ve.Sqrt(t*t+o*o)>p){v.cursorType=t*t>o*o?ze.CursorType.ResizeTB:ze.CursorType.ResizeLR,v.x=e[i-1].x+t/2,v.y=e[i-1].y+o/2;const n=this.GenericKnob(v);n.SetUserData(i),r.AddElement(n)}}}const w=this.Frame.width<44,k=this.hooks.length>0&&!!ws.GetObjectPtr(this.hooks[0].objid,!1)&&ws.GetObjectPtr(this.hooks[0].objid,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector;if(!(this.NoRotate()||this.NoGrow()||v.locked||w||k)){const t=this.TextGrow===Se.TextGrowBehavior.Horizontal&&this.flags&Se.ObjFlags.TextOnly&&Vo.TextAlignToWin(this.TextAlign).just===bi.TextJust.Left;v.shapeType=me.CSType.Oval,v.x=t?m+g:m-3*g,v.y=b/2-g/2,v.cursorType=ze.CursorType.Rotate,v.knobID=me.ActionTriggerType.Rotate,v.fillColor="white",v.fillOpacity=.001,v.strokeSize=1.5,v.strokeColor="black";const e=this.GenericKnob(v);r.AddElement(e)}if(this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID.toString());this.CreateDimensionAdjustmentKnobs(r,t,v)}return r.SetSize(m,b),r.SetPos(D.x,D.y),r.isShape=!0,r.SetID(me.Common.Action+e),F.Debug("= S.SvgSymbol | BaseShapeCreateActionTriggers Output:",r),r}SetFillColor(t){var e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(e){var i=e.GetElementById(me.SVGElementClass.Shape);i.SetFillColor(t);var o=i.GetSvgSymbol();F.Debug("= S.SvgSymbol | SetFillColor Output 1:",this.SVGFragment),F.Debug("= S.SvgSymbol | SetFillColor Output 2:",o)}}GetDrawSetting(){return this.drawSetting}SetDrawSetting(t){F.Debug("= S.SvgSymbol | SetDrawSetting Input: setting",t),this.drawSetting=t;var e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(e){var i=e.GetElementById(me.SVGElementClass.Shape);i.SetDrawSetting(t),i.RefreshDrawSetting()}}AddDynamicCSS(t,e){F.Debug("= S.SvgSymbol | AddDynamicCSS Input:",{cssStyles:t,targetSelector:e});const i=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(!i)return F.Debug("= S.SvgSymbol | AddDynamicCSS: SVG element not found"),!1;const o=i.GetElementById(me.SVGElementClass.Shape);if(!o)return F.Debug("= S.SvgSymbol | AddDynamicCSS: Shape element not found"),!1;const n=o.GetSvgSymbol();if(!n)return F.Debug("= S.SvgSymbol | AddDynamicCSS: SVG DOM element not found"),!1;try{if("string"==typeof t){let e=n.querySelector("style[data-dynamic-css]");e||(e=document.createElement("style"),e.setAttribute("data-dynamic-css","true"),n.appendChild(e)),e.textContent=t}else if("object"==typeof t){(e?Array.from(n.querySelectorAll(e)):[n]).forEach((e=>{for(const[i,o]of Object.entries(t)){i.replace(/([A-Z])/g,"-$1").toLowerCase();e.style[i]=o}}))}return F.Debug("= S.SvgSymbol | AddDynamicCSS: CSS applied successfully"),!0}catch(s){return F.Debug("= S.SvgSymbol | AddDynamicCSS Error:",s),!1}}}class ys{}a(ys,"Tools",{Symbol:-1,Select:0,Shape:1,Line:2,Text:3,Wall:4,StyledLine:5});const Ss=class{static GetSvgData(t){var e=Ss.DuctSvg.GetSvgFrame(t);let i=-1e3,o=e.width,n=e.height,s=e.width,a=e.height,r=new gs({Frame:{x:i,y:-1e3,width:o,height:n},InitialGroupBounds:{x:i,y:i,width:s,height:a},StyleRecord:new ni,uniType:t,drawSetting:{}}),l="";switch(t){case"Box":l=this.BoxSvgData();break;case"Text":l=this.TextSvgData();break;case"Icon":l=this.IconSvgData();break;case"SwitchIcon":l=this.SwitchIconSvgData();break;case"Led":l=this.LedSvgData();break;case"RoomHumidity":l=this.RoomHumiditySvgData();break;case"RoomTemperature":l=this.RoomTemperatureSvgData();break;case"Temperature":l=this.TemperatureSvgData();break;case"Boiler":l=this.BoilerSvgData();break;case"Heatpump":l=this.HeatpumpSvgData();break;case"Pump":l=this.PumpSvgData();break;case"ValveThreeWay":l=this.ValveThreeWaySvgData();break;case"ValveTwoWay":l=this.ValveTwoWaySvgData();break;case"Duct":l=Ss.DuctSvgData();break;case"Fan":l=this.FanSvgData();break;case"CoolingCoil":l=this.CoolingCoilSvgData();break;case"HeatingCoil":l=this.HeatingCoilSvgData();break;case"Filter":l=this.FilterSvgData();break;case"Humidifier":l=this.HumidifierSvgData();break;case"Humidity":l=this.HumiditySvgData();break;case"Pressure":l=this.PressureSvgData();break;case"Damper":l=this.DamperSvgData();break;case"Temperature2":l=this.Temperature2SvgData();break;case"ThermalWheel":l=this.ThermalWheelSvgData();break;case"Enthalpy":l=this.EnthalpySvgData();break;case"Flow":l=this.FlowSvgData();break;case"Guage":l=this.GuageSvgData();break;case"Dial":l=this.DialSvgData();break;case"Value":l=this.ValueSvgData();break;case"IconWithTitle":l=this.IconWithTitleSvgData();break;case"Test1":l=this.Test1SvgData();break;case"Duct1":l=Ss.DuctSvg.Duct1Data();break;case"Duct2":l=Ss.DuctSvg.Duct2Data();break;case"Duct3":l=Ss.DuctSvg.Duct3Data();break;case"Duct4":l=Ss.DuctSvg.Duct4Data();break;case"Duct5":l=Ss.DuctSvg.Duct5Data();break;case"Duct6":l=Ss.DuctSvg.Duct6Data();break;case"Duct7":l=Ss.DuctSvg.Duct7Data();break;case"Duct8":l=Ss.DuctSvg.Duct8Data();break;case"Duct9":l=Ss.DuctSvg.Duct9Data();break;case"Duct10":l=Ss.DuctSvg.Duct10Data();break;case"Duct11":l=Ss.DuctSvg.Duct11Data();break;case"Duct12":l=Ss.DuctSvg.Duct12Data();break;default:return""}return r.SVGFragment=l,r}static GetSvgDataString(t){let e="";switch(t){case"Box":e=this.BoxSvgData();break;case"Text":e=this.TextSvgData();break;case"Icon":e=this.IconSvgData();break;case"SwitchIcon":e=this.SwitchIconSvgData();break;case"Led":e=this.LedSvgData();break;case"RoomHumidity":e=this.RoomHumiditySvgData();break;case"RoomTemperature":e=this.RoomTemperatureSvgData();break;case"Temperature":e=this.TemperatureSvgData();break;case"Boiler":e=this.BoilerSvgData();break;case"Heatpump":e=this.HeatpumpSvgData();break;case"Pump":e=this.PumpSvgData();break;case"ValveThreeWay":e=this.ValveThreeWaySvgData();break;case"ValveTwoWay":e=this.ValveTwoWaySvgData();break;case"Duct":e=Ss.DuctSvgData();break;case"Fan":e=this.FanSvgData();break;case"CoolingCoil":e=this.CoolingCoilSvgData();break;case"HeatingCoil":e=this.HeatingCoilSvgData();break;case"Filter":e=this.FilterSvgData();break;case"Humidifier":e=this.HumidifierSvgData();break;case"Humidity":e=this.HumiditySvgData();break;case"Pressure":e=this.PressureSvgData();break;case"Damper":e=this.DamperSvgData();break;case"Temperature2":e=this.Temperature2SvgData();break;case"ThermalWheel":e=this.ThermalWheelSvgData();break;case"Enthalpy":e=this.EnthalpySvgData();break;case"Flow":e=this.FlowSvgData();break;case"Guage":e=this.GuageSvgData();break;case"Dial":e=this.DialSvgData();break;case"Value":e=this.ValueSvgData();break;case"IconWithTitle":e=this.IconWithTitleSvgData();break;case"Test1":e=this.Test1SvgData();break;case"Duct1":e=Ss.DuctSvg.Duct1Data();break;case"Duct2":e=Ss.DuctSvg.Duct2Data();break;case"Duct3":e=Ss.DuctSvg.Duct3Data();break;case"Duct4":e=Ss.DuctSvg.Duct4Data();break;case"Duct5":e=Ss.DuctSvg.Duct5Data();break;case"Duct6":e=Ss.DuctSvg.Duct6Data();break;case"Duct7":e=Ss.DuctSvg.Duct7Data();break;case"Duct8":e=Ss.DuctSvg.Duct8Data();break;case"Duct9":e=Ss.DuctSvg.Duct9Data();break;case"Duct10":e=Ss.DuctSvg.Duct10Data();break;case"Duct11":e=Ss.DuctSvg.Duct11Data();break;case"Duct12":e=Ss.DuctSvg.Duct12Data();break;default:return""}return e}static GetSvgActiveClassName(t){let e="";switch(t){case"Box":e=this.BoxSvgData();break;case"Text":e=this.TextSvgData();break;case"Icon":e=this.IconSvgData();break;case"SwitchIcon":e=this.SwitchIconSvgData();break;case"Led":e=this.LedSvgData();break;case"RoomHumidity":e=this.RoomHumiditySvgData();break;case"RoomTemperature":e=this.RoomTemperatureSvgData();break;case"Temperature":e=this.TemperatureSvgData();break;case"Boiler":e=this.BoilerSvgData();break;case"Heatpump":e=this.HeatpumpSvgData();break;case"Pump":e=this.PumpSvgData();break;case"ValveThreeWay":e=this.ValveThreeWaySvgData();break;case"ValveTwoWay":e=this.ValveTwoWaySvgData();break;case"Duct":e=Ss.DuctSvgData();break;case"Fan":e=this.FanSvgData();break;case"CoolingCoil":e=this.CoolingCoilSvgData();break;case"HeatingCoil":e=this.HeatingCoilSvgData();break;case"Filter":e=this.FilterSvgData();break;case"Humidifier":e=this.HumidifierSvgData();break;case"Humidity":e=this.HumiditySvgData();break;case"Pressure":e=this.PressureSvgData();break;case"Damper":e=this.DamperSvgData();break;case"Temperature2":e=this.Temperature2SvgData();break;case"ThermalWheel":e=this.ThermalWheelSvgData();break;case"Enthalpy":e=this.EnthalpySvgData();break;case"Flow":e=this.FlowSvgData();break;case"Guage":e=this.GuageSvgData();break;case"Dial":e=this.DialSvgData();break;case"Value":e=this.ValueSvgData();break;case"IconWithTitle":e=this.IconWithTitleSvgData();break;case"Test1":e=this.Test1SvgData();break;default:return""}return e}static BoxSvgData(){return""}static TextSvgData(){return""}static IconSvgData(){return""}static SwitchIconSvgData(){return'\n<g transform="scale(0.08,0.08) translate(-370,3)">\n    <use style="fill:##FillColor=#659dc5##" xlink:href="icons.svg#toggle_off1"></use>\n</g>\n      '}static LedSvgData(){return'\n<g transform="scale(1.8,1.8) translate(9,2)">\n    <filter id="light1" x="-0.8" y="-0.8" height="2.2" width="2.8">\n        <feGaussianBlur stdDeviation="2" />\n    </filter>\n    <filter id="light2" x="-0.8" y="-0.8" height="2.2" width="2.8">\n        <feGaussianBlur stdDeviation="4" />\n    </filter>\n    <rect x="2.5099" y="20.382" width="2.1514" height="9.8273" fill="##FillColor=#8c8c8c##" />\n    <path\n        d="m12.977 30.269c0-1.1736-0.86844-2.5132-1.8916-3.4024-0.41616-0.3672-1.1995-1.0015-1.1995-1.4249v-5.4706h-2.1614v5.7802c0 1.0584 0.94752 1.8785 1.9462 2.7482 0.44424 0.37584 1.3486 1.2496 1.3486 1.7694"\n        fill="##FillColor=#8c8c8c##" />\n\n    <path\n        d="m14.173 13.001v-5.9126c0-3.9132-3.168-7.0884-7.0855-7.0884-3.9125 0-7.0877 3.1694-7.0877 7.0884v13.649c1.4738 1.651 4.0968 2.7526 7.0877 2.7526 4.6195 0 8.3686-2.6179 8.3686-5.8594v-1.5235c-7.4e-4 -1.1426-0.47444-2.2039-1.283-3.1061z"\n        opacity=".3" />\n    <path\n        d="m14.173 13.001v-5.9126c0-3.9132-3.168-7.0884-7.0855-7.0884-3.9125 0-7.0877 3.1694-7.0877 7.0884v13.649c1.4738 1.651 4.0968 2.7526 7.0877 2.7526 4.6195 0 8.3686-2.6179 8.3686-5.8594v-1.5235c-7.4e-4 -1.1426-0.47444-2.2039-1.283-3.1061z"\n        fill="##FillColor=#e6e6e6##" opacity=".5" />\n    <path\n        d="m14.173 13.001v3.1054c0 2.7389-3.1658 4.9651-7.0855 4.9651-3.9125 2e-5 -7.0877-2.219-7.0877-4.9651v4.6296c1.4738 1.6517 4.0968 2.7526 7.0877 2.7526 4.6195 0 8.3686-2.6179 8.3686-5.8586l-4e-5 -1.5235c-7e-4 -1.1419-0.4744-2.2032-1.283-3.1054z"\n        fill="##FillColor=#d1d1d1##" opacity=".9" />\n    <g>\n        <path\n            d="m14.173 13.001v3.1054c0 2.7389-3.1658 4.9651-7.0855 4.9651-3.9125 2e-5 -7.0877-2.219-7.0877-4.9651v4.6296c1.4738 1.6517 4.0968 2.7526 7.0877 2.7526 4.6195 0 8.3686-2.6179 8.3686-5.8586l-4e-5 -1.5235c-7e-4 -1.1419-0.4744-2.2032-1.283-3.1054z"\n            opacity=".7" />\n        <path\n            d="m14.173 13.001v3.1054c0 2.7389-3.1658 4.9651-7.0855 4.9651-3.9125 2e-5 -7.0877-2.219-7.0877-4.9651v3.1054c1.4738 1.6502 4.0968 2.7526 7.0877 2.7526 4.6195 0 8.3686-2.6179 8.3686-5.8586-7.4e-4 -1.1412-0.47444-2.2025-1.283-3.1047z"\n            opacity=".25" />\n        <ellipse cx="7.0877" cy="16.106" rx="7.087" ry="4.9608" opacity=".25" />\n    </g>\n    <polygon points="2.2032 16.107 3.1961 16.107 3.1961 13.095 6.0156 13.095 10.012 8.8049 3.407 8.8049 2.2032 9.648"\n        fill="##FillColor=#666666##" />\n    <polygon points="11.215 9.0338 7.4117 13.095 11.06 13.095 11.06 16.107 11.974 16.107 11.974 8.5241 10.778 8.5241"\n        fill="##FillColor=#666666##" />\n    <path\n        d="m14.173 13.001v-5.9126c0-3.9132-3.168-7.0884-7.0855-7.0884-3.9125 0-7.0877 3.1694-7.0877 7.0884v13.649c1.4738 1.651 4.0968 2.7526 7.0877 2.7526 4.6195 0 8.3686-2.6179 8.3686-5.8594v-1.5235c-7.4e-4 -1.1426-0.47444-2.2039-1.283-3.1061z"\n        fill="##FillColor=#01c16e##" opacity=".65" />\n    <g fill="##FillColor=#ffffff##">\n        <path\n            d="m10.388 3.7541 1.4364-0.2736c-0.84168-1.1318-2.0822-1.9577-3.5417-2.2385l0.25416 1.0807c0.76388 0.27072 1.4068 0.78048 1.8511 1.4314z"\n            opacity=".5" />\n        <path\n            d="m0.76824 19.926v1.5199c0.64872 0.5292 1.4335 0.97632 2.3076 1.3169v-1.525c-0.8784-0.33624-1.6567-0.78194-2.3076-1.3118z"\n            opacity=".5" />\n        <path\n            d="m11.073 20.21c-0.2556 0.1224-0.52992 0.22968-0.80568 0.32976-0.05832 0.01944-0.11736 0.04032-0.17784 0.05832-0.56376 0.17928-1.1614 0.31896-1.795 0.39456-0.07488 0.0094-0.1512 0.01872-0.22464 0.01944-0.3204 0.03024-0.64368 0.05832-0.97056 0.05832-0.14832 0-0.30744-0.01512-0.4716-0.02376-1.2002-0.05688-2.3306-0.31464-3.2976-0.73944l-2e-5 -8.3895v-4.8254c0-1.471 0.84816-2.7295 2.0736-3.3494l-0.02232-0.05328-1.2478-1.512c-1.6697 1.003-2.79 2.8224-2.79 4.9118v11.905c-0.04968-0.04968-0.30816-0.30888-0.48024-0.52992l-0.30744 0.6876c1.4011 1.4818 3.8088 2.4617 6.5426 2.4617 1.6798 0 3.2371-0.37368 4.5115-1.0022l-0.52704-0.40896-0.01006 0.0072z"\n            opacity=".5" />\n    </g>\n</g>\n'}static RoomHumiditySvgData(){return'\n<g transform="scale(2.8,2.8) translate(2,2)">\n    <g transform="translate(-6.9915256,-6.9915256)">\n        <circle r="8.6263752" cy="16" cx="16" style="\n          opacity: 1;\n          fill: ##FillColor=#659dc5##;\n          fill-opacity: 1;\n          fill-rule: nonzero;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 0.764198;\n          stroke-linecap: butt;\n          stroke-linejoin: round;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        " />\n        <g transform="matrix(0.29971746,0,0,0.29971746,20.655088,20.220855)" style="\n          font-style: normal;\n          font-weight: normal;\n          font-size: 51.4601px;\n          line-height: 125%;\n          font-family: Sans;\n          letter-spacing: 0px;\n          word-spacing: 0px;\n          fill: ##StrokeColor=#000000##;\n          fill-opacity: 1;\n          stroke: none;\n          stroke-width: 1px;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-opacity: 1;\n        ">\n            <path\n                d="m -29.828843,-32.840076 h 5.075651 v 15.377717 h 18.4432096 v -15.377717 h 5.0756516 V 4.6745172 H -6.3099824 V -13.190771 H -24.753192 V 4.6745172 h -5.075651 z" />\n        </g>\n    </g>\n</g>\n    '}static RoomTemperatureSvgData(){return'\n<g transform="scale(2.8,2.8) translate(2,2)">\n    <g transform="matrix(0.76419842,0,0,0.76419842,-3.2187002,-3.2187002)">\n        <circle r="11.288136" cy="16" cx="16" style="\n          opacity: 1;\n          fill: ##FillColor=#659dc5##;\n          fill-opacity: 1;\n          fill-rule: nonzero;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 1;\n          stroke-linecap: butt;\n          stroke-linejoin: round;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        " />\n        <g transform="translate(32.100664,13.086915)" style="\n          font-style: normal;\n          font-weight: normal;\n          font-size: 20.2897px;\n          line-height: 125%;\n          font-family: Sans;\n          letter-spacing: 0px;\n          word-spacing: 0px;\n          fill: ##StrokeColor=#000000##;\n          fill-opacity: 1;\n          stroke: none;\n          stroke-width: 1px;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-opacity: 1;\n        ">\n            <path\n                d="m -22.356997,-4.4825641 h 12.5126658 v 1.6842067 H -15.095093 V 10.308734 h -2.011141 V -2.7983574 h -5.250763 z" />\n        </g>\n    </g>\n</g>\n    '}static TemperatureSvgData(){return'\n<g transform="scale(2.8,2.8) translate(6,0)">\n    <g id="layer1" stroke="##StrokeColor=#000000##" stroke-width="1px" transform="translate(-10.804626,-9.2243756)">\n        <rect id="rect3012" height="14.505" width="2.901" y="9.9127998" x="14.557" fill="#ffff00" />\n        <path id="path3010" stroke-width="1.2px" transform="matrix(0.74098,0,0,0.74098,7.3047,15.679)"\n            fill="##FillColor=#659dc5##"\n            d="m 17.949,15.898 -3.1021,5.373 H 8.6427 L 5.5406,15.898 8.6427,10.525 h 6.2042 z" />\n    </g>\n    <g id="g4141" transform="translate(-1.2033861,-8.1217684)">\n        <circle r="0.77312505" cy="28.129852" cx="6.4061227" id="path4137" style="\n          fill: none;\n          fill-opacity: 1;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 0.5;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        " />\n        <path id="path4139" d="M 6.4061205,27.157211 V 23.65349" style="\n          fill: none;\n          fill-rule: evenodd;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 0.5;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        " />\n    </g>\n</g>\n    '}static BoilerSvgData(){return'\n<g transform="scale(1.6,1.6) translate(3,3)">\n    <path style="\n        fill: ##FillColor=#659dc5##;\n        fill-opacity: 1;\n        fill-rule: nonzero;\n        stroke: ##StrokeColor=#000000##;\n        stroke-width: 1;\n        stroke-linecap: butt;\n        stroke-linejoin: miter;\n        stroke-miterlimit: 4;\n        stroke-dasharray: none;\n        stroke-opacity: 1;\n      " d="m 2,15 8,-7 0,-7 12,0 0,7 8,7 0,16 -28,0 z"></path>\n</g>\n  '}static HeatpumpSvgData(){return'\n<g transform="scale(1.6,1.6) translate(3,3)">\n    <g class="heat-pump" stroke-linejoin="round" stroke="##StrokeColor=#000000##" transform="translate(39 -2.3842e-7)"\n        fill="##FillColor=#659dc5##">\n        <rect class="inner" height="27.718" width="27.718" y="2.141" x="-36.859" stroke-width="1.0868"></rect>\n        <g transform="matrix(1.0276 0 0 1.0276 -39.441 -.44130)" stroke-linecap="round" stroke-miterlimit="1"\n            stroke-width="1.3509">\n            <path d="m16.234 16.944 8.6837-6.894-8.6837-6.894v3.447h-13.152v6.894h13.152z" fill="#ce2824">\n            </path>\n            <path d="m15.766 28.844-8.6837-6.894 8.6837-6.894v3.447h13.152v6.894h-13.152z" fill="#3238db">\n            </path>\n        </g>\n    </g>\n</g>\n    '}static PumpSvgData(){return'\n<g transform="scale(2.5,2.5) translate(1,1)">\n    <g fill="##FillColor=#659dc5##" transform="translate(-5.4940996,-5.5390997)">\n        <g class="pump">\n            <circle stroke="##StrokeColor=#000000##" cy="16" cx="15.955" r="9.9609003" class="pump-background" />\n            <g transform="translate(16,16)">\n                <path d="M -5,8.1369 V -8.1191 L 9.078,0.0091 Z" class="rotating-middle" stroke="##StrokeColor=#000000##"\n                    stroke-width="0.96719" />\n            </g>\n        </g>\n    </g>\n</g>\n    '}static ValveThreeWaySvgData(){return'\n<g transform="scale(2,2.3) translate(4,4)">\n    <g transform="matrix(1,0,0,-1,-4.3773334,22.894063)">\n        <g stroke-linejoin="round" stroke="##StrokeColor=#000000##" class="twv" fill="##FillColor=#659dc5##">\n            <g stroke-linecap="round">\n                <path d="M 16,16 4.925,22.3941 V 9.6061 Z" />\n                <path d="m 16,16 11.075,6.3941 V 9.6061 Z" />\n                <path d="M 16,16 9.606,4.925 h 12.788 z" />\n            </g>\n            <g class="blocker-wrapper">\n                <g class="blocker" fill="#000000" transform="translate(16,16)">\n                    <path stroke-width="0.80716"\n                        d="m 0,-9.6108 a 8.8788,8.8788 0 0 0 -6.0273,2.375 l 1.6172,2.8008 A 5.7576,5.7576 0 0 1 0,-6.4897 5.7576,5.7576 0 0 1 4.4062,-4.4292 L 6.0293,-7.2397 A 8.8788,8.8788 0 0 0 0,-9.6108 Z" />\n                </g>\n            </g>\n        </g>\n        <path d="M 6.7797,10.576 V 21.084" stroke="##StrokeColor=#000000##" stroke-width="1px" fill="none" />\n    </g>\n</g>\n    '}static ValveTwoWaySvgData(){return'\n<g transform="scale(2.2,2.9) translate(2,4)">\n    <g stroke-linejoin="round" fill-rule="nonzero" transform="translate(-3.8922957,-7.3951286)"\n        stroke="##StrokeColor=#000000##" stroke-linecap="round" stroke-dasharray="none" stroke-miterlimit="4"\n        stroke-width="1" fill="##FillColor=#659dc5##">\n        <path d="M 10.068,7.9344 -1.007,14.3285 V 1.5405 Z" transform="translate(5.3992957,6.473236)" />\n        <path d="M 10.068,7.9344 -1.007,14.3285 V 1.5405 Z" transform="matrix(-1,0,0,1,25.341517,6.354592)" />\n    </g>\n</g>\n    '}static DuctSvgData(){return""}static FanSvgData(){return'\n<g transform="scale(1.6,1.6) translate(2,6)">\n    <g fill="##FillColor=#659dc5##" transform="matrix(1, 0, 0, 1, -0.231, -4.151388)">\n        <g class="fan">\n            <g id="g8">\n                <path class="fan-background"\n                    d="m12.297 5.154c-6.117 0-11.066 4.9492-11.066 11.066 0 6.117 4.9492 11.066 11.066 11.066 5.7137 0 10.408-4.3091 11.003-9.8647h7.525v-12.268h-18.148c-0.12601-0.0043-0.25236 0-0.37941 0z"\n                    fill-rule="evenodd" stroke="##StrokeColor=#000000##" stroke-width="1px"\n                    fill="##FillColor=#659dc5##" />\n            </g>\n            <g id="g4148" transform="translate(12.464 16.395)">\n                <g id="g4162" stroke="##StrokeColor=#000000##" stroke-width="1.5" fill="none" class="rotating-middle">\n                    <path id="use3009" d="m-1.8112-3.9787 3.6227-4.4971" />\n                    <path id="use3011" d="m0.87376-4.2835 5.5741-1.5089" />\n                    <path id="use3013" d="m3.2243-2.9521 5.3965 2.0557" />\n                    <path id="use3015" d="m4.3433-0.4935 3.1575 4.835" />\n                    <path id="use3017" d="m3.8043 2.1547-0.28747 5.7676" />\n                    <path id="use3019" d="m1.8113 3.9787-3.6227 4.4971" />\n                    <path id="use3021" d="m-0.87324 4.2837-5.5741 1.5089" />\n                    <path id="use3023" d="m-3.2242 2.9527-5.3965-2.0559" />\n                    <path id="use3025" d="m-4.3432 0.4935-3.158-4.8353" />\n                    <path id="use3027" d="m-3.8032-2.1541 0.2875-5.7676" />\n                </g>\n            </g>\n        </g>\n    </g>\n</g>\n    '}static CoolingCoilSvgData(){return'\n<g transform="scale(2,2) translate(5.5,0)">\n    <g stroke="##StrokeColor=#000000##" transform="matrix(1, 0, 0, 1, -6.058399, -1.3729)">\n        <rect id="rect4367" height="27.246" width="17.868" x="7.066" y="2.3772" fill="##FillColor=#659dc5##" />\n        <g transform="translate(24.9334,29.6232) rotate(180)">\n            <rect id="rect4367" class="cooling-coil" height="27.246" width="17.875" x="0" y="0"\n                fill="##FillColor=#659dc5##" stroke="none" />\n        </g>\n        <rect id="rect4367" height="27.246" width="17.868" x="7.066" y="2.3772" fill="none" />\n        <path id="path3001" d="m7.322 2.3729 17.424 27.254" stroke-width="1px" fill="none" />\n        <path id="path3003" d="m24.929 2.3734-17.642 27.182" stroke-width="1px" fill="none" />\n    </g>\n</g>\n    '}static HeatingCoilSvgData(){return'\n<g transform="scale(2,2) translate(5.5,0)">\n    <defs id="defs3">\n        <rect id="heating-coil-rect" height="27.246" width="17.868" x="0" y="0" />\n    </defs>\n    <g stroke="##StrokeColor=#000000##" id="g15" transform="translate(-6.129206,-1.5327875)">\n        <use xlink:href="#heating-coil-rect" fill="##FillColor=#659dc5##" stroke="none" x="7.066" y="2.3771999"\n            id="use6" />\n        <g transform="rotate(180,12.4667,14.8116)" id="g10">\n            <use xlink:href="#heating-coil-rect" class="heating-coil" x="0" y="0" fill="##FillColor=#659dc5##"\n                stroke="none" id="use8" />\n        </g>\n        <use xlink:href="#heating-coil-rect" stroke-width="1" fill="none" x="7.066" y="2.3771999" id="use12" />\n        <path id="path3003" stroke-linejoin="miter" d="M 24.929,2.3734 7.2868,29.555" stroke="##StrokeColor=#000000##"\n            stroke-linecap="butt" stroke-width="1px" fill="none" />\n    </g>\n</g>\n    '}static FilterSvgData(){return'\n<g transform="scale(2,2) translate(9,0)">\n    <g stroke="##StrokeColor=#000000##" stroke-width="1" transform="matrix(1, 0, 0, 1, -9.37, -1.3252)">\n        <rect id="rect4367" height="27.35" width="11.26" y="2.3252" x="10.37" fill="##FillColor=#659dc5##" />\n        <path id="path3756" stroke-linejoin="miter"\n            d="m11.892,2.6997,8.2165,4.4334-8.2165,4.4334,8.2165,4.4334-8.2165,4.4334,8.2165,4.4334-8.2165,4.4334"\n            stroke-linecap="round" stroke-miterlimit="4" stroke-dasharray="none" stroke-width="1.2694304" fill="none" />\n    </g>\n</g>\n    '}static HumidifierSvgData(){return'\n<g transform="scale(2.2,2.2) translate(5,2)">\n    <g class="duct-humidifier" transform="matrix(1, 0, 0, 1, -3.324199, -7.877)">\n        <g id="g11" transform="translate(0 5.1505)">\n            <g id="g13" stroke="##StrokeColor=#000000##" stroke-width=".5" class="water-drops"\n                fill="#00f0ff">\n                <path id="path4150"\n                    d="m14.291 6.7851c0.46542-0.0958 0.69019-0.27099 0.99164-0.49615 0.10429-0.07789 0.23068-0.12587 0.37088-0.12587 0.34281 0 0.62078 0.27918 0.62078 0.62199s-0.27796 0.61956-0.62078 0.61956c-0.13834 0-0.26988-0.0428-0.37088-0.1222-0.29895-0.23498-0.52493-0.40696-0.99168-0.49732z" />\n                <g id="g4236" transform="translate(0 .17167)">\n                    <path id="path4150-7"\n                        d="m18.179 5.3612c0.46542-0.0958 0.69019-0.27099 0.99164-0.49615 0.10429-0.07789 0.23068-0.12587 0.37088-0.12587 0.34281 0 0.62078 0.27918 0.62078 0.62199s-0.27796 0.61956-0.62078 0.61956c-0.13834 0-0.26988-0.0428-0.37088-0.1222-0.29895-0.23498-0.52493-0.40696-0.99168-0.49732z" />\n                    <path id="path4150-7-1"\n                        d="m18.234 7.8656c0.46542-0.0958 0.69019-0.27099 0.99164-0.49615 0.10429-0.07789 0.23068-0.12587 0.37088-0.12587 0.34281 0 0.62078 0.27918 0.62078 0.62199s-0.27796 0.61956-0.62078 0.61956c-0.13834 0-0.26988-0.0428-0.37088-0.1222-0.29895-0.23498-0.52493-0.40696-0.99168-0.49732z" />\n                </g>\n            </g>\n            <g id="g19" transform="translate(0,8)">\n                <g id="g21" stroke="##StrokeColor=#000000##" stroke-width=".5" class="water-drops water-drops-2"\n                    fill="#00f0ff">\n                    <path id="path23"\n                        d="m14.291 6.7851c0.46542-0.0958 0.69019-0.27099 0.99164-0.49615 0.10429-0.07789 0.23068-0.12587 0.37088-0.12587 0.34281 0 0.62078 0.27918 0.62078 0.62199s-0.27796 0.61956-0.62078 0.61956c-0.13834 0-0.26988-0.0428-0.37088-0.1222-0.29895-0.23498-0.52493-0.40696-0.99168-0.49732z" />\n                    <g id="g25" transform="translate(0 .17167)">\n                        <path id="path27"\n                            d="m18.179 5.3612c0.46542-0.0958 0.69019-0.27099 0.99164-0.49615 0.10429-0.07789 0.23068-0.12587 0.37088-0.12587 0.34281 0 0.62078 0.27918 0.62078 0.62199s-0.27796 0.61956-0.62078 0.61956c-0.13834 0-0.26988-0.0428-0.37088-0.1222-0.29895-0.23498-0.52493-0.40696-0.99168-0.49732z" />\n                        <path id="path29"\n                            d="m18.234 7.8656c0.46542-0.0958 0.69019-0.27099 0.99164-0.49615 0.10429-0.07789 0.23068-0.12587 0.37088-0.12587 0.34281 0 0.62078 0.27918 0.62078 0.62199s-0.27796 0.61956-0.62078 0.61956c-0.13834 0-0.26988-0.0428-0.37088-0.1222-0.29895-0.23498-0.52493-0.40696-0.99168-0.49732z" />\n                    </g>\n                </g>\n            </g>\n        </g>\n        <path id="rect4136-6" class="humidifier-body"\n            d="m4.3242 8.877v22.586h4.0059v-9.883h4.3789v-2.617h-4.3789v-5.721h4.3789v-2.617h-4.3789v-1.748h-4.0059z"\n            stroke="##StrokeColor=#000000##" fill="##FillColor=#659dc5##" />\n    </g>\n</g>\n    '}static HumiditySvgData(){return'\n<g transform="scale(2.5,2.5) translate(8,0)">\n    <rect style="\n        fill: #00d1ff;\n        fill-opacity: 1;\n        fill-rule: nonzero;\n        stroke: ##StrokeColor=#000000##;\n        stroke-width: 1px;\n      " x="3.660192" y="0.5" width="2.901" height="14.505" />\n    <path style="fill: ##FillColor=#659dc5##; stroke: ##StrokeColor=#000000##; stroke-width: 0.889176px"\n        d="m 9.7077419,18.0463 -2.298594,3.981286 H 2.8119599 L 0.51336587,18.0463 2.8119599,14.065014 h 4.597188 z" />\n    <g transform="translate(-10.962785,-9.3157224)">\n        <g>\n            <path\n                d="m 17.43357,24.668533 c 0.0958,0.465416 0.27099,0.690186 0.496151,0.991638 0.07789,0.10429 0.125868,0.230683 0.125868,0.370878 0,0.342813 -0.279183,0.620776 -0.621988,0.620776 -0.342814,0 -0.619564,-0.277963 -0.619564,-0.620776 0,-0.138342 0.0428,-0.269876 0.1222,-0.370878 0.234976,-0.29895 0.406955,-0.524932 0.497324,-0.991677 z"\n                style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 0.5;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n            stroke-opacity: 1;\n          " />\n            <path\n                d="m 17.43357,27.878474 c 0.0958,0.465416 0.27099,0.690186 0.496151,0.991638 0.07789,0.10429 0.125868,0.230683 0.125868,0.370878 0,0.342813 -0.279183,0.620776 -0.621988,0.620776 -0.342814,0 -0.619564,-0.277963 -0.619564,-0.620776 0,-0.138342 0.0428,-0.269876 0.1222,-0.370878 0.234976,-0.29895 0.406955,-0.524932 0.497324,-0.991677 z"\n                style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 0.5;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n            stroke-opacity: 1;\n          " />\n        </g>\n        <g transform="translate(0,0.107786)">\n            <path\n                d="m 14.710621,24.560747 c 0.0958,0.465416 0.27099,0.690186 0.496151,0.991638 0.07789,0.10429 0.125868,0.230683 0.125868,0.370878 0,0.342813 -0.279183,0.620776 -0.621988,0.620776 -0.342814,0 -0.619564,-0.277963 -0.619564,-0.620776 0,-0.138342 0.0428,-0.269876 0.1222,-0.370878 0.234976,-0.29895 0.406955,-0.524932 0.497324,-0.991677 z"\n                style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 0.5;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n            stroke-opacity: 1;\n          " />\n            <path\n                d="m 14.710621,27.770688 c 0.0958,0.465416 0.27099,0.690186 0.496151,0.991638 0.07789,0.10429 0.125868,0.230683 0.125868,0.370878 0,0.342813 -0.279183,0.620776 -0.621988,0.620776 -0.342814,0 -0.619564,-0.277963 -0.619564,-0.620776 0,-0.138342 0.0428,-0.269876 0.1222,-0.370878 0.234976,-0.29895 0.406955,-0.524932 0.497324,-0.991677 z"\n                style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 0.5;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n            stroke-opacity: 1;\n          " />\n        </g>\n    </g>\n</g>\n    '}static PressureSvgData(){return'\n<g transform="scale(1.5,1.6) translate(6,6)">\n    <path style="fill: ##FillColor=#659dc5##; stroke: ##StrokeColor=#000000##; stroke-width: 1.29098px"\n        d="M 21.101011,20.624556 17.76371,26.404938 H 11.089107 L 7.7518058,20.624556 11.089107,14.844174 h 6.674603 z" />\n    <g transform="matrix(0.39332133,0,0,0.5366036,8.3312906,37.286552)">\n        <g transform="translate(0,0.03745956)">\n            <path style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 1.30927;\n            stroke-linecap: round;\n            stroke-linejoin: round;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n          " d="m 16.929663,-31.088307 4.3966,-1.150699 v 2.301399 z" stroke-miterlimit="4" />\n            <path style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 1;\n            stroke-linecap: butt;\n            stroke-linejoin: miter;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n          " d="M 27.541431,-31.088307 H 18.912663" />\n        </g>\n        <path d="m 15.532379,-39.152447 v 16.2032" style="\n          fill: none;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 1px;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n        " />\n        <g transform="matrix(-1,0,0,1,-1.8983044,-0.27118644)">\n            <path style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 1.30927;\n            stroke-linecap: round;\n            stroke-linejoin: round;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n          " d="m -15.961713,-30.779661 4.3966,-1.150699 v 2.301399 z" stroke-miterlimit="4" />\n            <path style="\n            fill: none;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 1;\n            stroke-linecap: butt;\n            stroke-linejoin: miter;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n          " d="M -5.3499446,-30.779661 H -13.978713" />\n        </g>\n    </g>\n    <g transform="translate(-1.5131572,-0.15657804)">\n        <path d="M 2.0131572,0.15657804 V 6.9638416 H 14.573291 v 8.3199894" style="\n          fill: none;\n          fill-rule: evenodd;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 1;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        " />\n        <path d="M 29.865974,0.15657812 V 6.9638416 H 17.305841 v 8.3199894" style="\n          fill: none;\n          fill-rule: evenodd;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 1;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        " />\n    </g>\n</g>\n      '}static DamperSvgData(){return'\n<g transform="scale(2,2) translate(10,0)">\n    <rect class="damper" height="27.5" width="12" stroke="##StrokeColor=#000000##" stroke-miterlimit="4" x="0.69481522"\n        y="0.67645228" stroke-dasharray="none" stroke-width="1" fill="##FillColor=#659dc5##" />\n    <g stroke="##StrokeColor=#000000##" stroke-width="1.5px" transform="translate(-9.3051848,-1.5735477)">\n        <g transform="translate(16,7)">\n            <line x1="-5" x2="5" y1="0" y2="0" transform="rotate(-35)" class="damper-line" />\n        </g>\n        <g transform="translate(16,13)">\n            <line x1="-5" x2="5" y1="0" y2="0" transform="rotate(-35)" class="damper-line" />\n        </g>\n        <g transform="translate(16,19)">\n            <line x1="-5" x2="5" y1="0" y2="0" transform="rotate(-35)" class="damper-line" />\n        </g>\n        <g transform="translate(16,25)">\n            <line x1="-5" x2="5" y1="0" y2="0" transform="rotate(-35)" class="damper-line" />\n        </g>\n    </g>\n    <g stroke-linejoin="miter" transform="matrix(1.2268237,0,0,0.94845469,-13.299764,-1.1862851)"\n        stroke="##StrokeColor=#000000##" stroke-linecap="butt" fill="none">\n        <path stroke-width="1.06273px" d="m 16.298,2.2402 v 28.442" />\n    </g>\n</g>\n    '}static Temperature2SvgData(){return""}static ThermalWheelSvgData(){return'\n<g transform="scale(1.4,1.2) translate(9,8)">\n    <g stroke="##StrokeColor=#000000##" fill="##FillColor=#659dc5##" transform="translate(-2.370089)">\n        <rect class="thermal-wheel-background" height="40" width="25.5" y="-4" x="3" fill="inherit" stroke-width="1" />\n        <g class="thermal-wheel" stroke-width="1">\n            <line x1="3" x2="28.5" y1="-4" y2="-4" />\n            <line x1="3" x2="28.5" y1="0" y2="0" />\n            <line x1="3" x2="28.5" y1="4" y2="4" />\n            <line x1="3" x2="28.5" y1="8" y2="8" />\n            <line x1="3" x2="28.5" y1="12" y2="12" />\n            <line x1="3" x2="28.5" y1="16" y2="16" />\n            <line x1="3" x2="28.5" y1="20" y2="20" />\n            <line x1="3" x2="28.5" y1="24" y2="24" />\n            <line x1="3" x2="28.5" y1="28" y2="28" />\n            <line x1="3" x2="28.5" y1="32" y2="32" />\n            <line x1="3" x2="28.5" y1="36" y2="36" />\n        </g>\n    </g>\n</g>\n    '}static EnthalpySvgData(){return'\n<g transform="scale(2.8,2.4) translate(5,1)">\n    <defs>\n        <linearGradient id="linearGradient4194">\n            <stop style="stop-color: #ffff00; stop-opacity: 1" offset="0" id="stop4196" />\n            <stop id="stop4148" offset="0.3598454" style="stop-color:#ffff00; stop-opacity: 1" />\n            <stop id="stop4144" offset="0.59441435" style="stop-color: #00ffff; stop-opacity: 1" />\n            <stop style="stop-color: #00ffff; stop-opacity: 1" offset="1" id="stop4198" />\n        </linearGradient>\n        <linearGradient xlink:href="#linearGradient4194" id="linearGradient4219" x1="15.955305" y1="9.504283"\n            x2="16.127491" y2="24.826317" gradientUnits="userSpaceOnUse"\n            gradientTransform="translate(-10.896808,-9.4127998)" />\n    </defs>\n    <rect style="\n        fill: url(#linearGradient4219);\n        fill-opacity: 1;\n        fill-rule: nonzero;\n        stroke: ##StrokeColor=#000000##;\n        stroke-width: 1px;\n      " x="3.660192" y="0.5" width="2.901" height="14.505" id="rect3012" />\n    <path style="fill: ##FillColor=#659dc5## ; stroke: ##StrokeColor=#000000##; stroke-width: 0.889176px"\n        d="m 9.7077419,18.0463 -2.298594,3.981286 H 2.8119599 L 0.51336587,18.0463 2.8119599,14.065014 h 4.597188 z" />\n    <g transform="translate(-10.733726,-9.4127998)">\n        <g transform="translate(8.1630559,0.95878887)">\n            <circle style="\n            fill: none;\n            fill-opacity: 1;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 0.5;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n            stroke-opacity: 1;\n          " id="path4137" cx="6.4061227" cy="28.129852" r="0.77312505" />\n            <path style="\n            fill: none;\n            fill-rule: evenodd;\n            stroke: ##StrokeColor=#000000##;\n            stroke-width: 0.5;\n            stroke-linecap: butt;\n            stroke-linejoin: miter;\n            stroke-miterlimit: 4;\n            stroke-dasharray: none;\n            stroke-opacity: 1;\n          " d="M 6.4061205,27.157211 V 23.65349" />\n        </g>\n        <path style="\n          fill: none;\n          stroke:##StrokeColor=#000000##;\n          stroke-width: 0.5;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        "\n            d="m 17.270488,24.668533 c 0.0958,0.465416 0.27099,0.690186 0.496151,0.991638 0.07789,0.10429 0.125868,0.230683 0.125868,0.370878 0,0.342813 -0.279183,0.620776 -0.621988,0.620776 -0.342814,0 -0.619564,-0.277963 -0.619564,-0.620776 0,-0.138342 0.0428,-0.269876 0.1222,-0.370878 0.234976,-0.29895 0.406955,-0.524932 0.497324,-0.991677 z" />\n        <path style="\n          fill: none;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 0.5;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        "\n            d="m 17.270488,27.878474 c 0.0958,0.465416 0.27099,0.690186 0.496151,0.991638 0.07789,0.10429 0.125868,0.230683 0.125868,0.370878 0,0.342813 -0.279183,0.620776 -0.621988,0.620776 -0.342814,0 -0.619564,-0.277963 -0.619564,-0.620776 0,-0.138342 0.0428,-0.269876 0.1222,-0.370878 0.234976,-0.29895 0.406955,-0.524932 0.497324,-0.991677 z" />\n    </g>\n</g>\n    '}static FlowSvgData(){return'\n<g transform="scale(2.7,2.5) translate(7,2)">\n    <defs>\n        <linearGradient id="linearGradient4194">\n            <stop style="stop-color: #ffff00; stop-opacity: 1" offset="0" />\n            <stop style="stop-color: currentColor; stop-opacity: 1" offset="1" />\n        </linearGradient>\n    </defs>\n    <path style="fill: ##FillColor=#659dc5##; stroke: ##StrokeColor=#000000##; stroke-width: 0.889176px"\n        d="m 9.7077419,16.908637 -2.298594,3.981286 H 2.8119599 L 0.51336587,16.908637 2.8119599,12.927351 h 4.597188 z" />\n    <g transform="matrix(0.83920236,0,0,0.83920236,-8.3130944,-6.3365267)">\n        <path id="path4146" d="m 14.917284,30.513877 v -5.217284 h 2.569115" style="\n          fill: none;\n          fill-rule: evenodd;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 0.824475px;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-opacity: 1;\n        " />\n        <path d="m 14.956808,27.549512 h 2.529591" style="\n          fill: none;\n          fill-rule: evenodd;\n          stroke: ##StrokeColor=#000000##;\n          stroke-width: 0.824475px;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-opacity: 1;\n        " />\n    </g>\n    <path style="\n        fill: none;\n        fill-rule: evenodd;\n        stroke: ##StrokeColor=#000000##;\n        stroke-width: 1px;\n        stroke-linecap: butt;\n        stroke-linejoin: miter;\n        stroke-opacity: 1;\n      " d="M 5.1629049,12.964256 V 0.5 H 0.56071887" />\n    <path style="\n        fill: none;\n        fill-rule: evenodd;\n        stroke: ##StrokeColor=#000000##;\n        stroke-width: 1px;\n        stroke-linecap: butt;\n        stroke-linejoin: miter;\n        stroke-opacity: 1;\n      " d="m 5.0190869,8.889403 h 2.205215 v 4.122792" />\n</g>\n    '}static GuageSvgData(){return""}static DialSvgData(){return""}static ValueSvgData(){return""}static IconWithTitleSvgData(){return""}static TestSvg(){}static Test1SvgData(){return'\n<g>\n    <g width="13.667" height="10.167" transform="scale(1,1) translate(0,20.833)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="13.667" height="10.167" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="13.667" height="10.167" />\n        </g>\n    </g>\n    <g width="13.667" height="10.167" transform="scale(1,1) translate(56.833,21.167)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="13.667" height="10.167" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="13.667" height="10.167" />\n        </g>\n    </g>\n    <g width="13.667" height="10.167" transform="rotate(270,34.667,6.75) scale(1,1) translate(27.833,1.667)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="13.667" height="10.167" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="13.667" height="10.167" />\n        </g>\n    </g>\n    <g width="46.167" height="25.5" transform="scale(1,1) translate(12,12.667)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="46.167" height="25.5" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="46.167" height="25.5" />\n        </g>\n    </g>\n</g>\n    '}};let ms=Ss;a(ms,"DuctSvg",class{static GetSvgFrame(t){var e={width:60,height:60};switch(t){case"Duct1":case"Duct3":case"Duct5":e={width:68.5,height:29.67};break;case"Duct2":e={width:76,height:21.83};break;case"Duct4":e={width:68.5,height:30.67};break;case"Duct6":e={width:66.33,height:38.5};break;case"Duct7":case"Duct8":e={width:30,height:60};break;case"Duct9":e={width:60,height:60};break;case"Duct10":case"Duct11":case"Duct12":e={width:0,height:0}}return e}static Duct1Data(){return'\n<g>\n    <g width="19.833" height="0" transform="scale(1,1) translate(0.5,14.5)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L19.833,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="18.667" height="0" transform="scale(1,1) translate(48.333,14.5)">\n        <g transform="scale(1,1)\ntranslate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##" stroke-opacity="1">\n            <path d="M0,0 L18.667,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="rotate(270,33.667,14.333) scale(1,1) translate(19.333,0)">\n        <g width="28.667" height="28.667" transform="scale(1,1) translate(0,0)" stroke="##LineColor=#000000##"\n            stroke-width="##LineThick=1##" stroke-dasharray="none" fill="##FillColor=#FFFFFF##" fill-opacity="1"\n            stroke-opacity="1">\n            <ellipse rx="14.3335" ry="14.3335" cx="14.3335" cy="14.3335" />\n        </g>\n    </g>\n    <g width="20.333" height="20.333" transform="scale(1,1) translate(23.5,4.167)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,20.333\nL20.333,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,19.333L1,19.333L1,21.333L-1,21.333z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="20.333" height="20.333" transform="scale(1,1) translate(23.5,4.167)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0\nL20.333,20.333" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n</g>\n    '}static Duct2Data(){return'\n<g>\n    <g width="35.833" height="20.833" transform="scale(1,1) translate(19.5,0)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="35.833" height="20.833" transform="scale(1,1)\ntranslate(0,0)" fill="##FillColor=#FFFFFF##" fill-opacity="1" stroke-opacity="1">\n            <rect width="35.833" height="20.833" />\n        </g>\n    </g>\n    <g width="28.167" height="0" transform="scale(1,1)\ntranslate(0.5,10.333)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L28.167,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="28.167" height="0" transform="scale(1,1) translate(46.333,10.333)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L28.167,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n</g>\n    '}static Duct3Data(){return'\n<g>\n    <g width="19.833" height="0" transform="scale(1,1) translate(0.5,14.833)">\n        <g transform="scale(1,1)\ntranslate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##" stroke-opacity="1">\n            <path d="M0,0 L19.833,0" fill="none" stroke-width="##LineThick=1##" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="18.667" height="0" transform="scale(1,1)\ntranslate(48.333,14.833)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L18.667,0" fill="none" stroke-width="##LineThick=1##" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="rotate(270,33.667,14.833) scale(1,1) translate(19.333,0.5)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="28.667" height="28.667" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="28.667" height="28.667" />\n        </g>\n    </g>\n</g>\n    '}static Duct4Data(){return'\n<g>\n    <g width="19.833" height="0" transform="scale(1,1) translate(0.5,14.833)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L19.833,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="18.667" height="0" transform="scale(1,1) translate(48.333,14.833)">\n        <g transform="scale(1,1)\ntranslate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##" stroke-opacity="1">\n            <path d="M0,0 L18.667,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="rotate(270,33.667,14.833) scale(1,1) translate(19.333,0.5)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="28.667" height="28.667" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="28.667" height="28.667" />\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="scale(1,1) translate(19.333,0.5)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0\nL28.667,28.667" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n</g>\n    '}static Duct5Data(){return'\n<g>\n    <g width="19.833" height="0" transform="scale(1,1) translate(0.5,14.833)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L19.833,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="18.667" height="0" transform="scale(1,1) translate(48.333,14.833)">\n        <g transform="scale(1,1)\ntranslate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##" stroke-opacity="1">\n            <path d="M0,0 L18.667,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="rotate(270,33.667,14.833) scale(1,1) translate(19.333,0.5)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="28.667" height="28.667" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="28.667" height="28.667" />\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="scale(1,1) translate(19.333,0.5)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0\nL28.667,28.667" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="28.667" height="28.667" transform="scale(1,1) translate(19.333,0.5)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,28.667\nL28.667,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,27.667L1,27.667L1,29.667L-1,29.667z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n</g>\n    '}static Duct6Data(){return'\n<g>\n    <g width="17.833" height="0" transform="scale(1,1) translate(42.5,21.167)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L17.833,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M17.833,0L17.833,-7" stroke-width="0.5" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="30.833" height="31.5" transform="scale(1,1) translate(11.167,5.5)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=1##" stroke-dasharray="none"\n            width="30.833" height="31.5" transform="scale(1,1) translate(0,0)" fill="##FillColor=#FFFFFF##"\n            fill-opacity="1" stroke-opacity="1">\n            <rect width="30.833" height="31.5" />\n        </g>\n    </g>\n    <g width="30.833" height="31.5" transform="scale(1,1) translate(11.167,5.5)">\n        <g transform="scale(1,1)\ntranslate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##" stroke-opacity="1">\n            <path d="M0,31.5 L30.833,0" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,30.5L1,30.5L1,32.5L-1,32.5z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="30.833" height="31.5" transform="scale(1,1)\ntranslate(11.167,5.5)">\n        <g transform="scale(1,1) translate(0,0)" fill="##LineColor=#000000##" stroke="##LineColor=#000000##"\n            stroke-opacity="1">\n            <path d="M0,0 L30.833,31.5" fill="none" stroke-width="1" stroke-dasharray="none" />\n            <g>\n                <g stroke-dasharray="none">\n                    <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                </g>\n            </g>\n        </g>\n    </g>\n    <g width="16.833" height="15.625" transform="scale(1,1) translate(0,0)">\n        <g stroke="##LineColor=#000000##" opacity="1" stroke-width="##LineThick=0##" stroke-dasharray="none"\n            width="16.833" height="15.625" transform="scale(1,1) translate(0,0)" fill="none" stroke-opacity="1">\n            <rect width="16.833" height="15.625" />\n        </g>\n        <g width="16.833333333333332" height="15.624999046325684" transform="scale(1,1)\ntranslate(0,0)"><text width="16.833333333333332" height="15.624999046325684" transform="scale(1,1)\ntranslate(0,0)" xml:space="preserve">\n                <tspan xml:space="preserve" text-rendering="optimizeSpeed" font-size="13.88888888888889"\n                    font-weight="normal" font-style="normal" fill="#000000" opacity="1" x="0" text-anchor="start"\n                    y="12.5" textLength="6.794277667999268" style="font-family: Arial, Helvetica Neue, Helvetica,\nsans-serif;">F</tspan>\n            </text></g>\n    </g>\n</g>\n    '}static Duct7Data(){return'\n    <g>\n        <g>\n            <g width="30" height="60" transform="rotate(0,0) scale(1,1) translate(0,0)">\n                <g stroke="#000000" opacity="1" stroke-width="1" stroke-dasharray="none" width="30" height="60"\n                    transform="scale(1,1) translate(0,0)" fill="#FFFFFF" fill-opacity="1" stroke-opacity="1">\n                    <rect width="30" height="60" />\n                </g>\n            </g>\n            <g width="30" height="60" transform="scale(1,1) translate(0,0)">\n                <g transform="scale(1,1) translate(0,0)" fill="#000000" stroke="#000000" stroke-opacity="1">\n                    <path d="M0,0 L30,60" fill="none" stroke-width="1" stroke-dasharray="none" />\n                    <g>\n                        <g stroke-dasharray="none">\n                            <path d="M-1,-1L1,-1L1,1L-1,1z" stroke-width="0" fill="none" />\n                        </g>\n                    </g>\n                </g>\n            </g>\n        </g>\n    </g>\n    '}static Duct8Data(){return'\n    <g width="30" height="60" transform="scale(1,1) translate(0,0)">\n        <g transform="scale(1,1) translate(0,0)" fill="#FFFFFF" stroke="#000000" stroke-width="1" stroke-opacity="1">\n            <path d="M 0,0 L30,0 L30,60 L0,60 L0,0" />\n        </g>\n    </g>\n    '}static Duct9Data(){return'\n   <g width="60" height="60" transform="scale(1,1) translate(0,0)">\n        <g transform="scale(1,1) translate(0,0)" fill="#FFFFFF" stroke="#000000" stroke-width="1" stroke-opacity="1">\n\n<path d="\n    M 0,0\n    L 30,0\n    A 30,30 0 0,0 60,30\n    L 60,60\n    A 60,60 0 0,1 0,0\n    " />\n        </g>\n    </g>\n    '}static Duct10Data(){return"\n\n    "}static Duct11Data(){return"\n\n    "}static Duct12Data(){return"\n\n    "}});class bs{SetSelectionTool(t,e){F.Debug("O.ActiveSelection.SetSelectionTool - Input:",{toolType:t,isSticky:e}),Os.RenderAllSVGSelectionStates()}CancelOperation(t){return F.Debug("O.ToolOpt CancelOperation input:",t),this.SetSelectionTool(ys.Tools.Select,!1),Ps.CancelOperation(),F.Debug("O.ToolOpt CancelOperation output: false"),!1}SetDefaultWallThickness(t,e){F.Debug("O.ToolOpt SetDefaultWallThickness input:",t,e);var i=1;ye.docUtil.rulerConfig.useInches||(i=me.Common.MetricConv),e&&(t=e.Data.thick);var o=t*ye.docUtil.rulerConfig.major/(ye.docUtil.rulerConfig.majorScale*i),n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(!ve.IsEqual(n.def.wallThickness,o,.01)||e){ye.opt.CloseEdit(!0,!0),n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0),e||(n.def.wallThickness=o);n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);xs.CompleteOperation()}F.Debug("O.ToolOpt SetDefaultWallThickness output: void")}DrawNewWallShape(t,e){var i;F.Debug("O.ToolOpt DrawNewWallShape input:",t,e);var o=null!=e,n=ye.wallOpt;if(n&&n.AddWall&&(ye.opt.CloseEdit(),n.ToggleAddingWalls(!0),i=n.AddWall(o,e)),o)return F.Debug("O.ToolOpt DrawNewWallShape output:",i),i;F.Debug("O.ToolOpt DrawNewWallShape output: undefined")}StampOrDragDropNewShape(t,e,i){F.Debug("U.ToolUtil.StampOrDragDropNewShape - Input:",t,e),xs.PreDragDropOrStamp();let o=this.StampOrDragDropCallback;ye.opt.stampTimeout=window.setTimeout(o,200,this,e,i),F.Debug("U.ToolUtil.StampOrDragDropNewShape - Output: stampTimeout set")}DrawNewLineShape(t,e,i,o){F.Debug("O.ToolOpt DrawNewLineShape input:",t,e,i,o);let n=!1,s=null;switch(t){case"line":s=this.DrawNewLine(i,0,n,o);break;case"commline":s=this.DrawNewLine(i,1,n,o);break;case"digiline":s=this.DrawNewLine(i,2,n,o);break;case"arcLine":s=this.DrawNewArcLine(n,i,o);break;case"segLine":s=this.DrawNewSegLine(n,i,o);break;case"arcSegLine":s=this.DrawNewArcSegLine(n,i,o);break;case"polyLine":s=this.DrawNewPolyLine(n,i,o);break;case"polyLineContainer":s=this.DrawNewPolyLineContainer(n,i,o);break;case"freehandLine":s=this.DrawNewFreehandLine(n,i,o);break;case"moveWall":s=ye.wallOpt&&ye.wallOpt.AddWall?ye.wallOpt.AddWall(n,o):this.DrawNewLine(i,0,n,o)}F.Debug("O.ToolOpt DrawNewLineShape output:",s)}DrawNewLine(t,e,i,o){F.Debug("O.ToolOpt DrawNewLine input:",t,e,i,o);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data,s=0==(n.def.textflags&Se.TextFlags.HorizText);let a,r=n.d_sarrow,l=n.d_earrow,h=n.d_sarrowdisp,c=n.d_earrowdisp,p=0;switch(e){case me.LineTypes.LsComm:case me.LineTypes.LsDigi:p=.25}r>0!=l>0&&(0===l&&(l=r,c=h),r=0,h=!1),a=o?Oe.DeepCopy(o.Data.attributes):{Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StartArrowID:r,StartArrowDisp:h,EndArrowID:l,EndArrowDisp:c,ArrowSizeIndex:n.d_arrowsize,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:s,Dimensions:n.dimensions,ShortRef:e,shapeparam:p,bOverrideDefaultStyleOnDraw:!0};const d=new rs(a);let u=Oe.DeepCopy(n.def.style);if(o&&o.Data&&o.Data.attributes&&o.Data.attributes.StyleRecord?u=Oe.DeepCopy(o.Data.attributes.StyleRecord):(si.FindStyle(me.Common.TextBlockStyle),u.Text.Paint.Color="#000000"),d.StyleRecord=u,n.flags&me.SessionFlags.AllowHops&&(d.flags=ve.SetFlag(d.flags,Se.ObjFlags.LineHop,!0)),i)return F.Debug("O.ToolOpt DrawNewLine output:",d),d;xs.DrawNewObject(d,t),F.Debug("O.ToolOpt DrawNewLine output: void")}StampOrDragDropCallback(t,e,i){var o;F.Debug("O.ToolOpt StampOrDragDropCallback input:",t,e);var n=tn.ShapeTypes;switch(ye.opt.stampTimeout=null,o=!0,e){case"textLabel":t.StampTextLabel(!1,!1);break;case n.RECTANGLE:t.DrawRectangle(o,!1);break;case n.ROUNDED_RECTANGLE:t.StampRoundRect(o,!1);break;case n.CIRCLE:t.DrawCircle(o,!0);break;case n.OVAL:t.DrawCircle(o,!1);break;case n.ForeignObject:t.StampVueComponent(o,i);break;default:t.StampShape(e,o)}F.Debug("O.ToolOpt StampOrDragDropCallback output: void")}DrawRectangle(t,e){ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const i={Frame:{x:-1e3,y:-1e3,width:e?me.Common.ShapeSquare:me.Common.ShapeWidth,height:e?me.Common.ShapeSquare:me.Common.ShapeHeight},TextGrow:Se.TextGrowBehavior.ProPortional,shapeparam:0,moreflags:me.ObjMoreFlags.FixedRR,ObjGrow:me.GrowBehavior.All};e&&(i.ObjGrow=me.GrowBehavior.ProPortional);const o=new Qn(i);xs.MouseDrawNewShape(o,!0,!0,!0,null,null)}StampRoundRect(t,e){let i,o;F.Debug("O.ToolOpt StampRoundRect input:",t,e);const n=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);e?(i=me.Common.ShapeSquare,o=me.Common.ShapeSquare):(i=me.Common.ShapeWidth,o=me.Common.ShapeHeight);const s={Frame:{x:-1e3,y:-1e3,width:i,height:o},TextGrow:Se.TextGrowBehavior.ProPortional,shapeparam:n.def.rrectparam,moreflags:me.ObjMoreFlags.FixedRR,ObjGrow:me.GrowBehavior.All};e&&(s.ObjGrow=me.GrowBehavior.ProPortional);const a=new ps(s);xs.MouseDrawNewShape(a,!0,!0,!0,null,null),F.Debug("O.ToolOpt StampRoundRect output: void")}DrawCircle(t,e){let i=e?me.Common.ShapeSquare:me.Common.ShapeWidth,o=e?me.Common.ShapeSquare:me.Common.ShapeHeight;let n=e?{Frame:{x:-1e3,y:-1e3,width:i,height:o},TextGrow:Se.TextGrowBehavior.ProPortional,ObjGrow:me.GrowBehavior.ProPortional}:{Frame:{x:-1e3,y:-1e3,width:i,height:o},TextGrow:Se.TextGrowBehavior.ProPortional};const s=new ds(n);xs.MouseDrawNewShape(s,!0,!0,!0,null,null)}StampVueComponent(t,e){let i,o;F.Debug("U.ToolUtil StampVueComponent:",t,e),i=me.Common.ShapeWidth,o=me.Common.ShapeHeight;let n=null;n={Frame:{x:-1e3,y:-1e3,width:i,height:o},TextGrow:Se.TextGrowBehavior.ProPortional,uniType:e};var s={item:{title:"==== Test Pump ====",active:!1,type:"Pump",translate:[284,72],width:60,height:60,rotate:0,scaleX:1,scaleY:1,settings:{fillColor:"#659dc5",active:!0,inAlarm:!0,titleColor:"inherit",bgColor:"inherit",textColor:"inherit",fontSize:16,t3EntryDisplayField:"description"},zindex:1,t3Entry:{auto_manual:1,calibration_h:0,calibration_l:0,calibration_sign:1,command:"199IN1",control:1,decom:1,description:"V",digital_analog:1,filter:5,id:"IN1",index:0,label:"IN1",pid:199,range:19,type:"INPUT",unit:19,value:30},showDimensions:!0,cat:"Pipe",id:2},showArrows:!0},a=$n.GetItemFromAPSV2(e);F.Debug("apsItem",a);var r=this.CreateForeignObjectWithVue(ye.opt.svgDoc,null,s,n);xs.MouseDrawNewShape(r,!0,!0,!0,null,null),F.Debug("U.ToolUtil StampVueComponent output: void")}CreateForeignObjectWithVue(t,e,i,o){const n=new we.Shape.ForeignObject({vueComponent:e,vueProps:i,...o});return F.Debug("ToolUtil->CreateForeignObjectWithVue After",n),n}StampTextLabel(t,e){F.Debug("O.ToolOpt StampTextLabel input:",t,e);const i=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if(e||-1==i.theActiveTextEditObjectID){if(!e){const t=Qo.GetTargetSelect();if(t>=0){const e=ws.GetObjectPtr(t,!1);if(e&&e.AllowTextEdit()){const e=ye.opt.svgObjectLayer.GetElementById(t);return on.ActivateTextEdit(e)}}}}else on.DeactivateTextEdit();const o=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;let n=si.FindStyle(me.Common.TextBlockStyle);null==n&&(n=o.def.style);const s={StyleRecord:Oe.DeepCopy(n),Frame:{x:0,y:0,width:0,height:0},TMargins:{top:0,left:0,bottom:0,right:0},TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:bi.TextAlign.Left,flags:Se.ObjFlags.TextOnly};null==s.StyleRecord.Line&&(s.StyleRecord.Line=Oe.DeepCopy(n.Border)),s.StyleRecord.Line.Thickness=0;const a=new we.Shape.Rect(s),r=Oe.DeepCopy(o.def.style);r.Text.Paint=Oe.DeepCopy(n.Text.Paint),a.StyleRecord.Text=r.Text;const l=on.CalcDefaultInitialTextStyle(a.StyleRecord.Text),h=ye.opt.svgDoc.CalcStyleMetrics(l);ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=h.ascent,a.Frame.height=h.height,t||on.DeactivateTextEdit(!1),xs.StampNewTextShapeOnTap(a,!1,!1,!1,t,this.StampCallback,{bActivateText:!0}),F.Debug("O.ToolOpt StampTextLabel output: void")}StampCallback(t,e){if(e.bActivateText){const e=ye.opt.svgObjectLayer.GetElementById(t);on.ActivateTextEdit(e)}}StampShape(t,e){let i;F.Debug("U.ToolUtil.StampShape - Input:",t,e);const o=tn.ShapeTypes,n={x:-1e3,y:-1e3,width:me.Common.ShapeWidth,height:me.Common.ShapeHeight},s=ye.opt.GetShapeParams(t,n),a={Frame:n,TextGrow:Se.TextGrowBehavior.ProPortional,dataclass:s.dataclass,shapeparam:s.shapeparam};switch(s.bIsSquare&&(a.ObjGrow=me.GrowBehavior.ProPortional),s.dataclass){case o.RECTANGLE:i=new Qn(a);break;case o.ROUNDED_RECTANGLE:i=new ps(a);break;case o.OVAL:i=new ds(a);break;default:const t=s.polyVectorMethod(n,s.shapeparam);a.VertexArray=t,i=new cs(a),i.dataclass=s.dataclass}xs.MouseDrawNewShape(i,!0,!0,!0,null,null),F.Debug("U.ToolUtil.StampShape - Output: Shape stamped successfully")}RotateShapes(t){F.Debug("O.ToolOpt RotateShapes input:",t);try{ye.opt.CloseEdit(),$o.RotateShapes(parseInt(t,10))}catch(e){throw ye.opt.ExceptionCleanup(e),e}F.Debug("O.ToolOpt RotateShapes output: void")}AlignShapes(t){F.Debug("O.ToolOpt AlignShapes input:",t);try{ye.opt.CloseEdit(),$o.AlignShapes(t)}catch(e){throw ye.opt.ExceptionCleanup(e),e}F.Debug("O.ToolOpt AlignShapes output: void")}DeleteSelectedObjects(){F.Debug("O.ToolOpt DeleteSelectedObjects input: no parameters");try{ye.opt.CloseEdit(),$o.DeleteSelectedObjects()}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt DeleteSelectedObjects output: void")}Undo(){F.Debug("O.ToolOpt Undo input: no parameters");try{$o.Undo()}catch(t){throw t}F.Debug("O.ToolOpt Undo output: void")}Redo(){F.Debug("O.ToolOpt Redo input: no parameters");try{$o.Redo()}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt Redo output: void")}Copy(){F.Debug("O.ToolOpt Copy input: no parameters");try{let e=!1;try{e=document.execCommand("copy")}catch(t){throw t}e||ye.opt.CopyObjects()}catch(t){throw ye.opt.RestorePrimaryStateManager(),ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt Copy output: void")}Cut(){F.Debug("O.ToolOpt Cut input: no parameters");try{let e=!1;try{e=document.execCommand("cut")}catch(t){throw t}e||$o.CutObjects()}catch(t){throw ye.opt.RestorePrimaryStateManager(),ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt Cut output: void")}Paste(t){F.Debug("= u.ToolUtil: Paste/ input isRightClick:",t);try{ye.opt.PastePoint=null,t&&ye.opt.rClickParam&&(ye.opt.PastePoint=ye.opt.rClickParam.hitPoint),Jo.PasteFromUIaction()}catch(e){throw ye.opt.ExceptionCleanup(e),e}}SendToBackOf(){F.Debug("O.ToolOpt SendToBackOf input: no parameters");try{ye.opt.CloseEdit(),$o.SendToBackOf()}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt SendToBackOf output: void")}BringToFrontOf(){F.Debug("O.ToolOpt BringToFrontOf input: no parameters");try{ye.opt.CloseEdit(),xs.BringToFrontOf()}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt BringToFrontOf output: void")}GroupSelected(){F.Debug("O.ToolOpt GroupSelected input: no parameters");try{ye.opt.CloseEdit(),$o.GroupSelected(!1,null,!1,!1,!0)}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt GroupSelected output: void")}UnGroupSelected(){F.Debug("O.ToolOpt UnGroupSelected input: no parameters");try{ye.opt.CloseEdit(),$o.UnGroupSelected()}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt UnGroupSelected output: void")}FlipHorizontal(){F.Debug("O.ToolOpt FlipHorizontal input: no parameters");try{ye.opt.CloseEdit(),$o.FlipShapes(me.ExtraFlags.FlipHoriz)}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt FlipHorizontal output: void")}FlipVertical(){F.Debug("O.ToolOpt FlipVertical input: no parameters");try{ye.opt.CloseEdit(),$o.FlipShapes(me.ExtraFlags.FlipVert)}catch(t){throw ye.opt.ExceptionCleanup(t),t}F.Debug("O.ToolOpt FlipVertical output: void")}MakeSameSize(t){F.Debug("O.ToolOpt MakeSameSize input:",t);try{ye.opt.CloseEdit(),$o.MakeSameSize(parseInt(t,10))}catch(e){ye.opt.ExceptionCleanup(e)}F.Debug("O.ToolOpt MakeSameSize output: void")}GetSelectionContext(){F.Debug("O.ToolOpt GetSelectionContext input: no parameters");try{const t=Qo.GetSelectionContext();return F.Debug("O.ToolOpt GetSelectionContext output:",t),t}catch(t){ye.opt.ExceptionCleanup(t)}}IsActiveTextEdit(){F.Debug("O.ToolOpt IsActiveTextEdit input: no parameters");try{const t=-1!==ws.GetObjectPtr(ye.opt.teDataBlockId,!1).theActiveTextEditObjectID;return F.Debug("O.ToolOpt IsActiveTextEdit output:",t),t}catch(t){ye.opt.ExceptionCleanup(t),F.Debug("O.ToolOpt IsActiveTextEdit output: undefined (error)")}}HandleKeyDown(t,e,i){F.Debug("O.ToolOpt HandleKeyDown input:",t,e,i);try{const o=rn.HandleKeyDown(t,e,i);return F.Debug("O.ToolOpt HandleKeyDown output:",o),o}catch(o){ye.opt.ExceptionCleanup(o),F.Debug("O.ToolOpt HandleKeyDown output: undefined (error)")}}Duplicate(){F.Debug("O.ToolOpt Duplicate input: no parameters");try{$o.DuplicateObjects(),F.Debug("O.ToolOpt Duplicate output: void")}catch(t){ye.opt.RestorePrimaryStateManager(),ye.opt.ExceptionCleanup(t),F.Debug("O.ToolOpt Duplicate output: void (error)")}}HandleKeyPress(t,e){F.Debug("O.ToolOpt HandleKeyPress input:",t,e);try{const i=rn.HandleKeyPress(t,e);return F.Debug("O.ToolOpt HandleKeyPress output:",i),i}catch(i){ye.opt.ExceptionCleanup(i),F.Debug("O.ToolOpt HandleKeyPress output: undefined (error)")}}DragDropSymbol(t,e){F.Debug("U.ToolUtil.dragDropSymbol - Input:",t,e),this.StampOrDragDropNewSymbol(t,e),F.Debug("U.ToolUtil.dragDropSymbol - Output: void")}StampOrDragDropNewSymbol(t,e){F.Debug("O.ToolOpt StampOrDragDropNewSymbol input:",t,e);const i='\n      <path\n        style="\n          fill: ##FillColor=#28c3c6##;\n          fill-opacity: 1;\n          fill-rule: nonzero;\n          stroke:##LineColor=#000000##;\n          stroke-width: 1;\n          stroke-linecap: butt;\n          stroke-linejoin: miter;\n          stroke-miterlimit: 4;\n          stroke-dasharray: none;\n          stroke-opacity: 1;\n        "\n        d="m 3.714,27.855 14.856,-12.999 0,-12.999 22.284,0 0,12.999 14.856,12.999 0,29.712 -51.996,0 z"\n      ></path>\n    ',o=new gs({Frame:{x:-1e3,y:-1e3,width:60,height:60},hookflags:257,moreflags:64,targflags:3,InitialGroupBounds:{x:0,y:0,width:30,height:30}});o.StyleRecord=new ni;const n=i.replace(/\n\s*/g," ").trim();F.Debug("D.D testSvgString",n),o.Frame={x:-1e3,y:-1e3,width:60,height:60},o.InitialGroupBounds={width:60,height:60,x:-1e3,y:-1e3};o.SVGFragment='\n        <g transform="translate(0,0)">\n            <circle r="30" cy="30" cx="30"\n            style="\n                    opacity: 1;\n                    fill: ##FillColor=#FFFFFF##;\n                    fill-opacity: 1;\n                    fill-rule: nonzero;\n                    stroke:##FillColor=#000000##;\n                    stroke-width: 0.764198;\n                    stroke-linecap: butt;\n                    stroke-linejoin: round;\n                    stroke-miterlimit: 4;\n                    stroke-dasharray: none;\n                    stroke-opacity: 1;\n                  "/>\n            <g transform="matrix(1,0,0,1,46,43)"\n            style="\n                    font-style: normal;\n                    font-weight: normal;\n                    font-size: 51px;\n                    line-height: 125%;\n                    font-family: Sans;\n                    letter-spacing: 0px;\n                    word-spacing: 0px;\n                    fill:##FillColor=#000000##;\n                    fill-opacity: 1;\n                    stroke: none;\n                    stroke-width: 1px;\n                    stroke-linecap: butt;\n                    stroke-linejoin: miter;\n                    stroke-opacity: 1;\n                  ">\n                <path\n                    d="m -29.828843,-32.840076 h 5.075651 v 15.377717 h 18.4432096 v -15.377717 h 5.0756516 V 4.6745172 H -6.3099824 V -13.190771 H -24.753192 V 4.6745172 h -5.075651 z" />\n            </g>\n        </g>\n      ',o&&xs.DragDropNewShape(o,!0,!0,!1,null,null),F.Debug("O.ToolOpt StampOrDragDropNewSymbol output: void")}ToolDragDropSymbol(t,e){var i=ms.GetSvgData(t);this.ToolDragDropNewSymbol(i,e),F.Debug("= U.ToolUtil.dragDropSymbol - Input/Output:",t,e)}ToolDragDropNewSymbol(t,e){xs.DragDropNewShape(t,!0,!0,!1,null,null),F.Debug("= U.ToolUtil ToolDragDropNewSymbol input/output:",t,e)}DrawNewSegLine(t,e,i){let o;F.Debug("O.ToolOpt DrawNewSegLine input:",t,e,i);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data,s=0==(n.def.textflags&Se.TextFlags.HorizText);let a=n.d_sarrow,r=n.d_earrow,l=n.d_sarrowdisp,h=n.d_earrowdisp;a>0!=r>0&&(0===r&&(r=a,h=l),a=0,l=!1),o=i?Oe.DeepCopy(i.Data.attributes):{Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StartArrowID:a,EndArrowID:r,StartArrowDisp:l,EndArrowDisp:h,ArrowSizeIndex:n.d_arrowsize,CurveAdjust:7,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:s,Dimensions:n.dimensions,curveparam:n.def.curveparam,bOverrideDefaultStyleOnDraw:!0};const c=new we.Shape.SegmentedLine(o);let p=Oe.DeepCopy(n.def.style);if(i&&i.Data&&i.Data.attributes&&i.Data.attributes.StyleRecord)p=Oe.DeepCopy(i.Data.attributes.StyleRecord);else{const t=si.FindStyle(me.Common.TextBlockStyle);p.Text.Paint.Color=t.Text.Paint.Color}if(c.StyleRecord=p,n.flags&me.SessionFlags.AllowHops&&(c.flags=ve.SetFlag(c.flags,Se.ObjFlags.LineHop,!0)),t)return F.Debug("O.ToolOpt DrawNewSegLine output:",c),c;xs.DrawNewObject(c,e),F.Debug("O.ToolOpt DrawNewSegLine output: void")}DrawNewArcSegLine(t,e,i){let o;F.Debug("O.ToolOpt DrawNewArcSegLine input:",t,e,i);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data,s=0==(n.def.textflags&Se.TextFlags.HorizText);let a=n.d_sarrow,r=n.d_earrow,l=n.d_sarrowdisp,h=n.d_earrowdisp;a>0!=r>0&&(0===r&&(r=a,h=l),a=0,l=!1),o=i?Oe.DeepCopy(i.Data.attributes):{Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StartArrowID:a,EndArrowID:r,StartArrowDisp:l,EndArrowDisp:h,ArrowSizeIndex:n.d_arrowsize,CurveAdjust:7,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:s,Dimensions:n.dimensions,bOverrideDefaultStyleOnDraw:!0};const c=new we.Shape.ArcSegmentedLine(o);let p=Oe.DeepCopy(n.def.style);if(i&&i.Data&&i.Data.attributes&&i.Data.attributes.StyleRecord)p=Oe.DeepCopy(i.Data.attributes.StyleRecord);else{const t=si.FindStyle(me.Common.TextBlockStyle);p.Text.Paint.Color=t.Text.Paint.Color}if(c.StyleRecord=p,n.flags&me.SessionFlags.AllowHops&&(c.flags=ve.SetFlag(c.flags,Se.ObjFlags.LineHop,!0)),t)return F.Debug("O.ToolOpt DrawNewArcSegLine output:",c),c;xs.DrawNewObject(c,e),F.Debug("O.ToolOpt DrawNewArcSegLine output: void")}DrawNewPolyLine(t,e,i){let o;F.Debug("O.ToolOpt DrawNewPolyLine input:",t,e,i);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data,s=0==(n.def.textflags&Se.TextFlags.HorizText);let a=n.d_sarrow,r=n.d_earrow,l=n.d_sarrowdisp,h=n.d_earrowdisp;a>0!=r>0&&(0===r&&(r=a,h=l),a=0,l=!1),i?o=Oe.DeepCopy(i.Data.attributes):(o={Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StartArrowID:a,EndArrowID:r,StartArrowDisp:l,EndArrowDisp:h,ArrowSizeIndex:n.d_arrowsize,CurveAdjust:7,polylist:new vi,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:s,Dimensions:n.dimensions,extraflags:me.ExtraFlags.SideKnobs,bOverrideDefaultStyleOnDraw:!0},o.polylist.segs.push(new Pi(me.LineType.LINE,0,0)),o.polylist.segs.push(new Pi(me.LineType.LINE,0,0)));const c=new we.Shape.PolyLine(o);let p=Oe.DeepCopy(n.def.style);if(i&&i.Data&&i.Data.attributes&&i.Data.attributes.StyleRecord)p=Oe.DeepCopy(i.Data.attributes.StyleRecord);else{const t=si.FindStyle(me.Common.TextBlockStyle);p.Text.Paint.Color=t.Text.Paint.Color}if(c.StyleRecord=p,t)return F.Debug("O.ToolOpt DrawNewPolyLine output:",c),c;xs.DrawNewObject(c,e),F.Debug("O.ToolOpt DrawNewPolyLine output: void")}DrawNewPolyLineContainer(t,e,i){let o;F.Debug("O.ToolOpt DrawNewPolyLineContainer input:",t,e,i);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const s=0==(n.def.textflags&Se.TextFlags.HorizText);i?o=Oe.DeepCopy(i.Data.attributes):(o={Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StartArrowID:n.d_sarrow,EndArrowID:n.d_earrow,StartArrowDisp:n.d_sarrowdisp,EndArrowDisp:n.d_earrowdisp,ArrowSizeIndex:n.d_arrowsize,CurveAdjust:7,polylist:new vi,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:s,Dimensions:n.dimensions},o.polylist.segs.push(new Pi(me.LineType.LINE,0,0)),o.polylist.segs.push(new Pi(me.LineType.LINE,0,0)));const a=new we.Shape.PolyLineContainer(o);if(t)return F.Debug("O.ToolOpt DrawNewPolyLineContainer output:",a),a;xs.DrawNewObject(a,e),F.Debug("O.ToolOpt DrawNewPolyLineContainer output: void")}DrawNewFreehandLine(t,e,i){let o;F.Debug("O.ToolOpt DrawNewFreehandLine input:",t,e,i);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;i?o=Oe.DeepCopy(i.Data.attributes):(o={Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},pointlist:[],bOverrideDefaultStyleOnDraw:!0},o.pointlist.push({x:0,y:0}));const s=new we.Shape.FreehandLine(o);let a=Oe.DeepCopy(n.def.style);if(i&&i.Data&&i.Data.attributes&&i.Data.attributes.StyleRecord&&(a=Oe.DeepCopy(i.Data.attributes.StyleRecord)),s.StyleRecord=a,t)return F.Debug("O.ToolOpt DrawNewFreehandLine output:",s),s;xs.DrawNewObject(s,e),F.Debug("O.ToolOpt DrawNewFreehandLine output: void")}DrawNewArcLine(t,e,i){let o;F.Debug("O.ToolOpt DrawNewArcLine input:",t,e,i);const n=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data,s=0==(n.def.textflags&Se.TextFlags.HorizText);let a=n.d_sarrow,r=n.d_earrow,l=n.d_sarrowdisp,h=n.d_earrowdisp;a>0!=r>0&&(0===r&&(r=a,h=l),a=0,l=!1),o=i?Oe.DeepCopy(i.Data.attributes):{Frame:{x:0,y:0,width:1,height:1},StartPoint:{x:0,y:0},EndPoint:{x:0,y:0},StartArrowID:a,EndArrowID:r,StartArrowDisp:l,EndArrowDisp:h,ArrowSizeIndex:n.d_arrowsize,CurveAdjust:7,TextGrow:Se.TextGrowBehavior.Horizontal,TextAlign:Ae.DocContext.CurrentTextAlignment,TextDirection:s,Dimensions:n.dimensions,bOverrideDefaultStyleOnDraw:!0};const c=new we.Shape.ArcLine(o);let p=Oe.DeepCopy(n.def.style);if(i&&i.Data&&i.Data.attributes&&i.Data.attributes.StyleRecord)p=Oe.DeepCopy(i.Data.attributes.StyleRecord);else{const t=si.FindStyle(me.Common.TextBlockStyle);p.Text.Paint.Color=t.Text.Paint.Color}if(c.StyleRecord=p,n.flags&me.SessionFlags.AllowHops&&(c.flags=ve.SetFlag(c.flags,Se.ObjFlags.LineHop,!0)),t)return F.Debug("O.ToolOpt DrawNewArcLine output:",c),c;xs.DrawNewObject(c,e),F.Debug("O.ToolOpt DrawNewArcLine output: void")}SelectAllObjects(){F.Debug("O.ToolOpt SelectAllObjects input: no parameters");try{Qo.SelectAllObjects()}catch(t){ye.opt.ExceptionCleanup(t)}F.Debug("O.ToolOpt SelectAllObjects output: void")}Save(){ye.opt.CloseEdit(),_o.SaveToLocalStorage()}VueForeignObject(){this.tul.StampOrDragDropNewShape(event,shapeType)}ClearAndRest(){_o.ClearT3LocalStorage(),xs.ClearDrawArea()}}const Ds=class{BindElemCtlEvent(){Rt(document).ready((()=>{this.BindVueForeignObjectEvent(),this.BindSelectEvent(),this.BindSelectAllEvent(),this.BindLibraryEvent(),this.BindLineEvent(),this.BindLine1Event(),this.BindWallEvent(),this.BindRectEvent(),this.BindOvalEvent(),this.BindImageEvent(),this.BindCircleEvent(),this.BindTextEvent(),this.BindArrREvent(),this.BindArrLEvent(),this.BindArrTEvent(),this.BindArrBEvent(),this.BindRoate45Event(),this.BindRoate90Event(),this.BindAlignLeftEvent(),this.BindAlignCentersEvent(),this.BindAlignTopsEvent(),this.BindAlignMiddlesEvent(),this.BindAlignBottomsEvent(),this.BindAlignRightsEvent(),this.BindGroupEvent(),this.BindUngroupEvent(),this.BindFlipHorizontalEvent(),this.BindFlipVerticalEvent(),this.BindSameHeightEvent(),this.BindSameWidthEvent(),this.BindSameBothEvent(),this.BindBringToFrontEvent(),this.BindSendToBackEvent(),this.BindCopyEvent(),this.BindCutEvent(),this.BindPasteEvent(),this.BindDeleteEvent(),this.BindUndoEvent(),this.BindRedoEvent(),this.BindSaveEvent(),this.BindDuplicateEvent(),this.BindClearEvent(),this.BindLibSelectEvent(),this.BindLibBoxEvent(),this.BindLibTextEvent(),this.BindLibIconEvent(),this.BindLibSwitchIconEvent(),this.BindLibLedEvent(),this.BindLibRoomHumidityEvent(),this.BindLibRoomTemperatureEvent(),this.BindLibTemperatureEvent(),this.BindLibBoilerEvent(),this.BindLibHeatpumpEvent(),this.BindLibPumpEvent(),this.BindLibValveThreeWayEvent(),this.BindLibValveTwoWayEvent(),this.BindLibDuctEvent(),this.BindLibFanEvent(),this.BindLibCoolingCoilEvent(),this.BindLibHeatingCoilEvent(),this.BindLibFilterEvent(),this.BindLibHumidifierEvent(),this.BindLibHumidityEvent(),this.BindLibPressureEvent(),this.BindLibDamperEvent(),this.BindLibTemperature2Event(),this.BindLibThermalWheelEvent(),this.BindLibEnthalpyEvent(),this.BindLibFlowEvent(),this.BindLibGuageEvent(),this.BindLibDialEvent(),this.BindLibValueEvent(),this.BindLibIconWithTitleEvent(),this.BindLibSetBackgroundColorEvent(),this.BindLibSetBackgroundImageEvent(),this.BindLibImportSvgSymbolEvent(),this.BindLibLockEvent(),this.BindLibUnLockEvent(),this.BindLibAddNoteEvent(),this.BindLibAddCommentEvent(),this.BindLibHyperlinkEvent(),this.BindSetXEvent(),this.BindSetYEvent(),this.BindSetWidthEvent(),this.BindSetHeightEvent(),this.BindAddToLibraryEvent(),this.BindLoadLibraryEvent(),this.BindDuct1Event(),this.BindDuct2Event(),this.BindDuct3Event(),this.BindDuct4Event(),this.BindDuct5Event(),this.BindDuct6Event(),this.BindDuct7Event(),this.BindDuct8Event(),this.BindDuct9Event(),this.BindDuct10Event(),this.BindDuct11Event(),this.BindDuct12Event(),this.BindResetScaleEvent(),this.BindDocumentAreaEvent()}))}BindSelectEvent(){Rt("#btn_try_select").on("click",(t=>{Ds.toolOpt.SelectAct(t)}))}BindSelectAllEvent(){Rt("#btn_try_select_all").on("click",(t=>{Ds.toolOpt.SelectAllObjects()}))}BindLibraryEvent(){Rt("#btn_try_library").on("click",(t=>{Ds.toolOpt.DragDropSymbolAct(t)}))}BindLineEvent(){Rt("#btn_try_line").on("pointerdown",(t=>{Ds.toolOpt.ToolLineAct("line",t)}))}BindLine1Event(){Rt("#btn_try_line1").on("pointerdown",(t=>{Ds.toolOpt.ToolLineAct("arcLine",t)}))}BindWallEvent(){Rt("#btn_try_wall").on("pointerdown",(t=>{Ds.toolOpt.DrawWall(t)}))}BindRectEvent(){Rt("#btn_try_Rect").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,2,"Rect")}))}BindOvalEvent(){Rt("#btn_try_Oval").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,4,"Oval")}))}BindImageEvent(){Rt("#btn_try_Image").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,1,"Image")}))}BindCircleEvent(){Rt("#btn_try_Circ").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,9,"Circle")}))}BindTextEvent(){Rt("#btn_try_Text").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,"textLabel","Text")}))}BindArrREvent(){Rt("#btn_try_ArrR").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,10,"ArrR")}))}BindArrLEvent(){Rt("#btn_try_ArrL").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,11,"ArrL")}))}BindArrTEvent(){Rt("#btn_try_ArrT").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,12,"ArrT")}))}BindArrBEvent(){Rt("#btn_try_ArrB").on("pointerdown",(t=>{Ds.toolOpt.StampShapeFromToolAct(t,13,"ArrB")}))}BindRoate45Event(){Rt("#btn_try_Roate45").on("pointerdown",(t=>{Ds.toolOpt.RotateAct(t,45)}))}BindRoate90Event(){Rt("#btn_try_Roate90").on("pointerdown",(t=>{Ds.toolOpt.RotateAct(t,90)}))}BindAlignLeftEvent(){Rt("#btn_try_Align_lefts").on("pointerdown",(t=>{Ds.toolOpt.ShapeAlignAct("lefts")}))}BindAlignCentersEvent(){Rt("#btn_try_Align_centers").on("pointerdown",(t=>{Ds.toolOpt.ShapeAlignAct("centers")}))}BindAlignTopsEvent(){Rt("#btn_try_Align_tops").on("pointerdown",(t=>{Ds.toolOpt.ShapeAlignAct("tops")}))}BindAlignMiddlesEvent(){Rt("#btn_try_Align_middles").on("pointerdown",(t=>{Ds.toolOpt.ShapeAlignAct("middles")}))}BindAlignBottomsEvent(){Rt("#btn_try_Align_bottoms").on("pointerdown",(t=>{Ds.toolOpt.ShapeAlignAct("bottoms")}))}BindAlignRightsEvent(){Rt("#btn_try_Align_rights").on("pointerdown",(t=>{Ds.toolOpt.ShapeAlignAct("rights")}))}BindGroupEvent(){Rt("#btn_try_Group").on("pointerdown",(t=>{Ds.toolOpt.GroupAct(t)}))}BindUngroupEvent(){Rt("#btn_try_UnGroup").on("pointerdown",(t=>{Ds.toolOpt.UnGroupAct(t)}))}BindFlipHorizontalEvent(){Rt("#btn_try_Flip_Horizontal").on("pointerdown",(t=>{Ds.toolOpt.ShapeFlipHorizontalAct(t)}))}BindFlipVerticalEvent(){Rt("#btn_try_Flip_Vertical").on("pointerdown",(t=>{Ds.toolOpt.ShapeFlipVerticalAct(t)}))}BindSameHeightEvent(){Rt("#btn_try_Same_Height").on("pointerdown",(t=>{Ds.toolOpt.MakeSameSizeAct(t,1)}))}BindSameWidthEvent(){Rt("#btn_try_Same_Width").on("pointerdown",(t=>{Ds.toolOpt.MakeSameSizeAct(t,2)}))}BindSameBothEvent(){Rt("#btn_try_Same_Both").on("pointerdown",(t=>{Ds.toolOpt.MakeSameSizeAct(t,3)}))}BindBringToFrontEvent(){Rt("#btn_try_BringToFront").on("pointerdown",(t=>{Ds.toolOpt.ShapeBringToFrontAct(t)}))}BindSendToBackEvent(){Rt("#btn_try_SendToBack").on("pointerdown",(t=>{Ds.toolOpt.ShapeSendToBackAct(t)}))}BindPasteEvent(){Rt("#btn_try_Paste").on("pointerdown",(t=>{Ds.toolOpt.PasteAct(t)}))}BindCopyEvent(){Rt("#btn_try_Copy").on("pointerdown",(t=>{Ds.toolOpt.CopyAct(t)}))}BindCutEvent(){Rt("#btn_try_Cut").on("pointerdown",(t=>{Ds.toolOpt.CutAct(t)}))}BindDeleteEvent(){Rt("#btn_try_Delete").on("pointerdown",(t=>{Ds.toolOpt.DeleteAct(t)}))}BindUndoEvent(){Rt("#btn_try_Undo").on("pointerdown",(t=>{Ds.toolOpt.UndoAct(t)}))}BindRedoEvent(){Rt("#btn_try_Redo").on("pointerdown",(t=>{Ds.toolOpt.RedoAct(t)}))}BindSaveEvent(){Rt("#btn_try_Save").on("pointerdown",(t=>{Ds.toolOpt.SaveAct()}))}BindDuplicateEvent(){Rt("#btn_try_Duplicate").on("pointerdown",(t=>{Ds.toolOpt.DuplicateAct(t)}))}BindClearEvent(){Rt("#btn_try_Clear").on("pointerdown",(t=>{Ds.toolOpt.ClearAct()}))}BindLibSelectEvent(){Rt("#btn_try_Lib_Select").on("pointerdown",(t=>{Ds.toolOpt.SelectAct(t)}))}BindLibBoxEvent(){Rt("#btn_try_Lib_Box").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Box",!0)}))}BindLibTextEvent(){Rt("#btn_try_Lib_Text").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Text",!0)}))}BindLibIconEvent(){Rt("#btn_try_Lib_Icon").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Icon",!0)}))}BindLibSwitchIconEvent(){Rt("#btn_try_Lib_SwitchIcon").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("SwitchIcon",!0)}))}BindLibLedEvent(){Rt("#btn_try_Lib_Led").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Led",!0)}))}BindLibRoomHumidityEvent(){Rt("#btn_try_Lib_RoomHumidity").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("RoomHumidity",!0)}))}BindLibRoomTemperatureEvent(){Rt("#btn_try_Lib_RoomTemperature").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("RoomTemperature",!0)}))}BindLibTemperatureEvent(){Rt("#btn_try_Lib_Temperature").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Temperature",!0)}))}BindLibBoilerEvent(){Rt("#btn_try_Lib_Boiler").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Boiler",!0)}))}BindLibHeatpumpEvent(){Rt("#btn_try_Lib_Heatpump").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Heatpump",!0)}))}BindLibPumpEvent(){Rt("#btn_try_Lib_Pump").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Pump",!0)}))}BindLibValveThreeWayEvent(){Rt("#btn_try_Lib_ValveThreeWay").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("ValveThreeWay",!0)}))}BindLibValveTwoWayEvent(){Rt("#btn_try_Lib_ValveTwoWay").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("ValveTwoWay",!0)}))}BindLibDuctEvent(){Rt("#btn_try_Lib_Duct").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct",!0)}))}BindLibFanEvent(){Rt("#btn_try_Lib_Fan").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Fan",!0)}))}BindLibCoolingCoilEvent(){Rt("#btn_try_Lib_CoolingCoil").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("CoolingCoil",!0)}))}BindLibHeatingCoilEvent(){Rt("#btn_try_Lib_HeatingCoil").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("HeatingCoil",!0)}))}BindLibFilterEvent(){Rt("#btn_try_Lib_Filter").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Filter",!0)}))}BindLibHumidifierEvent(){Rt("#btn_try_Lib_Humidifier").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Humidifier",!0)}))}BindLibHumidityEvent(){Rt("#btn_try_Lib_Humidity").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Humidity",!0)}))}BindLibPressureEvent(){Rt("#btn_try_Lib_Pressure").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Pressure",!0)}))}BindLibDamperEvent(){Rt("#btn_try_Lib_Damper").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Damper",!0)}))}BindLibTemperature2Event(){Rt("#btn_try_Lib_Temperature2").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Temperature2",!0)}))}BindLibThermalWheelEvent(){Rt("#btn_try_Lib_ThermalWheel").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("ThermalWheel",!0)}))}BindLibEnthalpyEvent(){Rt("#btn_try_Lib_Enthalpy").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Enthalpy",!0)}))}BindLibFlowEvent(){Rt("#btn_try_Lib_Flow").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Flow",!0)}))}BindLibGuageEvent(){Rt("#btn_try_Lib_Guage").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Guage",!0)}))}BindLibDialEvent(){Rt("#btn_try_Lib_Dial").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Dial",!0)}))}BindLibValueEvent(){Rt("#btn_try_Lib_Value").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Value",!0)}))}BindLibIconWithTitleEvent(){Rt("#btn_try_Lib_IconWithTitle").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("IconWithTitle",!0)}))}BindLibSetBackgroundColorEvent(){Rt("#btn_try_Lib_SetBackgroundColor").on("pointerdown",(t=>{"#FFFFFF"==ye.docUtil.docConfig.backgroundColor?(Ds.toolOpt.LibSetBackgroundColorAct("#20b2aa"),ye.docUtil.docConfig.backgroundColor="#20b2aa"):(Ds.toolOpt.LibSetBackgroundColorAct("#FFFFFF"),ye.docUtil.docConfig.backgroundColor="#FFFFFF")}))}BindLibSetBackgroundImageEvent(){Rt("#btn_try_Lib_SetBackgroundImage").on("pointerdown",(t=>{Ds.toolOpt.LibSetBackgroundImageAct(t,!1)}))}BindLibImportSvgSymbolEvent(){Rt("#btn_try_Lib_ImportSvgSymbol").on("pointerdown",(t=>{Ds.toolOpt.LibImportSvgSymbolAct(t)}))}BindLibLockEvent(){Rt("#btn_try_Lib_Lock").on("pointerdown",(t=>{Ds.toolOpt.LibLockAct(t)}))}BindLibUnLockEvent(){Rt("#btn_try_Lib_UnLock").on("pointerdown",(t=>{Ds.toolOpt.LibUnlockAct(t)}))}BindLibAddNoteEvent(){Rt("#btn_try_Lib_AddNote").on("pointerdown",(t=>{Ds.toolOpt.LibAddNoteAct()}))}BindLibAddCommentEvent(){Rt("#btn_try_Lib_AddComment").on("pointerdown",(t=>{Ds.toolOpt.LibAddCommentAct()}))}BindLibHyperlinkEvent(){Rt("#btn_try_Lib_Hyperlink").on("pointerdown",(t=>{Ds.toolOpt.LibHyperlinkAct()}))}HandleSidebarToolEvent(t){F.Debug("Selected tool: ",t),"Temperature"==t.value.name&&Ds.toolOpt.LibToolShape("Temperature",!0),"Boiler"==t.value.name&&Ds.toolOpt.LibToolShape("Boiler",!0),"Heatpump"==t.value.name&&Ds.toolOpt.LibToolShape("Heatpump",!0),"Pump"==t.value.name&&Ds.toolOpt.LibToolShape("Pump",!0),"ValveThreeWay"==t.value.name&&Ds.toolOpt.LibToolShape("ValveThreeWay",!0),"ValveTwoWay"==t.value.name&&Ds.toolOpt.LibToolShape("ValveTwoWay",!0),t.value.name,"Fan"==t.value.name&&Ds.toolOpt.LibToolShape("Fan",!0),"CoolingCoil"==t.value.name&&Ds.toolOpt.LibToolShape("CoolingCoil",!0),"HeatingCoil"==t.value.name&&Ds.toolOpt.LibToolShape("HeatingCoil",!0),"Filter"==t.value.name&&Ds.toolOpt.LibToolShape("Filter",!0),"Humidifier"==t.value.name&&Ds.toolOpt.LibToolShape("Humidifier",!0),"Humidity"==t.value.name&&Ds.toolOpt.LibToolShape("Humidity",!0),"Pressure"==t.value.name&&Ds.toolOpt.LibToolShape("Pressure",!0),"Damper"==t.value.name&&Ds.toolOpt.LibToolShape("Damper",!0),"ThermalWheel"==t.value.name&&Ds.toolOpt.LibToolShape("ThermalWheel",!0),"Enthalpy"==t.value.name&&Ds.toolOpt.LibToolShape("Enthalpy",!0),"Flow"==t.value.name&&Ds.toolOpt.LibToolShape("Flow",!0),"RoomHumidity"==t.value.name&&Ds.toolOpt.LibToolShape("RoomHumidity",!0),"RoomTemperature"==t.value.name&&Ds.toolOpt.LibToolShape("RoomTemperature",!0),t.value.name,t.value.name,t.value.name,"Wall"==t.value.name&&Ds.toolOpt.DrawWall(event),"Line"==t.value.name&&Ds.toolOpt.ToolLineAct("line",event),"ArcLine"==t.value.name&&Ds.toolOpt.ToolLineAct("arcLine",event),"SegLine"==t.value.name&&Ds.toolOpt.ToolLineAct("segLine",event),"PolyLine"==t.value.name&&Ds.toolOpt.ToolLineAct("polyLine",event),"G_Circle"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,9,"G_Circle"),"G_Rectangle"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,2,"G_Rectangle"),"ArrowRight"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,10,"g_arr_right"),"ArrowLeft"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,11,"g_arr_left"),"ArrowTop"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,12,"g_arr_top"),"ArrowBottom"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,13,"g_arr_bottom"),"Oval"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,4,"Oval"),"Switch"==t.value.name&&Ds.toolOpt.LibToolShape("SwitchIcon",!0),"LED"==t.value.name&&Ds.toolOpt.LibToolShape("Led",!0),"Text"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,"textLabel","Text"),"Box"==t.value.name&&Ds.toolOpt.StampShapeFromToolAct(event,2,"Box"),"Pointer"==t.value.name&&Ds.toolOpt.SelectAct(event),"Duct1"==t.value.name&&Ds.toolOpt.LibToolShape("Duct1",!0),"Duct2"==t.value.name&&Ds.toolOpt.LibToolShape("Duct2",!0),"Duct3"==t.value.name&&Ds.toolOpt.LibToolShape("Duct3",!0),"Duct4"==t.value.name&&Ds.toolOpt.LibToolShape("Duct4",!0),"Duct5"==t.value.name&&Ds.toolOpt.LibToolShape("Duct5",!0),"Duct6"==t.value.name&&Ds.toolOpt.LibToolShape("Duct6",!0),"Duct7"==t.value.name&&Ds.toolOpt.LibToolShape("Duct7",!0),"Duct8"==t.value.name&&Ds.toolOpt.LibToolShape("Duct8",!0),"Duct9"==t.value.name&&Ds.toolOpt.LibToolShape("Duct9",!0)}BindVueForeignObjectEvent(){Rt("#btn_try_vue_foreignObject").on("pointerdown",(t=>{Ds.toolOpt.VueForeignObjectAct(t,tn.ShapeTypes.ForeignObject,"Boiler")}))}BindSetXEvent(){Rt("#btn_try_x").on("pointerdown",(t=>{Ds.toolOpt.SetX("1.5")}))}BindSetYEvent(){Rt("#btn_try_y").on("pointerdown",(t=>{Ds.toolOpt.SetY("2.3")}))}BindSetWidthEvent(){Rt("#btn_try_w").on("pointerdown",(t=>{Ds.toolOpt.SetWidth("3.2")}))}BindSetHeightEvent(){Rt("#btn_try_h").on("pointerdown",(t=>{Ds.toolOpt.SetHeight("2.5")}))}BindAddToLibraryEvent(){Rt("#btn_try_Add_To_Library").on("pointerdown",(t=>{Ds.toolOpt.AddToLibraryAct()}))}BindLoadLibraryEvent(){Rt("#btn_try_Load_Library").on("pointerdown",(t=>{Ds.toolOpt.LoadLibraryAct()}))}BindDuct1Event(){Rt("#btn_try_Duct_1").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct1",!0)}))}BindDuct2Event(){Rt("#btn_try_Duct_2").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct2",!0)}))}BindDuct3Event(){Rt("#btn_try_Duct_3").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct3",!0)}))}BindDuct4Event(){Rt("#btn_try_Duct_4").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct4",!0)}))}BindDuct5Event(){Rt("#btn_try_Duct_5").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct5",!0)}))}BindDuct6Event(){Rt("#btn_try_Duct_6").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct6",!0)}))}BindDuct7Event(){Rt("#btn_try_Duct_7").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct7",!0)}))}BindDuct8Event(){Rt("#btn_try_Duct_8").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct8",!0)}))}BindDuct9Event(){Rt("#btn_try_Duct_9").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct9",!0)}))}BindDuct10Event(){Rt("#btn_try_Duct_10").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct10",!0)}))}BindDuct11Event(){Rt("#btn_try_Duct_11").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct11",!0)}))}BindDuct12Event(){Rt("#btn_try_Duct_12").on("pointerdown",(t=>{Ds.toolOpt.LibToolShape("Duct12",!0)}))}BindResetScaleEvent(){Rt("#btn_try_Reset_Scale").on("pointerdown",(t=>{Ds.toolOpt.ResetScaleAct(t)}))}BindDocumentAreaEvent(){Rt("#document-area").on("pointerdown",(t=>{Ds.toolOpt.ClearContextMenu()}))}};let fs=Ds;a(fs,"toolOpt",new class{constructor(){a(this,"tul"),this.tul=new bs}SelectAct(t){F.Debug("= O.ToolOpt SelectAct - Input:",{event:t}),this.tul.CancelOperation()}SelectAllObjects(){F.Debug("= O.ToolOpt SelectAllObjects - Input:",{event:event}),this.tul.SelectAllObjects()}DrawWall(t){this.tul.SetDefaultWallThickness(.5,null),this.tul.DrawNewWallShape(null,null),F.Debug("= O.ToolOpt DrawWall - Output: Initialized wall drawing with thickness",.5)}StampShapeFromToolAct(t,e,i){this.tul.StampOrDragDropNewShape(t,e,i),F.Debug("= O.ToolOpt StampShapeFromToolAct - Output:",{event:t,shapeType:e,uniShapeType:i})}ToolLineAct(t,e){this.tul.DrawNewLineShape(t,!1,!1),F.Debug("= O.ToolOpt ToolLineAct - Output: Drew new line shape","line type=",t)}RotateAct(t,e){this.tul.RotateShapes(e)}ShapeAlignAct(t){F.Debug("= O.ToolOpt ShapeAlignAct - Input:",{alignmentType:t}),this.tul.AlignShapes(t)}GroupAct(t){this.tul.GroupSelected(),F.Debug("= O.ToolOpt GroupAct - Output: Grouped selected shapes")}UnGroupAct(t){this.tul.UnGroupSelected(),F.Debug("= O.ToolOpt UngroupAct - Output: Ungrouped selected shapes")}ShapeFlipHorizontalAct(t){this.tul.FlipHorizontal(),F.Debug("= O.ToolOpt ShapeFlipHorizontalAct - Output: Flipped shapes horizontally")}ShapeFlipVerticalAct(t){this.tul.FlipVertical(),F.Debug("= O.ToolOpt ShapeFlipVerticalAct - Output: Flipped shapes vertically")}MakeSameSizeAct(t,e){this.tul.MakeSameSize(e),F.Debug("= O.ToolOpt MakeSameSizeAct - Output: Made shapes same size with option",e)}ShapeBringToFrontAct(t){this.tul.BringToFrontOf(),F.Debug("= O.ToolOpt ShapeBringToFrontAct - Output: Brought shapes to front")}ShapeSendToBackAct(t){this.tul.SendToBackOf(),F.Debug("= O.ToolOpt ShapeSendToBackAct - Output: Sent shapes to back")}PasteAct(t){this.tul.Paste(false),F.Debug("= O.ToolOpt PasteAct - Output: Pasted objects isRightClick",false)}PasteActRightClickAct(t){this.tul.Paste(true),F.Debug("= O.ToolOpt PasteActRightClickAct - Output: Pasted objects with right click context menu",true)}CopyAct(t){this.tul.Copy(),F.Debug("= O.ToolOpt CopyAct - Output: Copied selected objects")}CutAct(t){this.tul.Cut(),F.Debug("= O.ToolOpt CutAct - Output: Cut selected objects")}DeleteAct(t){this.tul.DeleteSelectedObjects(),F.Debug("= O.ToolOpt DeleteAct - Output: Deleted selected objects")}UndoAct(t){this.tul.Undo(),F.Debug("= O.ToolOpt UndoAct - Output: Undid last operation")}RedoAct(t){this.tul.Redo(),F.Debug("= O.ToolOpt RedoAct - Output: Redid last undone operation")}SaveAct(){this.tul.Save()}DuplicateAct(t){this.tul.Duplicate(),F.Debug("= O.ToolOpt DuplicateAct - Output: Duplicated selected objects")}ClickSymbolAct(t){const e="d6e019b9-110d-4990-8897-eade69451d92";this.tul.StampOrDragDropNewSymbol(e,!1),F.Debug("= O.ToolOpt ClickSymbolAct - Output: Pre-loaded symbol",e)}DragDropSymbolAct(t){this.tul.DragDropSymbol(t,!0),F.Debug("= O.ToolOpt DragDropSymbolAct - Output: Handled symbol drag and drop")}LibSetBackgroundImageAct(t,e){F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Input:",{event:t,isLayerImage:e});try{ye.opt.CloseEdit(!0,!0);const t="C:\\Users\\Double\\Desktop\\RE5cNdq.jpg",i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=t=>{var o;const n=null==(o=i.files)?void 0:o[0];if(!n)return void F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Error: No file selected");const s=new FileReader;s.onload=()=>{s.result;e?ye.opt.ImportBackgroundLayerImage(n):ye.opt.SetBackgroundImage(n),F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Output: Set background image",{asLayer:e})},s.onerror=()=>{F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Error: Failed to read file")},s.readAsDataURL(n)},i.click();let o=t;e?ye.opt.ImportBackgroundLayerImage(o):ye.opt.SetBackgroundImage(o),F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Output: Set background image",{asLayer:e})}catch(i){ye.opt.ExceptionCleanup(i)}}LibLockAct(t){var e;try{const i=t?null==(e=ye.opt.rClickParam)?void 0:e.targetId:Qo.GetTargetSelect();ye.opt.CloseEdit(!0),ye.opt.Lock(i,!0),F.Debug("= O.ToolOpt LibLockAct - Input/Output: Locked object with ID",t,i)}catch(i){ye.opt.ExceptionCleanup(i)}}LibUnlockAct(t){var e;try{const i=t?null==(e=ye.opt.rClickParam)?void 0:e.targetId:Qo.GetTargetSelect();ye.opt.CloseEdit(!0),ye.opt.Lock(i,!1),F.Debug("= O.ToolOpt LibUnlockAct - Input/Output: Unlocked object with ID",t,i)}catch(i){ye.opt.ExceptionCleanup(i)}}LibSetBackgroundColorAct(t){try{ye.opt.CloseEdit(!0,!0);const e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0);let i=e.background.Paint.Color;e.background.Paint.FillType===Se.FillTypes.Transparent&&(i=Se.Colors.White);let o=t;t===Se.Colors.Trans&&(o=Se.Colors.White),Ts.ChangeBackgroundTextColor(o,i),t===Se.Colors.Trans?(e.background.Paint.FillType=Se.FillTypes.Transparent,e.background.Paint.Color=Se.Colors.White):(e.background.Paint.FillType=Se.FillTypes.Solid,e.background.Paint.Color=t),e.background.Paint.Opacity=1,Ts.SetBackgroundColor(),xs.CompleteOperation(),F.Debug("= O.ToolOpt LibSetBackgroundColorAct - Output: Set background color",t)}catch(e){ye.opt.ExceptionCleanup(e)}}LibImportSvgSymbolAct(t){try{ye.opt.CloseEdit();const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=e=>{var i;const o=null==(i=t.files)?void 0:i[0];if(!o)return void F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Error: No file selected");const n=new FileReader;n.onload=()=>{n.result;ye.opt.ImportSvgSymbol(o),F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Output: Set background image",{e:e})},n.onerror=()=>{F.Debug("= O.ToolOpt LibSetBackgroundImageAct - Error: Failed to read file")},n.readAsDataURL(o)},t.click()}catch(e){ye.opt.ExceptionCleanup(e)}}LibToolShape(t,e){this.tul.ToolDragDropSymbol(t,e)}LibAddNoteAct(){}LibAddCommentAct(){}LibHyperlinkAct(){}VueForeignObjectAct(t,e,i){F.Debug("= = O.ToolOpt VueForeignObjectAct - Iutput: Created shape of type",t,e,i),this.tul.StampOrDragDropNewShape(t,e,i)}SetX(t){try{ye.opt.CloseEdit(),ye.opt.SetTopLeft(t,!0)}catch(e){ye.opt.ExceptionCleanup(e)}}SetY(t){try{ye.opt.CloseEdit(),ye.opt.SetTopLeft(t,!1)}catch(e){ye.opt.ExceptionCleanup(e)}}SetWidth(t){try{ye.opt.CloseEdit(),ye.opt.ChangeWidth(t)}catch(e){ye.opt.ExceptionCleanup(e)}}SetHeight(t){try{ye.opt.CloseEdit(),ye.opt.ChangeHeight(t)}catch(e){ye.opt.ExceptionCleanup(e)}}SetBackgroundColor(t){try{ye.opt.CloseEdit(),ye.opt.SetBackgroundColor(t)}catch(e){ye.opt.ExceptionCleanup(e)}}AddToLibraryAct(){try{ye.opt.CloseEdit(),ye.opt.AddToLibrary()}catch(t){ye.opt.ExceptionCleanup(t)}}LoadLibraryAct(){try{ye.opt.CloseEdit(),ye.opt.LoadLibrary()}catch(t){ye.opt.ExceptionCleanup(t)}}ResetScaleAct(t){try{ye.opt.CloseEdit(),ye.docUtil.SetZoomLevel(100*ge.T3Config.Zoom.Default),ye.docUtil.UpdateRefZoomScale(ge.T3Config.Zoom.Default)}catch(e){ye.opt.ExceptionCleanup(e)}}ClearAct(){try{ye.opt.CloseEdit(),this.tul.ClearAndRest(),F.Debug("= O.ToolOpt ClearAct - Output: Cleared all shapes and data")}catch(t){ye.opt.ExceptionCleanup(t)}}ClearContextMenu(){try{$n.ShowContextMenu(!1,"DocumentArea","Default")}catch(t){ye.opt.ExceptionCleanup(t)}}});class xs{static CancelObjectStamp(t){F.Debug("O.Opt CancelObjectStamp - Input:",{shouldUnbindEvents:t}),Ts.SetModalOperation(me.OptTypes.None),Ae.DocContext.SelectionToolSticky=!1,rn.LMStampPostRelease(!1),ye.opt.actionStoredObjectId>=0&&($o.Undo(!0),ws.ClearFutureUndoStates(),ye.opt.actionStoredObjectId=-1,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.actionSvgObject=null),Ps.SetEditMode(Se.EditState.Default),t&&(Rt(window).unbind("mousedown"),Rt(window).unbind("click"),Rt(window).unbind("mousemove",Ls.Evt_MouseStampObjectMove),ye.opt.WorkAreaHammer.enable(!0)),ye.opt.moveList=null,ye.opt.stampCompleteCallback=null,ye.opt.stampCompleteUserData=null,ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=0,ye.opt.stampHCenter=!1,ye.opt.stampVCenter=!1,ye.opt.stampSticky=!1,F.Debug("O.Opt CancelObjectStamp - Output: Object stamp canceled")}static CancelObjectStampTextOnTap(t){F.Debug("O.Opt CancelObjectStampTextOnTap - Input:",t),Ts.SetModalOperation(me.OptTypes.None),rn.LMStampPostRelease(!1),Ps.SetEditMode(Se.EditState.Default),t&&ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),ye.opt.stampCompleteCallback=null,ye.opt.stampCompleteUserData=null,ye.opt.moveList=null,ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=0,ye.opt.stampHCenter=!1,ye.opt.stampVCenter=!1,ye.opt.drawShape=null,ye.opt.moveList=null,ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,F.Debug("O.Opt CancelObjectStampTextOnTap - Output: Completed")}static CancelObjectDragDrop(t){if(F.Debug("O.Opt CancelObjectDragDrop - Input:",{shouldUnbindEvents:t}),Ts.SetModalOperation(me.OptTypes.None),rn.LMStampPostRelease(!1),ye.opt.actionStoredObjectId>=0){const t=ye.opt.svgObjectLayer.GetElementById(ye.opt.actionStoredObjectId);t&&ye.opt.svgObjectLayer.RemoveElement(t),$o.Undo(!0),ws.ClearFutureUndoStates(),ye.opt.actionStoredObjectId=-1,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.actionSvgObject=null}Ps.SetEditMode(Se.EditState.Default),t&&ye.opt.UnbindDragDropOrStamp(),ye.opt.stampCompleteCallback=null,ye.opt.stampCompleteUserData=null,ye.opt.moveList=null,ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=0,ye.opt.stampHCenter=!1,ye.opt.stampVCenter=!1,F.Debug("O.Opt CancelObjectDragDrop - Output: Drag and drop canceled")}static CancelObjectDraw(){F.Debug("O.Opt CancelObjectDraw - Input: No parameters");const t=ws.GetObjectPtr(ye.opt.actionStoredObjectId,!1),e=t instanceof we.Shape.PolyLine||t instanceof we.Shape.PolyLineContainer;Ts.SetModalOperation(me.OptTypes.None),rn.LMStampPostRelease(!1),ye.opt.actionStoredObjectId>=0&&!e?($o.Undo(!0),ws.ClearFutureUndoStates(),ye.opt.actionStoredObjectId=-1,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.actionSvgObject=null):ws.GetObjectPtr(ye.opt.actionStoredObjectId,!0),Ps.SetEditMode(Se.EditState.Default),ye.opt.UnbindDragDropOrStamp(),ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),t&&t.CancelObjectDraw(),ye.wallOpt.CancelObjectDraw&&ye.wallOpt.CancelObjectDraw(),F.Debug("O.Opt CancelObjectDraw - Output: Object draw canceled.")}static DragDropNewShape(t,e,i,o,n,s){F.Debug("= U.DrawUtil DragDropNewShape - Input:",{drawingShape:t?t.BlockID:null,horizontalCenter:e,verticalCenter:i,useDefaultStyle:o,hasCallback:!!n});try{Ts.SetModalOperation(me.OptTypes.DragDrop),ws.GetObjectPtr(ye.opt.teDataBlockId,!1),ye.opt.CloseEdit(),ye.opt.stampCompleteCallback=n||null,ye.opt.stampCompleteUserData=s||null,ye.opt.stampHCenter=e,ye.opt.stampVCenter=i,ye.opt.useDefaultStyle=o,ye.opt.actionStoredObjectId=-1,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.newObjectVisible=!1,ye.opt.drawShape=t,t.flags&Se.ObjFlags.TextOnly?Ps.SetEditMode(Se.EditState.Text):Ps.SetEditMode(Se.EditState.Stamp),ye.Evt_StampObjectDragEnd=Ls.Evt_StampObjectDragEndFactory(o),ye.opt.mainAppHammer||this.PreDragDropOrStamp(),ye.opt.WorkAreaHammer.enable(!1),ye.opt.mainAppHammer.on("mousemove",Ls.Evt_StampObjectDrag),ye.opt.mainAppHammer.on("mouseup",ye.Evt_StampObjectDragEnd),rn.LMStampPreTrack(),this.InitializeAutoGrowDrag(),F.Debug("= U.DrawUtil DragDropNewShape - Output: Drag and drop initialized")}catch(a){throw F.Debug("= U.DrawUtil DragDropNewShape - Error:",a),Ps.CancelOperation(),ye.opt.ExceptionCleanup(a),a}}static AllowAutoInsert(){F.Debug("O.Opt AllowAutoInsert - Input: No parameters");const t=ye.wallOpt.AllowAutoInsert();return F.Debug("O.Opt AllowAutoInsert - Output:",t),t}static InitializeAutoGrowDrag(t,e){F.Debug("O.Opt InitializeAutoGrowDrag - Input:",{actionType:t,shouldCloseEdit:e}),ye.opt.dragGotAutoResizeRight=!1,ye.opt.dragGotAutoResizeBottom=!1,ye.opt.dragGotAutoResizeOldX=[],ye.opt.dragGotAutoResizeOldY=[],F.Debug("O.Opt InitializeAutoGrowDrag - Output: Auto grow drag initialized")}static MouseDrawNewShape(t,e,i,o,n,s){F.Debug("= u.DrawUtil: MouseDrawNewShape - Input:",{drawingShape:t?t.BlockID:null,centerHorizontally:e,centerVertically:i,useDefaultStyle:o,hasCallback:!!n,hasUserData:!!s}),Ts.SetModalOperation(me.OptTypes.Stamp),ws.GetObjectPtr(ye.opt.teDataBlockId,!1),on.DeactivateTextEdit(!1),ye.opt.stampCompleteCallback=n||null,ye.opt.stampCompleteUserData=s||null,ye.opt.stampHCenter=e,ye.opt.stampVCenter=i,ye.opt.useDefaultStyle=o,ye.opt.actionStoredObjectId=-1,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.newObjectVisible=!1,ye.opt.drawShape=t,t.flags&Se.ObjFlags.TextOnly?Ps.SetEditMode(Se.EditState.Text):Ps.SetEditMode(Se.EditState.Stamp,ze.CursorType.Stamp),ye.opt.WorkAreaHammer.enable(!1),Rt(window).bind("mousemove",Ls.Evt_MouseStampObjectMove),ye.Evt_LMMouseStpObjectDone=Ls.Evt_MouseStampObjectDoneFactory(o),Rt(window).bind("mousedown",ye.Evt_LMMouseStpObjectDone),Rt(window).bind("click",ye.Evt_LMMouseStpObjectDone),rn.LMStampPreTrack(),this.InitializeAutoGrowDrag()}static MouseStampObjectDone(t,e){F.Debug("O.Opt MouseStampObjectDone - Input:",{event:t,additionalData:e});try{const e=ye.opt.svgDoc.docInfo;let i=!1;const o=[];if(this.ResetAutoScrollTimer(),(t.clientX>=e.dispX+e.dispWidth||t.clientX<ye.opt.svgDoc.docInfo.dispX||t.clientY<ye.opt.svgDoc.docInfo.dispY)&&(i=!0),i)return this.CancelObjectStamp(!0),void F.Debug("O.Opt MouseStampObjectDone - Output: Canceled (outside work area)");if(ye.opt.actionStoredObjectId<0)return void F.Debug("O.Opt MouseStampObjectDone - Output: No object created yet");Qo.ClearAnySelection(!0);const n={FrameList:[]};let s=ye.opt.svgDoc.ConvertWindowToDocCoords(t.clientX,t.clientY);const a=ye.opt.drawShape.flags&Se.ObjFlags.TextOnly;if(!a){const e=ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0,i=ye.opt.OverrideSnaps(t);!ye.docUtil.docConfig.enableSnap||e||i||(s=ye.docUtil.SnapToGrid(s))}let r=s.x;ye.opt.stampHCenter&&(r-=ye.opt.drawShape.Frame.width/2);let l,h,c=s.y;if(ye.opt.stampVCenter&&(c-=ye.opt.drawShape.Frame.height/2),ye.opt.moveList&&ye.opt.moveList.length)for(let t=0;t<ye.opt.moveList.length;t++){const e=ye.opt.moveList[t],i=ws.GetObjectPtr(e,!0);i&&(i.UpdateFrame(i.Frame),h=Oe.DeepCopy(i.Frame),n.FrameList.push(h),i.dataStyleOverride=null)}else{if(ye.opt.drawShape){if(ye.opt.drawShape.sizedim.width=ye.opt.drawShape.Frame.width,ye.opt.drawShape.sizedim.height=ye.opt.drawShape.Frame.height,ye.opt.drawShape.objecttype===Se.FNObjectTypes.Frame){const t=vs.ZListPreserve();l=this.ReplaceSpecialObject(ye.opt.drawShape,ye.opt.actionStoredObjectId,t,ye.opt.drawShape.objecttype),n.ReplaceSpecialObjectID=l}ye.opt.drawShape.UpdateFrame(ye.opt.drawShape.Frame),h=Oe.DeepCopy(ye.opt.drawShape.Frame),n.FrameList.push(h)}ws.GetObjectPtr(ye.opt.actionStoredObjectId,!0)}if(n.linkParams=Oe.DeepCopy(ye.opt.linkParams),ye.opt.SetLinkFlagsOnFilledClosedPolylines(),ye.wallOpt instanceof ls&&ye.wallOpt.EnsureCubicleBehindOutline(ye.opt.actionStoredObjectId),Ps.SetEditMode(Se.EditState.Default),Rt(window).unbind("mousedown"),Rt(window).unbind("click"),Rt(window).unbind("mousemove",Ls.Evt_MouseStampObjectMove),ye.opt.WorkAreaHammer.enable(!0),a||o.push(ye.opt.actionStoredObjectId),ye.opt.moveList&&ye.opt.moveList.length?(o.length=0,o.push(...ye.opt.moveList),ye.opt.actionStoredObjectId=-1):ws.AddToDirtyList(ye.opt.actionStoredObjectId),l){const t=[l];ws.DeleteObjects(t,!1)}vs.IsTopMostVisibleLayer()||vs.MarkAllAllVisibleHigherLayerObjectsDirty(),Os.RenderDirtySVGObjects(),ye.opt.moveList=null,ye.opt.stampCompleteCallback&&ye.opt.actionStoredObjectId>=0&&ye.opt.stampCompleteCallback(ye.opt.actionStoredObjectId,ye.opt.stampCompleteUserData),ye.opt.stampCompleteCallback=null,ye.opt.stampCompleteUserData=null,ye.opt.stampHCenter=!1,ye.opt.stampVCenter=!1,ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=0,rn.LMStampPostRelease(!0),an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,Ts.SetModalOperation(me.OptTypes.None),this.CompleteOperation(o),$n.AddCurrentObjectToAppState(),F.Debug("O.Opt MouseStampObjectDone - Output: Stamp operation completed successfully")}catch(i){F.Debug("O.Opt MouseStampObjectDone - Error:",i),Ps.CancelOperation(),this.DragDrop_ExceptionCleanup(),ye.opt.ExceptionCleanup(i)}}static MouseAddNewShape(t){let e;F.Debug("O.Opt MouseAddNewShape - Input:",{useDefaultStyle:t});let i=null!==ye.opt.drawShape.nativeDataArrayBuffer,o=0,n=!1;if((e=this.AddNewObject(ye.opt.drawShape,t,!1))>=0){ye.opt.actionStoredObjectId=e;let t=vs.VisibleZList();if(ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.moveList&&ye.opt.moveList.length)for(let e=0;e<ye.opt.moveList.length;e++){let i=ye.opt.moveList[e],s=ws.GetObjectPtr(i,!1);if(s){let e=s.GetSVGFrame();s instanceof we.Shape.PolyLine&&s.polylist&&s.polylist.closed&&s.StyleRecord&&s.StyleRecord.Line&&s.StyleRecord.Line.BThick&&e.x<0&&e.y<0&&(o=-2*s.StyleRecord.Line.BThick,n=s instanceof we.Shape.PolyLineContainer),e.y+=o,e.x+=o,n||(o=0),ye.opt.dragBBoxList.push(e);let a=t.indexOf(i);Os.AddSVGObject(a,i,!0,!1),ye.opt.dragElementList.push(i),ye.docUtil.docConfig.enableSnap&&i===ye.opt.actionStoredObjectId&&(ye.opt.dragTargetBBox=Oe.DeepCopy(e)),ye.opt.dragEnclosingRect=ye.opt.GetListSRect(ye.opt.moveList,!1,!0)}}else if(i){let i=ws.GetObjectPtr(e,!1),o=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),n=i.ImageURL&&i.ImageURL.length>0;i&&i.SymbolID!==me.Common.WallOpenId&&!n&&i.ApplyCurvature(o.def.rrectparam);let s=t.indexOf(ye.opt.actionStoredObjectId);Os.AddSVGObject(s,e,!0,!1)}ye.opt.actionSvgObject=ye.opt.svgObjectLayer.GetElementById(ye.opt.actionStoredObjectId),ye.opt.linkParams&&ye.opt.linkParams.lpCircList.push(ye.opt.actionStoredObjectId),Ts.ShowFrame(!0)}F.Debug("O.Opt MouseAddNewShape - Output: New object created with ID:",e)}static MouseStampObjectMove(t){F.Debug("O.Opt MouseStampObjectMove - Input:",t);const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.clientX,t.clientY);if(ye.opt.actionStoredObjectId<0){if(!(t.clientX>=ye.opt.svgDoc.docInfo.dispX&&t.clientY>=ye.opt.svgDoc.docInfo.dispY))return void F.Debug("O.Opt MouseStampObjectMove - Output: Cursor outside document boundaries");this.MouseAddNewShape(ye.opt.useDefaultStyle),ye.opt.newObjectVisible=!0,F.Debug("O.Opt MouseStampObjectMove - Created new shape with ID:",ye.opt.actionStoredObjectId)}this.AutoScrollCommon(t,!0,"HandleStampDragDoAutoScroll")&&this.StampObjectMoveCommon(e.x,e.y,t),F.Debug("O.Opt MouseStampObjectMove - Output: Movement processed")}static StampObjectMoveCommon(t,e,i){var o,n,s,a;let r,l,h,c,p,d,u,g,y;F.Debug("O.Opt StampObjectMoveCommon - Input:",{mouseX:t,mouseY:e,event:i});let S,m=0,b=0,D={},f={x:t,y:e},x=null;const C=ye.opt.svgDoc.ConvertDocToWindowCoords(t,e);if(!C)return void F.Debug("O.Opt StampObjectMoveCommon - Output: No valid window coordinates");if(ye.opt.actionStoredObjectId>0){if(C.x<ye.opt.svgDoc.docInfo.dispX||C.y<ye.opt.svgDoc.docInfo.dispY){if(ye.opt.newObjectVisible){if(ye.opt.moveList&&ye.opt.moveList.length)for(let t=0;t<ye.opt.moveList.length;++t)c=ye.opt.moveList[t],u=Os.GetSVGDragElement(t),u&&u.SetVisible(!1);else ye.opt.actionSvgObject&&ye.opt.actionSvgObject.SetVisible(!1);ye.opt.newObjectVisible=!1,Ts.ShowFrame(!1)}return void F.Debug("O.Opt StampObjectMoveCommon - Output: Object outside viewport, hidden")}if(!ye.opt.newObjectVisible){if(ye.opt.moveList&&ye.opt.moveList.length)for(let t=0;t<ye.opt.moveList.length;++t)c=ye.opt.moveList[t],u=Os.GetSVGDragElement(t),u&&u.SetVisible(!0);else ye.opt.actionSvgObject&&ye.opt.actionSvgObject.SetVisible(!0);ye.opt.newObjectVisible=!0,Ts.ShowFrame(!0)}}if(r=ws.GetObjectPtr(ye.opt.actionStoredObjectId,!1),!r)return void F.Debug("O.Opt StampObjectMoveCommon - Output: No valid drawing object");const P=ye.opt.drawShape.flags&Se.ObjFlags.TextOnly,T=ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0,O=ye.opt.OverrideSnaps(i)||T;let v,w;if(!ye.opt.moveList&&!P&&this.AllowSnapToShapes()){const t={};if(v=r.CanSnapToShapes(t),v>=0){const e=new We,i=ws.GetObjectPtr(v,!1).GetSnapRect();w=Oe.DeepCopy(i),w.x=f.x-i.width/2,w.y=f.y-i.height/2;const o=an.DynamicSnapsGetSnapObjects(v,w,e,ye.opt.moveList,null,t);null!==o.x&&(w.x+=o.x,f.x+=o.x),null!==o.y&&(w.y+=o.y,f.y+=o.y)}}if(ye.docUtil.docConfig.enableSnap&&!O&&!P){let t,e;if(ye.opt.moveList&&ye.opt.moveList.length?(l=ye.opt.moveList.indexOf(ye.opt.actionStoredObjectId),e=Oe.DeepCopy(ye.opt.dragBBoxList[l]),t=r.GetSnapRect()):(e=Oe.DeepCopy(ye.opt.actionBBox),t=r.GetSnapRect()),x=ye.opt.dragEnclosingRect?Oe.DeepCopy(ye.opt.dragEnclosingRect):t,x&&e){p=x.x-e.x,d=x.y-e.y,x.x=f.x-x.width/2,x.y=f.y-x.height/2;const i={x:x.x-p,y:x.y-d},o=Oe.DeepCopy(t);if(o.x=f.x-t.width/2,o.y=f.y-t.height/2,r.CustomSnap(i.x,i.y,0,0,!1,f));else if(ye.docUtil.docConfig.centerSnap){const t=ye.docUtil.SnapToGrid(f);f.x=t.x,f.y=t.y}else{const t=ye.docUtil.SnapRect(o);f.x+=t.x,f.y+=t.y}}}if(ye.opt.moveList&&ye.opt.moveList.length){h=ye.opt.moveList.length,l=ye.opt.moveList.indexOf(ye.opt.actionStoredObjectId),S=ye.opt.dragEnclosingRect;let t={x:f.x+S.width/2,y:f.y+S.height/2};t=this.DoAutoGrowDrag(t),f.x=t.x-S.width/2,f.y=t.y-S.height/2,p=f.x-S.x-S.width/2,d=f.y-S.y-S.height/2,S.x+p<0&&(p=-S.x),S.y+d<0&&(d=-S.y),S=ye.opt.dragBBoxList[l],r.SetShapeOrigin((null!=(o=null==S?void 0:S.x)?o:0)+p,(null!=(n=null==S?void 0:S.y)?n:0)+d),f=rn.LMStampDuringTrack(f,r);const e=r.GetDimensionsForDisplay();Ts.UpdateDisplayCoordinates(e,f,ze.CursorTypes.Plus,r);const i=new Ke;i.left=e.x,i.top=e.y;const s=r.Dimensions&Se.DimensionFlags.ShowFeetAsInches;i.widthstr=Ae.DocContext.CurrentWidth,i.heightstr=Ae.DocContext.CurrentHeight,i.leftstr=Ve.GetLengthInRulerUnits(i.left,!1,ye.docUtil.rulerConfig.originx,s),i.topstr=Ve.GetLengthInRulerUnits(i.top,!1,ye.docUtil.rulerConfig.originy,s);for(let o=0;o<h;++o){c=ye.opt.moveList[o];const t=ws.GetObjectPtr(c);if(t){if(c!==ye.opt.actionStoredObjectId){if(S=ye.opt.dragBBoxList[o],!S)continue;t.SetShapeOrigin(S.x+p,S.y+d)}u=Os.GetSVGDragElement(o),!u&&t.ShapeType===me.ShapeType.SvgSymbol&&t.SVGFragment&&(g||(g=vs.VisibleZList()),y=g.indexOf(c),Os.AddSVGObject(y,c,!0,!1),u=ye.opt.svgObjectLayer.GetElementById(c)),u&&u.SetPos(S.x+p,S.y+d)}}}else{S=Oe.DeepCopy(ye.opt.actionBBox),x=Oe.DeepCopy(ye.opt.dragEnclosingRect);let t={x:f.x+x.width/2,y:f.y+x.height/2};t=this.DoAutoGrowDrag(t),f.x=t.x-x.width/2,f.y=t.y-x.height/2,p=f.x-x.x-x.width/2,d=f.y-x.y-x.height/2,p=S.x+p<0?-x.x:f.x-S.x-S.width/2,d=S.y+d<0?-x.y:f.y-S.y-S.height/2,r.SetShapeOrigin(S.x+p,S.y+d),f=rn.LMStampDuringTrack(f,r);const e=r.GetDimensionsForDisplay();Ts.UpdateDisplayCoordinates(e,f,ze.CursorTypes.Move,r);const i=new Ke;i.left=e.x,i.top=e.y;const o=r.Dimensions&Se.DimensionFlags.ShowFeetAsInches;i.widthstr=Ae.DocContext.CurrentWidth,i.heightstr=Ae.DocContext.CurrentHeight,i.leftstr=Ve.GetLengthInRulerUnits(i.left,!1,ye.docUtil.rulerConfig.originx,o),i.topstr=Ve.GetLengthInRulerUnits(i.top,!1,ye.docUtil.rulerConfig.originy,o),p=f.x-x.x-x.width/2,d=f.y-x.y-x.height/2,x.x+p-m<0?(p=-x.x+m,m=0):p=f.x-S.x-S.width/2,x.y+d-b<0?(d=-x.y+b,b=0):d=f.y-S.y-S.height/2,r.SetShapeOrigin((null!=(s=null==S?void 0:S.x)?s:0)+p,(null!=(a=null==S?void 0:S.y)?a:0)+d),ye.opt.linkParams&&(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.ConnectIndexHistory.length>0)&&(D=Oe.DeepCopy(S),D.x+=p,D.y+=d,Yo.HandleHookedObjectMoving(r,D)),ye.opt.actionSvgObject.SetPos(S.x+p-m,S.y+d-b);const n=ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0,l=new We;l&&(n?ye.opt.dynamicGuides&&(an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null):an.DynamicSnapsUpdateGuides(l,v,w))}F.Debug("O.Opt StampObjectMoveCommon - Output: Object positioned at",f)}static DragDropObjectDone(t,e){F.Debug("DragDropObjectDone - Input:",{event:t,additionalData:e}),ye.opt.WorkAreaHammer.enable(!0);try{ve.StopPropagationAndDefaults(t),this.ResetAutoScrollTimer();let e,i,o,n,s=!1;const a=ye.opt.svgDoc.docInfo;let r=!1;const l=[];if(t.clientX>=a.dispX+a.dispWidth&&(r=!0),t.clientX<ye.opt.svgDoc.docInfo.dispX&&(r=!0),t.clientY<ye.opt.svgDoc.docInfo.dispY&&(r=!0),r)return this.CancelObjectDragDrop(!0),void F.Debug("DragDropObjectDone - Output: Canceled (outside work area)");if(null==ye.opt.linkParams)return this.CancelObjectDragDrop(!0),void F.Debug("DragDropObjectDone - Output: Canceled (no link parameters)");let h=ye.opt.svgDoc.ConvertWindowToDocCoords(t.clientX,t.clientY);if(ye.opt.drawShape&&(s=!!(ye.opt.drawShape.flags&Se.ObjFlags.TextOnly)),!s){const e=ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0,i=ye.opt.OverrideSnaps(t);!ye.docUtil.docConfig.enableSnap||e||i||(h=ye.docUtil.SnapToGrid(h))}let c=h.x;ye.opt.stampHCenter&&(c-=ye.opt.drawShape.Frame.width/2);let p,d,u=h.y;ye.opt.stampVCenter&&(u-=ye.opt.drawShape.Frame.height/2);const g={FrameList:[]};if(ye.opt.moveList&&ye.opt.moveList.length)for(p=ye.opt.moveList[0],i=ye.opt.moveList.length,e=0;e<i;e++)o=ws.GetObjectPtr(ye.opt.moveList[e],!0),o&&(o.UpdateFrame(o.Frame),d=Oe.DeepCopy(o.Frame),g.FrameList.push(d)),o=ws.GetObjectPtr(ye.opt.moveList[e],!0);else{if(ye.opt.drawShape){if(p=ye.opt.drawShape.BlockID,ye.opt.drawShape.sizedim.width=ye.opt.drawShape.Frame.width,ye.opt.drawShape.sizedim.height=ye.opt.drawShape.Frame.height,ye.opt.drawShape.objecttype===Se.FNObjectTypes.Frame){const t=vs.ZListPreserve();n=this.ReplaceSpecialObject(ye.opt.drawShape,ye.opt.actionStoredObjectId,t,ye.opt.drawShape.objecttype)}ye.opt.drawShape.UpdateFrame(ye.opt.drawShape.Frame),d=Oe.DeepCopy(ye.opt.drawShape.Frame),g.FrameList.push(d)}ws.GetObjectPtr(ye.opt.actionStoredObjectId,!0)}Ps.SetEditMode(Se.EditState.Default),ye.opt.UnbindDragDropOrStamp(),s||l.push(ye.opt.actionStoredObjectId);let y=Zo.GetGvSviOpt(p);if(null==y&&(y=ye.wallOpt),y instanceof ls&&y.EnsureCubicleBehindOutline(ye.opt.actionStoredObjectId),ye.opt.moveList&&ye.opt.moveList.length?(l.length=0,l.push(...ye.opt.moveList),ye.opt.actionStoredObjectId=-1):ws.AddToDirtyList(ye.opt.actionStoredObjectId),n){const t=[n];ws.DeleteObjects(t,!1)}vs.IsTopMostVisibleLayer()||vs.MarkAllAllVisibleHigherLayerObjectsDirty(),Os.RenderDirtySVGObjects(),ye.opt.SetLinkFlagsOnFilledClosedPolylines(),ye.opt.moveList=null,ye.opt.stampCompleteCallback&&ye.opt.actionStoredObjectId>=0&&ye.opt.stampCompleteCallback(ye.opt.actionStoredObjectId,ye.opt.stampCompleteUserData),ye.opt.stampCompleteCallback=null,ye.opt.stampCompleteUserData=null,ye.opt.stampHCenter=!1,ye.opt.stampVCenter=!1,ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=0,rn.LMStampPostRelease(!0),an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null,ye.opt.actionStoredObjectId=-1,ye.opt.dragBBoxList=[],ye.opt.dragElementList=[],ye.opt.actionSvgObject=null,Ts.SetModalOperation(me.OptTypes.None),this.CompleteOperation(l),$n.AddCurrentObjectToAppState(),F.Debug("DragDropObjectDone - Output: Drag-drop operation completed successfully")}catch(i){throw F.Debug("DragDropObjectDone - Error:",i),Ps.CancelOperation(),this.DragDrop_ExceptionCleanup(),ye.opt.ExceptionCleanup(i),i}}static ReplaceSpecialObject(t,e,i,o){let n,s,a,r;for(F.Debug("O.Opt ReplaceSpecialObject - Input:",{drawingObject:t,targetObjectId:e,zList:i,objectType:o}),vs.VisibleZList(),s=i.length,n=0;n<s;n++)if(r=i[n],a=ws.GetObjectPtr(r,!1),a&&a.objecttype===o&&r!==e)return i[n]=e,i[s-1]===e&&(i[s-1]=r),t.Frame=Oe.DeepCopy(a.Frame),a.extraflags=ve.SetFlag(a.extraflags,me.ExtraFlags.NoDelete,!1),a.flags&Se.ObjFlags.Lock&&(t.flags=ve.SetFlag(t.flags,Se.ObjFlags.Lock,!0)),F.Debug("O.Opt ReplaceSpecialObject - Output: Replaced object ID:",r),r;return F.Debug("O.Opt ReplaceSpecialObject - Output: No object replaced"),0}static DragDrop_ExceptionCleanup(){F.Debug("O.Opt DragDrop_ExceptionCleanup - Input: No parameters"),ye.opt.emptyEMFList=[],ye.opt.emptySymbolList=[],F.Debug("O.Opt DragDrop_ExceptionCleanup - Output: Cleanup completed")}static StampObjectMove(t){F.Debug("O.Opt StampObjectMove - Input:",t),ve.StopPropagationAndDefaults(t);let e=0,i=0;t.gesture?(e=t.gesture.center.clientX,i=t.gesture.center.clientY):(e=t.clientX,i=t.clientY);const o=ye.opt.svgDoc.ConvertWindowToDocCoords(e,i);if(F.Debug("O.Opt StampObjectMove - Converted coordinates:",o),ye.opt.actionStoredObjectId<0){if(e<ye.opt.svgDoc.docInfo.dispX||i<ye.opt.svgDoc.docInfo.dispY)return void F.Debug("O.Opt StampObjectMove - Output: Cursor outside document boundaries");this.MouseAddNewShape(ye.opt.useDefaultStyle),ye.opt.newObjectVisible=!0,F.Debug("O.Opt StampObjectMove - Created new shape with ID:",ye.opt.actionStoredObjectId)}this.AutoScrollCommon(t,!0,"HandleStampDragDoAutoScroll")&&this.StampObjectMoveCommon(o.x,o.y,t),F.Debug("O.Opt StampObjectMove - Output: Movement processed")}static PreDragDropOrStamp(){F.Debug("O.Opt PreDragDropOrStamp - Input: No parameters"),ye.opt.mainAppHammer&&ye.opt.UnbindDragDropOrStamp(),ye.opt.mainAppHammer=new Hammer(ye.opt.mainAppElement),F.Debug("O.Opt PreDragDropOrStamp - Output: Hammer manager created for drag/drop operations")}static DrawNewObject(t,e){F.Debug("O.Opt DrawNewObject - Input:",{newShape:t,clearExistingSection:e}),Ts.SetModalOperation(me.OptTypes.Draw),ws.GetObjectPtr(ye.opt.teDataBlockId,!1),ye.opt.CloseEdit(),ye.opt.lineDrawId=-1,ye.opt.drawShape=t,Qo.ClearAnySelection(!e),Ps.SetEditMode(Se.EditState.Edit),ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDrawStart),F.Debug("O.Opt DrawNewObject - Output: Draw new object initialized")}static StartNewObjectDraw(t){if(F.Debug("O.Opt StartNewObjectDraw - Input:",t),ye.opt.lineStamp)return void F.Debug("O.Opt StartNewObjectDraw - Output: lineStamp active, aborting draw");let e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);F.Debug("O.Opt StartNewObjectDraw: Client coords and Doc coords",t.gesture.center.clientX,t.gesture.center.clientY,e),ye.opt.drawStartX=e.x,ye.opt.drawStartY=e.y,F.Debug("O.Opt StartNewObjectDraw: Draw start coordinates set",ye.opt.drawStartX,ye.opt.drawStartY);if(!ye.opt.drawShape.LMDrawPreTrack(e))return void F.Debug("O.Opt StartNewObjectDraw - Output: Pre-track check failed");let i=ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0,o=ye.opt.OverrideSnaps(t);i=i||o;if(ye.docUtil.docConfig.enableSnap&&!i){let t=ye.opt.drawShape.GetSnapRect(),i=ye.opt.dragEnclosingRect?Oe.DeepCopy(ye.opt.dragEnclosingRect):t,o=Oe.DeepCopy(ye.opt.actionBBox),n=i.x-o.x,s=i.y-o.y;i.x=e.x-i.width/2,i.y=e.y-i.height/2;let a={x:i.x-n,y:i.y-s};if(!ye.opt.drawShape.CustomSnap(a.x,a.y,0,0,!1,e))if(ye.docUtil.docConfig.centerSnap){let t=ye.docUtil.SnapToGrid(e);e.x=t.x,e.y=t.y}else{let i=Oe.DeepCopy(t);i.x=e.x-t.width/2,i.y=e.y-t.height/2;let o=ye.docUtil.SnapRect(i);e.x+=o.x,e.y+=o.y}}let n=e.x,s=e.y;Qo.ClearAnySelection(!0),ye.opt.actionStartX=n,ye.opt.actionStartY=s,ye.opt.actionBBox={x:n,y:s,width:1,height:1},ye.opt.actionNewBBox={x:n,y:s,width:1,height:1};let a=ye.opt.drawShape;this.InitializeAutoGrowDrag(),Ts.ShowFrame(!0),a.LMDrawClick(n,s),this.AddNewObject(a,!a.bOverrideDefaultStyleOnDraw,!1);let r=vs.ActiveLayerZList(),l=r.length;ye.opt.actionStoredObjectId=r[l-1],ye.opt.linkParams&&ye.opt.linkParams.lpCircList&&ye.opt.linkParams.lpCircList.push(ye.opt.actionStoredObjectId),ye.opt.actionSvgObject=ye.opt.svgObjectLayer.GetElementById(ye.opt.actionStoredObjectId),ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0&&(Yo.HiliteConnect(ye.opt.linkParams.SConnectIndex,ye.opt.linkParams.SConnectPt,!0,!1,a.BlockID,ye.opt.linkParams.SConnectInside),ye.opt.linkParams.SHiliteConnect=ye.opt.linkParams.SConnectIndex,ye.opt.linkParams.SHiliteInside=ye.opt.linkParams.SConnectInside),ye.opt.linkParams&&ye.opt.linkParams.SJoinIndex>=0&&(Yo.HiliteConnect(ye.opt.linkParams.SJoinIndex,ye.opt.linkParams.SConnectPt,!0,!0,a.BlockID,null),ye.opt.linkParams.SHiliteJoin=ye.opt.linkParams.SJoinIndex),F.Debug("O.Opt StartNewObjectDraw - Output: New object drawn with ID",ye.opt.actionStoredObjectId)}static StampTextObjectOnTapDone(t,e){F.Debug("O.Opt StampTextObjectOnTapDone - Input:",{event:t,optionalParam:e});let i=[],o=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),n=ye.opt.drawShape.flags&Se.ObjFlags.TextOnly;if(!n){let e=ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0;ye.opt.OverrideSnaps(t)&&(e=!0),ye.docUtil.docConfig.enableSnap&&!e&&(o=ye.docUtil.SnapToGrid(o))}let s=o.x-ye.opt.drawShape.Frame.width/2,a=o.y-ye.opt.drawShape.Frame.height/2;ye.opt.drawShape.Frame.x=s-ye.opt.stampShapeOffsetX,ye.opt.drawShape.Frame.y=a-ye.opt.stampShapeOffsetY,ye.opt.drawShape.sizedim.width=ye.opt.drawShape.Frame.width,ye.opt.drawShape.sizedim.height=ye.opt.drawShape.Frame.height,ye.opt.drawShape.UpdateFrame(ye.opt.drawShape.Frame),ws.GetObjectPtr(ye.opt.actionStoredObjectId,!0),Ps.SetEditMode(Se.EditState.Default),ye.opt.moveList&&ye.opt.moveList.length?(ws.DeleteObjects(i,!1),i=ye.opt.moveList.slice(0),ye.opt.actionStoredObjectId=-1):ws.AddToDirtyList(ye.opt.actionStoredObjectId),Os.RenderDirtySVGObjects(),ye.opt.moveList=null,ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),this.CompleteOperation(i),ye.opt.stampCompleteCallback&&ye.opt.actionStoredObjectId>=0&&ye.opt.stampCompleteCallback(ye.opt.actionStoredObjectId,ye.opt.stampCompleteUserData),ye.opt.stampCompleteCallback=null,ye.opt.stampCompleteUserData=null,ye.opt.stampHCenter=!1,ye.opt.stampVCenter=!1,ye.opt.stampShapeOffsetX=0,ye.opt.stampShapeOffsetY=0,rn.LMStampPostRelease(!0),n||i.push(ye.opt.actionStoredObjectId),ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,Ts.SetModalOperation(me.OptTypes.None),F.Debug("O.Opt StampTextObjectOnTapDone - Output:",{stampedShapeId:ye.opt.actionStoredObjectId,objectIdsToSelect:i})}static StampNewTextShapeOnTap(t,e,i,o,n,s,a){F.Debug("O.Opt StampNewTextShapeOnTap - Input:",{shape:t,hCenter:e,vCenter:i,operation:o,isSticky:n,completeCallback:s,completeUserData:a}),Ts.SetModalOperation(me.OptTypes.StampTextOnTap),ye.opt.stampCompleteCallback=s||null,ye.opt.stampCompleteUserData=a||null,ye.opt.stampHCenter=e,ye.opt.stampVCenter=i,ye.opt.stampSticky=n,ye.opt.drawShape=t,Qo.ClearAnySelection(!1),Ps.SetEditMode(Se.EditState.Text);ye.opt.WorkAreaHammer.on("tap",(e=>{try{this.AddNewObject(t,o,!1);const i=vs.ActiveLayerZList(),n=i.length;ye.opt.actionStoredObjectId=i[n-1],ye.opt.actionSvgObject=ye.opt.svgObjectLayer.GetElementById(ye.opt.actionStoredObjectId),this.StampTextObjectOnTapDone(e,o)}catch(i){throw Ps.CancelOperation(),ye.opt.ExceptionCleanup(i),i}})),rn.LMStampPreTrack(),F.Debug("O.Opt StampNewTextShapeOnTap - Output: Completed")}static BringToFrontOf(){F.Debug("O.Opt BringToFrontOf - Input: no parameters");const t=vs.GetFrontBackLayersForSelected();t.result&&this.BringToFrontOfSpecificLayer(t.frontmostindex),F.Debug("O.Opt BringToFrontOf - Output: completed")}static BringToFrontOfSpecificLayer(t,e){F.Debug("O.Opt BringToFrontOfSpecificLayer - Input:",{targetLayerIndex:t,updateSelectedBlock:e});const i=ye.stdObj.GetObject(ye.opt.selectObjsBlockId);let o=Oe.DeepCopy(i.Data);if(0!==o.length){const i=ye.opt.AddAssoctoList(o),n=i.length;if(0!==n){const o=vs.VisibleZList();if(o.length<1)return void F.Debug("O.Opt BringToFrontOfSpecificLayer - Output:","No visible objects found");let s=[];for(let t=0;t<n;t++){const e=i[t],n=o.indexOf(e);s.push(n)}s.sort(((t,e)=>t-e));let a=[];for(let t=0;t<n;t++){const e=o[s[t]];a.push(e)}const r=vs.ZListPreserveForLayer(t);for(let t=0;t<n;t++){const e=a[t];vs.RemoveFromAllZLists(e),r.push(e)}if(Yo.UpdateLineHops(!0),null==e){ye.stdObj.PreserveBlock(ye.opt.selectObjsBlockId).Data=i}Os.RenderAllSVGObjects(),this.CompleteOperation(),F.Debug("O.Opt BringToFrontOfSpecificLayer - Output:","Operation completed")}}}static AllowGroup(t){F.Debug("O.Opt AllowGroup - Input:",t);for(const e of t){const i=ws.GetObjectPtr(e,!1);if(i){if(i.flags&Se.ObjFlags.Lock)return F.Debug("O.Opt AllowGroup - Output: false"),!1;for(const e of i.hooks)if(t.indexOf(e.objid)<0)return F.Debug("O.Opt AllowGroup - Output: false"),!1}}return F.Debug("O.Opt AllowGroup - Output: true"),!0}static ResetObjectDraw(){F.Debug("O.Opt ResetObjectDraw - Input: No parameters"),ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,ws.GetObjectPtr(ye.opt.actionStoredObjectId,!0),Ps.SetEditMode(Se.EditState.Default),ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),Ts.SetModalOperation(me.OptTypes.None),F.Debug("O.Opt ResetObjectDraw - Output: Object draw state reset")}static PostObjectDraw(t){F.Debug("O.Opt PostObjectDraw - Input:",t);let e=[],i=ye.stdObj.GetObject(ye.opt.actionStoredObjectId);return null!=i?(null==i.Data.Frame||i.Data.Frame.width<10&&i.Data.Frame.height<10?($o.Undo(!0),ws.ClearFutureUndoStates()):(i.Data.sizedim.width=i.Data.Frame.width,i.Data.sizedim.height=i.Data.Frame.height,ye.state.ReplaceInCurrentState(ye.opt.actionStoredObjectId,i),i.Data.objecttype!==Se.FNObjectTypes.FlWall&&e.push(ye.opt.actionStoredObjectId),vs.IsTopMostVisibleLayer()||vs.MarkAllAllVisibleHigherLayerObjectsDirty(),ws.AddToDirtyList(ye.opt.actionStoredObjectId)),this.PostObjectDrawCommon(e,t),F.Debug("O.Opt PostObjectDraw - Output:",e.length),e.length):(this.PostObjectDrawCommon(null,t),F.Debug("O.Opt PostObjectDraw - Output: 0"),0)}static PostObjectDrawCommon(t,e){F.Debug("O.Opt PostObjectDrawCommon - Input:",{affectedObjects:t,event:e}),this.CompleteOperation(t),this.ResetObjectDraw(),ye.wallOpt.PostObjectDrawHook&&ye.wallOpt.PostObjectDrawHook(e),ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null,F.Debug("O.Opt PostObjectDrawCommon - Output: Operation completed")}static AddNewObject(t,e,i,o){F.Debug("O.Opt AddNewObject - Input:",{drawingObject:t,shouldStyleCopy:e,renderSelection:i,textContent:o});let n=16;if(o=o||null,null==t)throw new Error("The drawing object is null");const s=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;if(void 0===e&&(e=!0),e){t.StyleRecord=Oe.DeepCopy(s.def.style),t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&(t.StyleRecord.Line=Oe.DeepCopy(t.StyleRecord.Border),t.TMargins=Oe.DeepCopy(s.def.tmargins),t.TextFlags=ve.SetFlag(t.TextFlags,Se.TextFlags.FormCR,(s.def.textflags&Se.TextFlags.FormCR)>0));let e=s.def.just;"middle"!==s.def.vjust&&"center"!==s.def.vjust&&(e=s.def.vjust+"-"+s.def.just),t.TextAlign=e}ye.opt.forcedotted&&t.StyleRecord&&(t.StyleRecord.Line.LinePattern=ye.opt.forcedotted,ye.opt.forcedotted=null),t.UpdateFrame(t.Frame),t.sizedim.width=t.Frame.width,t.sizedim.height=t.Frame.height,t.UniqueID=ye.opt.uniqueId++,t.objecttype===Se.FNObjectTypes.FlWall&&(n=Se.LayerFlags.UseEdges),t.DataID=o?on.CreateTextBlock(t,o):-1;const a=ye.stdObj.CreateBlock(Ce.StoredObjectType.BaseDrawObject,t);if(null==a)throw new Error("AddNewObject got a null new graphics block allocation");vs.ZListPreserve(n).push(a.ID);const r=t instanceof we.Shape.BaseLine;ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);return vs.IsTopMostVisibleLayer()||r?Os.RenderLastSVGObject(i):(Os.RenderLastSVGObject(i),vs.MarkAllAllVisibleHigherLayerObjectsDirty(),Os.RenderDirtySVGObjectsNoSetMouse()),ye.opt.actionBBox=Oe.DeepCopy(t.Frame),ye.opt.dragEnclosingRect=t.GetDragR(),F.Debug("O.Opt AddNewObject - Output:",a.ID),a.ID}static DragDuplicate(t){if(F.Debug("O.Opt DragDuplicate - Input:",t),null==t)return F.Debug("O.Opt DragDuplicate - Output: false (null event)"),!1;let e=t.ctrlKey;if(t.gesture&&t.gesture.srcEvent&&(e=t.gesture.srcEvent.ctrlKey),e){const t=ws.GetObjectPtr(ye.opt.dragTargetId,!1);t&&t.datasetElemID>=0&&(e=!1)}return F.Debug("O.Opt DragDuplicate - Output:",e),e}static CheckDragIsOverCustomLibrary(t){return!1}static AutoScrollCommon(t,e,i){let o,n;F.Debug("O.Opt AutoScrollCommon - Input:",{event:t,snapEnabled:e,callback:i});let s=!1;ye.opt.OverrideSnaps(t)&&(e=!1),t.gesture?(o=t.gesture.center.clientX,n=t.gesture.center.clientY):(o=t.clientX,n=t.clientY);let a=o,r=n;const l=ye.opt.svgDoc.docInfo,h=l.dispX,c=l.dispY,p=l.dispWidth,d=l.dispHeight;if(o>=h+p-8&&(s=!0,a=h+p-8+32),o<h&&(s=!0,a=h-32),n>=c+d-8&&(s=!0,r=c+d-8+32),n<c&&(s=!0,r=c-32),s){if(e&&ye.docUtil.docConfig.enableSnap){let t={x:a,y:r};t=ye.docUtil.SnapToGrid(t),a=t.x,r=t.y}return ye.opt.autoScrollXPos=a,ye.opt.autoScrollYPos=r,-1!==ye.opt.autoScrollTimerId?(F.Debug("O.Opt AutoScrollCommon - Output: Auto scroll already scheduled"),!1):(ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout(i,0),F.Debug("O.Opt AutoScrollCommon - Output: Auto scroll timer set",{newX:a,newY:r}),!1)}return xs.ResetAutoScrollTimer(),F.Debug("O.Opt AutoScrollCommon - Output: No auto scroll needed, timer reset"),!0}static ResetAutoScrollTimer(){F.Debug("O.Opt ResetAutoScrollTimer - Input:"),-1!==ye.opt.autoScrollTimerId&&(ye.opt.autoScrollTimer.clearTimeout(ye.opt.autoScrollTimerId),ye.opt.autoScrollTimerId=-1),F.Debug("O.Opt ResetAutoScrollTimer - Output: Timer reset")}static DoAutoGrowDrag(t){F.Debug("O.Opt DoAutoGrowDrag - Input:",t),t.x<0&&(t.x=0),t.y<0&&(t.y=0);let e=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;if(ye.opt.header.flags&me.HeaderFlags.NoAuto)return t.x>e.dim.x&&(t.x=e.dim.x),t.y>e.dim.y&&(t.y=e.dim.y),F.Debug("O.Opt DoAutoGrowDrag - Output:",t),t;{let i;return t.x>e.dim.x?(ye.opt.dragGotAutoResizeOldX.push(e.dim.x),e=ye.stdObj.PreserveBlock(ye.opt.sdDataBlockId).Data,i={x:e.dim.x+ye.opt.header.Page.papersize.x-(ye.opt.header.Page.margins.left+ye.opt.header.Page.margins.right),y:e.dim.y},ye.opt.UpdateEdgeLayers([],e.dim,i),e.dim.x+=ye.opt.header.Page.papersize.x-(ye.opt.header.Page.margins.left+ye.opt.header.Page.margins.right),ye.opt.inAutoScroll=!0,Ts.ResizeSVGDocument(),ye.opt.inAutoScroll=!1,ye.opt.dragGotAutoResizeRight=!0):ye.opt.dragGotAutoResizeRight&&t.x<ye.opt.dragGotAutoResizeOldX.slice(-1).pop()&&(e=ye.stdObj.PreserveBlock(ye.opt.sdDataBlockId).Data,i={x:ye.opt.dragGotAutoResizeOldX.pop(),y:e.dim.y},ye.opt.UpdateEdgeLayers([],e.dim,i),e.dim.x=i.x,ye.opt.inAutoScroll=!0,Ts.ResizeSVGDocument(),ye.opt.inAutoScroll=!1,0===ye.opt.dragGotAutoResizeOldX.length&&(ye.opt.dragGotAutoResizeRight=!1)),t.y>e.dim.y?(ye.opt.dragGotAutoResizeOldY.push(e.dim.y),e=ye.stdObj.PreserveBlock(ye.opt.sdDataBlockId).Data,i={x:e.dim.x,y:e.dim.y+ye.opt.header.Page.papersize.y-(ye.opt.header.Page.margins.top+ye.opt.header.Page.margins.bottom)},ye.opt.UpdateEdgeLayers([],e.dim,i),e.dim.y+=ye.opt.header.Page.papersize.y-(ye.opt.header.Page.margins.top+ye.opt.header.Page.margins.bottom),ye.opt.inAutoScroll=!0,Ts.ResizeSVGDocument(),ye.opt.inAutoScroll=!1,ye.opt.dragGotAutoResizeBottom=!0):ye.opt.dragGotAutoResizeBottom&&t.y<ye.opt.dragGotAutoResizeOldY.slice(-1).pop()&&(e=ye.stdObj.PreserveBlock(ye.opt.sdDataBlockId).Data,i={x:e.dim.x,y:ye.opt.dragGotAutoResizeOldY.pop()},ye.opt.UpdateEdgeLayers([],e.dim,i),e.dim.y=i.y,ye.opt.inAutoScroll=!0,Ts.ResizeSVGDocument(),ye.opt.inAutoScroll=!1,0===ye.opt.dragGotAutoResizeOldY.length&&(ye.opt.dragGotAutoResizeBottom=!1)),F.Debug("O.Opt DoAutoGrowDrag - Output:",t),t}}static CompleteOperation(t,e,i,o){F.Debug("= u.DrawUtil: CompleteOperation - Input:",{objectIdsToSelect:t,preserveUndoState:e,fitOption:i,unusedParameter:o}),Os.HideAllSVGSelectionStates(),an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null,ye.opt.UpdateLinks(),Yo.UpdateLineHops(!0),Os.RenderDirtySVGObjects(),Ts.FitDocumentWorkArea(!1,!1,!1,i),t?Qo.SelectObjects(t,!1,!0):Os.RenderAllSVGSelectionStates(),e||ws.PreserveUndoState(!1),ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),ye.docUtil.ShowCoordinates(!0),ye.opt.lastOpDuplicate=!1,ye.opt.ScrollObjectIntoView(-1,!1),Jo&&Jo.FocusOnClipboardInput&&Jo.FocusOnClipboardInput(),this.UpdateAppStateV2Frame(),F.Debug("O.Opt CompleteOperation - Output: Operation completed.")}static AllowSnapToShapes(){F.Debug("O.Opt AllowSnapToShapes - Input: No parameters"),ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const t=ye.docUtil.docConfig.snapToShapes;return F.Debug("O.Opt AllowSnapToShapes - Output:",t),t}static GetSelectObjectCoords(){let t=Qo.GetTargetSelect();var e=ws.GetObjectPtr(t,!1);if(null==e)return null;var i=e.GetDimensionsForDisplay();return i.rotate=e.RotationAngle,i}static UpdateAppStateV2Frame(){var t=this.GetSelectObjectCoords();null!=t&&($n.UpdateCurrentObjectPos(t),fs.toolOpt.SaveAct(),F.Debug("= U.UIUtil QuasarUtil.UpdateCurrentObjectPos",!0,t,t.x,t.y,t.width,t.height))}static ClearDrawArea(){ye.opt.CloseEdit(!0),vs.ClearSVGHighlightLayer(),vs.ClearSVGOverlayLayer(),vs.ClearSVGObjectLayer(),ws.ClearDirtyList(),Qo.ClearAnySelection(!0),Ts.SetBackgroundColor(),F.Info("= u.DrawUtil: ClearDrawArea, Draw area cleared and background color set.")}}class Cs{static GetImageDir(t){var e=0;switch(t){case"image/jpeg":e=Ne.ImageDir.Jpg;break;case"image/png":e=Ne.ImageDir.Png;break;case"image/svg+xml":e=Ne.ImageDir.Svg;break;case"image/wmf":e=Ne.ImageDir.Meta}return e}}class Ps{static GetClipboardType(){F.Debug("O.Opt GetClipboardType - Input: No parameters");const t=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);let e;ye.clipboard.Get();const i=-1!==t.theActiveTextEditObjectID,o=ye.opt.bInNoteEdit;return e=i||o?ye.opt.textClipboard&&ye.opt.textClipboard.text?Ae.ClipboardType.Text:Ae.ClipboardType.None:ye.opt.header.ClipboardBuffer&&ye.opt.header.ClipboardType===Ae.ClipboardType.LM?Ae.ClipboardType.LM:Qo.GetTargetSelect()>=0&&ye.opt.textClipboard&&ye.opt.textClipboard.text?Ae.ClipboardType.Text:Ae.ClipboardType.None,F.Debug("O.Opt GetClipboardType - Output:",e),e}static PixelstoPoints(t){return Math.floor(100*t/72+.5)}static SetLinkFlag(t,e){F.Debug("O.Opt SetLinkFlag - Input:",{targetId:t,flagValue:e});const i=ws.GetObjectPtr(ye.opt.linksBlockId,!1);if(null==i)return F.Debug("O.Opt SetLinkFlag - Output: 1 (links not found)"),1;let o=this.FindLink(i,t,!0);if(o>=0){const i=ws.GetObjectPtr(ye.opt.linksBlockId,!0),n=ws.GetObjectPtr(t,!0);if(null==n)return F.Debug("O.Opt SetLinkFlag - Output: 1 (target object not found)"),1;for(n.ChangeTarget(t,null,null,null,null,!1);o<i.length&&i[o].targetid==t;)i[o].flags=ve.SetFlag(i[o].flags,e,!0),o++}return F.Debug("O.Opt SetLinkFlag - Output: 0 (success)"),0}static FindLink(t,e,i){if(F.Debug("O.Opt FindLink - Input:",{links:t,targetId:e,exactMatchOnly:i}),0===t.length){const t=i?-1:0;return F.Debug("O.Opt FindLink - Output (empty links):",t),t}for(let n=0;n<t.length;n++){if(t[n].targetid===e)return F.Debug("O.Opt FindLink - Output (exact match):",n),n;if(!i&&t[n].targetid>e)return F.Debug("O.Opt FindLink - Output (insertion point):",n),n}const o=i?-1:t.length;return F.Debug("O.Opt FindLink - Output (no match):",o),o}static SetEditMode(t,e,i,o){F.Debug("O.Opt SetEditMode - Input:",{stateMode:t,cursorType:e,shouldAddToList:i,preserveExisting:o});let n=e;if(ye.opt.editModeList&&(i||o)||(ye.opt.editModeList=[]),ye.wallOpt&&ye.wallOpt.NotifySetEditMode&&ye.wallOpt.NotifySetEditMode(t),!n)switch(t){case Se.EditState.Stamp:n=ze.CursorType.Stamp;break;case Se.EditState.Text:n=ze.CursorType.Text;break;case Se.EditState.FormatPaint:n=ze.CursorType.Paint;break;case Se.EditState.LinkConnect:n=ze.CursorType.Anchor;break;case Se.EditState.LinkJoin:n=ze.CursorType.EditClose;break;case Se.EditState.Edit:n=ze.CursorType.Edit;break;case Se.EditState.DragControl:n=ze.CursorType.NeswResize;break;case Se.EditState.DragShape:n=ze.CursorType.Move;break;case Se.EditState.Grab:n=ze.CursorType.Grab;break;default:n=ze.CursorType.Default}if(ye.opt.svgDoc.SetCursor(n),i||!ye.opt.editModeList.length?ye.opt.editModeList.push({mode:t,cursor:n}):(ye.opt.editModeList[ye.opt.editModeList.length-1].mode=t,ye.opt.editModeList[ye.opt.editModeList.length-1].cursor=n),ye.opt.curHiliteShape>=0){const t=ye.stdObj.GetObject(ye.opt.curHiliteShape);t&&t.Data.SetCursors()}F.Debug("O.Opt SetEditMode - Output:",{mode:t,cursor:n})}static CancelOperation(t){switch(F.Debug("O.Opt CancelOperation - Input: crtOpt =",ye.opt.crtOpt),ye.opt.crtOpt){case me.OptTypes.None:break;case me.OptTypes.Stamp:xs.CancelObjectStamp(!0);break;case me.OptTypes.StampTextOnTap:xs.CancelObjectStampTextOnTap(!0);break;case me.OptTypes.DragDrop:xs.CancelObjectDragDrop(!0);break;case me.OptTypes.Draw:xs.CancelObjectDraw();break;case me.OptTypes.FormatPainter:Ts.SetFormatPainter(!0,!1);break;case me.OptTypes.AddCorner:ye.wallOpt&&ye.wallOpt.AddCorner&&this.ResetHammerGesture("dragstart",ye.wallOpt.AddCorner,ye.Evt_ShapeDragStart)}F.Debug("O.Opt CancelOperation - Output: completed")}static ResetHammerGesture(t,e,i){F.Debug("O.Opt ResetHammerGesture - Input:",{eventType:t,currentHandler:e,newHandler:i});const o=vs.ActiveVisibleZList();for(let n=0;n<o.length;n++){const s=ye.opt.svgObjectLayer.GetElementByID(o[n]).svgObj.SDGObj.GetEventProxy();let a=!1;for(let t=0;t<s.eventHandlers.length;t++)if(s.eventHandlers[t].handler===e){a=!0;break}a&&s.on(t,i)}F.Debug("O.Opt ResetHammerGesture - Output: Hammer gestures reset")}static RebuildURLs(t,e){let i,o,n,s,a,r,l,h;if(F.Debug("O.Opt RebuildURLs - Input:",{stateId:t,isNextState:e}),e)for(i=ye.state.states[t+1].storedObjects.length,o=0;o<i;o++)n=ye.state.states[t+1].storedObjects[o],n.Type===Ce.StoredObjectType.BaseDrawObject&&n.stateOptTypeId===Ce.StateOperationType.CREATE&&(a=n.Data,this.IsBlobURL(a.ImageURL)&&(s=ye.stdObj.GetObject(n.ID),s&&(a=s.Data,r=a.GetBlobBytes(),l=Cs.GetImageBlobType(r.ImageDir),a.ImageURL=Cs.MakeURL(null,r.Bytes,l))));for(i=ye.state.states[t].storedObjects.length,o=0;o<i;o++)n=ye.state.states[t].storedObjects[o],n.Type===Ce.StoredObjectType.BaseDrawObject&&(n.stateOptTypeId===Ce.StateOperationType.DELETE?e||(s=ye.stdObj.GetObject(n.ID),s&&(a=s.Data,a.BlobBytesID>=0&&this.IsBlobURL(a.ImageURL)&&(r=a.GetBlobBytes(),l=Cs.GetImageBlobType(r.ImageDir),a.ImageURL=Cs.MakeURL(null,r.Bytes,l)))):(h=n.Data,s=ye.stdObj.GetObject(n.ID),this.IsBlobURL(h.ImageURL)?s?(a=s.Data,h.ImageURL!==a.ImageURL&&(this.DeleteURL(h.ImageURL),this.IsBlobURL(a.ImageURL)&&(r=a.GetBlobBytes(),r&&(l=Cs.GetImageBlobType(r.ImageDir),this.IsBlobURL(a.ImageURL)&&(a.ImageURL=Cs.MakeURL(null,r.Bytes,l)))))):this.DeleteURL(h.ImageURL):s&&(a=s.Data,this.IsBlobURL(a.ImageURL)&&(r=a.GetBlobBytes(),r&&(l=Cs.GetImageBlobType(r.ImageDir),this.IsBlobURL(a.ImageURL)&&(a.ImageURL=Cs.MakeURL(null,r.Bytes,l)))))));F.Debug("O.Opt RebuildURLs - Output: URLs rebuilt for state:",t)}static IsBlobURL(t){F.Debug("O.Opt IsBlobURL - Input:",t);const e=!!(t&&t.length>0&&"blob:"===t.substring(0,5));return F.Debug("O.Opt IsBlobURL - Output:",e),e}static ShapeToPolyLine(t,e,i,o){let n,s,a,r=!1;const l=[];let h={};if(o)n=o,r=!0,h=Oe.DeepCopy(n.Frame);else{n=ws.GetObjectPtr(t,!1),null==n.polylist?(n.polylist=n.GetPolyList(),n.StartPoint={},n.EndPoint={}):r=!0;const e=ye.stdObj.PreserveBlock(t);if(null==e)return;n=e.Data,h=Oe.DeepCopy(n.Frame)}if(r){if(!n.polylist)return null;if(ye.opt.GetClosedPolyDim(n),!ve.IsEqual(n.polylist.dim.x,h.width)){const t=ve.DeepCopy(n);t.inside=Oe.DeepCopy(n.Frame),we.Shape.PolyLine.prototype.ScaleObject.call(t,0,0,0,0,0,0),n.polylist=t.polylist}}return a=n.polylist.segs.length,n.StartPoint.x=n.Frame.x+n.polylist.segs[0].pt.x+n.polylist.offset.x,n.StartPoint.y=n.Frame.y+n.polylist.segs[0].pt.y+n.polylist.offset.y,n.EndPoint.x=n.Frame.x+n.polylist.segs[a-1].pt.x+n.polylist.offset.x,n.EndPoint.y=n.Frame.y+n.polylist.segs[a-1].pt.y+n.polylist.offset.y,s=e?new we.Shape.PolyLineContainer(n):new we.Shape.PolyLine(n),s.BlockID=n.BlockID,s.polylist.Shape_Rotation=n.RotationAngle,s.polylist.Shape_DataID=n.DataID,s.RotationAngle=0,s.DataID=-1,o||(preservedBlock.Data=s),i||(ws.AddToDirtyList(t),Os.RenderDirtySVGObjects(),l.push(t),Qo.SelectObjects(l,!1,!0)),s.inside=Oe.DeepCopy(n.Frame),s}static PutInFrontofObject(t,e){const i=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0),o=i.layers[i.activelayer].zList,n=o.indexOf(t),s=o.indexOf(e);if(!(n<0||s<0))if(s<n){for(let t=s;t<n;t++)o[t]=o[t+1],ws.AddToDirtyList(o[t]);o[n]=e,ws.AddToDirtyList(e)}else{for(let t=s;t>n+1;t--)o[t]=o[t-1],ws.AddToDirtyList(o[t]);o[n+1]=e,ws.AddToDirtyList(e)}}static InsertHops(t,e,i){let o,n,s,a,r,l,h,c,p,d,u=new De,g=new De,y=new De,S=new De,m=[];const b=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);c=b.hopdim.x,p=b.hopdim.y;for(o=t.hoplist.nhops-1;o>=0;o--)if(!t.hoplist.hops[o].cons){for(n=t.hoplist.hops[o].segment,s=o,l=o;s>0&&t.hoplist.hops[s-1].cons;)n=t.hoplist.hops[s-1].segment,l=s-1,s--;if(n>=i)return{bSuccess:!1,npts:i};if(d=this.InsertPoints(e,i,n,2),i=d.npts,d.bSuccess){if(e[n]={x:t.hoplist.hops[l].pt.x,y:t.hoplist.hops[l].pt.y},e[n+1]={x:t.hoplist.hops[o].pt.x,y:t.hoplist.hops[o].pt.y},n<n){for(a=n;a<i;a++)e[n+a-n]={x:e[a].x,y:e[a].y};i-=n-n}if(r=n+1,a=h=n+1,d=this.PolyTrimForArrow(e,0,h,c,c,u,g,!1),h=d.npts,u=d.spt,g=d.ept,h<a){for(;a<i;a++)e[h+a-a]={x:e[a].x,y:e[a].y};i-=a-h,r-=a-h}if(y={x:u.x,y:u.y},a=h=i-r,d=this.PolyTrimForArrow(e,r,h,c,c,u,g,!0),h=d.npts,u=d.spt,h<a&&(i-=a-h),S={x:(g=d.ept).x,y:g.y},d=this.BuildHop(b.hopstyle,p,y,S,h),m=d.pts,h=d.npts,d=this.InsertPoints(e,i,h,h),i=d.npts,d.bSuccess)for(a=0;a<h;a++)e[h+a]={x:m[a].x,y:m[a].y}}}return{bSuccess:!0,npts:i}}static PolyTrimForArrow(t,e,i,o,n,s,a,r){let l=new De,h={findpt:l,npts:i},c={spt:{},ept:{},pts:[],npts:0};return h=this.PolyFindLength(t,e,i,n,r,!1,l),l=h.findpt,i=h.npts,r?(c.spt={x:t[e].x,y:t[e].y},c.ept={x:l.x,y:l.y}):(c.ept={x:t[e+i-1].x,y:t[e+i-1].y},c.spt={x:l.x,y:l.y}),h=this.PolyFindLength(t,e,i,o,r,!0,l),l=h.findpt,i=h.npts,c.pts=h.pts,c.npts=i,c}static InsertPoints(t,e,i,o){if(e+o>me.Common.MaxPolyPoints)return{bSuccess:!1,npts:e};for(let n=0;n<o;++n){const e=new De;t.push(e)}for(let n=e-1;n>=i;n--)t[n+o]={x:t[n].x,y:t[n].y};e+=o;for(let n=i;n<i+o;n++)t[n]={x:n-i,y:n-i};return{bSuccess:!0,npts:e}}static GetEditMode(){F.Debug("= O.Opt GetEditMode - Input");const t=ye.opt.editModeList||[];let e=Se.EditState.Default;return t.length&&(e=t[t.length-1].mode),F.Debug("= O.Opt GetEditMode - Output:",e),e}static DeleteURL(t){const e=window.URL||window.webkitURL;e&&e.revokeObjectURL&&e.revokeObjectURL(t)}}class Ts{static ShowContextMenu(t,e,i){F.Debug("= u.UIUtil: ShowContextMenu - Input:",{isShow:t,from:e,type:i}),$n.ShowContextMenu(t,e,i)}static ShowObjectConfig(t){$n.ShowObjectConfig(t)}static ShowFrame(t){F.Debug("= U.UIUtil: ShowFrame - Input:",{isShowFrame:t});ye.docUtil.docConfig.showRulers?F.Debug("= U.UIUtil: ShowFrame - Output: Frame visibility set to",t):F.Debug("= U.UIUtil: ShowFrame - Output: Rulers are not shown")}static UpdateDisplayCoordinates(t,e,i,o){var n,s;if(ye.docUtil.docConfig.showRulers){let i=0,l=0;const h=ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units===Se.RulerUnit.Feet;if(h&&(i=l=Se.DimensionFlags.ShowFractionalInches,o&&(l=ve.SetFlag(i,Se.DimensionFlags.ShowFeetAsInches,(o.Dimensions&Se.DimensionFlags.ShowFeetAsInches)>0))),t){const e=Ve.GetLengthInRulerUnits(t.x,!1,ye.docUtil.rulerConfig.originx,i),o=Ve.GetLengthInRulerUnits(t.y,!1,ye.docUtil.rulerConfig.originy,i),n=Ve.GetLengthInRulerUnits(t.width,!1,null,l),s=Ve.GetLengthInRulerUnits(t.height,!1,null,l);F.Debug("= U.UIUtil: Formatted Values: Origin x,y,w,h",e,o,n,s),F.Debug("= U.UIUtil: Formatted Values: Dimension x,y,w,h",t.x,t.y,t.width,t.height);const c=r(a(e,h)),p=r(a(o,h)),d=r(a(n,h)),u=r(a(s,h));F.Debug("= U.UIUtil: Formatted Values: After x,y,w,h",c,p,d,u),t.x,t.y,t.width,t.height}if(e){e.x=Math.max(0,e.x),e.y=Math.max(0,e.y);const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);e.x=Math.min(null==(n=null==t?void 0:t.dim)?void 0:n.x,null==e?void 0:e.x),e.y=Math.min(null==(s=null==t?void 0:t.dim)?void 0:s.y,null==e?void 0:e.y)}}function a(t,e){let i=t,o=2;if(o=ye.docUtil.rulerConfig.dp,e)return t;if(ye.docUtil.rulerConfig.showpixels)return t.toFixed(0);if(null!=t.toFixed&&(i=t.toFixed(o)),e){const t=i.indexOf('"'),e=i.indexOf("'");if(t<0)i+="    ";else for(let o=e-t;o<4;o++)i+=" ";for(let o=e;o<4;o++)i+=" "}else{let t=i.indexOf(".");if(t<0&&(i+=".",t=i.length-1),t>=0){for(let e=o,n=i.length-t-1;e<n;e++)i+="0";for(let e=t;e<4;e++)i+=" "}}return i}function r(t){const e=t.length;let i=t.trim();for(let o=i.length;o<e;o++)i+=" ";return i}F.Debug("= U.UIUtil: UpdateDisplayCoordinates - Output: Coordinates updated in UI")}static ShowXY(t){}static GetDocDirtyState(){F.Debug("= U.UIUtil: GetDocDirtyState - Input: no parameters");const t=ye.opt.header.DocIsDirty;return F.Debug("= U.UIUtil: GetDocDirtyState - Output:",t),t}static SetDocDirtyState(t,e){F.Debug("= U.UIUtil: SetDocDirtyState - Input:",{isDirty:t,allowReplaceWhenClean:e}),ye.opt.header.DocIsDirty=t,t?ye.opt.header.AllowReplace=!1:!0===e&&(ye.opt.header.AllowReplace=!0),F.Debug("= U.UIUtil: SetDocDirtyState - Output: Document dirty state set to",t)}static SetFormatPainter(t,e){let i,o;if(F.Debug("= U.UIUtil: SetFormatPainter - Input:",{shouldDisable:t,makeSticky:e}),ye.opt.crtOpt===me.OptTypes.FormatPainter)return ye.opt.crtOpt=me.OptTypes.None,Ps.SetEditMode(Se.EditState.Default),ye.opt.formatPainterSticky=!1,void F.Debug("= U.UIUtil: SetFormatPainter - Output: Format painter disabled");if(!t){Ps.CancelOperation();if(null!=on.GetActiveTextEdit()){ye.opt.crtOpt=me.OptTypes.FormatPainter,ye.opt.formatPainterMode=Ne.FormatPainterModes.Text,ye.opt.formatPainterSticky=e;const t=ye.opt.svgDoc.GetActiveEdit();t&&(ye.opt.formatPainterText=t.GetSelectedFormat(),ye.opt.formatPainterStyle={StyleRecord:{}},ye.opt.formatPainterStyle.Text=new Ue,on.TextStyleToText(ye.opt.formatPainterStyle.Text,ye.opt.formatPainterText),Ps.SetEditMode(Se.EditState.FormatPaint))}else(i=Qo.GetTargetSelect())>=0&&(o=ws.GetObjectPtr(i,!1))&&(ye.opt.crtOpt=me.OptTypes.FormatPainter,ye.opt.formatPainterSticky=e,ye.opt.formatPainterMode=Ne.FormatPainterModes.Object,ye.opt.formatPainterStyle=Oe.DeepCopy(o.StyleRecord),ye.opt.formatPainterStyle.Border=Oe.DeepCopy(o.StyleRecord.Line),!(o.ImageURL||o.SymbolURL||o instanceof we.Shape.GroupSymbol)||o instanceof we.Shape.SvgSymbol||(delete ye.opt.formatPainterStyle.Fill,delete ye.opt.formatPainterStyle.Name,(0===o.StyleRecord.Line.Thickness||o instanceof we.Shape.GroupSymbol)&&(delete ye.opt.formatPainterStyle.Line,delete ye.opt.formatPainterStyle.Border)),ye.opt.formatPainterText=o.GetTextFormat(!1,null),null===ye.opt.formatPainterText&&(ye.opt.formatPainterText=on.CalcDefaultInitialTextStyle(ye.opt.formatPainterStyle.Text)),ye.opt.formatPainterParaFormat=o.GetTextParaFormat(!1),ye.opt.formatPainterArrows=o.GetArrowheadFormat(),Ps.SetEditMode(Se.EditState.FormatPaint))}F.Debug("= U.UIUtil: SetFormatPainter - Output:",{mode:ye.opt.formatPainterMode,isSticky:ye.opt.formatPainterSticky,crtOpt:ye.opt.crtOpt})}static InitSvgDocument(t=!1){const e=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;F.Debug("InitSvgDoc dim from T3Gv.stdObj without load storage data",ye.opt.sdDataBlockId,ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data);const i=_o.GetSDDataDimensions(),o=null==i||0===i.x&&0===i.y;F.Debug("InitSvgDoc dim from storage data",i);const n=this.GetScreenDimensions();e.dim.x=o?n.width:i.x,e.dim.y=o?n.height:i.y,F.Debug("InitSvgDoc set the block data with previous dim",ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data);var s=e.dim.x,a=e.dim.y;const r={svgAreaId:ye.opt.svgDocId,documentWidth:s,documentHeight:a,documentDPI:100};ye.docUtil.InitializeWorkArea(r,t)}static InitT3GvOpt(){ye.opt.svgDoc=ye.docUtil.DocObject(),ye.opt.svgObjectLayer=ye.opt.svgDoc.AddLayer("svg-object-layer"),ye.opt.svgDoc.SetDocumentLayer("svg-object-layer"),ye.opt.svgOverlayLayer=ye.opt.svgDoc.AddLayer("svg-overlay-layer"),ye.opt.svgOverlayLayer.ExcludeFromExport(!0),ye.opt.svgHighlightLayer=ye.opt.svgDoc.AddLayer("svg-highlight-layer"),ye.opt.svgHighlightLayer.ExcludeFromExport(!0),ye.opt.svgCollabLayer=ye.opt.svgDoc.AddLayer("svg-collab-layer"),ye.opt.svgCollabLayer.ExcludeFromExport(!0),ye.opt.svgCollabLayer.AllowScaling(!1),ye.opt.mainAppElement=document.getElementById("main-app"),ye.opt.workAreaElement=document.getElementById("svg-area"),ye.opt.documentElement=document.getElementById("document-area"),ye.opt.WorkAreaHammer=new Hammer(ye.opt.workAreaElement),ye.opt.documentElementHammer=new Hammer(ye.opt.documentElement),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),ye.opt.WorkAreaHammer.on("wheel",Ls.Evt_WorkAreaMouseWheel),ye.opt.documentElementHammer.on("wheel",Ls.Evt_WorkAreaMouseWheel),ye.opt.WorkAreaHammer.on("dragstart",Ls.Evt_WorkAreaHammerDragStart)}static SetModalOperation(t){F.Debug("= U.UIUtil: SetModalOperation - Input:",{operation:t}),t!==me.OptTypes.None&&ye.opt.crtOpt!==me.OptTypes.None&&ye.opt.crtOpt!==t&&Ps.CancelOperation(),ye.opt.crtOpt=t,F.Debug("= U.UIUtil: SetModalOperation - Output:",{crtOpt:t})}static ResizeSVGDocument(){F.Debug("= U.UIUtil: ResizeSVGDocument - Input: No parameters");const t=ye.stdObj.GetObject(ye.opt.sdDataBlockId).Data;ye.docUtil.ResizeDocument(t.dim.x,t.dim.y),F.Debug("= U.UIUtil: ResizeSVGDocument - Output: Document resized to",t.dim)}static SetBackgroundColor(){F.Debug("= U.UIUtil: SetBackgroundColor - Input:",{});const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),e=ye.docUtil.GetBackground();if(t&&e){const i=t.background.Paint;if(i.FillType===Se.FillTypes.Solid)i.Color===Se.Colors.White||0===i.Opacity?e.SetFillColor("none"):e.SetFillColor(i.Color);else if(i.FillType===Se.FillTypes.Gradient){const t=new we.Shape.BaseShape;e.SetGradientFill(t.CreateGradientRecord(i.GradientFlags,i.Color,i.Opacity,i.EndColor,i.EndOpacity))}else if(i.FillType===Se.FillTypes.RichGradient){const t=new we.Shape.BaseShape;e.SetGradientFill(t.CreateRichGradientRecord(i.GradientFlags))}else i.FillType===Se.FillTypes.Texture?(i.TextureScale.AlignmentScalar,i.Texture):e.SetFillColor("none");e.ExcludeFromExport(this.GetBackgroundTransparent())}const i=vs.VisibleZList();for(let o=0,n=i.length;o<n;o++){const t=i[o],e=ws.GetObjectPtr(t,!1);e&&e.DataID>=0&&ws.AddToDirtyList(t)}F.Debug("= U.UIUtil: SetBackgroundColor - Output:",{})}static GetBackgroundTransparent(){F.Debug("= U.UIUtil: GetBackgroundTransparent - Input: no parameters");const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),e=ye.docUtil.GetBackground();let i=!0;if(t&&e){const e=t.background.Paint;switch(e.FillType){case Se.FillTypes.Solid:i=e.Color===Se.Colors.White||0===e.Opacity;break;case Se.FillTypes.Gradient:case Se.FillTypes.RichGradient:case Se.FillTypes.Texture:i=!1;break;default:i=!0}}return F.Debug("= U.UIUtil: GetBackgroundTransparent - Output:",i),i}static SetDocumentScale(t,e){F.Debug("= u.UIUtil: SetDocumentScale/ input",{scaleFactor:t,skipCentering:e}),ye.opt.svgDoc&&ye.docUtil.SetZoomFactor(t,e)}static UpdateDocumentScale(){if(F.Debug("= U.UIUtil: UpdateDocumentScale: input"),ye.opt.svgDoc){ye.opt.svgDoc.GetActiveEdit()||(Os.HideAllSVGSelectionStates(),Os.RenderAllSVGSelectionStates())}}static IsPlanningDocument(){return!1}static GetUIAdaptation(t){F.Debug("= U.UIUtil: GetUIAdaptation - Input:",t);let e=!1;return t.gesture?"onpointerdown"in window?t.gesture.srcEvent instanceof PointerEvent&&"touch"==t.gesture.srcEvent.pointerType&&(e=!0):"ontouchstart"in window&&-1!=t.gesture.srcEvent.type.indexOf("touch")?e=!0:"mousedown"==t.gesture.srcEvent.type&&(e=!1):"onpointerdown"in window?t instanceof PointerEvent&&"touch"==t.pointerType&&(e=!0):"ontouchstart"in window&&-1!=t.type.indexOf("touch")?e=!0:"mousedown"==t.type&&(e=!1),F.Debug("= U.UIUtil: GetUIAdaptation - Output:",e),e}static FitDocumentWorkArea(t,e,i,o){let n,s,a,r,l;F.Debug("= U.UIUtil: FitDocumentWorkArea - Input:",{preserveState:t,forceFlag:e,allowOverride:i,fitOptions:o});let h=!1,c=!1,p=!1,d=!1;if(!ye.opt)return;const u=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);for(u.layers[u.activelayer].flags&Se.LayerFlags.UseEdges&&(h=!0,r=u.layers[u.activelayer].flags&Se.LayerFlags.Visible),a=u.nlayers,s=0;s<a;s++)if(u.layers[s].flags&Se.LayerFlags.UseEdges&&u.layers[s].flags&Se.LayerFlags.Visible||h){c=!0;break}let g,y;n=ye.opt.CalcAllObjectEnclosingRect(c&&!h,o);let S=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),m=ye.opt.header.Page.papersize,b=ye.opt.header.Page.margins,D=m.x-(b.left+b.right),f=m.y-(b.top+b.bottom),x={x:0,y:0};if(n.x<0&&(n.x=0),n.y<0&&(n.y=0),g=Math.floor(n.x+n.width),y=Math.floor(n.y+n.height),c&&!h&&(y<ye.opt.header.Page.minsize.y&&(y=ye.opt.header.Page.minsize.y,p=!0),g<ye.opt.header.Page.minsize.x&&(g=ye.opt.header.Page.minsize.x,d=!0)),ye.opt.header.flags&me.HeaderFlags.Pages&&!h){let t,i,o=Math.ceil(g/D),n=Math.ceil(y/f);if(o<1&&(o=1),n<1&&(n=1),c?(t=Math.ceil(S.dim.x/D),i=Math.ceil(S.dim.y/f)):(t=Math.round(S.dim.x/D),i=Math.round(S.dim.y/f)),t<1&&(t=1),i<1&&(i=1),g<=S.dim.x&&y<=S.dim.y&&!e&&o>=t&&n>=i&&1===t&&1===i)return void F.Debug("= U.UIUtil: FitDocumentWorkArea - Output: No resize needed");x={x:o*D,y:n*f},d&&(x.x=g),p&&(x.y=y),ye.opt.header.flags&me.HeaderFlags.NoAuto&&(x.x<S.dim.x&&(x.x=S.dim.x),x.y<S.dim.y&&(x.y=S.dim.y))}else h&&(n.width+=12,n.height+=12),x.x=n.x+n.width,x.y=n.y+n.height,!h||ve.IsEqual(x.x,S.dim.x,2)&&ve.IsEqual(x.y,S.dim.y,2)||(r?(x.x<D&&(x.x=D),x.y<f&&(x.y=f),ye.opt.header.flags&me.HeaderFlags.NoAuto||(ye.opt.header.Page.minsize.y=x.y,ye.opt.header.Page.minsize.x=x.x)):(ye.opt.header.Page.minsize.x=D,ye.opt.header.Page.minsize.y=f)),x.x<ye.opt.header.Page.minsize.x&&(x.x=ye.opt.header.Page.minsize.x),x.y<ye.opt.header.Page.minsize.y&&(x.y=ye.opt.header.Page.minsize.y);l=ve.IsEqual(x.x,S.dim.x)&&ve.IsEqual(x.y,S.dim.y);const C=x.x>S.dim.x||x.y>S.dim.y;if(l)ye.docUtil.CheckScaleToFit()&&this.ResizeSVGDocument();else{if(ye.opt.header.flags&me.HeaderFlags.NoAuto&&!i&&(!C||function(t,e,i){const o=t.x%e;return ve.IsEqual(o,0)}(S.dim,D))){if(C){const t=new Error("bounds error");throw t.name="1",t}return void F.Debug("= U.UIUtil: FitDocumentWorkArea - Output: No resize needed (NoAuto constraint)")}let e=!0;t&&(e=!1),S=ws.GetObjectPtr(ye.opt.sdDataBlockId,e),ye.opt.UpdateEdgeLayers([],S.dim,x),S.dim.x=x.x,S.dim.y=x.y,this.ResizeSVGDocument()}F.Debug("= U.UIUtil: FitDocumentWorkArea - Output:",{newSize:x,documentSizeChanged:l,isGrowing:C})}static ChangeBackgroundTextColor(t,e){if(t!==e){const i=vs.ZList(),o=i.length;for(let n=0;n<o;n++){const o=ws.GetObjectPtr(i[n],!1);o&&o.ChangeBackgroundColor(t,e)}}}static GetScreenDimensions(){const t={width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};return F.Debug("= U.UIUtil: GetScreenDimensions - Output:",t),t}}class Os{static RenderAllSVGSelectionStates(){F.Debug("= U.SvgUtil: RenderAllSVGSelectionStates - Input: No parameters");const t=vs.ActiveVisibleZList(),e=t.length,i=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,o=Qo.GetTargetSelect(),n=[me.SVGElementClass.DimLine,me.SVGElementClass.DimText,me.SVGElementClass.AreaDimLine,me.SVGElementClass.DimTextNoEdit],s=function(t){return function(e){return t.LMActionClick(e),!1}};for(let r=0;r<e;++r){const e=t[r],l=i.indexOf(e);if(l<0)continue;const h=ws.GetObjectPtr(e,!1);if(null===h||h.flags&Se.ObjFlags.NotVisible)continue;const c=ye.opt.svgObjectLayer.GetElementById(e);if(null===c||null===c.GetElementById(me.SVGElementClass.Shape))continue;const p=me.Common.Action+e;let d=ye.opt.svgOverlayLayer.GetElementById(p);if(null===d&&null!==(d=h.CreateActionTriggers(ye.opt.svgDoc,e,c,o))){ye.opt.svgOverlayLayer.AddElement(d);try{d.SetRotation(h.RotationAngle)}catch(a){throw a}const t=0==(h.flags&Se.ObjFlags.Lock),e=!ye.docUtil.IsReadOnly(),i=!h.NoGrow();if(t&&e&&i){const t=d.DOMElement(),e=new Hammer(t);e.on("tap",Ls.Evt_ActionTriggerTap),e.on("dragstart",s(h)),d.SetEventProxy(e)}}if(h.Dimensions&Se.DimensionFlags.Select)for(let t=c.ElementCount()-1;t>=1;t--){const e=c.GetElementByIndex(t),i=e.GetID();n.indexOf(i)>=0&&e.SetOpacity(l>=0?1:0)}}F.Debug("= U.SvgUtil: RenderAllSVGSelectionStates - Output: Selection states rendered")}static HideAllSVGSelectionStates(){F.Debug("= U.SvgUtil: HideAllSVGSelectionStates: input");const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);ye.opt.SetDimensionVisibility(t,!1),ye.opt.fromOverlayLayer||ye.opt.svgOverlayLayer.RemoveAll(),yn.ClearAllActionArrowTimers(),vs.ShowOverlayLayer(),F.Debug("= U.SvgUtil: HideAllSVGSelectionStates: output")}static RenderDirtySVGObjects(){this.RenderDirtySVGObjectsCommon(!0)}static RenderDirtySVGObjectsCommon(t){if(F.Debug("= U.SvgUtil: RenderDirtySVGObjectsCommon - Input:",{renderSelectionStates:t}),0!==ye.opt.dirtyList.length){const e=vs.VisibleZList(),i=vs.ActiveVisibleZList(),o=function(t){const e=[],i=Se.ObjFlags.NotVisible;for(let o=0;o<t.length;o++){const n=ws.GetObjectPtr(t[o],!1);n&&0==(n.flags&i)&&e.push(t[o])}return e}(e);ye.opt.dirtyList.sort(((t,i)=>e.indexOf(t)<e.indexOf(i)?-1:1));const n=ye.opt.dirtyList.length;for(let s=0;s<n;s++){let n=!1;const a=ye.opt.dirtyList[s],r=ye.opt.dirtyListMoveOnly[a];let l=o.indexOf(a);if(l<0&&(l=e.indexOf(a)),l>=0)if(t&&(n=-1!==i.indexOf(a)),r){const t=ws.GetObjectPtr(a,!1);t&&t.MoveSVG()}else this.AddSVGObject(l,a,!0,n)}if(ye.opt.dirtyListReOrder){const t=o.length;for(let e=0;e<t;e++){const t=o[e],i=ye.opt.svgObjectLayer.GetElementById(t.toString());i&&(ye.opt.svgObjectLayer.RemoveElement(i),ye.opt.svgObjectLayer.AddElement(i,e))}}ws.ClearDirtyList()}F.Debug("= U.SvgUtil: RenderDirtySVGObjectsCommon - Output: Completed rendering dirty SVG objects")}static AddSVGObject(t,e,i,o){F.Info("= U.SvgUtil: AddSVGObject - Input:",{containerElement:t,objectId:e,removeExisting:i,renderCallback:o});let n=ye.opt.svgDoc,s=ye.stdObj.GetObject(e);if(F.Info("= u.SvgUtil: AddSVGObject / stdObj's object: objectId,stdObj,drawingObj",e,ye.stdObj,s),!s)return void F.Info("= U.SvgUtil: AddSVGObject - Output: No drawing object found.");let a,r=s.Data;r.tag=e;let l=r.CreateShape(n,o);if(l){l.SetID(e),i?(a=ye.opt.svgObjectLayer.GetElementById(e),l&&ye.opt.svgObjectLayer.AddElement(l,t),a&&ye.opt.svgObjectLayer.RemoveElement(a)):l&&ye.opt.svgObjectLayer.AddElement(l),l&&r.PostCreateShapeCallback(n,l,o);try{l.SetRotation(r.RotationAngle,r.Frame.x+r.Frame.width/2,r.Frame.y+r.Frame.height/2)}catch(h){throw F.Info("= U.SvgUtil: AddSVGObject - SetRotation error:",h),h}if(null!==l)if(o){let t=l.DOMElement(),e=new Hammer(t),i=Ls.Evt_ShapeTapFactory(r);e.on("tap",i),ye.docUtil.IsReadOnly()||(ye.Evt_ShapeDragStart=Ls.Evt_ShapeDragStartFactory(r),e.on("dragstart",ye.Evt_ShapeDragStart),(r.AllowTextEdit()||r.AllowDoubleClick())&&(ye.Evt_LMShapeDoubleTap=Ls.Evt_ShapeDoubleTapFactory(r),e.on("doubletap",ye.Evt_LMShapeDoubleTap)),l.SetEventProxy(e)),ye.docUtil.IsReadOnly()||l.svgObj.mouseover((function(t){let e=this.SDGObj.GetID(),i=ws.GetObjectPtr(e,!1);i&&i.SetRolloverActions(n,l,t)})),r.RegisterForDataDrop(l)}else l.SetEventBehavior(me.EventBehavior.None)}F.Info("= U.SvgUtil: AddSVGObject - Output: Completed adding SVG object for objectId",e)}static RenderAllSVGObjects(){F.Debug("= U.SvgUtil: RenderAllSVGObjects - Input: no parameters");const t=vs.VisibleZList(),e=vs.ActiveVisibleZList(),i=t.length;vs.ClearSVGHighlightLayer(),vs.ClearSVGOverlayLayer(),vs.ClearSVGObjectLayer(),Ts.SetBackgroundColor();for(let o=0;o<i;++o){const i=t[o],n=-1!==e.indexOf(i);Os.AddSVGObject(o,i,!1,n)}Os.RenderAllSVGSelectionStates(),ws.ClearDirtyList(),F.Debug("= U.SvgUtil: RenderAllSVGObjects - Output: rendering complete")}static GetSVGDragElement(t){if(F.Debug("= U.SvgUtil: GetSVGDragElement - Input:",t),!ye.opt.dragElementList||t<0||t>=ye.opt.dragElementList.length)return F.Debug("= U.SvgUtil: GetSVGDragElement - Output: null (invalid index)"),null;const e=ye.opt.svgObjectLayer.GetElementById(ye.opt.dragElementList[t]);return F.Debug("= U.SvgUtil: GetSVGDragElement - Output:",e?"Element found":"null"),e}static ShowSVGSelectionState(t,e){F.Debug("= U.SvgUtil: ShowSVGSelectionState - Input:",{objectId:t,isSelected:e});const i=me.Common.Action+t,o=Qo.GetTargetSelect();let n=ye.opt.svgOverlayLayer.GetElementById(i);const s=ye.opt.svgObjectLayer.GetElementById(t.toString()),a=ws.GetObjectPtr(t,!1);if(null!==a){if(null===n&&e){if(n=a.CreateActionTriggers(ye.opt.svgDoc,t,s,o),null!==n){ye.opt.svgOverlayLayer.AddElement(n);try{n.SetRotation(a.RotationAngle)}catch(l){throw l}if(!a.NoGrow()){const t=n.DOMElement(),e=Hammer(t);e.on("tap",Ls.Evt_ActionTriggerTap),e.on("dragstart",(r=a,t=>(r.LMActionClick(t),!1))),n.SetEventProxy(e)}}}else null===n||e||ye.opt.svgOverlayLayer.RemoveElement(n);if(a.Dimensions&Se.DimensionFlags.Select)for(let t=s.ElementCount()-1;t>=1;t--){const i=s.GetElementByIndex(t);i.GetID()!==me.SVGElementClass.DimLine&&i.GetID()!==me.SVGElementClass.DimText||i.SetOpacity(e?1:0)}}var r;F.Debug("= U.SvgUtil: ShowSVGSelectionState - Output:",{objectId:t,isSelected:e})}static ClearOverlayElementsByID(t,e){F.Debug("= U.SvgUtil: ClearOverlayElementsByID - Input:",{elementID:t,resetHighlight:e});const i=ye.opt.svgOverlayLayer.GetElementListWithId(t),o=i.length;for(let n=0;n<o;++n)ye.opt.svgOverlayLayer.RemoveElement(i[n]);if(e&&-1!==ye.opt.curHiliteShape){const t=ws.GetObjectPtr(ye.opt.curHiliteShape,!1);t&&(t.SetRuntimeEffects(!1),t.ClearCursors())}F.Debug("= U.SvgUtil: ClearOverlayElementsByID - Output: Completed")}static RenderLastSVGObject(t){F.Debug("= U.SvgUtil: RenderLastSVGObject shouldRenderSelectionStates",t),ye.opt.fromOverlayLayer;const e=vs.ActiveLayerZList(),i=e[e.length-1];Os.AddSVGObject(void 0,i,!1,t),t&&Os.RenderAllSVGSelectionStates()}static RenderDirtySVGObjectsNoSetMouse(){this.RenderDirtySVGObjectsCommon(!1)}}class vs{static ActiveVisibleZList(){F.Debug("U.LayerUtil ActiveVisibleZList: input");const t=ye.opt.layersManagerBlockId,e=ws.GetObjectPtr(t,!1),i=e.layers,o=e.nlayers,n=e.activelayer;let s=[];for(let a=o-1;a>=0;a--){const t=i[a];(a===n||t.flags&Se.LayerFlags.Visible&&t.flags&Se.LayerFlags.Active)&&(s=s.concat(t.zList))}return F.Debug("U.LayerUtil ActiveVisibleZList: output",s),s}static ShowOverlayLayer(){F.Debug("O.Opt ShowOverlayLayer: input"),ye.opt.svgOverlayLayer.SetVisible(!0),F.Debug("O.Opt ShowOverlayLayer: output")}static VisibleZList(){const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),e=t.layers,i=t.nlayers,o=t.activelayer;let n=[];for(let s=i-1;s>=0;s--){const t=e[s];(s===o||t.flags&Se.LayerFlags.Visible)&&(n=n.concat(t.zList))}return F.Debug("= U.LayerUtil VisibleZList: output | visibleZList",n),n}static RemoveFromAllZLists(t){F.Debug("O.Opt RemoveFromAllZLists - Input:",t);const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0),i=e.nlayers;for(let o=0;o<i;++o){const i=e.layers[o].zList,n=i.indexOf(t);if(-1!=n)return i.splice(n,1),void F.Debug("O.Opt RemoveFromAllZLists - Output: Removed object from layer",o)}F.Debug("O.Opt RemoveFromAllZLists - Output: Object not found in any layer")}static ClearSVGHighlightLayer(){F.Debug("O.Opt ClearSVGHighlightLayer - Input: none"),null!==ye.opt.svgOverlayLayer?(ye.opt.svgHighlightLayer.RemoveAll(),F.Debug("O.Opt ClearSVGHighlightLayer - Output: SVG highlight layer cleared")):F.Debug("O.Opt ClearSVGHighlightLayer - Output: svgOverlayLayer is null, no action taken")}static ClearSVGOverlayLayer(){F.Debug("O.Opt ClearSVGOverlayLayer - Input: none"),null!==ye.opt.svgOverlayLayer?(ye.opt.svgOverlayLayer.RemoveAll(),F.Debug("O.Opt ClearSVGOverlayLayer - Output: SVG overlay layer cleared")):F.Debug("O.Opt ClearSVGOverlayLayer - Output: svgOverlayLayer is null, no action taken")}static ClearSVGObjectLayer(){F.Debug("O.Opt ClearSVGObjectLayer - Input: none"),null!==ye.opt.svgObjectLayer?(ye.opt.svgObjectLayer.RemoveAll(),F.Debug("O.Opt ClearSVGObjectLayer - Output: SVG object layer cleared")):F.Debug("O.Opt ClearSVGObjectLayer - Output: svgObjectLayer is null, no action taken")}static UpdateObjectLayerIndices(t){F.Debug("O.Opt UpdateObjectLayerIndices - Input:",t);const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),i=e.layers,o=e.nlayers;for(let n=0;n<o;n++){const e=i[n].zList;for(let i=0,o=e.length;i<o;i++){const o=ws.GetObjectPtr(e[i],!1);o&&(o.Layer=n,o.GetTextures(t.TextureList))}}F.Debug("O.Opt UpdateObjectLayerIndices - Output: Completed")}static InsertObjectsIntoLayerAt(t,e){F.Debug("O.Opt InsertObjectsIntoLayerAt - Input:",{objectId:t,insertList:e});const i=this.FindLayerForShapeID(t);if(i>=0){const o=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0).layers;let n=o[i].zList;const s=n.indexOf(t),a=n.slice(s+1);n.splice(s+1,n.length-s-1),o[i].zList=n.concat(e,a)}F.Debug("O.Opt InsertObjectsIntoLayerAt - Output:",{objectId:t,insertList:e})}static ZListPreserveForLayer(t){F.Debug("O.Opt ZListPreserveForLayer - Input:",{layerIndex:t});const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0).layers[t].zList;return F.Debug("O.Opt ZListPreserveForLayer - Output:",e),e}static FindLayerForShapeID(t){F.Debug("O.Opt FindLayerForShapeID - Input:",{shapeId:t});const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),i=e.layers,o=e.nlayers;for(let n=0;n<o;n++){if(-1!==i[n].zList.indexOf(t))return F.Debug("O.Opt FindLayerForShapeID - Output:",{result:n}),n}return F.Debug("O.Opt FindLayerForShapeID - Output:",{result:-1}),-1}static GetFrontBackLayersForSelected(){F.Debug("O.Opt GetFrontBackLayersForSelected - Input:",{});const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),e=t.layers,i=t.nlayers;let o=-1,n=0;const s=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1),a=s.length;if(0===a){const t={result:!1,frontmostname:e[0].name,frontmostindex:0,backmostname:e[i-1].name,backmostindex:i};return F.Debug("O.Opt GetFrontBackLayersForSelected - Output:",t),t}for(let l=0;l<a;l++){const t=this.FindLayerForShapeID(s[l]);(t<o||-1===o)&&(o=t),t>n&&(n=t)}const r={result:!0,frontmostname:e[o].name,frontmostindex:o,backmostname:e[n].name,backmostindex:n};return F.Debug("O.Opt GetFrontBackLayersForSelected - Output:",r),r}static FrontMostLayerZListPreserve(){F.Debug("O.Opt FrontMostLayerZListPreserve - Input: No parameters");const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0).layers[0].zList;return F.Debug("O.Opt FrontMostLayerZListPreserve - Output: Retrieved front-most layer Z-list with",t.length,"objects"),t}static HideOverlayLayer(){F.Debug("O.Opt HideOverlayLayer - Input: No parameters"),ye.opt.svgOverlayLayer.SetVisible(!1),F.Debug("O.Opt HideOverlayLayer - Output: Overlay layer hidden")}static IsTopMostVisibleLayer(){F.Debug("O.Opt isTopMostVisibleLayer - Input");const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1).activelayer===this.GetTopMostVisibleLayer();return F.Debug("O.Opt isTopMostVisibleLayer - Output:",t),t}static GetTopMostVisibleLayer(){F.Debug("O.Opt getTopMostVisibleLayer - Input");const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),e=t.layers,i=t.nlayers;for(let o=0;o<i;++o)if(e[o].flags&Se.LayerFlags.Visible)return F.Debug("O.Opt getTopMostVisibleLayer - Output:",o),o;return F.Debug("O.Opt getTopMostVisibleLayer - Output:",-1),-1}static ActiveLayerZList(){F.Debug("O.Opt ActiveLayerZList - Input");const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),e=t.layers[t.activelayer].zList;return F.Debug("O.Opt ActiveLayerZList - Output:",e),e}static ZListPreserve(t){F.Debug("O.Opt zListPreserve - Input:",t);const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0),i=e.layers,o=e.activelayer;let n=i[o];if(n.flags&Se.LayerFlags.NoAdd||n.flags&t){const t=i.length;for(let e=0;e<t;e++)if(0==(i[e].flags&Se.LayerFlags.NoAdd)){this.MakeLayerActiveByIndex(e),this.DirtyObjectsOnLayer(o,n),this.DirtyObjectsOnLayer(e,i[e]),Os.RenderDirtySVGObjects(),n=i[e];break}}return F.Debug("O.Opt zListPreserve - Output:",n.zList),n.zList}static DirtyObjectsOnLayer(t,e){var i;const o=e.zList,n=null!=(i=null==o?void 0:o.length)?i:0;for(let s=0;s<n;++s)ws.AddToDirtyList(o[s])}static MarkAllAllVisibleHigherLayerObjectsDirty(){let t,e;const i=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);for(t=i.activelayer-1;t>=0;t--)if(i.layers[t].flags&Se.LayerFlags.Visible)for(e=0;e<i.layers[t].zList.length;e++)ws.AddToDirtyList(i.layers[t].zList[e])}static ZList(){F.Debug("O.Opt ZList - Input: No parameters");const t=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1);let e=[];for(let i=t.nlayers-1;i>=0;i--)e=e.concat(t.layers[i].zList);return F.Debug("O.Opt ZList - Output: Retrieved",e.length,"objects"),e}static MakeLayerActiveByIndex(t){F.Debug("O.Opt MakeLayerActiveByIndex - Input:",{layerIndex:t}),ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),ye.opt.CloseEdit();if(ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).moreflags&Se.SessionMoreFlags.HideLayerTabs){const t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0);t.moreflags=ve.SetFlag(t.moreflags,Se.SessionMoreFlags.HideLayerTabs,!1)}const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),i=e.nlayers,o=e.layers;if(o[e.activelayer].layertype,t>=0&&t<i){ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0).activelayer=t,o[t].layerType,this.AdjustSelectedListAfterLayerChange()}F.Debug("O.Opt MakeLayerActiveByIndex - Output: Layer activated")}static AdjustSelectedListAfterLayerChange(){F.Debug("O.Opt AdjustSelectedListAfterLayerChange - Input");const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!0),e=Qo.GetTargetSelect(),i=t.length,o=[];ye.opt.CloseEdit();const n=this.ActiveVisibleZList();for(let a=0;a<i;++a){const e=t[a];-1!==n.indexOf(e)&&o.push(e)}-1===n.indexOf(e)&&Qo.SetTargetSelect(-1);const s=o.length;if(i!==s){t.length=0;for(let e=0;e<s;++e)t.push(o[e])}F.Debug("O.Opt AdjustSelectedListAfterLayerChange - Output: Selection adjusted")}static AddNewLayerAtFront(t,e,i){const o=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0);if(o.nlayers>=me.Common.MaxTotalLayers)return!1;const n=new we.Basic.Layer;return n.name=t,n.flags=0,e&&(n.flags|=Se.LayerFlags.Visible),i&&(n.flags|=Se.LayerFlags.Active),o.layers.unshift(n),o.nlayers++,!0}static RotateLayerStack(t){ye.opt.CloseEdit();const e=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!0).layers,i=e.shift();e.push(i),this.AdjustSelectedListAfterLayerChange(),Os.RenderAllSVGObjects(),t||xs.CompleteOperation()}}var ws=class{static GetObjectPtr(t,e){const i=ye.stdObj.GetObject(t);if(null==i||t<0)return null;return e?ye.stdObj.PreserveBlock(t).Data:i.Data}static AddToDirtyList(t,e){F.Debug("O.Opt AddToDirtyList - Input:",{objectId:t,isMoveOnly:e}),ye.opt.dirtyList.indexOf(t)<0?(ye.opt.dirtyList.push(t),ye.opt.dirtyListMoveOnly[t]=!!e):e||(ye.opt.dirtyListMoveOnly[t]=!1),F.Debug("O.Opt AddToDirtyList - Output: Dirty list updated")}static DeleteObjects(t,e){let i,o,n,s,a,r,l,h,c,p;if(F.Debug("O.Opt DeleteObjects - Input:",{objectIds:t,forceDelete:e}),this.GetObjectPtr(ye.opt.layersManagerBlockId,!1),null!=t)for(o=t.length?t.length:0,i=o-1;i>=0;i--){n=t[i];const o=ye.stdObj.GetObject(n);if(o){if(l=o.Data,l.extraflags&me.ExtraFlags.NoDelete&&!e)continue;vs.RemoveFromAllZLists(n),Qo.RemoveFromSelectedList(n),Ps.SetLinkFlag(n,Ee.LinkFlags.DeleteTarget),h=l.hooks.length;for(let t=0;t<h;t++)c=l.hooks[t].objid,c>0&&(p=this.GetObjectPtr(c,!0),p&&p.ChangeTarget(c,n,l.hooks[t].cellid,l.hooks[t].updhook,l.hooks[t].connect,!1));l.DeleteObject(),o.Delete()}s=ye.opt.svgObjectLayer.GetElementById(n),s&&ye.opt.svgObjectLayer.RemoveElement(s),a=me.Common.Action+n,r=ye.opt.svgOverlayLayer.GetElementById(a),null!=r&&ye.opt.svgOverlayLayer.RemoveElement(r)}F.Debug("O.Opt DeleteObjects - Output: Objects deleted:",o)}static PreserveUndoState(t){if(F.Debug("O.Opt PreserveUndoState - Input:",{shouldKeepStateOpen:t}),!ye.opt.noUndo){if(null===ye.state)throw new Error("state is null");if(ye.state.currentStateId>=0){const e=Oe.IsStateOpen();ye.state.PreserveState(),e&&ye.state.AddToHistoryState(),!t&&e&&Ts.SetDocDirtyState(!0)}}F.Debug("O.Opt PreserveUndoState - Output: State preserved")}static ClearDirtyList(){F.Debug("O.Opt ClearDirtyList - Input: No parameters"),ye.opt.dirtyList=[],ye.opt.dirtyListMoveOnly=[],ye.opt.dirtyListReOrder=!1,F.Debug("O.Opt ClearDirtyList - Output: Dirty list cleared")}static ClearFutureUndoStates(){ye.state.ClearFutureUndoStates()}static ClearT3GvState(){_o.InitStateAndStore()}static ClearUndoRedo(){ye.state.ResetUndoStates()}};const ks=class{static initialize(){if(this.isInitialized)F.Warn("EvtUtil already initialized");else try{this.cleanup(),this.setupEventHandlers(),this.isInitialized=!0,F.Info("EvtUtil initialized successfully")}catch(t){F.Error("Failed to initialize EvtUtil:",t)}}static cleanup(){try{this.eventHandlers.forEach(((t,e)=>{document.removeEventListener(e,t)})),this.eventHandlers.clear(),Rt(document).off(".t3000-evt"),Rt("#svg-area").off(".t3000-evt"),this.hammerInstances.forEach(((t,e)=>{t&&"function"==typeof t.destroy&&t.destroy()})),this.hammerInstances.clear(),this.isInitialized=!1,F.Info("EvtUtil cleanup completed")}catch(t){F.Error("Error during EvtUtil cleanup:",t)}}static setupEventHandlers(){const t=this.Evt_MouseMove.bind(this),e=this.Evt_WorkAreaMouseWheel.bind(this);this.eventHandlers.set("mousemove",t),this.eventHandlers.set("wheel",e),document.addEventListener("mousemove",t),document.addEventListener("wheel",e,{passive:!1}),this.setupHammerHandlers()}static setupHammerHandlers(){if(document.getElementById("svg-area"))try{F.Info("Hammer.js setup placeholder - implement when library is available")}catch(t){F.Error("Failed to setup Hammer handlers:",t)}else F.Warn("svg-area element not found, skipping Hammer setup")}static Evt_MouseMove(t){var e;try{const i=null==(e=ye.opt)?void 0:e.svgDoc;if(!i)return;const o=i.docInfo;if(!o)return void F.Warn("SVG document info not available");if("number"!=typeof t.clientX||"number"!=typeof t.clientY)return void F.Error("Invalid mouse event coordinates");if(t.clientX>=o.dispX&&t.clientY>=o.dispY&&t.clientX<o.dispX+o.dispWidth&&t.clientY<o.dispY+o.dispHeight){const e=i.ConvertWindowToDocCoords(t.clientX,t.clientY);e&&(Ts.ShowXY(!0),Ts.UpdateDisplayCoordinates(null,e,null,null))}else Ts.ShowXY(!1)}catch(i){F.Error("Error in Evt_MouseMove:",i)}}static Evt_WorkAreaHammerClick(t){F.Debug("E.Evt WorkAreaHammerClick input:",t),ve.StopPropagationAndDefaults(t);const e=Ie.IsRightClick(t);return e||(Qo.ClearSelectionClick(),Ts.ShowContextMenu(!1,"WorkArea","Default"),Ts.ShowObjectConfig(!1)),Ae.DocContext.CanTypeInWorkArea=!0,e&&(ye.opt.rClickParam=new Le,ye.opt.rClickParam.hitPoint=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),Qo.ClearSelectionClick(),Ts.ShowContextMenu(!0,"WorkArea","Default")),F.Debug("E.Evt WorkAreaHammerClick output:",e?"right-click menu shown":"selection cleared","rClickParam:",ye.opt.rClickParam),!1}static Evt_WorkAreaMouseWheel(t){F.Debug("E.Evt WorkAreaMouseWheel input:",t);let e=ye.docUtil;if(t.ctrlKey){const i=t.clientX,o=t.clientY,n=ye.opt.svgDoc.ConvertWindowToDocCoords(i,o);t.deltaY>0?e.ZoomInAndOut(!1,!0):t.deltaY<0&&e.ZoomInAndOut(!0,!0),ve.StopPropagationAndDefaults(t);const s=ye.opt.svgDoc.ConvertDocToWindowCoords(n.x,n.y),a=i-s.x,r=o-s.y,l=Rt("#svg-area"),h=l.scrollLeft(),c=l.scrollTop();ye.docUtil.SetScroll(h-a,c-r),F.Debug("E.Evt WorkAreaMouseWheel output: zoom adjusted, focus maintained")}}static Evt_WorkAreaHammerDragStart(t){F.Debug("E.Evt WorkAreaHammerDragStart input:",t);const e=Rt("#svg-area"),i=e.offset(),o=t.gesture.center.clientX-i.left,n=t.gesture.center.clientY-i.top,s=e[0].clientWidth,a=e[0].clientHeight;if(!(o>=s||n>=a))return ve.StopPropagationAndDefaults(t),Ie.IsRightClick(t)?(t.preventDefault(),t.stopPropagation(),Ts.ShowContextMenu(!1,"WorkArea","Default"),F.Debug("E.Evt WorkAreaHammerDragStart output: right-click handled"),!1):(Qo.StartOptSltSelect(t),F.Debug("E.Evt WorkAreaHammerDragStart output: opt slt selection started"),!1)}static Evt_OptSltDrag(t){F.Debug("E.Evt OptSltDrag input:",t),ve.StopPropagationAndDefaults(t);try{if(!xs.AutoScrollCommon(t,!1,"OptSltSelectDoAutoScroll"))return;const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);F.Debug("E.Evt OptSltDrag processing: coordinates",e),Qo.OptSltSelectMoveCommon(e.x,e.y),F.Debug("E.Evt OptSltDrag output: opt slt updated")}catch(e){throw Qo.OptSltSelectExceptionCleanup(e),ye.opt.ExceptionCleanup(e),F.Debug("E.Evt OptSltDrag error:",e),e}}static Evt_OptSltDragEnd(t){F.Debug("E.Evt OptSltDragEnd input:",t),ve.StopPropagationAndDefaults(t);try{Qo.UnbindOptSltHammerEvents(),xs.ResetAutoScrollTimer();const e=ye.opt.optSltFrame;Qo.SelectAllInRect(e,t.gesture.srcEvent.shiftKey),ye.opt.svgOverlayLayer.RemoveElement(ye.opt.optSlt),F.Debug("E.Evt OptSltDragEnd processing: resetting opt slt state"),ye.opt.optSlt=null,ye.opt.optSltStartX=0,ye.opt.optSltStartY=0,ye.opt.optSltFrame={x:0,y:0,width:0,height:0},F.Debug("E.Evt OptSltDragEnd output: selection completed")}catch(e){throw Qo.OptSltSelectExceptionCleanup(e),ye.opt.ExceptionCleanup(e),F.Debug("E.Evt OptSltDragEnd error:",e),e}}static Evt_WorkAreaHammerDrawStart(t){F.Debug("E.Evt WorkAreaHammerDrawStart input:",t),t.stopPropagation(),t.preventDefault();return Ie.IsRightClick(t)?F.Debug("E.Evt WorkAreaHammerDrawStart output: right-click ignored"):(xs.StartNewObjectDraw(t),F.Debug("E.Evt WorkAreaHammerDrawStart output: drawing started")),!1}static Evt_DrawTrackHandlerFactory(t){return F.Debug("E.Evt DrawTrackHandlerFactory input:",t),function(e){F.Debug("E.Evt DrawTrack input:",e);try{t.LMDrawTrack(e),F.Debug("E.Evt DrawTrack output: drawing tracked")}catch(i){throw t.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),F.Debug("E.Evt DrawTrack error:",i),i}}}static Evt_DrawReleaseHandlerFactory(t){return F.Debug("E.Evt DrawReleaseHandlerFactory input:",t),function(e){F.Debug("E.Evt DrawRelease input:",e);try{t.LMDrawRelease(e),F.Debug("E.Evt DrawRelease output: drawing completed")}catch(i){throw Ps.CancelOperation(),t.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),F.Debug("E.Evt DrawRelease error:",i),i}}}static Evt_ShapeTapFactory(t){let e;return F.Debug("= U.EvtUtil: ShapeTapFactory input:",t),function(i){F.Debug("= U.EvtUtil: ShapeTap input:",i),ve.StopPropagationAndDefaults(i);const o=Ie.IsRightClick(i);if(ye.docUtil.IsReadOnly()){if(o)return t.RightClick(i),F.Debug("= U.EvtUtil: ShapeTap output: right-click menu in read-only mode"),!1}else if(o)return t.RightClick(i),F.Debug("= U.EvtUtil: ShapeTap output: right-click menu shown"),!1;switch(ye.opt.crtOpt){case me.OptTypes.None:return on.CheckTextHyperlinkHit(t,i)||Ts.GetUIAdaptation(i)&&!ye.docUtil.IsReadOnly()&&(e=ye.opt.svgObjectLayer.GetElementById(t.tag),t.SetRolloverActions(ye.opt.svgDoc,e)),Ts.ShowObjectConfig(!0),$n.SetAppStateV2SelectIndex(null),F.Debug("= U.EvtUtil: ShapeTap output: normal tap processed"),!1;case me.OptTypes.Draw:case me.OptTypes.DrawPolyline:return F.Debug("= U.EvtUtil: ShapeTap output: ignored in draw mode"),!1;case me.OptTypes.StampTextOnTap:return ye.opt.stampSticky||xs.CancelObjectStampTextOnTap(!0),t.AllowTextEdit()&&(e=ye.opt.svgObjectLayer.GetElementById(t.tag),on.ActivateTextEdit(e.svgObj.SDGObj,i,!1)),F.Debug("= U.EvtUtil: ShapeTap output: text edit activated in stamp mode"),!1}}}static Evt_ShapeDragStartFactory(t){return F.Debug("E.Evt ShapeDragStartFactory input:",t),function(t){if(F.Debug("E.Evt ShapeDragStart input:",t),ye.opt.crtOpt===me.OptTypes.Draw)return F.Debug("E.Evt ShapeDragStart output: prevented in draw mode"),!1;if(ye.opt.crtOpt===me.OptTypes.Stamp)return t.stopPropagation(),t.gesture.stopPropagation(),F.Debug("E.Evt ShapeDragStart output: prevented in stamp mode"),!1;if(Ie.IsRightClick(t))return t.preventDefault(),t.stopPropagation(),t.gesture.preventDefault(),t.gesture.stopPropagation(),F.Debug("E.Evt ShapeDragStart output: right-click prevented"),!1;switch(ye.opt.crtOpt){case me.OptTypes.None:case me.OptTypes.FormatPainter:return ve.StopPropagationAndDefaults(t),rn.LMMoveClick(t),F.Debug("E.Evt ShapeDragStart output: move operation started"),!1;case me.OptTypes.Draw:return F.Debug("E.Evt ShapeDragStart output: forwarded to draw handler"),ks.Evt_WorkAreaHammerDrawStart(t);case me.OptTypes.DrawPolyline:case me.OptTypes.StampTextOnTap:return F.Debug("E.Evt ShapeDragStart output: prevented in special mode"),!1}}}static Evt_ShapeHoldFactory(t){return F.Debug("E.Evt ShapeHoldFactory input:",t),function(e){switch(F.Debug("E.Evt ShapeHold input:",e),ye.opt.crtOpt){case me.OptTypes.None:e.gesture.stopDetect(),ve.StopPropagationAndDefaults(e),t.RightClick(e);try{rn.LMMoveRelease(e)}catch(i){throw rn.LMMoveExceptionCleanup(i),ye.opt.ExceptionCleanup(i),F.Debug("E.Evt ShapeHold error:",i),i}return F.Debug("E.Evt ShapeHold output: context menu displayed"),!1;case me.OptTypes.Draw:case me.OptTypes.DrawPolyline:case me.OptTypes.StampTextOnTap:return F.Debug("E.Evt ShapeHold output: prevented in special mode"),!1}}}static Evt_ShapeDoubleTapFactory(t){return F.Debug("E.Evt ShapeDoubleTapFactory input:",t),function(e){F.Debug("E.Evt ShapeDoubleTap input:",e);const i=t.BlockID,o=ws.GetObjectPtr(i,!1);if(!(o&&o instanceof we.Shape.BaseDrawObject))return F.Debug("E.Evt ShapeDoubleTap output: invalid object"),!1;switch(ye.opt.crtOpt){case me.OptTypes.None:if(ye.opt.bInNoteEdit)return F.Debug("E.Evt ShapeDoubleTap output: prevented during note edit"),!1;if(t.GetGraph(!1),t instanceof we.Shape.ShapeContainer)return t.DoubleClick(e),F.Debug("E.Evt ShapeDoubleTap output: container double-click handled"),!1;const i=ye.opt.svgObjectLayer.GetElementById(t.tag);return on.ActivateTextEdit(i.svgObj.SDGObj,e),F.Debug("E.Evt ShapeDoubleTap output: text editor activated"),!1;case me.OptTypes.Draw:case me.OptTypes.DrawPolyline:case me.OptTypes.StampTextOnTap:return F.Debug("E.Evt ShapeDoubleTap output: prevented in special mode"),!1}}}static Evt_ShapeDrag(t){F.Debug("E.Evt ShapeDrag input:",t),ve.StopPropagationAndDefaults(t);try{let e=xs.CheckDragIsOverCustomLibrary(t);rn.LMMoveTrack(t,e),F.Debug("E.Evt ShapeDrag output: shape position updated")}catch(e){throw rn.LMMoveExceptionCleanup(e),ye.opt.ExceptionCleanup(e),F.Debug("E.Evt ShapeDrag error:",e),e}}static Evt_ShapeDragEnd(t){F.Debug("E.Evt ShapeDragEnd input:",t),ve.StopPropagationAndDefaults(t);try{rn.LMMoveRelease(t),F.Debug("E.Evt ShapeDragEnd output: shape movement completed")}catch(e){throw rn.LMMoveExceptionCleanup(e),ye.opt.ExceptionCleanup(e),F.Debug("E.Evt ShapeDragEnd error:",e),e}}static Evt_ActionTrackHandlerFactory(t){return F.Debug("E.Evt ActionTrackHandlerFactory input:",t),function(e){return F.Debug("E.Evt ActionTrack input:",e),t.LMActionTrack(e),F.Debug("E.Evt ActionTrack output: action tracked"),!1}}static Evt_ActionReleaseHandlerFactory(t){return F.Debug("E.Evt ActionReleaseHandlerFactory input:",t),function(e){return F.Debug("E.Evt ActionRelease input:",e),t.LMActionRelease(e),F.Debug("E.Evt ActionRelease output: action completed"),!1}}static Evt_StampObjectDrag(t){return F.Debug("E.Evt StampObjectDrag input:",t),xs.StampObjectMove(t),F.Debug("E.Evt StampObjectDrag output: stamp object position updated"),!0}static Evt_MouseStampObjectMove(t){F.Debug("E.Evt MouseStampObjectMove input:",t),xs.MouseStampObjectMove(t),F.Debug("E.Evt MouseStampObjectMove output: stamp object position updated")}static Evt_MouseStampObjectDoneFactory(t){return F.Debug("E.Evt MouseStampObjectDoneFactory input:",t),function(e){return F.Debug("E.Evt MouseStampObjectDone input:",e),xs.MouseStampObjectDone(e,t),F.Debug("E.Evt MouseStampObjectDone output: object placement completed"),!0}}static Evt_StampObjectDragEndFactory(t){return F.Debug("E.Evt StampObjectDragEndFactory input:",t),function(e){return F.Debug("E.Evt StampObjectDragEnd input:",e),xs.DragDropObjectDone(e,t),F.Debug("E.Evt StampObjectDragEnd output: object placement completed"),!0}}static Evt_ActionTriggerTap(t){return F.Debug("E.Evt ActionTriggerTap input:",t),t.preventDefault(),t.gesture.stopPropagation(),t.stopPropagation(),F.Debug("E.Evt ActionTriggerTap output: propagation stopped"),!1}static Evt_WorkAreaHammerPinchIn(t){if(F.Debug("E.Evt WorkAreaHammerPinchIn input:",t),t.gesture.scale>.666)return!1;ve.StopPropagationAndDefaults(t),t.gesture.stopDetect(),Qo.OptSltSelectCancel(),ye.opt.moveList&&ye.opt.moveList.length&&rn.LMMoveRelease(t),ye.docUtil.svgDoc.GetWorkArea();const e=t.gesture.center.clientX,i=t.gesture.center.clientY,o=ye.opt.svgDoc.ConvertWindowToDocCoords(e,i);let n=Math.round(100*ye.docUtil.GetZoomFactor());if(n>50){n=Math.max(50,n-50),ye.docUtil.SetZoomFactor(n/100);const t=ye.opt.svgDoc.ConvertDocToWindowCoords(o.x,o.y),s=e-t.x,a=i-t.y,r=Rt("#svgarea"),l=r.scrollLeft(),h=r.scrollTop();ye.docUtil.SetScroll(l-s,h-a)}return F.Debug("E.Evt WorkAreaHammerPinchIn output: zoom out completed",{newZoomFactor:n/100}),!1}static Evt_WorkAreaHammerPinchOut(t){if(F.Debug("E.Evt WorkAreaHammerPinchOut input:",t),t.gesture.scale<1.333)return!1;ve.StopPropagationAndDefaults(t),t.gesture.stopDetect(),ye.opt.OptSltSelectCancel(),ye.opt.moveList&&ye.opt.moveList.length&&rn.LMMoveRelease(t),ye.docUtil.svgDoc.GetWorkArea();const e=t.gesture.center.clientX,i=t.gesture.center.clientY,o=ye.opt.svgDoc.ConvertWindowToDocCoords(e,i);let n=Math.round(100*ye.docUtil.GetZoomFactor());if(n<400){n=Math.min(400,n+50),ye.docUtil.SetZoomFactor(n/100);const t=ye.opt.svgDoc.ConvertDocToWindowCoords(o.x,o.y),s=e-t.x,a=i-t.y,r=Rt("#svgarea"),l=r.scrollLeft(),h=r.scrollTop();ye.docUtil.SetScroll(l-s,h-a)}return F.Debug("E.Evt WorkAreaHammerPinchOut output: zoom in completed",{newZoomFactor:n/100}),!1}static Evt_WorkAreaHammerPinchEnd(t){F.Debug("E.Evt WorkAreaHammerPinchEnd input:",t),F.Debug("E.Evt WorkAreaHammerPinchEnd output: touch pan state reset")}static Evt_DimensionTextKeyboardLifter(t,e){F.Debug("E.Evt DimensionTextKeyboardLifter input:",{element:t,keyboardEvent:e}),ye.opt.VirtualKeyboardLifter(t,e),F.Debug("E.Evt DimensionTextKeyboardLifter output: UI adjusted for virtual keyboard")}static Evt_DimensionTextDoubleTapFactory(t,e){return F.Debug("E.Evt DimensionTextDoubleTapFactory input:",{shape:t,textId:e}),function(i){let o,n;if(F.Debug("E.Evt DimensionTextDoubleTap input:",i),ye.opt.crtOpt==me.OptTypes.None){const s=ye.opt.svgObjectLayer.GetElementById(t.BlockID);if(null!=s){n=s.ElementCount();for(let t=0;t<n;++t)if(o=s.GetElementByIndex(t),o.GetID()==me.SVGElementClass.DimText&&o.GetUserData()==e)return ye.opt.bInDimensionEdit=!0,Qo.UpdateSelectionAttributes(null),i.gesture?on.TextRegisterEvents(o.svgObj.SDGObj,i.gesture.srcEvent):on.TextRegisterEvents(o.svgObj.SDGObj,i),i.stopPropagation(),F.Debug("E.Evt DimensionTextDoubleTap output: dimension text editing activated"),!1}return F.Debug("E.Evt DimensionTextDoubleTap output: dimension text element not found"),!1}return F.Debug("E.Evt DimensionTextDoubleTap output: prevented in modal operation"),!1}}static Evt_DimensionTextTapFactory(t,e,i){return F.Debug("E.Evt DimensionTextTapFactory input:",{shape:t,textId:e,preventPropagation:i}),function(o){if(F.Debug("E.Evt DimensionTextTap input:",o),ye.opt.crtOpt==me.OptTypes.None){const n=ye.opt.svgObjectLayer.GetElementById(t.BlockID);if(null!=n)for(let t=0;t<n.ElementCount();++t){const s=n.GetElementByIndex(t);if(s.GetID()==me.SVGElementClass.DimText&&s.GetUserData()==e)return ye.opt.bInDimensionEdit&&ye.opt.svgDoc.GetActiveEdit()==s?(i&&o.stopPropagation(),F.Debug("E.Evt DimensionTextTap output: already editing this dimension"),!1):(ye.opt.CloseEdit(!1,!0),ye.opt.bInDimensionEdit=!0,Qo.UpdateSelectionAttributes(null),o.gesture?on.TextRegisterEvents(s,o.gesture.srcEvent):on.TextRegisterEvents(s,o),o.stopPropagation(),F.Debug("E.Evt DimensionTextTap output: dimension text editing activated"),!1)}return F.Debug("E.Evt DimensionTextTap output: dimension text element not found"),!1}return F.Debug("E.Evt DimensionTextTap output: prevented in modal operation"),!1}}static Evt_PolyLineDrawExtendHandlerFactory(t){return F.Debug("E.Evt PolyLineDrawExtendHandlerFactory input:",t),function(e){F.Debug("E.Evt PolyLineDrawExtend input:",e);try{t.LMDrawExtend(e),F.Debug("E.Evt PolyLineDrawExtend output: polyline extended")}catch(i){Ps.CancelOperation(),t.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),F.Debug("E.Evt PolyLineDrawExtend error:",i)}}}static Evt_PolyLineDrawDragStart(t){return F.Debug("E.Evt PolyLineDrawDragStart input:",t),F.Debug("E.Evt PolyLineDrawDragStart output: drag prevented during polyline drawing"),!1}};let Ls=ks;a(Ls,"eventHandlers",new Map),a(Ls,"hammerInstances",new Map),a(Ls,"isInitialized",!1),a(Ls,"Evt_DrawExtendHandler",null);class As extends Di{constructor(){super(),a(this,"shapeElem"),this.svgObj=null,this.shapeElem=null}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.shapeElem=new gi.Rect,this.svgObj.add(this.shapeElem),this.InitElement(t,e),this.svgObj}SetSize(t,e){const i=Oe.RoundCoord(t),o=Oe.RoundCoord(e);this.geometryBBox.width=i,this.geometryBBox.height=o,this.svgObj.size(i,o),this.shapeElem.size(i,o),this.UpdateTransform(),this.RefreshPaint()}}class Is extends Di{constructor(){super()}AddElement(t,e){void 0!==e&&this.svgObj instanceof gi.Doc&&e++,this.svgObj.add(t.svgObj,e),t.svgObj.parent===this.svgObj&&(t.parent=this,t.RefreshPaint(!0))}RemoveElement(t){t&&t.svgObj.parent===this.svgObj&&(this.svgObj.remove(t.svgObj),t.parent=null)}RemoveAll(){let t=this.svgObj instanceof gi.Doc?1:0,e=this.svgObj.children().length;for(let i=t;i<e;i++)this.svgObj.removeAt(t)}RemoveElementByInternalId(t){const e=this.svgObj.children();for(let i=this.svgObj instanceof gi.Doc?1:0;i<e.length;i++){const o=e[i].SDGObj;if(o&&o.internalID===t){this.svgObj.removeAt(i);break}}}ElementCount(){let t=this.svgObj.children().length;return this.svgObj instanceof gi.Doc&&t--,t}GetElementByIndex(t){const e=this.svgObj.children();return this.svgObj instanceof gi.Doc&&t++,t<0||t>=e.length?null:e[t].SDGObj}GetElementById(t,e){const i=this.svgObj.children();for(let o=this.svgObj instanceof gi.Doc?1:0;o<i.length;o++){const n=i[o].SDGObj;if(n&&n.ID===t){if(e&&n.userData!==e)continue;return n}}return null}GetElementByIdInGroup(t){function e(i){const o=i.svgObj.children();let n=null;for(let s=0;s<o.length;s++){const i=o[s].SDGObj;if(i){if(i.ID===t){n=i;break}if(n=e(i),n)break}}return n}const i=this.svgObj.children();for(let o=0;o<i.length;o++){const n=i[o].SDGObj;if(n){if(n.ID===t)return n;const i=e(n);if(i)return i}}return null}GetElementListWithId(t){const e=this.svgObj.children(),i=[];for(let o=this.svgObj instanceof gi.Doc?1:0;o<e.length;o++){const n=e[o].SDGObj;n&&n.ID===t&&i.push(n)}return i}GetElementByInternalId(t){const e=this.svgObj.children();for(let i=this.svgObj instanceof gi.Doc?1:0;i<e.length;i++){const o=e[i].SDGObj;if(o&&o.internalID===t)return o}return null}FindElement(t){const e=this.svgObj.children();for(let i=0;i<e.length;i++){const o=e[i].SDGObj;if(o){if(o.ID===t)return o;if(o instanceof Is){const e=o.FindElement(t);if(e)return e}}}return null}FindElementByDOMElement(t){const e=this.svgObj.children();for(let i=this.svgObj instanceof gi.Doc?1:0;i<e.length;i++){const o=e[i].SDGObj;if(o){if(o.DOMElement()===t)return o;if(o instanceof Is){const e=o.FindElementByDOMElement(t);if(e)return e}}}return null}GetElementIndex(t){let e=this.svgObj.children().indexOf(t.svgObj);return e>0&&this.svgObj instanceof gi.Doc&&e--,e}MoveElementForward(t){this.GetElementIndex(t)<this.ElementCount()-1&&t.svgObj.forward()}MoveElementBackward(t){this.GetElementIndex(t)>0&&t.svgObj.backward()}MoveElementToFront(t){t.svgObj.front()}MoveElementToBack(t){t.svgObj.back(),t.svgObj.level()}}"undefined"!=typeof window&&("SVGPathSeg"in window||(window.SVGPathSeg=function(t,e,i){this.pathSegType=t,this.pathSegTypeAsLetter=e,this._owningPathSegList=i},window.SVGPathSeg.prototype.classname="SVGPathSeg",window.SVGPathSeg.PATHSEG_UNKNOWN=0,window.SVGPathSeg.PATHSEG_CLOSEPATH=1,window.SVGPathSeg.PATHSEG_MOVETO_ABS=2,window.SVGPathSeg.PATHSEG_MOVETO_REL=3,window.SVGPathSeg.PATHSEG_LINETO_ABS=4,window.SVGPathSeg.PATHSEG_LINETO_REL=5,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9,window.SVGPathSeg.PATHSEG_ARC_ABS=10,window.SVGPathSeg.PATHSEG_ARC_REL=11,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19,window.SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)},window.SVGPathSegClosePath=function(t){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CLOSEPATH,"z",t)},window.SVGPathSegClosePath.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"},window.SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter},window.SVGPathSegClosePath.prototype.clone=function(){return new window.SVGPathSegClosePath(void 0)},window.SVGPathSegMovetoAbs=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_MOVETO_ABS,"M",t),this._x=e,this._y=i},window.SVGPathSegMovetoAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"},window.SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegMovetoAbs.prototype.clone=function(){return new window.SVGPathSegMovetoAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegMovetoRel=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_MOVETO_REL,"m",t),this._x=e,this._y=i},window.SVGPathSegMovetoRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"},window.SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegMovetoRel.prototype.clone=function(){return new window.SVGPathSegMovetoRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoAbs=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_ABS,"L",t),this._x=e,this._y=i},window.SVGPathSegLinetoAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"},window.SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegLinetoAbs.prototype.clone=function(){return new window.SVGPathSegLinetoAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoRel=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_REL,"l",t),this._x=e,this._y=i},window.SVGPathSegLinetoRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"},window.SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegLinetoRel.prototype.clone=function(){return new window.SVGPathSegLinetoRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicAbs=function(t,e,i,o,n,s,a){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",t),this._x=e,this._y=i,this._x1=o,this._y1=n,this._x2=s,this._y2=a},window.SVGPathSegCurvetoCubicAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"},window.SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicRel=function(t,e,i,o,n,s,a){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",t),this._x=e,this._y=i,this._x1=o,this._y1=n,this._x2=s,this._y2=a},window.SVGPathSegCurvetoCubicRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"},window.SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticAbs=function(t,e,i,o,n){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",t),this._x=e,this._y=i,this._x1=o,this._y1=n},window.SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"},window.SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticRel=function(t,e,i,o,n){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",t),this._x=e,this._y=i,this._x1=o,this._y1=n},window.SVGPathSegCurvetoQuadraticRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"},window.SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcAbs=function(t,e,i,o,n,s,a,r){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_ARC_ABS,"A",t),this._x=e,this._y=i,this._r1=o,this._r2=n,this._angle=s,this._largeArcFlag=a,this._sweepFlag=r},window.SVGPathSegArcAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"},window.SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},window.SVGPathSegArcAbs.prototype.clone=function(){return new window.SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(window.SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(t){this._r1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(t){this._r2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(t){this._largeArcFlag=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(t){this._sweepFlag=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcRel=function(t,e,i,o,n,s,a,r){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_ARC_REL,"a",t),this._x=e,this._y=i,this._r1=o,this._r2=n,this._angle=s,this._largeArcFlag=a,this._sweepFlag=r},window.SVGPathSegArcRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"},window.SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},window.SVGPathSegArcRel.prototype.clone=function(){return new window.SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(window.SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(t){this._r1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(t){this._r2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(t){this._largeArcFlag=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(t){this._sweepFlag=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalAbs=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",t),this._x=e},window.SVGPathSegLinetoHorizontalAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"},window.SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},window.SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new window.SVGPathSegLinetoHorizontalAbs(void 0,this._x)},Object.defineProperty(window.SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalRel=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",t),this._x=e},window.SVGPathSegLinetoHorizontalRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"},window.SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},window.SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new window.SVGPathSegLinetoHorizontalRel(void 0,this._x)},Object.defineProperty(window.SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalAbs=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",t),this._y=e},window.SVGPathSegLinetoVerticalAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"},window.SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},window.SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new window.SVGPathSegLinetoVerticalAbs(void 0,this._y)},Object.defineProperty(window.SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalRel=function(t,e){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",t),this._y=e},window.SVGPathSegLinetoVerticalRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"},window.SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},window.SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new window.SVGPathSegLinetoVerticalRel(void 0,this._y)},Object.defineProperty(window.SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothAbs=function(t,e,i,o,n){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",t),this._x=e,this._y=i,this._x2=o,this._y2=n},window.SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"},window.SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothRel=function(t,e,i,o,n){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",t),this._x=e,this._y=i,this._x2=o,this._y2=n},window.SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"},window.SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothAbs=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",t),this._x=e,this._y=i},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothRel=function(t,e,i){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",t),this._x=e,this._y=i},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new window.SVGPathSegClosePath(void 0)},window.SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(t,e){return new window.SVGPathSegMovetoAbs(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegMovetoRel=function(t,e){return new window.SVGPathSegMovetoRel(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(t,e){return new window.SVGPathSegLinetoAbs(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegLinetoRel=function(t,e){return new window.SVGPathSegLinetoRel(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(t,e,i,o,n,s){return new window.SVGPathSegCurvetoCubicAbs(void 0,t,e,i,o,n,s)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(t,e,i,o,n,s){return new window.SVGPathSegCurvetoCubicRel(void 0,t,e,i,o,n,s)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(t,e,i,o){return new window.SVGPathSegCurvetoQuadraticAbs(void 0,t,e,i,o)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(t,e,i,o){return new window.SVGPathSegCurvetoQuadraticRel(void 0,t,e,i,o)},window.SVGPathElement.prototype.createSVGPathSegArcAbs=function(t,e,i,o,n,s,a){return new window.SVGPathSegArcAbs(void 0,t,e,i,o,n,s,a)},window.SVGPathElement.prototype.createSVGPathSegArcRel=function(t,e,i,o,n,s,a){return new window.SVGPathSegArcRel(void 0,t,e,i,o,n,s,a)},window.SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(t){return new window.SVGPathSegLinetoHorizontalAbs(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(t){return new window.SVGPathSegLinetoHorizontalRel(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(t){return new window.SVGPathSegLinetoVerticalAbs(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(t){return new window.SVGPathSegLinetoVerticalRel(void 0,t)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(t,e,i,o){return new window.SVGPathSegCurvetoCubicSmoothAbs(void 0,t,e,i,o)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(t,e,i,o){return new window.SVGPathSegCurvetoCubicSmoothRel(void 0,t,e,i,o)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(t,e){return new window.SVGPathSegCurvetoQuadraticSmoothAbs(void 0,t,e)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(t,e){return new window.SVGPathSegCurvetoQuadraticSmoothRel(void 0,t,e)},"getPathSegAtLength"in window.SVGPathElement.prototype||(window.SVGPathElement.prototype.getPathSegAtLength=function(t){if(void 0===t||!isFinite(t))throw"Invalid arguments.";var e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",this.getAttribute("d"));var i=e.pathSegList.numberOfItems-1;if(i<=0)return 0;do{if(e.pathSegList.removeItem(i),t>e.getTotalLength())break;i--}while(i>0);return i})),"SVGPathSegList"in window&&"appendItem"in window.SVGPathSegList.prototype||(window.SVGPathSegList=function(t){this._pathElement=t,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},window.SVGPathSegList.prototype.classname="SVGPathSegList",Object.defineProperty(window.SVGPathSegList.prototype,"numberOfItems",{get:function(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),Object.defineProperty(window.SVGPathSegList.prototype,"length",{get:function(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"pathSegList",{get:function(){return this._pathSegList||(this._pathSegList=new window.SVGPathSegList(this)),this._pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),window.SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())},window.SVGPathSegList.prototype._updateListFromPathMutations=function(t){if(this._pathElement){var e=!1;t.forEach((function(t){"d"==t.attributeName&&(e=!0)})),e&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}},window.SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",window.SVGPathSegList._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},window.SVGPathSegList.prototype.segmentChanged=function(t){this._writeListToPath()},window.SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList(),this._list.forEach((function(t){t._owningPathSegList=null})),this._list=[],this._writeListToPath()},window.SVGPathSegList.prototype.initialize=function(t){return this._checkPathSynchronizedToList(),this._list=[t],t._owningPathSegList=this,this._writeListToPath(),t},window.SVGPathSegList.prototype._checkValidIndex=function(t){if(isNaN(t)||t<0||t>=this.numberOfItems)throw"INDEX_SIZE_ERR"},window.SVGPathSegList.prototype.getItem=function(t){return this._checkPathSynchronizedToList(),this._checkValidIndex(t),this._list[t]},window.SVGPathSegList.prototype.insertItemBefore=function(t,e){return this._checkPathSynchronizedToList(),e>this.numberOfItems&&(e=this.numberOfItems),t._owningPathSegList&&(t=t.clone()),this._list.splice(e,0,t),t._owningPathSegList=this,this._writeListToPath(),t},window.SVGPathSegList.prototype.replaceItem=function(t,e){return this._checkPathSynchronizedToList(),t._owningPathSegList&&(t=t.clone()),this._checkValidIndex(e),this._list[e]=t,t._owningPathSegList=this,this._writeListToPath(),t},window.SVGPathSegList.prototype.removeItem=function(t){this._checkPathSynchronizedToList(),this._checkValidIndex(t);var e=this._list[t];return this._list.splice(t,1),this._writeListToPath(),e},window.SVGPathSegList.prototype.appendItem=function(t){return this._checkPathSynchronizedToList(),t._owningPathSegList&&(t=t.clone()),this._list.push(t),t._owningPathSegList=this,this._writeListToPath(),t},window.SVGPathSegList._pathSegArrayAsString=function(t){var e="",i=!0;return t.forEach((function(t){i?(i=!1,e+=t._asPathString()):e+=" "+t._asPathString()})),e},window.SVGPathSegList.prototype._parsePath=function(t){if(!t||0==t.length)return[];var e=this,i=function(){this.pathSegList=[]};i.prototype.appendSegment=function(t){this.pathSegList.push(t)};var o=function(t){this._string=t,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=window.SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()};o.prototype._isCurrentSpace=function(){var t=this._string[this._currentIndex];return t<=" "&&(" "==t||"\n"==t||"\t"==t||"\r"==t||"\f"==t)},o.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex},o.prototype._skipOptionalSpacesOrDelimiter=function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)},o.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex},o.prototype.peekSegmentType=function(){var t=this._string[this._currentIndex];return this._pathSegTypeFromChar(t)},o.prototype._pathSegTypeFromChar=function(t){switch(t){case"Z":case"z":return window.SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return window.SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return window.SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return window.SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return window.SVGPathSeg.PATHSEG_LINETO_REL;case"C":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return window.SVGPathSeg.PATHSEG_ARC_ABS;case"a":return window.SVGPathSeg.PATHSEG_ARC_REL;case"H":return window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return window.SVGPathSeg.PATHSEG_UNKNOWN}},o.prototype._nextCommandHelper=function(t,e){return("+"==t||"-"==t||"."==t||t>="0"&&t<="9")&&e!=window.SVGPathSeg.PATHSEG_CLOSEPATH?e==window.SVGPathSeg.PATHSEG_MOVETO_ABS?window.SVGPathSeg.PATHSEG_LINETO_ABS:e==window.SVGPathSeg.PATHSEG_MOVETO_REL?window.SVGPathSeg.PATHSEG_LINETO_REL:e:window.SVGPathSeg.PATHSEG_UNKNOWN},o.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var t=this.peekSegmentType();return t==window.SVGPathSeg.PATHSEG_MOVETO_ABS||t==window.SVGPathSeg.PATHSEG_MOVETO_REL},o.prototype._parseNumber=function(){var t=0,e=0,i=1,o=0,n=1,s=1,a=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,n=-1),!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!=this._string.charAt(this._currentIndex))){for(var r=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=r)for(var l=this._currentIndex-1,h=1;l>=r;)e+=h*(this._string.charAt(l--)-"0"),h*=10;if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){if(this._currentIndex++,this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)i*=10,o+=(this._string.charAt(this._currentIndex)-"0")/i,this._currentIndex+=1}if(this._currentIndex!=a&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,s=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)t*=10,t+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}var c=e+o;if(c*=n,t&&(c*=Math.pow(10,s*t)),a!=this._currentIndex)return this._skipOptionalSpacesOrDelimiter(),c}},o.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var t=!1,e=this._string.charAt(this._currentIndex++);if("0"==e)t=!1;else{if("1"!=e)return;t=!0}return this._skipOptionalSpacesOrDelimiter(),t}},o.prototype.parseSegment=function(){var t=this._string[this._currentIndex],i=this._pathSegTypeFromChar(t);if(i==window.SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==window.SVGPathSeg.PATHSEG_UNKNOWN)return null;if((i=this._nextCommandHelper(t,this._previousCommand))==window.SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=i,i){case window.SVGPathSeg.PATHSEG_MOVETO_REL:return new window.SVGPathSegMovetoRel(e,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_MOVETO_ABS:return new window.SVGPathSegMovetoAbs(e,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_REL:return new window.SVGPathSegLinetoRel(e,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_ABS:return new window.SVGPathSegLinetoAbs(e,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new window.SVGPathSegLinetoHorizontalRel(e,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new window.SVGPathSegLinetoHorizontalAbs(e,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new window.SVGPathSegLinetoVerticalRel(e,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new window.SVGPathSegLinetoVerticalAbs(e,this._parseNumber());case window.SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new window.SVGPathSegClosePath(e);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var o={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoCubicRel(e,o.x,o.y,o.x1,o.y1,o.x2,o.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:return o={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoCubicAbs(e,o.x,o.y,o.x1,o.y1,o.x2,o.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:return o={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoCubicSmoothRel(e,o.x,o.y,o.x2,o.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:return o={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoCubicSmoothAbs(e,o.x,o.y,o.x2,o.y2);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:return o={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoQuadraticRel(e,o.x,o.y,o.x1,o.y1);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:return o={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegCurvetoQuadraticAbs(e,o.x,o.y,o.x1,o.y1);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new window.SVGPathSegCurvetoQuadraticSmoothRel(e,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new window.SVGPathSegCurvetoQuadraticSmoothAbs(e,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_ARC_REL:return o={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegArcRel(e,o.x,o.y,o.x1,o.y1,o.arcAngle,o.arcLarge,o.arcSweep);case window.SVGPathSeg.PATHSEG_ARC_ABS:return o={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()},new window.SVGPathSegArcAbs(e,o.x,o.y,o.x1,o.y1,o.arcAngle,o.arcLarge,o.arcSweep);default:throw"Unknown path seg type."}};var n=new i,s=new o(t);if(!s.initialCommandIsMoveTo())return[];for(;s.hasMoreData();){var a=s.parseSegment();if(!a)return[];n.appendSegment(a)}return n.pathSegList}));class Es{constructor(t){a(this,"element"),a(this,"pathSegs"),a(this,"curPosX"),a(this,"curPosY"),this.element=t,this.pathSegs=[],this.curPosX=0,this.curPosY=0}BeginPath(){this.pathSegs=[],this.curPosX=0,this.curPosY=0}MoveTo(t,e,i){const o=Oe.RoundCoord(t),n=Oe.RoundCoord(e),s=`${i?"m":"M"}${o},${n}`;this.pathSegs.push(s),i?(this.curPosX+=o,this.curPosY+=n):(this.curPosX=o,this.curPosY=n)}LineTo(t,e,i){const o=i?"l":"L",n=Oe.RoundCoord(t),s=Oe.RoundCoord(e),a=`${o}${n},${s}`;this.pathSegs.push(a),i?(this.curPosX+=n,this.curPosY+=s):(this.curPosX=n,this.curPosY=s)}CurveTo(t,e,i,o,n){const s=Oe.RoundCoord(t),a=Oe.RoundCoord(e),r=Oe.RoundCoord(i),l=Oe.RoundCoord(o),h=`${n?"q":"Q"}${s},${a} ${r},${l}`;this.pathSegs.push(h),n?(this.curPosX+=r,this.curPosY+=l):(this.curPosX=r,this.curPosY=l)}SimpleArcTo(t,e,i,o){let n=t,s=e;o&&(n+=this.curPosX,s+=this.curPosY);const a=Math.abs(n-this.curPosX),r=Math.abs(s-this.curPosY);a&&r?this.ArcTo(t,e,a,r,0,i,!1,o):this.LineTo(t,e,o)}ArcTo(t,e,i,o,n,s,a,r){const l=Oe.RoundCoord(t),h=Oe.RoundCoord(e),c=`${r?"a":"A"}${Oe.RoundCoord(i)},${Oe.RoundCoord(o)} ${n} ${a?1:0},${s?1:0} ${l},${h}`;this.pathSegs.push(c),r?(this.curPosX+=l,this.curPosY+=h):(this.curPosX=l,this.curPosY=h)}ClosePath(){this.pathSegs.push("z")}ToString(){return this.pathSegs.join(" ")}Apply(){const t=this.ToString();this.element&&this.element instanceof Fs&&this.element.SetPath(t)}}class Fs extends Is{constructor(){super(),a(this,"pathCreator"),a(this,"pathElem"),a(this,"arrowAreaElem"),a(this,"arrowElems"),a(this,"sArrowRec"),a(this,"eArrowRec"),a(this,"origPathData"),a(this,"sArrowSize"),a(this,"eArrowSize"),a(this,"sArrowDisp"),a(this,"eArrowDisp"),a(this,"sArrowMetrics"),a(this,"eArrowMetrics"),a(this,"arrowheadBounds"),this.pathCreator=null,this.svgObj=null,this.pathElem=null,this.arrowAreaElem=null,this.arrowElems=[],this.sArrowRec=null,this.eArrowRec=null,this.origPathData=null,this.strokeWidth=0,this.sArrowSize=0,this.eArrowSize=0,this.sArrowDisp=!1,this.eArrowDisp=!1,this.sArrowMetrics={},this.eArrowMetrics={},this.arrowheadBounds=[]}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.pathElem=new gi.Path,this.svgObj.add(this.pathElem),this.arrowAreaElem=new gi.Container(gi.create("g")),this.svgObj.add(this.arrowAreaElem),this.InitElement(t,e),this.svgObj}SetArrowheads(t,e,i,o,n,s){this.IsClosed()||(this.sArrowRec=t,this.eArrowRec=i,this.sArrowSize=e,this.eArrowSize=o,this.sArrowDisp=n||!1,this.eArrowDisp=s||!1,this.UpdateArrowheads())}SetStrokeWidth(t){isNaN(t)&&"string"==typeof t&&(t=we.Basic.Symbol.ParsePlaceholder(t,ai.Placeholder.LineThick)),t=Oe.RoundCoord(t),this.pathElem.attr("stroke-width",t),this.strokeWidth=Number(t),this.pathElem.attr("stroke-dasharray",this.GetStrokePatternForWidth()),this.UpdateArrowheads()}SetStrokeColor(t){this.svgObj.attr("stroke",t),this.IsClosed()||(this.svgObj.attr("fill",t),this.pathElem.attr("fill","none")),this.ClearColorData(!1)}UpdatePattern(t,e){let i;we.Basic.Element.prototype.UpdatePattern.call(this,t,e),e||(i=this.svgObj.attr("stroke"),this.IsClosed()||(this.svgObj.attr("fill",i),this.pathElem.attr("fill","none")))}UpdateGradient(t,e){let i;we.Basic.Element.prototype.UpdateGradient.call(this,t,e),e||(i=this.svgObj.attr("stroke"),this.IsClosed()||(this.svgObj.attr("fill",i),this.pathElem.attr("fill","none")))}SetStrokePattern(t){this.strokeDashArray=t,this.pathElem.attr("stroke-dasharray",this.GetStrokePatternForWidth())}SetSize(t,e){}GetArrowheadBounds(){return[...this.arrowheadBounds]}UpdateArrowheads(){const t=this.sArrowRec,e=this.eArrowRec,i=this.sArrowSize,o=this.eArrowSize;let n=null,s=null;for(;this.arrowAreaElem.children().length;)this.arrowAreaElem.removeAt(0);if(this.arrowElems.length=0,this.arrowheadBounds=[],!this.IsClosed()&&this.origPathData){this.pathElem.plot(this.origPathData);const a=t||this.EmptyArrowhead(),r=e||this.EmptyArrowhead();a&&(this.sArrowMetrics=this.CalcArrowheadDim(a,i,this.sArrowDisp)),r&&(this.eArrowMetrics=this.CalcArrowheadDim(r,o,this.eArrowDisp)),this.CalcArrowheadPlacement(a,r),a&&(n=this.CreateArrowheadElem(a,this.sArrowMetrics,!0,this.arrowheadBounds)),r&&(s=this.CreateArrowheadElem(r,this.eArrowMetrics,!1,this.arrowheadBounds)),a&&this.sArrowMetrics.trimAmount&&this.TrimPath("start",this.sArrowMetrics.trimAmount),r&&this.eArrowMetrics.trimAmount&&this.TrimPath("end",this.eArrowMetrics.trimAmount),n&&(this.arrowElems.push(n),this.arrowAreaElem.add(n)),s&&(this.arrowElems.push(s),this.arrowAreaElem.add(s))}}CalcArrowheadDim(t,e,i){let o,n;const s={width:0,height:0,scaleFactor:0,attachX:0,attachY:0,endX:0,endY:0,trimAmount:0};return n=2*(this.strokeWidth+e),t.fixedSizeScale&&(n=this.strokeWidth*t.fixedSizeScale),o=n/t.defArea.height,s.width=t.defArea.width*o,s.height=n,s.scaleFactor=o,s.attachX=t.attachPt.x*o,s.attachY=t.attachPt.y*o,s.endX=t.endPt.x*o,s.endY=t.endPt.y*o,t.centered&&(s.endX=s.attachX,s.endY=s.attachY),s.trimAmount=s.endX-s.attachX,i&&!t.centered&&(s.trimAmount+=10),s}CreateArrowheadElem(t,e,i,o){let n=this.pathElem.attr("stroke-width");isNaN(n)&&(n=Number(we.Basic.Symbol.ParsePlaceholder(n,we.Basic.Symbol.Placeholder.LineThick)));let s=this.svgObj.attr("stroke-opacity");isNaN(s)&&(s=1);const a={x:e.offsetX,y:e.offsetY},r=e.rotatePt,l=e.angle,h=e.scaleFactor,c=t.geometry,p=new gi.Container(gi.create("g"));p.parts=[];let d=c;i&&t.flippedGeometry&&(d=t.flippedGeometry);for(let u=0;u<d.length;u++){let t=!1,e=null,i="";const o=d[u];switch(o.type){case"RECT":{e=new gi.Path,i="M";const n=o.pathData.x*h+a.x,s=o.pathData.y*h+a.y,c=o.pathData.width*h,p=o.pathData.height*h;let d=Oe.RotatePoint(r,{x:n,y:s},l);i+=Oe.RoundCoord(d.x)+","+Oe.RoundCoord(d.y)+"L",d=Oe.RotatePoint(r,{x:n+c,y:s},l),i+=Oe.RoundCoord(d.x)+","+Oe.RoundCoord(d.y)+"L",d=Oe.RotatePoint(r,{x:n+c,y:s+p},l),i+=Oe.RoundCoord(d.x)+","+Oe.RoundCoord(d.y)+"L",d=Oe.RotatePoint(r,{x:n,y:s+p},l),i+=Oe.RoundCoord(d.x)+","+Oe.RoundCoord(d.y)+"z",e.plot(i),t=!0;break}case"OVAL":{e=new gi.Path,i="M";let n=o.pathData.x*h+a.x,s=o.pathData.y*h+a.y;const c=o.pathData.width*h/2,p=o.pathData.height*h/2;s+=p-.5;let d=Oe.RotatePoint(r,{x:n,y:s},l);i+=Oe.RoundCoord(d.x)+","+Oe.RoundCoord(d.y)+"A",i+=Oe.RoundCoord(c)+","+Oe.RoundCoord(p)+" "+Oe.RoundCoord(l)+" 1 1 ",d=Oe.RotatePoint(r,{x:n,y:s+1},l),i+=Oe.RoundCoord(d.x)+","+Oe.RoundCoord(d.y)+"z",e.plot(i),t=!0;break}case"PATH":{e=new gi.Path,i="";const n=o.pathData;if(!Array.isArray(n))continue;for(let e=0;e<n.length;e++){const o=n[e];if(!Array.isArray(o)||o.length<1){i="";break}switch(o[0]){case"M":case"L":{if(o.length<3)break;const t=o[1]*h+a.x,e=o[2]*h+a.y,n=Oe.RotatePoint(r,{x:t,y:e},l);i+=o[0]+Oe.RoundCoord(n.x)+","+Oe.RoundCoord(n.y);break}case"A":{if(o.length<8)break;const t=o[6]*h+a.x,e=o[7]*h+a.y,n=o[1]*h,s=o[2]*h;let c=Oe.RotatePoint(r,{x:t,y:e},l);i+="A"+Oe.RoundCoord(n)+","+Oe.RoundCoord(s)+" "+Oe.RoundCoord(o[3]+l)+" "+o[4]+" "+o[5]+" "+Oe.RoundCoord(c.x)+","+Oe.RoundCoord(c.y);break}case"z":i+="z",t=!0}}e.plot(i);break}default:e=null}o.noWhiteFill&&(t=!1),e&&(p.add(e),p.parts.push({elem:e,filled:o.filled}),o.filled?(e.attr("stroke","none"),e.attr("fill-opacity",s)):(e.attr("stroke-width",n*o.stroke),t?(e.attr("fill-opacity",1),e.attr("fill","#FFFFFF")):e.attr("fill","none")))}if(p.attr("stroke-dasharray","none"),o&&"empty"!==t.desc){let e=a.x,i=a.y,n=t.defArea.width*h,s=t.defArea.height*h;if(l){let t=Oe.RotatePoint(r,{x:e,y:i},l),o=t.x,a=t.x,h=t.y,c=t.y;t=Oe.RotatePoint(r,{x:e+n,y:i},l),o=t.x<o?t.x:o,a=t.x>a?t.x:a,h=t.y<h?t.y:h,c=t.y>c?t.y:c,t=Oe.RotatePoint(r,{x:e,y:i+s},l),o=t.x<o?t.x:o,a=t.x>a?t.x:a,h=t.y<h?t.y:h,c=t.y>c?t.y:c,t=Oe.RotatePoint(r,{x:e+n,y:i+s},l),o=t.x<o?t.x:o,a=t.x>a?t.x:a,h=t.y<h?t.y:h,c=t.y>c?t.y:c,e=o,i=h,n=a-o,s=c-h}o.push({x:e,y:i,width:n,height:s})}return p}CalcArrowheadPlacement(t,e){if(t||e)try{const i=this.pathElem.node.getTotalLength();let o=this.pathElem.node.getPointAtLength(0),n=this.pathElem.node.getPointAtLength(i),s=t?this.sArrowMetrics.trimAmount:0,a=e?this.eArrowMetrics.trimAmount:0;if(s+a>=i){const t=this.pathElem.node.getPointAtLength(i/2);s&&a?(this.sArrowMetrics.trimAmount=i/2,this.eArrowMetrics.trimAmount=i/2,s=a=i/2):s?(this.sArrowMetrics.trimAmount=i,s=i):(this.eArrowMetrics.trimAmount=i,a=i),o=t,n=t}let r=t?t.centered?this.pathElem.node.getPointAtLength(i/2):this.pathElem.node.getPointAtLength(s):null,l=e?e.centered?this.pathElem.node.getPointAtLength(i/2):this.pathElem.node.getPointAtLength(i-a):null;if(t){let e=r.x===o.x&&r.y===o.y?i<2?{x:o.x+2,y:o.y}:this.pathElem.node.getPointAtLength(2):r;t.centered&&i>=4&&(o=this.pathElem.node.getPointAtLength(i/2-2)),this.sArrowMetrics.angle=t.noRotate?0:Oe.CalcAngleFromPoints(e,o),this.sArrowMetrics.rotatePt=r,this.sArrowMetrics.offsetX=r.x-this.sArrowMetrics.attachX,this.sArrowMetrics.offsetY=r.y-this.sArrowMetrics.attachY}if(e){let t=l.x===n.x&&l.y===n.y?i<2?{x:n.x-2,y:n.y}:this.pathElem.node.getPointAtLength(i-2):l;e.centered&&i>=4&&(n=this.pathElem.node.getPointAtLength(i/2+2)),this.eArrowMetrics.angle=e.noRotate?0:Oe.CalcAngleFromPoints(t,n),this.eArrowMetrics.rotatePt=l,this.eArrowMetrics.offsetX=l.x-this.eArrowMetrics.attachX,this.eArrowMetrics.offsetY=l.y-this.eArrowMetrics.attachY}}catch(i){F.Error("= b.Path: CalcArrowheadPlacement/ Error in CalcArrowheadPlacement:",i)}}EmptyArrowhead(){return{id:0,desc:"empty",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!1,noRotate:!0,geometry:[{type:"RECT",filled:!1,noWhiteFill:!0,stroke:0,pathData:{x:0,y:0,width:10,height:10}}]}}TrimPath(t,e){const i=this.pathElem.node.pathSegList.numberOfItems,o=this.pathElem.node.getTotalLength();let n={x:0,y:0};if(e)if(e>=o)this.pathElem.plot();else{const s="start"===t?e:o-e,a=this.pathElem.node.getPathSegAtLength(s);let r=this.pathElem.node.getPointAtLength(s);r={x:Oe.RoundCoord(r.x),y:Oe.RoundCoord(r.y)};const l=this.pathElem.node.pathSegList.getItem(a);if("start"===t){const t=this.IsSegmentAbs(l);t||(n=this.CalcSegEndpoint(this.pathElem,a),n.x=Oe.RoundCoord(n.x),n.y=Oe.RoundCoord(n.y));for(let i=1;i<a;i++)this.pathElem.node.pathSegList.removeItem(1);const e=this.pathElem.node.createSVGPathSegMovetoAbs(r.x,r.y);if(this.pathElem.node.pathSegList.replaceItem(e,0),!t){let t;switch(l.pathSegType){case me.SVGPathSeg.PATHSEG_LINETO_ABS:case me.SVGPathSeg.PATHSEG_LINETO_REL:case me.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:case me.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:case me.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:case me.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:t=this.pathElem.node.createSVGPathSegLinetoAbs(n.x,n.y);break;case me.SVGPathSeg.PATHSEG_ARC_ABS:case me.SVGPathSeg.PATHSEG_ARC_REL:t=this.pathElem.node.createSVGPathSegArcAbs(n.x,n.y,l.r1,l.r2,l.angle,l.largeArcFlag,l.sweepFlag);break;default:t=null}t&&this.pathElem.node.pathSegList.replaceItem(t,1)}}else{for(let e=a+1;e<i;e++)this.pathElem.node.pathSegList.removeItem(a+1);let t;switch(l.pathSegType){case me.SVGPathSeg.PATHSEG_LINETO_ABS:case me.SVGPathSeg.PATHSEG_LINETO_REL:case me.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:case me.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:case me.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:case me.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:t=this.pathElem.node.createSVGPathSegLinetoAbs(r.x,r.y);break;case me.SVGPathSeg.PATHSEG_ARC_ABS:case me.SVGPathSeg.PATHSEG_ARC_REL:t=this.pathElem.node.createSVGPathSegArcAbs(r.x,r.y,l.r1,l.r2,l.angle,l.largeArcFlag,l.sweepFlag);break;default:t=null}t&&this.pathElem.node.pathSegList.replaceItem(t,a)}}}CalcSegEndpoint(t,e){let i={x:0,y:0};for(let o=0;o<=e;o++){const e=t.node.pathSegList.getItem(o);switch(e.pathSegType){case me.SVGPathSeg.PATHSEG_MOVETO_ABS:case me.SVGPathSeg.PATHSEG_LINETO_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:case me.SVGPathSeg.PATHSEG_ARC_ABS:case me.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:case me.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:void 0!==e.x&&(i.x=e.x),void 0!==e.y&&(i.y=e.y);break;case me.SVGPathSeg.PATHSEG_MOVETO_REL:0===o?(i.x=e.x,i.y=e.y):(i.x+=e.x,i.y+=e.y);break;default:void 0!==e.x&&(i.x+=e.x),void 0!==e.y&&(i.y+=e.y)}}return i}GetGeometryBBox(){if(this.geometryBBox.width<0||this.geometryBBox.height<0){const t=this.doc.GetFormattingLayer(),e=new gi.Path;e.plot(this.origPathData),t.svgObj.add(e);const i=e.node.getBBox();t.svgObj.remove(e),this.geometryBBox.x=i.x,this.geometryBBox.y=i.y,this.geometryBBox.width=i.width,this.geometryBBox.height=i.height}return this.geometryBBox}IsSegmentAbs(t){let e=!1;switch(t.pathSegType){case me.SVGPathSeg.PATHSEG_MOVETO_ABS:case me.SVGPathSeg.PATHSEG_LINETO_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:case me.SVGPathSeg.PATHSEG_ARC_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:case me.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:e=!0}return e}IsClosed(){const t=this.pathElem.node.pathSegList.numberOfItems;if(t<1)return!1;return this.pathElem.node.pathSegList.getItem(t-1).pathSegType===me.SVGPathSeg.PATHSEG_CLOSEPATH}SetPath(t,e){this.origPathData=t,this.pathElem.plot(t),this.UpdateArrowheads(),this.UpdateTransform(),e?(this.geometryBBox.x=e.x,this.geometryBBox.y=e.y,this.geometryBBox.width=e.width,this.geometryBBox.height=e.height):(this.geometryBBox.width=-1,this.geometryBBox.height=-1),this.RefreshPaint()}PathCreator(){return this.pathCreator||(this.pathCreator=new Es(this)),this.pathCreator}}class Gs extends Fs{constructor(){super(),a(this,"rx"),a(this,"ry"),this.rx=0,this.ry=0}SetRRectSize(t,e,i,o){i>=t/2&&(i=(t-1)/2),o>=e/2&&(o=(e-1)/2),this.rx=i,this.ry=o;const n=this.PathCreator(),s=t-2*i,a=e-2*o;n.BeginPath(),i&&o?(n.MoveTo(0,o),n.SimpleArcTo(i,-o,!0,!0),n.LineTo(s,0,!0),n.SimpleArcTo(i,o,!0,!0),n.LineTo(0,a,!0),n.SimpleArcTo(-i,o,!0,!0),n.LineTo(-s,0,!0),n.SimpleArcTo(-i,-o,!0,!0),n.ClosePath()):(n.MoveTo(0,0),n.LineTo(t,0,!0),n.LineTo(0,e,!0),n.LineTo(-t,0,!0),n.ClosePath());const r=n.ToString();this.SetPath(r,{x:0,y:0,width:t,height:e})}SetSize(t,e){this.SetRRectSize(t,e,this.rx,this.ry)}}class Rs extends Di{constructor(){super(),a(this,"shapeElem"),this.svgObj=null,this.shapeElem=null}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.shapeElem=new gi.Ellipse,this.svgObj.add(this.shapeElem),this.InitElement(t,e),this.svgObj}SetSize(t,e){const i=Oe.RoundCoord(t),o=Oe.RoundCoord(e);this.geometryBBox.width=i,this.geometryBBox.height=o,this.svgObj.size(i,o),this.shapeElem.size(i,o),this.UpdateTransform(),this.RefreshPaint()}}class js extends Fs{constructor(){super()}SetPoints(t,e,i,o){const n=this.PathCreator();n.BeginPath(),n.MoveTo(t,e),n.LineTo(i,o);const s=n.ToString();this.SetPath(s,{x:Math.min(t,i),y:Math.min(e,o),width:Math.abs(i-t),height:Math.abs(o-e)})}}class Bs extends Fs{constructor(){super()}SetPoints(t){const e=this.PathCreator(),i={x:0,y:0},o={x:0,y:0},n=t.length;if(e.BeginPath(),n>1){const n=t[0];e.MoveTo(n.x,n.y),i.x=o.x=n.x,i.y=o.y=n.y}for(let r=1;r<n;r++){const n=t[r];e.LineTo(n.x,n.y),i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),o.x=Math.max(o.x,n.x),o.y=Math.max(o.y,n.y)}const s=e.ToString(),a={x:i.x,y:i.y,width:o.x-i.x,height:o.y-i.y};this.SetPath(s,a)}}class Ms extends Fs{constructor(){super(),a(this,"pList"),this.pList=[],this.arrowElems=[]}Clear(){this.pList=[],this.BuildPath()}AddPolyLine(t,e,i){this.pList.push({points:t,sArrowFlag:e,eArrowFlag:i})}BuildPath(){for(;this.arrowAreaElem.children().length;)this.arrowAreaElem.removeAt(0);this.arrowElems.length=0;const t=this.PathCreator();t.BeginPath(),this.arrowheadBounds=[];let e=null;const i={x:0,y:0},o={x:0,y:0};let n=!0,s=!1;const a=this.pList.length;for(let l=0;l<a;l++){let a=null,r=null;const h=this.pList[l].points.length;for(let c=0;c<h-1;c++){const p=0===c,d=c===h-2,u=this.pList[l].points[c];let g=this.pList[l].points[c+1];p&&this.pList[l].sArrowFlag&&this.sArrowRec&&(a={arrowRec:this.sArrowRec,arrowSize:this.sArrowSize,arrowDisp:this.sArrowDisp}),d&&this.pList[l].eArrowFlag&&this.eArrowRec&&(r={arrowRec:this.eArrowRec,arrowSize:this.eArrowSize,arrowDisp:this.eArrowDisp}),(a||r)&&(this.GenerateArrowheads(u,g,a,r),s=!0),n?(i.x=Math.min(u.x,g.x),i.y=Math.min(u.y,g.y),o.x=Math.max(u.x,g.x),o.y=Math.max(u.y,g.y)):(i.x=Math.min(i.x,u.x,g.x),i.y=Math.min(i.y,u.y,g.y),o.x=Math.max(o.x,u.x,g.x),o.y=Math.max(o.y,u.y,g.y)),n=!1,e=a?a.segPt:u,r&&(g=r.segPt),p?t.MoveTo(e.x,e.y):d||t.LineTo(e.x,e.y),d&&t.LineTo(g.x,g.y)}a&&(this.arrowAreaElem.add(a.arrowElem),this.arrowElems.push(a.arrowElem)),r&&(this.arrowAreaElem.add(r.arrowElem),this.arrowElems.push(r.arrowElem))}if(!s&&e){const t={arrowRec:this.EmptyArrowhead(),arrowSize:this.sArrowSize,arrowDisp:!1,arrowElem:null};this.GenerateArrowheads(e,e,t,null),this.arrowAreaElem.add(t.arrowElem),this.arrowElems.push(t.arrowElem)}const r=t.ToString();this.origPathData=r,this.pathElem.plot(r),this.UpdateTransform(),this.geometryBBox.x=i.x,this.geometryBBox.y=i.y,this.geometryBBox.width=o.x-i.x,this.geometryBBox.height=o.y-i.y,this.RefreshPaint()}UpdateArrowheads(){this.BuildPath()}GenerateArrowheads(t,e,i,o){let n,s,a,r,l,h,c,p;if(i&&(i.segPt={x:t.x,y:t.y},i.attachPt={x:t.x,y:t.y},i.offset={x:t.x,y:t.y},i.arrowElem=null,i.angle=180),o&&(o.segPt={x:e.x,y:e.y},o.attachPt={x:e.x,y:e.y},o.offset={x:e.x,y:e.y},o.arrowElem=null,o.angle=0),n=e.x-t.x,s=e.y-t.y,a=Math.sqrt(n*n+s*s),i&&(r=this.CalcArrowheadDim(i.arrowRec,i.arrowSize,i.arrowDisp)),o&&(l=this.CalcArrowheadDim(o.arrowRec,o.arrowSize,o.arrowDisp)),h=(r?r.trimAmount:0)+(l?l.trimAmount:0),h>a?(c=(r?r.trimAmount:0)/h*a,p=(l?l.trimAmount:0)/h*a):(c=r?r.trimAmount:0,p=l?l.trimAmount:0),a){const h=n/a,d=s/a;i&&(i.segPt.x=t.x+c*h,i.segPt.y=t.y+c*d,i.attachPt.x=i.arrowRec.centered?t.x+a/2*h:i.segPt.x,i.attachPt.y=i.arrowRec.centered?t.y+a/2*d:i.segPt.y,i.angle=i.arrowRec.noRotate?0:Oe.CalcAngleFromPoints(e,t),i.offset.x=i.attachPt.x-r.attachX,i.offset.y=i.attachPt.y-r.attachY),o&&(o.segPt.x=t.x+(a-p)*h,o.segPt.y=t.y+(a-p)*d,o.attachPt.x=o.arrowRec.centered?t.x+a/2*h:o.segPt.x,o.attachPt.y=o.arrowRec.centered?t.y+a/2*d:o.segPt.y,o.angle=o.arrowRec.noRotate?0:Oe.CalcAngleFromPoints(t,e),o.offset.x=o.attachPt.x-l.attachX,o.offset.y=o.attachPt.y-l.attachY),r&&(r.offsetX=i.offset.x,r.offsetY=i.offset.y,r.angle=i.angle,r.rotatePt=i.attachPt,i.arrowElem=this.CreateArrowheadElem(i.arrowRec,r,!0,this.arrowheadBounds)),l&&(l.offsetX=o.offset.x,l.offsetY=o.offset.y,l.angle=o.angle,l.rotatePt=o.attachPt,o.arrowElem=this.CreateArrowheadElem(o.arrowRec,l,!1,this.arrowheadBounds))}}}class Hs extends Fs{constructor(){super()}SetPoints(t){let e=this.PathCreator(),i={x:0,y:0},o={x:0,y:0},n=t.length;e.BeginPath(),n>1&&(e.MoveTo(t[0].x,t[0].y),i.x=o.x=t[0].x,i.y=o.y=t[0].y);for(let a=1;a<n;a++)e.LineTo(t[a].x,t[a].y),i.x=Math.min(i.x,t[a].x),i.y=Math.min(i.y,t[a].y),o.x=Math.max(o.x,t[a].x),o.y=Math.max(o.y,t[a].y);n>1&&e.ClosePath();let s=e.ToString();this.SetPath(s,{x:i.x,y:i.y,width:o.x-i.x,height:o.y-i.y})}}class _s extends Is{constructor(){super(),a(this,"clipElem")}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.clipElem=null,this.InitElement(t,e),this.svgObj}GetGeometryBBox(){if(this.geometryBBox.width<0||this.geometryBBox.height<0){let t,e,i=this.doc.GetFormattingLayer(),o=[],n={x:this.svgObj.trans.x,y:this.svgObj.trans.y},s=this.svgObj.trans.rotation,a=this.svgObj.parent,r=0;a&&(r=this.svgObj.position(),a.remove(this.svgObj)),this.RemoveNodesRecursively(this.svgObj.node,o),i.svgObj.add(this.svgObj),this.svgObj.transform({x:0,y:0,rotation:0}),t=this.svgObj.rbox(),i.svgObj.remove(this.svgObj),e=this.doc.ConvertWindowToDocCoords(t.x,t.y),this.geometryBBox.x=e.x,this.geometryBBox.y=e.y,this.geometryBBox.width=t.width,this.geometryBBox.height=t.height,this.svgObj.transform({x:n.x,y:n.y,rotation:s});for(let l=0;l<o.length;l++){let t=o[l];t.parent.insertBefore(t.node,t.sibling)}a&&a.add(this.svgObj,r),this.UpdateTransform()}return this.geometryBBox}RemoveNodesRecursively(t,e){const i=t.parentNode;if(t.hasAttribute&&t.removeAttribute&&"ELEMENT_NODE"===t.nodeType){if(t.hasAttribute("no-export")||t.hasAttribute("sfx"))return e.push({node:t,parent:i,sibling:t.nextSibling}),void i.removeChild(t);if("pattern"===t.nodeName)return e.push({node:t,parent:i,sibling:t.nextSibling}),void i.removeChild(t);for(let i=t.childNodes.length-1;i>=0;i--)this.RemoveNodesRecursively(t.childNodes[i],e)}}SetClipRect(t,e,i,o){if(this.ClearClipRect(),i&&o){const n=Oe.MakeGuid(),s=new gi.Container(gi.create("clipPath"));s.attr("id",n);const a=new gi.Rect;a.transform({x:Oe.RoundCoord(t),y:Oe.RoundCoord(e)}),a.size(Oe.RoundCoord(i),Oe.RoundCoord(o)),s.add(a),this.svgObj.add(s),this.svgObj.attr("clip-path","url(#"+n+")"),this.clipElem=s}}ClearClipRect(){this.clipElem&&(this.svgObj.remove(this.clipElem),this.svgObj.node.removeAttribute("clip-path"),this.clipElem=null)}GetTargetForEvent(t){if(!(t&&this instanceof Is))return this;let e=t.target||t.srcElement;const i=this.DOMElement();if(!e||e===i)return this;let o=this.FindElementByDOMElement(e);for(;e&&!o;)e=e.parentNode,o=e===i?this:this.FindElementByDOMElement(e);return o||this}RefreshPaint(t){if(this.fillPatternData?this.UpdatePattern(this.fillPatternData.ID,!0):this.fillGradientData&&this.UpdateGradient(this.fillGradientData.ID,!0),this.strokePatternData?this.UpdatePattern(this.strokePatternData.ID,!1):this.strokeGradientData&&this.UpdateGradient(this.strokeGradientData.ID,!1),t&&this instanceof _s){const e=this.ElementCount();for(let i=0;i<e;i++){const e=this.GetElementByIndex(i);e&&e.RefreshPaint(t)}}}}class Us extends Is{constructor(){super(),a(this,"scaleOKFlag"),a(this,"dpiScaleOnlyFlag"),this.scaleOKFlag=!0,this.dpiScaleOnlyFlag=!1}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.InitElement(t,e),this.svgObj}AllowScaling(t){this.scaleOKFlag=t,t&&(this.dpiScaleOnlyFlag=!1)}AllowDpiScalingOnly(t){this.dpiScaleOnlyFlag=t,t&&(this.scaleOKFlag=!1)}IsScalingAllowed(){return this.scaleOKFlag}IsDpiScalingAllowed(){return this.dpiScaleOnlyFlag}}class Ns extends Di{constructor(){super(),a(this,"shapeElem"),a(this,"fillColors"),a(this,"lineColors"),a(this,"lineWidths"),a(this,"solidFills"),a(this,"fillTrans"),a(this,"lineTrans"),a(this,"strokeColors"),a(this,"srcSymbolSvg"),a(this,"svgContent"),a(this,"symbolName"),a(this,"drawSetting")}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.shapeElem=new gi.Container(gi.create("g")),this.svgObj.add(this.shapeElem),this.InitElement(t,e),this.fillColors=[],this.lineColors=[],this.lineWidths=[],this.solidFills=[],this.fillTrans=[],this.lineTrans=[],this.srcSymbolSvg="",this.strokeColors=[],this.svgObj}InitSymbolSource(){var t=this.GetSymbolSource(),e="object-svg";if(this.drawSetting&&(this.drawSetting.active&&this.drawSetting.inAlarm?e=`${e} active in-alarm`:this.drawSetting.active?e=`${e} active`:this.drawSetting.inAlarm&&(e=`${e} in-alarm`)),""!==e){t=`\n          <g class="${e}">\n                    ${t}\n          </g>\n        `}this.drawSetting&&this.drawSetting.fillColor?(this.SetSymbolSource(t),this.SetFillColor(this.drawSetting.fillColor,!0)):(this.SetSymbolSource(t),this.RebuildSymbol())}GetSymbolSource(t){return null==t||""===t?ms.GetSvgDataString(this.symbolName):t}SetSymbolSource(t){if(this.srcSymbolSvg=t,this.fillColors=Ns.GetPlaceholders(ai.Placeholder.FillColor,t),this.lineColors=Ns.GetPlaceholders(ai.Placeholder.LineColor,t),this.lineWidths=Ns.GetPlaceholders(ai.Placeholder.LineThick,t),this.solidFills=Ns.GetPlaceholders(ai.Placeholder.SolidFill,t),this.fillTrans=Ns.GetPlaceholders(ai.Placeholder.FillTrans,t),this.lineTrans=Ns.GetPlaceholders(ai.Placeholder.LineTrans,t),this.strokeColors=Ns.GetPlaceholders(ai.Placeholder.StrokeColor,t),t){t=t.replace(/fill-opacity="[\d.]*"/g,"").replace(/stroke-opacity="[\d.]*"/g,"");const e=Ns.CreatePlaceholder(ai.Placeholder.FillTrans,ai.PlaceholderDefault[ai.Placeholder.FillTrans]);t=t.replace(new RegExp('fill="##FillColor',"g"),'fill-opacity="'+e+'" fill="##FillColor'),this.fillTrans=Ns.GetPlaceholders(ai.Placeholder.FillTrans,t);const i=Ns.CreatePlaceholder(ai.Placeholder.LineTrans,ai.PlaceholderDefault[ai.Placeholder.LineTrans]);t=t.replace(new RegExp('stroke="##LineColor',"g"),'stroke-opacity="'+i+'" stroke="##LineColor').replace(new RegExp('fill="##LineColor',"g"),'fill-opacity="'+i+'" fill="##LineColor'),this.lineTrans=Ns.GetPlaceholders(ai.Placeholder.LineTrans,t),this.srcSymbolSvg=t}}RebuildSymbol(){let t=`<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>${this.srcSymbolSvg}</svg>`;const e=new DOMParser;this.shapeElem.clear(),this.svgObj.clear(),this.svgObj.add(this.shapeElem),t=Ns.ReplacePlaceholder(this.fillColors,t),t=Ns.ReplacePlaceholder(this.lineColors,t),t=Ns.ReplacePlaceholder(this.lineWidths,t),t=Ns.ReplacePlaceholder(this.solidFills,t),t=Ns.ReplacePlaceholder(this.fillTrans,t),t=Ns.ReplacePlaceholder(this.lineTrans,t),t=Ns.ReplacePlaceholder(this.strokeColors,t),e.async=!1;let i=e.parseFromString(t,"text/xml").documentElement.firstChild;for(;i;)this.shapeElem.node.appendChild(this.svgObj.node.ownerDocument.importNode(i,!0)),i=i.nextSibling;this.svgContent=t}GetScaleElement(){return this.shapeElem}SetFillColor(t,e){F.Debug("= B.Symbol SetFillColor | color,skipClear",t,e);let i=!1;e||this.ClearColorData(!0);for(let o=0;o<this.fillColors.length;o++)this.fillColors[o].val=t,i=!0;if(t.startsWith("#"))for(let o=0;o<this.solidFills.length;o++)this.solidFills[o].val=t,i=!0;i&&this.RebuildSymbol()}SetTextureFill(t){we.Basic.Element.SetTextureFill.call(this,t);const e=this.svgObj.attr("fill");this.svgObj.attr("fill",""),this.fillPatternData&&this.fillPatternData.patternElem&&(this.svgObj.remove(this.fillPatternData.patternElem),this.SetFillColor(e,!0),this.svgObj.add(this.fillPatternData.patternElem,0))}SetGradientFill(t){we.Basic.Element.SetGradientFill.call(this,t);const e=this.svgObj.attr("fill");this.svgObj.attr("fill",""),this.fillGradientData&&this.fillGradientData.gradientElem&&(this.svgObj.remove(this.fillGradientData.gradientElem),this.SetFillColor(e,!0),this.svgObj.add(this.fillGradientData.gradientElem,0))}SetStrokeColor(t,e){e||this.ClearColorData(!1);for(let i=0;i<this.strokeColors.length;i++)this.strokeColors[i].val=t;this.strokeColors.length&&this.RebuildSymbol()}SetTextureStroke(t){we.Basic.Element.SetTextureStroke.call(this,t);const e=this.svgObj.attr("stroke");this.svgObj.attr("stroke",""),this.strokePatternData&&this.strokePatternData.patternElem&&(this.svgObj.remove(this.strokePatternData.patternElem),this.SetStrokeColor(e,!0),this.svgObj.add(this.strokePatternData.patternElem,0))}SetGradientStroke(t){we.Basic.Element.SetGradientStroke.call(this,t);const e=this.svgObj.attr("stroke");this.svgObj.attr("stroke",""),this.strokeGradientData&&this.strokeGradientData.gradientElem&&(this.svgObj.remove(this.strokeGradientData.gradientElem),this.SetStrokeColor(e,!0),this.svgObj.add(this.strokeGradientData.gradientElem,0))}SetStrokeWidth(t){isNaN(Number(t))&&(t=Number(Ns.ParsePlaceholder(t,ai.Placeholder.LineThick)));for(let e=0;e<this.lineWidths.length;e++)this.lineWidths[e].val=t;this.lineWidths.length&&this.RebuildSymbol()}SetFillOpacity(t){for(let e=0;e<this.fillTrans.length;e++)this.fillTrans[e].val=t;this.fillTrans.length&&this.RebuildSymbol()}SetStrokeOpacity(t){for(let e=0;e<this.lineTrans.length;e++)this.lineTrans[e].val=t;this.lineTrans.length&&this.RebuildSymbol()}SetStrokePattern(t){}SetAttributes(t){this.svgObj.attr("background-color",t),this.shapeElem.attr("background-color",t)}GetSvgSymbol(){return this.svgContent}SetInActive(t){}SetDrawSetting(t){this.drawSetting=t,F.Debug("= B.Symbol SetDrawSetting Input/Output drawSetting",t)}RefreshDrawSetting(){F.Debug("= B.Symbol RefreshDrawSetting src-symbol-svg",this.srcSymbolSvg),this.InitSymbolSource()}SetSymbolName(t){this.symbolName=t}static CreatePlaceholder(t,e=""){return`${t}=${e}${ai.Placeholder.Terminator}`}static ParsePlaceholder(t,e){const i=t.indexOf("=")+1,o=t.lastIndexOf(ai.Placeholder.Terminator);let n=ai.PlaceholderDefault[e];return i>0&&o>i&&(n=t.slice(i,o)),n}static GetPlaceholders(t,e){const i=[];if(!e)return i;try{const o=e.match(new RegExp(`${t}.*?##`,"g"));if(o)for(let e=0;e<o.length;e++)i.push({placeholder:o[e],val:Ns.ParsePlaceholder(o[e],t)})}catch(o){Uo.Error("= b.Symbol: GetPlaceholders/ Error getting placeholders:",o)}return i}static ReplacePlaceholder(t,e){let i=e;if(!e)return i;for(let o=0;o<t.length;o++)i=i.replace(new RegExp(t[o].placeholder,"g"),t[o].val);return i}}class Vs extends _s{constructor(){super(),a(this,"shapeGroup")}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("g")),this.InitElement(t,e),this.shapeGroup=new _s,this.shapeGroup.CreateElement(t,e),super.AddElement(this.shapeGroup),this.svgObj}AddElement(t,e,i){return i?super.AddElement(t,e):this.shapeGroup?this.shapeGroup.AddElement(t,e):void 0}RemoveElement(t,e){return e?super.RemoveElement(t):this.shapeGroup?this.shapeGroup.RemoveElement(t):void 0}RemoveAll(t){return t?super.RemoveAll():this.shapeGroup?this.shapeGroup.RemoveAll():void 0}RemoveElementByInternalId(t,e){return e?super.RemoveElementByInternalId(t):this.shapeGroup?this.shapeGroup.RemoveElementByInternalId(t):void 0}ElementCount(t){return t?super.ElementCount():this.shapeGroup?this.shapeGroup.ElementCount():0}GetElementByIndex(t,e){return e?super.GetElementByIndex(t):this.shapeGroup?this.shapeGroup.GetElementByIndex(t):null}GetElementById(t,e,i){return e?super.GetElementById(t,i):this.shapeGroup?this.shapeGroup.GetElementById(t,i):null}GetElementByIdInGroup(t,e){return e?super.GetElementByIdInGroup(t):this.shapeGroup?this.shapeGroup.GetElementByIdInGroup(t):null}GetElementListWithId(t,e){return e?super.GetElementListWithId(t):this.shapeGroup?this.shapeGroup.GetElementListWithId(t):[]}GetElementByInternalId(t,e){return e?super.GetElementByInternalId(t):this.shapeGroup?this.shapeGroup.GetElementByInternalId(t):null}FindElement(t,e){return e?super.FindElement(t):this.shapeGroup?this.shapeGroup.FindElement(t):null}FindElementByDOMElement(t,e){return e?super.FindElementByDOMElement(t):this.shapeGroup?this.shapeGroup.FindElementByDOMElement(t):null}GetElementIndex(t,e){return e?super.GetElementIndex(t):this.shapeGroup?this.shapeGroup.GetElementIndex(t):-1}MoveElementForward(t,e){return e?super.MoveElementForward(t):this.shapeGroup?this.shapeGroup.MoveElementForward(t):void 0}MoveElementBackward(t,e){return e?super.MoveElementBackward(t):this.shapeGroup?this.shapeGroup.MoveElementBackward(t):void 0}MoveElementToFront(t,e){return e?super.MoveElementToFront(t):this.shapeGroup?this.shapeGroup.MoveElementToFront(t):void 0}MoveElementToBack(t,e){return e?super.MoveElementToBack(t):this.shapeGroup?this.shapeGroup.MoveElementToBack(t):void 0}}class zs extends Di{constructor(){super(),a(this,"shapeElem"),this.svgObj=null,this.shapeElem=null}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("use")),this.InitElement(t,e),this.svgObj}SetElementSource(t){const e=t.SetInternalID();this.svgObj.attr("xlink:href",`#${e}`,"http://www.w3.org/1999/xlink")}}class Ws{constructor(){a(this,"width"),a(this,"height"),a(this,"fmtWidth"),a(this,"text"),a(this,"paragraphs"),a(this,"styles"),a(this,"hyperlinks"),this.width=0,this.height=0,this.fmtWidth=0,this.text="",this.paragraphs=[],this.styles=[],this.hyperlinks=[]}}class Ks{constructor(){a(this,"text"),a(this,"charStyles"),a(this,"styleRuns"),a(this,"styles"),a(this,"hyperlinks"),this.text="",this.charStyles=[],this.styleRuns=[],this.styles=[new xi],this.hyperlinks=[]}}class Ys{constructor(t){a(this,"parent"),a(this,"limits"),a(this,"fmtText"),a(this,"rtData"),a(this,"renderedLines"),a(this,"wordList"),a(this,"renderingEnabled"),a(this,"deferredRenderNeeded"),a(this,"contentVersion"),a(this,"spellCheckEnabled"),a(this,"dataNameEnabled"),a(this,"renderedDataFields"),this.parent=t,this.limits={minWidth:0,maxWidth:0},this.fmtText=new Ws,this.rtData=new Ks,this.renderedLines=[],this.wordList=null,this.renderingEnabled=!0,this.deferredRenderNeeded=!1,this.contentVersion=0,this.spellCheckEnabled=!1,this.dataNameEnabled=!1}SetLimits(t){this.limits.minWidth=void 0!==t.minWidth?t.minWidth:this.limits.minWidth,this.limits.maxWidth=void 0!==t.maxWidth?t.maxWidth:this.limits.maxWidth,this.fmtText=this.CalcFromRuntime(this.rtData,this.limits)}SetRenderingEnabled(t){let e=[];if(this.renderingEnabled=t,t&&this.deferredRenderNeeded){for(let t=0;t<this.rtData.styleRuns.length;t++)e.push({pStyle:Oe.CopyObj(this.rtData.styleRuns[t].pStyle)});this.BuildRuntimeRuns(this.rtData,e),this.fmtText=this.CalcFromRuntime(this.rtData,this.limits),this.UpdateSpellCheckFormatting(),this.deferredRenderNeeded=!1}}SetText(t,e,i,o,n){let s="",a=this.DefaultPStyle(),r=[],l=-1,h=-1,c=!1,p="",d="";t=String(t).replace(/(\r\n|\r|\u2028|\u2029)/g,"\n").replace(/([\u0000-\u0008]|[\u000B-\u001F])/g,""),null==i?i=0:(i<0||i>this.rtData.text.length)&&(i=this.rtData.text.length),(null==o||o>this.rtData.text.length-i)&&(o=this.rtData.text.length-i),"number"==typeof e?l=e:!this.rtData.text.length||i>=this.rtData.text.length-1?(l=Math.max(this.rtData.styles.length-1,0),c=!0):o>0?(l=this.GetFormatAtOffset(i).id,h=this.GetFormatAtOffset(i+o).id):(l=this.GetFormatAtOffset(i-1).id,h=this.GetFormatAtOffset(i).id),0===i&&(c=!0),h<0&&(h=l);const u=this.GetTextParagraphCount(t),g=this.GetParagraphAtOffset(i);g>=0&&(a=this.rtData.styleRuns[g].pStyle);for(let y=0;y<u;y++)r.push({pStyle:Oe.CopyObj(a)});if(r=this.MergeParagraphInfo(r,i,o),i===this.rtData.text.length?s=this.rtData.text+t:(i>0&&(p=this.rtData.text.slice(0,i)),i+o<this.rtData.text.length&&(d=this.rtData.text.slice(i+o)),s=p+t+d),n||!1!==this.parent.CallEditCallback("onbeforeinsert",s)){this.rtData.text=s,this.contentVersion++,this.rtData.styles.length||(this.rtData.styles=[new xi]);let n=this.GetFormatByID(l),a=this.GetFormatByID(h);if(n.hyperlink!==a.hyperlink&&(c=!0),(n.dataField||c)&&(n=Oe.CopyObj(n),n.dataField=null,c&&(n.hyperlink=-1),l=this.FindAddStyle(n)),t.length){const n=new Array(t.length).fill(l);this.rtData.charStyles.splice(i,o,...n),e&&"object"==typeof e&&this.SetFormat(e,i,t.length)}else if(o&&(this.rtData.charStyles.splice(i,o),!this.rtData.text.length)){e&&"object"==typeof e&&(e.hyperlink=-1,e.dataField=null,l=this.SetFormat(e,0,0));const t=this.GetFormatByID(l);this.rtData.styles=[Oe.CopyObj(t)]}const p=this.renderingEnabled;this.SetRenderingEnabled(!1),this.BuildRuntimeRuns(this.rtData,r),this.AdjustSpellCheck(t),p&&this.SetRenderingEnabled(!0)}}GetText(t,e){let i="";return this.rtData.text.length&&(null==t?t=0:t>=this.rtData.text.length&&(t=this.rtData.text.length-1),(!e||t+e>this.rtData.text.length)&&(e=this.rtData.text.length-t),i=this.rtData.text.substr(t,e)),i}SetRuntimeText(t,e,i,o){let n="",s="",a="",r=[],l=[];if(t.styles&&t.styles.length){null==e?e=0:(e<0||e>this.rtData.text.length)&&(e=this.rtData.text.length),(null==i||i>this.rtData.text.length-e)&&(i=this.rtData.text.length-e);const h=0===e&&i===this.rtData.text.length;if(e===this.rtData.text.length?n=this.rtData.text+t.text:(e>0&&(s=this.rtData.text.slice(0,e)),e+i<this.rtData.text.length&&(a=this.rtData.text.slice(e+i)),n=s+t.text+a),!1!==this.parent.CallEditCallback("onbeforeinsert",n)){if(this.rtData.text=n,this.contentVersion++,l=this.MergeParagraphInfo(t.paraInfo,e,i),t.hyperlinks.forEach((t=>{this.rtData.hyperlinks.push(String(t)),r.push(this.rtData.hyperlinks.length-1)})),t.styles.forEach((t=>{t.hyperlink>=0&&t.hyperlink<r.length?t.hyperlink=r[t.hyperlink]:t.hyperlink=-1})),t.text.length){let o=Oe.CopyObj(t.charStyles),n=new Array(t.styles.length),s=o.length;for(let e=0;e<s;e++){let i=o[e],s=n[i];void 0===s&&(i<t.styles.length?(s=this.FindAddStyle(t.styles[i]),n[i]=s):(s=0,n[i]=s)),o[e]=s}this.rtData.charStyles.splice(e,i,...o)}else i?this.rtData.charStyles.splice(e,i):this.rtData.styles[0]=Oe.DeepCopy(t.styles[0]);o||(this.parent.vAlign=t.vAlign),!this.parent.internalID&&t.internalID&&(this.parent.internalID=t.internalID),h&&(this.contentVersion=t.contentVersion);const s=this.renderingEnabled;this.SetRenderingEnabled(!1),this.BuildRuntimeRuns(this.rtData,l),this.AdjustSpellCheck(),s&&this.SetRenderingEnabled(!0)}}else this.SetText(t.text,null,e,i)}GetRuntimeText(t,e){let i={text:"",charStyles:[],styles:[],hyperlinks:[],paraInfo:[],vAlign:"",internalID:"",contentVersion:0};null==t?t=0:t>=this.rtData.text.length&&(t=this.rtData.text.length-1),(!e||t+e>this.rtData.text.length)&&(e=this.rtData.text.length-t);const o=t+e,n=this.GetParagraphAtOffset(t),s=this.GetParagraphAtOffset(o);this.rtData.styles.forEach((t=>{i.styles.push(Oe.CopyObj(t))})),i.styles.length||i.styles.push(new xi),this.rtData.hyperlinks.forEach((t=>{i.hyperlinks.push(Oe.CopyObj(t))})),i.text=this.rtData.text.substr(t,e),i.charStyles=this.rtData.charStyles.slice(t,t+e);const a=Math.max(this.GetBulletIndent(),8);for(let r=n;r<=s;r++){let t=Oe.CopyObj(this.rtData.styleRuns[r].pStyle);t.bindent="none"===t.bullet?0:a,i.paraInfo.push({pStyle:t,offset:this.rtData.styleRuns[r].start})}for(let r=0;r<i.styles.length;r++)if(i.styles[r].spError){let t=Oe.CopyObj(i.styles[r]);t.spError=!1;let e=this.FindAddStyle(t,!0);if(e<0)i.styles[r].spError=!1;else for(let o=0;o<i.charStyles.length;o++)i.charStyles[o]===r&&(i.charStyles[o]=e)}return this.TrimUnusedStyles(i),i.vAlign=this.parent.GetVerticalAlignment(),i.internalID=this.parent.internalID,i.contentVersion=this.contentVersion,i}DeleteText(t,e){this.SetText("",null,t,e)}GetTextLength(){return this.rtData.text.length}GetTextFormatSize(){let t=Math.max(this.fmtText.width,this.limits.minWidth);return this.limits.maxWidth&&(t=Math.min(t,this.limits.maxWidth)),{width:t,height:this.fmtText.height}}GetContentVersion(){return this.contentVersion}GetSpellCheckEnabled(){return this.spellCheckEnabled}SpellCheckValid(){return this.spellCheckEnabled&&this.parent.doc.spellChecker&&this.parent.doc.spellChecker.GetActive()&&this.parent.IsActive()}SetSpellCheck(t){this.spellCheckEnabled=t,t||this.UpdateSpellCheckFormatting()}UpdateSpellCheck(t){if(!this.SpellCheckValid())return this.UpdateSpellCheckFormatting(),void this.parent.CallEditCallback("spellcheck");const e=this.GetWordList();this.MergeWordLists(t,e),this.UpdateSpellCheckFormatting(),this.parent.CallEditCallback("spellcheck")}UpdateSpellCheckFormatting(){if(!this.SpellCheckValid())return this.SetFormat({spError:!1}),void(this.wordList=null);const t=this.GetWordList(),e=t.list.length;this.SetFormat({spError:!1},null,null,!0);for(let i=0;i<e;i++){const e=t.list[i].start,o=t.list[i].end;t.list[i].status!==ai.WordState.Wrong||this.IsDataFieldInRange(e,o)||this.SetFormat({spError:!0},e,t.list[i].word.length,!0)}if(this.renderingEnabled){const t=[];for(let e=0;e<this.rtData.styleRuns.length;e++)t.push({pStyle:Oe.CopyObj(this.rtData.styleRuns[e].pStyle)});this.BuildRuntimeRuns(this.rtData,t),this.fmtText=this.CalcFromRuntime(this.rtData,this.limits)}}AdjustSpellCheck(t){let e=t&&1===t.length&&t.search(/[^\u0000-\u2FFF]|[A-Za-z0-9\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u0386-\u04FF\u1E00-\u1FFF]/)>=0,i=!1;if(this.SpellCheckValid()&&this.parent.IsActive()){let t=this.GetWordList();if(!e)for(let e=0;e<t.list.length;e++)if(t.list[e].status===ai.WordState.NotProcessed){i=!0;break}i?this.parent.DoSpellCheck():this.UpdateSpellCheckFormatting()}else this.wordList=null}GetSpellAtPoint(t){let e=null,i=null,o=-1;if(t.y<0||t.y>this.fmtText.height)return-1;for(let n=0;n<this.renderedLines.length;n++)if(t.y>=this.renderedLines[n].top&&t.y<=this.renderedLines[n].bottom){if(t.x<this.renderedLines[n].left||t.x>this.renderedLines[n].right)break;for(let o=0;o<this.renderedLines[n].runs.length;o++)if(t.x<=this.renderedLines[n].runs[o].right){e=this.renderedLines[n],i=this.renderedLines[n].runs[o];break}break}if(e&&i){this.BuildRuntimeCharPos(e,i);let n=i.charPos,s=i.left;o=i.runRec.dispStart;for(let e=0;e<n.length;e++){if(n[e]>t.x){(s+n[e])/2<t.x&&o++;break}s=n[e],o++}let a=this.GetFormatAtOffset(o);a&&a.style&&a.style.spError||(o=-1)}return o}CalcTextFit(t){let e,i={maxWidth:0};return t&&(i.maxWidth=t),e=this.CalcFromRuntime(this.rtData,i),{width:e.dispMinWidth,height:e.height}}CalcTextWrap(t){F.Debug("B.Text.Formatter: CalcTextWrap input:",t);let e={maxWidth:0};t&&(e.maxWidth=t);const i=this.CalcFromRuntime(this.rtData,e);let o,n,s;const a=[];for(o=0;o<i.paragraphs.length;o++){const t=i.paragraphs[o];for(t.lines.length||(s=t.start,a.push(s)),n=0;n<t.lines.length;n++)s=t.lines[n].start,a.push(s)}return F.Debug("B.Text.Formatter: CalcTextWrap output:",a),a}CalcFormatChange(t){F.Debug("B.Text.Formatter: CalcFormatChange input:",t);let e=Oe.CopyObj(this.rtData),i=[];for(let s=0;s<e.styles.length;s++)e.styles[s]=this.MergeStyles(t,e.styles[s]);for(let s=this.fmtText.paragraphs.length-1;s>=0;s--){let t=this.fmtText.paragraphs[s];for(let i=t.lines.length-1;i>0;i--){let o=t.lines[i].start;0!==o&&(e.text=e.text.slice(0,o)+"\n"+e.text.slice(o),e.charStyles.splice(o,0,e.charStyles[o-1]))}}for(let s=0;s<this.rtData.styleRuns.length;s++)i.push({pStyle:Oe.CopyObj(this.rtData.styleRuns[s].pStyle)});this.BuildRuntimeRuns(e,i);let o=this.CalcFromRuntime(e,{maxWidth:32e3}),n={width:o.width,height:o.height};return F.Debug("B.Text.Formatter: CalcFormatChange output:",n),n}GetHitInfo(t){F.Debug("B.Text.Formatter: GetHitInfo input:",t);let e=t.x,i=t.y,o=-1,n=-1,s={index:0,rLine:0,rRun:0,pRun:0,fPara:0,fLine:0,fRun:0,inDataField:!1,dataFieldInfo:null};if(i<0)return F.Debug("B.Text.Formatter: GetHitInfo output:",s),s;if(i>this.fmtText.height)return s.index=this.fmtText.text.length,s.rLine=this.renderedLines.length,s.fPara=this.fmtText.paragraphs.length,F.Debug("B.Text.Formatter: GetHitInfo output:",s),s;for(let d=0;d<this.renderedLines.length;d++)if(i>=this.renderedLines[d].top&&i<=this.renderedLines[d].bottom){o=d,n=-1;let t=this.renderedLines[d].runs.length;for(let i=0;i<t;i++)if(e<this.renderedLines[d].runs[i].right){n=i;break}break}if(o<0)return F.Debug("B.Text.Formatter: GetHitInfo output:",s),s;s.rLine=o,s.rRun=n;let a=this.renderedLines[o],r=a.paraIndex,l=a.lineIndex;if(s.fPara=r,s.fLine=l,n<0)return s.pRun=0,s.rRun=0,this.fmtText.paragraphs[r].lines[l].runs.length>0?s.index=this.fmtText.paragraphs[r].lines[l].runs[0].dispStart:s.index=this.fmtText.paragraphs[r].lines[l].start,this.IsDataFieldAtPos(s.index)&&(s.inDataField=!0,s.dataFieldInfo=this.GetDataField(s.index)),F.Debug("B.Text.Formatter: GetHitInfo output:",s),s;let h=a.runs[n];s.fRun=h.runIndex,this.BuildRuntimeCharPos(a,h);let c=h.charPos.length,p=this.fmtText.paragraphs[r].lines[l].runs[h.runIndex];if(e<=h.left)s.index=p.dispStart;else{let t=p.dispStart,i=h.left;for(let o=0;o<c;o++){if(h.charPos[o]>e){(i+h.charPos[o])/2<e&&t++;break}i=h.charPos[o],t++}s.index=t}return F.Debug("B.Text.Formatter: GetHitInfo output:",s),s}GetAdjacentChar(t,e,i,o){F.Debug("B.Text.Formatter: GetAdjacentChar input:",{index:t,line:e,direction:i,event:o});let n,s,a,r,l,h=t,c=e,p=o&&o.ctrlKey,d=!0,u={x:0,y:0},g={index:h,line:c};if("prev"===i||"next"===i)switch(n=this.GetRenderedCharInfo(h,c),n.rLine>=0&&(s=this.renderedLines[n.rLine],s&&s.runs.length&&(r=s.runs[0].runRec.dispStart,l=s.runs[s.runs.length-1].runRec.dispStart+s.runs[s.runs.length-1].runRec.dispLen)),i){case"prev":h>0&&(p?(g.index=Ys.FindPrevNextWord(this.fmtText.text,h,!0),g.index<r&&g.line--):g.index--),d=!1;break;case"next":h<this.fmtText.text.length&&(p?(g.index=Ys.FindPrevNextWord(this.fmtText.text,h,!1),g.index>l&&g.line++):g.index++)}else if("home"===i||"end"===i)if(p)switch(g.line=void 0,i){case"home":g.index=0,d=!1;break;case"end":g.index=this.fmtText.text.length}else{if(n=this.GetRenderedCharInfo(h,c),n.rLine<0)return g;if(g.line=n.rLine,s=this.renderedLines[n.rLine],!s||!s.runs.length)return g;switch(r=s.runs[0].runRec.dispStart,l=s.runs[s.runs.length-1].runRec.dispStart+s.runs[s.runs.length-1].runRec.dispLen,i){case"home":g.index=r,d=!1;break;case"end":g.index=l}}else{if(n=this.GetRenderedCharInfo(h,c),n.rLine<0)return g;switch(r=h,l=h,p&&this.renderedLines[n.rLine]&&this.renderedLines[n.rLine].runs.length&&(s=this.renderedLines[n.rLine],r=s.runs[0].runRec.dispStart,l=s.runs[s.runs.length-1].runRec.dispStart+s.runs[s.runs.length-1].runRec.dispLen),i){case"up":if(n.rLine>0)if(s=this.renderedLines[n.rLine-1],p)r===h?s.runs.length&&(a=s.runs[0].runRec,g.index=a.dispStart,g.line=n.rLine-1):(g.index=r,g.line=n.rLine);else{let t=s.lineRec;u.x=n.left,u.y=t.yOffset+t.height/2;let e=this.GetHitInfo(u);e.index>=0&&(g.index=e.index,g.line=n.rLine-1)}else p&&(g.index=r,g.line=n.rLine);d=!1;break;case"down":if(n.rLine<this.renderedLines.length-1)if(s=this.renderedLines[n.rLine+1],p)s.runs.length&&(a=s.runs[0].runRec,g.index=a.dispStart,g.line=n.rLine+1);else{let t=s.lineRec;u.x=n.left,u.y=t.yOffset+t.height/2;let e=this.GetHitInfo(u);e.index>=0&&(g.index=e.index,g.line=n.rLine+1)}else p&&(g.index=l,g.line=n.rLine)}}if(g.index>0&&g.index<this.fmtText.text.length){let t=this.GetDataField(g.index);if(t){let e=g.index;d?g.index>t.startPos&&(g.index=t.endPos):g.index=t.startPos,e!==g.index&&(n=this.GetRenderedCharInfo(g.index),n.rLine>=0&&(d&&n.rLine>g.line||!d&&n.rLine<g.line)&&(g.line=n.rLine))}}return F.Debug("B.Text.Formatter: GetAdjacentChar output:",g),g}GetRenderedCharInfo(t,e){let i,o,n,s;F.Debug("B.Text.Formatter: GetRenderedCharInfo input:",{charIndex:t,lineIndex:e});const a=this.GetTextFormatSize(),r={rLine:-1,rRun:-1,rChar:-1,left:0,right:0,top:0,bottom:0};if(t<0){if(void 0===e)return r;r.rLine=e,o=(i=this.renderedLines[e]).lineRec}else for(let l=0;l<this.renderedLines.length&&(r.rLine=l,o=(i=this.renderedLines[l]).lineRec,!(t<o.start+o.length));l++);if(r.rLine<0)return r;if(r.rLine>0&&t>=0&&t<i.dispStart&&(r.rLine--,o=(i=this.renderedLines[r.rLine]).lineRec),(void 0===e||e<0)&&(e=-2),t===o.start&&e===r.rLine-1&&(r.rLine=e,o=(i=this.renderedLines[r.rLine]).lineRec),r.top=Math.max(0,Math.min(a.height,i.top)),r.bottom=Math.max(0,Math.min(a.height,i.bottom)),t<0)return r.left=Math.max(0,Math.min(a.width,i.left)),r.right=Math.max(0,Math.min(a.width,i.right)),F.Debug("B.Text.Formatter: GetRenderedCharInfo output:",r),r;for(let l=0;l<i.runs.length&&(r.rRun=l,n=(s=i.runs[l]).runRec,!(t<n.start+n.length));l++);return r.rRun<0?(r.left=i.left,r.right=i.left):t>=o.start+o.length?(r.left=i.right,r.right=i.right,r.rChar=o.length):(this.BuildRuntimeCharPos(i,s),r.rChar=t-n.dispStart,r.rChar<0?(r.rChar=-1,r.left=s.left,r.right=s.left):r.rChar>=s.charPos.length?(r.rChar=s.charPos.length,r.rChar>0?(r.left=s.charPos[r.rChar-1],r.right=r.left):(r.left=s.right,r.right=s.right)):(r.left=s.left,r.right=s.charPos[r.rChar],r.rChar>0&&(r.left=s.charPos[r.rChar-1]))),r.left=Math.max(0,Math.min(a.width,r.left)),r.right=Math.max(0,Math.min(a.width,r.right)),F.Debug("B.Text.Formatter: GetRenderedCharInfo output:",r),r}GetRenderedRange(t,e){F.Debug("B.Text.Formatter: GetRenderedRange input:",{startIndex:t,endIndex:e});let i=[];if(t>e||t<0||e<0)return i;let o=this.GetRenderedCharInfo(t),n=this.GetRenderedCharInfo(e);if(o.rLine===n.rLine)i.push({left:o.left,top:o.top,right:n.left,bottom:n.bottom});else for(let s=o.rLine;s<=n.rLine;s++){let t=this.GetRenderedCharInfo(-1,s),e={left:t.left,top:t.top,right:t.right,bottom:t.bottom};s===o.rLine?e.left=o.left:s===n.rLine&&(e.right=n.left),i.push(e)}for(let s=0;s<i.length;s++)i[s].left<0&&(i[s].left=0),i[s].right<i[s].left&&(i[s].right=i[s].left),this.limits.maxWidth&&i[s].right>this.limits.maxWidth&&(i[s].right=this.limits.maxWidth);return F.Debug("B.Text.Formatter: GetRenderedRange output:",i),i}BuildRuntimeCharPos(t,e){F.Debug("B.Text.Formatter: BuildRuntimeCharPos input:",{line:t,run:e});let i=[],o=e.left;const n=e.elem?e.elem.node:null,s=e.runRec;e.isTab&&t.pStyle.tabspace&&(o-=o%t.pStyle.tabspace);for(let a=0;n&&a<s.dispLen;a++)e.isTab?o+=t.pStyle.tabspace:o=e.left+Ys.GetRunPositionForChar(n,a,!1,e.cache,e.left),i.push(o);for(let a=s.length-(s.dispStart-s.start),r=i.length;r<a;r++){const n=s.dispStart+r;if(e.isTab)o+=t.pStyle.tabspace;else{if(" "!==this.fmtText.text[n])break;o+=s.space}i.push(o)}e.charPos=i,F.Debug("B.Text.Formatter: BuildRuntimeCharPos output:",e.charPos)}GetWordAtIndex(t){F.Debug("B.Text.Formatter: GetWordAtIndex input:",t);let e=this.GetWordList(),i={start:t,end:t};for(let o=0;o<e.list.length;o++)if(t>=e.list[o].start&&t<e.list[o].end){i.start=e.list[o].start,i.end=e.list[o].end;break}return F.Debug("B.Text.Formatter: GetWordAtIndex output:",i),i}GetWordList(){let t;return F.Debug("B.Text.Formatter: GetWordList input"),this.wordList&&this.wordList.sessionID===this.GetContentVersion()?(F.Debug("B.Text.Formatter: GetWordList output:",this.wordList),this.wordList):(t=this.wordList,this.wordList=this.BuildWordList(),t&&this.MergeWordLists(t,this.wordList),F.Debug("B.Text.Formatter: GetWordList output:",this.wordList),this.wordList)}MergeWordLists(t,e){F.Debug("B.Text.Formatter: MergeWordLists input:",{newWordList:t,currentWordList:e});for(let i=0;i<t.list.length;i++){const o=t.list[i];for(let t=0;t<e.list.length;t++){const i=e.list[t];if(i.word===o.word){i.status=o.status,i.auto=o.auto,i.needSuggest=o.needSuggest,i.suggestions=o.suggestions;break}}}F.Debug("B.Text.Formatter: MergeWordLists output:",e)}BuildWordList(){let t;F.Debug("B.Text.Formatter: BuildWordList input");const e={textID:this.parent.GetInternalID(),sessionID:this.GetContentVersion(),list:[]},i=/(([^\u0000-\u2FFF]|[A-Za-z0-9\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u0386-\u04FF\u1E00-\u1FFF])+)(([\u0027\u0060\u2018\u2019\u2032](([^\u0000-\u2FFF]|[A-Za-z0-9\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u0386-\u04FF\u1E00-\u1FFF])+))*)/g;for(;null!==(t=i.exec(this.rtData.text));){const i=t[0].replace(/[\u0027\u0060\u2018\u2019\u2032]/g,"'");e.list.push({word:i,start:t.index,end:t.index+t[0].length,status:ai.WordState.NotProcessed,auto:!1,needSuggest:!0,suggestions:null})}return F.Debug("B.Text.Formatter: BuildWordList output:",e),e}SetFormat(t,e,i,o){F.Debug("B.Text.Formatter: SetFormat input:",{format:t,start:e,length:i,skipCallback:o});let n=-1,s=!1;if(0===t.size)return-1;if(null==e?e=0:e>=this.rtData.text.length&&(e=this.rtData.text.length-1),(null==i||e+i>this.rtData.text.length)&&(i=this.rtData.text.length-e),t.font&&!t.type&&(t.type=this.parent.doc.GetFontType(t.font)),i<=0){if(n=this.SetRuntimeCharFormat(e,t,!1),0===this.rtData.text.length){const t=this.rtData.styles[n];this.rtData.styles=[t],n=0}return F.Debug("B.Text.Formatter: SetFormat output:",n),n}for(let r=0;r<i;r++){const i=r+e;this.rtData.charStyles[i]!==this.SetRuntimeCharFormat(i,t,!0)&&(s=!0)}if(o||!s)return F.Debug("B.Text.Formatter: SetFormat output: No format change"),-1;n=this.rtData.styles.length-1;for(let r=0;r<this.rtData.charStyles.length;r++)if(0===r)n=this.rtData.charStyles[r];else if(this.rtData.charStyles[r]!==n){n=-1;break}if(n>=0){const t=this.rtData.styles[n];this.rtData.styles=[t];for(let e=0;e<this.rtData.charStyles.length;e++)this.rtData.charStyles[e]=0}const a=[];return this.rtData.styleRuns.forEach((t=>{a.push({pStyle:t.pStyle})})),this.BuildRuntimeRuns(this.rtData,a),this.fmtText=this.CalcFromRuntime(this.rtData,this.limits),this.parent.CallEditCallback("select"),F.Debug("B.Text.Formatter: SetFormat output:",-1),-1}GetFormatAtOffset(t,e){F.Debug("B.Text.Formatter: GetFormatAtOffset input:",{offset:t,runtimeData:e});let i=0,o=new xi;t>=(e=e||this.rtData).charStyles.length&&(t=e.charStyles.length-1),t<0&&(t=0),t<e.charStyles.length?(i=e.charStyles[t],i<e.styles.length&&(o=e.styles[i])):e.styles.length>0&&(i=e.styles.length-1,o=e.styles[i]);const n={id:i,style:o};return F.Debug("B.Text.Formatter: GetFormatAtOffset output:",n),n}GetFormatByID(t){F.Debug("B.Text.Formatter: GetFormatByID input:",t);let e=new xi;return t>=0&&t<this.rtData.styles.length&&(e=this.rtData.styles[t]),F.Debug("B.Text.Formatter: GetFormatByID output:",e),e}SetParagraphStyle(t,e,i){let o,n;if(F.Debug("B.Text.Formatter: SetParagraphStyle input:",{paragraphStyle:t,startOffset:e,length:i}),null==e?e=0:e>this.rtData.text.length&&(e=this.rtData.text.length),(null==i||e+i>this.rtData.text.length)&&(i=this.rtData.text.length-e),o=this.GetParagraphAtOffset(e),n=this.GetParagraphAtOffset(e+i),o>=0){t.bullet&&"none"!==t.bullet&&(t.lindent=0,t.pindent=0);for(let e=o;e<=n;e++)void 0!==t.just&&(this.rtData.styleRuns[e].pStyle.just=t.just),void 0!==t.bullet&&(this.rtData.styleRuns[e].pStyle.bullet=t.bullet),void 0!==t.spacing&&(this.rtData.styleRuns[e].pStyle.spacing=Number(t.spacing)),void 0!==t.pindent&&(this.rtData.styleRuns[e].pStyle.pindent=Number(t.pindent)),void 0!==t.lindent&&(this.rtData.styleRuns[e].pStyle.lindent=Number(t.lindent)),void 0!==t.rindent&&(this.rtData.styleRuns[e].pStyle.rindent=Number(t.rindent)),void 0!==t.tabspace&&(this.rtData.styleRuns[e].pStyle.tabspace=Number(t.tabspace));this.fmtText=this.CalcFromRuntime(this.rtData,this.limits)}F.Debug("B.Text.Formatter: SetParagraphStyle output:",this.fmtText)}GetParagraphStyle(t){F.Debug("B.Text.Formatter: GetParagraphStyle input:",t);let e=this.DefaultPStyle();const i=this.GetParagraphAtOffset(t);return i>=0&&(e=Oe.CopyObj(this.rtData.styleRuns[i].pStyle)),F.Debug("B.Text.Formatter: GetParagraphStyle output:",e),e}GetParagraphAtOffset(t){F.Debug("B.Text.Formatter: GetParagraphAtOffset input:",t);for(let i=0;i<this.rtData.styleRuns.length;i++)if(t<this.rtData.styleRuns[i].start+this.rtData.styleRuns[i].nChars)return F.Debug("B.Text.Formatter: GetParagraphAtOffset output:",i),i;const e=this.rtData.styleRuns.length-1;return F.Debug("B.Text.Formatter: GetParagraphAtOffset output:",e),e}GetParagraphCount(){F.Debug("B.Text.Formatter: GetParagraphCount input");const t=this.rtData.styleRuns.length;return F.Debug("B.Text.Formatter: GetParagraphCount output:",t),t}GetParagraphPosition(t){F.Debug("B.Text.Formatter: GetParagraphPosition input:",t);const e=t<this.rtData.styleRuns.length?this.rtData.styleRuns[t].start:-1;return F.Debug("B.Text.Formatter: GetParagraphPosition output:",e),e}GetCommonFormatForRange(t,e){F.Debug("B.Text.Formatter: GetCommonFormatForRange input:",{startIndex:t,length:e});let i,o,n={};if((void 0===t||t<0)&&(t=0),(void 0===e||e<0||e>this.rtData.charStyles.length-t)&&(e=Math.max(this.rtData.charStyles.length-t,0)),!e||t>=this.rtData.charStyles.length)n=Oe.CopyObj(this.GetFormatAtOffset(t-1).style);else{i=this.rtData.charStyles[t],i>=0&&i<this.rtData.styles.length&&(n=Oe.CopyObj(this.rtData.styles[i]));for(let s=1;s<e;s++)o=this.rtData.charStyles[t+s],o!==i&&(i=o,n=this.AndStyles(n,this.rtData.styles[o]))}return F.Debug("B.Text.Formatter: GetCommonFormatForRange output:",n),n}GetFormatRangeAtIndex(t,e){F.Debug("B.Text.Formatter: GetFormatRangeAtIndex input:",{format:t,index:e});let i=e,o=e,n=-1;const s=this.rtData.charStyles.length;if(!this.IsFormatAtIndex(t,e))return F.Debug("B.Text.Formatter: GetFormatRangeAtIndex output:",{start:-1,end:-1}),{start:-1,end:-1};for(let r=e-1;r>=0;r--){const e=this.rtData.charStyles[r];if(e!==n&&!this.IsFormatAtIndex(t,r))break;i=r,n=e}n=-1;for(let r=e+1;r<s;r++){const e=this.rtData.charStyles[r];if(e!==n&&!this.IsFormatAtIndex(t,r))break;o=r,n=e}const a={start:i,end:o};return F.Debug("B.Text.Formatter: GetFormatRangeAtIndex output:",a),a}IsFormatAtIndex(t,e){F.Debug("B.Text.Formatter: IsFormatAtIndex input:",{format:t,index:e});const i=this.GetFormatAtOffset(e),o=this.MatchPartialStyles(i.style,t);return F.Debug("B.Text.Formatter: IsFormatAtIndex output:",o),o}GetFormatTextMinDimensions(){F.Debug("B.Text.Formatter: GetFormatTextMinDimensions input");const t={width:this.fmtText.width,height:this.fmtText.height};return F.Debug("B.Text.Formatter: GetFormatTextMinDimensions output:",t),t}SetHyperlink(t,e,i){F.Debug("B.Text.Formatter: SetHyperlink input:",{url:t,startOffset:e,length:i});let o,n,s,a,r=!1;null==e?e=0:e>=this.rtData.text.length&&(e=this.rtData.text.length-1),a=null==i||e+i>this.rtData.text.length?this.rtData.text.length:e+i,s=this.GetHyperlinkAtOffset(e),s&&(n=this.GetFormatRangeAtIndex({hyperlink:s.id},e),e=n.start,n.end>=a&&(a=n.end+1,r=!0)),a>e+1&&!r&&(s=this.GetHyperlinkAtOffset(a-1),s&&(n=this.GetFormatRangeAtIndex({hyperlink:s.id},a-1),a=n.end+1)),e==a&&(o=this.GetWordAtIndex(e),e=o.start,a=o.end),e==a&&a++;for(let h=e;h<a;h++){let t=this.GetFormatAtOffset(h).style;t.hyperlink>=0&&this.RemoveHyperlink(t.hyperlink)}let l=this.rtData.hyperlinks.length;this.rtData.hyperlinks.push(t),i=a-e,this.SetFormat({hyperlink:l},e,i),F.Debug("B.Text.Formatter: SetHyperlink output:",{url:t,startOffset:e,length:i})}GetHyperlinkAtOffset(t){F.Debug("B.Text.Formatter: GetHyperlinkAtOffset input:",t);const e=this.GetFormatAtOffset(t).style;let i=null;return void 0!==e.hyperlink&&e.hyperlink>=0&&e.hyperlink<this.rtData.hyperlinks.length&&(i={url:this.rtData.hyperlinks[e.hyperlink],id:e.hyperlink}),F.Debug("B.Text.Formatter: GetHyperlinkAtOffset output:",i),i}GetHyperlinkAtPoint(t){F.Debug("B.Text.Formatter: GetHyperlinkAtPoint input:",t);let e,i,o=-1;if(t.y<0||t.y>this.fmtText.height)return F.Debug("B.Text.Formatter: GetHyperlinkAtPoint output:",null),null;for(e=0;e<this.renderedLines.length;e++)if(t.y>=this.renderedLines[e].top&&t.y<=this.renderedLines[e].bottom){if(t.x<this.renderedLines[e].left||t.x>this.renderedLines[e].right)break;for(i=0;i<this.renderedLines[e].runs.length;i++)if(t.x<=this.renderedLines[e].runs[i].right){o=this.renderedLines[e].runs[i].runRec.style;break}break}let n=null;if(o>=0){const t=this.fmtText.styles[o].hyperlink;void 0!==t&&t>=0&&t<this.rtData.hyperlinks.length&&(n={url:this.rtData.hyperlinks[t],id:t})}return F.Debug("B.Text.Formatter: GetHyperlinkAtPoint output:",n),n}ClearHyperlink(t){F.Debug("B.Text.Formatter: ClearHyperlink input:",t);const e=this.GetHyperlinkAtOffset(t);e&&(this.RemoveHyperlink(e.id),this.fmtText=this.CalcFromRuntime(this.rtData,this.limits)),F.Debug("B.Text.Formatter: ClearHyperlink output:",this.fmtText)}RemoveHyperlink(t){if(F.Debug("B.Text.Formatter: RemoveHyperlink input:",t),t>=0&&t<this.rtData.hyperlinks.length){this.rtData.hyperlinks.splice(t,1);for(let e=0;e<this.rtData.styles.length;e++)this.rtData.styles[e].hyperlink===t?this.rtData.styles[e].hyperlink=-1:this.rtData.styles[e].hyperlink>t&&this.rtData.styles[e].hyperlink--}F.Debug("B.Text.Formatter: RemoveHyperlink output:",this.rtData.hyperlinks)}SetHyperlinkCursor(){let t,e,i,o;for(F.Debug("B.Text.Formatter: SetHyperlinkCursor input"),t=0;t<this.renderedLines.length;t++)for(e=0;e<this.renderedLines[t].runs.length;e++)i=this.renderedLines[t].runs[e].runRec.style,this.rtData.styles[i].hyperlink>=0&&(o=this.renderedLines[t].runs[e].elem,o&&o.node.setAttribute("class",ze.CursorType.Pointer));F.Debug("B.Text.Formatter: SetHyperlinkCursor output")}RenderFormattedText(t,e){let i,o,n,s,a,r,l,h,c,p;F.Debug("B.Text.Formatter: RenderFormattedText input:",{textContainer:t,formattingLayer:e});let d,u,g=[],y=[];(d=t.parent)&&(u=t.position(),d.remove(t)),t.clear(),t.attr("xml:space","preserve"),this.renderedLines=[],this.renderedDataFields=[],e.clear(),this.fmtText.paragraphs.forEach(((d,u)=>{r=null,"none"!==d.pStyle.bullet&&d.bindent&&(r={bullet:d.pStyle.bullet,xPos:0,yPos:d.yOffset,indent:d.bindent,height:d.height,ascent:d.height/2,hasText:!1,style:this.GetBulletStyle(u)}),d.lines.forEach(((e,S)=>{switch(n=0,s=e.width+d.bindent,a=this.fmtText.fmtWidth-(e.indent+d.pStyle.rindent),d.pStyle.just){case"center":n=(a-s)/2;break;case"right":n=a-s}n+=e.indent,r&&0===S&&(r.xPos=n,r.yPos=e.yOffset,r.ascent=e.ascent),n+=e.bindent,l={paraIndex:u,lineIndex:S,lineRec:e,left:n,right:n,top:e.yOffset,bottom:e.yOffset+e.height,dispStart:e.start,pStyle:d.pStyle,runs:[]};for(let t=0;t<e.spErrors.length;t++)y.push({x:n+e.spErrors[t].startPos,y:e.yOffset+e.ascent,width:e.spErrors[t].endPos-e.spErrors[t].startPos});for(let t=0;t<e.dataFields.length;t++)this.renderedDataFields.push({x:n+e.dataFields[t].startPos,y:e.yOffset,width:e.dataFields[t].endPos-e.dataFields[t].startPos,height:e.height,fieldID:e.dataFields[t].fieldID});e.runs.forEach(((s,a)=>{r&&(r.hasText=s.width>0),h=null,c=null,i=this.fmtText.styles[s.style],o=this.fmtText.text.substr(s.dispStart,s.dispLen);let d=!1,u=this.parent.dataStyleOverride||{};u._curFieldDecoration=null,u._curFieldStyle=null,s.dispLen>0&&!s.isTab&&(i.dataField&&(u._curFieldStyle=this.parent.GetDataStyle(i.dataField)),h=Ys.CreateTextRunElem(o,i,this.parent.doc,this.parent.linksDisabled,u),h.attr("x",Oe.RoundCoord(n)),h.attr("text-anchor","start"),h.attr("y",Oe.RoundCoord(e.yOffset+e.ascent+s.extraYOffset)),h.attr("textLength",s.dispWidth),this.parent.linksDisabled||(this.AttachHyperlinkToRun(h,i)?d=!0:i.hyperlink=-1),t.add(h),c=this.parent.doc.GetTextRunCache(i,o));("underline"===(u._curFieldDecoration||i.decoration)||d)&&s.extraYOffset<=0&&(p=d?"#0000FF":i.color,g.push({x:n,y:e.yOffset+e.ascent,width:s.width,color:p})),l.runs.length||(l.dispStart=s.dispStart),l.runs.push({runIndex:a,runRec:s,left:n,right:n+s.width,isTab:s.isTab,elem:h,cache:c}),n+=s.width})),l.right=n,this.renderedLines.push(l)})),r&&r.hasText&&this.RenderBullet(r,e)}));for(let S=0;S<g.length;S++)this.RenderUnderline(g[S],e);if(this.SpellCheckValid())for(let S=0;S<y.length;S++)this.RenderSpellError(y[S],e);this.parent.IsActive()&&this.RenderDataFieldHilites(e),d&&d.add(t,u),F.Debug("B.Text.Formatter: RenderFormattedText output:",this.renderedLines)}AttachHyperlinkToRun(t,e){if(F.Debug("B.Text.Formatter: AttachHyperlinkToRun input:",{element:t,style:e}),void 0!==e.hyperlink&&e.hyperlink>=0&&e.hyperlink<this.fmtText.hyperlinks.length){const t=this.fmtText.hyperlinks[e.hyperlink];Oe.ResolveHyperlinkForDisplay(t)}return F.Debug("B.Text.Formatter: AttachHyperlinkToRun output:",!1),!1}RenderUnderline(t,e){F.Debug("B.Text.Formatter: RenderUnderline input:",{underline:t,formattingLayer:e});const i=new gi.Path,o=Oe.RoundCoord(t.x),n=Oe.RoundCoord(t.y)+2,s=Oe.RoundCoord(t.width);i.plot(`M${o},${n}h${s}`),i.attr("stroke-width",1),i.attr("stroke",t.color),i.attr("fill","none"),e.add(i),F.Debug("B.Text.Formatter: RenderUnderline output")}RenderSpellError(t,e){F.Debug("B.Text.Formatter: RenderSpellError input:",{spellError:t,formattingLayer:e});const i=new gi.Path;let o=t.x,n=t.y+2,s=1;const a=o+t.width;let r=`M${o},${n+s}`;for(;o<a;)r+=`L${o+=2},${n+=s=-s}`;i.plot(r),i.attr("stroke-width",1),i.attr("stroke-opacity",.7),i.attr("stroke","#FF0000"),i.attr("fill","none"),i.node.setAttribute("no-export","1"),e.add(i),F.Debug("B.Text.Formatter: RenderSpellError output")}RenderDataFieldHilites(t){let e,i,o;if(F.Debug("B.Text.Formatter: RenderDataFieldHilites input:",t),this.renderedDataFields){this.ClearDataFieldHilites(t);for(let n=0;n<this.renderedDataFields.length;n++)e=this.renderedDataFields[n],i=this.parent.GetDataText(e.fieldID,!0),o=new gi.Container(gi.create("rect")),o.move(e.x,e.y),o.size(e.width,e.height),o.attr("fill","#A6F8CD"),o.attr("stroke-width",0),o.attr("fill-opacity",.4),o.attr("pointer-events","fill"),o.node.setAttribute("no-export","1"),we.Basic.Element.SetTooltipOnElement(o,i),t.add(o),e.elem=o}F.Debug("B.Text.Formatter: RenderDataFieldHilites output")}ClearDataFieldHilites(t){if(F.Debug("B.Text.Formatter: ClearDataFieldHilites input:",t),this.renderedDataFields)for(let e=0;e<this.renderedDataFields.length;e++){const i=this.renderedDataFields[e].elem;i&&(t.remove(i),this.renderedDataFields[e].elem=null)}F.Debug("B.Text.Formatter: ClearDataFieldHilites output")}RenderBullet(t,e){F.Debug("B.Text.Formatter: RenderBullet input:",{bulletInfo:t,formattingLayer:e});let i,o,n,s=!1,a=!1;const r=Math.max(4,t.indent/2);switch(n=t.style.color,t.bullet){case"hround":i=this.parent.doc.CreateShape(me.CSType.Oval).SetSize(r,r),a=!0;break;case"sround":i=this.parent.doc.CreateShape(me.CSType.Oval).SetSize(r,r),s=!0;break;case"hsquare":i=this.parent.doc.CreateShape(me.CSType.Rect).SetSize(r,r),a=!0;break;case"ssquare":i=this.parent.doc.CreateShape(me.CSType.Rect).SetSize(r,r),s=!0;break;case"diamond":i=this.parent.doc.CreateShape(me.CSType.Polygon).SetPoints([{x:r/2,y:0},{x:r,y:r/2},{x:r/2,y:r},{x:0,y:r/2}]),s=!0;break;case"chevron":i=this.parent.doc.CreateShape(me.CSType.Polygon).SetPoints([{x:0,y:0},{x:r,y:r/2},{x:0,y:r},{x:r/2,y:r/2}]),s=!0;break;case"check":i=this.parent.doc.CreateShape(me.CSType.Polyline).SetPoints([{x:0,y:r-r/4},{x:r/4,y:r},{x:r,y:0}]),a=!0;break;case"plus":o=this.parent.doc.CreateShape(me.CSType.Path).PathCreator(),o.MoveTo(0,r/2).LineTo(r,r/2),o.MoveTo(r/2,0).LineTo(r/2,r),o.Apply(),i=o,a=!0}if(i){const o=(t.indent-r)/2,l=r<t.ascent?t.ascent-r:r<t.height?0:(t.height-r)/2;i.SetPos(t.xPos+o,t.yPos+l),s?i.SetFillColor(n):i.SetFillColor("none"),a?i.SetStrokeColor(n).SetStrokeWidth(1):i.SetStrokeColor("none").SetStrokeWidth(0),e.add(i.svgObj)}F.Debug("B.Text.Formatter: RenderBullet output")}SetRuntimeCharFormat(t,e,i){F.Debug("B.Text.Formatter: SetRuntimeCharFormat input:",{charIndex:t,format:e,apply:i});let o=this.GetFormatAtOffset(t).style,n=this.MergeStyles(e,o),s=this.FindAddStyle(n);return i&&(this.rtData.charStyles[t]=s),F.Debug("B.Text.Formatter: SetRuntimeCharFormat output:",s),s}CalcFromRuntime(t,e){F.Debug("B.Text.Formatter: CalcFromRuntime input:",{runtimeData:t,limits:e});let i=new Ws,o=e?e.maxWidth:0,n=e?e.minWidth:0,s=0,a=null;if(i.text=String(t.text),t.styles.forEach((t=>{i.styles.push(t)})),i.hyperlinks=Oe.CopyObj(t.hyperlinks),o||(o=32e3),i.fmtWidth=n,this.renderingEnabled){let e=Math.max(this.GetBulletIndent(),8);i.width=0,i.dispMinWidth=0,t.styleRuns.forEach(((n,r)=>{let l={pStyle:Oe.CopyObj(n.pStyle),width:0,height:0,start:n.start,length:n.nChars,bindent:0,yOffset:s,dispMinWidth:0,lines:[]},h=0;l.pStyle.bullet&&"none"!==l.pStyle.bullet&&(h=e);let c=h/2+2;l.bindent=h,a||(a=new gi.Container(gi.create("text")),a.attr("xml:space","preserve"),a.attr("fill-opacity",0),this.parent.doc.GetFormattingLayer().svgObj.add(a));let p,d=this.CalcParagraphRunMetrics(t,n,a,this.parent.doc.GetFormattingLayer()),u=null;do{let e=l.lines.length?l.pStyle.lindent:l.pStyle.pindent;h&&(e=0);let i=o-(h+l.pStyle.rindent+e);if(p=this.BuildLineForDisplay(d,i,u,l.pStyle),p.runs.length){let i={width:0,height:0,start:n.start,length:0,bindent:l.bindent,indent:e,yOffset:s,ascent:0,descent:0,dispMinWidth:0,runs:[],spErrors:[],dataFields:[]};if(e+=h,l.lines.length&&(i.start=p.runs[0].start),p.runs.forEach((e=>{let o=e.source;delete e.source,i.runs.push(e),t.spErrors&&o&&e.extraYOffset<=0&&!e.isTab&&t.spErrors.forEach((t=>{let n=t.startIndex,s=t.startIndex+t.nChars-1;if(n<e.dispStart+e.dispLen&&s>=e.dispStart){let t={startIndex:Math.max(n,e.dispStart),endIndex:Math.min(s,e.dispStart+e.dispLen-1),startPos:0,endPos:0},a=t.startIndex-e.start+o.startRunChar;t.startPos=i.width+Ys.GetRunPositionForChar(o.runElem.node,a,!0,o.cache);let r=t.endIndex-e.start+o.startRunChar;t.endPos=i.width+Ys.GetRunPositionForChar(o.runElem.node,r,!1,o.cache),i.spErrors.push(t)}})),t.dataFields&&o&&!e.isTab&&t.dataFields.forEach((t=>{let n=t.startIndex,s=t.startIndex+t.nChars-1;if(n<e.dispStart+e.dispLen&&s>=e.dispStart){let a={fieldID:t.fieldID,startIndex:Math.max(n,e.dispStart),endIndex:Math.min(s,e.dispStart+e.dispLen-1),startPos:0,endPos:0},r=a.startIndex-e.start+o.startRunChar;a.startPos=i.width+Ys.GetRunPositionForChar(o.runElem.node,r,!0,o.cache);let l=a.endIndex-e.start+o.startRunChar;a.endPos=i.width+Ys.GetRunPositionForChar(o.runElem.node,l,!1,o.cache),i.dataFields.push(a)}})),i.descent=Math.max(i.descent,e.descent),i.ascent=Math.max(i.ascent,e.ascent),i.length+=e.length,i.width+=e.width,i.dispMinWidth+=e.dispMinWidth})),i.height=i.ascent+i.descent,r<t.styleRuns.length-1||p.nextRunInfo&&p.runs.length)if(l.pStyle.spacing<0){let t=-l.pStyle.spacing-i.height;t>0&&(i.height+=t)}else i.height+=i.height*l.pStyle.spacing;l.width=Math.max(l.width,i.width+e),l.dispMinWidth=Math.max(l.dispMinWidth,i.dispMinWidth+e),l.height+=i.height,s+=i.height,l.lines.push(i)}u=p.nextRunInfo}while(u&&p.runs.length);if(this.parent.doc.GetFormattingLayer().svgObj.remove(a),i.height+=l.height,h>0&&l.lines.length&&l.height<c){let t=(c-l.height)/2;l.lines.forEach((e=>{e.yOffset+=t})),s+=c-l.height,i.height+=c-l.height}i.paragraphs.push(l),i.width=Math.max(i.width,l.width),i.dispMinWidth=Math.max(i.dispMinWidth,l.dispMinWidth)})),i.fmtWidth=Math.max(i.fmtWidth,i.width)}else this.deferredRenderNeeded=!0;return F.Debug("B.Text.Formatter: CalcFromRuntime output:",i),i}BuildLineForDisplay(t,e,i,o){F.Debug("B.Text.Formatter: BuildLineForDisplay input:",{paragraphRunMetrics:t,availableWidth:e,nextRunInfo:i,paragraphStyle:o});let n=0,s=0,a=0,r=0,l=!i;i&&(n=i.curRun||0,s=i.curChar||0,a=i.curPos||0,s<t[n].startDispIndex&&(s=t[n].startDispIndex),a<t[n].startDispPos&&(a=t[n].startDispPos),i=null);const h={runs:[],nextRunInfo:null},c={runIndex:-1,startChar:0,endChar:0,startPos:0,endPos:0,isRunEnd:!1,breakRec:null};for(;n<t.length;){const i=t[n],l=Math.max(i.endDispPos-a,0);if(l>e)break;const p={width:Math.min(i.width-a,e),height:i.runRT.metrics.height,start:i.startIndex+s,length:i.nChars-s,dispStart:i.startIndex+s,dispLen:Math.max(i.endDispIndex-s,0),dispWidth:l,dispMinWidth:l,space:i.runRT.metrics.width,ascent:i.runRT.metrics.ascent,descent:i.runRT.metrics.descent,extraYOffset:i.runRT.metrics.extraYOffset,isTab:i.isTab,style:i.runRT.style,source:{runElem:i.runElem,cache:i.cache,startRunChar:s,startRunPos:a}};if(p.isTab&&o.tabspace>0){const t=r-r%o.tabspace;p.width=t+o.tabspace*p.length-r}if(i.hasCR&&p.length++,p.width>0){const t=i.breaks[i.breaks.length-1];t&&t.startIndex>=s&&(c.runIndex=h.runs.length,c.startChar=t.startIndex-s,c.endChar=t.endIndex-s,c.startPos=t.startPos-a,c.endPos=t.endPos-a,c.breakRec=t,c.rtRunIndex=n,c.rtRunPos=a,c.rtRunChar=s,c.isRunEnd=t.endIndex===i.nChars),h.runs.push(p)}e-=p.width,r+=p.width,n++,a=0,s=0}if(n<t.length){if(i={curRun:n,curChar:s,curPos:a},e>0){const o=t[n];let r=null;for(let t=o.breaks.length-1;t>=0;t--){const n=o.breaks[t];if(n.startPos-a<=e){i.curChar=n.endIndex,i.curPos=n.endPos,r={width:Math.min(i.curPos-a,e),height:o.runRT.metrics.height,start:o.startIndex+s,length:i.curChar-s,dispStart:o.startIndex+s,dispLen:n.startIndex-s,dispWidth:n.startPos-a,dispMinWidth:n.startPos-a,space:o.runRT.metrics.width,ascent:o.runRT.metrics.ascent,descent:o.runRT.metrics.descent,extraYOffset:o.runRT.metrics.extraYOffset,isTab:o.isTab,style:o.runRT.style,source:{runElem:o.runElem,cache:o.cache,startRunChar:s,startRunPos:a}},h.runs.push(r);break}}if(!r)if(c.runIndex>=0){if(!c.isRunEnd){for(;h.runs.length>c.runIndex+1;)h.runs.pop();r=h.runs[c.runIndex],r.width=c.endPos,r.length=c.endChar,r.dispLen=c.startChar,r.dispWidth=c.startPos,r.dispMinWidth=c.startPos,i.curRun=c.rtRunIndex,i.curChar=c.endChar+c.rtRunChar,i.curPos=c.endPos+c.rtRunPos}}else{r={width:0,height:o.runRT.metrics.height,start:o.startIndex+s,length:0,dispStart:o.startIndex+s,dispLen:0,dispWidth:0,dispMinWidth:0,space:o.runRT.metrics.width,ascent:o.runRT.metrics.ascent,descent:o.runRT.metrics.descent,extraYOffset:o.runRT.metrics.extraYOffset,isTab:o.isTab,style:o.runRT.style,source:{runElem:o.runElem,cache:o.cache,startRunChar:s,startRunPos:a}};let t=0;for(;s<o.nChars&&t<e;)t=Ys.GetRunPositionForChar(o.runElem.node,s,!1,o.cache)-a,(t<=e||!h.runs.length&&!r.length)&&(r.width=t,r.dispWidth=t,r.dispMinWidth=t,r.length++,r.dispLen++,s++,i.curChar++,i.curPos=a+t);r.length&&h.runs.push(r)}}}else if(t.length>0&&!h.runs.length&&l){const e=t[0],i={width:0,height:e.runRT.metrics.height,start:e.startIndex,length:0,dispStart:e.startIndex,dispLen:0,dispWidth:0,dispMinWidth:0,space:e.runRT.metrics.width,ascent:e.runRT.metrics.ascent,descent:e.runRT.metrics.descent,extraYOffset:e.runRT.metrics.extraYOffset,isTab:e.isTab,style:e.runRT.style,source:{runElem:e.runElem,cache:e.cache,startRunChar:0,startRunPos:0}};e.hasCR&&i.length++,h.runs.push(i)}return h.nextRunInfo=i,F.Debug("B.Text.Formatter: BuildLineForDisplay output:",h),h}CalcParagraphRunMetrics(t,e,i,o){F.Debug("B.Text.Formatter: CalcParagraphRunMetrics input:",{runtimeData:t,styleRun:e,formattingLayer:i,docFormattingLayer:o});const n=/(\s+)/g,s=/(\t+)/g;let a=[],r=[];for(let l=0;l<e.runs.length;l++){const i=e.runs[l].start,o=e.runs[l].nChars,n=e.runs[l].style;let a,h=[],c=o?t.text.substr(i,o):"";for(;null!==(a=s.exec(c));)h.push({start:a.index,end:a.index+a[0].length,nChars:a[0].length});if(h.length){h[0].start>0&&r.push({start:i,nChars:h[0].start,style:n,metrics:e.runs[l].metrics});for(let t=0;t<h.length;t++)r.push({start:i+h[t].start,nChars:h[t].nChars,style:n,metrics:e.runs[l].metrics,isTab:!0}),h[t].end<o&&(t<h.length-1?r.push({start:i+h[t].end,nChars:h[t+1].start-h[t].end,style:n,metrics:e.runs[l].metrics}):r.push({start:i+h[t].end,nChars:o-h[t].end,style:n,metrics:e.runs[l].metrics}))}else r.push({start:i,nChars:o,style:n,metrics:e.runs[l].metrics})}for(let l=0;l<r.length;l++){const e=r[l].start;let o=r[l].nChars;const s=t.styles[r[l].style],h=o&&"\n"===t.text[e+o-1];h&&o--;let c,p=o?t.text.substr(e,o):"",d=[];for(;null!==(c=n.exec(p));)d.push({startIndex:c.index,endIndex:c.index+c[0].length,startPos:0,endPos:0});let u={startIndex:e,endIndex:e+o,nChars:o,style:s,breaks:d,str:p,startDispIndex:0,endDispIndex:o,width:0,startDispPos:0,endDispPos:0,hasCR:h,runRT:r[l],isTab:r[l].isTab};d.length&&!s.dataField&&(0===d[0].startIndex&&(u.startDispIndex=d[0].endIndex),d[d.length-1].endIndex===o&&(u.endDispIndex=d[d.length-1].startIndex));let g=null,y=null;o&&!u.isTab&&(p+=".",g=Ys.CreateTextRunElem(p,s,this.parent.doc,this.parent.linksDisabled,null),g.attr("x",0),g.attr("text-anchor","start"),g.attr("y",0),i.add(g),y=this.parent.doc.GetTextRunCache(s,p)),u.runElem=g,u.cache=y,a.push(u)}o.svgObj.add(i);for(let l=0;l<a.length;l++){const t=a[l],e=t.runElem;if(e){const i=t.endIndex-t.startIndex-1,o=Ys.GetRunPositionForChar(e.node,i,!1,t.cache);t.width=o,t.endDispPos=o;for(let n=0;n<t.breaks.length;n++){const i=t.breaks[n];if(i.startIndex>0){const o=Ys.GetRunPositionForChar(e.node,i.startIndex,!0,t.cache);i.startPos=o}if(i.endIndex===t.nChars)i.endPos=o;else{const o=Ys.GetRunPositionForChar(e.node,i.endIndex,!0,t.cache);i.endPos=o}0!==n||0!==i.startIndex||t.style.dataField||(t.startDispPos=i.endPos),n!==t.breaks.length-1||i.endIndex!==t.nChars||t.style.dataField||(t.endDispPos=i.startPos)}}}return F.Debug("B.Text.Formatter: CalcParagraphRunMetrics output:",a),a}GetTextParagraphCount(t){F.Debug("B.Text.Formatter: GetTextParagraphCount input:",t);let e=1;const i=t.match(/\n/g);return i&&(e+=i.length),F.Debug("B.Text.Formatter: GetTextParagraphCount output:",e),e}MergeParagraphInfo(t,e,i){F.Debug("B.Text.Formatter: MergeParagraphInfo input:",{paragraphStyles:t,startOffset:e,length:i});let o,n=this.GetParagraphAtOffset(e),s=this.GetParagraphAtOffset(e+i),a=[];n<0&&(n=0,s=0);for(let r=0;r<n;r++)a.push({pStyle:Oe.CopyObj(this.rtData.styleRuns[r].pStyle)});n<this.rtData.styleRuns.length&&(!t.length||e!==this.rtData.styleRuns[n].start||i<this.rtData.styleRuns[n].nChars-1||i<this.rtData.styleRuns[n].nChars&&n===this.rtData.styleRuns.length-1)&&(o={pStyle:Oe.CopyObj(this.rtData.styleRuns[n].pStyle)}),void 0===o&&t.length>0&&(o=t[0]),void 0!==o&&a.push(o);for(let r=1;r<t.length;r++)a.push(t[r]);for(let r=s+1;r<this.rtData.styleRuns.length;r++)a.push({pStyle:Oe.CopyObj(this.rtData.styleRuns[r].pStyle)});return F.Debug("B.Text.Formatter: MergeParagraphInfo output:",a),a}BuildRuntimeRuns(t,e){F.Debug("B.Text.Formatter: BuildRuntimeRuns input:",{runtimeData:t,paragraphStyles:e});let i=[],o=this.DefaultPStyle(),n=t.text.length;i.push(0);for(let s=0;s<n;s++)"\n"===t.text[s]&&i.push(s+1);if(t.styleRuns=[],t.spErrors=[],t.dataFields=[],this.parent.doc)for(let s=0;s<i.length;s++){let a=i[s],r=s<i.length-1?i[s+1]-a:n-a,l=t.styleRuns.length<e.length?t.styleRuns.length:0,h=e[l]?e[l].pStyle:o,c={pStyle:Oe.CopyObj(h),runs:[],start:a,nChars:r};if(this.renderingEnabled)if(r){let e=null,i=null,o=null;for(let n=a;n<a+r;n++){let s=this.GetFormatAtOffset(n,t);if(e&&this.MatchStylesNoSpell(s.style,e.style))c.runs[c.runs.length-1].nChars++;else{let t={style:s.id,start:n,nChars:1,metrics:this.parent.doc.CalcStyleMetrics(s.style)};c.runs.push(t)}e=s,s.style.spError?i?i.nChars++:(i={startIndex:n,nChars:1},t.spErrors.push(i)):i=null,s.style.dataField?o&&o.fieldID===s.style.dataField?o.nChars++:(o={fieldID:s.style.dataField,startIndex:n,nChars:1},t.dataFields.push(o)):o=null}}else{let e=this.GetFormatAtOffset(a,t),i={style:e.id,start:a,nChars:0,metrics:this.parent.doc.CalcStyleMetrics(e.style)};c.runs.push(i)}else this.deferredRenderNeeded=!0;t.styleRuns.push(c)}F.Debug("B.Text.Formatter: BuildRuntimeRuns output:",t.styleRuns)}GetBulletPIndex(){F.Debug("B.Text.Formatter: GetBulletPIndex input");let t=0;if(this.rtData.styleRuns)for(let e=0;e<this.rtData.styleRuns.length;e++){const i=this.rtData.styleRuns[e].pStyle;if(i&&i.bullet&&"none"!==i.bullet){t=e;break}}return F.Debug("B.Text.Formatter: GetBulletPIndex output:",t),t}GetBulletIndent(){F.Debug("B.Text.Formatter: GetBulletIndent input");let t=0;const e=this.GetBulletPIndex();return this.rtData.styleRuns&&e<this.rtData.styleRuns.length&&this.rtData.styleRuns[e].runs&&this.rtData.styleRuns[e].runs.length&&(t=this.rtData.styleRuns[e].runs[0].metrics.ascent),F.Debug("B.Text.Formatter: GetBulletIndent output:",t),t}GetBulletStyle(t){F.Debug("B.Text.Formatter: GetBulletStyle input:",t);let e=new xi;if((void 0===t||t<0||this.rtData.styleRuns&&t>=this.rtData.styleRuns.length)&&(t=this.GetBulletPIndex()),this.rtData.styleRuns&&t<this.rtData.styleRuns.length&&this.rtData.styleRuns[t].runs&&this.rtData.styleRuns[t].runs.length){const i=this.rtData.styleRuns[t].runs[0].style;e=this.rtData.styles[i]}return F.Debug("B.Text.Formatter: GetBulletStyle output:",e),e}FindAddStyle(t,e){F.Debug("B.Text.Formatter: FindAddStyle input:",{style:t,skipAdd:e});let i=-1;const o=this.rtData.styles.length;if(!t)return F.Debug("B.Text.Formatter: FindAddStyle output:",0),0;for(let n=0;n<o;n++)if(this.MatchStyles(t,this.rtData.styles[n])){i=n;break}return i<0&&!e&&(this.rtData.styles.push(t),i=o),F.Debug("B.Text.Formatter: FindAddStyle output:",i),i}TrimUnusedStyles(t){F.Debug("B.Text.Formatter: TrimUnusedStyles input:",t);let e=[],i=[];const o=t.styles.length,n=t.charStyles.length;if(o){e=new Array(o).fill(!1);for(let i=0;i<n;i++)e[t.charStyles[i]]=!0;for(let s=0;s<o;s++)if(e[s]){const e=i.length;i.push(t.styles[s]);for(let i=0;i<n;i++)t.charStyles[i]===s&&(t.charStyles[i]=e)}!i.length&&t.styles.length>0&&i.push(t.styles[t.styles.length-1]),t.styles=i}F.Debug("B.Text.Formatter: TrimUnusedStyles output:",t)}MergeStyles(t,e){F.Debug("B.Text.Formatter: MergeStyles input:",{newStyle:t,baseStyle:e});const i={font:void 0!==t.font?t.font:e.font,type:void 0!==t.type?t.type:e.type,size:void 0!==t.size?t.size:e.size,weight:void 0!==t.weight?t.weight:e.weight,style:void 0!==t.style?t.style:e.style,baseOffset:void 0!==t.baseOffset?t.baseOffset:e.baseOffset,decoration:void 0!==t.decoration?t.decoration:e.decoration,spError:void 0!==t.spError?t.spError:e.spError,color:void 0!==t.color?t.color:e.color,colorTrans:void 0!==t.colorTrans?t.colorTrans:e.colorTrans,dataField:void 0!==t.dataField?t.dataField:e.dataField,hyperlink:void 0!==t.hyperlink?t.hyperlink:e.hyperlink};return F.Debug("B.Text.Formatter: MergeStyles output:",i),i}AndStyles(t,e){F.Debug("B.Text.Formatter: AndStyles input:",{style1:t,style2:e});const i={font:t.font===e.font?t.font:void 0,type:t.type===e.type?t.type:void 0,size:t.size===e.size?t.size:void 0,weight:t.weight===e.weight?t.weight:void 0,style:t.style===e.style?t.style:void 0,baseOffset:t.baseOffset===e.baseOffset?t.baseOffset:void 0,decoration:t.decoration===e.decoration?t.decoration:void 0,spError:t.spError===e.spError?t.spError:void 0,color:t.color===e.color?t.color:void 0,colorTrans:t.colorTrans===e.colorTrans?t.colorTrans:void 0,dataField:t.dataField===e.dataField?t.dataField:void 0,hyperlink:t.hyperlink===e.hyperlink?t.hyperlink:void 0};return F.Debug("B.Text.Formatter: AndStyles output:",i),i}MatchStyles(t,e){F.Debug("B.Text.Formatter: MatchStyles input:",{style1:t,style2:e});const i=t.font===e.font&&t.type===e.type&&t.size===e.size&&t.weight===e.weight&&t.style===e.style&&t.baseOffset===e.baseOffset&&t.decoration===e.decoration&&t.spError===e.spError&&t.color===e.color&&t.colorTrans===e.colorTrans&&t.dataField===e.dataField&&t.hyperlink===e.hyperlink;return F.Debug("B.Text.Formatter: MatchStyles output:",i),i}MatchStylesNoSpell(t,e){F.Debug("B.Text.Formatter: MatchStylesNoSpell input:",{style1:t,style2:e});const i=t.font===e.font&&t.type===e.type&&t.size===e.size&&t.weight===e.weight&&t.style===e.style&&t.baseOffset===e.baseOffset&&t.decoration===e.decoration&&t.color===e.color&&t.colorTrans===e.colorTrans&&t.dataField===e.dataField&&t.hyperlink===e.hyperlink;return F.Debug("B.Text.Formatter: MatchStylesNoSpell output:",i),i}MatchPartialStyles(t,e){F.Debug("B.Text.Formatter: MatchPartialStyles input:",{style1:t,style2:e});const i=!(void 0!==t.font&&void 0!==e.font&&t.font!==e.font||void 0!==t.type&&void 0!==e.type&&t.type!==e.type||void 0!==t.size&&void 0!==e.size&&t.size!==e.size||void 0!==t.weight&&void 0!==e.weight&&t.weight!==e.weight||void 0!==t.style&&void 0!==e.style&&t.style!==e.style||void 0!==t.baseOffset&&void 0!==e.baseOffset&&t.baseOffset!==e.baseOffset||void 0!==t.decoration&&void 0!==e.decoration&&t.decoration!==e.decoration||void 0!==t.spError&&void 0!==e.spError&&t.spError!==e.spError||void 0!==t.color&&void 0!==e.color&&t.color!==e.color||void 0!==t.colorTrans&&void 0!==e.colorTrans&&t.colorTrans!==e.colorTrans||void 0!==t.dataField&&void 0!==e.dataField&&t.dataField!==e.dataField||void 0!==t.hyperlink&&void 0!==e.hyperlink&&t.hyperlink!==e.hyperlink);return F.Debug("B.Text.Formatter: MatchPartialStyles output:",i),i}DefaultPStyle(){return{just:"left",bullet:"none",spacing:0,pindent:0,lindent:0,rindent:0,tabspace:0}}SetDataNameDisplay(t){F.Debug("B.Text.Formatter: SetDataNameDisplay input:",t),this.dataNameEnabled=t,F.Debug("B.Text.Formatter: SetDataNameDisplay output:",this.dataNameEnabled)}GetDataNameDisplay(){F.Debug("B.Text.Formatter: GetDataNameDisplay input");const t=this.dataNameEnabled;return F.Debug("B.Text.Formatter: GetDataNameDisplay output:",t),t}GetDataField(t){if(F.Debug("B.Text.Formatter: GetDataField input:",t),!this.HasDataFields()||!this.IsDataFieldAtPos(t))return F.Debug("B.Text.Formatter: GetDataField output:",null),null;let e=null;for(let i=0;i<this.rtData.dataFields.length;i++){const o=this.rtData.dataFields[i].startIndex,n=o+this.rtData.dataFields[i].nChars;if(t>=o&&t<n){e={fieldID:this.rtData.dataFields[i].fieldID,startPos:o,endPos:n};break}}return F.Debug("B.Text.Formatter: GetDataField output:",e),e}IsDataFieldAtPos(t){F.Debug("B.Text.Formatter: IsDataFieldAtPos input:",t);const e=!!this.GetFormatAtOffset(t).style.dataField;return F.Debug("B.Text.Formatter: IsDataFieldAtPos output:",e),e}IsDataFieldInRange(t,e){if(F.Debug("B.Text.Formatter: IsDataFieldInRange input:",{startIndex:t,endIndex:e}),!this.HasDataFields())return F.Debug("B.Text.Formatter: IsDataFieldInRange output:",!1),!1;for(let i=t;i<=e;i++)if(this.IsDataFieldAtPos(i))return F.Debug("B.Text.Formatter: IsDataFieldInRange output:",!0),!0;return F.Debug("B.Text.Formatter: IsDataFieldInRange output:",!1),!1}HasDataFields(){F.Debug("B.Text.Formatter: HasDataFields input");const t=this.rtData.dataFields&&this.rtData.dataFields.length>0;return F.Debug("B.Text.Formatter: HasDataFields output:",t),t}HasDataField(t){if(F.Debug("B.Text.Formatter: HasDataField input:",t),!this.HasDataFields())return F.Debug("B.Text.Formatter: HasDataField output:",!1),!1;const e=Ys.FormatDataFieldID(t,!1);for(let i=0;i<this.rtData.dataFields.length;i++)if(Ys.FormatDataFieldID(this.rtData.dataFields[i].fieldID,!1)===e)return F.Debug("B.Text.Formatter: HasDataField output:",!0),!0;return F.Debug("B.Text.Formatter: HasDataField output:",!1),!1}ClearDataFieldRun(t){if(F.Debug("B.Text.Formatter: ClearDataFieldRun input:",t),this.HasDataFields())if(t){for(let e=0;e<this.rtData.dataFields.length;e++)if(Ys.FormatDataFieldID(this.rtData.dataFields[e].fieldID,!1)===t){const t=this.rtData.dataFields[e].startIndex,i=this.rtData.dataFields[e].nChars;this.SetFormat({dataField:null},t,i)}}else this.SetFormat({dataField:null});F.Debug("B.Text.Formatter: ClearDataFieldRun output")}RebuildFromData(){if(F.Debug("B.Text.Formatter: RebuildFromData input"),this.HasDataFields()){const t=Oe.CopyObj(this.rtData.dataFields);for(let e=t.length-1;e>=0;e--){const i=t[e].fieldID,o=this.parent.GetDataText(i,this.dataNameEnabled),n=t[e].startIndex,s=t[e].nChars,a=o&&o.length?{dataField:i}:null;this.SetText(o,a,n,s,!0)}}F.Debug("B.Text.Formatter: RebuildFromData output")}RemapDataFields(t){if(F.Debug("B.Text.Formatter: RemapDataFields input:",t),this.HasDataFields()){const e=e=>{const[i,o]=e.split("_");for(let n=0;n<t.length;n++)if(t[n].srcFieldID===i)return`${t[n].dstFieldID}_${o}`;return e};if(this.rtData){for(let t=0;t<this.rtData.styles.length;t++)this.rtData.styles[t].dataField&&(this.rtData.styles[t].dataField=e(this.rtData.styles[t].dataField));for(let t=0;t<this.rtData.dataFields.length;t++)this.rtData.dataFields[t].fieldID&&(this.rtData.dataFields[t].fieldID=e(this.rtData.dataFields[t].fieldID))}if(this.fmtText){for(let t=0;t<this.fmtText.styles.length;t++)this.fmtText.styles[t].dataField&&(this.fmtText.styles[t].dataField=e(this.fmtText.styles[t].dataField));this.fmtText.paragraphs.forEach((t=>{t.lines.forEach((t=>{for(let i=0;i<t.dataFields.length;i++)t.dataFields[i].fieldID&&(t.dataFields[i].fieldID=e(t.dataFields[i].fieldID))}))}))}if(this.renderedDataFields)for(let t=0;t<this.renderedDataFields.length;t++)this.renderedDataFields[t].fieldID&&(this.renderedDataFields[t].fieldID=e(this.renderedDataFields[t].fieldID))}F.Debug("B.Text.Formatter: RemapDataFields output")}static CreateTextRunElem(t,e,i,o,n){F.Debug("B.Text.Formatter: CreateTextRunElem input:",{text:t,style:e,doc:i,linksDisabled:o,fieldStyleOverride:n});let s=1;const a=new gi.Container(gi.create("tspan"));let r=String(t).replace(/\n/g,"");r.length||(r="."),a.node.textContent=r.replace(/ /g,""),a.attr("xml:space","preserve"),a.attr("text-rendering","optimizeSpeed");let l=e.color,h=e.weight,c=e.style,p=e.decoration;const d=e.hyperlink>=0;if(n&&(n.textColor&&(l=n.textColor),n._curFieldStyle)){const t=n._curFieldStyle;for(let e=0;e<t.length;e++)switch(t[e].name){case"color":l=t[e].val;break;case"font-weight":h=t[e].val;break;case"font-style":c=t[e].val;break;case"text-decoration":"underline"===t[e].val?(n._curFieldDecoration=t[e].val,p=null):p=t[e].val}}if(e){"sub"!==e.baseOffset&&"super"!==e.baseOffset||(s=.8);for(const t in e)switch(t){case"font":e.mappedFont||(e.mappedFont=[]),Rt(a.node).css("font-family",e.mappedFont);break;case"size":let i=e[t];isNaN(i)||(i*=s,a.attr("font-size",i));break;case"weight":a.attr("font-weight",h);break;case"style":a.attr("font-style",c);break;case"decoration":p&&a.attr("text-decoration",p);break;case"color":d&&!o||a.attr("fill",l);break;case"colorTrans":a.attr("opacity",e[t])}d&&!o&&a.attr("fill","#0000FF")}return F.Debug("B.Text.Formatter: CreateTextRunElem output:",a),a}static GetRunPositionForChar(t,e,i,o,n){if(F.Debug("B.Text.Formatter: GetRunPositionForChar input:",{element:t,charIndex:e,isStart:i,cache:o,offset:n}),e<0)return-1;let s;if(n=n||0,o&&o.startOffsets&&o.endOffsets&&o.startOffsets.length>e){s=(i?o.startOffsets:o.endOffsets)[e]}if(void 0===s){s=-1;try{if(s=(i?t.getStartPositionOfChar(e):t.getEndPositionOfChar(e)).x-n,o){(i?o.startOffsets:o.endOffsets)[e]=s}}catch(a){throw a}}return F.Debug("B.Text.Formatter: GetRunPositionForChar output:",s),s}static CalcStyleMetrics(t,e){F.Debug("B.Text.Formatter: CalcStyleMetrics input:",{style:t,doc:e});let i=null;const o={height:0,width:0,ascent:0,descent:0,extraYOffset:0};let n=!1,s=!1;const a=new gi.Container(gi.create("text"));a.attr("xml:space","preserve"),a.attr("text-anchor","start");const r=Ys.CreateTextRunElem(" .",t,e,!1,null);a.add(r),a.attr("fill-opacity",0);const l=e.GetFormattingLayer();l.svgObj.add(a);const h=a.node.getExtentOfChar(0);if(l.svgObj.remove(a),o.height=h.height,o.width=h.width,o.ascent=-h.y,o.descent=o.height-o.ascent,o.extraYOffset=0,t&&(n="sub"===t.baseOffset,s="super"===t.baseOffset),n||s){i=Oe.CopyObj(t),i.baseOffset=void 0;const n=e.CalcStyleMetrics(i);if(s){const t=n.ascent/2,e=t+o.ascent+n.descent;e>n.height&&(n.height=e),o.height=n.height,o.ascent=n.height-n.descent,o.descent=n.descent,o.extraYOffset=-t}else{const t=o.ascent/2;n.descent<o.descent+t&&(n.descent=o.descent+t),o.height=n.ascent+n.descent,o.ascent=n.ascent,o.descent=n.descent,o.extraYOffset=t}}return F.Debug("B.Text.Formatter: CalcStyleMetrics output:",o),o}static MakeIDFromStyle(t){F.Debug("B.Text.Formatter: MakeIDFromStyle input:",t);const e=(t.font+"_"+t.size+"_"+t.weight+"_"+t.style+"_"+t.baseOffset).replace(/ /g,"");return F.Debug("B.Text.Formatter: MakeIDFromStyle output:",e),e}static FindPrevNextWord(t,e,i){F.Debug("B.Text.Formatter: FindPrevNextWord input:",{text:t,position:e,isPrevious:i});const o=t.length,n=/[ \f\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,s=/[`~!@#$%\^&?*()_\-+={}\[\]|\\;:'",.<>\/]/,a=/[^\s`~!@#$%\^&?*()_\-+={}\[\]|\\;:'",.<>\/]/,r=t=>n.test(t)?n:s.test(t)?s:a.test(t)?a:null;let l;if(i&&e>0){for(e--;n.test(t[e])&&e>0;)e--;if(l=r(t[e]),l&&e>0)for(;l.test(t[e-1])&&e>0;)e--}else if(e<o){for(l=r(t[e]);l&&l.test(t[e])&&e<o;)e++;for(!l&&e<o&&e++;n.test(t[e])&&e<o;)e++}return F.Debug("B.Text.Formatter: FindPrevNextWord output:",e),e}static FormatDataFieldID(t,e){F.Debug("B.Text.Formatter: FormatDataFieldID input:",{fieldID:t,generateUnique:e});let i=t;const o=i.indexOf("_")>0;return e?o||(i+="_"+si.MakeShortUniqueID()):o&&(i=i.split("_")[0]),F.Debug("B.Text.Formatter: FormatDataFieldID output:",i),i}}class Xs{constructor(t){a(this,"parent"),a(this,"isActive"),a(this,"selStart"),a(this,"selEnd"),a(this,"selAnchor"),a(this,"inActiveSel"),a(this,"activeSelPos"),a(this,"cursorPos"),a(this,"cursorLine"),a(this,"curHit"),a(this,"lastClickTime"),a(this,"inWordSelect"),a(this,"anchorWord"),a(this,"savedCursorState"),a(this,"TableDrag"),a(this,"virtualKeyboardHook"),a(this,"activateInit"),a(this,"lastKeyProcessed"),a(this,"textEntryField"),a(this,"textEntrySelStart"),a(this,"textEntrySelEnd"),a(this,"inputFocusTimer"),this.parent=t,this.isActive=!1,this.selStart=-1,this.selEnd=-1,this.selAnchor=-1,this.inActiveSel=!1,this.activeSelPos=-1,this.cursorPos=-1,this.cursorLine=void 0,this.curHit=null,this.lastClickTime=0,this.inWordSelect=!1,this.anchorWord=null,this.savedCursorState=this.parent.cursorState,this.TableDrag=!1}BeginTableDrag(){this.TableDrag=!0,this.DeactivateCursor(),this.ClearSelection(),this.parent.SetSelectionVisible(!1),this.parent.ClearDataFieldHilites(),this.curHit=null}SetVirtualKeyboardHook(t,e){this.virtualKeyboardHook=t,this.InitTextEntry(e)}Activate(t,e){this.isActive=!0,this.inActiveSel=!1,this.lastClickTime=0,this.selStart=-1,this.selEnd=-1,this.selAnchor=-1,this.parent.decorationAreaElem.attr("pointer-events",me.EventBehavior.None),this.parent.clickAreaElem.attr("pointer-events",me.EventBehavior.HiddenAll),this.parent.CallEditCallback("activate"),this.savedCursorState=this.parent.cursorState,this.parent.cursorState=ze.CursorState.None,this.activateInit=!0,this.lastKeyProcessed=!1,setTimeout((()=>{this.activateInit=!1}),10),this.textEntryField&&this.InitTextEntry(this.textEntryField),t?(t.gesture={center:{clientX:t.clientX,clientY:t.clientY}},this.HandleMouseDown(t),e?this.parent.DoSpellCheck():this.HandleMouseUp(t),this.virtualKeyboardHook&&this.virtualKeyboardHook(this.parent,!0)):(this.SetInsertPos(this.parent.GetTextLength()),this.virtualKeyboardHook&&this.virtualKeyboardHook(this.parent,!0),this.parent.DoSpellCheck()),this.parent.SetCursorState(ze.CursorState.EditLink),this.UpdateTextEntryField(!1),this.parent.RenderDataFieldHilites()}Deactivate(t){this.isActive=!1,this.inActiveSel=!1,this.selStart=-1,this.selEnd=-1,this.selAnchor=-1,this.activateInit=!1,t||(this.parent.DoSpellCheck(),this.parent.UpdateTextObject()),this.parent.clickAreaElem.node.removeAttribute("pointer-events"),this.parent.cursorState===ze.CursorState.EditLink&&this.parent.SetCursorState(this.savedCursorState),this.savedCursorState=this.parent.cursorState,this.DeactivateCursor(),this.ClearSelection(),this.parent.ClearDataFieldHilites(),this.parent.CallEditCallback("deactivate"),this.virtualKeyboardHook&&this.virtualKeyboardHook(this.parent,!1),this.textEntryField&&this.textEntryField.off("input")}IsActive(){return this.isActive}SetSelection(t,e,i,o,n){t>=0&&t===e?this.SetInsertPos(t,{rLine:i}):(this.selStart=t,this.selEnd=e,this.selAnchor=void 0!==o?o:t,this.UpdateSelection()),n||this.UpdateTextEntryField(!0)}ClearSelection(){this.selStart=-1,this.selEnd=-1,this.selAnchor=-1,this.UpdateSelection()}GetSelection(){return{start:this.selStart,end:this.selEnd,line:this.cursorLine,anchor:this.selAnchor}}SetInsertPos(t,e,i){this.selStart=t,this.selEnd=t,this.selAnchor=t,this.UpdateSelection(),this.cursorPos=t,this.cursorLine=e?e.rLine:void 0,this.UpdateCursor(),i||this.UpdateTextEntryField(!0),this.parent.CallEditCallback("select")}UpdateSelection(){let t,e;if(e=new Es,this.DeactivateCursor(),this.selStart<0||this.selEnd<0||this.selStart===this.selEnd)this.parent.HideSelection();else if(t=this.parent.formatter.GetRenderedRange(this.selStart,this.selEnd),t.length){for(let o=0;o<t.length;o++)e.MoveTo(t[o].left,t[o].top),e.LineTo(t[o].right,t[o].top),e.LineTo(t[o].right,t[o].bottom),e.LineTo(t[o].left,t[o].bottom),e.ClosePath();const i=e.ToString();this.parent.ShowSelection(i)}else this.parent.HideSelection()}DeactivateCursor(){this.parent.HideInputCursor(),this.cursorPos=-1,this.cursorLine=void 0}UpdateCursor(){if(this.cursorPos<0)this.DeactivateCursor();else{const t=this.parent.formatter.GetRenderedCharInfo(this.cursorPos,this.cursorLine);this.parent.ShowInputCursor(t.left,t.top,t.bottom)}}HandleMouseDown(t){const e=t&&(t.shiftKey||t.gesture&&t.gesture.srcEvent&&t.gesture.srcEvent.shiftKey),i=Ie.IsRightClick(t),o=Date.now();if(this.activateInit=!1,this.isActive&&!i){const i=t.gesture.center.clientX,n=t.gesture.center.clientY,s=this.parent.doc.ConvertWindowToElemCoords(i,n,this.parent.textElem.node);if(!this.parent.linksDisabled&&(this.parent.cursorState===ze.CursorState.EditLink||this.parent.cursorState===ze.CursorState.LinkOnly)){const t=this.parent.formatter.GetHyperlinkAtPoint(s);if(t)return this.parent.CallEditCallback("hyperlink",t.url),!1}const a=this.parent.formatter.GetHitInfo(s);if(this.DeactivateCursor(),this.parent.activeEditStyle=-1,this.inActiveSel=!0,this.activeSelPos=a.index,this.selStart>=0&&this.selAnchor>=0&&e)return this.HandleMouseMove(t),this.parent.CallEditCallback("click"),!1;if(this.selStart=a.index,this.selEnd=a.index,this.selAnchor=a.index,this.curHit=a,this.lastClickTime+300<o)this.inWordSelect=!1,this.anchorWord=null;else{const t=this.parent.formatter.GetWordAtIndex(a.index);t.end>t.start&&(this.inWordSelect=!0,this.anchorWord=t,this.selStart=t.start,this.selEnd=t.end,this.selAnchor=t.start)}if(this.inWordSelect){let t=this.parent.formatter.GetDataField(this.selStart);t&&(this.selStart=t.startPos,this.selAnchor=t.startPos),t=this.parent.formatter.GetDataField(this.selEnd),t&&(this.selEnd=t.endPos)}else{const t=this.parent.formatter.GetDataField(this.selStart);t&&t.startPos!==this.selStart&&(this.selStart=t.startPos,this.selEnd=t.endPos,this.selAnchor=t.startPos)}return this.lastClickTime=o,this.SetSelection(this.selStart,this.selEnd,void 0,this.selAnchor),this.parent.CallEditCallback("click"),!1}}HandleMouseMove(t){let e,i,o;const n={x:0,y:0};if(this.inActiveSel){this.activateInit=!1;const s=t.gesture.center.clientX,a=t.gesture.center.clientY,r=this.parent.doc.ConvertWindowToElemCoords(s,a,this.parent.textElem.node);n.x=r.x,n.y=r.y;const l=this.parent.textElem.trans.x,h=this.parent.textElem.trans.y;n.x+=l,n.y+=h;const c=this.parent.GetPos();if(n.x<0||n.x>this.parent.geometryBBox.width||n.y<0||n.y>this.parent.geometryBBox.height){const t={x:c.x+n.x,y:c.y+n.y};this.parent.CallEditCallback("dragoutside",t)}return e=this.parent.formatter.GetHitInfo(r),this.curHit=e,this.activeSelPos=Math.max(e.index,0),this.inWordSelect?(i=this.parent.formatter.GetWordAtIndex(this.activeSelPos),this.activeSelPos>=this.anchorWord.start?(this.selStart=this.anchorWord.start,this.selEnd=i.end):(this.selStart=i.start,this.selEnd=this.anchorWord.end)):this.selAnchor<=this.activeSelPos?(this.selStart=this.selAnchor,this.selEnd=this.activeSelPos):(this.selStart=this.activeSelPos,this.selEnd=this.selAnchor),o=this.parent.formatter.GetDataField(this.selStart),o&&(this.selStart=o.startPos),o=this.parent.formatter.GetDataField(this.selEnd),o&&o.startPos!==this.selEnd&&(this.selEnd=o.endPos),this.SetSelection(this.selStart,this.selEnd,void 0,this.selAnchor),!1}}HandleMouseUp(t){if(this.inActiveSel)return this.activateInit=!1,this.TableDrag?(this.TableDrag=!1,this.inActiveSel=!1,this.parent.CallEditCallback("dragoutside_mouseup"),!1):(this.inActiveSel=!1,this.selStart===this.selEnd?(this.SetInsertPos(this.selStart,this.curHit),this.parent.DoSpellCheck()):(this.parent.CallEditCallback("select"),this.parent.CallEditCallback("selectrange")),this.curHit=null,!1)}HandleKeyPress(t){const e=t.charCode?t.charCode:t.keyCode;let i=String.fromCharCode(e);const o=t&&(t.shiftKey||t.gesture&&t.gesture.srcEvent&&t.gesture.srcEvent.shiftKey),n=t&&(t.ctrlKey||t.gesture&&t.gesture.srcEvent&&t.gesture.srcEvent.ctrlKey),s={keyCode:i,shiftKey:o,ctrlKey:n},a=this.activateInit;if(this.activateInit=!1,this.lastKeyProcessed=!1,i!==t.key&&t.key&&1===t.key.length&&(i=t.key),"\t"===i)return this.parent.CallEditCallback("keyend",s),this.lastKeyProcessed=!0,!0;if("\r"===i||"\n"===i){if(s.keyCode=Xe.Keys.Enter,this.parent.CallEditCallback("keyend",s))return this.lastKeyProcessed=!0,!0;if(!a&&n)return this.lastKeyProcessed=!0,this.parent.Paste(i,!1),!0}return!1===this.parent.CallEditCallback("charfilter",i)?(this.lastKeyProcessed=!0,!0):!!a&&(this.lastKeyProcessed=!0,this.parent.Paste(i,!1),!0)}HandleKeyDown(t){const e=t&&(t.shiftKey||t.gesture&&t.gesture.srcEvent&&t.gesture.srcEvent.shiftKey),i=t&&(t.ctrlKey||t.gesture&&t.gesture.srcEvent&&t.gesture.srcEvent.ctrlKey);switch(this.activateInit=!1,this.lastKeyProcessed=!1,t.keyCode){case 8:case 46:this.lastKeyProcessed=!0,this.HandleDeleteKey(t.keyCode);break;case 9:case 35:case 36:case 37:case 38:case 39:case 40:this.lastKeyProcessed=!0,this.HandleCursorKey(t.keyCode,e,i);break;case 13:case 32:return this.HandleKeyPress(t);default:return!1}return!0}HandleDeleteKey(t){const e=this.selStart,i=this.selEnd-this.selStart;e<0||(i>0?this.parent.Delete():46===t?e<this.parent.GetTextLength()&&(this.selEnd=e+1,this.parent.Delete()):8===t&&e>0&&(this.selStart--,this.parent.Delete()))}HandleCursorKey(t,e,i){let o={index:-1,line:void 0},n=-1,s=!1;const a=this.selStart!==this.selEnd,r={keyCode:t,shiftKey:e,ctrlKey:i};switch(e&&!this.inWordSelect?n=this.selAnchor===this.selStart?this.selEnd:this.selStart:(n=this.selEnd,this.selAnchor=this.selStart,this.inWordSelect=!1),t){case Xe.Keys.Tab:o.index=-1;break;case Xe.Keys.End:o=this.parent.formatter.GetAdjacentChar(n,this.cursorLine,"end",r),s=!0;break;case Xe.Keys.Home:o=this.parent.formatter.GetAdjacentChar(n,this.cursorLine,"home",r),s=!0;break;case Xe.Keys.Left_Arrow:a&&!e&&(n=this.selStart),o=!a||e||i?this.parent.formatter.GetAdjacentChar(n,this.cursorLine,"prev",r):{index:n};break;case Xe.Keys.Up_Arrow:a&&!e&&(n=this.selStart),o=this.parent.formatter.GetAdjacentChar(n,this.cursorLine,"up",r);break;case Xe.Keys.Right_Arrow:a&&!e&&(n=this.selEnd),o=!a||e||i?this.parent.formatter.GetAdjacentChar(n,this.cursorLine,"next",r):{index:n};break;case Xe.Keys.Down_Arrow:a&&!e&&(n=this.selEnd),o=this.parent.formatter.GetAdjacentChar(n,this.cursorLine,"down",r);break;default:return}o.index!==n||s||a?(e?(n===this.selStart?this.selStart=o.index:this.selEnd=o.index,this.selStart>this.selEnd&&([this.selStart,this.selEnd]=[this.selEnd,this.selStart])):(this.selStart=o.index,this.selEnd=o.index,this.selAnchor=o.index),this.parent.activeEditStyle=-1,this.SetSelection(this.selStart,this.selEnd,o.line,this.selAnchor),this.parent.CallEditCallback("select"),this.parent.DoSpellCheck()):this.parent.CallEditCallback("keyend",r)}InitTextEntry(t){this.textEntryField=Rt(t),this.textEntrySelStart=0,this.textEntrySelEnd=0,this.textEntryField.off("input"),this.textEntryField.on("input",this,(t=>{const e=t.data;return e&&e.HandleTextEntryFieldUpdate(),!1})),this.ResetTextEntry()}ResetTextEntry(){if(this.isActive&&this.textEntryField&&"hidden"!==this.textEntryField.css("visibility")){if(null==this.inputFocusTimer&&(this.inputFocusTimer=setInterval((()=>{this.ResetTextEntry()}),10)),!this.textEntryField.is(":focus")){const t=document.activeElement;null!=t&&t!==document.body&&t!==window&&t!==document&&t!==Rt("#_clipboardInput")[0]&&t!==Rt("#_IEclipboardDiv")[0]||this.textEntryField.focus()}}else null!=this.inputFocusTimer&&(clearInterval(this.inputFocusTimer),this.inputFocusTimer=void 0)}UpdateTextEntryField(t){if(this.isActive&&this.textEntryField&&void 0!==this.textEntryField[0]){const e=this.textEntryField[0];this.ResetTextEntry(),t||e.value===this.parent.formatter.rtData.text||this.textEntryField.val(this.parent.formatter.rtData.text);const i=e.value.length,o=Math.min(Math.max(this.selStart,0),i),n=Math.min(Math.max(this.selEnd,o),i);e.selectionStart===o&&e.selectionEnd===n||Xs.SetInputSelection(e,o,n),this.textEntrySelStart=o,this.textEntrySelEnd=n}}ValidateEdit(t,e,i){const o=this.selStart,n=this.selEnd-this.selStart;let s="",a="",r="";return o>=e.length?r=e+t:(o>0&&(s=e.slice(0,o)),o+n<e.length&&(a=e.slice(o+n)),r=s+t+a),r===i}HandleTextEntryFieldUpdate(){if(this.isActive&&this.textEntryField)if(this.activateInit=!1,this.lastKeyProcessed)this.UpdateTextEntryField();else{const t=this.textEntryField[0],e=t.value,i=this.parent.formatter.rtData.text;let o=t.selectionStart,n=t.selectionEnd,s="";this.selStart=this.textEntrySelStart,this.selEnd=this.textEntrySelEnd,o=Math.min(o,e.length),n=Math.min(n,e.length),n>0&&(s=n>this.selStart?e.slice(this.selStart,n):e.slice(n-1,n));let a=null;if(this.ValidateEdit(s,i,e)||(a=!1,this.selStart=a.pos,this.selEnd=a.pos+a.replace,s=a.str),s){if(!1===this.parent.CallEditCallback("charfilter",s))return t.value!==this.parent.formatter.rtData.text&&this.textEntryField.val(this.parent.formatter.rtData.text),void(t.selectionStart===this.textEntrySelStart&&t.selectionEnd===this.textEntrySelEnd||Xs.SetInputSelection(t,this.textEntrySelStart,this.textEntrySelEnd));this.parent.Paste(s,!1,!0)}else a&&a.replace&&this.parent.Delete(!0);this.SetSelection(n,n,void 0,n,!0),Xs.SetInputSelection(t,o,n),this.textEntrySelStart=o,this.textEntrySelEnd=n}}static SetInputSelection(t,e,i){t.selectionStart=e,t.selectionEnd=i}}class qs extends Di{constructor(){super(),a(this,"formatter"),a(this,"editor"),a(this,"textElem"),a(this,"selectElem"),a(this,"cursorElem"),a(this,"clickAreaElem"),a(this,"decorationAreaElem"),a(this,"cursorTimer"),a(this,"cursorPos"),a(this,"cursorState"),a(this,"minHeight"),a(this,"vAlign"),a(this,"textElemOffset"),a(this,"activeEditStyle"),a(this,"selectHidden"),a(this,"linksDisabled"),a(this,"editCallback"),a(this,"editCallbackData"),a(this,"dataTableID"),a(this,"dataRecordID"),a(this,"dataStyleOverride"),a(this,"lastFmtSize")}CreateElement(t,e){return this.formatter=new Ys(this),this.editor=new Xs(this),this.svgObj=new gi.Container(gi.create("g")),this.InitElement(t,e),this.textElem=new gi.Container(gi.create("text")),this.selectElem=new gi.Path,this.cursorElem=new gi.Line,this.clickAreaElem=new gi.Rect,this.decorationAreaElem=new gi.Container(gi.create("g")),this.cursorTimer=void 0,this.cursorPos=void 0,this.cursorState=ze.CursorState.LinkOnly,this.clickAreaElem.attr("stroke-width",0),this.clickAreaElem.attr("fill","none"),this.clickAreaElem.attr("visibility","hidden"),this.clickAreaElem.node.setAttribute("no-export","1"),this.selectElem.node.setAttribute("no-export","1"),this.cursorElem.node.setAttribute("no-export","1"),this.svgObj.add(this.clickAreaElem),this.svgObj.add(this.textElem),this.svgObj.add(this.decorationAreaElem),this.minHeight=0,this.vAlign="top",this.textElemOffset=0,this.activeEditStyle=-1,this.selectHidden=!1,this.linksDisabled=!1,this.editCallback=null,this.editCallbackData=null,this.dataTableID=-1,this.dataRecordID=-1,this.dataStyleOverride=null,this.lastFmtSize={width:0,height:0},this.SetText(""),this.svgObj}SetText(t,e,i,o,n){F.Debug("B.Text: SetText input:",{newText:t,formatStyle:e,startPos:i,preserveFormatting:o,updateTextEntry:n});const s=i||0,a=t.length;this.editor.IsActive()&&this.editor.ClearSelection(),!e&&this.activeEditStyle>=0&&(e=this.activeEditStyle),this.activeEditStyle=-1,this.formatter.SetText(t,e,i,o),this.UpdateTextObject(),this.editor.IsActive()&&(n||this.editor.UpdateTextEntryField(!1),this.editor.SetInsertPos(s+a,null,n)),F.Debug("B.Text: SetText output: text updated successfully")}GetText(t,e){F.Debug("B.Text: GetText input:",{startIndex:t,textLength:e});const i=this.formatter.GetText(t,e);return F.Debug("B.Text: GetText output:",i),i}GetTextLength(){F.Debug("B.Text: GetTextLength input: none");const t=this.formatter.GetTextLength();return F.Debug("B.Text: GetTextLength output:",t),t}SetRuntimeText(t,e,i,o,n){F.Debug("B.Text: SetRuntimeText input:",{textData:t,startPos:e,textLength:i,preserveFormatting:o,updateTextEntry:n});const s=e||0,a=t.text.length;this.editor.IsActive()&&this.editor.ClearSelection(),this.activeEditStyle=-1,this.formatter.SetRuntimeText(t,e,i,o),this.UpdateTextObject(),this.editor.IsActive()&&(n||this.editor.UpdateTextEntryField(!1),this.editor.SetInsertPos(s+a,null,n)),F.Debug("B.Text: SetRuntimeText output: text updated successfully")}GetRuntimeText(t,e){F.Debug("B.Text: GetRuntimeText input:",{startIndex:t,textLength:e});const i=this.formatter.GetRuntimeText(t,e);return F.Debug("B.Text: GetRuntimeText output:",i),i}DeleteText(t,e,i){F.Debug("B.Text: DeleteText input:",{startPosition:t,deleteLength:e,updateTextEntry:i}),t=t||0,this.editor.IsActive()&&this.editor.ClearSelection();let o=this.formatter.GetDataField(t);if(o&&(t=o.startPos),e){let i=t+e;o=this.formatter.GetDataField(i),o&&o.startPos!==i&&(i=o.endPos),e=i-t}this.activeEditStyle=-1,this.formatter.DeleteText(t,e),this.UpdateTextObject(),this.editor.IsActive()&&(i||this.editor.UpdateTextEntryField(!1),this.editor.SetInsertPos(t,null,i)),F.Debug("B.Text: DeleteText output:",{deletedCharacters:e,startPosition:t})}Copy(t){F.Debug("B.Text: Copy input:",{useRuntime:t});let e=0,i=0;if(this.editor.IsActive()){const t=this.editor.GetSelection();if(t.start===t.end)return F.Debug("B.Text: Copy output: null (empty selection)"),null;t.start>=0&&t.end>t.start&&(e=t.start,i=t.end-t.start)}const o=t?this.GetRuntimeText(e,i):this.GetText(e,i);return F.Debug("B.Text: Copy output:",o),o}Paste(t,e,i){F.Debug("B.Text: Paste input:",{inputText:t,useRuntime:e,updateTextEntry:i});let o,n=0,s=0;if(this.editor.IsActive()&&(o=this.editor.GetSelection()).start>=0&&(n=o.start,s=o.end-o.start),e)if(this.SetRuntimeText(t,n,s,!0,i),this.dataTableID>0&&this.dataRecordID>0){let t=this.formatter.GetTextLength();this.UpdateFromData();let e=this.formatter.GetTextLength();if(this.editor.IsActive()&&(this.editor.UpdateTextEntryField(!1),t!==e)){const i=this.editor.selStart+(e-t);this.editor.SetInsertPos(i)}}else this.formatter.ClearDataFieldRun(),this.UpdateTextObject();else this.SetText(t,null,n,s,i);this.CallEditCallback("edit"),F.Debug("B.Text: Paste output: finished pasting")}Delete(t){let e,i,o;F.Debug("B.Text: Delete input:",{updateTextEntry:t}),this.editor.IsActive()&&(o=this.editor.GetSelection(),o.start>=0&&(e=o.start,i=o.end-o.start)),this.DeleteText(e,i,t),this.CallEditCallback("edit"),F.Debug("B.Text: Delete output:",{deletedCharacters:i,startPosition:e})}SetSelectedFormat(t){let e,i;if(F.Debug("B.Text: SetSelectedFormat input:",{formatStyle:t}),this.editor.IsActive()){const t=this.editor.GetSelection();t.start>=0&&(e=t.start,i=t.end-t.start)}this.SetFormat(t,e,i),this.CallEditCallback("edit"),F.Debug("B.Text: SetSelectedFormat output: completed")}GetSelectedFormat(){let t,e,i;F.Debug("B.Text: GetSelectedFormat input: none"),this.editor.IsActive()&&(t=this.editor.GetSelection(),t.start>=0&&(e=t.start,i=t.end-t.start));const o=this.GetFormat(e,i);return F.Debug("B.Text: GetSelectedFormat output:",o),o}SetSelectedAlignment(t){F.Debug("B.Text: SetSelectedAlignment input:",{alignment:t});let e=0,i=0;if(this.editor.IsActive()){const t=this.editor.GetSelection();t.start>=0&&(e=t.start,i=t.end-t.start)}this.SetParagraphAlignment(t,e,i),this.CallEditCallback("edit"),F.Debug("B.Text: SetSelectedAlignment output:",{alignment:t,selectionStart:e,selectionLength:i})}GetSelectedAlignment(){F.Debug("B.Text: GetSelectedAlignment called");let t,e=0;this.editor.IsActive()&&(t=this.editor.GetSelection(),t.start>=0&&(e=t.start));const i=this.GetParagraphAlignment(e);return F.Debug("B.Text: GetSelectedAlignment output:",i),i}SetSelectedParagraphStyle(t){let e,i;if(F.Debug("B.Text: SetSelectedParagraphStyle input:",{paragraphStyle:t}),this.editor.IsActive()){const t=this.editor.GetSelection();t.start>=0&&(e=t.start,i=t.end-t.start)}this.SetParagraphStyle(t,e,i),this.CallEditCallback("edit"),F.Debug("B.Text: SetSelectedParagraphStyle output:",{paragraphStyle:t,selectionStart:e,selectionLength:i})}GetSelectedParagraphStyle(){let t;F.Debug("B.Text: GetSelectedParagraphStyle input: none");let e=0;this.editor.IsActive()&&(t=this.editor.GetSelection(),t.start>=0&&(e=t.start));const i=this.GetParagraphStyle(e);return F.Debug("B.Text: GetSelectedParagraphStyle output:",i),i}SetSelectedHyperlink(t){let e;F.Debug("B.Text: SetSelectedHyperlink input:",{hyperlink:t});let i=0,o=this.GetTextLength();this.editor.IsActive()&&(e=this.editor.GetSelection(),e.start>=0&&(i=e.start,o=e.end-e.start)),this.SetHyperlink(t,i,o),this.CallEditCallback("edit"),F.Debug("B.Text: SetSelectedHyperlink output:",{hyperlink:t,startPosition:i,selectionLength:o})}GetSelectedHyperlink(){let t;F.Debug("B.Text: GetSelectedHyperlink input: none");let e=0;this.editor.IsActive()&&(t=this.editor.GetSelection(),t.start>=0&&(e=t.start));const i=this.GetHyperlink(e);return F.Debug("B.Text: GetSelectedHyperlink output:",i),i}DeleteSelectedHyperlink(){F.Debug("B.Text: DeleteSelectedHyperlink input: no parameters; checking editor state");let t,e=0;this.editor.IsActive()&&(t=this.editor.GetSelection(),t.start>=0&&(e=t.start)),this.DeleteHyperlink(e),this.CallEditCallback("edit"),F.Debug("B.Text: DeleteSelectedHyperlink output: Deleted hyperlink at position",e)}SetFormat(t,e,i){F.Debug("B.Text: SetFormat input:",{newFormat:t,selectionStart:e,selectionLength:i});const o=this.formatter.SetFormat(t,e,i);this.activeEditStyle=o,this.UpdateTextObject(),F.Debug("B.Text: SetFormat output:",{activeEditStyle:this.activeEditStyle})}GetFormat(t,e){F.Debug("B.Text: GetFormat input:",{startIndex:t,rangeLength:e});let i,o=this.activeEditStyle;return i=0===e&&o>=0?this.formatter.GetFormatByID(o):this.formatter.GetCommonFormatForRange(t,e),F.Debug("B.Text: GetFormat output:",i),i}SetVerticalAlignment(t){F.Debug("B.Text: SetVerticalAlignment input:",t),this.vAlign=t,this.UpdateTextObject(),F.Debug("B.Text: SetVerticalAlignment output: vAlign updated to",this.vAlign)}GetVerticalAlignment(){F.Debug("B.Text: GetVerticalAlignment input: none");const t=this.vAlign;return F.Debug("B.Text: GetVerticalAlignment output:",t),t}SetParagraphAlignment(t,e,i){F.Debug("B.Text: SetParagraphAlignment input:",{alignment:t,selectionStart:e,selectionLength:i}),this.SetParagraphStyle({just:t},e,i),F.Debug("B.Text: SetParagraphAlignment output: completed",{alignment:t,selectionStart:e,selectionLength:i})}GetParagraphAlignment(t){F.Debug("B.Text: GetParagraphAlignment input:",{paragraphIndex:t});const e=this.GetParagraphStyle(t).just;return F.Debug("B.Text: GetParagraphAlignment output:",e),e}SetParagraphStyle(t,e,i){F.Debug("B.Text: SetParagraphStyle input:",{paragraphStyle:t,startPosition:e,selectionLength:i}),this.formatter.SetParagraphStyle(t,e,i),this.UpdateTextObject(),F.Debug("B.Text: SetParagraphStyle output: completed")}GetParagraphStyle(t){F.Debug("B.Text: GetParagraphStyle input:",{paragraphIndex:t});const e=this.formatter.GetParagraphStyle(t);return F.Debug("B.Text: GetParagraphStyle output:",e),e}GetParagraphCount(){F.Debug("B.Text: GetParagraphCount input: none");const t=this.formatter.GetParagraphCount();return F.Debug("B.Text: GetParagraphCount output:",t),t}GetParagraphPosition(t){F.Debug("B.Text: GetParagraphPosition input:",{paragraphIndex:t});const e=this.formatter.GetParagraphPosition(t);return F.Debug("B.Text: GetParagraphPosition output:",e),e}SetHyperlink(t,e,i){F.Debug("B.Text: SetHyperlink input:",{url:t,startPos:e,selectionLength:i}),t&&t.length?(this.formatter.SetHyperlink(t,e,i),this.UpdateTextObject(),F.Debug("B.Text: SetHyperlink output: hyperlink set successfully")):(this.DeleteHyperlink(e),F.Debug("B.Text: SetHyperlink output: hyperlink deleted"))}GetHyperlink(t){F.Debug("B.Text: GetHyperlink input:",t);const e=this.formatter.GetHyperlinkAtOffset(t),i=e?e.url:null;return F.Debug("B.Text: GetHyperlink output:",i),i}DeleteHyperlink(t){F.Debug("B.Text: DeleteHyperlink input:",{hyperlinkStart:t}),this.formatter.ClearHyperlink(t),this.UpdateTextObject(),F.Debug("B.Text: DeleteHyperlink output: Hyperlink removed at",t)}GetHyperlinkAtLocation(t){F.Debug("B.Text: GetHyperlinkAtLocation input:",t);const e=t.gesture.center.clientX,i=t.gesture.center.clientY+Rt(window).scrollTop(),o=this.doc.ConvertWindowToElemCoords(e,i,this.textElem.node),n=this.formatter.GetHyperlinkAtPoint(o),s=n?n.url:null;return F.Debug("B.Text: GetHyperlinkAtLocation output:",s),s}SetConstraints(t,e,i){F.Debug("B.Text: SetConstraints input:",{maxWidth:t,minWidth:e,minHeight:i}),void 0===t&&void 0===e||this.formatter.SetLimits({maxWidth:t,minWidth:e}),void 0!==i&&(this.minHeight=i),this.UpdateTextObject(),F.Debug("B.Text: SetConstraints output: Constraints updated")}SetEditCallback(t,e){F.Debug("B.Text: SetEditCallback input:",{callback:t,callbackData:e}),this.editCallback=t,this.editCallbackData=e,F.Debug("B.Text: SetEditCallback output: Callback set successfully")}CallEditCallback(t,e){if(F.Debug("B.Text: CallEditCallback input:",{actionType:t,callbackData:e}),this.editCallback){const i=this.editCallback(t,e,this,this.editCallbackData);return F.Debug("B.Text: CallEditCallback output:",i),i}F.Debug("B.Text: CallEditCallback output:","No editCallback defined")}GetTextSize(){F.Debug("B.Text: GetTextSize input: no parameters");let t=this.formatter.GetTextFormatSize();return t.height=Math.max(t.height,this.minHeight),F.Debug("B.Text: GetTextSize output:",t),t}GetTextMinDimensions(){F.Debug("B.Text: GetTextMinDimensions input: none");const t=this.formatter.GetFormatTextMinDimensions();return F.Debug("B.Text: GetTextMinDimensions output:",t),t}SetSize(t,e){F.Debug("B.Text: SetSize input:",{width:t,minHeight:e}),this.SetConstraints(t,t,e),F.Debug("B.Text: SetSize output: constraints set with",{maxWidth:t,minWidth:t,minHeight:e})}CalcTextFit(t){F.Debug("B.Text: CalcTextFit input:",t);const e=this.formatter.CalcTextFit(t);return F.Debug("B.Text: CalcTextFit output:",e),e}CalcTextWrap(t){F.Debug("B.Text: CalcTextWrap input:",t);const e=this.formatter.CalcTextWrap(t);return F.Debug("B.Text: CalcTextWrap output:",e),e}CalcFormatChange(t){F.Debug("B.Text: CalcFormatChange input:",t);const e=this.formatter.CalcFormatChange(t);return F.Debug("B.Text: CalcFormatChange output:",e),e}SetRenderingEnabled(t){F.Debug("B.Text: SetRenderingEnabled input:",{isEnabled:t});const e=this.formatter.deferredRenderNeeded;void 0===t&&(t=!0),this.formatter.renderingEnabled!==t&&(this.formatter.SetRenderingEnabled(t),t&&e&&this.UpdateTextObject()),F.Debug("B.Text: SetRenderingEnabled output: rendering enabled set to",t)}IsRenderingEnabled(t){F.Debug("B.Text: IsRenderingEnabled input:",{renderingFlag:t});const e=this.formatter.renderingEnabled;return F.Debug("B.Text: IsRenderingEnabled output:",e),e}GetContentVersion(){F.Debug("B.Text: GetContentVersion input: none");const t=this.formatter.GetContentVersion();return F.Debug("B.Text: GetContentVersion output:",t),t}GetSpellCheck(){F.Debug("B.Text: GetSpellCheck input: none");const t=this.formatter.GetSpellCheck();return F.Debug("B.Text: GetSpellCheck output:",t),t}SetSpellCheck(t,e){F.Debug("B.Text: SetSpellCheck input:",{isSpellCheckEnabled:t,updateImmediately:e}),this.formatter.SetSpellCheck(t),e&&(t?this.doc.spellChecker&&this.doc.spellChecker.CheckSpellingForTextObj(this):this.UpdateTextObject()),F.Debug("B.Text: SetSpellCheck output: completed")}UpdateSpellCheck(t){F.Debug("B.Text: UpdateSpellCheck input:",t),this.formatter.UpdateSpellCheck(t),this.UpdateTextObject(),F.Debug("B.Text: UpdateSpellCheck output: Spell check updated and text object refreshed")}GetSpellCheckList(){F.Debug("B.Text: GetSpellCheckList input: no parameters");const t=this.formatter.GetWordList();return F.Debug("B.Text: GetSpellCheckList output:",t),t}DoSpellCheck(){F.Debug("B.Text: DoSpellCheck input: none"),this.formatter.SpellCheckValid()?this.doc.spellChecker.CheckSpellingForTextObj(this):this.formatter.UpdateSpellCheckFormatting(),F.Debug("B.Text: DoSpellCheck output: completed")}GetSpellAtLocation(t,e){F.Debug("B.Text: GetSpellAtLocation input:",{clientX:t,clientY:e}),e+=Rt(window).scrollTop();const i=this.doc.ConvertWindowToElemCoords(t,e,this.textElem.node),o=this.formatter.GetSpellAtPoint(i);return F.Debug("B.Text: GetSpellAtLocation output:",o),o}UpdateTextObject(){F.Debug("B.Text: UpdateTextObject input:");const t=this.formatter.GetTextFormatSize();let e=!1,i=0;if(this.formatter.renderingEnabled){const o=t.height,n=this.minHeight,s=Math.max(o,n);switch(this.vAlign){case"top":i=0;break;case"middle":i=(s-o)/2;break;case"bottom":i=s-o}const a={width:t.width,height:s};a.width===this.lastFmtSize.width&&a.height===this.lastFmtSize.height||(this.CallEditCallback("willresize",a),e=!0),this.svgObj.size(t.width,s),this.clickAreaElem.transform({x:0,y:0}),this.clickAreaElem.size(t.width,s),this.textElem.size(t.width,o),this.textElem.transform({x:0,y:i}),this.decorationAreaElem.size(t.width,o),this.decorationAreaElem.transform({x:0,y:i}),this.textElemOffset=i,this.geometryBBox.width=t.width,this.geometryBBox.height=s,this.RefreshPaint(),this.formatter.RenderFormattedText(this.textElem,this.decorationAreaElem),this.linksDisabled||this.cursorState!==ze.CursorState.EditLink&&this.cursorState!==ze.CursorState.LinkOnly||this.formatter.SetHyperlinkCursor(),this.editor.IsActive()&&(this.editor.cursorPos>=0?this.editor.UpdateCursor():this.editor.selStart>=0&&this.editor.UpdateSelection()),e&&this.CallEditCallback("didresize",a),this.lastFmtSize=a,F.Debug("B.Text: UpdateTextObject output:",a)}}Activate(t,e){F.Debug("B.Text: Activate input:",{inputEvent:t,callbackData:e}),this.activeEditStyle=-1,this.selectHidden=!1,this.doc.SetActiveEdit(this),this.editor.Activate(t,e),F.Debug("B.Text: Activate output: Editor activated")}Deactivate(t){F.Debug("B.Text: Deactivate input:",{deactivationEvent:t}),this.activeEditStyle=-1,this.doc.activeEdit=null,this.editor.Deactivate(t),F.Debug("B.Text: Deactivate output: Editor deactivated")}IsActive(){F.Debug("B.Text: IsActive input: none");const t=this.editor.IsActive();return F.Debug("B.Text: IsActive output:",t),t}SetVirtualKeyboardHook(t,e){F.Debug("B.Text: SetVirtualKeyboardHook input:",{callback:t,hookData:e}),this.editor.SetVirtualKeyboardHook(t,e),F.Debug("B.Text: SetVirtualKeyboardHook output: hook set successfully")}GetSelectedRange(){F.Debug("B.Text: GetSelectedRange input: none");let t={start:-1,end:-1};return this.editor.IsActive()&&(t=this.editor.GetSelection()),F.Debug("B.Text: GetSelectedRange output:",t),t}SetSelectedRange(t,e,i,o){F.Debug("B.Text: SetSelectedRange input:",{startIndex:t,endIndex:e,selectionExtra:i,updateFlag:o}),t<0||!this.editor.IsActive()?F.Debug("B.Text: SetSelectedRange output: Invalid start index or editor not active"):(t!==e&&(this.activeEditStyle=-1),this.editor.SetSelection(t,e,i,o),this.CallEditCallback("select"),F.Debug("B.Text: SetSelectedRange output:",{startIndex:t,endIndex:e}))}HandleKeyPressEvent(t){F.Debug("B.Text: HandleKeyPressEvent input:",t);const e=!!(this.editor&&this.editor.IsActive())&&this.editor.HandleKeyPress(t);return F.Debug("B.Text: HandleKeyPressEvent output:",e),e}HandleKeyDownEvent(t){F.Debug("B.Text: HandleKeyDownEvent input:",t);const e=this.editor&&this.editor.IsActive()&&this.editor.HandleKeyDown(t);return F.Debug("B.Text: HandleKeyDownEvent output:",e),e}HideSelection(){F.Debug("B.Text: HideSelection input: none"),this.selectElem.plot(),this.svgObj.remove(this.selectElem),F.Debug("B.Text: HideSelection output: selection hidden")}ShowSelection(t){F.Debug("B.Text: ShowSelection input:",t),this.selectElem.attr("fill","#8888FF"),this.selectElem.attr("stroke-width",0),this.selectElem.attr("fill-opacity",.4),this.selectElem.attr("pointer-events","none"),this.selectElem.transform({y:this.textElemOffset}),this.selectHidden?this.selectElem.attr("visibility","hidden"):this.selectElem.attr("visibility","visible"),t&&this.selectElem.plot(t),this.svgObj.add(this.selectElem),F.Debug("B.Text: ShowSelection output: selection displayed successfully")}SetSelectionVisible(t){F.Debug("B.Text: SetSelectionVisible input:",{isVisible:t}),this.selectHidden=!t,this.IsActive()&&(this.selectHidden?(this.cursorElem.attr("visibility","hidden"),this.selectElem.attr("visibility","hidden")):(this.cursorElem.attr("visibility","visible"),this.selectElem.attr("visibility","visible"))),F.Debug("B.Text: SetSelectionVisible output: selection visibility set to",t)}HideInputCursor(){F.Debug("B.Text: HideInputCursor input: no parameters"),void 0!==this.cursorTimer&&(clearInterval(this.cursorTimer),this.cursorTimer=void 0),this.cursorElem.attr("visibility","hidden"),this.svgObj.remove(this.cursorElem),this.cursorPos=void 0,F.Debug("B.Text: HideInputCursor output: Cursor hidden")}ShowInputCursor(t,e,i){F.Debug("B.Text: ShowInputCursor input:",{x:t,startY:e,endY:i});const o=this.doc.ConverWindowToDocLength(1);void 0!==this.cursorTimer&&clearInterval(this.cursorTimer),this.cursorElem.attr("fill","none"),this.cursorElem.attr("stroke-width",o),this.cursorElem.attr("stroke","#000"),this.cursorElem.attr("pointer-events","none"),this.cursorElem.attr({x1:t,y1:e+this.textElemOffset,x2:t,y2:i+this.textElemOffset}),this.selectHidden?this.cursorElem.attr("visibility","hidden"):this.cursorElem.attr("visibility","visible"),this.svgObj.add(this.cursorElem),this.cursorPos={x:t,y1:e+this.textElemOffset,y2:i+this.textElemOffset},this.cursorTimer=setInterval((()=>{this.cursorElem.attr("visibility","hidden"),setTimeout((()=>{this.selectHidden||this.cursorElem.attr("visibility","visible")}),250)}),1e3),this.editor.IsActive()&&this.editor.virtualKeyboardHook&&this.editor.virtualKeyboardHook(this,!0),F.Debug("B.Text: ShowInputCursor output: Cursor shown at",{x:t,y1:e+this.textElemOffset,y2:i+this.textElemOffset})}GetInputCursorPos(){if(F.Debug("B.Text: GetInputCursorPos input: none"),this.cursorPos){const t=this.doc.ConvertElemToWindowCoords(this.cursorPos.x,this.cursorPos.y1,this.svgObj.node),e=this.doc.ConvertElemToWindowCoords(this.cursorPos.x,this.cursorPos.y2,this.svgObj.node),i={x1:t.x,y1:t.y,x2:e.x,y2:e.y};return F.Debug("B.Text: GetInputCursorPos output:",i),i}return F.Debug("B.Text: GetInputCursorPos output: cursor position is not defined"),null}SetCursorState(t){F.Debug("B.Text: SetCursorState input:",t),this.cursorState=t,this.ClearAllCursors(),t!==ze.CursorState.EditOnly&&t!==ze.CursorState.EditLink||this.SetCursor(ze.CursorType.Text),this.linksDisabled||t!==ze.CursorState.EditLink&&t!==ze.CursorState.LinkOnly||this.formatter.SetHyperlinkCursor(),F.Debug("B.Text: SetCursorState output: cursorState set to",t)}GetCursorState(){F.Debug("B.Text: GetCursorState input: none");const t=this.cursorState;return F.Debug("B.Text: GetCursorState output:",t),t}DisableHyperlinks(t){F.Debug("B.Text: DisableHyperlinks input:",{shouldDisableHyperlinks:t}),this.linksDisabled=t,this.SetCursorState(this.cursorState),this.UpdateTextObject(),F.Debug("B.Text: DisableHyperlinks output:",{linksDisabled:this.linksDisabled})}InitDataSettings(t,e,i){F.Debug("B.Text: InitDataSettings input:",{tableId:t,recordId:e,styleOverride:i}),this.dataTableID=t,this.dataRecordID=e,this.dataStyleOverride=i,F.Debug("B.Text: InitDataSettings output:",{dataTableID:this.dataTableID,dataRecordID:this.dataRecordID,dataStyleOverride:this.dataStyleOverride})}IsDataInitialized(){F.Debug("B.Text: isDataInitialized input: no parameters");const t=this.dataTableID>0&&this.dataRecordID>0;return F.Debug("B.Text: isDataInitialized output:",t),t}GetDataField(t){F.Debug("B.Text: GetDataField input:",{startPosition:t});const e=this.formatter.GetDataField(t);return F.Debug("B.Text: GetDataField output:",e),e}InsertDataField(t,e,i){F.Debug("B.Text: InsertDataField input:",{fieldId:t,startPosition:e,preserveFormatting:i});const o=this.GetDataText(t,this.formatter.GetDataNameDisplay()),n={dataField:Ys.FormatDataFieldID(t,!0)};this.SetText(o,n,e,i),F.Debug("B.Text: InsertDataField output: data field inserted",{fieldId:t,startPosition:e,preserveFormatting:i})}PasteDataField(t){F.Debug("B.Text: PasteDataField input:",{dataFieldId:t});let e,i=0,o=0;this.editor.IsActive()&&(e=this.editor.GetSelection(),e.start>=0&&(i=e.start,o=e.end-e.start)),this.InsertDataField(t,i,o),this.CallEditCallback("edit"),F.Debug("B.Text: PasteDataField output:",{dataFieldId:t,selectionStart:i,selectionLength:o})}HasDataFields(){F.Debug("B.Text: HasDataFields input: no parameters");const t=this.formatter.HasDataFields();return F.Debug("B.Text: HasDataFields output:",t),t}HasDataField(t){F.Debug("B.Text: HasDataField input:",t);const e=this.formatter.HasDataField(t);return F.Debug("B.Text: HasDataField output:",e),e}UpdateFromData(t,e){F.Debug("B.Text: UpdateFromData input:",{tableId:t,recordId:e}),void 0!==t&&void 0!==e&&(t===this.dataTableID&&e===this.dataRecordID||(this.dataStyleOverride=null),this.InitDataSettings(t,e,this.dataStyleOverride)),this.formatter.RebuildFromData(),this.UpdateTextObject(),F.Debug("B.Text: UpdateFromData output:","Data updated successfully")}SetDataNameDisplay(t){F.Debug("B.Text: SetDataNameDisplay input:",{dataName:t}),this.formatter.SetDataNameDisplay(t),this.UpdateFromData(this.dataTableID,this.dataRecordID),F.Debug("B.Text: SetDataNameDisplay output: Data name display updated")}GetDataNameDisplay(){F.Debug("B.Text: GetDataNameDisplay input: no parameters");const t=this.formatter.GetDataNameDisplay();return F.Debug("B.Text: GetDataNameDisplay output:",t),t}GetDataText(t,e){F.Debug("B.Text: GetDataText input:",{fieldId:t,useFieldName:e});let i=" ";if(this.dataTableID<0||this.dataRecordID<0)return F.Debug("B.Text: GetDataText output:",i),i;const o=Ys.FormatDataFieldID(t,!1);if(e)i=TData.FieldedDataGetFieldName(this.dataTableID,o);else{i=TData.FieldedDataGetFieldValue(this.dataTableID,this.dataRecordID,o);const t=TData.FieldedDataGetFieldType(this.dataTableID,o);i=ye.opt.ModifyFieldDataForDisplay(i,t)}return i&&""!==i||(i=" "),F.Debug("B.Text: GetDataText output:",i),i}GetDataStyle(t){F.Debug("B.Text: GetDataStyle input:",{dataFieldId:t});let e=[];if(this.dataTableID<0||this.dataRecordID<0)return F.Debug("B.Text: GetDataStyle output:",e),e;const i=Ys.FormatDataFieldID(t,!1),o=TData.FieldedDataGetFieldStyle(this.dataTableID,this.dataRecordID,i);return o&&(e=TData.FieldedDataParseStyle(o)),F.Debug("B.Text: GetDataStyle output:",e),e}CheckDataExists(t){F.Debug("B.Text: CheckDataExists input:",{dataFieldId:t});const e=this.dataTableID>=0,i=this.dataRecordID>=0;let o=!1;if(e&&i){const e=Ys.FormatDataFieldID(t,!1);o=!!TData.FieldedDataGetRecord(this.dataTableID,this.dataRecordID)[e]}return F.Debug("B.Text: CheckDataExists output:",o),o}RenderDataFieldHilites(){F.Debug("B.Text: RenderDataFieldHilites input: no parameters"),this.formatter.RenderDataFieldHilites(this.decorationAreaElem),F.Debug("B.Text: RenderDataFieldHilites output: Data field highlights rendered")}ClearDataFieldHilites(){F.Debug("B.Text: ClearDataFieldHilites input: no parameters"),this.formatter.ClearDataFieldHilites(this.decorationAreaElem),F.Debug("B.Text: ClearDataFieldHilites output: Data field hilites cleared")}RemapDataFields(t){F.Debug("B.Text: RemapDataFields input:",t),this.HasDataFields()&&this.formatter.RemapDataFields(t),F.Debug("B.Text: RemapDataFields output: completed remapping")}static RemapDataFieldsInRuntimeText(t,e){function i(t){const i=t.split("_");let o=i[0];const n=i[1];for(let s=0;s<e.length;s++)if(e[s].srcFieldID===o){o=e[s].dstFieldID;break}return o+"_"+n}F.Debug("B.Text: RemapDataFieldsInRuntimeText input:",{runtimeText:t,mappingArray:e});for(let o=0;o<t.styles.length;o++){const e=t.styles[o].dataField;e&&(t.styles[o].dataField=i(e))}F.Debug("B.Text: RemapDataFieldsInRuntimeText output:",t)}}class Js extends Di{constructor(){super()}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("image")),this.InitElement(t,e),this.svgObj}SetURL(t){this.svgObj.attr({preserveAspectRatio:"none"}),this.svgObj.src=t,this.svgObj.attr("xlink:href",t,gi.xlink)}}class $s{constructor(){a(this,"dispX"),a(this,"dispY"),a(this,"dispWidth"),a(this,"dispHeight"),a(this,"dispDpiX"),a(this,"dispDpiY"),a(this,"scrollX"),a(this,"scrollY"),a(this,"docDpi"),a(this,"docScale"),a(this,"docWidth"),a(this,"docHeight"),a(this,"docToScreenScale"),a(this,"docDpiScale"),a(this,"docVisX"),a(this,"docVisY"),a(this,"docVisWidth"),a(this,"docVisHeight"),a(this,"docScreenX"),a(this,"docScreenY"),a(this,"docScreenWidth"),a(this,"docScreenHeight"),a(this,"maxScrollX"),a(this,"maxScrollY"),this.dispX=0,this.dispY=0,this.dispWidth=0,this.dispHeight=0,this.dispDpiX=0,this.dispDpiY=0,this.scrollX=0,this.scrollY=0,this.docDpi=0,this.docScale=0,this.docWidth=0,this.docHeight=0,this.docToScreenScale=0,this.docDpiScale=0,this.docVisX=0,this.docVisY=0,this.docVisWidth=0,this.docVisHeight=0,this.docScreenX=0,this.docScreenY=0,this.docScreenWidth=0,this.docScreenHeight=0,this.maxScrollX=0,this.maxScrollY=0}}class Zs extends Di{constructor(){super(...arguments),a(this,"vueInstance",null),a(this,"shapeGroup"),a(this,"svgObj"),a(this,"foreignObj")}CreateElement(t,e){return this.svgObj=new gi.Container(gi.create("foreignObject")),this.InitElement(t,e),this.svgObj}SetSize(t,e){return this.svgObj.size(t,e),this}SetPosition(t,e){return this.svgObj.move(t,e),this}MountVueComponent(t,e={}){try{Promise.all([_t((()=>import("./vue.runtime.esm-bundler.eac6e010.js")),["assets/vue.runtime.esm-bundler.eac6e010.js","assets/index.3bd6c859.js","assets/index.4cd415b0.css"]),_t((()=>import("./quasar.client.364ac5e6.js")),["assets/quasar.client.364ac5e6.js","assets/index.3bd6c859.js","assets/index.4cd415b0.css"])]).then((([i,o])=>{const n=document.createElement("div");if(n.style.width="100%",n.style.height="100%",this.svgObj.node.appendChild(n),i.createApp){this.vueInstance=i.createApp(t,e);const s=o.default||o;this.vueInstance.use(s.Quasar||s,{config:{},plugins:{}}),this.vueInstance.mount(n)}else if(i.default&&"function"==typeof i.default.extend){i.default.use(o.default||o);const s=i.default.extend(t);this.vueInstance=new s({propsData:e}),this.vueInstance.$mount(n)}else if("function"==typeof i.extend){i.use(o.default||o);const s=i.extend(t);this.vueInstance=new s({propsData:e}),this.vueInstance.$mount(n)}else this.vueInstance=i.createApp(t,e),this.vueInstance.use(o.default||o),this.vueInstance.mount(n)}))}catch(i){Uo.Error("= b.ForeignObject: MountVueComponent/ Failed to mount Vue component:",i)}return this}SetHtmlContent(t){return this.svgObj.html(t),this}DestroyVueComponent(){this.vueInstance&&(this.vueInstance.$destroy(),this.vueInstance=null,this.svgObj.node.textContent="")}setSecureHTML(t){_t((()=>import("./T3SecurityUtil.3a361620.js")),["assets/T3SecurityUtil.3a361620.js","assets/purify.es.fbbbfcb0.js"]).then((({T3Security:e})=>{const i=e.sanitizeHTML(t,!0);this.svgObj.node.innerHTML=i})).catch((()=>{this.svgObj.node.textContent=t}))}RemoveElement(){this.DestroyVueComponent(),super.RemoveElement()}}const Qs=class extends Is{constructor(t,e){super(),a(this,"parentElem"),a(this,"svgObj"),a(this,"docInfo"),a(this,"activeEdit"),a(this,"spellChecker"),a(this,"documentLayerId"),a(this,"imageLoadRefCount"),this.parentElem=t,this.parentElem="#"!==this.parentElem.charAt(0)&&"."!==this.parentElem.charAt(0)?"#"+this.parentElem:this.parentElem,this.svgObj=gi.svg(Rt(this.parentElem)[0]),this.docInfo=new $s,this.activeEdit=null,this.spellChecker=null,this.documentLayerId=null,this.imageLoadRefCount=0,this.InitElement(this,null),this.InitializeContainer()}GetSpellCheck(){F.Debug("= B.Document","GetSpellCheck","Not implemented")}CreateShape(t){let e=null;switch(t){case me.CSType.Rect:e=new As;break;case me.CSType.RRect:e=new Gs;break;case me.CSType.Oval:e=new Rs;break;case me.CSType.Line:e=new js;break;case me.CSType.Polyline:e=new Bs;break;case me.CSType.PolyPolyline:e=new Ms;break;case me.CSType.PolylineContainer:e=new Bs;break;case me.CSType.Polygon:e=new Hs;break;case me.CSType.Path:e=new Fs;break;case me.CSType.Text:e=new qs;break;case me.CSType.Image:e=new Js;break;case me.CSType.Group:e=new _s;break;case me.CSType.Layer:e=new Us;break;case me.CSType.Symbol:e=new Ns;break;case me.CSType.ShapeCopy:e=new zs;break;case me.CSType.ShapeContainer:e=new Vs;break;case me.CSType.ForeignObject:e=new Zs;break;default:return null}try{return e?(e.CreateElement(this,null),e):null}catch(i){throw i}}InitializeContainer(){this.GetDeviceDetail(),this.docInfo.docDpi=this.docInfo.dispDpiX,this.docInfo.docWidth=this.docInfo.dispWidth,this.docInfo.docHeight=this.docInfo.dispHeight,this.docInfo.docScale=1,this.docInfo.scrollX=0,this.docInfo.scrollY=0,this.CalcWorkArea(),this.ApplyDocumentTransform()}GetDeviceDetail(){const t=this.CreateShape(me.CSType.Rect);t.SetFillOpacity(0),t.SetStrokeWidth(0),t.SetSize("100in","100in"),this.AddElement(t);const e=t.GetBBox();this.docInfo.dispDpiX=e.width/100,this.docInfo.dispDpiY=e.height/100,this.RemoveElement(t),this.docInfo.dispWidth=Rt(this.parentElem).innerWidth(),this.docInfo.dispHeight=Rt(this.parentElem).innerHeight()}CalcWorkArea(){if(F.Debug("= B.Document CalcWorkArea ",Rt(this.parentElem)),null===Rt(this.parentElem)||void 0===Rt(this.parentElem))return;const t=Rt(this.parentElem).offset();null!=t&&(this.docInfo.dispX=t.left,this.docInfo.dispY=t.top,this.docInfo.dispWidth=Rt(this.parentElem).innerWidth(),this.docInfo.dispHeight=Rt(this.parentElem).innerHeight(),this.docInfo.scrollX=Rt(this.parentElem).scrollLeft(),this.docInfo.scrollY=Rt(this.parentElem).scrollTop(),this.docInfo.docToScreenScale=this.docInfo.dispDpiX/this.docInfo.docDpi*this.docInfo.docScale,this.docInfo.docDpiScale=this.docInfo.dispDpiX/this.docInfo.docDpi,this.docInfo.docScreenX=this.docInfo.dispX-this.docInfo.scrollX,this.docInfo.docScreenY=this.docInfo.dispY-this.docInfo.scrollY,this.docInfo.docScreenWidth=this.docInfo.docWidth*this.docInfo.docToScreenScale,this.docInfo.docScreenHeight=this.docInfo.docHeight*this.docInfo.docToScreenScale,this.docInfo.maxScrollX=Math.max(0,this.docInfo.docScreenWidth-this.docInfo.dispWidth),this.docInfo.maxScrollY=Math.max(0,this.docInfo.docScreenHeight-this.docInfo.dispHeight),this.docInfo.docVisWidth=Math.min(this.docInfo.dispWidth/this.docInfo.docToScreenScale,this.docInfo.docWidth),this.docInfo.docVisHeight=Math.min(this.docInfo.dispHeight/this.docInfo.docToScreenScale,this.docInfo.docHeight),this.docInfo.docVisX=Math.min(this.docInfo.scrollX/this.docInfo.docToScreenScale,this.docInfo.docWidth-this.docInfo.docVisWidth),this.docInfo.docVisY=Math.min(this.docInfo.scrollY/this.docInfo.docToScreenScale,this.docInfo.docHeight-this.docInfo.docVisHeight))}ApplyDocumentTransform(t){const e=this.ElementCount();if(this.svgObj.attr({width:this.docInfo.docScreenWidth,height:this.docInfo.docScreenHeight}),!t)for(let i=0;i<e;i++){const t=this.GetElementByIndex(i);t instanceof Us&&(t.IsScalingAllowed()?t.svgObj.transform({scaleX:this.docInfo.docToScreenScale,scaleY:this.docInfo.docToScreenScale}):t.IsDpiScalingAllowed()&&t.svgObj.transform({scaleX:this.docInfo.docDpiScale,scaleY:this.docInfo.docDpiScale}))}}CalcScaleToFit(t,e,i,o){i||(i=this.docInfo.docWidth),o||(o=this.docInfo.docHeight);const n=this.docInfo.dispDpiX/this.docInfo.docDpi,s=t/(i*n),a=e/(o*n);let r=Math.min(s,a);return r>1&&(r=1),{scale:r,width:this.docInfo.docWidth*n*r,height:this.docInfo.docHeight*n*r}}SetDocumentSize(t,e){this.SetDocumentMetrics({width:t,height:e})}GetDocumentSize(){return{width:this.docInfo.docWidth,height:this.docInfo.docHeight}}SetDocumentDPI(t){this.SetDocumentMetrics({dpi:t})}SetDocumentScale(t){this.SetDocumentMetrics({scale:t})}SetDocumentMetrics(t){this.docInfo.docWidth=t.width||this.docInfo.docWidth,this.docInfo.docHeight=t.height||this.docInfo.docHeight,this.docInfo.docDpi=t.dpi||this.docInfo.docDpi,this.docInfo.docScale=t.scale||this.docInfo.docScale,this.CalcWorkArea(),this.ApplyDocumentTransform()}CalcScrollToVisible(t,e){let i=0,o=0;const n=this.docInfo.docVisX+this.docInfo.docVisWidth,s=this.docInfo.docVisY+this.docInfo.docVisHeight;return t=Math.max(0,Math.min(t,this.docInfo.docWidth)),e=Math.max(0,Math.min(e,this.docInfo.docHeight)),t<this.docInfo.docVisX?i=t-this.docInfo.docVisX:t>n&&(i=t-n),e<this.docInfo.docVisY?o=e-this.docInfo.docVisY:e>s&&(o=e-s),i||o?{xOff:this.docInfo.scrollX+i*this.docInfo.docToScreenScale,yOff:this.docInfo.scrollY+o*this.docInfo.docToScreenScale}:null}GetWorkArea(){return this.docInfo}ConvertDocToWindowCoords(t,e){return{x:t*this.docInfo.docToScreenScale+this.docInfo.docScreenX,y:e*this.docInfo.docToScreenScale+this.docInfo.docScreenY}}ConvertDocToWindowLength(t){return t*this.docInfo.docToScreenScale}ConvertOffsetToDocCoords(t,e){return{x:t/this.docInfo.docToScreenScale,y:e/this.docInfo.docToScreenScale}}ConvertWindowToDocCoords(t,e){return{x:(t-this.docInfo.docScreenX)/this.docInfo.docToScreenScale,y:(e-this.docInfo.docScreenY)/this.docInfo.docToScreenScale}}ConvertWindowToDocLength(t){return t/this.docInfo.docToScreenScale}ConvertWindowToElemCoords(t,e,i){const o=this.DOMElement().createSVGPoint(),n=this.DOMElement();o.x=t,o.y=e;const s=o.matrixTransform(n.getScreenCTM().inverse()).matrixTransform(i.getTransformToElement(n).inverse());return{x:s.x,y:s.y}}ConvertElemToWindowCoords(t,e,i){const o=this.DOMElement().createSVGPoint(),n=this.DOMElement();o.x=t,o.y=e;const s=o.matrixTransform(i.getTransformToElement(n)).matrixTransform(n.getScreenCTM());return{x:s.x,y:s.y}}RotateAroundCenterPt(t,e,i){const o=this.DOMElement().createSVGPoint(),n=this.DOMElement().createSVGMatrix(),s=(isNaN(t.x)?0:t.x)-(isNaN(e.x)?0:e.x),a=(isNaN(t.y)?0:t.y)-(isNaN(e.y)?0:e.y);o.x=s,o.y=a;const r=o.matrixTransform(n.rotate(i));return{x:r.x+e.x,y:r.y+e.y}}CalculateRotatedOffsetForResize(t,e,i){const o={x:t.x+t.width/2,y:t.y+t.height/2},n={x:e.x+e.width/2,y:e.y+e.height/2},s=this.RotateAroundCenterPt(n,o,i);return{x:s.x-n.x,y:s.y-n.y}}AddLayer(t){const e=this.CreateShape(me.CSType.Layer);return e.SetID(t),this.AddElement(e),this.ApplyDocumentTransform(),Rt(e.svgObj.node).data("layerID",t),e}RemoveLayer(t){const e=this.GetElementById(t);e&&this.RemoveElement(e)}GetLayer(t){let e,i=null;const o=this.ElementCount();for(let n=0;n<o;n++)if(e=this.GetElementByIndex(n),e instanceof Us&&e.GetID()===t){i=e;break}return i}GetDocumentLayer(){let t,e=null;const i=this.ElementCount();for(let o=0;o<i;o++)if(t=this.GetElementByIndex(o),t instanceof Us)if(this.documentLayerId){if(this.documentLayerId===t.GetID()){e=t;break}}else if(t.IsScalingAllowed()){e=t;break}return e}SetDocumentLayer(t){this.documentLayerId=t}GetFormattingLayer(){let t=this.GetLayer("_formatting_");return t&&!t.IsDpiScalingAllowed()&&(t=null),t||(t=this.AddLayer("_formatting_"),t.AllowDpiScalingOnly(!0),t.ExcludeFromExport(!0),this.MoveLayer("_formatting_",Se.LayerMoveType.Bottom),t.SetOpacity(0),this.ApplyDocumentTransform()),t}GetPreviousLayer(t){let e=null;const i=this.ElementCount();for(let o=0;o<i;o++){const i=this.GetElementByIndex(o);if(i instanceof Us){if(i.GetID()===t)break;e=i}}return e}GetNextLayer(t){let e=null,i=null,o=0;const n=this.ElementCount();t&&(i=this.GetLayer(t),i&&(o=this.GetElementIndex(i)+1));for(let s=o;s<n;s++){const t=this.GetElementByIndex(s);if(t instanceof Us){e=t;break}}return e}MoveLayer(t,e,i){const o=this.GetLayer(t);if(!o)return;const n=this.ElementCount();let s=n-1,a=this.GetElementIndex(o),r=null,l=0;switch(i&&(r=this.GetLayer(i),r&&(l=this.GetElementIndex(r),a<l&&l--)),e){case Se.LayerMoveType.Bottom:s=0;break;case Se.LayerMoveType.Before:s=l;break;case Se.LayerMoveType.After:s=l+1;break;case Se.LayerMoveType.Top:s=n-1;break;default:return}s!==a&&(this.RemoveElement(o),this.AddElement(o,s))}GetTextCacheForStyle(t){const e=Ys.MakeIDFromStyle(t);let i=Qs._TextMetricsCache[e];return i||(i={metrics:Ys.CalcStyleMetrics(t,this),textCache:{}},Qs._TextMetricsCache[e]=i),i}CalcStyleMetrics(t){const e=this.GetTextCacheForStyle(t);return Oe.CopyObj(e.metrics)}GetTextRunCache(t,e){return{startOffsets:[],endOffsets:[]}}SetActiveEdit(t){const e=this.GetActiveEdit();e&&e!==t&&e.Deactivate(),this.activeEdit=t}ClearActiveEdit(t){const e=this.GetActiveEdit();e&&e.Deactivate(t),this.activeEdit=null}GetActiveEdit(){return this.activeEdit&&!this.activeEdit.InDocument()&&(this.activeEdit=null),this.activeEdit}DefExists(t){const e=this.svgObj.defs().children();let i=!1;for(let o=0;o<e.length;o++)if(e[o].attrs.id===t){i=!0;break}return i}Defs(){return this.svgObj.defs()}ClearDefs(){const t=this.Defs();t&&t.clear()}ImageLoadAddRef(){this.imageLoadRefCount++}ImageLoadDecRef(){this.imageLoadRefCount=Math.max(0,this.imageLoadRefCount-1)}ImageLoadGetRefCount(){return this.imageLoadRefCount}ImageLoadResetRefCount(){this.imageLoadRefCount=0}ConverWindowToDocLength(t){return t/this.docInfo.docToScreenScale}CreateVueComponent(t,e,i,o={}){const n=this.CreateShape(me.CSType.ForeignObject);return n&&(n.SetSize(t,e),n.MountVueComponent(i,o)),n}};let ta=Qs;a(ta,"_TextMetricsCache",{});class ea{constructor(){a(this,"showRulers",!0),a(this,"showGrid",!0),a(this,"enableSnap",!1),a(this,"centerSnap",!0),a(this,"zoom",!0),a(this,"zoomLevels",1),a(this,"scale",!0),a(this,"showPageDivider",!1),a(this,"spellCheck",!0),a(this,"spellDict",!0),a(this,"spellFlags",!0),a(this,"snapToShapes",!0),a(this,"backgroundColor","#FFFFFF")}}class ia{static SetShowRulers(t){Vn.value=t}static SetShowGrid(t){zn.value=t}}class oa{constructor(){a(this,"docConfig"),a(this,"rulerConfig"),a(this,"workAreaId"),a(this,"svgAreaId"),a(this,"hRulerAreaId"),a(this,"vRulerAreaId"),a(this,"cRulerAreaId"),a(this,"svgDoc"),a(this,"hRulerDoc"),a(this,"vRulerDoc"),a(this,"gridLayer","_doc_grid"),a(this,"pageDividerLayer","_doc_page_divider"),a(this,"backgroundLayer","_background"),a(this,"backgroundElem"),a(this,"rulerVis",!0),a(this,"gridVis",!0),a(this,"scaleToFit",!1),a(this,"scaleToPage",!1),a(this,"scrollWidth",0),a(this,"hRulerGuide",null),a(this,"vRulerGuide",null),a(this,"rulerGuideWinPos",{x:0,y:0}),a(this,"rulerGuideScrollTimer",null),a(this,"rulerInDrag",!1),a(this,"printHandler",null),a(this,"inZoomIdle",!1),this.InitDocConfig(),this.rulerConfig=new be,this.HandleResizeEvent=this.HandleResizeEvent.bind(this),this.HandleScrollEvent=this.HandleScrollEvent.bind(this),this.RulerTopDoubleClick=this.RulerTopDoubleClick.bind(this),this.RulerLeftDoubleClick=this.RulerLeftDoubleClick.bind(this),this.RulerCenterDoubleClick=this.RulerCenterDoubleClick.bind(this),this.RulerDragStart=this.RulerDragStart.bind(this),this.RulerTopDrag=this.RulerTopDrag.bind(this),this.RulerLeftDrag=this.RulerLeftDrag.bind(this),this.RulerCenterDrag=this.RulerCenterDrag.bind(this),this.RulerDragEnd=this.RulerDragEnd.bind(this)}InitDocConfig(){F.Debug("= U.DocUtil: InitDocConfig - Input: Initializing document configuration"),this.docConfig=new ea,this.docConfig.showRulers=!1,this.docConfig.showGrid=!1,this.docConfig.showPageDivider=!1,this.docConfig.enableSnap=!0,this.docConfig.centerSnap=!0,this.docConfig.snapToShapes=!0,this.docConfig.zoom=!0,this.docConfig.zoomLevels=!0,this.docConfig.scale=!0,this.docConfig.spellCheck=!1,this.docConfig.spellDict=!1,this.docConfig.spellFlags=!1,F.Debug("= U.DocUtil: InitDocConfig - Output:",this.docConfig)}InitializeWorkArea(t,e=!1){F.Info("= u.DocUtil: InitializeWorkArea - Input:",t),t=t||{},this.workAreaId=t.workAreaId||"#document-area",this.svgAreaId=t.svgAreaId||"#svg-area",this.hRulerAreaId=t.hRulerAreaId||"#h-ruler",this.vRulerAreaId=t.vRulerAreaId||"#v-ruler",this.cRulerAreaId=t.cRulerAreaId||"#c-ruler",e||(this.svgDoc=null,this.hRulerDoc=null,this.vRulerDoc=null),this.rulerVis=!0,this.gridVis=!0,this.gridLayer="_doc_grid",this.pageDividerLayer="_doc_page_divider",this.backgroundLayer="_background",this.backgroundElem=null,this.scaleToFit=!1,this.scaleToPage=!1,this.scrollWidth=0,this.printHandler=null,Rt(window).bind("resize",this,(function(t){t.data.HandleResizeEvent()})),Rt(this.svgAreaId).bind("scroll",this,(function(t){t.data.HandleScrollEvent()})),this.rulerConfig=new be,this.rulerConfig.denom=Ve.GetFractionDenominator(),this.UpdateRulerVisibility(),Rt(window).bind("mousemove",Ls.Evt_MouseMove),e||this.InitSvgArea(t),this.UpdateGridVisibility(),e||this.SetUpRulers(),this.UpdateGrid(),this.UpdatePageDivider(),this.UpdateWorkArea(),F.Debug("= U.DocUtil: InitializeWorkArea - Output:",{workAreaId:this.workAreaId,svgAreaId:this.svgAreaId,hRulerAreaId:this.hRulerAreaId,vRulerAreaId:this.vRulerAreaId,cRulerAreaId:this.cRulerAreaId,gridLayer:this.gridLayer,pageDividerLayer:this.pageDividerLayer,backgroundLayer:this.backgroundLayer,scaleToFit:this.scaleToFit,scaleToPage:this.scaleToPage})}InitSvgArea(t){F.Info("= u.DocUtil: InitSvgArea - Input:",t),t=t||{},this.svgDoc||(this.svgDoc=new ta(this.svgAreaId,[]));let e=this.svgDoc.AddLayer(this.backgroundLayer);this.backgroundElem=this.svgDoc.CreateShape(me.CSType.Rect),e.AddElement(this.backgroundElem),this.backgroundElem.SetPos(0,0),this.backgroundElem.SetStrokeWidth(0),this.backgroundElem.SetStrokeColor("none"),this.backgroundElem.SetFillColor("none"),this.backgroundElem.ExcludeFromExport(!0),e.SetCustomAttribute("t3-background","1"),e=this.svgDoc.AddLayer(this.gridLayer),e.AllowScaling(!1),e.ExcludeFromExport(!0),e.SetCustomAttribute("t3-grid","1"),e=this.svgDoc.AddLayer(this.pageDividerLayer),e.AllowScaling(!1),e.ExcludeFromExport(!0),t.layers&&Array.isArray(t.layers)&&t.layers.forEach((t=>{this.svgDoc.AddLayer(t)})),t.documentWidth&&t.documentHeight&&this.svgDoc.SetDocumentSize(t.documentWidth,t.documentHeight),t.documentDPI&&this.svgDoc.SetDocumentDPI(t.documentDPI),this.backgroundElem.SetSize(this.svgDoc.docInfo.docWidth,this.svgDoc.docInfo.docHeight),this.svgDoc.ImageLoadResetRefCount(),F.Debug("= U.DocUtil: InitSvgArea - Output:",{documentWidth:this.svgDoc.docInfo.docWidth,documentHeight:this.svgDoc.docInfo.docHeight,layers:[this.backgroundLayer,this.gridLayer,this.pageDividerLayer]})}CheckScaleToFit(){if(F.Debug("= U.DocUtil: CheckScaleToFit - Input: scaleToFit =",this.scaleToFit),!this.scaleToFit)return F.Debug("= U.DocUtil: CheckScaleToFit - Output: false (scaleToFit disabled)"),!1;const t=this.GetWorkAreaSize(),e=Rt(this.vRulerAreaId).width(),i=Rt(this.hRulerAreaId).height();let o={x:0,y:0,width:t.width,height:t.height};this.docConfig.showRulers&&(o.x+=e,o.width-=e,o.y+=i,o.height-=i),F.Debug("= U.DocUtil: CheckScaleToFit - Available rect:",o);const n=this.svgDoc.CalcScaleToFit(o.width-20,o.height-20);F.Debug("= U.DocUtil: CheckScaleToFit - CalcScaleToFit result:",n);const s=this.svgDoc.docInfo.docScale!==n.scale;return F.Debug("= U.DocUtil: CheckScaleToFit - Output:",s),s}UpdateWorkArea(t){const e=this.docConfig.showRulers;let i=this.GetWorkAreaSize();i.height-=null!=t?t:0;const o=Rt(this.vRulerAreaId).width(),n=Rt(this.hRulerAreaId).height();F.Debug("= u.DocUtil: UpdateWorkArea/ - Input:",{workAreaSize:i,showRulers:e,verticalRulerWidth:o,horizontalRulerHeight:n}),this.scrollWidth||(this.scrollWidth=this.GetScrollBarSize());let s={x:0,y:0,width:i.width,height:i.height};e&&(s.x+=o,s.width-=o,s.y+=n,s.height-=n);let a={width:0,height:0},r=null;if(this.svgDoc)if(this.scaleToFit)ye.opt.inAutoScroll?(r=this.svgDoc.GetWorkArea(),a={width:r.docScreenWidth,height:r.docScreenHeight}):s.width>0&&s.height>0?(r=this.svgDoc.CalcScaleToFit(s.width-20,s.height-20),a={width:r.width,height:r.height},this.svgDoc.docInfo.docScale!==r.scale&&(this.svgDoc.SetDocumentScale(r.scale),this.IdleZoomUI(),this.UpdateGrid(),this.UpdatePageDivider(),this.ResetRulers())):(r=this.svgDoc.GetWorkArea(),a={width:r.docScreenWidth,height:r.docScreenHeight});else if(this.scaleToPage&&s.width>0&&s.height>0){const t=ye.opt.header.Page.papersize.x-(ye.opt.header.Page.margins.left+ye.opt.header.Page.margins.right),e=ye.opt.header.Page.papersize.y-(ye.opt.header.Page.margins.top+ye.opt.header.Page.margins.bottom);r=this.svgDoc.CalcScaleToFit(s.width-20,s.height-20,t,e),a={width:r.width,height:r.height},ye.opt.inAutoScroll||this.svgDoc.docInfo.docScale===r.scale||(this.svgDoc.SetDocumentScale(r.scale),this.IdleZoomUI(),this.UpdateGrid(),this.UpdatePageDivider(),this.ResetRulers())}else r=this.svgDoc.GetWorkArea(),a={width:r.docScreenWidth,height:r.docScreenHeight};else a={width:s.width,height:s.height};const l={width:Math.min(s.width,a.width),height:Math.min(s.height,a.height)};let h=!1,c=!1;l.width<a.width&&(h=!0,l.height+=this.scrollWidth,l.height>s.height&&(l.height=s.height,c=!0)),l.height<a.height&&(c=!0,l.width+=this.scrollWidth,l.width>s.width&&(l.width=s.width,h=!0));const p={x:s.x+(s.width-l.width)/2,y:s.y+(s.height-l.height)/2};Rt(this.svgAreaId).css({left:p.x,top:p.y,width:l.width,height:l.height,"overflow-x":h?"scroll":"hidden","overflow-y":c?"scroll":"hidden"}),e&&(Rt(this.hRulerAreaId).css({left:p.x,top:p.y-n,width:l.width,height:n}),Rt(this.vRulerAreaId).css({left:p.x-o,top:p.y,width:o,height:l.height}),Rt(this.cRulerAreaId).css({left:p.x-o,top:p.y-n})),this.svgDoc&&(this.svgDoc.CalcWorkArea(),this.AdjustScroll(),this.svgDoc.ApplyDocumentTransform(!0)),F.Debug("= u.DocUtil: UpdateWorkArea/ - Output:",{finalPosition:p,finalSize:l,targetDimensions:a,needHorizontalScroll:h,needVerticalScroll:c})}GetWorkAreaSize(){const t={width:Rt(this.workAreaId).width(),height:Rt(this.workAreaId).height()};return F.Debug("= u.DocUtil: GetWorkAreaSize/ - Input/Output:",{workAreaId:this.workAreaId},t),t}GetScrollBarSize(){F.Debug("= U.DocUtil: GetScrollBarSize - Input: Measuring scrollbar width");const t=Rt('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),e=t.children(),i=e.innerWidth();e.height(99);const o=i-e.innerWidth();return t.remove(),F.Debug("= U.DocUtil: GetScrollBarSize - Output:",{scrollbarWidth:o}),o}AdjustScroll(t,e){F.Debug("= U.DocUtil: AdjustScroll - Input:",{horizontalScroll:t,verticalScroll:e});const i=this.svgDoc.GetWorkArea(),o=Math.min(void 0!==t?t:i.scrollX,i.maxScrollX),n=Math.min(void 0!==e?e:i.scrollY,i.maxScrollY);Rt(this.svgAreaId).scrollLeft(o),Rt(this.svgAreaId).scrollTop(n),this.svgDoc.CalcWorkArea(),this.SyncRulers(),F.Debug("= U.DocUtil: AdjustScroll - Output:",{targetHorizontalScroll:o,targetVerticalScroll:n})}HandleResizeEvent(){this.UpdateWorkArea(),F.Debug("= u.DocUtil: HandleResizeEvent/ - Input/Output: Work area updated")}HandleScrollEvent(){F.Debug("= U.DocUtil: HandleScrollEvent - Input: Handling scroll event");const t=this.svgDoc.GetWorkArea(),e=t.scrollX,i=t.scrollY;this.svgDoc.CalcWorkArea(),this.SyncRulers();const o=this.svgDoc.GetWorkArea(),n=e-o.scrollX,s=i-o.scrollY;F.Debug("= U.DocUtil: HandleScrollEvent - Output:",{initialScroll:{x:e,y:i},currentScroll:{x:o.scrollX,y:o.scrollY},deltaScroll:{x:n,y:s}})}SetResolution(t){F.Debug("= U.DocUtil: SetResolution - Input:",t),this.svgDoc&&(this.svgDoc.SetDocumentDPI(t),this.UpdateWorkArea()),F.Debug("= U.DocUtil: SetResolution - Output: Resolution updated")}ResizeDocument(t,e,i){F.Debug("= U.DocUtil: ResizeDocument - Input:",{width:t,height:e,skipUIUpdate:i}),this.svgDoc&&(this.svgDoc.SetDocumentSize(t,e),this.backgroundElem.SetSize(t,e),i||(this.ResetRulers(),this.UpdateGrid(),this.UpdatePageDivider(),this.UpdateWorkArea())),F.Debug("= U.DocUtil: ResizeDocument - Output: Document resized to",{width:t,height:e})}GetDocumentSize(){F.Debug("= U.DocUtil: GetDocumentSize - Input: Retrieving document dimensions");const t=this.svgDoc.GetDocumentSize();return F.Debug("= U.DocUtil: GetDocumentSize - Output:",t),t}DocumentPageSizeChanged(){F.Debug("= U.DocUtil: DocumentPageSizeChanged - Input: Document page size changed"),this.svgDoc&&(this.scaleToPage?this.UpdateWorkArea():this.UpdatePageDivider()),F.Debug("= U.DocUtil: DocumentPageSizeChanged - Output: Display updated")}MaintainView(t){F.Debug("= U.DocUtil: MaintainView - Input:",{skipSelection:t});const e=this.svgDoc.GetWorkArea(),i=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);let o=i.length?ye.opt.GetListSRect(i):ye.opt.CalcAllObjectEnclosingRect(!1);o.width&&o.height||(o.x=0,o.y=0,o.width=e.docWidth,o.height=e.docHeight),t&&(o.width=0,o.height=0);const n=(o.x+o.width/2)*e.docToScreenScale-e.dispWidth/2,s=(o.y+o.height/2)*e.docToScreenScale-e.dispHeight/2;this.AdjustScroll(n,s),F.Debug("= U.DocUtil: MaintainView - Output:",{horizontalScroll:n,verticalScroll:s,boundingRect:o})}SetZoomFactor(t,e){if(F.Debug("= u.DocUtil: SetZoomFactor/ - Input: zoomFactor,skipCentering",{zoomFactor:t,skipCentering:e}),!this.svgDoc)return F.Debug("= u.DocUtil: SetZoomFactor/ - Output: false (no svgDoc)"),!1;if(!this.scaleToFit&&!this.scaleToPage&&t===this.GetZoomFactor())return F.Debug("= u.DocUtil: SetZoomFactor/ - Output: false (zoom unchanged)"),!1;if(this.scaleToFit=!1,this.scaleToPage=!1,this.svgDoc.SetDocumentScale(t),!e){const t=this.svgDoc.GetWorkArea(),e=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);let i=e.length?ye.opt.GetListSRect(e):ye.opt.CalcAllObjectEnclosingRect(!1);i.width&&i.height||(i={x:0,y:0,width:t.docWidth,height:t.docHeight});const o=(i.x+i.width/2)*t.docToScreenScale-t.dispWidth/2,n=(i.y+i.height/2)*t.docToScreenScale-t.dispHeight/2;this.AdjustScroll(o,n)}return this.IdleZoomUI(),this.ResetRulers(),this.UpdateGrid(),this.UpdatePageDivider(),this.UpdateWorkArea(),F.Debug("= U.DocUtil: SetZoomFactor - Output: true (zoom updated)"),!0}GetZoomFactor(){let t=this.svgDoc?this.svgDoc.GetWorkArea().docScale:ge.T3Config.Zoom.Default;return F.Debug("= u.DocUtil: GetZoomFactor/ - Input/Output:",t),t}SetSizeToFit(t){F.Debug("= U.DocUtil: SetSizeToFit - Input:",t),this.scaleToFit=t,t&&(this.scaleToPage=!1),this.UpdateWorkArea(),F.Debug("= U.DocUtil: SetSizeToFit - Output:",{scaleToFit:this.scaleToFit,scaleToPage:this.scaleToPage})}GetSizeToFit(){const t=this.scaleToFit;return F.Debug("= U.DocUtil: GetSizeToFit - Retrieving scale-to-fit setting Input/Output: ",t),t}SetSizeToPage(t){F.Debug("= U.DocUtil: SetSizeToPage - Input:",t),this.scaleToPage=t,t&&(this.scaleToFit=!1),this.UpdateWorkArea(),F.Debug("= U.DocUtil: SetSizeToPage - Output:",{scaleToPage:this.scaleToPage,scaleToFit:this.scaleToFit})}GetSizeToPage(){const t=this.scaleToPage;return F.Debug("= U.DocUtil: GetSizeToPage - Input/Output:",t),t}IdleZoomUI(){Ts.UpdateDocumentScale(),F.Debug("= U.DocUtil: IdleZoomUI - Input/Output: Zoom UI updated")}SetScroll(t,e){F.Debug("= U.DocUtil: SetScroll - Input:",{horizontalScroll:t,verticalScroll:e}),this.AdjustScroll(t,e),F.Debug("= U.DocUtil: SetScroll - Output: Scroll position updated")}ScrollToPosition(t,e){F.Debug("= U.DocUtil: ScrollToPosition - Input:",{xPosition:t,yPosition:e});const i=this.svgDoc.CalcScrollToVisible(t,e);i&&this.AdjustScroll(i.xOff,i.yOff),F.Debug("= U.DocUtil: ScrollToPosition - Output:",{calculatedOffsets:i,scrollApplied:!!i})}RulersNotEqual(t,e){F.Debug("= U.DocUtil: RulersNotEqual - Input:",{rulerConfig1:t,rulerConfig2:e}),t=t||{};let i=0,o=0;(e=e||{}).originx&&(i=e.originx),e.originy&&(o=e.originy);let n=t.useInches!=e.useInches||t.units!=e.units||t.major!=e.major||t.majorScale!=e.majorScale||t.nTics!=e.nTics||t.nMid!=e.nMid||t.nGrid!=e.nGrid||t.dp!=e.dp||t.denom!=e.denom||t.originx!=i||t.originy!=o;return t.major&&e.major&&t.major!=e.major&&(n=!0),null!=t.showpixels&&null!=e.showpixels&&t.showpixels!=e.showpixels&&(n=!0),F.Debug("= U.DocUtil: RulersNotEqual - Output:",n),n}PagesNotEqual(t,e){F.Debug("= U.DocUtil: PagesNotEqual - Input:",{pageConfig1:t,pageConfig2:e});if(null==t||null==t||null==e)return F.Debug("= U.DocUtil: PagesNotEqual - Output: false (invalid configs)"),!1;const i=t.papersize.x!=e.papersize.x||t.papersize.y!=e.papersize.y||t.margins.left!=e.margins.left||t.margins.right!=e.margins.right||t.margins.top!=e.margins.top||t.margins.bottom!=e.margins.bottom||t.landscape!=e.landscape;return F.Debug("= U.DocUtil: PagesNotEqual - Output:",i),i}DocObject(){F.Debug("= U.DocUtil: DocObject - Input: Getting document object");const t=this.svgDoc;return F.Debug("= U.DocUtil: DocObject - Output:",t?"Document object returned":"No document object"),t}SetRulers(t,e){let i;F.Debug("= U.DocUtil: SetRulers - Input:",{rulerSettings:t,shouldPropagate:e}),t&&(this.rulerConfig.useInches=void 0!==t.useInches?t.useInches:this.rulerConfig.useInches,this.rulerConfig.units=void 0!==t.units?t.units:this.rulerConfig.units,this.rulerConfig.major=void 0!==t.major?t.major:this.rulerConfig.major,this.rulerConfig.majorScale=void 0!==t.majorScale?t.majorScale:this.rulerConfig.majorScale,this.rulerConfig.nTics=void 0!==t.nTics?t.nTics:this.rulerConfig.nTics,this.rulerConfig.nMid=void 0!==t.nMid?t.nMid:this.rulerConfig.nMid,this.rulerConfig.nGrid=void 0!==t.nGrid?t.nGrid:this.rulerConfig.nGrid,this.rulerConfig.originx=void 0!==t.originx?t.originx:this.rulerConfig.originx,this.rulerConfig.originy=void 0!==t.originy?t.originy:this.rulerConfig.originy,this.rulerConfig.dp=void 0!==t.dp?t.dp:this.rulerConfig.dp,this.rulerConfig.denom=void 0!==t.denom?t.denom:this.rulerConfig.denom,null!=t.showpixels&&(this.rulerConfig.showpixels=t.showpixels),e||(i=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0),i.rulerConfig=Oe.DeepCopy(this.rulerConfig)),this.ResetRulers(),this.UpdateGrid(),this.UpdatePageDivider()),F.Debug("= U.DocUtil: SetRulers - Output:",{updatedRulerConfig:this.rulerConfig})}ShowCoordinates(t){return!1}UpdateRulerVisibility(){return F.Debug("= U.DocUtil: UpdateRulerVisibility - Input:",{showRulers:this.docConfig.showRulers,currentVisibility:this.rulerVis}),this.docConfig.showRulers!==this.rulerVis&&(this.docConfig.showRulers?(Rt(this.hRulerAreaId).css("visibility","visible"),Rt(this.vRulerAreaId).css("visibility","visible"),Rt(this.cRulerAreaId).css("visibility","visible"),this.ShowCoordinates(!0)):(Rt(this.hRulerAreaId).css("visibility","hidden"),Rt(this.vRulerAreaId).css("visibility","hidden"),Rt(this.cRulerAreaId).css("visibility","hidden"),this.ShowCoordinates(!1)),this.UpdateWorkArea(),this.rulerVis=this.docConfig.showRulers),F.Debug("= U.DocUtil: UpdateRulerVisibility - Output:",{updatedVisibility:this.rulerVis}),!0}SetUpRulers(){F.Debug("= U.DocUtil: SetUpRulers - Input:",{horizontalRulerAreaId:this.hRulerAreaId,verticalRulerAreaId:this.vRulerAreaId,centerRulerAreaId:this.cRulerAreaId,isReadOnly:this.IsReadOnly()});const t=Rt(this.hRulerAreaId)[0],e=Rt(this.vRulerAreaId)[0],i=Rt(this.cRulerAreaId)[0];if(F.Info(" SetUpRulers - DOM elements check:",{hRulerExists:!!t,vRulerExists:!!e,cRulerExists:!!i,hRulerElement:t,vRulerElement:e,cRulerElement:i}),this.hRulerDoc||(this.hRulerDoc=new ta(this.hRulerAreaId,[])),this.vRulerDoc||(this.vRulerDoc=new ta(this.vRulerAreaId,[])),this.hRulerGuide=null,this.vRulerGuide=null,this.rulerGuideWinPos={x:0,y:0},this.rulerGuideScrollTimer=null,this.rulerInDrag=!1,this.IsReadOnly())F.Info(" SetUpRulers - Document is read-only, events not attached");else{if(F.Info(" SetUpRulers - Attaching Hammer.js events..."),t){const e=new Hammer(t);e.on("doubletap",this.RulerTopDoubleClick),e.on("dragstart",this.RulerDragStart),e.on("drag",this.RulerTopDrag),e.on("dragend",this.RulerDragEnd),F.Info(" Horizontal ruler events attached")}else F.Error(" Horizontal ruler element not found!");if(e){const t=new Hammer(e);t.on("doubletap",this.RulerLeftDoubleClick),t.on("dragstart",this.RulerDragStart),t.on("drag",this.RulerLeftDrag),t.on("dragend",this.RulerDragEnd),F.Info(" Vertical ruler events attached")}else F.Error(" Vertical ruler element not found!");if(i){const t=new Hammer(i);t.on("doubletap",this.RulerCenterDoubleClick),t.on("dragstart",this.RulerDragStart),t.on("drag",this.RulerCenterDrag),t.on("dragend",this.RulerDragEnd),F.Info(" Center ruler events attached")}else F.Error(" Center ruler element not found!")}this.ResetRulers(),F.Debug("= U.DocUtil: SetUpRulers - Output:",{horizontalRulerDocInitialized:!!this.hRulerDoc,verticalRulerDocInitialized:!!this.vRulerDoc,rulerGuides:{horizontalRulerGuide:this.hRulerGuide,verticalRulerGuide:this.vRulerGuide},rulerInDrag:this.rulerInDrag})}ResetRulers(){F.Debug("= U.DocUtil: ResetRulers - Input: Resetting horizontal and vertical rulers");const t=this.svgDoc.GetWorkArea(),e=Rt(this.vRulerAreaId).width(),i=Rt(this.hRulerAreaId).height();this.hRulerDoc.SetDocumentSize(t.docScreenWidth+100,i),this.vRulerDoc.SetDocumentSize(e,t.docScreenHeight+100),this.hRulerDoc.RemoveAll(),this.vRulerDoc.RemoveAll(),this.SetRulerContent(this.hRulerDoc,!0),this.SetRulerContent(this.vRulerDoc,!1),F.Debug("= U.DocUtil: ResetRulers - Output: Rulers have been reset and redrawn")}GetScaledRuler(t){F.Debug("= U.DocUtil: GetScaledRuler - Input:",{conversionFactor:t,documentScale:this.svgDoc.docInfo.docScale});let e=Math.floor(this.svgDoc.docInfo.docScale);return 0===e?(e=Math.floor(1/this.svgDoc.docInfo.docScale),e>1&&(t/=e)):e>1&&(t*=e),F.Debug("= U.DocUtil: GetScaledRuler - Output:",{adjustedFactor:t}),t}SetRulerContent(t,e){F.Debug("= U.DocUtil: SetRulerContent - Input:",{rulerDocument:t,isHorizontalRuler:e});const i=this.svgDoc.GetWorkArea(),o=Rt(this.vRulerAreaId).width(),n=Rt(this.hRulerAreaId).height(),s=e?n:o;let a=1;const r=this.GetScaledRuler(a),l=t.CreateShape(me.CSType.Path);let h="";const c=Oe.RoundCoordLP(Math.round(3*s/4)),p=Oe.RoundCoordLP(Math.round(s/2)),d=Oe.RoundCoordLP(Math.round(s/4));let u=0;this.rulerConfig.useInches||(a*=me.Common.MetricConv);const g=this.rulerConfig.nTics;let y=this.rulerConfig.nMid;g%2&&(y=0);const S=Math.round(g/(y+1)),m=e?i.docScreenWidth:i.docScreenHeight;let b=this.rulerConfig.major/a;const D=[];let f=e?this.rulerConfig.originx:this.rulerConfig.originy,x=f-Math.floor(f);x&&(x-=1),x*=b;let C=-Math.ceil(f)*this.rulerConfig.majorScale;b/=r;let P=0;do{let t=x+u*(this.rulerConfig.major/r/a),o=Oe.RoundCoordLP(t*i.docToScreenScale),n=this.rulerConfig.showpixels?100*(C+u*(this.rulerConfig.majorScale/r)):C+u*(this.rulerConfig.majorScale/r);e?(D.push({label:n,x:o+2,y:1}),h+=`M${o},${s}v-${c}`):(D.push({label:n,x:3,y:o+2}),h+=`M${s},${o}h-${c}`);for(let a=1;a<g;a++){let o=t+a*(b/g),n=Oe.RoundCoordLP(o*i.docToScreenScale),r=a%S?d:p;h+=e?`M${n},${s}v-${r}`:`M${s},${n}h-${r}`}P=Oe.RoundCoordLP((x+(u+1)*(this.rulerConfig.major/r/a))*i.docToScreenScale),u++}while(P<m);l.SetPath(h),l.SetFillColor("none"),l.SetStrokeColor("#000"),l.SetStrokeWidth(".5"),t.AddElement(l),t.SetCursor(ze.CursorType.Default);let T=!1;for(let k=0;k<D.length;k++)if(D[k].label!==parseInt(D[k].label.toString(),10)){T=!0;break}if(T)for(let k=0;k<D.length;k++)D[k].label=D[k].label.toFixed(1);const O={size:10,color:"#000"},v=D.length,w=Math.floor(v/250)||1;for(let k=0;k<v;k+=w){const e=t.CreateShape(me.CSType.Text);e.SetText(D[k].label,O),t.AddElement(e),e.SetPos(D[k].x,D[k].y)}F.Debug("= U.DocUtil: SetRulerContent - Output:",{pathLength:h.length,labelCount:v,displayedLabels:Math.ceil(v/w)})}SyncRulers(){const t=Rt(this.svgAreaId).scrollLeft(),e=Rt(this.svgAreaId).scrollTop();F.Debug("= U.DocUtil: SyncRulers - Input:",{horizontalScroll:t,verticalScroll:e}),Rt(this.hRulerAreaId).scrollLeft(t),Rt(this.vRulerAreaId).scrollTop(e),F.Debug("= U.DocUtil: SyncRulers - Output: Rulers synchronized",{horizontalScroll:t,verticalScroll:e})}UpdateGridVisibility(){F.Debug("= u.DocUtil: UpdateGridVisibility - Input:",{showGrid:this.docConfig.showGrid,currentGridVisibility:this.gridVis});const t=this.svgDoc?this.svgDoc.GetLayer(this.gridLayer):null;let e=!1;return t?this.docConfig.showGrid===this.gridVis?(F.Debug("= U.DocUtil: UpdateGridVisibility - Output: No change in grid visibility. Current value:",this.gridVis),e):(t.SetVisible(this.docConfig.showGrid),this.gridVis=this.docConfig.showGrid,e=!0,F.Debug("= U.DocUtil: UpdateGridVisibility - Output: Grid visibility updated to",this.gridVis),e):(F.Debug("= U.DocUtil: UpdateGridVisibility - Output: Grid layer not found."),e)}UpdateGrid(){F.Debug("= U.DocUtil: UpdateGrid - Input:",{workArea:this.svgDoc.GetWorkArea(),gridLayer:this.gridLayer,rulerSettings:this.rulerConfig});const t=this.svgDoc.GetWorkArea(),e=this.svgDoc.GetLayer(this.gridLayer);let i=1;if(e){const o=this.GetScaledRuler(i);e.RemoveAll();const n=this.svgDoc.CreateShape(me.CSType.Path),s=this.svgDoc.CreateShape(me.CSType.Path);this.rulerConfig.useInches||(i=me.Common.MetricConv);const a=this.rulerConfig.major/i,r=this.rulerConfig.nGrid*o;let l="",h="";const c=ye.opt.header.Page.papersize,p=ye.opt.header.Page.margins,d=c.x-(p.left+p.right)/2,u=c.y-(p.top+p.bottom)/2,g=Oe.RoundCoordLP(t.docScreenWidth+2*d*t.docToScreenScale),y=Oe.RoundCoordLP(t.docScreenHeight+2*u*t.docToScreenScale),S=-Oe.RoundCoordLP(d*t.docToScreenScale),m=-Oe.RoundCoordLP(u*t.docToScreenScale),b=S+g,D=m+y;let f=this.rulerConfig.originx-Math.floor(this.rulerConfig.originx);f&&(f-=1),f*=a;let x=-Math.ceil(d/a),C=0,P=0;do{if(P=f+x*(this.rulerConfig.major/i),C=Oe.RoundCoordLP(P*t.docToScreenScale),C>b)break;l+=`M${C},${m}v${y}`;for(let e=1;e<r&&(P=f+x*(this.rulerConfig.major/i)+e*(a/r),C=Oe.RoundCoordLP(P*t.docToScreenScale),!(C>b));e++)h+=`M${C},${m}v${y}`;x++}while(C<b);let T=this.rulerConfig.originy-Math.floor(this.rulerConfig.originy);T&&(T-=1),T*=a;let O=-Math.ceil(u/a),v=0,w=0;do{if(w=T+O*(this.rulerConfig.major/i),v=Oe.RoundCoordLP(w*t.docToScreenScale),v>D)break;l+=`M${S},${v}h${g}`;for(let e=1;e<r&&(w=T+O*(this.rulerConfig.major/i)+e*(a/r),v=Oe.RoundCoordLP(w*t.docToScreenScale),!(v>D));e++)h+=`M${S},${v}h${g}`;O++}while(v<D);n.SetPath(l),n.SetFillColor("none"),n.SetStrokeColor("#000"),n.SetStrokeOpacity(".4"),n.SetStrokeWidth(".5"),s.SetPath(h),s.SetFillColor("none"),s.SetStrokeColor("#000"),s.SetStrokeOpacity(".2"),s.SetStrokeWidth(".5"),e.AddElement(s),e.AddElement(n),e.SetEventBehavior(me.EventBehavior.None),F.Debug("= U.DocUtil: UpdateGrid - Output:",{majorPathCommands:l,minorPathCommands:h,boundaries:{startX:S,startY:m,endX:g,endY:y,maxX:b,maxY:D}})}}UpdatePageDivider(){F.Debug("= u.DocUtil: UpdatePageDivider - T3Gv.docUtil",ye);if(!ye.docUtil.docConfig.showPageDivider)return;const t=this.svgDoc.GetWorkArea(),e=this.svgDoc.GetLayer(this.pageDividerLayer);if(e){e.RemoveAll();const i=this.svgDoc.CreateShape(me.CSType.Path);let o="";const n=ye.opt.header.Page,s=n.papersize,a=n.margins;s.x-(a.left+a.right)<=0&&(a.left=50,a.right=50),s.y-(a.top+a.bottom)<=0&&(a.top=50,a.bottom=50);let r=s.x-(a.left+a.right),l=s.y-(a.top+a.bottom);const h=r*t.docToScreenScale,c=l*t.docToScreenScale;let p=h;for(;p<t.docScreenWidth;)o+="M"+Oe.RoundCoordLP(p)+",0v"+t.docScreenHeight,p+=h;let d=c;for(;d<t.docScreenHeight;)o+="M0,"+Oe.RoundCoordLP(d)+"h"+t.docScreenWidth,d+=c;i.SetPath(o),i.SetFillColor("none"),i.SetStrokeColor("#000088"),i.SetStrokeOpacity(".6"),i.SetStrokePattern("10,4"),i.SetStrokeWidth(".5"),e.AddElement(i),F.Debug("= U.DocUtil: UpdatePageDivider - Output:",{screenPaperDimensions:{width:h,height:c},pathCommandLength:o.length})}else F.Debug("= U.DocUtil: UpdatePageDivider - Output: No page divider layer found")}SnapToGrid(t){F.Debug("= U.DocUtil: SnapToGrid - Input:",t),this.svgDoc.GetWorkArea();let e=1;this.rulerConfig.useInches||(e=me.Common.MetricConv);const i=this.GetScaledRuler(e);let o={x:t.x,y:t.y},n={x:0,y:0};const s=this.rulerConfig.major/e,a=s/(this.rulerConfig.nGrid*i),r=Math.floor(o.x/s);n.x=r*s,o.x-=n.x;const l=Math.round(o.x/a);n.x+=l*a;const h=Math.floor(o.y/s);n.y=h*s,o.y-=n.y;const c=Math.round(o.y/a);return n.y+=c*a,F.Debug("= U.DocUtil: SnapToGrid - Output:",n),n}RulerTopDoubleClick(t){F.Info(" RulerTopDoubleClick - Event received:",{event:t}),ve.StopPropagationAndDefaults(t),ye.docUtil.RulerHandleDoubleClick(t,!1,!0),F.Debug("= U.DocUtil: RulerTopDoubleClick - Output: Completed")}RulerLeftDoubleClick(t){F.Info(" RulerLeftDoubleClick - Event received:",{event:t}),ve.StopPropagationAndDefaults(t),ye.docUtil.RulerHandleDoubleClick(t,!0,!1),F.Debug("= U.DocUtil: RulerLeftDoubleClick - Output: Completed")}RulerCenterDoubleClick(t){F.Info(" RulerCenterDoubleClick - Event received:",{event:t}),ve.StopPropagationAndDefaults(t),ye.docUtil.RulerHandleDoubleClick(t,!0,!0),F.Debug("= U.DocUtil: RulerCenterDoubleClick - Output: Completed")}RulerDragStart(t){if(F.Info(" RulerDragStart - Event received:",{dragEvent:t}),!ye.docUtil.IsReadOnly()){if(Ie.IsRightClick(t))return ve.StopPropagationAndDefaults(t),void F.Debug("= U.DocUtil: RulerDragStart - Output: Right click detected, operation canceled");ye.docUtil.rulerInDrag=!0}F.Debug("= U.DocUtil: RulerDragStart - Output:",{rulerInDrag:ye.docUtil.rulerInDrag})}RulerTopDrag(t){if(F.Debug("= U.DocUtil: RulerTopDrag - Input:",{dragEvent:t}),ve.StopPropagationAndDefaults(t),rn.IsCtrlClick(t))return ve.StopPropagationAndDefaults(t),ye.docUtil.RulerHandleDoubleClick(t,!1,!0),void F.Debug("= U.DocUtil: RulerTopDrag - Output: Handled as double click");ye.docUtil.RulerDragGuides(t,!1,!0),F.Debug("= U.DocUtil: RulerTopDrag - Output: Drag guides initiated")}RulerLeftDrag(t){if(F.Debug("= U.DocUtil: RulerLeftDrag - Input:",{dragEvent:t}),ve.StopPropagationAndDefaults(t),rn.IsCtrlClick(t))return F.Debug("= U.DocUtil: RulerLeftDrag - Ctrl click detected"),ve.StopPropagationAndDefaults(t),ye.docUtil.RulerHandleDoubleClick(t,!0,!1),void F.Debug("= U.DocUtil: RulerLeftDrag - Output: Handled as double click");ye.docUtil.RulerDragGuides(t,!0,!1),F.Debug("= U.DocUtil: RulerLeftDrag - Output: Drag guides initiated")}RulerCenterDrag(t){if(F.Debug("= U.DocUtil: RulerCenterDrag - Input:",{event:t}),ve.StopPropagationAndDefaults(t),rn.IsCtrlClick(t))return F.Debug("= U.DocUtil: RulerCenterDrag - Ctrl click detected, invoking double click handler"),ve.StopPropagationAndDefaults(t),ye.docUtil.RulerHandleDoubleClick(t,!0,!0),void F.Debug("= U.DocUtil: RulerCenterDrag - Output: Double click action completed");ye.docUtil.RulerDragGuides(t,!0,!0),F.Debug("= U.DocUtil: RulerCenterDrag - Output: Drag guides initiated")}RulerDragEnd(t){F.Debug("= U.DocUtil: RulerDragEnd - Input:",{event:t}),ve.StopPropagationAndDefaults(t),ye.docUtil.RulerEndGuides(),F.Debug("= U.DocUtil: RulerDragEnd - Output: Completed")}RulerHandleDoubleClick(t,e,i){if(F.Debug("= U.DocUtil: RulerHandleDoubleClick - Input:",{clickEvent:t,isVerticalRuler:e,isIntersectionPoint:i}),!Ie.IsRightClick(t)){let o={originx:this.rulerConfig.originx,originy:this.rulerConfig.originy};const n=this.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY);if(this.svgDoc.GetWorkArea(),this.rulerInDrag=!1,!this.IsReadOnly()){if(e&&i)o.originx=0,o.originy=0;else if(i)o.originx=n.x/this.rulerConfig.major,this.rulerConfig.useInches||(o.originx*=me.Common.MetricConv);else{if(!e)return void F.Debug("= U.DocUtil: RulerHandleDoubleClick - Early Exit: No valid direction specified.");o.originy=n.y/this.rulerConfig.major,this.rulerConfig.useInches||(o.originy*=me.Common.MetricConv)}this.SetRulers(o),this.ShowCoordinates(!0);const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);Qo.UpdateSelectionAttributes(t),F.Debug("= U.DocUtil: RulerHandleDoubleClick - Output:",{updatedOrigins:o,selectedObjects:t})}}}RulerDragGuides(t,e,i){F.Debug("= U.DocUtil: RulerDragGuides - Input:",{dragEvent:t,isVerticalRuler:e,isHorizontalRuler:i});const o=this.svgDoc.GetWorkArea(),n=1/o.docScale,s=`${4*n},${2*n}`;if(this.rulerInDrag){(this.hRulerGuide&&!i||this.vRulerGuide&&!e||i&&!this.hRulerGuide||e&&!this.vRulerGuide)&&(this.RulerEndGuides(),this.rulerInDrag=!0),e&&!this.hRulerGuide&&(this.hRulerGuide=this.svgDoc.CreateShape(me.CSType.Line),this.hRulerGuide.SetFillColor("none"),this.hRulerGuide.SetStrokeColor("black"),this.hRulerGuide.SetStrokeWidth(n),this.hRulerGuide.SetStrokePattern(s),ye.opt.svgOverlayLayer.AddElement(this.hRulerGuide)),i&&!this.vRulerGuide&&(this.vRulerGuide=this.svgDoc.CreateShape(me.CSType.Line),this.vRulerGuide.SetFillColor("none"),this.vRulerGuide.SetStrokeColor("black"),this.vRulerGuide.SetStrokeWidth(n),this.vRulerGuide.SetStrokePattern(s),ye.opt.svgOverlayLayer.AddElement(this.vRulerGuide)),this.rulerGuideWinPos.x=t.gesture.center.clientX,this.rulerGuideWinPos.y=t.gesture.center.clientY,i||(this.rulerGuideWinPos.x=o.dispX+o.dispWidth/2),e||(this.rulerGuideWinPos.y=o.dispY+o.dispHeight/2),this.RulerDrawGuides();!this.rulerGuideScrollTimer&&(!(e&&i)||this.rulerGuideWinPos.x>o.dispX&&this.rulerGuideWinPos.y>o.dispY)&&(this.rulerGuideScrollTimer=setInterval((()=>{ye.docUtil.RulerAutoScrollGuides()}),100))}F.Debug("= U.DocUtil: RulerDragGuides - Output:",{horizontalGuide:this.hRulerGuide?"exists":"null",verticalGuide:this.vRulerGuide?"exists":"null",guidePosition:this.rulerGuideWinPos,autoScrollTimer:this.rulerGuideScrollTimer?"active":"inactive"})}RulerAutoScrollGuides(){F.Debug("= U.DocUtil: RulerAutoScrollGuides - Input:",{rulerGuideWinPos:this.rulerGuideWinPos,workArea:this.svgDoc.GetWorkArea()});const t=this.svgDoc.GetWorkArea();let e=!1;const i=this.svgDoc.ConvertWindowToDocCoords(this.rulerGuideWinPos.x,this.rulerGuideWinPos.y);(this.rulerGuideWinPos.x<t.dispX||this.rulerGuideWinPos.x>t.dispX+t.dispWidth||this.rulerGuideWinPos.y<t.dispY||this.rulerGuideWinPos.y>t.dispY+t.dispHeight)&&(e=!0),e&&(this.ScrollToPosition(i.x,i.y),this.RulerDrawGuides()),F.Debug("= U.DocUtil: RulerAutoScrollGuides - Output:",{autoScrollPerformed:e,documentCoordinates:i})}RulerDrawGuides(){F.Debug("= U.DocUtil: RulerDrawGuides - Input:",{mouseWindowPosition:this.rulerGuideWinPos,hRulerGuide:this.hRulerGuide?"exists":"null",vRulerGuide:this.vRulerGuide?"exists":"null"});const t=this.svgDoc.GetWorkArea();let e=this.svgDoc.ConvertWindowToDocCoords(this.rulerGuideWinPos.x,this.rulerGuideWinPos.y);this.docConfig.enableSnap&&(e=this.SnapToGrid(e)),this.vRulerGuide&&(e.x<t.docVisX?e.x=t.docVisX:e.x>t.docVisX+t.docVisWidth&&(e.x=t.docVisX+t.docVisWidth),this.vRulerGuide.SetPoints(e.x,0,e.x,t.docHeight)),this.hRulerGuide&&(e.y<t.docVisY?e.y=t.docVisY:e.y>t.docVisY+t.docVisHeight&&(e.y=t.docVisY+t.docVisHeight),this.hRulerGuide.SetPoints(0,e.y,t.docWidth,e.y)),F.Debug("= U.DocUtil: RulerDrawGuides - Output:",{constrainedCoordinates:e,workAreaBounds:{horizontal:{min:t.docVisX,max:t.docVisX+t.docVisWidth},vertical:{min:t.docVisY,max:t.docVisY+t.docVisHeight}}})}RulerEndGuides(){F.Debug("= U.DocUtil: RulerEndGuides - Input:",{rulerGuideScrollTimer:this.rulerGuideScrollTimer,horizontalRulerGuide:this.hRulerGuide,verticalRulerGuide:this.vRulerGuide,rulerInDrag:this.rulerInDrag}),this.rulerGuideScrollTimer&&(clearInterval(this.rulerGuideScrollTimer),this.rulerGuideScrollTimer=null),this.hRulerGuide&&(ye.opt.svgOverlayLayer.RemoveElement(this.hRulerGuide),this.hRulerGuide=null),this.vRulerGuide&&(ye.opt.svgOverlayLayer.RemoveElement(this.vRulerGuide),this.vRulerGuide=null),this.rulerInDrag=!1,F.Debug("= U.DocUtil: RulerEndGuides - Output:",{rulerGuideScrollTimer:this.rulerGuideScrollTimer,horizontalRulerGuide:this.hRulerGuide,verticalRulerGuide:this.vRulerGuide,rulerInDrag:this.rulerInDrag})}SnapRect(t){F.Debug("= U.DocUtil: SnapRect - Input:",t);const e={x:t.x,y:t.y},i={x:t.x+t.width,y:t.y+t.height},o=this.SnapToGrid(e),n=this.SnapToGrid(i),s=o.x-e.x,a=n.x-i.x,r=Math.abs(s)>Math.abs(a)?a:s,l=o.y-e.y,h=n.y-i.y,c={x:r,y:Math.abs(l)>Math.abs(h)?h:l};return F.Debug("= U.DocUtil: SnapRect - Output:",c),c}UpdateConfig(t){F.Debug("= U.DocUtil: UpdateConfig - Input:",t),this.docConfig=t,this.UpdateRulerVisibility(),this.UpdateGridVisibility(),F.Debug("= U.DocUtil: UpdateConfig - Output: Updated docConfig",this.docConfig)}GetBackground(){F.Debug("= U.DocUtil: GetBackground - Input: Getting background element");const t=this.backgroundElem;return F.Debug("= U.DocUtil: GetBackground - Output:",t?"Background element retrieved":"No background element"),t}IsReadOnly(){return F.Info(" IsReadOnly check:",{readOnlyState:false}),false}ZoomChange(t,e){F.Debug("= u.DocUtil: ZoomChange/ - Input:",{newZoomScale:t,newZoomStep:e});const i=ye.docUtil.GetZoomFactor();F.Debug("= u.DocUtil: ZoomChange/ - Current Zoom Factor:",i);const o=t>i;t&&t>0&&this.ZoomInAndOut(o,!1,t,e),F.Debug("= u.DocUtil: ZoomChange/ - Output: Zoom changed to",t)}ZoomSpecify(t,e){this.SetZoomLevel(100*t,e),_o.SaveToLocalStorage(),ye.docUtil.UpdateRefZoomScale(Number(t.toFixed(2))),F.Debug("= u.DocUtil: ZoomInAndOut/ - New zoom factor set:",Number(t.toFixed(2)))}ZoomInAndOut(t,e,i,o){F.Debug("= u.DocUtil: ZoomInAndOut/ - Input:",{isZoomIn:t,skipCentering:e});const n=o||ge.T3Config.Zoom.Step,s=ge.T3Config.Zoom.Max,a=ge.T3Config.Zoom.Min,r=ye.docUtil.GetZoomFactor();let l=i||1;if(t){if(r>=s)return void F.Debug("= u.DocUtil: ZoomInAndOut/ - Already at maximum zoom (4x), exiting");l=Math.round(r/n)*n,l=parseFloat(l.toFixed(2)),l===r&&(l=r+n),l>s&&(l=s)}else{if(r<=a)return void F.Debug("= u.DocUtil: ZoomInAndOut/ - Already at minimum zoom (0.25x), exiting");l=Math.round(r/n)*n,l=parseFloat(l.toFixed(2)),l===r&&(l=r-n),l<a&&(l=a)}this.SetZoomLevel(100*l,e),_o.SaveToLocalStorage(),ye.docUtil.UpdateRefZoomScale(Number(l.toFixed(2))),F.Debug("= u.DocUtil: ZoomInAndOut/ - New zoom factor set:",Number(l.toFixed(2)))}SetZoomLevel(t,e){F.Debug("= u.DocUtil: SetZoomLevel/ - Input: zoomPct, skipCentering?",{zoomPct:t,skipCentering:e}),t>0&&!this.inZoomIdle&&ye.opt?(Ts.SetDocumentScale(t/100,e),F.Debug("= u.DocUtil: SetZoomLevel/ - Applied zoom factor:",t/100)):F.Debug("= u.DocUtil: SetZoomLevel/ - Zoom not applied. Conditions not met:",{validZoom:t>0,notIdle:!this.inZoomIdle,optManagerExists:!!ye.opt}),_o.SaveToLocalStorage()}SetZoomLevelByIndex(t){if(F.Debug("O.DocOpt - SetZoomLevelByIndex - Input:",{zoomIndex:t}),t<0||t>=this.docConfig.zoomLevels.length)F.Debug("O.DocOpt - SetZoomLevelByIndex - Invalid zoom index, out of bounds");else if(this.docConfig.zoom=t,ye.opt){const e=this.docConfig.zoomLevels[t]/100;F.Debug("O.DocOpt - SetZoomLevelByIndex - Setting zoom factor:",e),Ts.SetDocumentScale(e)}else F.Debug("O.DocOpt - SetZoomLevelByIndex - OptManager not available, zoom not applied")}IdleZoomCtls(){F.Debug("O.DocOpt - IdleZoomControls - Entering function");const t=Rt("#zoom-ctl-id"),e=Math.round(100*ye.docUtil.GetZoomFactor());F.Debug("O.DocOpt - IdleZoomControls - Current zoom percentage:",e),ye.docUtil.GetSizeToFit(),this.inZoomIdle=!0,t.val(e).change(),this.inZoomIdle=!1,F.Debug("O.DocOpt - IdleZoomControls - Zoom controls updated")}ZoomIn(){this.ZoomInAndOut(!0)}ZoomOut(){this.ZoomInAndOut(!1)}UpdateRefZoomScale(t){Nn.value=t}LoadRulersSetting(){var t,e;const i=_o.LoadDocSettingData(),o=null==(e=null==(t=null==i?void 0:i.docConfig)?void 0:t.showRulers)||e;this.docConfig.showRulers=o,ia.SetShowRulers(o),this.UpdateRulerVisibility(),F.Debug("= U.DocUtil: LoadRulersSetting - Output:",{showRulers:o})}LoadGridSetting(){var t,e;const i=_o.LoadDocSettingData(),o=null==(e=null==(t=null==i?void 0:i.docConfig)?void 0:t.showGrid)||e;this.docConfig.showGrid=o,ia.SetShowGrid(o),this.UpdateGridVisibility(),F.Debug("= U.DocUtil: LoadGridSetting - Output:",{showGrid:o})}RemoveAllLayers(){const t=ye.opt.layersManagerBlockId,e=ws.GetObjectPtr(t,!1).layers;F.Info("= u.DocUtil: RemoveAllLayers - Input:",{layersManagerBlockId:t,layers:e}),this.svgDoc.RemoveLayer("0")}}class na{constructor(){a(this,"uiArrowDefs"),a(this,"InitArrowDefs",(()=>{this.uiArrowDefs=[{id:0,desc:"No arrow",defArea:{width:1,height:1},endPt:{x:0,y:0},attachPt:{x:0,y:0},centered:!1,geometry:[]},{id:1,desc:"Filled arrow",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,0],["L",10,5],["L",0,10],["z"]]}]},{id:2,desc:"Line arrow",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,5],["L",0,10]]}]},{id:3,desc:"Fancy arrow",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,0],["L",10,5],["L",0,10],["L",5,5],["z"]]}]},{id:4,desc:"Filled circle",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"OVAL",filled:!0,pathData:{x:0,y:0,width:10,height:10}}]},{id:5,desc:"Unfilled circle",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"OVAL",filled:!1,stroke:.5,pathData:{x:0,y:0,width:10,height:10}}]},{id:6,desc:"Filled square",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"RECT",filled:!0,pathData:{x:0,y:0,width:10,height:10}}]},{id:7,desc:"Unfilled square",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"RECT",filled:!1,stroke:.5,pathData:{x:0,y:0,width:10,height:10}}]},{id:8,desc:"Crows foot",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,5],["L",10,0],["M",0,5],["L",10,5],["M",0,5],["L",10,10]]}]},{id:9,desc:"Back slash",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,10]]}]},{id:10,desc:"Filled crows foot",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,5],["L",10,0],["L",10,10],["z"]]}]},{id:11,desc:"Filled diamond",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,5],["L",10,0],["L",20,5],["L",10,10],["z"]]}]},{id:12,desc:"Zero to many",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"OVAL",filled:!1,stroke:.5,pathData:{x:0,y:0,width:10,height:10}},{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",20,0],["M",10,5],["L",20,5],["M",10,5],["L",20,10]]}]},{id:13,desc:"One to many",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",5,0],["L",5,10]]},{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",20,0],["M",10,5],["L",20,5],["M",10,5],["L",20,10]]}]},{id:14,desc:"Zero to one",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"OVAL",filled:!1,stroke:.5,pathData:{x:0,y:0,width:10,height:10}},{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",20,5],["M",15,0],["L",15,10]]}]},{id:15,desc:"One to one",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:20,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",5,0],["L",5,10],["M",10,0],["L",10,10]]}]},{id:16,desc:"One to zero",defArea:{width:20,height:10},endPt:{x:15,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",5,0],["L",5,10]]},{type:"OVAL",filled:!1,stroke:.5,pathData:{x:10,y:0,width:10,height:10}}]},{id:17,desc:"Center filled arrow",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!0,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,0],["L",10,5],["L",0,10],["z"]]}]},{id:18,desc:"Center line arrow",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!0,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,5],["L",0,10]]}]},{id:19,desc:"Center fancy arrow",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!0,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,0],["L",10,5],["L",0,10],["L",5,5],["z"]]}]},{id:20,desc:"Double arrow",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,0],["L",10,5],["L",0,10],["z"]]},{type:"PATH",filled:!0,pathData:[["M",10,0],["L",20,5],["L",10,10],["z"]]}]},{id:21,desc:"Filled dimension arrow",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",0,0],["L",10,5],["L",0,10],["z"]]},{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,0],["L",10,10]]}]},{id:22,desc:"Line dimension arrow",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,5],["L",0,10]]},{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,0],["L",10,10]]}]},{id:23,desc:"Dimension line",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,0],["L",10,10]]}]},{id:25,desc:"Arc down",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:1,pathData:[["M",5,5],["A",5,5,0,0,1,10,10]]}],flippedGeometry:[{type:"PATH",filled:!1,stroke:1,pathData:[["M",5,5],["A",5,5,0,0,0,10,0]]}]},{id:26,desc:"Arc up",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:1,pathData:[["M",5,5],["A",5,5,0,0,0,10,0]]}],flippedGeometry:[{type:"PATH",filled:!1,stroke:1,pathData:[["M",5,5],["A",5,5,0,0,1,10,10]]}]},{id:27,desc:"Half arrow up",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,5]]}],flippedGeometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,10],["L",10,5]]}]},{id:28,desc:"Half arrow down",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,10],["L",10,5]]}],flippedGeometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,5]]}]},{id:29,desc:"Center cross",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!0,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,10],["M",0,10],["L",10,0]]}]},{id:30,desc:"Half line up",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",10,0]]}],flippedGeometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",10,10]]}]},{id:31,desc:"Half line down",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",10,10]]}],flippedGeometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",10,5],["L",10,0]]}]},{id:32,desc:"Slash",defArea:{width:10,height:10},endPt:{x:5,y:5},attachPt:{x:5,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,10],["L",10,0]]}]},{id:33,desc:"Unfilled arrow",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",10,5],["L",0,10],["z"]]}]},{id:34,desc:"Unfilled crows foot",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,5],["L",10,0],["L",10,10],["z"]]}]},{id:35,desc:"Unfilled diamond",defArea:{width:20,height:10},endPt:{x:20,y:5},attachPt:{x:0,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,5],["L",10,0],["L",20,5],["L",10,10],["z"]]}]},{id:36,desc:"Single line cross",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!1,stroke:.5,pathData:[["M",0,0],["L",0,10]]}]},{id:37,desc:"down indicator",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",10,5],["L",10,10],["L",5,5],["z"]]}],flippedGeometry:[{type:"PATH",filled:!0,pathData:[["M",10,5],["L",10,0],["L",5,5],["z"]]}]},{id:38,desc:"up indicator",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:10,y:5},centered:!1,geometry:[{type:"PATH",filled:!0,pathData:[["M",10,5],["L",10,0],["L",5,5],["z"]]}],flippedGeometry:[{type:"PATH",filled:!0,pathData:[["M",10,5],["L",10,10],["L",5,5],["z"]]}]},{id:39,desc:"round end",defArea:{width:10,height:10},endPt:{x:10,y:5},attachPt:{x:5,y:5},centered:!1,fixedSizeScale:1,geometry:[{type:"OVAL",filled:!0,pathData:{x:0,y:0,width:10,height:10}}]}]})),this.InitArrowDefs()}}class sa{constructor(){a(this,"uiarrowSizes",[]),a(this,"InitArrowSizes",(()=>{this.uiarrowSizes=[2,4,6,1.5,3,12,24]})),this.InitArrowSizes()}}class aa{constructor(){a(this,"selected"),a(this,"lib"),this.selected=0,this.lib=[]}}var ra=Object.defineProperty,la=Object.getOwnPropertyDescriptor,ha=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?la(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&ra(e,i,s),s};class ca{constructor(){a(this,"Page"),a(this,"MaxWorkDim"),a(this,"DimensionFont"),a(this,"DimensionFontStyle"),a(this,"flags"),a(this,"BusinessModule"),a(this,"dateformat"),a(this,"originaltemplate"),a(this,"orgcharttable"),a(this,"exportpath"),a(this,"presentationBackground"),a(this,"presentationName"),a(this,"importSourcePath"),a(this,"defaultlibs"),a(this,"lp_list"),a(this,"ClipboardBuffer"),a(this,"ClipboardType"),a(this,"holidaymask"),a(this,"DocIsDirty"),a(this,"AllowReplace"),a(this,"FontList"),a(this,"SymbolSearchString"),a(this,"ParentPageID"),a(this,"clipboardJson"),this.Initialize()}Initialize(){this.Page=new Hi,this.MaxWorkDim=new De(me.Common.MaxWorkDimX,me.Common.MaxWorkDimY),this.DimensionFont=new _i,this.DimensionFontStyle=new xi,this.flags=me.HeaderFlags.Pages,this.BusinessModule="",this.dateformat=-1,this.originaltemplate="",this.orgcharttable="",this.exportpath="",this.presentationBackground="",this.presentationName="",this.importSourcePath="",this.defaultlibs="",this.lp_list=new aa,this.ClipboardBuffer=null,this.ClipboardType=Ae.ClipboardType.None,this.clipboardJson=null,this.holidaymask=0,this.DocIsDirty=!1,this.AllowReplace=!0,this.FontList=[],this.SymbolSearchString="",this.ParentPageID=""}}ha([jt((()=>Hi))],ca.prototype,"Page",2),ha([jt((()=>De))],ca.prototype,"MaxWorkDim",2),ha([jt((()=>_i))],ca.prototype,"DimensionFont",2),ha([jt((()=>xi))],ca.prototype,"DimensionFontStyle",2),ha([jt((()=>aa))],ca.prototype,"lp_list",2);class pa{constructor(){a(this,"mr"),a(this,"croprect"),a(this,"imageflags"),a(this,"scale"),a(this,"iconid"),this.mr={x:0,y:0,width:0,height:0},this.croprect={left:0,top:0,right:0,bottom:0},this.imageflags=Se.ImageScales.CropToFit,this.scale=1,this.iconid=0}}class da{constructor(){a(this,"svgDocId"),a(this,"svgDoc"),a(this,"svgObjectLayer"),a(this,"svgOverlayLayer"),a(this,"svgHighlightLayer"),a(this,"svgCollabLayer"),a(this,"sVGroot"),a(this,"optSlt"),a(this,"optSltStartX"),a(this,"optSltStartY"),a(this,"optSltFrame"),a(this,"dragElementList"),a(this,"dragBBoxList"),a(this,"dragEnclosingRect"),a(this,"dragStartX"),a(this,"dragStartY"),a(this,"dragDeltaX"),a(this,"dragDeltaY"),a(this,"dragTargetId"),a(this,"dragTargetBBox"),a(this,"dragGotMove"),a(this,"dragGotAutoResizeRight"),a(this,"dragGotAutoResizeBottom"),a(this,"dragGotAutoResizeOldX"),a(this,"dragGotAutoResizeOldY"),a(this,"theDragGotAutoResizeOldLeft"),a(this,"theDragGotAutoResizeOldTop"),a(this,"moveList"),a(this,"moveBounds"),a(this,"pinRect"),a(this,"theDragGotAutoResizeLeft"),a(this,"theDragGotAutoResizeTop"),a(this,"noUndo"),a(this,"actionStoredObjectId"),a(this,"actionSvgObject"),a(this,"actionTriggerId"),a(this,"actionTriggerData"),a(this,"actionStartX"),a(this,"actionStartY"),a(this,"actionTableLastX"),a(this,"actionTableLastY"),a(this,"actionOldExtra"),a(this,"actionBBox"),a(this,"actionNewBBox"),a(this,"actionLockAspectRatio"),a(this,"actionAspectRatioWidth"),a(this,"actionAspectRatioHeight"),a(this,"crtOpt"),a(this,"drawShape"),a(this,"drawStartX"),a(this,"drawStartY"),a(this,"lineDrawStartX"),a(this,"lineDrawStartY"),a(this,"lineDrawId"),a(this,"lineDrawLineId"),a(this,"lineStamp"),a(this,"dynamicGuides"),a(this,"rotateKnobCenterDivisor"),a(this,"rotateStartPoint"),a(this,"rotateEndPoint"),a(this,"rotateObjectRadians"),a(this,"rotateStartRotation"),a(this,"rotateEndRotation"),a(this,"rotatePivotX"),a(this,"rotatePivotY"),a(this,"rotateSnap"),a(this,"enhanceRotateSnap"),a(this,"autoScrollTimer"),a(this,"autoScrollTimerId"),a(this,"autoScrollXPos"),a(this,"autoScrollYPos"),a(this,"inAutoScroll"),a(this,"mainAppElement"),a(this,"mainAppHammer"),a(this,"workAreaElement"),a(this,"WorkAreaHammer"),a(this,"documentElement"),a(this,"documentElementHammer"),a(this,"workAreaTextInputProxy"),a(this,"TEHammer"),a(this,"TEWorkAreaHammer"),a(this,"clickAreaHammer"),a(this,"decAreaHammer"),a(this,"noteAreaHammer"),a(this,"textHammer"),a(this,"editModeList"),a(this,"selectObjsBlockId"),a(this,"sdDataBlockId"),a(this,"teDataBlockId"),a(this,"layersManagerBlockId"),a(this,"linksBlockId"),a(this,"stampTimeout"),a(this,"stampCompleteCallback"),a(this,"stampCompleteUserData"),a(this,"stampHCenter"),a(this,"stampVCenter"),a(this,"stampShapeOffsetX"),a(this,"stampShapeOffsetY"),a(this,"stampSticky"),a(this,"lastOpDuplicate"),a(this,"formatPainterMode"),a(this,"formatPainterStyle"),a(this,"formatPainterSticky"),a(this,"formatPainterText"),a(this,"formatPainterParaFormat"),a(this,"formatPainterArrows"),a(this,"nudgeDelta"),a(this,"nudgeOpen"),a(this,"nudgeX"),a(this,"nudgeY"),a(this,"nudgeGrowX"),a(this,"nudgeGrowY"),a(this,"useDefaultStyle"),a(this,"newObjectVisible"),a(this,"TextureList"),a(this,"nStdTextures"),a(this,"richGradients"),a(this,"header"),a(this,"FileVersion"),a(this,"bDrawEffects"),a(this,"hasBlockDirectory"),a(this,"nDataStoreStart"),a(this,"textClipboard"),a(this,"htmlClipboard"),a(this,"imageClipboard"),a(this,"cutFromButton"),a(this,"topLeftPastePos"),a(this,"topLeftPasteScrollPos"),a(this,"pasteCount"),a(this,"dirtyList"),a(this,"dirtyListMoveOnly"),a(this,"dirtyListReOrder"),a(this,"curNoteShape"),a(this,"curNoteGraphPint"),a(this,"bInNoteEdit"),a(this,"bNoteChanged"),a(this,"emptySymbolList"),a(this,"emptyEMFList"),a(this,"addCount"),a(this,"symbolLibraryItemID"),a(this,"bitmapImportCanvas"),a(this,"bitmapImportCanvasCTX"),a(this,"bitmapScaledCanvas"),a(this,"bitmapScaledCanvasCTX"),a(this,"bitmapImportSourceWidth"),a(this,"bitmapImportSourceHeight"),a(this,"bitmapImportDestWidth"),a(this,"bitmapImportDestHeight"),a(this,"bitmapImportMaxScaledWidth"),a(this,"bitmapImportMaxScaledHeight"),a(this,"bitmapImportDPI"),a(this,"bitmapImportMimeType"),a(this,"bitmapImportOriginalSize"),a(this,"bitmapImportScaledSize"),a(this,"scaledBitmapCallback"),a(this,"bitmapImportEXIFdata"),a(this,"bitmapImportFile"),a(this,"bitmapImportResult"),a(this,"wasClickInShape"),a(this,"textEntryTimer"),a(this,"eventTimestamp"),a(this,"actionArrowHideTimer"),a(this,"uniqueId"),a(this,"fromOverlayLayer"),a(this,"postMoveSelectId"),a(this,"bBuildingSymbols"),a(this,"bTokenizeStyle"),a(this,"linkParams"),a(this,"rClickParam"),a(this,"bInDimensionEdit"),a(this,"oldAllowSave"),a(this,"doubleClickSymbolTimeStamp"),a(this,"importContext"),a(this,"curHiliteShape"),a(this,"cachedHeight"),a(this,"cachedWidth"),a(this,"commentUserIds"),a(this,"activeExpandedView"),a(this,"alternateStateManagerVars"),a(this,"socketAction"),a(this,"pageAction"),a(this,"pagesToDelete"),a(this,"oldFileMetaData"),a(this,"selectionState"),a(this,"forcedotted"),a(this,"ob"),a(this,"PastePoint"),a(this,"OldConnectorExtra"),a(this,"OldConnectorWd"),a(this,"OldConnectorHt"),a(this,"OldConnectorGap"),a(this,"ConnectorList"),a(this,"ConnectorWidthList"),a(this,"flowchartShift"),a(this,"HookedObjectMovingTimer"),a(this,"HookedObjectMovingLastExecutionTime")}InitializeProperties(){this.svgDocId="#svg-area",this.svgObjectLayer=null,this.svgOverlayLayer=null,this.svgHighlightLayer=null,this.svgCollabLayer=null,this.sVGroot=null,this.optSlt=null,this.optSltStartX=0,this.optSltStartY=0,this.optSltFrame={x:0,y:0,width:0,height:0},this.dragElementList=[],this.dragStartX=0,this.dragStartY=0,this.dragDeltaX=0,this.dragDeltaY=0,this.dragTargetId=null,this.dragGotMove=!1,this.dragBBoxList=[],this.dragTargetBBox={},this.dragEnclosingRect=null,this.dragGotAutoResizeRight=!1,this.dragGotAutoResizeBottom=!1,this.dragGotAutoResizeOldX=[],this.dragGotAutoResizeOldY=[],this.theDragGotAutoResizeOldLeft=[],this.theDragGotAutoResizeOldTop=[],this.theDragGotAutoResizeLeft=!1,this.theDragGotAutoResizeTop=!1,this.moveList=[],this.moveBounds=null,this.pinRect=null,this.noUndo=!1,this.actionStoredObjectId=-1,this.actionSvgObject=null,this.actionTriggerId=0,this.actionTriggerData=0,this.actionStartX=0,this.actionStartY=0,this.actionTableLastX=0,this.actionTableLastY=0,this.actionOldExtra=0,this.actionBBox={},this.actionNewBBox={},this.actionLockAspectRatio=!1,this.actionAspectRatioWidth=0,this.actionAspectRatioHeight=0,this.crtOpt=me.OptTypes.None,this.drawShape=null,this.drawStartX=0,this.drawStartY=0,this.lineDrawStartX=0,this.lineDrawStartY=0,this.lineDrawId=-1,this.lineDrawLineId=-1,this.lineStamp=!1,this.fromOverlayLayer=!1,this.dynamicGuides=null,this.rotateKnobCenterDivisor={x:2,y:2},this.rotateStartPoint={},this.rotateEndPoint={},this.rotateObjectRadians=0,this.rotateStartRotation=0,this.rotateEndRotation=0,this.rotatePivotX=0,this.rotatePivotY=0,this.rotateSnap=5,this.enhanceRotateSnap=45,this.autoScrollTimer=new gn(this),this.autoScrollTimerId=-1,this.autoScrollXPos=0,this.autoScrollYPos=0,this.inAutoScroll=!1,this.mainAppElement=null,this.mainAppHammer=null,this.workAreaElement=null,this.WorkAreaHammer=null,this.workAreaTextInputProxy=null,this.TEHammer=null,this.TEWorkAreaHammer=null,this.clickAreaHammer=null,this.decAreaHammer=null,this.noteAreaHammer=null,this.textEntryTimer=null,this.editModeList=null,this.selectObjsBlockId=-1,this.sdDataBlockId=-1,this.teDataBlockId=-1,this.layersManagerBlockId=-1,this.linksBlockId=-1,this.stampTimeout=null,this.stampCompleteCallback=null,this.stampCompleteUserData=null,this.stampHCenter=!0,this.stampVCenter=!0,this.stampShapeOffsetX=0,this.stampShapeOffsetY=0,this.stampSticky=!1,this.lastOpDuplicate=!1,this.formatPainterMode=Ne.FormatPainterModes.None,this.formatPainterStyle=new ni,this.formatPainterSticky=!1,this.formatPainterText=new ni,this.formatPainterParaFormat=new Ci,this.formatPainterArrows=null,this.nudgeDelta=10,this.nudgeOpen=!1,this.nudgeX=0,this.nudgeY=0,this.nudgeGrowX=0,this.nudgeGrowY=0,this.useDefaultStyle=!1,this.newObjectVisible=!1,this.TextureList=new Qi,this.nStdTextures=0,this.richGradients=[],this.header=new ca,this.FileVersion=41,this.bDrawEffects=!0,this.hasBlockDirectory=!1,this.nDataStoreStart=ye.stdObj.storedObjects.length,this.textClipboard=null,this.htmlClipboard=null,this.imageClipboard=null,this.cutFromButton=!1,this.topLeftPastePos={x:0,y:0},this.topLeftPasteScrollPos={x:0,y:0},this.pasteCount=0,this.dirtyList=[],this.dirtyListMoveOnly=[],this.dirtyListReOrder=!1,this.bInNoteEdit=!1,this.bNoteChanged=!1,this.wasClickInShape=!1,this.eventTimestamp=0,this.actionArrowHideTimer=new gn(this),this.uniqueId=0,this.bInDimensionEdit=!1,this.oldAllowSave=!0,this.postMoveSelectId=null,this.bBuildingSymbols=!1,this.bTokenizeStyle=!1,this.linkParams=null,this.rClickParam=null,this.curHiliteShape=-1,this.doubleClickSymbolTimeStamp=0,this.importContext=null,this.cachedHeight=null,this.cachedWidth=null,this.emptySymbolList=[],this.emptyEMFList=[],this.addCount=0,this.symbolLibraryItemID=-1,this.bitmapImportCanvas=null,this.bitmapImportCanvasCTX=null,this.bitmapScaledCanvas=null,this.bitmapScaledCanvasCTX=null,this.bitmapImportSourceWidth=0,this.bitmapImportSourceHeight=0,this.bitmapImportDestWidth=800,this.bitmapImportDestHeight=800,this.bitmapImportMaxScaledWidth=1200,this.bitmapImportMaxScaledHeight=1200,this.bitmapImportDPI=200,this.bitmapImportMimeType="",this.bitmapImportOriginalSize=0,this.bitmapImportScaledSize=0,this.scaledBitmapCallback=null,this.bitmapImportEXIFdata=null,this.bitmapImportFile=null,this.bitmapImportResult=null,this.commentUserIds=[],this.activeExpandedView=null,this.alternateStateManagerVars={bHasBeenSaved:!1},this.socketAction=[],this.pageAction=[],this.pagesToDelete=[],this.oldFileMetaData=null,this.selectionState=new Ke,this.InitBlockData()}InitBlockData(){const t=ye.stdObj.CreateBlock(Ce.StoredObjectType.SelectedListObject,[]);this.selectObjsBlockId=t.ID;const e=new Zi;e.def.style=new ni,e.def.pen=Oe.DeepCopy(me.Common.PenStylingDefault),e.def.highlighter=Oe.DeepCopy(me.Common.HighlighterStylingDefault),e.d_sarrow=0,e.d_sarrowdisp=!1,e.d_earrow=0,e.d_earrowdisp=!1,e.d_arrowsize=1,e.CurrentTheme=null;const i=ye.stdObj.CreateBlock(Ce.StoredObjectType.SDDataObject,e);this.sdDataBlockId=i.ID;const o=new Fi,n=new Ai;n.name=me.Common.DefaultLayerName,o.layers.push(n),o.nlayers=1,o.activelayer=0;const s=ye.stdObj.CreateBlock(Ce.StoredObjectType.LayersManagerObject,o);this.layersManagerBlockId=s.ID;const a=new ao,r=ye.stdObj.CreateBlock(Ce.StoredObjectType.TEDataObject,a);this.teDataBlockId=r.ID;const l=ye.stdObj.CreateBlock(Ce.StoredObjectType.LinkListObject,[]);this.linksBlockId=l.ID}Initialize(t=!1){ws.PreserveUndoState(!0),Ts.InitSvgDocument(t),Ts.InitT3GvOpt(),this.sVGroot=this.svgDoc.svgObj.node,Qo.UpdateSelectionAttributes(null),this.BuildarrowHlkTables(),Ps.SetEditMode(Se.EditState.Default)}HandleDimensionEditMode(t){F.Debug("= O.OptUtil  HandleDimensionEditMode - Input:",t);const e=bi.TextFace;this.selectionState.fontid=-1,this.selectionState.fontsize=ye.opt.header.DimensionFont.fontSize,this.selectionState.bold=(ye.opt.header.DimensionFont.face&e.Bold)>0,this.selectionState.italic=(ye.opt.header.DimensionFont.face&e.Italic)>0,this.selectionState.underline=(ye.opt.header.DimensionFont.face&e.Underline)>0,this.selectionState.superscript=(ye.opt.header.DimensionFont.face&e.Superscript)>0,this.selectionState.subscript=(ye.opt.header.DimensionFont.face&e.Subscript)>0,this.selectionState.csOptMng=null,F.Debug("= O.OptUtil  HandleDimensionEditMode - Output: Dimension edit mode processed")}HandleEmptySelectionOrNoteEditMode(t){F.Debug("= O.OptUtil  HandleEmptySelectionOrNoteEditMode - Input:",t);const e=bi.TextFace;if(this.selectionState.fontid=-1,this.selectionState.fontsize=t.def.style.Text.FontSize,this.selectionState.bold=(t.def.style.Text.Face&e.Bold)>0,this.selectionState.italic=(t.def.style.Text.Face&e.Italic)>0,this.selectionState.underline=(t.def.style.Text.Face&e.Underline)>0,this.selectionState.superscript=(t.def.style.Text.Face&e.Superscript)>0,this.selectionState.subscript=(t.def.style.Text.Face&e.Subscript)>0,this.selectionState.TextDirection=0==(t.def.textflags&Se.TextFlags.HorizText),this.selectionState.dimensions=t.dimensions&Se.DimensionFlags.Always||t.dimensions&Se.DimensionFlags.Select,this.bInNoteEdit&&this.curNoteShape>=0){const t=Zo.GetGvSviOpt(this.curNoteShape);t&&(this.selectionState.csOptMng=t)}F.Debug("= O.OptUtil  HandleEmptySelectionOrNoteEditMode - Output: Empty selection or note edit mode processed")}ProcessTargetObject(t,e){F.Debug("= O.OptUtil  ProcessTargetObject - Input:",{targetId:t,targetObject:e});const i=Zo.GetGvSviOpt(t);if(i&&(this.selectionState.csOptMng=i),this.selectionState.tselect=t,e){this.selectionState.colorfilter=e.colorfilter,e.GetPositionRect(),this.selectionState.subtype=e.subtype,this.selectionState.objecttype=e.objecttype,this.selectionState.datasetElemID=e.datasetElemID;const t=e.GetDimensionsForDisplay();this.selectionState.left=t.x,this.selectionState.top=t.y,this.selectionState.width=t.width,this.selectionState.height=t.height,e.objecttype===Se.FNObjectTypes.FlWall&&(this.selectionState.WallThickness=e.StyleRecord.Line.Thickness),this.selectionState.leftstr=e.GetLengthInRulerUnits(this.selectionState.left,ye.docUtil.rulerConfig.originx),this.selectionState.topstr=e.GetLengthInRulerUnits(this.selectionState.top,ye.docUtil.rulerConfig.originy),this.selectionState.widthstr=e.GetLengthInRulerUnits(this.selectionState.width),0!==t.height?this.selectionState.heightstr=e.GetLengthInRulerUnits(this.selectionState.height):this.selectionState.heightstr="",this.selectionState.selectionhastext=e.DataID>=0}F.Debug("= O.OptUtil  ProcessTargetObject - Output: Target object processed")}ProcessSelectedObject(t,e,i){F.Debug("= O.OptUtil  ProcessSelectedObject - Input:",{object:t,textObject:e,objectIndex:i});const o=me.DrawObjectBaseClass;t.ImageURL&&t.ImageURL.length&&this.selectionState.nimageselected++,t instanceof we.Shape.ShapeContainer&&(this.selectionState.lockedTableSelected=!0,this.selectionState.IsTargetTable=!0),t.objecttype===Se.FNObjectTypes.FlWall&&(this.selectionState.iswallselected=!0);let n=t.DrawingObjectBaseClass;switch(t instanceof we.Shape.PolyLineContainer&&(n=o.Shape),n){case o.Shape:this.ProcessShapeObject(t,null);break;case o.Connector:this.ProcessConnectorObject(t);case o.Line:this.ProcessLineObject(t)}e.DataID>=0&&(this.selectionState.selectionhastext=!0),(t instanceof we.Shape.GroupSymbol||t.NativeID>=0)&&this.selectionState.ngroupsselected++,on.HandleTextFormatAttributes(e,i),t instanceof we.Shape.PolyLineContainer&&this.selectionState.npolylinecontainerselected++,t instanceof we.Shape.PolyLine&&t.polylist&&t.polylist.segs&&(this.selectionState.nsegs=t.polylist.segs.length,this.selectionState.polyclosed=t.polylist.closed),this.selectionState.dimensions|=t.Dimensions&(Se.DimensionFlags.Always|Se.DimensionFlags.Select),F.Debug("= O.OptUtil  ProcessSelectedObject - Output: Object processed")}ProcessShapeObject(t,e){this.selectionState.nshapeselected++,t.ShapeType!==me.ShapeType.Rect&&t.ShapeType!==me.ShapeType.RRect||(t.moreflags&me.ObjMoreFlags.FixedRR?-2===this.selectionState.fixedCornerRadius?this.selectionState.fixedCornerRadius=100*t.shapeparam:this.selectionState.fixedCornerRadius!==100*t.shapeparam&&(this.selectionState.fixedCornerRadius=-1):-2===this.selectionState.fixedCornerRadius&&0===t.shapeparam?this.selectionState.fixedCornerRadius=0:this.selectionState.fixedCornerRadius=-1),F.Debug("= O.OptUtil  ProcessShapeObject - Output: Shape object processed")}ProcessConnectorObject(t){F.Debug("= O.OptUtil  ProcessConnectorObject - Input:",t),this.selectionState.nconnectorselected++,t.AllowCurveOnConnector()&&(this.selectionState.connectorCanHaveCurve=!0,-2===this.selectionState.lineCornerRadius?this.selectionState.lineCornerRadius=t.arraylist.curveparam:this.selectionState.lineCornerRadius!==t.arraylist.curveparam&&(this.selectionState.lineCornerRadius=-1)),F.Debug("= O.OptUtil  ProcessConnectorObject - Output: Connector object processed")}ProcessLineObject(t){F.Debug("= O.OptUtil  ProcessLineObject - Input:",t),this.selectionState.nlineselected++;const e=t.TextDirection;0===this.selectionState.TextDirection?this.selectionState.TextDirection=e:this.selectionState.TextDirection!==e&&(this.selectionState.TextDirection=-1),t.LineType===me.LineType.SEGLINE&&(-2===this.selectionState.lineCornerRadius?this.selectionState.lineCornerRadius=t.segl.curveparam:this.selectionState.lineCornerRadius!==t.segl.curveparam&&(this.selectionState.lineCornerRadius=-1)),F.Debug("= O.OptUtil  ProcessLineObject - Output: Line processed",{lineCount:this.selectionState.nlineselected,textDirection:this.selectionState.TextDirection,cornerRadius:this.selectionState.lineCornerRadius})}BuildarrowHlkTables(){F.Debug("= O.OptUtil  BuildarrowHlkTables - Input: No parameters");const t=(new na).uiArrowDefs,e=(new sa).uiarrowSizes;ye.arrowHlkTable.length=t.length;for(let i=0;i<t.length;i++)ye.arrowHlkTable[t[i].id]=t[i];ye.arrowHsTable.length=e.length;for(let i=0;i<e.length;i++)ye.arrowHsTable[i]=e[i];F.Debug("= O.OptUtil  BuildarrowHlkTables - Output: Arrowhead lookup tables built")}SetDimensionVisibility(t,e){}CloseEdit(t,e,i){F.Debug("= O.OptUtil  CloseEdit - Input:",{skipShapeClose:t,closeOption:e,skipTooltipProcessing:i}),this.nudgeOpen,Ts.SetFormatPainter(!0,!1),this.DeactivateAllTextEdit(!1,!t),this.bInNoteEdit,t||this.CloseShapeEdit(e),F.Debug("= O.OptUtil  CloseEdit - Output: done")}DeactivateAllTextEdit(t,e){F.Debug("= O.OptUtil  DeactivateAllTextEdit - Input:",{skipShapeClose:t,closeOption:e});if(-1!==ws.GetObjectPtr(this.teDataBlockId,!1).theActiveTextEditObjectID)on.DeactivateTextEdit(t,e);else{const t=this.svgDoc.GetActiveEdit();null!=t&&t.ID===me.SVGElementClass.DimText&&on.TEUnregisterEvents()}F.Debug("= O.OptUtil  DeactivateAllTextEdit - Output: done")}CloseShapeEdit(t,e,i){F.Debug("= O.OptUtil  CloseShapeEdit - Input:",{providedOutlineId:t,useAlternate:e,alternateOutlineId:i});let o=ws.GetObjectPtr(this.teDataBlockId,!1),n=o.theActiveOutlineObjectID;if(e&&(n=i),n>=0){if(!0===t)return void F.Debug("= O.OptUtil  CloseShapeEdit - Output: Skipping close because providedOutlineId is true");if(t===n)return void F.Debug("= O.OptUtil  CloseShapeEdit - Output: Provided outline id equals active outline id, no action taken");let i=ws.GetObjectPtr(n,!1);if(i){if(i.objecttype===Se.FNObjectTypes.FlWall)return void F.Debug("= O.OptUtil  CloseShapeEdit - Output: Active outline is a wall opt wall, skipping close");i=ws.GetObjectPtr(n,!1),i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line&&i.LineType===me.LineType.POLYLINE&&i.polylist.closed&&this.PolyLineToShape(n)}e||(o=ws.GetObjectPtr(this.teDataBlockId,!0),o.theActiveOutlineObjectID=-1),xs.CompleteOperation()}F.Debug("= O.OptUtil  CloseShapeEdit - Output: Operation complete")}PolyLineToShape(t,e){let i,o,n,s,a,r,l,h,c={x:0,y:0,width:0,height:0};const p=ye.stdObj.PreserveBlock(t);if(null!=p){for(i=p.Data,s=i.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null),r=s.length,i.polylist.dim.x=i.inside.width,i.polylist.dim.y=i.inside.height,i.polylist.offset.x=i.StartPoint.x-i.Frame.x,i.polylist.offset.y=i.StartPoint.y-i.Frame.y,l=i.inside.width,l<1&&(l=1),h=i.inside.height,h<1&&(h=1),o=new we.Shape.Polygon(i),o.NeedsSIndentCount=!0,o.polylist=i.polylist,o.BlockID=i.BlockID,o.StartPoint=i.StartPoint,o.EndPoint=i.EndPoint,o.RotationAngle=i.polylist.Shape_Rotation,o.DataID=i.polylist.Shape_DataID,ve.GetPolyRect(c,s),n=0;n<r;n++)n>0&&s[n].x===s[n-1].x&&s[n].y===s[n-1].y||(s[n].x-=c.x,s[n].y-=c.y,a=new De(s[n].x/l,s[n].y/h),o.VertexArray.push(a));return o.UpdateFrame(i.Frame),p.Data=o,e||(ws.AddToDirtyList(t),Os.RenderDirtySVGObjects()),!0}return!1}EndStampSession(){F.Debug("= O.OptUtil  EndStampSession - Input");Ps.GetEditMode()===Se.EditState.Stamp&&(ye.opt.actionStoredObjectId=-1,xs.CancelObjectDragDrop(!0),ye.opt.mainAppHammer&&ye.opt.UnbindDragDropOrStamp()),F.Debug("= O.OptUtil  EndStampSession - Output: done")}OverrideSnaps(t){if(F.Debug("= O.OptUtil  OverrideSnaps - Input:",t),null==t)return F.Debug("= O.OptUtil  OverrideSnaps - Output: false (no event)"),!1;let e=t.altKey;return t.gesture&&t.gesture.srcEvent&&(e=t.gesture.srcEvent.altKey),F.Debug("= O.OptUtil  OverrideSnaps - Output:",e),!0===e}ExceptionCleanup(t){F.Debug("= O.OptUtil  ExceptionCleanup - Input:",t);try{on.TEUnregisterEvents(),this.DeactivateAllTextEdit(!0),this.CloseEdit(!1,!0),ye.state.ExceptionCleanup(),Ts.ResizeSVGDocument(),Os.RenderAllSVGObjects();ws.GetObjectPtr(this.sdDataBlockId,!1);const t=ws.GetObjectPtr(this.selectObjsBlockId,!1);Qo.UpdateSelectionAttributes(t),F.Debug("= O.OptUtil  ExceptionCleanup - Output: done")}catch(e){throw e}}RemoveNotVisible(t){F.Debug("= O.OptUtil  RemoveNotVisible - Input:",t);const e=Se.ObjFlags.NotVisible,i=[];for(let o=0;o<t.length;o++){const n=t[o],s=ws.GetObjectPtr(n,!1);!s||s.flags&e||i.push(n)}return F.Debug("= O.OptUtil  RemoveNotVisible - Output:",i),i}AllowAddToRecent(t){return F.Debug("= O.OptUtil  allowAddToRecent - Input:",t),t&&t.flags&Se.ObjFlags.TextOnly?(F.Debug("= O.OptUtil  allowAddToRecent - Output:",!1),!1):(F.Debug("= O.OptUtil  allowAddToRecent - Output:",!0),!0)}UnbindDragDropOrStamp(){F.Debug("= O.OptUtil  UnbindDragDropOrStamp - Input: No parameters"),ye.opt.mainAppHammer&&(ye.opt.mainAppHammer.dispose(),ye.opt.mainAppHammer=null),F.Debug("= O.OptUtil  UnbindDragDropOrStamp - Output: DragDrop or Stamp unbound")}GetTargetNode(t){const e=ws.GetObjectPtr(t,!1);return e&&e.hooks.length&&(t=this.GetTargetNode(e.hooks[0].objid)),t}UpdateLinks(){let t,e,i,o,n,s,a,r,l,h,c,p,d,u,g,y,S,m,b,D;F.Debug("= O.OptUtil  UpdateLinks - Input: No parameters");let f=!0,x=!1,C=!1,P=0,T={x:0,y:0},O=[{x:0,y:0}],v={x:0,y:0,width:0,height:0};const w=me;let k=ws.GetObjectPtr(this.linksBlockId,!1),L=!1;if(null==k)return Yo.UpdateLineHops(!0),F.Debug("= O.OptUtil  UpdateLinks - Output: 1 (No links found)"),1;Yo.FixAnyCircularHooks();const A=ws.GetObjectPtr(this.sdDataBlockId,!1),I=ye.docUtil.docConfig.enableSnap;for(ye.docUtil.docConfig.enableSnap=!1,i=k.length-1;i>=0&&!(i>=k.length);i--)k[i].flags&Ee.LinkFlags.DeleteTarget?(L||(k=ws.GetObjectPtr(this.linksBlockId,!0),L=!0),Yo.DeleteLink(k,k[i].targetid,-1,null,0,!1),i=k.length):(k[i].flags&Ee.LinkFlags.DeleteLink||k[i].flagss&Ee.LinkFlags.Break||null==(g=ws.GetObjectPtr(k[i].hookid,!1)))&&(L||(k=ws.GetObjectPtr(this.linksBlockId,!0),L=!0),Yo.DeleteLink(k,k[i].targetid,k[i].hookid,k[i].cellid,0,!1),i=k.length);if(A.flags&w.SessionFlags.NoTreeOverlap||A.flags&w.SessionFlags.IsFlowChart){let t;e=k.length;const o={topconnector:-1,topshape:-1,foundtree:!1};for(i=0;i<e;i++)t=k[i].flags&Ee.LinkFlags.Move,t&&(n=ws.GetObjectPtr(k[i].targetid,!1),o.topshape>=0&&Ps.SetLinkFlag(o.topshape,Ee.LinkFlags.Move),o.topshape=-1,o.foundtree=!1)}for(;f;)for(f=!1,i=0;i<k.length;i++)if(k[i].flags&Ee.LinkFlags.Move){if(L||(k=ws.GetObjectPtr(this.linksBlockId,!0),L=!0),g=ws.GetObjectPtr(k[i].hookid,!0),null==g){k[i].flags=ve.SetFlag(k[i].flags,Ee.LinkFlags.DeleteLink,!0),k[i].flags=ve.SetFlag(k[i].flags,Ee.LinkFlags.Move,!1),C=!0;continue}if(S=Yo.VerifyLink(g,k[i]),S>=0){if(g.LinkNotVisible(),y=ws.GetObjectPtr(k[i].targetid,!1),g.objecttype===Se.FNObjectTypes.Multiplicity&&(k[i].flags=ve.SetFlag(k[i].flags,Ee.LinkFlags.Change,!1)),k[i].flags&Ee.LinkFlags.Change){if(s=g.HookToPoint(g.hooks[S].hookpt,null),P=Se.HookFlags.LcNoSnaps|Se.HookFlags.LcForceEnd,P=ve.SetFlag(P,Se.HookFlags.LcShapeOnLine,!(g instanceof we.Shape.BaseLine)),a=y.GetTargetPoints(s,P,g.BlockID),a){for(r=a.length,u=null,l=0;l<r;l++)d=a[l].x-g.hooks[S].connect.x,p=a[l].y-g.hooks[S].connect.y,c=d*d+p*p,(null==u||c<u)&&(u=c,h=l);null!=h&&(g.hooks[S].connect.x=a[h].x,g.DrawingObjectBaseClass!=me.DrawObjectBaseClass.Connector&&(g.hooks[S].connect.y=a[h].y))}g.hooks[S].hookpt=y.GetBestHook(k[i].hookid,g.hooks[S].hookpt,g.hooks[S].connect),k[i].flags=ve.SetFlag(k[i].flags,Ee.LinkFlags.Change,!1)}if(T=g.HookToPoint(g.hooks[S].hookpt,null),null==T)continue;null!=y&&(O[0].x=g.hooks[S].connect.x,O[0].y=g.hooks[S].connect.y,O=y.GetPerimPts(k[i].targetid,O,g.hooks[S].hookpt,!1,k[i].cellid,k[i].hookid),1===g.hooks.length?(d=O[0].x-T.x,Math.abs(d)<.1&&(d=0),p=O[0].y-T.y,Math.abs(p)<.1&&(p=0),(d||p)&&($o.OffsetShape(k[i].hookid,d,p,me.ActionTriggerType.UpdateLinks),t=g.Frame,(t.x<0||t.y<0||t.x+t.width>A.dim.x||t.y+t.height>A.dim.y)&&(x=!0,o=this.GetTargetNode(k[i].hookid),n=ws.GetObjectPtr(o,!1),n&&(n.flags=ve.SetFlag(n.flags,Se.ObjFlags.Bounds,!0))))):2===g.hooks.length&&g.LinkGrow(k[i].hookid,g.hooks[S].hookpt,O[0])),k[i].flags=ve.SetFlag(k[i].flags,Ee.LinkFlags.Move,!1),f=!0}else C=!0}if(C)for(i=k.length-1;i>=0&&!(i>=k.length);i--)k[i].flags&Ee.LinkFlags.DeleteTarget?(Yo.DeleteLink(k,k[i].targetid,-1,null,0,!1),i=k.length):(k[i].flags&Ee.LinkFlags.DeleteLink||k[i].flagss&Ee.LinkFlags.Break||null==(g=ws.GetObjectPtr(k[i].hookid,!1)))&&(Yo.DeleteLink(k,k[i].targetid,k[i].hookid,k[i].cellid,0,!1),i=k.length);if(x){const t=vs.ZList();for(xs.InitializeAutoGrowDrag(),e=t.length,i=0;i<e;i++)if(b=ws.GetObjectPtr(t[i],!1),b&&b.flags&Se.ObjFlags.Bounds&&(b.flags=ve.SetFlag(b.flags,Se.ObjFlags.Bounds,!1),m=Qo.GetMoveList(t[i],!1,!0,!1,v,!1),d=0,v.x+v.width>A.dim.x&&(d=A.dim.x-(v.x+v.width)),d<-v.x&&(d=-v.x),p=0,v.y+v.height>A.dim.y&&(p=A.dim.y-(v.y+v.height)),p<-v.y&&(p=-v.y),D=m.length,(d||p)&&D))for(l=0;l<D;l++)$o.OffsetShape(m[l],d,p,me.ActionTriggerType.UpdateLinks);this.moveList=null}return ye.docUtil.docConfig.enableSnap=I,F.Debug("= O.OptUtil  UpdateLinks - Output: 0 (Success)"),0}CalcAllObjectEnclosingRect(t,e){F.Debug("= O.OptUtil  CalcAllObjectEnclosingRect - Input:",{shouldUseEdges:t,fitOptions:e});const i=vs.VisibleZList(),o=i.length;let n=0,s=0;const a=ws.GetObjectPtr(this.layersManagerBlockId,!1);let r={x:0,y:0,width:0,height:0};if(0===o)return F.Debug("= O.OptUtil  CalcAllObjectEnclosingRect - Output:",r),r;let l=0,h=0,c=null,p=null,d=[];for(l=0;l<a.nlayers;l++)if(l!==a.activelayer&&a.layers[l].flags&Se.LayerFlags.UseEdges&&(d=d.concat(a.layers[l].zList),t)){n=25,s=25;const t=d.length,e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);for(let i=0;i<t;i++)c=ws.GetObjectPtr(d[i],!1),c&&c.objecttype===Se.FNObjectTypes.Annotation&&c.Frame.y+c.Frame.height>=e.dim.y-me.Common.AnnoHotDist&&(s=10+e.dim.y-c.Frame.y)}let u=0;for(let g=0;g<o;g++){if(h=i[g],d.indexOf(h)>=0)continue;const t=ye.stdObj.GetObject(h);null!=t&&(c=t.Data,c.flags&Se.ObjFlags.NotVisible||(p=e?Oe.DeepCopy(c.Frame):Oe.DeepCopy(c.r),0===u?r=Oe.DeepCopy(p):ve.UnionRect(p,r,r),u++))}return t&&(r.width+=n,r.height+=s),F.Debug("= O.OptUtil  CalcAllObjectEnclosingRect - Output:",r),r}ScrollObjectIntoView(t,e,i){let o;if(F.Debug("= O.OptUtil  ScrollObjectIntoView - Input:",{objectId:t,shouldCenterObject:e,customRect:i}),null!=t&&-1!=t||(t=Qo.GetTargetSelect()),-1==t)return void F.Debug("= O.OptUtil  ScrollObjectIntoView - Output: No valid object ID");if(i)o=i;else{const e=ws.GetObjectPtr(t,!1);if(null==e)return void F.Debug("= O.OptUtil  ScrollObjectIntoView - Output: Object not found");o=e.r}const n=this.svgDoc.docInfo,s={x:n.docVisX,y:n.docVisY,width:n.docVisWidth,height:n.docVisHeight};if(ve.IsRectangleFullyEnclosed(s,o)&&!e)return void F.Debug("= O.OptUtil  ScrollObjectIntoView - Output: Object already visible");let a,r;if((o.width>=s.width||o.height>=s.height)&&ve.UnionRect(s,o,s)&&!e)return void F.Debug("= O.OptUtil  ScrollObjectIntoView - Output: Oversized object, no scroll needed");if(e){const t=s.x+s.width/2,e=s.y+s.height/2,i=o.x+o.width/2,l=e-(o.y+o.height/2);return a=(s.x-(t-i))*n.docToScreenScale,r=(s.y-l)*n.docToScreenScale,ye.docUtil.SetScroll(a,r),void F.Debug("= O.OptUtil  ScrollObjectIntoView - Output: Centered object",{scrollX:a,scrollY:r})}a=s.x,r=s.y;let l=20,h=20;n.docVisWidth<n.docWidth&&(h=30),n.docVisHeight<n.docHeight&&(l=30),o.x<s.x&&(a=o.x-20),o.x+o.width>s.x+s.width&&(a=o.x+o.width-s.width+h),o.y<s.y&&(r=o.y-20),o.y+o.height>s.y+s.height&&(r=o.y+o.height-s.height+l),a*=n.docToScreenScale,r*=n.docToScreenScale,ye.docUtil.SetScroll(a,r),F.Debug("= O.OptUtil  ScrollObjectIntoView - Output: Scrolled to make object visible",{scrollX:a,scrollY:r})}SetControlDragMode(t){F.Debug("= O.OptUtil  SetControlDragMode - Input:",t);const e=t.GetCursor();Ps.SetEditMode(Se.EditState.DragControl,e),F.Debug("= O.OptUtil  SetControlDragMode - Output: Mode set to DRAGCONTROL with cursor type:",e)}UnbindShapeMoveHammerEvents(){F.Debug("= O.OptUtil  UnbindShapeMoveHammerEvents - Input: No parameters"),ye.opt.WorkAreaHammer&&(ye.opt.WorkAreaHammer.off("drag"),ye.opt.WorkAreaHammer.off("dragend"),ye.opt.WorkAreaHammer.off("mousemove")),F.Debug("= O.OptUtil  UnbindShapeMoveHammerEvents - Output: Events unbound")}IsConnectorEndShape(t,e,i){let o;F.Debug("= O.OptUtil  IsConnectorEndShape - Input:",{objectData:t,connectorObject:e,resultContainer:i});const n=!!(t&&t.hooks.length&&0===t.hooks[0].connect.y&&t.hooks[0].connect.x<0&&(null===e&&(e=ws.GetObjectPtr(t.hooks[0].objid,!1)),i&&e&&e.hooks.length&&(o=ws.GetObjectPtr(e.hooks[0].objid,!1))&&o.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector));return n&&(i.id=e.hooks[0].objid,o.extraflags&me.ExtraFlags.NoDelete?(i.nshapes=o.arraylist.hook.length-me.ConnectorDefines.NSkip,i.nshapes<0&&(i.nshapes=0),i.pasted=!1):i.pasted=!0),F.Debug("= O.OptUtil  IsConnectorEndShape - Output:",n),n}IsGenogramPartner(t,e){let i,o;if(F.Debug("= O.OptUtil  IsGenogramPartner - Input:",{objectData:t,resultContainer:e}),t&&t.hooks.length){if(i=ws.GetObjectPtr(t.hooks[0].objid,!1),i&&i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&i.IsGenoConnector())return e.id=t.hooks[0].objid,F.Debug("= O.OptUtil  IsGenogramPartner - Output: true (genogram connector found)"),!0}else if((o=this.FindChildArray(t.BlockID,-1))>=0&&(i=ws.GetObjectPtr(o,!1)).IsGenoConnector())return e.id=o,F.Debug("= O.OptUtil  IsGenogramPartner - Output: true (child genogram connector found)"),!0;return F.Debug("= O.OptUtil  IsGenogramPartner - Output: false"),!1}FindChildArray(t,e){F.Debug("= O.OptUtil  FindChildArray - Input:",{objectId:t,excludeConnectorId:e});const i=ws.GetObjectPtr(this.linksBlockId,!1),o=Ps.FindLink(i,t,!0),n=i.length;if(o>=0){let s=o;for(;s<n&&i[s].targetid===t;){const t=i[s].hookid;if(t!==e){const e=ws.GetObjectPtr(t,!1);if(e&&e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector)return F.Debug("= O.OptUtil  FindChildArray - Output: Found connector:",t),t}s++}}return F.Debug("= O.OptUtil  FindChildArray - Output: No connector found (-1)"),-1}EnhanceSnaps(t){if(F.Debug("= O.OptUtil  EnhanceSnaps - Input:",t),null==t)return F.Debug("= O.OptUtil  EnhanceSnaps - Output: false (null event)"),!1;let e=t.shiftKey;return t.gesture&&t.gesture.srcEvent&&(e=t.gesture.srcEvent.shiftKey),F.Debug("= O.OptUtil  EnhanceSnaps - Output:",e),!0===e}SetShapeOriginNoDirty(t,e,i){F.Debug("= O.OptUtil  SetShapeOriginNoDirty - Input:",{objectId:t,newX:e,newY:i});let o={x:0,y:0},n=ye.stdObj.PreserveBlock(t).Data;o.x=n.Frame.x,o.y=n.Frame.y,n.SetShapeOrigin(e,i),(e-o.x||i-o.y)&&Ps.SetLinkFlag(t,Ee.LinkFlags.Move),F.Debug("= O.OptUtil  SetShapeOriginNoDirty - Output: Shape origin updated")}RotatePointAroundPoint(t,e,i){F.Debug("= O.OptUtil  RotatePointAroundPoint - Input:",{centerPoint:t,targetPoint:e,angleRadians:i});const o={x:e.x,y:e.y},n=Math.sin(i),s=Math.cos(i);o.x-=t.x,o.y-=t.y;const a=o.x*s-o.y*n,r=o.x*n+o.y*s;return o.x=a+t.x,o.y=r+t.y,F.Debug("= O.OptUtil  RotatePointAroundPoint - Output:",o),o}UpdateEdgeLayers(t,e,i){let o,n,s,a,r,l,h,c,p,d;F.Debug("= O.OptUtil  UpdateEdgeLayers - Input:",{objectsToExclude:t,originalDimensions:e,newDimensions:i});let u=!1;const g=me.Common.AnnoHotDist,y=g,S=g,m=e.x-2*g,b=e.y-2*g,D=ws.GetObjectPtr(this.layersManagerBlockId,!1),f=D.layers,x=D.nlayers,C=Oe.DeepCopy(this.dirtyList);for(this.dirtyList=[],o=0;o<x;o++)if(o!==D.activelayer&&f[o].flags&Se.LayerFlags.UseEdges)for(n=f[o].zList,s=n.length,a=0;a<s;a++)r=n[a],t.indexOf(r)>=0||(l=ws.GetObjectPtr(r,!1),l&&(h=l.Frame.x<y,c=l.Frame.y<S,p=l.Frame.x+l.Frame.width>y+m,d=l.Frame.y+l.Frame.height>S+b,l.UseEdges(h,c,p,d,e,i)&&(u=!0)));u&&Os.RenderDirtySVGObjects(),this.dirtyList=C,F.Debug("= O.OptUtil  UpdateEdgeLayers - Output: Edge layers updated, needsRedraw:",u)}SetLinkFlagsOnFilledClosedPolylines(t){F.Debug("= O.OptUtil  SetLinkFlagsOnFilledClosedPolylines - Input:",t);let e=null,i=null;if(t&&(e=ws.GetObjectPtr(t,!1),e&&e instanceof we.Shape.PolyLine&&e.polylist&&e.polylist.closed&&Ps.SetLinkFlag(t,Ee.LinkFlags.Move|Ee.LinkFlags.Change)),this.moveList&&this.moveList.length)for(let o=0;o<this.moveList.length;o++)if(i=ws.GetObjectPtr(this.moveList[o],!0),i&&i.hooks.length>0)for(let t=0;t<i.hooks.length;t++){const e=ws.GetObjectPtr(i.hooks[t].objid,!1);e&&e.StyleRecord&&e.StyleRecord.Line&&e.StyleRecord.Line.BThick&&e.polylist&&e.polylist.closed&&Ps.SetLinkFlag(i.hooks[t].objid,Ee.LinkFlags.Move|Ee.LinkFlags.Change)}F.Debug("= O.OptUtil  SetLinkFlagsOnFilledClosedPolylines - Output: Link flags updated")}SetShapeR(t){let e,i;if(F.Debug("= O.OptUtil  SetShapeR - Input:",{shapeObjectId:t.BlockID}),t.StyleRecord&&(i=t.StyleRecord.Line.BThick&&null==t.polylist?t.StyleRecord.Line.Thickness:t.StyleRecord.Line.Thickness/2,e=t.CalcEffectSettings(t.Frame,t.StyleRecord,!1)),ve.InflateRect(t.r,i,i),e&&ve.Add2Rect(t.r,e.extent),t.DataID>=0&&(t.TextFlags&Se.TextFlags.AttachB||t.TextFlags&Se.TextFlags.AttachA)){const e=(e=>{if(null==e)return null;let i=ye.opt.svgObjectLayer.GetElementById(e);if(null==i&&(i=ye.opt.svgDoc.CreateShape(me.CSType.ShapeContainer),i.SetID(t.BlockID),ye.opt.svgObjectLayer.AddElement(i,0),t.LMAddSVGTextObject(ye.opt.svgDoc,i)),i){const t=i.GetElementById(me.SVGElementClass.Text);if(t){const e=t.GetPos(),i=t.GetTextMinDimensions();return{x:e.x,y:e.y,width:i.width,height:i.height}}}return null})(t.BlockID);e&&(e.x+=t.Frame.x,e.y+=t.Frame.y,ve.UnionRect(t.r,e,t.r))}if(t.AddDimensionsToR(),0!==t.RotationAngle){let e,i,o={},n={x:0,y:0};n.x=t.Frame.x+t.Frame.width/2,n.y=t.Frame.y+t.Frame.height/2,ve.CopyRect(o,t.Frame),ve.CopyRect(t.Frame,t.r),F.Debug("= O.OptUtil  SetShapeR - Getting poly points for rotation"),e=new we.Shape.BaseDrawObject(t).GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),i=-t.RotationAngle/(180/Se.Geometry.PI),si.RotatePointsAboutPoint(n,i,e),ve.GetPolyRect(t.r,e),ve.CopyRect(t.Frame,o)}return F.Debug("= O.OptUtil  SetShapeR - Output: Bounding rectangle calculated",t.r),0}FindChildArrayByIndex(t,e,i,o){let n,s,a;F.Debug("= O.OptUtil  FindChildArrayByIndex - Input:",{parentId:t,resultInfo:e,hasLinksList:!!i,baseClass:o});const r=i||ws.GetObjectPtr(this.linksBlockId,!1);o=o||me.DrawObjectBaseClass.Connector;const l=Ps.FindLink(r,t,!0),h=r.length;if(l>=0)for(n=l;n<h&&r[n].targetid===t;n++)if(n>e.lindex&&(s=r[n].hookid,(a=ws.GetObjectPtr(s,!1))&&a.DrawingObjectBaseClass===o))return e.lindex=n,e.id=s,e.hookpt=a.hooks[0].hookpt,F.Debug("= O.OptUtil  FindChildArrayByIndex - Output: Found child",s),s;return F.Debug("= O.OptUtil  FindChildArrayByIndex - Output: No child found (-1)"),-1}SetObjectFrame(t,e){F.Debug("= O.OptUtil  SetObjectFrame - Input:",{objectId:t,newFrame:e});const i=ws.GetObjectPtr(t,!0);return null==i?(F.Debug("= O.OptUtil  SetObjectFrame - Output: Failed to get object (1)"),1):(Ps.SetLinkFlag(t,Ee.LinkFlags.Move),i.hooks.length&&Ps.SetLinkFlag(i.hooks[0].objid,Ee.LinkFlags.Move),i.UpdateFrame(e),F.Debug("= O.OptUtil  SetObjectFrame - Output: Frame updated successfully (0)"),0)}SetObjectAttributes(t,e){F.Debug("= O.OptUtil  SetObjectAttributes - Input:",{objectId:t,attributes:e});const i=ye.stdObj.PreserveBlock(t);this.ApplyProperties(e,i.Data),F.Debug("= O.OptUtil  SetObjectAttributes - Output: Attributes applied")}ApplyProperties(t,e){F.Debug("= O.OptUtil  ApplyProperties - Input:",{sourceProperties:Object.keys(t),targetObject:e?e.constructor.name:null});for(const i in t){const o=e[i],n=t[i],s=typeof o;if(null==o){const t=typeof n;null==n||"string"===t||"number"===t||"boolean"===t?e[i]=n:n instanceof Array?e[i]=n.slice(0):n instanceof Blob||n instanceof Uint8Array?e[i]=n:"function"!==t&&(e[i]=Object.assign(new n.constructor,Oe.DeepCopy(n)))}else if("string"===s||"number"===s||"boolean"===s)e[i]=n;else if(n instanceof Array)e[i]=n.slice(0);else if(n instanceof Blob||n instanceof Uint8Array)e[i]=n;else if("function"!==s){const t=Object.assign(new o.constructor,Oe.DeepCopy(o));e[i]=t,this.ApplyProperties(n,t)}}F.Debug("= O.OptUtil  ApplyProperties - Output: Properties applied")}GetDrawingScale(t){F.Debug("= O.OptUtil  GetDrawingScale - Input:",t);const e=Se.RulerUnit;let i=t.majorScale,o=t.major;switch(null==o&&(o=me.Common.DefaultRulerMajor),t.units){case e.Feet:i*=12;break;case e.Mm:i/=10;break;case e.M:i*=100}const n=i*(me.Common.DefaultRulerMajor/o);return F.Debug("= O.OptUtil  GetDrawingScale - Output:",n),n}GetCounterClockwiseAngleBetween2Points(t,e){F.Debug("= O.OptUtil  GetCounterClockwiseAngleBetween2Points - Input:",{startPoint:t,endPoint:e});const i=Se.Geometry.PI,o=e.x-t.x,n=t.y-e.y;let s;return s=0===o?n>=0?i/2:-i/2:0===n?o>=0?0:i:Math.atan2(n,o),s<0&&(s+=2*i),F.Debug("= O.OptUtil  GetCounterClockwiseAngleBetween2Points - Output:",s),s}UndoEditMode(){F.Debug("= O.OptUtil  UndoEditMode - Input: No parameters");const t=this.editModeList||[];if(t.length>1){t.pop();const e=t[t.length-1];Ps.SetEditMode(e.mode,e.cursor,!1,!0)}F.Debug("= O.OptUtil  UndoEditMode - Output: Previous edit mode restored")}LineCheckPoint(t,e){F.Debug("= O.OptUtil  LineCheckPoint - Input:",{lineObject:t.BlockID,point:e});const i=Oe.DeepCopy(e),o=[];o.push(new De(t.StartPoint.x,t.StartPoint.y)),o.push(new De(t.EndPoint.x,t.EndPoint.y));const n=0!==si.LineDStyleHit(o,i,t.StyleRecord.Line.Thickness,0,0);return F.Debug("= O.OptUtil  LineCheckPoint - Output:",n),n}GetIntersectPt(t,e,i,o,n,s){let a,r,l,h,c,p,d,u,g,y,S,m,b,D=!1,f=!1;function x(t,e){return Math.abs(t.x-e.x)<.2}function C(t,e){return Math.abs(t.y-e.y)<.2}if(a=e.x-t.x,r=e.y-t.y,x(t,e)?(D=!0,u=e.x,l=1):C(t,e)?(g=e.y,l=0):l=r/a,y=t.x,S=t.y,h=o.x-i.x,c=o.y-i.y,x(i,o)?(f=!0,u=o.x,p=1):C(i,o)?(g=o.y,p=0):p=c/h,m=i.x,b=i.y,l===p||D&&f)return!1;if(!f&&!D){if(d=p-l,Math.abs(d)<1e-4)return!1;u=(S-b+p*m-l*y)/d}return D&&!f?g=b+p*(y-m):f&&!D?0===l&&n&&(g=o.y,g>=n.y&&g<=n.y+n.height||(g=-1)):p&&(g=S+l*(u-y)),s.x=u,s.y=g,!0}ArcCheckPoint(t,e){F.Debug("= O.OptUtil  ArcCheckPoint - Input:",{drawingObject:t.BlockID,testPoint:e});const i=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),o=0!==si.LineDStyleHit(i,e,t.StyleRecord.lineThickness,0,null);return F.Debug("= O.OptUtil  ArcCheckPoint - Output:",o),o}LinesIntersect(t,e,i){F.Debug("= O.OptUtil  LinesIntersect - Input:",{line1:{start:t.StartPoint,end:t.EndPoint},line2:{start:e.StartPoint,end:e.EndPoint}});const o={x:i.x,y:i.y};return this.GetIntersectPt(t.StartPoint,t.EndPoint,e.StartPoint,e.EndPoint,e.Frame,o)&&o.x>=t.Frame.x&&o.x<=t.Frame.x+t.Frame.width&&o.y>=t.Frame.y&&o.y<=t.Frame.y+t.Frame.height?(i.x=o.x,i.y=o.y,F.Debug("= O.OptUtil  LinesIntersect - Output: Lines intersect at",i),!0):(F.Debug("= O.OptUtil  LinesIntersect - Output: Lines do not intersect"),!1)}InflateLine(t,e,i,o){let n,s,a,r,l;F.Debug("= O.OptUtil  InflateLine - Input:",{pointCount:t.length,thickness:e,isClosed:i,isOutward:o});let h=[],c=[],p={segmentsInserted:!1};function d(t,e){const i=e.x-t.x,o=e.y-t.y;return ve.Sqrt(i*i+o*o)}function u(t,e,i){const o=t-Math.PI/2;return t-=o,(e-=o)<0&&(e+=2*Math.PI),e>2*Math.PI&&(e-=2*Math.PI),Math.abs(t-e)<=i}function g(t,e){let i=[],o={x:0,y:0,width:0,height:0};for(i=Oe.DeepCopy(t),ve.GetPolyRect(o,i),s=0;s<i.length;s++)i[s].x-=o.x,i[s].y-=o.y;const n=2*e,a=Math.max(o.width,o.height);if(n>a)return t;const r=(a+n)/a;for(s=0;s<i.length;s++)i[s].x*=r,i[s].y*=r,i[s].x+=o.x-e,i[s].y+=o.y-e;return i}function y(t,e,i,o,n){let s=[],a=d(t,e),r=d(t,i),l=a>0?r/a:0,h=d(o,n);s=[{x:o.x,y:o.y},{x:0,y:0},{x:n.x,y:n.y}];let c=ye.opt.GetCounterClockwiseAngleBetween2Points(o,n);return si.RotatePointsAboutPoint(s[0],-c,s),s[1].y=s[0].y,s[2].x>s[0].x?s[1].x=s[0].x+h*l:s[1].x=s[0].x-h*l,si.RotatePointsAboutPoint(s[0],c,s),s[1]}if(r=e/2,r<3?r=3:r>5&&(r=5),h=this.CalcPolyOutline(t,e,i,o,r,p),null===h||p.segmentsInserted){const i=g(t,o?e:-e);return F.Debug("= O.OptUtil  InflateLine - Output (fallback to scaling):",i.length),i}if(i&&h.push(new De(h[0].x,h[0].y)),n=this.GetPolygonWindingDirection(t),-1===n&&o?h.reverse():1!==n||o||h.reverse(),null===this.CalcPolyOutline(h,e,i,!o,r,p)||p.segmentsInserted){const i=g(t,o?e:-e);return F.Debug("= O.OptUtil  InflateLine - Output (fallback after verification):",i.length),i}l=t.length;let S=h.length;for(;--S>0&&--l>0;){const e=this.GetCounterClockwiseAngleBetween2Points(h[S-1],h[S]);if(!u(this.GetCounterClockwiseAngleBetween2Points(t[l-1],t[l]),e,.01)){for(s=l-1;s>=0;s--){if(u(this.GetCounterClockwiseAngleBetween2Points(t[s],t[l]),e,.01)){for(a=c.length-1;a>=0;a--)h.splice(S,0,y(t[l],t[l-c.length],c[a],h[S],h[S-1]));l-=c.length,c=[];break}c.push(new De(t[s].x,t[s].y))}if(c.length>0)break}}return h.length!==t.length&&(h=g(t,o?e:-e)),F.Debug("= O.OptUtil  InflateLine - Output:",h.length),h}CalcPolyOutline(t,e,i,o,n,s){let a,r,l,h,c,p,d,u;F.Debug("= O.OptUtil  CalcPolyOutline - Input:",{pointCount:t.length,thickness:e,isClosed:i,isOutward:o,segmentStep:n});const g=[],y=[];let S=0;const m={x:0,y:0},b=1e5;if(t.length<2)return F.Debug("= O.OptUtil  CalcPolyOutline - Output: Insufficient points (null)"),null;let D=1;if(i){for(a=0;a<t.length-1;a++)t[a+1].x,t[a].x,t[a+1].y,t[a].y;D=this.GetPolygonWindingDirection(t)}if(o||(D=-D),D<1?(p=t.length-1,d=-1):(p=0,d=t.length),!e)return F.Debug("= O.OptUtil  CalcPolyOutline - Output: No thickness, returning copy of input points"),Oe.DeepCopy(t);for(S=0,c=p-D,n?h=n:(h=e/2,h<3?h=3:h>5&&(h=5)),a=p;a!=d;a+=D){if(c<0||c>t.length-1){if(!i){c=a;continue}c=c<0?t.length-1:0}if(a==d-D&&(h=2),Oe.DeltaPoints(t[a],t[c])<h)continue;const o=new Te;o.origSeg.start=Oe.DeepCopy(t[c]),o.origSeg.end=Oe.DeepCopy(t[a]),Oe.CalcExtendedOffsetSegment(o,e,2,b),o.clipSeg.start=Oe.DeepCopy(o.extSeg.start),o.clipSeg.end=Oe.DeepCopy(o.extSeg.end),S>0&&o.angle==y[S-1].angle?(y[S-1].origSeg.end=Oe.DeepCopy(o.origSeg.end),y[S-1].clipSeg.end=Oe.DeepCopy(o.clipSeg.end),y[S-1].extSeg.end=Oe.DeepCopy(o.extSeg.end),y[S-1].extSeg.endExt=Oe.DeepCopy(o.extSeg.endExt),y[S-1].extSeg.endRay=Oe.DeepCopy(o.extSeg.endRay)):(y.push(o),S++),c=a}if(!S)return F.Debug("= O.OptUtil  CalcPolyOutline - Output: No segments created (null)"),null;if(1==S)return g.push(y[0].clipSeg.start),g.push(y[0].clipSeg.end),F.Debug("= O.OptUtil  CalcPolyOutline - Output: Single segment outline created",g),g;for(r=S-1,a=0;a<S;a++)i||0!==a?(Oe.CompareAngle(y[a].angle,y[r].angle)>0&&(Oe.CalcSegmentIntersect(y[r].clipSeg.start,y[r].extSeg.endExt,y[a].extSeg.startExt,y[a].clipSeg.end,m)?(y[r].clipSeg.end=Oe.DeepCopy(m),y[a].clipSeg.start=Oe.DeepCopy(m)):Oe.DeltaAngle(y[a].angle,y[r].angle)<15?(y[r].clipSeg.end.x=(y[r].extSeg.end.x+y[a].extSeg.start.x)/2,y[r].clipSeg.end.y=(y[r].extSeg.end.y+y[a].extSeg.start.y)/2,y[a].clipSeg.start=Oe.DeepCopy(y[r].clipSeg.end)):(y[r].clipSeg.end=Oe.DeepCopy(y[r].extSeg.endExt),y[a].clipSeg.start=Oe.DeepCopy(y[a].extSeg.startExt),Oe.InsertSegment(y,a,y[r].clipSeg.end,y[a].clipSeg.start,e,2,b),S++,a++,s.segmentsInserted=!0)),r=a):r=a;for(r=0,a=1;a<S;a++){if(u=!1,Oe.AreSegmentsObtuse(y,S,a,r)&&Oe.AreSegmentsAjacent(S,a,r))u=!0;else if(Oe.CalcSegmentIntersect(y[r].clipSeg.start,y[r].clipSeg.end,y[a].clipSeg.start,y[a].clipSeg.end,m))u=!0,y[r].clipSeg.end=Oe.DeepCopy(m),y[a].clipSeg.start=Oe.DeepCopy(m);else if(Oe.SegmentsInAlignment(y,S,a,r))u=!0,y[r].clipSeg.end.x=(y[r].clipSeg.end.x+y[a].clipSeg.start.x)/2,y[r].clipSeg.end.y=(y[r].clipSeg.end.y+y[a].clipSeg.start.y)/2,y[a].clipSeg.start=y[r].clipSeg.end;else if(r>0)for(l=r-1;l>=0&&!u&&!(l<0);)if(Oe.IsEmptySeg(y[l].clipSeg))l--;else{if(a!=S-1&&Oe.AreSegmentsObtuse(y,S,a,l))break;if(Oe.CalcSegmentIntersect(y[l].clipSeg.start,y[l].clipSeg.end,y[a].clipSeg.start,y[a].clipSeg.end,m)){r=l,y[l].clipSeg.end=Oe.DeepCopy(m),y[a].clipSeg.start=Oe.DeepCopy(m),u=!0;break}if(Oe.IsEnd(a,y.length,i)&&Oe.DeltaAngle(y[a].angle,y[l].angle)>0&&Oe.CalcSegmentIntersect(y[l].clipSeg.start,y[l].extSeg.endRay,y[a].clipSeg.start,y[a].clipSeg.end,m)){r=l,y[l].clipSeg.end=Oe.DeepCopy(m),y[a].clipSeg.start=Oe.DeepCopy(m),u=!0;break}l--}if(u){for(l=r+1;l<a;)y[l].clipSeg.end=Oe.DeepCopy(y[l].clipSeg.start),l++;r=a}else if(Oe.IsEnd(a,y.length,i))for(y[r].clipSeg.end=Oe.DeepCopy(y[a].extSeg.end),l=r+1;l<S;)y[l].clipSeg.end=Oe.DeepCopy(y[l].clipSeg.start),l++;else y[a].clipSeg.end=Oe.DeepCopy(y[a].clipSeg.start)}if(i){let t=-1,e=-1;for(a=0;a<S;a++)if(!Oe.IsEmptySeg(y[a].clipSeg)){t=a;break}for(a=S-1;a>=0;a--)if(!Oe.IsEmptySeg(y[a].clipSeg)){e=a;break}if(t>=0&&e>=0)for(u=!1,a=t;!u&&a<e;a++)if(r=e,Oe.AreSegmentsObtuse(y,S,a,r)&&Oe.AreSegmentsAjacent(S,a,r))u=!0;else if(Oe.CalcSegmentIntersect(y[r].clipSeg.start,y[r].clipSeg.end,y[a].clipSeg.start,y[a].clipSeg.end,m))u=!0,y[r].clipSeg.end=Oe.DeepCopy(m),y[a].clipSeg.start=Oe.DeepCopy(m);else if(Oe.SegmentsInAlignment(y,S,a,r))u=!0;else{for(l=r-1;l>a&&!u;)if(Oe.IsEmptySeg(y[l].clipSeg))l--;else{if(Oe.AreSegmentsObtuse(y,S,a,l))break;if(Oe.CalcSegmentIntersect(y[l].clipSeg.start,y[l].clipSeg.end,y[a].clipSeg.start,y[a].clipSeg.end,m)){r=l,y[l].clipSeg.end=Oe.DeepCopy(m),y[a].clipSeg.start=Oe.DeepCopy(m),u=!0;break}l--}if(u)for(l=r+1;l<=e;)y[l].clipSeg.end=Oe.DeepCopy(y[l].clipSeg.start),l++;else y[a].clipSeg.end=Oe.DeepCopy(y[a].clipSeg.start)}}for(a=0;a<S;a++)Oe.IsEmptySeg(y[a].clipSeg)||(0!==g.length&&y[a].clipSeg.start.x==g[g.length-1].x&&y[a].clipSeg.start.y==g[g.length-1].y||g.push(Oe.DeepCopy(y[a].clipSeg.start)),g.push(Oe.DeepCopy(y[a].clipSeg.end)));for(;g.length>1&&Oe.DeltaPoints(g[g.length-1],g[0])<3;)g.splice(g.length-1,1);return g.length<2&&!i||g.length<3&&i?(F.Debug("= O.OptUtil  CalcPolyOutline - Output: Insufficient output points (null)"),null):(F.Debug("= O.OptUtil  CalcPolyOutline - Output: Outline created with",g.length,"points"),g)}GetPolygonWindingDirection(t){F.Debug("= O.OptUtil  GetPolygonWindingDirection - Input:",{pointCount:t.length});let e=0;for(let o=0;o<t.length-1;o++)e+=(t[o+1].x-t[o].x)*(t[o+1].y+t[o].y);const i=e>0?-1:1;return F.Debug("= O.OptUtil  GetPolygonWindingDirection - Output:",i),i}GetTargetList(t,e,i,o,n){let s,a,r,l;F.Debug("= O.OptUtil  GetTargetList - Input:",{objectId:t,linksListLength:null==e?void 0:e.length,targetListLength:null==i?void 0:i.length,hasBoundingRect:!!o,listCode:n});let h=Se.ListCodes.MoveHook;if(n===Se.ListCodes.MoveTargAndLines&&(h=n),s=ws.GetObjectPtr(t,!1),null==s)return F.Debug("= O.OptUtil  GetTargetList - Output: Source object not found, returning original list"),i;Yo.FixAnyCircularHooks(s);for(let c=0;c<s.hooks.length;c++){if(l=s.hooks[c].objid,i.indexOf(l)<0&&(i.push(l),o&&(a=ws.GetObjectPtr(l,!1),!(a.flags&Se.ObjFlags.NotVisible)))){const t=a.GetMoveRect(!0,!0);o=ve.UnionRect(o,t,o)}r=Ps.FindLink(e,l,!0),r>=0&&(i=Yo.AddToHookList(e,i,r,l,h,1,o)),i=this.GetTargetList(l,e,i,o,n)}return F.Debug("= O.OptUtil  GetTargetList - Output: Returning list with",i.length,"targets"),i}GetClockwiseAngleBetween2PointsInDegrees(t,e){F.Debug("= O.OptUtil  GetClockwiseAngleBetween2PointsInDegrees - Input:",{startPoint:t,endPoint:e});const i=Se.Geometry.PI;let o,n,s;o=e.x-t.x,n=e.y-t.y,s=0===o?n>=0?i/2:-i/2:0===n?o>=0?0:i:Math.atan2(n,o),s<0&&(s+=2*i);const a=s*(180/i);return F.Debug("= O.OptUtil  GetClockwiseAngleBetween2PointsInDegrees - Output:",a),a}NormalizeAngle(t,e){return F.Debug("= O.OptUtil  NormalizeAngle - Input:",{angle:t,adjustment:e}),(t+=e)>=2*Se.Geometry.PI&&(t-=2*Se.Geometry.PI),t<0&&(t+=2*Se.Geometry.PI),F.Debug("= O.OptUtil  NormalizeAngle - Output:",t),t}GetShapeParams(t,e){let i;F.Debug("= O.OptUtil  GetShapeParams - Input:",{shapeType:t,shapeDimensions:e});let o=!1,n=0;switch(t){case tn.ShapeTypes.RECTANGLE:case tn.ShapeTypes.OVAL:case tn.ShapeTypes.ROUNDED_RECTANGLE:break;case tn.ShapeTypes.CIRCLE:o=!0;break;case tn.ShapeTypes.DIAMOND:i=hs.generateDiamond;break;case tn.ShapeTypes.TRIANGLE:i=hs.generateTriangle;break;case tn.ShapeTypes.TRIANGLE_BOTTOM:i=hs.generateTriangleDown;break;case tn.ShapeTypes.PARALLELOGRAM:n=.13333*e.width,i=hs.generateParallelogram;break;case tn.ShapeTypes.PENTAGON:n=.4*e.height,i=hs.generatePentagon,o=!1;break;case tn.ShapeTypes.PENTAGON_LEFT:n=.4*e.width,i=hs.generatePentagonLeft,o=!1;break;case tn.ShapeTypes.HEXAGON:n=.26*e.width,i=hs.generateHexagon,o=!1;break;case tn.ShapeTypes.OCTAGON:n=.28,i=hs.generateOctagon,o=!1;break;case tn.ShapeTypes.ARROW_RIGHT:n=.3*e.width,i=hs.generateRightArrow;break;case tn.ShapeTypes.ARROW_LEFT:n=.3*e.width,i=hs.generateLeftArrow;break;case tn.ShapeTypes.ARROW_TOP:n=.3*e.height,i=hs.generateTopArrow;break;case tn.ShapeTypes.ARROW_BOTTOM:n=.3*e.height,i=hs.generateBottomArrow;break;case tn.ShapeTypes.TRAPEZOID:n=.2*e.width,i=hs.generateTrapezoid;break;case tn.ShapeTypes.TRAPEZOID_BOTTOM:n=.2*e.width,i=hs.generateTrapezoidDown;break;case tn.ShapeTypes.INPUT:n=.27*e.height,i=hs.generateInput;break;case tn.ShapeTypes.TERMINAL:i=hs.generateTerminal;break;case tn.ShapeTypes.STORAGE:n=e.width/7.5,i=hs.generateStorage;break;case tn.ShapeTypes.DOCUMENT:i=hs.generateDocument,n=e.height/7.5;break;case tn.ShapeTypes.DELAY:n=e.width/5,i=hs.generateDelay;break;case tn.ShapeTypes.DISPLAY:n=e.width/7.5,i=hs.generateDisplay}const s={dataclass:t,shapeparam:n,polyVectorMethod:i,bCircularize:o};return F.Debug("= O.OptUtil  GetShapeParams - Output:",s),s}AddtoDelete(t,e,i){let o;F.Debug("= O.OptUtil  AddtoDelete - Input:",{objectIds:t,isForced:e,additionalData:i});let n,s,a,r,l,h=t.length,c=me.ConnectorDefines,p=0;for(o=0;o<h;o++)if(n=ws.GetObjectPtr(t[o],!1),null!=n)if(s=t[o],n instanceof we.Shape.ShapeContainer&&this.ContainerAddtoDelete(n,t),n.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector)n.IsFlowChartConnector&&n.IsFlowChartConnector()?(n.objecttype,Zo.GetConnectorTree(t[o],t)):(Zo.GetConnectorTree(t[o],t),h=t.length,e&&n.hooks.length&&(r=ws.GetObjectPtr(n.hooks[0].objid,!1),r&&r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&t.indexOf(n.hooks[0].objid)<0&&t.push(n.hooks[0].objid)));else{let i=!1;if(a=Zo.GetParentConnector(t[o],null),a>=0){if(r=ws.GetObjectPtr(a,!1),r){let h={};if(this.IsConnectorEndShape(n,r,h)){if(void 0===l&&(l=h.nshapes),t.indexOf(a)<0)l-p>1||h.pasted||e?(t.push(a),r.extraflags&me.ExtraFlags.NoDelete&&(r.extraflags=ve.SetFlag(r.extraflags,me.ExtraFlags.NoDelete,!1)),Zo.GetConnectorTree(a,t),h.pasted||p++):t.splice(o,1);else if(h.nshapes<=1&&!h.pasted&&!e){t.splice(o,1);let e=t.indexOf(a);e>=0&&t.splice(e,1)}if(r.IsFlowChartConnector&&r.IsFlowChartConnector()){let e=ye.opt.FindChildArray(t[o],-1);ws.GetObjectPtr(e,!1)}else if(r.arraylist.styleflags&me.AStyles.CoManager)if(e){s=r.arraylist.hook[c.NSkip].id,t.indexOf(a)<0&&t.push(a);let e=r.arraylist.hook.length;for(let i=c.NSkip;i<e;i++){let e=r.arraylist.hook[i].id;t.indexOf(e)<0&&t.push(e)}}else{let e=r.arraylist.hook.length;for(let o=c.NSkip;o<e;o++){let e=r.arraylist.hook[o].id;if(t.indexOf(e)<0){i=!0;break}}}else 0===r.hooks.length&&ye.opt.CN_GetNShapes(a)<=1&&-1===t.indexOf(a)&&t.push(a)}}}else{let n;n=1,e||(i=!0);let s=-1;for(let e=0;e<n;e++){let e=ye.opt.FindChildArray(t[o],s);if(e>=0){let o=ws.GetObjectPtr(e,!0);if(o&&o.arraylist&&(o.arraylist.hook.length<=c.SEDA_NSkip||o.flags&Se.ObjFlags.NotVisible)&&(i=!1),o.IsGenoConnector&&o.IsGenoConnector()){i=!1;let n=-1,s=o.arraylist.hook.length;for(let e=c.SEDA_NSkip;e<s;e++){let s=o.arraylist.hook[e].id;if(t.indexOf(s)<0){if(ws.GetObjectPtr(s,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape){i=!0;break}ws.GetObjectPtr(s,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&(n=s)}}i||(t.indexOf(e)<0&&t.push(e),n>=0&&t.indexOf(n)<0&&t.push(n),i=!0)}o.flags=ve.SetFlag(o.flags,Se.ObjFlags.Obj1,!0),Ps.SetLinkFlag(e,Ee.LinkFlags.Move)}s=e}}if(!i){let i=Yo.FindAllChildConnectors(s).length,o=Yo.FindAllChildConnectors(s);for(let e=0;e<i;e++){let i=ws.GetObjectPtr(o[e],!1);i&&i.IsFlowChartConnector&&i.IsFlowChartConnector()||Zo.GetConnectorTree(o[e],t)}if(n.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&!e){let e=[],i=this.HealLine(n,!1,e);if(i>=0){t.indexOf(i)<0&&t.push(i);for(let i=0;i<e.length;i++)t.indexOf(e[i])<0&&t.push(e[i])}}if(n.associd>=0){let e=!1,i=ws.GetObjectPtr(n.associd,!1);i&&(i.hooks.length&&i.hooks[0].hookpt===me.HookPts.KATD&&(e=!0),i.objecttype!==Se.FNObjectTypes.NgEvent&&i.objecttype!==Se.FNObjectTypes.NgEventLabel&&t.indexOf(n.associd)<0&&t.push(n.associd)),e&&t.indexOf(n.associd)<0&&t.push(n.associd)}if(n.DrawingObjectBaseClass===me.DrawObjectBaseClass.Line){let e=Qo.FindAllChildObjects(n.BlockID,me.DrawObjectBaseClass.Shape,Se.FNObjectTypes.Multiplicity);if(e&&e.length)for(let i=0;i<e.length;i++)t.indexOf(e[i])<0&&t.push(e[i])}if(!e){let e=Qo.FindAllChildObjects(n.BlockID,me.DrawObjectBaseClass.Line,null);if(e&&e.length)for(let i=0;i<e.length;i++)t.indexOf(e[i])<0&&t.push(e[i])}}}return F.Debug("= O.OptUtil  AddtoDelete - Output:",{objectIds:t,helperValue:-1}),-1}HealLine(t,e,i){let o,n,s,a,r,l,h,c,p,d,u,g,y,S,m,b,D=[],f=[],x=[];const C=ws.GetObjectPtr(this.linksBlockId,!1);let P=-1,T=-1,O=!1,v=!1,w=[];const k=me.HookPts,L=function(t,e,i,o,n,s){let a,r,l,h,c=[],p=[];if(a=t.segl.pts.length,r=e.segl.pts.length,l=ve.IsEqual(i.y,o.y,.1)?Math.abs(i.x-o.x):Math.abs(i.y-o.y),s)for(h=2;h<r;h++){let t=ve.IsEqual(e.segl.pts[h].y,e.segl.pts[h-1].y)?Math.abs(e.segl.pts[h].x-e.segl.pts[h-1].x):Math.abs(e.segl.pts[h].y-e.segl.pts[h-1].y);p.push(t)}else for(h=r-2;h>0;h--){let t=ve.IsEqual(e.segl.pts[h].y,e.segl.pts[h-1].y)?Math.abs(e.segl.pts[h].x-e.segl.pts[h-1].x):Math.abs(e.segl.pts[h].y-e.segl.pts[h-1].y);p.push(t)}if(n){for(h=p.length-1;h>=0;h--)c.push(p[h]);for(c.push(l),h=2;h<a;h++){let e=ve.IsEqual(t.segl.pts[h].y,t.segl.pts[h-1].y)?Math.abs(t.segl.pts[h].x-t.segl.pts[h-1].x):Math.abs(t.segl.pts[h].y-t.segl.pts[h-1].y);c.push(e)}}else{for(h=1;h<a-1;h++){let e=ve.IsEqual(t.segl.pts[h].y,t.segl.pts[h-1].y)?Math.abs(t.segl.pts[h].x-t.segl.pts[h-1].x):Math.abs(t.segl.pts[h].y-t.segl.pts[h-1].y);c.push(e)}c.push(l);for(let t=0;t<p.length;t++)c.push(p[t])}return c},A=function(t,e){let i,o=e.length,n=t.segl.pts.length-1;for(5===n&&(e[2]=e[4]),i=0;i<o&&i<=n;i++)t.segl.lengths[i]=e[i]};if(r=Ps.FindLink(C,t.BlockID,!0),d=t.BlockID,r<0)return-1;Yo.AddToHookList(C,D,r,t.BlockID,Se.ListCodes.TopOnly,1,{});let I=o=D.length;for(n=0;n<o;n++)if(s=ws.GetObjectPtr(D[n],!1),s.AllowHeal()){f.push(D[n]);const t=s.hooks.length;for(let e=0;e<t;e++)s.hooks[e].objid===d&&(s.hooks[e].connect,s.hooks[e].hookpt===k.KTL?x.push(s.segl.firstdir):x.push(s.segl.lastdir))}if((o=f.length)>=2&&o<4)for(n=0;n<o;n++){switch(x[n]){case k.KTC:u=f[n],void 0!==g&&(f[0]=u,f[1]=g,o=2,O=!0);break;case k.KBC:g=f[n],void 0!==u&&(f[0]=u,f[1]=g,o=2,O=!0);break;case k.KLC:y=f[n],void 0!==S&&(f[0]=y,f[1]=S,o=2,O=!0);break;case k.KRC:S=f[n],void 0!==y&&(f[0]=y,f[1]=S,o=2,O=!0)}if(O)break}if(e&&O)return 1;if(O){if(s=ws.GetObjectPtr(f[0],!0),a=ws.GetObjectPtr(f[1],!0),1===s.hooks.length&&2===a.hooks.length){let t=f[0];f[0]=f[1],f[1]=t,s=ws.GetObjectPtr(f[0],!0),a=ws.GetObjectPtr(f[1],!0)}let e,r=ve.Pt2Rect(s.StartPoint,s.EndPoint),d=ve.Pt2Rect(a.StartPoint,a.EndPoint),u=ye.opt.GetPolyLineLinks(f[0],0),g=ye.opt.GetPolyLineLinks(f[1],0);for(o=s.hooks.length,n=0;n<o;n++)s.hooks[n].objid!=t.BlockID?P=s.hooks[n].objid:c=n;for(o=a.hooks.length,n=0;n<o;n++)a.hooks[n].objid!=t.BlockID?T=a.hooks[n].objid:p=n;if(P>=0&&T>=0&&P!=T){if(a.hooks[p].hookpt===k.KTL){l=a.segl.firstdir,h=a.StartPoint,v=!1,b={x:a.StartPoint.x,y:a.StartPoint.y};const t=a.segl.pts.length;t>2&&(b.x=d.x+a.segl.pts[t-2].x,b.y=d.y+a.segl.pts[t-2].y)}else l=a.segl.lastdir,h=a.EndPoint,v=!0,b={x:a.StartPoint.x,y:a.StartPoint.y},b.x=d.x+a.segl.pts[1].x,b.y=d.y+a.segl.pts[1].y;if(s.hooks[c].hookpt===k.KTL)m={x:s.StartPoint.x,y:s.StartPoint.y},m.x=r.x+s.segl.pts[1].x,m.y=r.y+s.segl.pts[1].y,w=L(s,a,m,b,!0,v),s.segl.firstdir=l,s.StartPoint.x=h.x,s.StartPoint.y=h.y,s.SegLFormat(h,me.ActionTriggerType.LineStart,0),A(s,w),s.SegLFormat(h,me.ActionTriggerType.LineStart,0);else{m={x:s.StartPoint.x,y:s.StartPoint.y};const t=s.segl.pts.length;t>2&&(m.x=r.x+s.segl.pts[t-2].x,m.y=r.y+s.segl.pts[t-2].y),w=L(s,a,m,b,!1,v),s.segl.lastdir=l,s.EndPoint.x=h.x,s.EndPoint.y=h.y,s.SegLFormat(h,me.ActionTriggerType.LineEnd,0),A(s,w),s.SegLFormat(h,me.ActionTriggerType.LineEnd,0)}if(2===I){let e;e=ve.IsEqual(m.y,b.y,2)?me.ActionArrow.Right:me.ActionArrow.Down,Zo.ShiftConnectedShapes(t.BlockID,T,s.BlockID,e,!1)}return s.CalcFrame(),this.FilterLinks(u,g,i),g&&g.length&&Yo.MoveLinks(f[0],f[1],g,null),u&&u.length&&Yo.MoveLinks(f[0],f[0],u,null),s.hoplist.hops=[],s.hoplist.nhops=0,ws.AddToDirtyList(f[0]),Yo.UpdateHook(f[0],c,T,s.hooks[c].hookpt,a.hooks[p].connect,a.hooks[p].cellid),Ps.SetLinkFlag(a.hooks[p].objid,Ee.LinkFlags.Move),this.UpdateLinks(),f[1]}if(P>=0&&T<0){if(a.hooks[0].hookpt===k.KTL)l=a.segl.lastdir,h=a.EndPoint,v=!0,b={x:a.StartPoint.x,y:a.StartPoint.y},b.x=d.x+a.segl.pts[1].x,b.y=d.y+a.segl.pts[1].y;else{l=a.segl.firstdir,h=a.StartPoint,v=!1,b={x:a.StartPoint.x,y:a.StartPoint.y};const t=a.segl.pts.length;t>2&&(b.x=d.x+a.segl.pts[t-2].x,b.y=d.y+a.segl.pts[t-2].y)}if(s.hooks[c].hookpt===k.KTL)m={x:s.StartPoint.x,y:s.StartPoint.y},m.x=r.x+s.segl.pts[1].x,m.y=r.y+s.segl.pts[1].y,w=L(s,a,m,b,!0,v),s.segl.firstdir=l,s.StartPoint.x=h.x,s.StartPoint.y=h.y,s.SegLFormat(h,me.ActionTriggerType.LineStart,0),s.CalcFrame(),A(s,w),s.SegLFormat(h,me.ActionTriggerType.LineStart,0);else{m={x:s.StartPoint.x,y:s.StartPoint.y};const t=s.segl.pts.length;t>2&&(m.x=r.x+s.segl.pts[t-2].x,m.y=r.y+s.segl.pts[t-2].y),w=L(s,a,m,b,!1,v),s.segl.lastdir=l,s.EndPoint.x=h.x,s.EndPoint.y=h.y,s.SegLFormat(h,me.ActionTriggerType.LineEnd,0),s.CalcFrame(),A(s,w),s.SegLFormat(h,me.ActionTriggerType.LineEnd,0)}return this.FilterLinks(u,g,i),g&&g.length&&Yo.MoveLinks(f[0],f[1],g,null),u&&u.length&&Yo.MoveLinks(f[0],f[0],u,null),s.hoplist.hops=[],s.hoplist.nhops=0,Yo.UpdateHook(f[0],c,-1,s.hooks[c].hookpt,s.hooks[c].connect,s.hooks[c].cellid),ws.AddToDirtyList(f[0]),f[1]}if(e=function(t,e,i,o){let n,s,a=new we.Shape.SegLine,r=ve.Pt2Rect(t.StartPoint,t.EndPoint);if(s=t.segl.pts.length,e===k.KTL){for(n=s-1;n>0;n--)a.pts.push({x:t.segl.pts[n].x+r.x,y:t.segl.pts[n].y+r.y});a.firstdir=t.segl.lastdir}else{for(n=0;n<s-1;n++)a.pts.push({x:t.segl.pts[n].x+r.x,y:t.segl.pts[n].y+r.y});a.firstdir=t.segl.firstdir}if(s=i.segl.pts.length,d=ve.Pt2Rect(i.StartPoint,i.EndPoint),o===k.KTR){for(n=s-2;n>=0;n--)a.pts.push({x:i.segl.pts[n].x+d.x,y:i.segl.pts[n].y+d.y});a.lastdir=i.segl.firstdir}else{for(n=1;n<s;n++)a.pts.push({x:i.segl.pts[n].x+d.x,y:i.segl.pts[n].y+d.y});a.lastdir=i.segl.lastdir}for(s=a.pts.length,n=1;n<s;n++)a.pts[n].x==a.pts[n-1].x?a.lengths.push(Math.abs(a.pts[n].y-a.pts[n-1].y)):a.lengths.push(Math.abs(a.pts[n].x-a.pts[n-1].x));return a}(a,a.hooks[0].hookpt,s,s.hooks[0].hookpt),a.hooks[0].hookpt===k.KTL){let t=a.EndArrowID;a.EndArrowID=a.StartArrowID,a.StartArrowID=t,t=a.EndArrowDisp,a.EndArrowDisp=a.StartArrowDisp,a.StartArrowDisp=t}a.hoplist.hops=[],a.hoplist.nhops=0,a.segl=e,pointCount=e.pts.length,a.StartPoint.x=e.pts[0].x,a.StartPoint.y=e.pts[0].y,a.EndPoint.x=e.pts[pointCount-1].x,a.EndPoint.y=e.pts[pointCount-1].y;const y=ve.Pt2Rect(a.StartPoint,a.EndPoint);for(n=0;n<pointCount;n++)a.segl.pts[n].x-=y.x,a.segl.pts[n].y-=y.y;return a.CalcFrame(),h=a.EndPoint,a.SegLFormat(h,me.ActionTriggerType.LineEnd,0),a.CalcFrame(),this.FilterLinks(g,u,i),u&&u.length&&Yo.MoveLinks(f[1],f[0],u,null),g&&g.length&&Yo.MoveLinks(f[1],f[1],g,null),Yo.UpdateHook(f[1],p,-1,a.hooks[p].hookpt,a.hooks[p].connect,a.hooks[p].cellid),ws.AddToDirtyList(f[1]),f[0]}return-1}SetVirtualKeyboardLifter(t){}VirtualKeyboardLifter(t,e){if(F.Debug("= O.OptUtil  VirtualKeyboardLifter - Input:",{element:t,isActive:e}),e){const e=t.CalcElementFrame();{let t=ye.docUtil.DocObject().ConvertDocToWindowCoords(e.x,e.y),i=ye.docUtil.DocObject().ConvertDocToWindowLength(e.width);0===i&&(i=1);let o=ye.docUtil.DocObject().ConvertDocToWindowLength(e.height);0===o&&(o=1),ye.opt.workAreaTextInputProxy.css("visibility","visible"),ye.opt.workAreaTextInputProxy.css("opacity","0"),ye.opt.workAreaTextInputProxy.css("color","transparent"),ye.opt.workAreaTextInputProxy.css("z-index","-1000"),ye.opt.workAreaTextInputProxy.css("text-align","left"),t.x=-9999,i=800,ye.opt.workAreaTextInputProxy.css("left",t.x+"px"),ye.opt.workAreaTextInputProxy.css("top",t.y+"px"),ye.opt.workAreaTextInputProxy.css("width",i+"px"),ye.opt.workAreaTextInputProxy.css("height",o+"px"),ye.opt.workAreaTextInputProxy.val(""),ye.opt.workAreaTextInputProxy.focus()}}else ye.opt.workAreaTextInputProxy.css("visibility","visible"),ye.opt.workAreaTextInputProxy.blur(),ye.opt.workAreaTextInputProxy.val(""),ye.opt.workAreaTextInputProxy.css("visibility","hidden");F.Debug("= O.OptUtil  VirtualKeyboardLifter - Output: completed")}AddAssoctoList(t,e){F.Debug("= O.OptUtil  AddAssoctoList - Input:",{listOfObjectIds:t,skipContainerParents:e});let i=[];const o=t.length,n=Se.FNObjectTypes;for(let s=0;s<o;s++){const o=t[s],a=ws.GetObjectPtr(o,!1);if(!(e&&Zo.HasContainerParent(a)||(a.objecttype,i.indexOf(o)<0&&i.push(o),a&&a.associd>=0&&ws.GetObjectPtr(a.associd,!1)&&i.indexOf(a.associd)<0&&i.push(a.associd),a.objecttype!==n.ShapeContainer)))ye.opt.ContainerAddtoDelete(a,i)}return F.Debug("= O.OptUtil  AddAssoctoList - Output:",i),i}ShowLoading(t){}IsLinkedOutside(t){F.Debug("= O.OptUtil  IsLinkedOutside - Input:",{linkedObjectIds:t});const e=vs.ZList();for(let i=0;i<t.length;i++){const o=ws.GetObjectPtr(t[i],!1);for(let i=0;i<e.length;i++){const n=ws.GetObjectPtr(e[i],!1);if(n.associd===o.BlockID&&-1===t.indexOf(n.BlockID))return F.Debug("= O.OptUtil  IsLinkedOutside - Output:",!0),!0}}return F.Debug("= O.OptUtil  IsLinkedOutside - Output:",!1),!1}IsGroupNonDelete(){F.Debug("= O.OptUtil  IsGroupNonDelete - Input: no parameters");const t=ws.GetObjectPtr(ye.opt.selectObjsBlockId,!1);let e=null;for(let i=0;i<t.length;i++)if(e=ws.GetObjectPtr(t[i],!1),e.extraflags&me.ExtraFlags.NoDelete)return F.Debug("= O.OptUtil  IsGroupNonDelete - Output: true"),!0;return F.Debug("= O.OptUtil  IsGroupNonDelete - Output: false"),!1}GetListSRect(t,e,i){let o;F.Debug("= O.OptUtil  GetListSRect - Input:",{objectIdList:t,useFrame:e,useDragRectangle:i});const n=Se.ObjFlags.NotVisible;for(let s=0;s<t.length;s++){const a=t[s],r=ws.GetObjectPtr(a,!1);if(null!=r){const t=e?r.Frame:i?r.GetDragR():r.r;r&&0==(r.flags&n)&&(void 0===o?(o={},ve.CopyRect(o,t)):ve.UnionRect(t,o,o))}}return F.Debug("= O.OptUtil  GetListSRect - Output:",o),o}FindParentGroup(t,e){let i,o;F.Debug("= O.OptUtil  FindParentGroup - Input:",{targetId:t,currentGroup:e});const n=(e=e||null)?e.ShapesInGroup:vs.ZList();for(o=0;o<n.length;o++){if(n[o]===t)return F.Debug("= O.OptUtil  FindParentGroup - Output:",e),e;if(i=ws.GetObjectPtr(n[o],!1),i instanceof we.Shape.GroupSymbol&&i.ShapesInGroup){const e=ye.opt.FindParentGroup(t,i);if(e)return F.Debug("= O.OptUtil  FindParentGroup - Output:",e),e}}return F.Debug("= O.OptUtil  FindParentGroup - Output: null"),null}RebuildLinks(t,e){F.Debug("= O.OptUtil  RebuildLinks - Input:",{linkList:t,objectId:e});const i=ws.GetObjectPtr(e,!1);if(i&&i.hooks){const o=i.hooks.length;for(let i=0;i<o;i++)ye.opt.InsertLink(t,e,i,Ee.LinkFlags.Move)}F.Debug("= O.OptUtil  RebuildLinks - Output: Completed")}GetBlobImages(t,e){let i,o;F.Debug("= O.OptUtil  GetBlobImages - Input:",{objectIdsCount:t.length,blobMapSize:Object.keys(e).length});let n=null,s=null,a=t.length;for(o=0;o<a;++o)n=ws.GetObjectPtr(t[o],!1),n.ShapeType==me.ShapeType.GroupSymbol?n.ShapesInGroup&&n.ShapesInGroup.length&&this.GetBlobImages(n.ShapesInGroup,e):(i="",n.ImageURL?i=n.ImageURL:n.SymbolURL&&(i=n.SymbolURL),i&&(s=n.GetBlobBytes(),s&&!e[i]&&(e[i]=s)));F.Debug("= O.OptUtil  GetBlobImages - Output:",{processedObjects:a,blobMapSize:Object.keys(e).length})}GetSRect(t,e,i){F.Debug("= O.OptUtil  GetSRect - Input:",{excludeTitleBlocks:t,hasFrameDetails:!!e,objectList:i?i.length:"undefined"});const o=Se.ObjFlags.NotVisible,n=Se.TextFlags.TitleBlock,s=i||vs.VisibleZList(),a=s.length;let r,l,h,c;for(let p=0;p<a;p++)l=ws.GetObjectPtr(s[p],!1),null!=l&&(h=!1,t&&l.TextFlags&n&&(h=!0),l&&0==(l.flags&o)&&!h&&(c=Oe.DeepCopy(l.r),void 0===r?(r=c,e&&(e.x=l.Frame.x,e.y=l.Frame.y,e.width=l.Frame.width,e.height=l.Frame.height)):ve.UnionRect(c,r,r)));return F.Debug("= O.OptUtil  GetSRect - Output:",r),r}GetAutomationContext(t){F.Debug("= O.OptUtil  GetAutomationContext - Input:",t),ws.GetObjectPtr(this.sdDataBlockId,!1);let e=Ee.Contexts.Automation;return t&&(e=t.GetAutomationContext()),e===Ee.Contexts.Automation&&(e=Ee.Contexts.Automation),F.Debug("= O.OptUtil  GetAutomationContext - Output:",e),e}RestorePrimaryStateManager(){F.Debug("= O.OptUtil  RestorePrimaryStateManager - Input: no parameters"),ye.bIsPrimaryStateManager||Os.RenderAllSVGObjects(),F.Debug("= O.OptUtil  RestorePrimaryStateManager - Output: Primary state manager restored")}LinesMaintainDistWithinSegment(t,e,i,o){F.Debug("= O.OptUtil : LinesMaintainDistWithinSegment inputs:",{targetLine:t.BlockID||"unknown",sourceLine:e.BlockID||"unknown",segmentIndex:i,point:{x:o.x,y:o.y}});var n={},s=e.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null);ve.GetPolyRect(n,s);var a=360-Oe.CalcAngleFromPoints(s[i-1],s[i]),r=2*Math.PI*(a/360);si.RotatePointsAboutCenter(n,-r,s);var l=[o];si.RotatePointsAboutCenter(n,-r,l);var h=s[i].x-s[i-1].x,c=(o.x-s[i-1].x)/h,p=o.y-s[i-1].y;si.RotatePointsAboutCenter(n,r,l);var d=t.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),u=360-Oe.CalcAngleFromPoints(d[i-1],d[i]),g=2*Math.PI*(u/360);ve.GetPolyRect(n,d),si.RotatePointsAboutCenter(n,-g,d),si.RotatePointsAboutCenter(n,-g,l);var y=(d[i].x-d[i-1].x)*c;return l[0].x=d[i-1].x+y,l[0].y=d[i-1].y+p,si.RotatePointsAboutCenter(t.Frame,g,l),o=l[0],F.Debug("= O.OptUtil : LinesMaintainDistWithinSegment output:",{point:{x:o.x,y:o.y}}),o}HandleObjectDragDoAutoScroll(){F.Debug("= O.OptUtil  HandleObjectDragDoAutoScroll - Input: Starting auto-scroll"),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("HandleObjectDragDoAutoScroll",100);const t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);ye.docUtil.ScrollToPosition(t.x,t.y),this.HandleObjectDragMoveCommon(t.x,t.y),F.Debug("= O.OptUtil  HandleObjectDragDoAutoScroll - Output: Position updated",t)}HandleObjectDragMoveCommon(t,e,i,o){F.Debug("= O.OptUtil  HandleObjectDragMoveCommon - Input:",{mouseX:t,mouseY:e,skipScrolling:i,event:o});const n=()=>{ye.opt.dragDeltaX<-ye.opt.moveBounds.x&&(ye.opt.dragDeltaX=-ye.opt.moveBounds.x),ye.opt.dragDeltaY<-ye.opt.moveBounds.y&&(ye.opt.dragDeltaY=-ye.opt.moveBounds.y)};if(ye.opt.pinRect){const i={x:t,y:e};this.PinMoveRect(i),t=i.x,e=i.y}ye.opt.dragDeltaX=t-ye.opt.dragStartX,ye.opt.dragDeltaY=e-ye.opt.dragStartY,n();let s={x:ye.opt.dragDeltaX+ye.opt.moveBounds.x+ye.opt.moveBounds.width,y:ye.opt.dragDeltaY+ye.opt.moveBounds.y+ye.opt.moveBounds.height};s=xs.DoAutoGrowDrag(s);const a=ye.opt.moveList,r=a?a.length:0;if(0===r)return void F.Debug("= O.OptUtil  HandleObjectDragMoveCommon - Output: No objects to move");let l=0,h=null,c=null,p={x:t,y:e},d={x:0,y:0},u={x:0,y:0},g=ye.opt.linkParams&&(ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.JoinIndex>=0)||i;const y=ye.opt.EnhanceSnaps(o);ye.opt.OverrideSnaps(o)&&(g=!0);let S=ws.GetObjectPtr(ye.opt.dragTargetId,!1),m={x:null,y:null};const b={x:t,y:e};b.x<0&&(b.x=0),g&&ye.opt.dynamicGuides&&(an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null);let D,f=new We;if(!g&&xs.AllowSnapToShapes()){c=S.GetSnapRect(),d=Oe.DeepCopy(c),d.x+=ye.opt.dragDeltaX,d.y+=ye.opt.dragDeltaY;const t={};D=S.CanSnapToShapes(t),D>=0&&(c=ws.GetObjectPtr(D,!1).GetSnapRect(),u=Oe.DeepCopy(c),u.x+=ye.opt.dragDeltaX,u.y+=ye.opt.dragDeltaY,m=an.DynamicSnapsGetSnapObjects(D,u,f,ye.opt.moveList,null,t),null!==m.x&&(b.x+=m.x,u.x+=m.x,ye.opt.dragDeltaX=b.x-ye.opt.dragStartX),null!==m.y&&(b.y+=m.y,u.y+=m.y,ye.opt.dragDeltaY=b.y-ye.opt.dragStartY),n())}if(ye.docUtil.docConfig.enableSnap&&!g){if(c=S.GetSnapRect(),d=Oe.DeepCopy(c),d.x+=ye.opt.dragDeltaX,d.y+=ye.opt.dragDeltaY,S&&S.CustomSnap(S.Frame.x,S.Frame.y,ye.opt.dragDeltaX,ye.opt.dragDeltaY,!1,b))null===m.x&&(ye.opt.dragDeltaX=b.x-ye.opt.dragStartX),null===m.y&&(ye.opt.dragDeltaY=b.y-ye.opt.dragStartY),n();else if(ye.docUtil.docConfig.centerSnap)p.x=c.x+ye.opt.dragDeltaX+c.width/2,p.y=c.y+ye.opt.dragDeltaY+c.height/2,p=ye.docUtil.SnapToGrid(p),null===m.x&&(ye.opt.dragDeltaX=p.x-c.x-c.width/2),null===m.y&&(ye.opt.dragDeltaY=p.y-c.y-c.height/2);else{d=Oe.DeepCopy(c),d.x+=ye.opt.dragDeltaX,d.y+=ye.opt.dragDeltaY;const t=ye.docUtil.SnapRect(d);null===m.x&&(ye.opt.dragDeltaX+=t.x),null===m.y&&(ye.opt.dragDeltaY+=t.y)}y&&(Math.abs(ye.opt.dragDeltaX)>=Math.abs(ye.opt.dragDeltaY)?ye.opt.dragDeltaY=0:ye.opt.dragDeltaX=0)}const x=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);if(ye.opt.header.flags&me.HeaderFlags.NoAuto){const t=ye.opt.moveBounds.x+ye.opt.moveBounds.width+ye.opt.dragDeltaX;t>x.dim.x&&(ye.opt.dragDeltaX-=t-x.dim.x);const e=ye.opt.moveBounds.y+ye.opt.moveBounds.height+ye.opt.dragDeltaY;e>x.dim.y&&(ye.opt.dragDeltaY-=e-x.dim.y)}let C=Qo.GetTargetSelect();for(C<0&&(C=ye.opt.dragTargetId),!0===i&&(ye.opt.dragDeltaX=0,ye.opt.dragDeltaY=0),l=0;l<r;++l){if(c=ye.opt.dragBBoxList[l],a[l]===C){S=ws.GetObjectPtr(C,!1);let t={x:c.x+ye.opt.dragDeltaX,y:c.y+ye.opt.dragDeltaY,width:c.width,height:c.height};S&&(t=S.GetDimensionsForDisplay(),t.x+=ye.opt.dragDeltaX,t.y+=ye.opt.dragDeltaY,(ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0||ye.opt.linkParams.ConnectIndexHistory.length>0)&&Yo.HandleHookedObjectMoving(S,t)),Ts.UpdateDisplayCoordinates(t,p,ze.CursorTypes.Move,S);const e=new Ke;e.left=t.x,e.top=t.y;const i=S.Dimensions&Se.DimensionFlags.ShowFeetAsInches;e.widthstr=Ae.DocContext.CurrentWidth,e.heightstr=Ae.DocContext.CurrentHeight,e.leftstr=Ve.GetLengthInRulerUnits(e.left,!1,ye.docUtil.rulerConfig.originx,i),e.topstr=Ve.GetLengthInRulerUnits(e.top,!1,ye.docUtil.rulerConfig.originy,i),f&&an.DynamicSnapsUpdateGuides(f,D,u)}h=Os.GetSVGDragElement(l),h&&(h.SetPos(c.x+ye.opt.dragDeltaX,c.y+ye.opt.dragDeltaY),c.x,ye.opt.dragDeltaX,c.y,ye.opt.dragDeltaY,c.width,c.height)}F.Debug("= O.OptUtil  HandleObjectDragMoveCommon - Output:",{deltaX:ye.opt.dragDeltaX,deltaY:ye.opt.dragDeltaY,objectsProcessed:r})}HandleStampDragDoAutoScroll(){F.Debug("= O.OptUtil  HandleStampDragDoAutoScroll - Input: Starting auto-scroll"),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("HandleStampDragDoAutoScroll",100);const t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);ye.docUtil.ScrollToPosition(t.x,t.y),xs.StampObjectMoveCommon(t.x,t.y),F.Debug("= O.OptUtil  HandleStampDragDoAutoScroll - Output: Position updated",t)}OptSltSelectDoAutoScroll(){F.Debug("= O.OptUtil  OptSltSelectDoAutoScroll - Input: starting auto scroll"),ye.opt.autoScrollTimerId=ye.opt.autoScrollTimer.setTimeout("OptSltSelectDoAutoScroll",100);const t=ye.opt.svgDoc.ConvertWindowToDocCoords(ye.opt.autoScrollXPos,ye.opt.autoScrollYPos);F.Debug(`= O.OptUtil  OptSltSelectDoAutoScroll - Converted Coordinates: x=${t.x}, y=${t.y}`),ye.docUtil.ScrollToPosition(t.x,t.y),F.Debug(`= O.OptUtil  OptSltSelectDoAutoScroll - Scrolled to position: x=${t.x}, y=${t.y}`),Qo.OptSltSelectMoveCommon(t.x,t.y),F.Debug("= O.OptUtil  OptSltSelectDoAutoScroll - Output: Rectangle selection moved")}ImportBackgroundLayerImage(t,e){let i,o;F.Debug("= O.OptUtil  ImportBackgroundLayerImage - Input:",{imageUrl:t,importOptions:e});let n=-1;let s=ws.GetObjectPtr(this.layersManagerBlockId,!1);if(s){for(i=0;i<s.layers.length;i++)if(s.layers[i].layertype===Se.LayerTypes.Background){n=i;break}if(n<0)vs.AddNewLayerAtFront("Background Layer",!0,!1),vs.RotateLayerStack(!0),n=s.layers.length-1,s.layers[n].layertype=Se.LayerTypes.Background;else{if(o=s.layers[n].zList,o.length>0&&null==e)return;this.CloseEdit(!0)}vs.MakeLayerActiveByIndex(n),s.layers[n].flags=ve.SetFlag(s.layers[n].flags,Se.LayerFlags.NoAdd,!1),ye.opt.SetBackgroundImage(t,!0,e,!0)}F.Debug("= O.OptUtil  ImportBackgroundLayerImage - Output: Background layer updated")}SetBackgroundImage(t,e,i,o,n){let s;F.Debug("= O.OptUtil  SetBackgroundImage - Input:",{imageUrl:t,replaceExisting:e,hasImportData:!!i,isBackground:o,hasCallback:!!n});let a=!1,r="",l=null,h=null,c=this,p=e,d=800,u=800;const g=(t,e,i)=>{let n,s=[];if(!i&&t>0&&e>0){let i=e,a=t;const p=c.CalcWorkAreaCenterCoords(a,i),d=new ni;d.Name="",d.Line.Thickness=0,d.Fill.Paint.FillType=Se.FillTypes.Transparent;const u={Frame:{x:p.x,y:p.y,width:a,height:i},TextGrow:Se.TextGrowBehavior.ProPortional,ImageURL:r,StyleRecord:d,ObjGrow:me.GrowBehavior.ProPortional,flags:Se.ObjFlags.ImageOnly,extraflags:me.ExtraFlags.NoColor},g=new we.Shape.Rect(u);if(g){const i=Cs.GetImageDir(l);g.SetBlobBytes(h,i),i===Ne.ImageDir.Svg&&(g.SVGDim={width:t,height:e})}n=xs.AddNewObject(g,!1,!0);const y=ws.GetObjectPtr(n,!1);y&&(y.TextFlags=Se.TextFlags.AttachB,y.ImageHeader=new pa,s.push(n));const S=ws.GetObjectPtr(this.layersManagerBlockId,!1);if(S&&S.layers[S.activelayer].layertype===Se.LayerTypes.Background){const t=ws.GetObjectPtr(this.layersManagerBlockId,!0);t.layers[t.activelayer].flags=ve.SetFlag(t.layers[t.activelayer].flags,Se.LayerFlags.NoAdd,!0)}o&&Os.RenderAllSVGObjects(),xs.CompleteOperation(s)}},y=(t,e,i,n)=>{try{let a;r=t,l=e,h=i;let c,d,u,y,S=!1;if((n?n.Data.ImageDir:Cs.GetImageDir(e))===Ne.ImageDir.Svg&&(S=!0,a=ve.ParseSVGDimensions(i)),n?c=n.Data.BlockID:(c=Qo.GetTargetSelect(),y=!1,o&&(c=-1),c>=0&&(s=ws.GetObjectPtr(c,!1),(null==d?void 0:d.indexOf(s.objecttype))<0&&(null==u?void 0:u.indexOf(s.subtype))<0?s.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Shape||s instanceof we.Shape.BaseSymbol||s.SymbolURL||(y=p):(c=-1,y=!1))),y||n)if(s=ws.GetObjectPtr(c,!1),s.GetTable(!1));else{s=ws.GetObjectPtr(c,!0),S&&(s.SVGDim=a),on.DeleteTargetTextObject(c),Ps.IsBlobURL&&Ps.IsBlobURL(s.ImageURL)&&(Ps.DeleteURL(s.ImageURL),s.ImageURL=""),s.ImageURL=t;const e=Cs.GetImageDir(l);s.StyleRecord.Fill.Paint.Opacity=1,s.SetBlobBytes(i,e),s.ImageHeader=new pa,s.TextFlags=ve.SetFlag(s.TextFlags,Se.TextFlags.None,!0),ws.AddToDirtyList(c),xs.CompleteOperation()}else S?g(a.width,a.height,null):xe.CalcImageSize(t,g)}catch(a){throw a}};if(i);else{let i=Qo.GetTargetSelect();0===e&&(a=!1,p=!0,i>=0&&(s=ws.GetObjectPtr(i,!1),i=-1)),i>=0&&(s=ws.GetObjectPtr(i,!1),s.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Shape||s instanceof we.Shape.BaseSymbol||s.SymbolURL||(a=p),a&&(s=ws.GetObjectPtr(i,!1),d=s.Frame.width,u=s.Frame.height));const o=new we.Shape.BitmapImporter;o&&o.ImportBitmap(t,d,u,this.bitmapImportDPI,y)}F.Debug("= O.OptUtil  SetBackgroundImage - Output: Background image set")}CalcWorkAreaCenterCoords(t,e){const i=this.svgDoc,o=i.docInfo.dispX+i.docInfo.dispWidth/2-t/2*i.docInfo.docToScreenScale,n=i.docInfo.dispY+i.docInfo.dispHeight/2-e/2*i.docInfo.docToScreenScale,s=i.ConvertWindowToDocCoords(o,n);return s.x=s.x<10?10:s.x,s.y=s.y<10?10:s.y,s}CalcDocCoords(t,e){const i=this.svgDoc;let o=i.docInfo.dispX+t*i.docInfo.docToScreenScale,n=i.docInfo.dispY+e*i.docInfo.docToScreenScale;const s=i.ConvertWindowToDocCoords(o,n);return s.x=s.x<10?10:s.x,s.y=s.y<10?10:s.y,s}Lock(t,e){const i=ye.stdObj.GetObject(this.selectObjsBlockId).Data,o=i.length;if(0!==o||e){let e,n=0,s=!0;const a=Se.ObjFlags.Lock;for((e=ws.GetObjectPtr(t,!1))&&(s=0==(e.flags&a)),n=0;n<o;++n)e=ws.GetObjectPtr(i[n],!0),e.flags=ve.SetFlag(e.flags,a,s),ws.AddToDirtyList(i[n]);xs.CompleteOperation()}else F.Debug("= O.OptUtil  Lock - Error: No objects selected")}ImportSvgSymbol(t){let e="",i=null,o=null;const n=(t,n,s)=>{let a;const r=[];if(!s&&t>0&&n>0){let s=200,l=200;t<n?l*=t/n:s*=n/t;const h=this.CalcWorkAreaCenterCoords(l,s),c=new ni;c.Name="",c.Line.Thickness=0,c.Fill.Paint.FillType=Se.FillTypes.Transparent;const p={Frame:{x:h.x,y:h.y,width:s,height:l},TextGrow:Se.TextGrowBehavior.ProPortional,ImageURL:e,StyleRecord:c,ObjGrow:me.GrowBehavior.ProPortional,flags:Se.ObjFlags.ImageOnly,extraflags:me.ExtraFlags.NoColor},d=new we.Shape.Rect(p);a=xs.AddNewObject(d,!1,!0);const u=ws.GetObjectPtr(a,!1);if(u){const t=Cs.GetImageDir(i);u.SetBlobBytes(o,t)}r.push(a),xs.CompleteOperation(r)}},s=new we.Shape.SvgImporter;s&&s.ImportSvg(t,((t,s,a)=>{e=t,i=s,o=a,this.CalcSVGSymbolDimensions(s,t,n)}))}CalcSVGSymbolDimensions(t,e,i){if(t){const e=new FileReader;e.UserData={callback:i},e.onload=function(t){const e=this.result;let i=null;window.DOMParser?i=(new DOMParser).parseFromString(e,"text/xml"):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e));let o=i.documentElement.getAttribute("width");o&&(o=o.match(/\d*\.*\d*/)[0]);let n=i.documentElement.getAttribute("height");if(n&&(n=n.match(/\d*\.*\d*/)[0]),o&&n)this.UserData.callback(o,n,null);else{const t=i.documentElement.getAttribute("viewBox");if(t){const e=t.split(" ");o=parseFloat(e[2]),o=o.match(/\d*\.*\d*/)[0],n=parseFloat(e[3]),n=n.match(/\d*\.*\d*/)[0],o&&n?this.UserData.callback(o,n,null):this.UserData.callback(0,0,{error:"No width/height and viewbox bad"})}else this.UserData.callback(0,0,{error:"No viewbox or width/height"})}},e.readAsText(t)}else i&&i(0,0,{error:"No blob passed in"})}ShapeToPolyLine(t,e,i,o){let n,s,a,r,l=[],h={x:0,y:0,width:0,height:0};if(o)s=o,r=!0,h=Oe.DeepCopy(s.Frame);else{s=ws.GetObjectPtr(t,!1),null==s.polylist?(s.polylist=s.GetPolyList(),s.StartPoint={},s.EndPoint={}):r=!0;const e=ye.stdObj.PreserveBlock(t);if(null==e)return;s=e.Data,h=Oe.DeepCopy(s.Frame)}if(r){if(!s.polylist)return null;if(ye.opt.GetClosedPolyDim(s),!ve.IsEqual(s.polylist.dim.x,h.width)){const t=Oe.DeepCopy(s);t.inside=Oe.DeepCopy(s.Frame),we.Shape.PolyLine.prototype.ScaleObject.call(t,0,0,0,0,0,0),s.polylist=t.polylist}}return a=s.polylist.segs.length,s.StartPoint.x=s.Frame.x+s.polylist.segs[0].pt.x+s.polylist.offset.x,s.StartPoint.y=s.Frame.y+s.polylist.segs[0].pt.y+s.polylist.offset.y,s.EndPoint.x=s.Frame.x+s.polylist.segs[a-1].pt.x+s.polylist.offset.x,s.EndPoint.y=s.Frame.y+s.polylist.segs[a-1].pt.y+s.polylist.offset.y,n=e?new we.Shape.PolyLineContainer(s):new we.Shape.PolyLine(s),n.BlockID=s.BlockID,n.polylist.Shape_Rotation=s.RotationAngle,n.polylist.Shape_DataID=s.DataID,n.RotationAngle=0,n.DataID=-1,o||(objectBlock.Data=n),i||(this.AddToDirtyList(t),this.RenderDirtySVGObjects(),l.push(t),this.SelectObjects(l,!1,!0)),n.inside=Oe.DeepCopy(s.Frame),n}GetClosedPolyDim(t){let e,i={x:0,y:0,width:0,height:0};if(t.polylist){const o=Oe.DeepCopy(t),n=new we.Shape.PolyLine(o);n.inside=Oe.DeepCopy(t.Frame),n.polylist.dim.x=0,n.polylist.dim.y=0,e=n.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),e&&e.length&&(ve.GetPolyRect(i,e),i.width<1&&(i.width=1),i.height<1&&(i.height=1),t.polylist.closed&&(t.polylist.dim.x=i.width,t.polylist.dim.y=i.height))}}TextCallback(t,e,i,o){let n,s,a,r,l,h=o.ID,c=null,p=!1;try{const o=ws.GetObjectPtr(ye.opt.teDataBlockId,!1);if("spellcheck"===t&&(c=ws.GetObjectPtr(h,!1),c&&(r=c.GetTable(!1),r&&(l=i.GetUserData(),p=!(r.select>=0)||r.cells[r.select].DataID!=l)),null==ye.opt.svgDoc.GetActiveEdit()&&(p=!0)),o.theActiveTextEditObjectID!=h||p)return void("spellcheck"===t&&(c=ws.GetObjectPtr(h,!1),c&&(r=c.GetTable(!1),l=r?i.GetUserData():c.DataID,l>0&&i&&(n=i.GetRuntimeText(),s=ws.GetObjectPtr(l,Oe.IsStateOpen()),s&&(s.runtimeText=n),Oe.IsStateOpen()||(a=[],a.push(ye.stdObj.GetObject(l)))))));switch(t){case"dragoutside":if((c=ws.GetObjectPtr(h,!1))&&(r=c.GetTable(!1))&&r.select>=0){const t=c.GetTextParams(!1),o=e,n={};n.x=o.x+c.Frame.x,n.y=o.y+c.Frame.y;const s=t.trect;ve.pointInRect(s,n)||(i.editor.isActive&&i.editor.BeginTableDrag(),n.y-=c.trect.y,n.x-=c.trect.x)}break;case"keyend":return e.keyCode,!0;case"edit":on.TextAutoScroll(h),on.TextResizeCommon(h);break;case"didresize":case"selectrange":case"hyperlink":case"select":case"deactivate":break;case"click":o.theTELastOp!=Se.TextElemLastOpt.Init&&on.RegisterLastTEOp(Se.TextElemLastOpt.Select);break;case"charfilter":return c=ws.GetObjectPtr(h,!1),!0}}catch(d){ye.opt.ExceptionCleanup(d)}}LinesAddCurve(t,e,i,o,n,s){}DeleteBlock(t){}ChangeObjectTextAttributes(t,e,i,o,n,s,a,r){}DeSelect(t){}TextEdit_PauseTyping(){clearTimeout(ye.opt.textEntryTimer),ye.opt.textEntryTimer=null,on.RegisterLastTEOp(Se.TextElemLastOpt.Timeout)}SetTopLeft(t,e){const i=Qo.GetTargetSelect();if(i<0)return;const o=ws.GetObjectPtr(i,!0);if(null!==o){let n,s,a,r;n=ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units==Se.RulerUnit.Feet?si.ConvertToFeet(t):si.NumberIsFloat(t,!0)?parseFloat(t):0,e?ye.docUtil.rulerConfig.originx&&(s=100*ye.docUtil.rulerConfig.originx,ye.docUtil.rulerConfig.useInches||(s/=me.Common.MetricConv),n+=Ve.GetLengthInUnits(s),t=n.toFixed(2)):ye.docUtil.rulerConfig.originy&&(s=100*ye.docUtil.rulerConfig.originy,ye.docUtil.rulerConfig.useInches||(s/=me.Common.MetricConv),n+=Ve.GetLengthInUnits(s),t=n.toFixed(2));const l=this.GetDimensionLengthFromString(t,!1,!1);e?(a=l,r=null):(r=l,a=null),o.SetShapeOrigin(a,r,null,!0),Ps.SetLinkFlag(i,Ee.LinkFlags.Move),ws.AddToDirtyList(i,!0),xs.CompleteOperation();const h=o.GetDimensionsForDisplay();Ts.UpdateDisplayCoordinates(h,null,null,o)}}ChangeWidth(t){let e=-1,i=-1,o=null;this.cachedWidth=null;const n=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,s=n.length;if(0!==s){for(let a=0;a<s;++a){const s=ws.GetObjectPtr(n[a],!0);if(e=s.GetDimensionValueFromString(t,1),e>=0&&(i=s.GetDimensionLengthFromValue(e),i=s.AdjustDimensionLength(i),o=s.MaintainProportions(i,null)),i>=0){s.SetSize(i,o,me.ActionTriggerType.LineLength);const t=s.GetDimensionsForDisplay();s.CanUseRFlags()&&t.width===i&&(s.rflags=ve.SetFlag(s.rflags,Se.FloatingPointDim.Width,!0),s.rwd=e),Ps.SetLinkFlag(n[a],Ee.LinkFlags.Move)}ws.AddToDirtyList(n[a])}xs.CompleteOperation()}}ChangeHeight(t){let e=-1,i=-1,o=null;this.cachedHeight=null;const n=ye.stdObj.GetObject(ye.opt.selectObjsBlockId).Data,s=n.length;if(0!==s){for(let a=0;a<s;++a){const s=ws.GetObjectPtr(n[a],!0);if(e=s.GetDimensionValueFromString(t,2),e>=0&&(i=s.GetDimensionLengthFromValue(e),i=s.AdjustDimensionLength(i),o=s.MaintainProportions(null,i)),i>=0){s.SetSize(o,i,me.ActionTriggerType.LineLength);const t=s.GetDimensionsForDisplay();s.CanUseRFlags()&&t.height===i&&(s.rflags=ve.SetFlag(s.rflags,Se.FloatingPointDim.Height,!0),s.rht=e),Ps.SetLinkFlag(n[a],Ee.LinkFlags.Move)}ws.AddToDirtyList(n[a])}xs.CompleteOperation()}}GetDimensionLengthFromString(t,e,i){let o=0,n=0;if(0===t.length)return 0;if(ye.docUtil.rulerConfig.useInches&&ye.docUtil.rulerConfig.units==Se.RulerUnit.Feet&&!e){if(o=si.ConvertToFeet(t),o<0&&!i)return!1}else{if(!si.NumberIsFloat(t,i))return 1;o=parseFloat(t)}return n=ye.docUtil.rulerConfig.showpixels?o:this.UnitsToCoord(o,0),n>4e5&&(n=-1),n}UnitsToCoord(t,e){ws.GetObjectPtr(ye.opt.teDataBlockId,!1);const i=Ve.GetToUnits();return(t+=e*ye.docUtil.rulerConfig.majorScale)/i}SetBackgroundColor(t){try{let e;ye.opt.CloseEdit(!0,!0),e=ws.GetObjectPtr(ye.opt.sdDataBlockId,!0);let i=e.background.Paint.Color;e.background.Paint.FillType===Se.FillTypes.Transparent&&(i=Se.Colors.White);let o=t;t===Se.Colors.Trans&&(o=Se.Colors.White),Ts.ChangeBackgroundTextColor(o,i),t===Se.Colors.Trans?(e.background.Paint.FillType=Se.FillTypes.Transparent,e.background.Paint.Color=Se.Colors.White):(e.background.Paint.FillType=Se.FillTypes.Solid,e.background.Paint.Color=t),e.background.Paint.Opacity=1,Ts.SetBackgroundColor(),xs.CompleteOperation()}catch(e){ye.opt.ExceptionCleanup(e)}}SetShapeBackgroundColor(t){}AddToLibrary(){const t=ye.stdObj.GetObject(this.selectObjsBlockId),e=t.Data;if(F.Debug("= u.OptUtil: AddToLibrary - Selected Object, Selected Data, Object Count",t,e,e.length),0===e.length)return F.Debug("= u.OptUtil: AddToLibrary - Error: No objects selected"),!1;const i=[];e.forEach((t=>{const e=ye.stdObj.GetObject(t);if(e){const t=Oe.DeepCopy(e);i.push(t)}}));const o=JSON.stringify(i,((t,e)=>{if("function"!=typeof e)return e}));return _o.SaveT3Library(o),F.Debug("= u.OptUtil: AddToLibrary - Successfully saved to local storage",{itemCount:i.length,storageKey:"t3.library",sizeInBytes:o.length}),Ka.IdxPage2.addToNewLibrary(),i}LoadLibrary(){const t=_o.LoadT3Library();if(!t||0===t.length)return F.Debug("= u.OptUtil: LoadLibrary - No library items found in storage"),!1;F.Debug("= u.OptUtil: LoadLibrary - rck:",ye.opt.rClickParam);const e=ye.opt.rClickParam&&ye.opt.rClickParam.hitPoint.x&&ye.opt.rClickParam.hitPoint.y,i=e?ye.opt.rClickParam.hitPoint.x:100,o=e?ye.opt.rClickParam.hitPoint.y:100;F.Debug("= u.OptUtil: LoadLibrary - coordsX,coordsY:",i,o);const n=this.CalcDocCoords(i,o);F.Debug("= u.OptUtil: LoadLibrary - docCoords:",n);const s=[];let a=null,r=null,l=0,h=0;return t.forEach(((t,e)=>{if(!t.Data)return;const n=_o.ConvertPlanObjectToShape(t.Data);if(F.Debug("= u.OptUtil: LoadLibrary - ConvertPlanObjectToShape:",n),!n)return;const c=Oe.DeepCopy(n.Frame);null===a&&(a=c.x,r=c.y,l=i-a,h=o-r);const p=c.x+l,d=c.y+h;F.Debug("= u.OptUtil: LoadLibrary - Positioning shape:",{index:e,original:{x:c.x,y:c.y},new:{x:p,y:d},offset:{x:l,y:h}}),n.SetShapeOrigin(p,d,null,!1);const u=xs.AddNewObject(n,!1,!1);u<0||(s.push(u),F.Debug("= u.OptUtil: LoadLibrary - newObject,newObjectId:",n,u))})),!(s.length<=0)&&(this.CloseEdit(!0),Os.RenderAllSVGObjects(),xs.CompleteOperation(s),ye.opt.rClickParam=null,F.Debug("= u.OptUtil: LoadLibrary - Output: Successfully loaded and rendered",s.length,s),!0)}NudgeSelectedObjects(t,e,i){let o,n;F.Debug("= O.OptUtil  NudgeSelectedObjects - Input:",{horizontalDelta:t,verticalDelta:e,isResizeMode:i});let s=ye.stdObj.GetObject(this.selectObjsBlockId).Data,a=s.length;const r=0==(ye.opt.header.flags&me.HeaderFlags.AutoGrowTopLeft),l=Qo.GetTargetSelect();if(0===a)return void F.Debug("= O.OptUtil  NudgeSelectedObjects - Output: No objects selected");let h,c,p;ye.opt.dynamicGuides&&(an.DynamicSnapsRemoveGuides(ye.opt.dynamicGuides),ye.opt.dynamicGuides=null);const d={};let u,g,y,S,m,b=Qo.GetMoveList(s[0],!0,!0,!1,d,!1);for(h=b.length-1;h>=0;h--)if(n=ws.GetObjectPtr(b[h],!1),i&&n.NoGrow())b.splice(h,1);else if(b[h]!==s[0]||(n.objecttype===Se.FNObjectTypes.GanttBar&&b.splice(h,1),0!=(n.flags&Se.ObjFlags.Lock)))if(n.flags&Se.ObjFlags.Lock)b.splice(h,1);else if(!i)for(c=0;c<n.hooks.length;c++)if(-1===b.indexOf(n.hooks[c].objid)){b.splice(h,1);break}if(s=b,a=s.length,!i&&r&&(d.x+t<0||d.y+e<0))return void F.Debug("= O.OptUtil  NudgeSelectedObjects - Output: Operation would move objects out of bounds");if(d.x+=t,d.y+=e,0===a)return void F.Debug("= O.OptUtil  NudgeSelectedObjects - Output: No modifiable objects found");Os.HideAllSVGSelectionStates();let D=0;for(this.dragBBoxList=[],D=0;D<a;++D){if(u=s[D],n=ws.GetObjectPtr(u,!1),i){if(o=Oe.DeepCopy(n),g=n.GetDimensions(),y=null,S=null,m=!1,t){if((n.ObjGrow===me.GrowBehavior.All||n.ObjGrow===me.GrowBehavior.ProPortional||n.ObjGrow===me.GrowBehavior.Horiz)&&(y=g.x+t,y<=10))continue;g.y>0&&n.ObjGrow===me.GrowBehavior.ProPortional&&(S=g.y+t,m=!0)}if(e&&!m){if((n.ObjGrow===me.GrowBehavior.All||n.ObjGrow===me.GrowBehavior.ProPortional||n.ObjGrow===me.GrowBehavior.Vertical)&&(S=g.y+e,S<=10))continue;g.x>0&&n.ObjGrow===me.GrowBehavior.ProPortional&&(y=g.x+e)}n=ws.GetObjectPtr(u,!0),n.flags&Se.ObjFlags.TextOnly&&n.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent&&(n.flags=ve.SetFlag(n.flags,Se.ObjFlags.TextOnly,!1),n.SetTextGrow(Se.TextGrowBehavior.Vertical)),n.SetSize(y,S,me.ActionTriggerType.LineLength),Yo.MaintainLink(n.BlockID,n,o,me.ActionTriggerType.LineEnd)}else $o.OffsetShape(u,t,e,me.ActionTriggerType.TableSelect);if(ws.AddToDirtyList(u,!i),u===l){const t=n.GetDimensionsForDisplay();Ts.UpdateDisplayCoordinates(t,null,null,n)}n&&1===n.hooks.length&&!i&&(p=ws.GetObjectPtr(n.hooks[0].objid,!1),this.HookedObjectMovingDebounced(n,p))}this.nudgeOpen?i?(this.nudgeGrowX+=t,this.nudgeGrowY+=e):(this.nudgeX+=t,this.nudgeY+=e):i?(this.nudgeGrowX=t,this.nudgeGrowY=e,this.nudgeX=0,this.nudgeY=0):(this.nudgeGrowX=0,this.nudgeGrowY=0,this.nudgeX=t,this.nudgeY=e),(this.theDragGotAutoResizeLeft||this.theDragGotAutoResizeTop)&&this.ResetOrigin(),this.nudgeOpen=!1,this.UpdateLinks(),Yo.UpdateLineHops(!0),Ts.FitDocumentWorkArea(!1,!1),Os.RenderDirtySVGObjects(),Os.RenderAllSVGSelectionStates(),this.ScrollObjectIntoView(-1,!1,d),this.nudgeOpen=!0,xs.UpdateAppStateV2Frame(),F.Debug("= O.OptUtil  NudgeSelectedObjects - Output: Objects modified",{objectCount:a})}ResetOrigin(){F.Debug("= O.OptUtil  ResetOrigin - Input: Starting reset");const t=this.theDragGotAutoResizeLeft?-this.theDragGotAutoResizeOldLeft.at(-1):0,e=this.theDragGotAutoResizeTop?-this.theDragGotAutoResizeOldTop.at(-1):0;vs.ZList().forEach((i=>{const o=ye.stdObj.PreserveBlock(i).Data;null!=o&&(o.OffsetShape(t,e),ws.AddToDirtyList(i))})),this.ResetSVGRenderOffset(),this.theDragGotAutoResizeLeft=!1,this.theDragGotAutoResizeTop=!1,this.theDragGotAutoResizeOldLeft=[],this.theDragGotAutoResizeOldTop=[],F.Debug("= O.OptUtil  ResetOrigin - Output: Origin reset completed",{horizontalOffset:t,verticalOffset:e})}ResetSVGRenderOffset(){F.Debug("= O.OptUtil  ResetSVGRenderOffset - Input: Resetting offsets to zero"),this.SetSVGRenderOffset(0,0),F.Debug("= O.OptUtil  ResetSVGRenderOffset - Output: Offsets reset")}SetSVGRenderOffset(t,e){F.Debug("= O.OptUtil  SetSVGRenderOffset - Input:",{horizontalOffset:t,verticalOffset:e}),this.svgObjectLayer&&this.svgObjectLayer.SetPos(t,e),this.svgOverlayLayer&&this.svgOverlayLayer.SetPos(t,e),this.svgHighlightLayer&&this.svgHighlightLayer.SetPos(t,e),this.svgCollabLayer&&this.svgCollabLayer.SetPos(t,e),F.Debug("= O.OptUtil  SetSVGRenderOffset - Output: Positions updated for all layers")}HookedObjectMovingDebounced(t,e){if(F.Debug("= O.OptUtil  HookedObjectMovingDebounced - Input:",{movingObjectId:t.BlockID,hookedObjectId:null==e?void 0:e.BlockID}),e&&e.HookedObjectMoving&&e.Dimensions&(Se.DimensionFlags.Always|Se.DimensionFlags.Select)){clearTimeout(this.HookedObjectMovingTimer);const i=!this.HookedObjectMovingLastExecutionTime||Date.now()-this.HookedObjectMovingLastExecutionTime>=100?0:100,o=this;this.HookedObjectMovingTimer=setTimeout((function(){e.HookedObjectMoving({linkParams:null,movingShapeID:t.BlockID,movingShapeBBox:t.GetDimensionsForDisplay()}),o.HookedObjectMovingLastExecutionTime=Date.now(),F.Debug("= O.OptUtil  HookedObjectMovingDebounced - Output: HookedObjectMoving called")}),i)}else F.Debug("= O.OptUtil  HookedObjectMovingDebounced - Output: No action (hookedObject not eligible)")}CloseOpenNudge(){this.nudgeOpen=!1,xs.CompleteOperation(),F.Debug("= O.OptUtil  CloseOpenNudge - Input/Output: Nudge closed and operation completed")}FlipPoints(t,e,i){let o,n,s;F.Debug("= O.OptUtil  FlipPoints - Input:",{frame:t,flipFlags:e,pointCount:i.length});const a=me.ExtraFlags;for(s=i.length,n=0;n<s;n++)e&a.FlipHoriz&&(o=i[n].x-t.x,i[n].x=t.x+t.width-o),e&a.FlipVert&&(o=i[n].y-t.y,i[n].y=t.y+t.height-o);F.Debug("= O.OptUtil  FlipPoints - Output: Points flipped",{pointCount:s})}TableGetRowConnectPoints(t,e){var i,o;let n,s,a,r,l,h,c,p;F.Debug("= O.OptUtil  TableGetRowConnectPoints - Input:",{tableElement:null==t?void 0:t.BlockID,tableData:{rowCount:null==(i=null==e?void 0:e.rows)?void 0:i.length,cellCount:null==(o=null==e?void 0:e.cells)?void 0:o.length}});const d=e.rows.length,u=[],g=t.Frame.height,y=me.Common.DimMax;h={x:y/2,y:0},u.push(h),h={x:y/2,y:y},u.push(h);const S=t.trect.y-t.Frame.y;for(n=0;n<d;n++){for(c=e.rows[n],r=e.cells[c.start],l=r.frame.y+S,a=r.frame.height,p=r.nextra,s=1;s<=p;s++)r=e.cells[e.rows[n+s].start],a+=r.frame.height;n+=p,l+=a/2,h={x:0,y:l/g*y},u.push(h)}for(n=0;n<d;n++){for(c=e.rows[n],r=e.cells[c.start+c.ncells-1],l=r.frame.y+S,a=r.frame.height,p=r.nextra,s=1;s<=p;s++){const t=e.rows[n+s];r=e.cells[t.start+t.ncells-1],a+=r.frame.height}n+=p,l+=a/2,h={x:y,y:l/g*y},u.push(h)}return F.Debug("= O.OptUtil  TableGetRowConnectPoints - Output:",{pointCount:u.length}),u}FindAllChildLines(t,e){const i={lindex:-1,id:-1,hookpt:0},o=[];for(;this.FindChildArrayByIndex(t,i,e,me.DrawObjectBaseClass.Line)>0;)o.push(i.id);return o}CommentUngroup(t){}CommentGroup(t){}UngroupNative(t,e,i){let o,n,s,a,r,l,h,c,p,d=[],u={selectedList:[]};if(o=ws.GetObjectPtr(t,!1),o.NativeID>=0&&(n=ws.GetObjectPtr(o.NativeID,!1))&&(Vo.ReadSymbolFromBuffer(n,0,0,0,!1,!1,u,!1,!1,!1,!1,!1),u.selectedList.length)){l=u.selectedList.length;let e=this.GetListSRect(u.selectedList);a=o.Frame.width/e.width,r=o.Frame.height/e.height;let n={x:o.Frame.x+o.Frame.width/2,y:o.Frame.y+o.Frame.height/2};if(c=o.Frame.x,p=o.Frame.y,ve.IsEqual(100*a,100)&&ve.IsEqual(100*r,100)||!(l>1))for(h=0;h<l;h++)t=u.selectedList[h],ws.GetObjectPtr(t,!1).OffsetShape(c,p);else for(h=0;h<l;h++)t=u.selectedList[h],ws.GetObjectPtr(t,!1).ScaleObject(c,p,n,0,a,r,!0);l>1&&!i?(t=Xo.GroupSelectedShapes(!0,u.selectedList,!1),s=ws.GetObjectPtr(t,!1),d.push(t),s.InitialGroupBounds.x=0,s.InitialGroupBounds.y=0,s.Frame=Oe.DeepCopy(o.Frame),s.RotationAngle=o.RotationAngle,s.extraflags=ve.SetFlag(s.extraflags,me.ExtraFlags.FlipHoriz,(o.extraflags&me.ExtraFlags.FlipHoriz)>0),s.extraflags=ve.SetFlag(s.extraflags,me.ExtraFlags.FlipVert,(o.extraflags&me.ExtraFlags.FlipVert)>0),s.UpdateFrame(s.Frame)):d.push(u.selectedList[0])}return d}}class ua{constructor(){a(this,"Name"),a(this,"Context"),a(this,"ModifierKey"),a(this,"KeyCode"),a(this,"Command"),a(this,"CommandParent"),a(this,"CommandParams"),a(this,"Execute")}BuildCommand(t,e,i,o,n,s,a){return F.Debug("U.KeyboardUtil: Creating keyboard command",t,e,i,o),this.Name=null!==t?t:null,this.Context=null!==e?e:Xe.Contexts.None,this.ModifierKey=null!==i?i:Xe.ModifierKeys.None,this.KeyCode=null!==o?o:null,this.Command="function"==typeof n?n:function(){F.Debug("U.KeyboardUtil: Keyboard command is unbound",this.Name,this.ModifierKey,this.KeyCode)},this.CommandParent=null!==s?s:this,this.CommandParams=null!==a?a:[],this.Execute=function(){F.Debug("U.KeyboardUtil: Executing command",this.Name);const t=this.Command.apply(this.CommandParent,this.CommandParams);return F.Debug("U.KeyboardUtil: Command execution complete",this.Name),t},this}}class ga{NavRight(){F.Debug("= O.ArrowKeyOpt: NavRight called");try{this.NudgeRight()}catch(t){F.Debug("= O.ArrowKeyOpt: NavRight error:",t),ye.opt.ExceptionCleanup(t)}}NavLeft(){F.Debug("= O.ArrowKeyOpt: NavLeft called");try{this.NudgeLeft()}catch(t){F.Debug("= O.ArrowKeyOpt: NavLeft error:",t),ye.opt.ExceptionCleanup(t)}}NavUp(){F.Debug("= O.ArrowKeyOpt: NavUp called");try{this.NudgeUp()}catch(t){F.Debug("= O.ArrowKeyOpt: NavUp error:",t),ye.opt.ExceptionCleanup(t)}}NavDown(){F.Debug("= O.ArrowKeyOpt: NavDown called");try{this.NudgeDown()}catch(t){F.Debug("= O.ArrowKeyOpt: NavDown error:",t),ye.opt.ExceptionCleanup(t)}}NudgeRight(){F.Debug("= O.ArrowKeyOpt: NudgeRight called");try{this.Nudge(1,0)}catch(t){F.Debug("= O.ArrowKeyOpt: NudgeRight error:",t),ye.opt.ExceptionCleanup(t)}}NudgeLeft(){F.Debug("= O.ArrowKeyOpt: NudgeLeft called");try{this.Nudge(-1,0)}catch(t){F.Debug("= O.ArrowKeyOpt: NudgeLeft error:",t),ye.opt.ExceptionCleanup(t)}}NudgeUp(){F.Debug("= O.ArrowKeyOpt: NudgeUp called");try{this.Nudge(0,-1)}catch(t){F.Debug("= O.ArrowKeyOpt: NudgeUp error:",t),ye.opt.ExceptionCleanup(t)}}NudgeDown(){F.Debug("= O.ArrowKeyOpt: NudgeDown called");try{this.Nudge(0,1)}catch(t){F.Debug("= O.ArrowKeyOpt: NudgeDown error:",t),ye.opt.ExceptionCleanup(t)}}GrowRight(){F.Debug("= O.ArrowKeyOpt: GrowRight called");try{this.NudgeGrow(1,0)}catch(t){F.Debug("= O.ArrowKeyOpt: GrowRight error:",t),ye.opt.ExceptionCleanup(t)}}GrowLeft(){F.Debug("= O.ArrowKeyOpt: GrowLeft called");try{this.NudgeGrow(-1,0)}catch(t){F.Debug("= O.ArrowKeyOpt: GrowLeft error:",t),ye.opt.ExceptionCleanup(t)}}GrowDown(){F.Debug("= O.ArrowKeyOpt: GrowDown called");try{this.NudgeGrow(0,1)}catch(t){F.Debug("= O.ArrowKeyOpt: GrowDown error:",t),ye.opt.ExceptionCleanup(t)}}GrowUp(){F.Debug("= O.ArrowKeyOpt: GrowUp called");try{this.NudgeGrow(0,-1)}catch(t){F.Debug("= O.ArrowKeyOpt: GrowUp error:",t),ye.opt.ExceptionCleanup(t)}}Nudge(t,e){F.Debug(`= O.ArrowKeyOpt: Nudge input - xOffset: ${t}, yOffset: ${e}`);const i=ye.opt.NudgeSelectedObjects(t,e,!1);return F.Debug("= O.ArrowKeyOpt: Nudge complete"),i}NudgeGrow(t,e){F.Debug(`= O.ArrowKeyOpt: NudgeGrow input - xAmount: ${t}, yAmount: ${e}`);const i=ye.opt.NudgeSelectedObjects(t,e,!0);return F.Debug("= O.ArrowKeyOpt: NudgeGrow complete"),i}}class ya{constructor(){}static GetCommandsInContext(t,e,i,o,n){F.Debug("U.KeyboardUtil: Getting commands for context",t);let s=[];switch(t){case Xe.Contexts.All:s.push((new ua).BuildCommand("Copy",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.C,i.Copy,i)),s.push((new ua).BuildCommand("Cut",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.X,i.Cut,i)),s.push((new ua).BuildCommand("Paste",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.V,i.Paste,i)),s.push((new ua).BuildCommand("Undo",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Z,i.Undo,i)),s.push((new ua).BuildCommand("Redo",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.B,i.Redo,i)),s.push((new ua).BuildCommand("Reset",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.R,i.ClearAndRest,i)),s.push((new ua).BuildCommand("SelectAll",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.A,i.SelectAllObjects,i)),s.push((new ua).BuildCommand("Delete",Xe.Contexts.All,Xe.ModifierKeys.None,Xe.Keys.Delete,i.DeleteSelectedObjects,i)),s.push((new ua).BuildCommand("Cancel",Xe.Contexts.All,Xe.ModifierKeys.None,Xe.Keys.Escape,i.CancelOperation,i)),s.push((new ua).BuildCommand("Group",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.G,i.GroupSelected,i)),s.push((new ua).BuildCommand("Ungroup",Xe.Contexts.All,Xe.ModifierKeys.Ctrl_Shift,Xe.Keys.G,i.UnGroupSelected,i)),s.push((new ua).BuildCommand("Duplicate",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.D,i.Duplicate,i)),s.push((new ua).BuildCommand("Save",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.S,i.Save,i)),s.push((new ua).BuildCommand("ZoomIn",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Add,o.ZoomIn,o)),s.push((new ua).BuildCommand("ZoomOut",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Subtract,o.ZoomOut,o)),s.push((new ua).BuildCommand("ZoomIn",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Equal_Sign,o.ZoomIn,o)),s.push((new ua).BuildCommand("ZoomOut",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Dash,o.ZoomOut,o)),s.push((new ua).BuildCommand("NavRight",Xe.Contexts.All,0,Xe.Keys.Right_Arrow,n.NavRight,n)),s.push((new ua).BuildCommand("NavLeft",Xe.Contexts.All,0,Xe.Keys.Left_Arrow,n.NavLeft,n)),s.push((new ua).BuildCommand("NavUp",Xe.Contexts.All,0,Xe.Keys.Up_Arrow,n.NavUp,n)),s.push((new ua).BuildCommand("NavDown",Xe.Contexts.All,0,Xe.Keys.Down_Arrow,n.NavDown,n));break;case Xe.Contexts.ReadOnly:s.push((new ua).BuildCommand("ZoomIn",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Add,o.ZoomIn,o)),s.push((new ua).BuildCommand("ZoomOut",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Subtract,o.ZoomOut,o)),s.push((new ua).BuildCommand("ZoomIn",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Equal_Sign,o.ZoomIn,o)),s.push((new ua).BuildCommand("ZoomOut",Xe.Contexts.All,Xe.ModifierKeys.Ctrl,Xe.Keys.Dash,o.ZoomOut,o));break;case Xe.Contexts.Automation:s.push((new ua).BuildCommand("NavRight",Xe.Contexts.All,0,Xe.Keys.Right_Arrow,n.NavRight,n)),s.push((new ua).BuildCommand("NavLeft",Xe.Contexts.All,0,Xe.Keys.Left_Arrow,n.NavLeft,n)),s.push((new ua).BuildCommand("NavUp",Xe.Contexts.All,0,Xe.Keys.Up_Arrow,n.NavUp,n)),s.push((new ua).BuildCommand("NavDown",Xe.Contexts.All,0,Xe.Keys.Down_Arrow,n.NavDown,n));break;case Xe.Contexts.AutomationNoCtrl:case Xe.Contexts.WallOpt:break;case Xe.Contexts.Text:case Xe.Contexts.DimensionText:s.push((new ua).BuildCommand("Copy",Xe.Contexts.Text,Xe.ModifierKeys.Ctrl,Xe.Keys.C,i.Copy,i)),s.push((new ua).BuildCommand("Cut",Xe.Contexts.Text,Xe.ModifierKeys.Ctrl,Xe.Keys.X,i.Cut,i)),s.push((new ua).BuildCommand("Paste",Xe.Contexts.Text,Xe.ModifierKeys.Ctrl,Xe.Keys.V,i.Paste,i)),s.push((new ua).BuildCommand("Undo",Xe.Contexts.Text,Xe.ModifierKeys.Ctrl,Xe.Keys.Z,i.Undo,i)),s.push((new ua).BuildCommand("Redo",Xe.Contexts.Text,Xe.ModifierKeys.Ctrl,Xe.Keys.B,i.Redo,i))}return F.Debug("U.KeyboardUtil: Retrieved",null==s?void 0:s.length,"commands for context",t),s}static OnKeyUp(t){F.Debug("U.KeyboardUtil: Processing key up event",t.keyCode),t.keyCode===Xe.Keys.Space&&(F.Debug("U.KeyboardUtil: Space key released, updating spacebar state"),Ae.DocContext.SpacebarDown=!1)}static OnKeyDown(t){F.Debug("U.KeyboardUtil: Processing key down event",t.keyCode);const e=t.keyCode,i=si.GetModifierKeys(t);e===Xe.Keys.Space&&(F.Debug("U.KeyboardUtil: Space key pressed, updating spacebar state"),Ae.DocContext.SpacebarDown=!0);const o=Rt(t.target||t.srcElement);8!==e||o.is('input,[contenteditable="true"],textarea')&&"radio"!==o.attr("type")&&"checkbox"!==o.attr("type")||(F.Debug("U.KeyboardUtil: Preventing default backspace behavior"),t.preventDefault());try{ya.HandleKeyDown(t,e,i)}catch(n){throw Uo.Error("= o.KeyboardOpt: OnKeyDown/ Error in key down handler",n),ye.opt.ExceptionCleanup(n),n}}static HandleKeyDown(t,e,i){F.Debug("U.KeyboardUtil: Processing key down event",{keyCode:e,modifierKey:i});let o=!1,n=[],s=0,a=0,r=new bs,l=new ua,h=ye.docUtil,c=new ga;const p=(e==Xe.Keys.Left_Arrow||e==Xe.Keys.Right_Arrow||e==Xe.Keys.Up_Arrow||e==Xe.Keys.Down_Arrow)&&ye.userSetting.DisableCtrlArrowShapeInsert;if(1!=i||67!=e&&99!=e&&88!=e&&120!=e&&86!=e&&118!=e){let d=r.GetSelectionContext();if("titleInput"===t.target.id&&(d=Xe.Contexts.Text),d instanceof Array)for(s=d.length,a=0;a<s;a++)n.push(d[a]);else n.push(d);const u=null;n.indexOf(u)<0&&n.push(u),n.push(Xe.Contexts.All),s=n.length,ye.docUtil.IsReadOnly()&&(n=[Xe.Contexts.ReadOnly],s=n.length);for(let g=0;g<s;g++){const s=n[g],d=ya.GetCommandsInContext(s,l,r,h,c),u=d.length;for(a=0;a<u;a++){const n=d[a];if(n.KeyCode===e&&n.ModifierKey===i){if(p&&o)break;if(!n.Execute())return F.Debug("U.KeyboardUtil: Command executed and prevented default",{command:n.Name}),t.stopPropagation(),void t.preventDefault()}}if(!1===Ae.DocContext.CanTypeInWorkArea)return;if(s===Xe.Contexts.DimensionText&&(o=!0),s===Xe.Contexts.Text&&(i===Xe.ModifierKeys.None||i===Xe.ModifierKeys.Shift||i===Xe.ModifierKeys.Ctrl||i===Xe.ModifierKeys.Ctrl_Shift))if(!1===r.IsActiveTextEdit()&&"titleInput"!=t.target.id){if(-1!=Xe.NonTextKeys.indexOf(e))continue;i!=Xe.ModifierKeys.Ctrl&&(o=!0)}else o=!0;if(o&&i!=Xe.ModifierKeys.Ctrl)break}o&&(e===Xe.Keys.Escape?(ye.opt.DeactivateAllTextEdit(!1),ye.opt.bInNoteEdit,Os.RenderAllSVGSelectionStates(),t.stopPropagation(),t.preventDefault(),F.Debug("U.KeyboardUtil: Text edit closed with Escape key")):r.HandleKeyDown(t,e,i)&&(t.stopPropagation(),t.preventDefault(),F.Debug("U.KeyboardUtil: Key event handled by shapes controller")))}else Jo.isFirefox&&(Jo.FocusOnIEclipboardDiv(),F.Debug("U.KeyboardUtil: Focusing on IE clipboard div for Firefox"));F.Debug("U.KeyboardUtil: Key down handling complete")}static OnKeyPress(t){F.Debug("U.KeyboardUtil: Processing key press event",t.charCode);const e=t.charCode;try{F.Debug("U.KeyboardUtil: Delegating key press handling to MainController",{charCode:e}),ya.HandleKeyPress(t,e)}catch(i){throw Uo.Error("= o.KeyboardOpt: OnKeyPress/ Error in key press handler",i),i}}static HandleKeyPress(t,e){F.Debug("U.KeyboardUtil: Handling key press event",{charCode:e});let i=!1,o=new bs;if(1!=si.GetModifierKeys(t)||67!=e&&99!=e&&88!=e&&120!=e&&86!=e&&118!=e){if(!1!==Ae.DocContext.CanTypeInWorkArea&&!ye.docUtil.IsReadOnly()){const n=o.GetSelectionContext();n instanceof Array&&(i=n.indexOf(Xe.Contexts.Text)>=0),(i||n===Xe.Contexts.Text||n===Xe.Contexts.DimensionText)&&(F.Debug("U.KeyboardUtil: Delegating key press to shape handler in text context"),o.HandleKeyPress(t,e)&&t.stopPropagation())}}else Jo.isFirefox&&(F.Debug("U.KeyboardUtil: Focusing on IE clipboard div for Firefox"),Jo.FocusOnIEclipboardDiv());F.Debug("U.KeyboardUtil: Key press handling complete")}}class Sa{constructor(){a(this,"UserID"),a(this,"DateChanged"),a(this,"ShowGrid"),a(this,"RecentColors"),a(this,"PaperSize"),a(this,"Metric"),a(this,"DisableCtrlArrowShapeInsert"),a(this,"CursorDisplayMode"),this.UserID=-1,this.DateChanged=null,this.ShowGrid=!1,this.RecentColors=[],this.PaperSize=0,this.Metric=!1,this.DisableCtrlArrowShapeInsert=!1,this.CursorDisplayMode=Ae.CursorDisplayMode.Show}}class ma{constructor(){a(this,"userSetting"),this.userSetting=new Sa}Initialize(){ye.userSetting=this.userSetting}}const ba={Container:Is,Effect:Si,Style:xe,Element:Di,Group:_s,Image:Js,Layer:Us,Line:js,Oval:Rs,Creator:Es,Path:Fs,Polygon:Hs,PolyLine:Bs,PolyPolyLine:Ms,Rect:As,RRect:Gs,ShapeContainer:Vs,ShapeCopy:zs,Symbol:Ns,Edit:Xs};class Da{constructor(){a(this,"firstdir"),a(this,"lastdir"),a(this,"curveparam"),a(this,"pts"),a(this,"lengths"),this.firstdir=0,this.lastdir=0,this.curveparam=0,this.pts=[],this.lengths=[]}}class fa extends es{constructor(t){F.Debug("= S.SegmentedLine: constructor input",t);const e=t||{};e.LineType=e.LineType||me.LineType.SEGLINE,super(e),a(this,"segl"),a(this,"hoplist"),a(this,"ArrowheadData"),a(this,"StartArrowID"),a(this,"EndArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),a(this,"TextDirection"),this.segl=e.segl||new Da,null!=e.curveparam&&(this.segl.curveparam=e.curveparam),this.StartPoint=e.StartPoint||{x:0,y:0},this.EndPoint=e.EndPoint||{x:0,y:0},this.SegLFormat(this.EndPoint,me.ActionTriggerType.LineEnd,0),this.CalcFrame(),this.hoplist=e.hoplist||{nhops:0,hops:[]},this.ArrowheadData=e.ArrowheadData||[],this.StartArrowID=e.StartArrowID||0,this.EndArrowID=e.EndArrowID||0,this.StartArrowDisp=e.StartArrowDisp||!1,this.EndArrowDisp=e.EndArrowDisp||!1,this.ArrowSizeIndex=e.ArrowSizeIndex||0,this.TextDirection=e.TextDirection||!1,F.Debug("= S.SegmentedLine: constructor output",{segl:this.segl,StartPoint:this.StartPoint,EndPoint:this.EndPoint,hoplist:this.hoplist,ArrowheadData:this.ArrowheadData,StartArrowID:this.StartArrowID,EndArrowID:this.EndArrowID,StartArrowDisp:this.StartArrowDisp,EndArrowDisp:this.EndArrowDisp,ArrowSizeIndex:this.ArrowSizeIndex,TextDirection:this.TextDirection})}CreateShape(t,e){if(F.Debug("= S.SegmentedLine: CreateShape input",{svgDoc:t,isHidden:e}),this.flags&Se.ObjFlags.NotVisible)return null;let i=[];const o=t.CreateShape(me.CSType.ShapeContainer),n=t.CreateShape(me.CSType.Polyline);n.SetID(me.SVGElementClass.Shape);const s=t.CreateShape(me.CSType.Polyline);s.SetID(me.SVGElementClass.Slop),s.ExcludeFromExport(!0),this.CalcFrame();const a=ve.Pt2Rect(this.StartPoint,this.EndPoint);let r=this.StyleRecord;r=this.SVGTokenizerHook(r);const l=r.Line.Paint.Color;let h=r.Line.Thickness;const c=r.Line.Paint.Opacity,p=r.Line.LinePattern;h>0&&h<1&&(h=1);let d=a.width,u=a.height;if(d<h&&(d=h),u<h&&(u=h),o.SetSize(d,u),o.SetPos(a.x,a.y),n.SetSize(d,u),i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null),0!==this.hoplist.nhops){const t=ye.opt.InsertHops(this,i,i.length);i=i.slice(0,t.npts)}return this.UpdateSVG(n,i),n.SetFillColor("none"),n.SetStrokeColor(l),n.SetStrokeOpacity(c),n.SetStrokeWidth(h),0!==p&&n.SetStrokePattern(p),s.SetSize(d,u),this.UpdateSVG(s,i),s.SetStrokeColor("white"),s.SetFillColor("none"),s.SetOpacity(0),e?s.SetEventBehavior(me.EventBehavior.HiddenOut):s.SetEventBehavior(me.EventBehavior.None),s.SetStrokeWidth(h+me.Common.Slop),o.AddElement(n),o.AddElement(s),this.ApplyStyles(n,r),this.ApplyEffects(o,!1,!0),o.isShape=!0,this.AddIcons(t,o),F.Debug("= S.SegmentedLine: CreateShape output",{shape:o}),o}UpdateSVG(t,e){F.Debug("= S.SegmentedLine: UpdateSVG input",{shape:t,points:e}),t&&t.SetPoints&&t.SetPoints(e),F.Debug("= S.SegmentedLine: UpdateSVG output",{shape:t})}AllowHeal(){F.Debug("= S.SegmentedLine: AllowHeal input");return F.Debug("= S.SegmentedLine: AllowHeal output",true),true}CanUseStandOffDimensionLines(){F.Debug("= S.SegmentedLine: CanUseStandOffDimensionLines input");return F.Debug("= S.SegmentedLine: CanUseStandOffDimensionLines output",false),false}SegLFormat(t,e,i){let o,n,s,a,r,l;F.Debug("= S.SegmentedLine: SegLFormat input",{targetPoint:t,actionType:e,initialDirection:i});let h=!1,c=!1,p=!1;const d=Se.SegLDir,u=(t,e,i)=>{let o=0;const n=Math.abs(i.x-e.x),s=Math.abs(i.y-e.y);switch(t){case d.Ktc:o=i.y<e.y?s>=n?d.Kbc:i.x<e.x?d.Krc:d.Klc:d.Ktc;break;case d.Kbc:o=i.y>=e.y?s>=n?d.Ktc:i.x<e.x?d.Krc:d.Klc:d.Kbc;break;case d.Klc:o=i.x<e.x?s<=n?d.Krc:i.y<e.y?d.Kbc:d.Ktc:d.Klc;break;case d.Krc:o=i.x>e.x?s<n?d.Klc:i.y<e.y?d.Kbc:d.Ktc:d.Krc;break;default:o=t}return o};if(null!=this.segl){switch(e){case me.ActionTriggerType.LineStart:this.StartPoint.x=t.x,this.StartPoint.y=t.y;break;case me.ActionTriggerType.SeglPreserve:case me.ActionTriggerType.LineEnd:this.EndPoint.x=t.x,this.EndPoint.y=t.y}if(0!==this.segl.firstdir||0!==this.segl.lastdir){if(0===this.segl.lastdir){switch(e){case me.ActionTriggerType.LineStart:case me.ActionTriggerType.SeglOne:case me.ActionTriggerType.SeglTwo:case me.ActionTriggerType.SeglThree:i=u(this.segl.firstdir,t,this.EndPoint);break;case me.ActionTriggerType.SeglPreserve:i=u(this.segl.firstdir,this.StartPoint,this.EndPoint);break;default:i=u(this.segl.firstdir,this.StartPoint,t)}h=!0,this.segl.lastdir=i,p=!0}if(0===this.segl.firstdir){switch(e){case me.ActionTriggerType.LineEnd:case me.ActionTriggerType.SeglOne:case me.ActionTriggerType.SeglTwo:case me.ActionTriggerType.SeglThree:i=u(this.segl.lastdir,t,this.StartPoint);break;case me.ActionTriggerType.SeglPreserve:i=u(this.segl.lastdir,this.EndPoint,this.StartPoint);break;default:i=u(this.segl.lastdir,this.EndPoint,t)}c=!0,this.segl.firstdir=i,p=!0}switch(this.segl.firstdir){case d.Ktc:switch(this.segl.lastdir){case d.Ktc:this.SegLTopToTop(e,t,1,!1,p);break;case d.Kbc:this.SegLTopToBottom(e,t,1,!1);break;case d.Klc:this.SegLTopToLeft(e,t,1,1,!1,p);break;case d.Krc:this.SegLTopToLeft(e,t,1,-1,!1,p)}break;case d.Kbc:switch(this.segl.lastdir){case d.Ktc:this.SegLTopToBottom(e,t,-1,!1);break;case d.Kbc:this.SegLTopToTop(e,t,-1,!1,p);break;case d.Klc:this.SegLTopToLeft(e,t,-1,1,!1,p);break;case d.Krc:this.SegLTopToLeft(e,t,-1,-1,!1,p)}break;case d.Klc:switch(this.segl.lastdir){case d.Ktc:this.SegLTopToLeft(e,t,1,1,!0,p);break;case d.Kbc:this.SegLTopToLeft(e,t,1,-1,!0,p);break;case d.Klc:this.SegLTopToTop(e,t,1,!0,p);break;case d.Krc:this.SegLTopToBottom(e,t,1,!0)}break;case d.Krc:switch(this.segl.lastdir){case d.Ktc:this.SegLTopToLeft(e,t,-1,1,!0,p);break;case d.Kbc:this.SegLTopToLeft(e,t,-1,-1,!0,p);break;case d.Klc:this.SegLTopToBottom(e,t,-1,!0);break;case d.Krc:this.SegLTopToTop(e,t,-1,!0,p)}}h&&(this.segl.lastdir=0),c&&(this.segl.firstdir=0)}else if(o=this.EndPoint.x-this.StartPoint.x,n=this.EndPoint.y-this.StartPoint.y,s=Math.abs(o),a=Math.abs(n),r=ve.Pt2Rect(this.StartPoint,this.EndPoint),a>=1||s>=1){if(0===i&&(i=s-a>.01?me.Common.HorizOnly:me.Common.VertOnly),this.segl.pts.splice(0),this.segl.lengths.splice(0),i===me.Common.HorizOnly)if(a<1)this.segl.pts.push(new De(this.StartPoint.x,this.StartPoint.y)),this.segl.pts.push(new De(this.EndPoint.x,this.EndPoint.y)),this.segl.lengths.push(o);else{const t=o/2;this.segl.pts.push(new De(this.StartPoint.x,this.StartPoint.y)),this.segl.pts.push(new De(this.StartPoint.x+t,this.StartPoint.y)),this.segl.pts.push(new De(this.StartPoint.x+t,this.EndPoint.y)),this.segl.pts.push(new De(this.EndPoint.x,this.EndPoint.y)),this.segl.lengths.push(t),this.segl.lengths.push(n),this.segl.lengths.push(t)}else if(i===me.Common.VertOnly)if(s<1)this.segl.pts.push(new De(this.StartPoint.x,this.StartPoint.y)),this.segl.pts.push(new De(this.EndPoint.x,this.EndPoint.y)),this.segl.lengths.push(n);else{const t=n/2;this.segl.pts.push(new De(this.StartPoint.x,this.StartPoint.y)),this.segl.pts.push(new De(this.StartPoint.x,this.StartPoint.y+t)),this.segl.pts.push(new De(this.EndPoint.x,this.StartPoint.y+t)),this.segl.pts.push(new De(this.EndPoint.x,this.EndPoint.y)),this.segl.lengths.push(t),this.segl.lengths.push(o),this.segl.lengths.push(t)}l=this.segl.pts.length;for(let t=0;t<l;t++)this.segl.pts[t].x-=r.x,this.segl.pts[t].y-=r.y}F.Debug("= S.SegmentedLine: SegLFormat output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,segl:this.segl})}}GetDimensionPoints(){F.Debug("= S.SegmentedLine: GetDimensionPoints input",{Dimensions:this.Dimensions,Frame:this.Frame,StartPoint:this.StartPoint,EndPoint:this.EndPoint});let t=[];if(this.Dimensions&Se.DimensionFlags.AllSeg)t=this.segl.pts;else if(this.Dimensions&Se.DimensionFlags.Total){let e=Oe.DeepCopy(this.segl.pts);for(let t=0;t<e.length;t++)e[t].x+=this.Frame.x,e[t].y+=this.Frame.y;for(let t=1;t<e.length;t++){const i=Math.abs(e[t-1].x-e[t].x),o=Math.abs(e[t-1].y-e[t].y),n=Math.sqrt(i*i+o*o);F.Debug("= S.SegmentedLine: Segment distance",{index:t,segmentLength:n})}const i=ve.Pt2Rect(this.StartPoint,this.EndPoint),o=(this.Frame.y-i.y)/2,n=(this.Frame.x-i.x)/2,s={x:this.Frame.width/2+n,y:this.Frame.height/2+o},a={x:s.x-10,y:s.y},r={x:s.x+10,y:s.y};t.push(new De(a.x,a.y)),t.push(new De(r.x,r.y))}else{const e=ve.Pt2Rect(this.StartPoint,this.EndPoint);t.push(new De(this.StartPoint.x-e.x,this.StartPoint.y-e.y)),t.push(new De(this.EndPoint.x-e.x,this.EndPoint.y-e.y))}return F.Debug("= S.SegmentedLine: GetDimensionPoints output",t),t}SegLTopToTop(t,e,i,o,n){let s,a,r,l,h,c,p,d,u,g;F.Debug("= S.SegmentedLine: SegLTopToTop input",{actionType:t,targetPoint:e,directionFactor:i,isVertical:o,forcePreserveFormat:n});let y=0,S=!1;const m=me.Common.DimMax;let b={x:0,y:0};if(o){a=Math.abs(this.EndPoint.y-this.StartPoint.y),s=Math.abs(this.EndPoint.x-this.StartPoint.x),r=this.StartPoint.y,l=this.StartPoint.x,h=this.EndPoint.y,c=this.EndPoint.x,p=ve.Pt2Rect(this.StartPoint,this.EndPoint);let t=p.x;p.x=p.y,p.y=t,en.GetMaxDim(b),t=b.x,b.x=b.y,b.y=t}else a=Math.abs(this.EndPoint.x-this.StartPoint.x),s=Math.abs(this.EndPoint.y-this.StartPoint.y),r=this.StartPoint.x,l=this.StartPoint.y,h=this.EndPoint.x,c=this.EndPoint.y,p=ve.Pt2Rect(this.StartPoint,this.EndPoint),en.GetMaxDim(b);if(d=this.segl.pts.length,this.segl.pts.splice(0),this.hooks&&this.hooks.length>0){if(o?-1===i?this.StartPoint.x>this.EndPoint.x:this.StartPoint.x<this.EndPoint.x:-1===i?this.StartPoint.y>this.EndPoint.y:this.StartPoint.y<this.EndPoint.y){for(let t=0;t<this.hooks.length;t++)if(this.hooks[t].hookpt===me.HookPts.KTL){const e=ws.GetObjectPtr(this.hooks[t].objid,!1);if(e){u=e.GetTargetRect(),g=o?this.StartPoint.y+u.height*((m-this.hooks[t].connect.y)/m)+me.Common.SegDefLen:this.StartPoint.x+u.width*((m-this.hooks[t].connect.x)/m)+me.Common.SegDefLen;break}}}else for(let t=0;t<this.hooks.length;t++)if(this.hooks[t].hookpt===me.HookPts.KTR){const e=ws.GetObjectPtr(this.hooks[t].objid,!1);if(e){u=e.GetTargetRect(),g=o?this.EndPoint.y+u.height*((m-this.hooks[t].connect.y)/m)+me.Common.SegDefLen:this.EndPoint.x+u.width*((m-this.hooks[t].connect.x)/m)+me.Common.SegDefLen;break}}u&&(y=o?a<u.height/2+me.Common.SegMinLen?1:0:a<u.width/2+me.Common.SegMinLen?1:0)}if(s<me.Common.SegMinSeg&&(s=0),t===me.ActionTriggerType.SeglPreserve&&(S=4===d),n&&(S=!0),S||!(a>me.Common.SegMinLen||s<me.Common.SegMinLen)||y){6!==d&&this.segl.lengths.splice(0),o?this.segl.pts.push(new De(l-p.y,r-p.x)):this.segl.pts.push(new De(r-p.x,l-p.y)),this.segl.lengths.length<1&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglOne&&(this.segl.lengths[0]=o?i*(l-e.x):i*(l-e.y),this.segl.lengths[0]<me.Common.SegMinLen&&(this.segl.lengths[0]=me.Common.SegMinLen));let n=l-i*this.segl.lengths[0];if(n<0&&(n=0),n>b.y&&(n=b.y),o?this.segl.pts.push(new De(n-p.y,r-p.x)):this.segl.pts.push(new De(r-p.x,n-p.y)),this.segl.lengths.length<2&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglTwo)this.segl.lengths[1]=o?e.y-r:e.x-r,this.segl.lengths[1]<me.Common.SegMinLen&&(this.segl.lengths[1]=me.Common.SegMinLen);else if(y){const t=g-r;this.segl.lengths[1]<t&&(this.segl.lengths[1]=t)}let s=r+this.segl.lengths[1];s<0&&(s=0),s>b.x&&(s=b.x),o?this.segl.pts.push(new De(n-p.y,s-p.x)):this.segl.pts.push(new De(s-p.x,n-p.y)),this.segl.lengths.length<3&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglThree&&(this.segl.lengths[2]=o?i*(c-e.x):i*(c-e.y),this.segl.lengths[2]<me.Common.SegMinLen&&(this.segl.lengths[2]=me.Common.SegMinLen));let a=c-i*this.segl.lengths[2];a<0&&(a=0),a>b.y&&(a=b.y),o?(this.segl.pts.push(new De(a-p.y,s-p.x)),this.segl.pts.push(new De(a-p.y,h-p.x)),this.segl.pts.push(new De(c-p.y,h-p.x))):(this.segl.pts.push(new De(s-p.x,a-p.y)),this.segl.pts.push(new De(h-p.x,a-p.y)),this.segl.pts.push(new De(h-p.x,c-p.y)))}else{4!==d&&this.segl.lengths.splice(0),o?this.segl.pts.push(new De(l-p.y,r-p.x)):this.segl.pts.push(new De(r-p.x,l-p.y)),this.segl.lengths.length<1&&this.segl.lengths.push(me.Common.SegDefLen);let n,s=this.segl.lengths[0];t===me.ActionTriggerType.SeglOne?(o?(this.segl.lengths[0]=i*(l-e.x),n=i*(c-e.x)):(this.segl.lengths[0]=i*(l-e.y),n=i*(c-e.y)),this.segl.lengths[0]<me.Common.SegMinLen&&(this.segl.lengths[0]=me.Common.SegMinLen),n<me.Common.SegMinLen&&(n=me.Common.SegMinLen),n<s&&(s=n)):s>me.Common.SegDefLen&&(s=me.Common.SegDefLen);let a=l-i*this.segl.lengths[0];a<0&&(a=0),a>b.y&&(a=b.y);let u=c-i*s;u<0&&(u=0),u>b.y&&(u=b.y),-1===i?u>a&&(a=u):u<a&&(a=u),o?(this.segl.pts.push(new De(a-p.y,r-p.x)),this.segl.pts.push(new De(a-p.y,h-p.x)),this.segl.pts.push(new De(c-p.y,h-p.x))):(this.segl.pts.push(new De(r-p.x,a-p.y)),this.segl.pts.push(new De(h-p.x,a-p.y)),this.segl.pts.push(new De(h-p.x,c-p.y)))}F.Debug("= S.SegmentedLine: SegLTopToTop output",{pts:this.segl.pts,lengths:this.segl.lengths})}SegLTopToBottom(t,e,i,o){let n,s,a,r,l,h;F.Debug("= S.SegmentedLine: SegLTopToBottom input",{actionType:t,targetPoint:e,directionFactor:i,isVertical:o});let c,p,d={x:0,y:0},u=this.segl.pts.length,g=0;const y=me.Common.DimMax;if(o){Math.abs(this.EndPoint.y-this.StartPoint.y),n=Math.abs(this.EndPoint.x-this.StartPoint.x),s=this.StartPoint.y,a=this.StartPoint.x,r=this.EndPoint.y,l=this.EndPoint.x,h=ve.Pt2Rect(this.StartPoint,this.EndPoint);let t=h.x;h.x=h.y,h.y=t,en.GetMaxDim(d),t=d.x,d.x=d.y,d.y=t}else Math.abs(this.EndPoint.x-this.StartPoint.x),n=Math.abs(this.EndPoint.y-this.StartPoint.y),s=this.StartPoint.x,a=this.StartPoint.y,r=this.EndPoint.x,l=this.EndPoint.y,h=ve.Pt2Rect(this.StartPoint,this.EndPoint),en.GetMaxDim(d);if(c=-1===i?l-2*me.Common.SegMinLen>a:l+2*me.Common.SegMinLen<a,u=this.segl.pts.length,this.segl.pts.splice(0),t===me.ActionTriggerType.SeglPreserve&&(c=6!==u),c)if(Math.abs(s-r)<=1)o?(this.segl.pts.push(new De(a-h.y,s-h.x)),this.segl.pts.push(new De(l-h.y,s-h.x))):(this.segl.pts.push(new De(s-h.x,a-h.y)),this.segl.pts.push(new De(s-h.x,l-h.y))),this.segl.lengths.splice(0);else{4!==u&&this.segl.lengths.splice(0),o?this.segl.pts.push(new De(a-h.y,s-h.x)):this.segl.pts.push(new De(s-h.x,a-h.y)),this.segl.lengths.length<1&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglOne?(this.segl.lengths[0]=o?i*(a-e.x):i*(a-e.y),this.segl.lengths[0]<me.Common.SegMinLen&&(this.segl.lengths[0]=me.Common.SegMinLen)):(t!==me.ActionTriggerType.SeglPreserve&&this.segl.lengths[0]<me.Common.SegDefLen&&(this.segl.lengths[0]=me.Common.SegDefLen),this.segl.lengths[0]>n-me.Common.SegMinLen&&(this.segl.lengths[0]=n-me.Common.SegMinLen)),p=a-i*this.segl.lengths[0],p<0&&(p=0),p>d.y&&(p=d.y);let c=l+i*me.Common.SegMinLen;c<0&&(c=0),c>d.y&&(c=d.y),-1===i?(c<a+me.Common.SegMinLen&&(c=a+me.Common.SegMinLen),c<p&&(p=c)):(c>a-me.Common.SegMinLen&&(c=a-me.Common.SegMinLen),c>p&&(p=c)),o?(this.segl.pts.push(new De(p-h.y,s-h.x)),this.segl.pts.push(new De(p-h.y,r-h.x)),this.segl.pts.push(new De(l-h.y,r-h.x))):(this.segl.pts.push(new De(s-h.x,p-h.y)),this.segl.pts.push(new De(r-h.x,p-h.y)),this.segl.pts.push(new De(r-h.x,l-h.y)))}else{if(this.hooks&&this.hooks.length>0)for(let t=0;t<this.hooks.length;t++)if(this.hooks[t].hookpt===me.HookPts.KTL){const e=ws.GetObjectPtr(this.hooks[t].objid,!1);if(e){const i=e.GetTargetRect();g=o?s<=r?this.StartPoint.y+i.height*((y-this.hooks[t].connect.y)/y)+me.Common.SegDefLen:this.StartPoint.y+i.height*(this.hooks[t].connect.y/y)+me.Common.SegDefLen:s<=r?this.StartPoint.x+i.width*((y-this.hooks[t].connect.x)/y)+me.Common.SegDefLen:this.StartPoint.x+i.width*(this.hooks[t].connect.x/y)+me.Common.SegDefLen;break}}if(6!==u&&this.segl.lengths.splice(0),o?this.segl.pts.push(new De(a-h.y,s-h.x)):this.segl.pts.push(new De(s-h.x,a-h.y)),this.segl.lengths.length<1&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglOne&&(this.segl.lengths[0]=o?i*(a-e.x):i*(a-e.y),this.segl.lengths[0]<me.Common.SegMinLen&&(this.segl.lengths[0]=me.Common.SegMinLen)),p=a-i*this.segl.lengths[0],p<0&&(p=0),p>d.y&&(p=d.y),o?this.segl.pts.push(new De(p-h.y,s-h.x)):this.segl.pts.push(new De(s-h.x,p-h.y)),this.segl.lengths.length<2&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglTwo)this.segl.lengths[1]=s<=r?o?e.y-s:e.x-s:o?-(e.y-s):-(e.x-s);else if(g){const t=g-s;this.segl.lengths[1]<t&&(this.segl.lengths[1]=t)}let n;s<=r?(n=s+this.segl.lengths[1],Math.abs(r-n)<me.Common.SegMinLen&&(n=n<r?r-me.Common.SegMinLen:r+me.Common.SegMinLen)):(n=s-this.segl.lengths[1],Math.abs(n-r)<me.Common.SegMinLen&&(n=n<r?r-me.Common.SegMinLen:r+me.Common.SegMinLen)),n<0&&(n=0),n>d.x&&(n=d.x),o?this.segl.pts.push(new De(p-h.y,n-h.x)):this.segl.pts.push(new De(n-h.x,p-h.y)),this.segl.lengths.length<3&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglThree&&(this.segl.lengths[2]=o?-i*(l-e.x):-i*(l-e.y),this.segl.lengths[2]<me.Common.SegMinLen&&(this.segl.lengths[2]=me.Common.SegMinLen)),p=l+i*this.segl.lengths[2],p<0&&(p=0),p>d.y&&(p=d.y),o?(this.segl.pts.push(new De(p-h.y,n-h.x)),this.segl.pts.push(new De(p-h.y,r-h.x)),this.segl.pts.push(new De(l-h.y,r-h.x))):(this.segl.pts.push(new De(n-h.x,p-h.y)),this.segl.pts.push(new De(r-h.x,p-h.y)),this.segl.pts.push(new De(r-h.x,l-h.y)))}F.Debug("= S.SegmentedLine: SegLTopToBottom output",{pts:this.segl.pts,lengths:this.segl.lengths})}SegLTopToLeft(t,e,i,o,n,s){F.Debug("= S.SegmentedLine: SegLTopToLeft input",{actionType:t,point:e,primaryFactor:i,secondaryFactor:o,isVertical:n,directionFlag:s});let a,r,l,h,c,p,d,u,g,y,S,m,b,D=0,f=0,x=!1,C={},P={x:0,y:0};const T=me.Common.DimMax;if(ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),xs.AllowAutoInsert()&&(x=!0),Math.abs(this.EndPoint.x-this.StartPoint.x),Math.abs(this.EndPoint.y-this.StartPoint.y),n?(y=this.StartPoint.y,S=this.StartPoint.x,m=this.EndPoint.y,b=this.EndPoint.x,C=ve.Pt2Rect(this.StartPoint,this.EndPoint),l=C.x,C.x=C.y,C.y=l,en.GetMaxDim(P),l=P.x,P.x=P.y,P.y=l):(y=this.StartPoint.x,S=this.StartPoint.y,m=this.EndPoint.x,b=this.EndPoint.y,C=ve.Pt2Rect(this.StartPoint,this.EndPoint),en.GetMaxDim(P)),g=this.segl.pts.length,this.segl.pts.splice(0),c=-1==o?y-2*me.Common.SegMinLen>m:y+2*me.Common.SegMinLen<m,h=-1==i?b-2*me.Common.SegMinLen>S&&c:b+2*me.Common.SegMinLen<S&&c,t===me.ActionTriggerType.SeglPreserve&&(h=5!==g),s&&(h=!0),h)this.segl.lengths.splice(0),n?(this.segl.pts.push(new De(S-C.y,y-C.x)),this.segl.pts.push(new De(b-C.y,y-C.x)),this.segl.pts.push(new De(b-C.y,m-C.x))):(this.segl.pts.push(new De(y-C.x,S-C.y)),this.segl.pts.push(new De(y-C.x,b-C.y)),this.segl.pts.push(new De(m-C.x,b-C.y)));else{if(c=y<m,5!=g&&this.segl.lengths.splice(0),this.hooks)if(c){if(-1===o){for(D=n?this.EndPoint.y+me.Common.SegDefLen:this.EndPoint.x+me.Common.SegDefLen,d=0;d<this.hooks.length;d++)if(this.hooks[d].hookpt===me.HookPts.KTR){if(p=ws.GetObjectPtr(this.hooks[d].objid,!1),p){const t=p.GetTargetRect();f=S-(t.y+t.height)<me.Common.SegDefLen+me.Common.SegMinLen?n?this.EndPoint.x-t.width*(this.hooks[d].connect.x/T)-me.Common.SegDefLen:this.EndPoint.y-t.height*(this.hooks[d].connect.y/T)-me.Common.SegDefLen:n?this.EndPoint.x+t.width*((T-this.hooks[d].connect.x)/T)+me.Common.SegDefLen:this.EndPoint.y+t.height*((T-this.hooks[d].connect.y)/T)+me.Common.SegDefLen}break}}else for(d=0;d<this.hooks.length;d++)if(this.hooks[d].hookpt===me.HookPts.KTR){if(p=ws.GetObjectPtr(this.hooks[d].objid,!1),p){const t=p.GetTargetRect();D=n?this.StartPoint.y+t.height/2+me.Common.SegDefLen:this.StartPoint.x+t.width/2+me.Common.SegDefLen}break}}else for(d=0;d<this.hooks.length;d++)if(this.hooks[d].hookpt===me.HookPts.KTR){if(p=ws.GetObjectPtr(this.hooks[d].objid,!1),p){const t=p.GetTargetRect();f=n?this.EndPoint.x-t.width/2-me.Common.SegDefLen:this.EndPoint.y-t.height/2-me.Common.SegDefLen}break}if(x&&(f=0,D=0),n?this.segl.pts.push(new De(S-C.y,y-C.x)):this.segl.pts.push(new De(y-C.x,S-C.y)),this.segl.lengths.length<1&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglOne&&(this.segl.lengths[0]=n?i*(S-e.x):i*(S-e.y),this.segl.lengths[0]<me.Common.SegMinLen&&(this.segl.lengths[0]=me.Common.SegMinLen)),u=i*this.segl.lengths[0],c?f&&(u=S-f,u<me.Common.SegDefLen&&(u=me.Common.SegDefLen),u<this.segl.lengths[0]&&(u=i*this.segl.lengths[0])):f&&(u=S-f,-1===i?-u<me.Common.SegDefLen&&(u=-me.Common.SegDefLen):u<me.Common.SegDefLen&&(u=me.Common.SegDefLen),this.segl.lengths[0]<i*u&&(u=i*this.segl.lengths[0])),this.segl.lengths[0]>i*u&&(u=i*this.segl.lengths[0]),a=S-u,a<0&&(a=0),a>P.y&&(a=P.y),n?this.segl.pts.push(new De(a-C.y,y-C.x)):this.segl.pts.push(new De(y-C.x,a-C.y)),this.segl.lengths.length<2&&this.segl.lengths.push(me.Common.SegDefLen),t===me.ActionTriggerType.SeglTwo&&(c?n?(-1===o?e.y<m+me.Common.SegDefLen&&(e.y=m+me.Common.SegDefLen):e.y>m-me.Common.SegDefLen&&(e.y=m-me.Common.SegDefLen),this.segl.lengths[1]=Math.abs(e.y-y)):(-1===o?e.x<m+me.Common.SegDefLen&&(e.x=m+me.Common.SegDefLen):e.x>m-me.Common.SegDefLen&&(e.x=m-me.Common.SegDefLen),this.segl.lengths[1]=Math.abs(e.x-y)):n?(-1===o?e.y<m-me.Common.SegMinLen&&(e.y=m-me.Common.SegMinLen):e.y>m+me.Common.SegMinLen&&(e.y=m+me.Common.SegMinLen),this.segl.lengths[1]=Math.abs(e.y-y)):(e.x>y-me.Common.SegMinLen&&(e.x=y-me.Common.SegMinLen),this.segl.lengths[1]=Math.abs(e.x-y))),c)u=this.segl.lengths[1],D&&D>this.segl.lengths[1]+y&&(u=D-y),r=y+u,-1==o?r<=m&&(r=y+u):r>=m&&(r=y-u);else{r=y-this.segl.lengths[1];const t=m-o*me.Common.SegDefLen;-1==o&&this.segl.lengths[1]!=me.Common.SegDefLen?t>r&&(r=t):t<r&&(r=t)}r<0&&(r=0),r>P.x&&(r=P.x),n?(this.segl.pts.push(new De(a-C.y,r-C.x)),this.segl.pts.push(new De(b-C.y,r-C.x)),this.segl.pts.push(new De(b-C.y,m-C.x))):(this.segl.pts.push(new De(r-C.x,a-C.y)),this.segl.pts.push(new De(r-C.x,b-C.y)),this.segl.pts.push(new De(m-C.x,b-C.y)))}F.Debug("= S.SegmentedLine: SegLTopToLeft output",{pts:this.segl.pts,lengths:this.segl.lengths})}GetCornerSize(t,e){F.Debug("= S.SegmentedLine: GetCornerSize input",{cornerBaseSize:t,maxCornerSize:e});const i=Math.min(t,e),o=this.segl.curveparam,n=.4*i,s=o>n?n:o;return F.Debug("= S.SegmentedLine: GetCornerSize output",{cornerSize:s}),s}GetPolyPoints(t,e,i,o,n){F.Debug("= S.SegmentedLine: GetPolyPoints input",{maxPointCount:t,shouldTranslatePoints:e,shouldSkipCurves:i,reserved:o,extraOptions:n});let s=[],a=0;if(this.segl&&this.segl.pts.length){const t=this.segl.pts.length;if(this.segl.curveparam>0&&!i)for(let e=0;e<t;e++){let i,o,n,r=0,l=0,h=!1;e>0&&e<t-1?(this.segl.pts[e].x===this.segl.pts[e-1].x?(r=Math.abs(this.segl.pts[e].y-this.segl.pts[e-1].y),h=!0,i=this.segl.pts[e].y-this.segl.pts[e-1].y>0?1:-1):(r=Math.abs(this.segl.pts[e].x-this.segl.pts[e-1].x),i=this.segl.pts[e].x-this.segl.pts[e-1].x>0?1:-1),this.segl.pts[e].x===this.segl.pts[e+1].x?(l=Math.abs(this.segl.pts[e].y-this.segl.pts[e+1].y),o=this.segl.pts[e+1].y-this.segl.pts[e].y>0?1:-1):(l=Math.abs(this.segl.pts[e].x-this.segl.pts[e+1].x),o=this.segl.pts[e+1].x-this.segl.pts[e].x>0?1:-1),a=this.GetCornerSize(r,l),h?(s.push(new De(this.segl.pts[e].x,this.segl.pts[e].y-a*i)),n=ye.opt.LinesAddCurve(!0,i,o,this.segl.pts[e].x,this.segl.pts[e].y,a),s=s.concat(n)):(s.push(new De(this.segl.pts[e].x-a*i,this.segl.pts[e].y)),n=ye.opt.LinesAddCurve(!1,i,o,this.segl.pts[e].x,this.segl.pts[e].y,a),s=s.concat(n))):s.push(new De(this.segl.pts[e].x,this.segl.pts[e].y))}else for(let e=0;e<t;e++)s.push(new De(this.segl.pts[e].x,this.segl.pts[e].y));if(!e){const t=ve.Pt2Rect(this.StartPoint,this.EndPoint);for(let e=0;e<s.length;e++)s[e].x+=t.x,s[e].y+=t.y}}else s=super.GetPolyPoints(t,e,!0,n);return F.Debug("= S.SegmentedLine: GetPolyPoints output",s),s}LMDrawPreTrack(t){F.Debug("= S.SegmentedLine: LMDrawPreTrack input",{svgDoc:t});const e=super.LMDrawPreTrack(t);let i;return F.Debug("= S.SegmentedLine: Base LMDrawPreTrack output",{basePreTrackResult:e}),ye.opt.linkParams&&ye.opt.linkParams.SConnectIndex>=0&&(i=ws.GetObjectPtr(ye.opt.linkParams.SConnectIndex,!1),i&&(this.segl.firstdir=i.GetSegLFace(ye.opt.linkParams.ConnectPt,this.EndPoint,t),F.Debug("= S.SegmentedLine: Updated segl.firstdir",{firstdir:this.segl.firstdir}))),F.Debug("= S.SegmentedLine: LMDrawPreTrack output",{result:!0}),!0}AdjustLine(t,e,i,o){let n,s;F.Debug("= S.SegmentedLine: AdjustLine input",{svgDoc:t,newX:e,newY:i,triggerType:o}),t&&(n=t.GetElementById(me.SVGElementClass.Shape),s=t.GetElementById(me.SVGElementClass.Slop));const a=new De(e,i);this.SegLFormat(a,o,0),this.CalcFrame();const r=ve.Pt2Rect(this.StartPoint,this.EndPoint),l=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);t&&(t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(r.x,r.y),n.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(n,l),s.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(s,l),new Ke,this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(this.Frame,a,ze.CursorTypes.Grow,this),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)),F.Debug("= S.SegmentedLine: AdjustLine output",{Frame:this.Frame,adjustmentPoint:a})}AdjustLineEnd(t,e,i,o){F.Debug("= S.SegmentedLine: AdjustLineEnd input",{svgDocument:t,newEndX:e,newEndY:i,triggerType:o});const n={x:this.EndPoint.x,y:this.EndPoint.y};this.EndPoint.x=e,this.EndPoint.y=i,this.EnforceMinimum(!1),e=this.EndPoint.x,i=this.EndPoint.y,this.EndPoint.x=n.x,this.EndPoint.y=n.y;const s={x:e,y:i};if(ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0){const t=ws.GetObjectPtr(ye.opt.linkParams.ConnectIndex,!1);t&&(this.segl.lastdir=t.GetSegLFace(ye.opt.linkParams.ConnectPt,this.StartPoint,s))}else ye.opt.ob&&ye.opt.ob.BlockID===this.BlockID&&(this.segl.firstdir=ye.opt.ob.segl.firstdir,this.segl.lastdir=ye.opt.ob.segl.lastdir);this.AdjustLine(t,e,i,me.ActionTriggerType.LineEnd),F.Debug("= S.SegmentedLine: AdjustLineEnd output",{EndPoint:this.EndPoint,segl:this.segl})}AdjustLineStart(t,e,i){F.Debug("= S.SegmentedLine: AdjustLineStart input",{svgDocument:t,newStartX:e,newStartY:i});const o={x:this.StartPoint.x,y:this.StartPoint.y},n=me.Common.MinDim;this.StartPoint.x=e,this.StartPoint.y=i,this.EnforceMinimum(!0);const s=this.StartPoint.x,a=this.StartPoint.y;this.StartPoint.x=o.x,this.StartPoint.y=o.y,this.segl.pts[0].x===this.segl.pts[1].x?(this.segl.lengths[0]+=this.StartPoint.y-a,this.segl.lengths[0]<n&&(this.segl.lengths[0]=n)):(this.segl.lengths[0]+=this.StartPoint.x-s,this.segl.lengths[0]<n&&(this.segl.lengths[0]=n));const r={x:s,y:a};if(ye.opt.linkParams&&ye.opt.linkParams.ConnectIndex>=0){const t=ws.GetObjectPtr(ye.opt.linkParams.ConnectIndex,!1);t&&(this.segl.firstdir=t.GetSegLFace(ye.opt.linkParams.ConnectPt,this.EndPoint,r))}else ye.opt.ob&&ye.opt.ob.BlockID===this.BlockID&&(this.segl.firstdir=ye.opt.ob.segl.firstdir,this.segl.lastdir=ye.opt.ob.segl.lastdir);this.AdjustLine(t,s,a,me.ActionTriggerType.LineStart),F.Debug("= S.SegmentedLine: AdjustLineStart output",{originalStartPoint:o,adjustedPoint:r,seglFirstDir:this.segl.firstdir,seglLength0:this.segl.lengths[0]})}GetDimensions(){F.Debug("= S.SegmentedLine: GetDimensions input",{StartPoint:this.StartPoint,EndPoint:this.EndPoint});const t={x:Math.abs(this.EndPoint.x-this.StartPoint.x),y:Math.abs(this.EndPoint.y-this.StartPoint.y)};return F.Debug("= S.SegmentedLine: GetDimensions output",t),t}GetDimensionsForDisplay(){F.Debug("= S.SegmentedLine: GetDimensionsForDisplay input",{Frame:this.Frame});const t={x:this.Frame.x,y:this.Frame.y,width:this.Frame.width,height:this.Frame.height};return F.Debug("= S.SegmentedLine: GetDimensionsForDisplay output",t),t}UpdateDimensions(t,e,i){F.Debug("= S.SegmentedLine: UpdateDimensions input",{offsetElement:t,offsetX:e,offsetY:i});const o=ye.opt.svgObjectLayer.GetElementById(this.BlockID),n=e?this.StartPoint.x+e:this.EndPoint.x,s=i?this.StartPoint.y+i:this.EndPoint.y;F.Debug("= S.SegmentedLine: UpdateDimensions computed",{newEndX:n,newEndY:s}),this.AdjustLineEnd(o,n,s,me.ActionTriggerType.LineEnd),F.Debug("= S.SegmentedLine: UpdateDimensions output",{EndPoint:this.EndPoint})}SetSize(t,e,i){F.Debug("= S.SegmentedLine: SetSize input",{newWidth:t,newHeight:e,forceFlag:i});let o=!1,n=0,s=0;t&&(n=t-this.Frame.width),e&&(s=e-this.Frame.height),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),(this.StartPoint.x<this.EndPoint.x||ve.IsEqual(this.StartPoint.x,this.EndPoint.x)&&this.StartPoint.y<this.EndPoint.y)&&(o=!0);const a=ye.opt.svgObjectLayer.GetElementById(this.BlockID);o?this.AdjustLineEnd(a,this.EndPoint.x+n,this.EndPoint.y+s,0):this.AdjustLineStart(a,this.StartPoint.x+n,this.StartPoint.y+s,0),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),F.Debug("= S.SegmentedLine: SetSize output",{deltaWidth:n,deltaHeight:s,isEndAdjusted:o})}Flip(t){F.Debug("= S.SegmentedLine: Flip input",{flipFlags:t});let e,i,o,n=!1,s=[];const a=Se.SegLDir;if(ye.opt.ob=Oe.DeepCopy(this),t&me.ExtraFlags.FlipVert){switch(n=!0,this.segl.firstdir){case a.Ktc:this.segl.firstdir=a.Kbc;break;case a.Kbc:this.segl.firstdir=a.Ktc}switch(this.segl.lastdir){case a.Ktc:this.segl.lastdir=a.Kbc;break;case a.Kbc:this.segl.lastdir=a.Ktc}e=ve.Pt2Rect(this.StartPoint,this.EndPoint);const t=this.segl.pts.length;for(i=0;i<t;i++)s.push(new De(this.segl.pts[i].x,this.segl.pts[i].y+e.y-this.Frame.y));const r=this.Frame.height;for(i=0;i<t;i++)s[i].y=r-s[i].y;for(this.StartPoint.y=s[0].y+this.Frame.y,this.EndPoint.y=s[t-1].y+this.Frame.y,o=this.EndPoint.y<this.StartPoint.y?this.EndPoint.y-this.Frame.y:this.StartPoint.y-this.Frame.y,i=0;i<t;i++)this.segl.pts[i].y=s[i].y-o;s=[]}if(t&me.ExtraFlags.FlipHoriz){switch(n=!0,this.segl.firstdir){case a.Klc:this.segl.firstdir=a.Krc;break;case a.Krc:this.segl.firstdir=a.Klc}switch(this.segl.lastdir){case a.Klc:this.segl.lastdir=a.Krc;break;case a.Krc:this.segl.lastdir=a.Klc}e=ve.Pt2Rect(this.StartPoint,this.EndPoint);const t=this.segl.pts.length;for(i=0;i<t;i++)s.push(new De(this.segl.pts[i].x+e.x-this.Frame.x,this.segl.pts[i].y));const r=this.Frame.width;for(i=0;i<t;i++)s[i].x=r-s[i].x;for(this.StartPoint.x=s[0].x+this.Frame.x,this.EndPoint.x=s[t-1].x+this.Frame.x,o=this.EndPoint.x<this.StartPoint.x?this.EndPoint.x-this.Frame.x:this.StartPoint.x-this.Frame.x,i=0;i<t;i++)this.segl.pts[i].x=s[i].x-o;s=[]}if(n){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),ye.opt.ob.Frame&&Yo.MaintainLink(this.BlockID,this,ye.opt.ob,me.ActionTriggerType.Rotate),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move)}ye.opt.ob={},F.Debug("= S.SegmentedLine: Flip output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,segl:this.segl})}GetFrameIntersects(t,e,i,o){F.Debug("= S.SegmentedLine: GetFrameIntersects input",{intersectFrame:t,shapeDoc:e,outputPoints:i,resultContext:o});const n=2*me.Common.SegMinLen,s=ve.Pt2Rect(this.StartPoint,this.EndPoint);let a={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height};const r=this.segl.pts.length;for(let l=1;l<r;l++)if(this.segl.pts[l].x===this.segl.pts[l-1].x){let r=this.segl.pts[l].y<this.segl.pts[l-1].y?this.segl.pts[l].y:this.segl.pts[l-1].y,h=this.segl.pts[l].y>this.segl.pts[l-1].y?this.segl.pts[l].y:this.segl.pts[l-1].y;const c=this.segl.pts[l].x;if(r+n<a.y&&h-n>a.y+a.height&&c>a.x&&c<a.x+a.width)return e.AdjustAutoInsertShape(t,!0),o.AutoSeg=l,a={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height},this.segl.pts[l-1].y<this.segl.pts[l].y?(i.push(new De(c+s.x,a.y+s.y)),i[0].index=l,i.push(new De(c+s.x,a.y+a.height+s.y)),i[1].index=l):(i.push(new De(c+s.x,a.y+a.height+s.y)),i.push(new De(c+s.x,a.y+s.y)),i[0].index=l,i[1].index=l),F.Debug("= S.SegmentedLine: GetFrameIntersects output",{outputPoints:i,resultContext:o,hitSegment:l}),!0}else{let r=this.segl.pts[l].x<this.segl.pts[l-1].x?this.segl.pts[l].x:this.segl.pts[l-1].x,h=this.segl.pts[l].x>this.segl.pts[l-1].x?this.segl.pts[l].x:this.segl.pts[l-1].x;const c=this.segl.pts[l].y;if(r+n<a.x&&h-n>a.x+a.width&&c>a.y&&c<a.y+a.height)return e.AdjustAutoInsertShape(t,!1),o.AutoSeg=l,a={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height},this.segl.pts[l-1].x<this.segl.pts[l].x?(i.push(new De(a.x+s.x,c+s.y)),i.push(new De(a.x+a.width+s.x,c+s.y)),i[0].index=l,i[1].index=l):(i.push(new De(a.x+a.width+s.x,c+s.y)),i.push(new De(a.x+s.x,c+s.y)),i[0].index=l,i[1].index=l),F.Debug("= S.SegmentedLine: GetFrameIntersects output",{outputPoints:i,resultContext:o,hitSegment:l}),!0}return F.Debug("= S.SegmentedLine: GetFrameIntersects output",{result:!1}),!1}NoRotate(){F.Debug("= S.SegmentedLine: NoRotate input",{});return F.Debug("= S.SegmentedLine: NoRotate output",true),true}CalcTextPosition(t){F.Debug("= S.SegmentedLine: CalcTextPosition input",{textPositioningParams:t});const e={x:t.Frame.x+t.Frame.width/2-this.Frame.x,y:t.Frame.y+t.Frame.height/2-this.Frame.y};F.Debug("= S.SegmentedLine: Center calculated",{centerPoint:e});const i=this.segl.pts.length;let o,n=1,s=0;const a=[];let r=0;for(let u=1;u<i;u++){const t=this.segl.pts[u-1],i=this.segl.pts[u];if(ve.IsEqual(t.x,i.x)){const l=Math.min(t.y,i.y),h=Math.max(t.y,i.y),c=Math.abs(e.x-t.x);e.y>=l&&e.y<=h&&(void 0===o||c<o)&&(o=c,n=u,s=t.y);const p=Math.abs(t.y-i.y);a.push(p),r+=p,F.Debug("= S.SegmentedLine: Vertical segment",{index:u,segmentLength:p,totalSegmentLength:r})}else{const l=Math.min(t.x,i.x),h=Math.max(t.x,i.x),c=Math.abs(e.y-t.y);e.x>=l&&e.x<=h&&(void 0===o||c<o)&&(o=c,n=u,s=t.x);const p=Math.abs(t.x-i.x);a.push(p),r+=p,F.Debug("= S.SegmentedLine: Horizontal segment",{index:u,segmentLength:p,totalSegmentLength:r})}}F.Debug("= S.SegmentedLine: Chosen segment",{bestSegmentIndex:n,minimumDistance:o,segmentReferenceCoordinate:s,totalSegmentLength:r});const l=this.segl.pts[n-1],h=this.segl.pts[n];let c,p;ve.IsEqual(l.x,h.x)?(c=Math.abs(e.y-s),p=-(e.x-l.x),F.Debug("= S.SegmentedLine: Vertical offset",{offsetAlongSegment:c,offsetAcrossSegment:p})):(c=Math.abs(e.x-s),p=e.y-l.y,F.Debug("= S.SegmentedLine: Horizontal offset",{offsetAlongSegment:c,offsetAcrossSegment:p}));let d=0;for(let u=0;u<n-1;u++)d+=a[u];d+=c,F.Debug("= S.SegmentedLine: Accumulated distance",{accumulatedDistance:d}),this.LineTextX=r?d/r:0,this.LineTextY=p,this.LineTextX&&(this.trect=Oe.DeepCopy(t.trect)),t.TextGrow=Se.TextGrowBehavior.Vertical,this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.HorizText,!0),F.Debug("= S.SegmentedLine: CalcTextPosition output",{LineTextX:this.LineTextX,LineTextY:this.LineTextY,trect:this.trect})}GetTextOnLineParams(t){let e,i,o,n,s;F.Debug("= S.SegmentedLine: GetTextOnLineParams input",{textOptions:t});let a=0,r=.5;const l={Frame:new we.Shape.Rect,StartPoint:new De(0,0),EndPoint:new De(0,0),CenterProp:0},h=this.segl.pts,c=h.length;let p=!1;if(h[0].x<h[c-1].x||h[0].x===h[c-1].x&&h[0].y<h[c-1].y?(e=0,i=c-2):(e=c-2,i=0,p=!0),0!==this.LineTextX){let t=0;for(let i=1;i<c;i++)ve.IsEqual(h[i-1].x,h[i].x)?t+=Math.abs(h[i-1].y-h[i].y):t+=Math.abs(h[i-1].x-h[i].x);const e=this.LineTextX*t;F.Debug("= S.SegmentedLine: Total line length calculated",{totalLineLength:t,targetDistance:e}),a=0,o=c-2;for(let i=1;i<c;i++)if(s=ve.IsEqual(h[i-1].x,h[i].x)?Math.abs(h[i-1].y-h[i].y):Math.abs(h[i-1].x-h[i].x),a+=s,a>e){o=i-1,r=(s-(a-e))/s;break}l.CenterProp=r,l.Frame=Oe.DeepCopy(this.Frame),l.StartPoint.x=l.Frame.x+h[o].x,l.StartPoint.y=l.Frame.y+h[o].y,l.EndPoint.x=l.Frame.x+h[o+1].x,l.EndPoint.y=l.Frame.y+h[o+1].y}else{switch(c){case 2:o=0;break;case 3:ve.IsEqual(h[0].x,h[1].x)?(n=Math.abs(h[0].y-h[1].y),s=Math.abs(h[1].x-h[2].x)):(n=Math.abs(h[0].x-h[1].x),s=Math.abs(h[1].y-h[2].y)),o=n>s?0:1;break;case 5:ve.IsEqual(h[1].x,h[2].x)?(n=Math.abs(h[1].y-h[2].y),s=Math.abs(h[2].x-h[3].x)):(n=Math.abs(h[1].x-h[2].x),s=Math.abs(h[2].y-h[3].y)),o=n>s?1:2;break;default:o=Math.round((c-1.1)/2)}switch(this.TextAlign){case bi.TextAlign.TopLeft:case bi.TextAlign.Left:case bi.TextAlign.BottomLeft:p?(l.EndPoint.x=this.Frame.x+h[e].x,l.EndPoint.y=this.Frame.y+h[e].y,l.StartPoint.x=this.Frame.x+h[e+1].x,l.StartPoint.y=this.Frame.y+h[e+1].y):(l.StartPoint.x=this.Frame.x+h[e].x,l.StartPoint.y=this.Frame.y+h[e].y,l.EndPoint.x=this.Frame.x+h[e+1].x,l.EndPoint.y=this.Frame.y+h[e+1].y);break;case bi.TextAlign.TopRight:case bi.TextAlign.Right:case bi.TextAlign.BottomRight:p?(l.EndPoint.x=this.Frame.x+h[i].x,l.EndPoint.y=this.Frame.y+h[i].y,l.StartPoint.x=this.Frame.x+h[i+1].x,l.StartPoint.y=this.Frame.y+h[i+1].y):(l.StartPoint.x=this.Frame.x+h[i].x,l.StartPoint.y=this.Frame.y+h[i].y,l.EndPoint.x=this.Frame.x+h[i+1].x,l.EndPoint.y=this.Frame.y+h[i+1].y);break;default:p?(l.EndPoint.x=this.Frame.x+h[o].x,l.EndPoint.y=this.Frame.y+h[o].y,l.StartPoint.x=this.Frame.x+h[o+1].x,l.StartPoint.y=this.Frame.y+h[o+1].y):(l.StartPoint.x=this.Frame.x+h[o].x,l.StartPoint.y=this.Frame.y+h[o].y,l.EndPoint.x=this.Frame.x+h[o+1].x,l.EndPoint.y=this.Frame.y+h[o+1].y)}l.Frame=Oe.DeepCopy(this.Frame)}return F.Debug("= S.SegmentedLine: GetTextOnLineParams output",l),l}CreateActionTriggers(t,e,i,o){F.Debug("= S.SegmentedLine: CreateActionTriggers input",{svgDocument:t,objectId:e,optionalParam:i,connectedObjectId:o});const n=t.CreateShape(me.CSType.Group),s=me.Common.KnobSize;let a=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(a*=2);const r=s/a,l=ve.Pt2Rect(this.StartPoint,this.EndPoint);let h=this.Frame.width+r,c=this.Frame.height+r;const p=ws.GetObjectPtr(e,!1),d=Oe.DeepCopy(this.Frame);d.x-=r/2,d.y-=r/2,d.width+=r,d.height+=r;let u={svgDoc:t,shapeType:me.CSType.Rect,knobSize:r,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",cursorType:this.CalcCursorForSegment(this.StartPoint,this.EndPoint,!1),locked:!1};if(e!=o&&(u.fillColor="white",u.strokeSize=1,u.strokeColor="black",u.fillOpacity=0),this.flags&Se.ObjFlags.Lock?(u.fillColor="gray",u.locked=!0):this.NoGrow()&&(u.fillColor="red",u.strokeColor="red",u.cursorType=ze.CursorType.Default),u.x=this.StartPoint.x-this.Frame.x,u.y=this.StartPoint.y-this.Frame.y,u.knobID=me.ActionTriggerType.LineStart,p&&p.hooks)for(let S=0;S<p.hooks.length;S++)if(p.hooks[S].hookpt===me.HookPts.KTL){u.shapeType=me.CSType.Oval;break}let g=this.GenericKnob(u);if(n.AddElement(g),u.shapeType=me.CSType.Rect,p&&p.hooks)for(let S=0;S<p.hooks.length;S++)if(p.hooks[S].hookpt===me.HookPts.KTR){u.shapeType=me.CSType.Oval;break}u.x=this.EndPoint.x-this.Frame.x,u.y=this.EndPoint.y-this.Frame.y,u.knobID=me.ActionTriggerType.LineEnd;let y=this.GenericKnob(u);if(n.AddElement(y),u.shapeType=me.CSType.Rect,this.segl&&this.segl.pts&&this.segl.firstdir>0){const t=this.segl.pts.length;for(let e=2;e<t-1;e++){this.segl.pts[e-1].x===this.segl.pts[e].x?(u.x=this.segl.pts[e].x+l.x-this.Frame.x,u.y=(this.segl.pts[e-1].y+this.segl.pts[e].y)/2+l.y-this.Frame.y):(u.y=this.segl.pts[e].y+l.y-this.Frame.y,u.x=(this.segl.pts[e-1].x+this.segl.pts[e].x)/2+l.x-this.Frame.x),u.cursorType=this.CalcCursorForSegment(this.segl.pts[e],this.segl.pts[e-1],!0),u.knobID=me.ActionTriggerType.SeglOne+e-2,this.NoGrow()&&(u.cursorType=ze.CursorType.Default);let t=this.GenericKnob(u);n.AddElement(t)}}return n.SetSize(h,c),n.SetPos(d.x,d.y),n.isShape=!0,n.SetID(me.Common.Action+e),F.Debug("= S.SegmentedLine: CreateActionTriggers output",{knobGroup:n,adjustedFrame:d,adjustedWidth:h,adjustedHeight:c}),n}ModifyShape(t,e,i,o,n){F.Debug("= S.SegmentedLine: ModifyShape input",{svgDocument:t,newXCoord:e,newYCoord:i,triggerType:o,extraData:n});const s=t.GetElementById(me.SVGElementClass.Shape),a=t.GetElementById(me.SVGElementClass.Slop),r=new De(e,i);this.SegLFormat(r,o,0),this.CalcFrame();const l=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,null),h=ve.Pt2Rect(this.StartPoint,this.EndPoint);t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(h.x,h.y),s.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(s,l),a.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(a,l),this.UpdateDimensionLines(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),F.Debug("= S.SegmentedLine: ModifyShape output",{Frame:this.Frame,polylinePoints:l,boundingRect:h})}OnConnect(t,e,i,o,n){let s,a;F.Debug("= S.SegmentedLine: OnConnect input",{elementId:t,connectedObject:e,hookPoint:i,connectionCoordinate:o,extraData:n});let r=0;const l=ye.opt.svgObjectLayer.GetElementById(t);switch(i){case me.HookPts.KTL:this.segl.firstdir=e.GetSegLFace(ye.opt.linkParams.ConnectPt,this.EndPoint,o),r=me.ActionTriggerType.LineEnd,s=this.EndPoint.x,a=this.EndPoint.y;break;case me.HookPts.KTR:this.segl.lastdir=e.GetSegLFace(ye.opt.linkParams.ConnectPt,this.StartPoint,o),r=me.ActionTriggerType.LineStart,s=this.StartPoint.x,a=this.StartPoint.y;break;default:F.Debug("= S.SegmentedLine: OnConnect unknown hookPoint",{hookPoint:i})}r&&(F.Debug("= S.SegmentedLine: OnConnect calling AdjustLine",{svgDocument:l,adjustXCoord:s,adjustYCoord:a,actionTrigger:r}),this.AdjustLine(l,s,a,r)),F.Debug("= S.SegmentedLine: OnConnect output")}OnDisconnect(t,e,i,o){F.Debug("= S.SegmentedLine: OnDisconnect input",{elementId:t,unusedParam:e,hookType:i,extraData:o});let n=0,s=0,a=0;const r=ye.opt.svgObjectLayer.GetElementById(t);switch(ye.opt.ob&&ye.opt.ob.BlockID===this.BlockID&&(this.segl.firstdir=ye.opt.ob.segl.firstdir,this.segl.lastdir=ye.opt.ob.segl.lastdir),i){case me.HookPts.KTL:a=me.ActionTriggerType.LineEnd,n=this.EndPoint.x,s=this.EndPoint.y,this.segl.firstdir=0,ye.opt.ob&&ye.opt.ob.segl&&(ye.opt.ob.segl.firstdir=0);break;case me.HookPts.KTR:a=me.ActionTriggerType.LineStart,n=this.StartPoint.x,s=this.StartPoint.y,this.segl.lastdir=0,ye.opt.ob&&ye.opt.ob.segl&&(ye.opt.ob.segl.lastdir=0)}a&&(F.Debug("= S.SegmentedLine: OnDisconnect - calling AdjustLine",{svgDocument:r,adjustXCoord:n,adjustYCoord:s,actionTrigger:a}),this.AdjustLine(r,n,s,a)),F.Debug("= S.SegmentedLine: OnDisconnect output",{updatedStartPoint:this.StartPoint,updatedEndPoint:this.EndPoint,actionTrigger:a})}LinkGrow(t,e,i){switch(F.Debug("= S.SegmentedLine: LinkGrow input",{elementId:t,hookType:e,newPosition:i}),e){case me.HookPts.KTL:ve.IsEqual(i.x,this.StartPoint.x)&&ve.IsEqual(i.y,this.StartPoint.y)||this.SegLFormat(i,me.ActionTriggerType.LineStart,0);break;case me.HookPts.KTR:ve.IsEqual(i.x,this.EndPoint.x)&&ve.IsEqual(i.y,this.EndPoint.y)||this.SegLFormat(i,me.ActionTriggerType.LineEnd,0)}this.CalcFrame(!0),Ps.SetLinkFlag(t,Ee.LinkFlags.Move),ws.AddToDirtyList(t),F.Debug("= S.SegmentedLine: LinkGrow output",{StartPoint:this.StartPoint,EndPoint:this.EndPoint})}HookToPoint(t,e){F.Debug("= S.SegmentedLine: HookToPoint input",{hookId:t,outRect:e});const i=me.HookPts;let o={x:0,y:0},n={x:0,y:0},s={};switch(t){case i.KTL:o.x=this.StartPoint.x,o.y=this.StartPoint.y,e&&(n.x=this.StartPoint.x+this.segl.pts[1].x,n.y=this.StartPoint.y+this.segl.pts[1].y,s=ve.Pt2Rect(this.StartPoint,n),e.x=s.x,e.y=s.y,e.width=s.width,e.height=s.height);break;case i.KTR:default:o.x=this.EndPoint.x,o.y=this.EndPoint.y;const t=this.segl.pts.length;e&&(n.x=this.StartPoint.x+this.segl.pts[t-2].x,n.y=this.StartPoint.y+this.segl.pts[t-2].y,s=ve.Pt2Rect(this.EndPoint,n),e.x=s.x,e.y=s.y,e.width=s.width,e.height=s.height)}return F.Debug("= S.SegmentedLine: HookToPoint output",{resultPoint:o,segmentRect:s}),o}GetTargetPoints(t,e,i){F.Debug("= S.SegmentedLine: GetTargetPoints input",{hookData:t,targetFlags:e,connectedObjectId:i});const o=me.HookPts,n=me.Common.DimMax;let s=[{x:0,y:0,id:o.SED_KTL},{x:n,y:n,id:o.SED_KTR}];if(null!=i&&i>=0&&ws.GetObjectPtr(i,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape){let e=t.id;switch(t.id>=o.CustomBase&&(e=o.CustomBase),e){case o.CustomBase:case o.KTC:case o.KBC:case o.KRC:case o.KLC:{let t=this.Frame.width;t<=0&&(t=1);let e=this.Frame.height;if(e<=0&&(e=1),s[0].x=(this.StartPoint.x-this.Frame.x)/t*n,s[0].y=(this.StartPoint.y-this.Frame.y)/e*n,s[1].x=(this.EndPoint.x-this.Frame.x)/t*n,s[1].y=(this.EndPoint.y-this.Frame.y)/e*n,0===this.hooks.length)return F.Debug("= S.SegmentedLine: GetTargetPoints output",s),s;if(1!==this.hooks.length)return F.Debug("= S.SegmentedLine: GetTargetPoints output",[]),[];if(this.hooks[0].hookpt===o.KTR)return s[1].skip=!0,F.Debug("= S.SegmentedLine: GetTargetPoints output",s),s;if(this.hooks[0].hookpt===o.KTL)return s[0].skip=!0,s[0].x=s[1].x,s[0].y=s[1].y,F.Debug("= S.SegmentedLine: GetTargetPoints output",s),s;break}}}const a=this.BaseShapePolyGetTargets(t,e,this.Frame);return F.Debug("= S.SegmentedLine: GetTargetPoints output",a),a}BaseShapePolyGetTargets(t,e,i){F.Debug("= S.SegmentedLine: BaseShapePolyGetTargets input",{inputPoint:t,hookFlags:e,boundingRect:i});const o=this.PolyGetTargetPointList(e);if(null==t)return F.Debug("= S.SegmentedLine: BaseShapePolyGetTargets output",{targets:null}),null;const n=[{x:0,y:0}],s=[];let a=me.Common.LongIntMax;const r={x:0,y:0};t.x,t.y;const l={x:t.x,y:t.y};let h=!1,c={},p=-1,d={x:t.x,y:t.y};ye.docUtil.docConfig.enableSnap&&0==(e&Se.HookFlags.LcNoSnaps)&&(d=ye.docUtil.SnapToGrid(d),d.y<i.y&&(d.y=i.y),d.y>i.y+i.height&&(d.y=i.y+i.height),d.x<i.x&&(d.x=i.x),d.x>i.x+i.width&&(d.x=i.x+i.width),h=!0);const u=o.length;for(let g=1;g<u;g++){l.x=t.x,l.y=t.y;const e=o[g-1],i=o[g];if(ve.EqualPt(e,i))continue;const n=i.x-e.x,s=i.y-e.y,u=0===n?1:n,y=0===s?1:s;if(Math.abs(y/u)>1){h&&(l.y=d.y);const t=u/y*(l.y-e.y)+e.x;let o=Math.abs(t-l.x);l.x=t;const n=Math.min(e.x,i.x),s=Math.max(e.x,i.x);t<n||t>s?o=me.Common.LongIntMax:(c=ve.Pt2Rect(e,i),ve.InflateRect(c,1,1),ve.pointInRect(c,l)||(o=me.Common.LongIntMax)),o<a&&(p=g,r.x=t,r.y=l.y,a=o)}else{h&&(l.x=d.x);const t=y/u*(l.x-e.x)+e.y;let o=Math.abs(t-l.y);l.y=t;const n=Math.min(e.y,i.y),s=Math.max(e.y,i.y);t<n||t>s?o=me.Common.LongIntMax:(c=ve.Pt2Rect(e,i),ve.InflateRect(c,1,1),ve.pointInRect(c,l)||(o=me.Common.LongIntMax)),o<a&&(p=g,r.x=l.x,r.y=t,a=o)}}if(p>=0){n[0].x=r.x,n[0].y=r.y;const t=i;if(0!==this.RotationAngle){const e=this.RotationAngle/(180/Se.Geometry.PI);si.RotatePointsAboutCenter(t,e,n)}const e=t.width,o=t.height,a=0===e?0:(n[0].x-t.x)/e,l=0===o?0:(n[0].y-t.y)/o;return s.push(new De(a*me.Common.DimMax,l*me.Common.DimMax)),F.Debug("= S.SegmentedLine: BaseShapePolyGetTargets output",{targets:s}),s}return F.Debug("= S.SegmentedLine: BaseShapePolyGetTargets output",{targets:null}),null}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.SegmentedLine: GetPerimPts input",{unusedInputParam:t,hookPointDefinitions:e,currentHookType:i,unusedParamR:o,unusedParamI:n,connectedObjectId:s});let a=this.Frame,r=[],l=0,h=0;if(e){if(h=e.length,2===h&&e[0].id&&e[0].id===me.HookPts.KTL&&e[1].id&&e[1].id===me.HookPts.KTR)return null==e[0].skip&&(r.push(new De(this.StartPoint.x,this.StartPoint.y)),r[0].id=e[0].id,l=1),null==e[1].skip&&(r.push(new De(this.EndPoint.x,this.EndPoint.y)),r[l].id=e[1].id),F.Debug("= S.SegmentedLine: GetPerimPts output",r),r;if(s>=0){const a=ws.GetObjectPtr(s,!1);if(a){if(a.objecttype===Se.FNObjectTypes.Multiplicity&&1===h){let t=5,o=5;if(t+=a.Frame.width/2,0===e[0].x){const i=this.segl.pts[0],n=this.segl.pts[1];i.x===n.x?(a.subtype===Se.ObjectSubTypes.SubtMultiplicityFilpped&&(t=-t),o=i.y>n.y?-o:o+a.Frame.height,r.push(new De(this.StartPoint.x+t,this.StartPoint.y+o)),r[0].id=e[0].id):(a.subtype===Se.ObjectSubTypes.SubtMultiplicityFilpped&&(o=-a.Frame.height-5),o=-o,i.x>n.x&&(t=-t),r.push(new De(this.StartPoint.x+t,this.StartPoint.y+o)),r[0].id=e[0].id)}else{const n=this.segl.pts.length,s=this.segl.pts[n-2],l=this.segl.pts[n-1];s.x===l.x?(a.subtype===Se.ObjectSubTypes.SubtMultiplicityFilpped&&(t=-t),o=s.y<l.y?-o:o+a.Frame.height,i===me.HookPts.KCBR&&(t=-t),r.push(new De(this.EndPoint.x+t,this.EndPoint.y+o)),r[0].id=e[0].id):(a.subtype===Se.ObjectSubTypes.SubtMultiplicityFilpped&&(o=-a.Frame.height-5),o=-o,s.x<l.x&&(t=-t),r.push(new De(this.EndPoint.x+t,this.EndPoint.y+o)),r[0].id=e[0].id)}return F.Debug("= S.SegmentedLine: GetPerimPts output",r),r}if(a.objecttype===Se.FNObjectTypes.ExtraTextLable&&1===h){const a=super.GetPerimPts(t,e,i,o,n,s);return F.Debug("= S.SegmentedLine: GetPerimPts output",a),a}}}}h=e?e.length:0,r=new Array(h);for(let c=0;c<h;c++){r[c]={x:0,y:0,id:0};const t=a.width,i=a.height;r[c].x=e[c].x/me.Common.DimMax*t+a.x,r[c].y=e[c].y/me.Common.DimMax*i+a.y,null!=e[c].id&&(r[c].id=e[c].id)}return F.Debug("= S.SegmentedLine: GetPerimPts output",r),r}ScaleObject(t,e,i,o,n,s,a){F.Debug("= S.SegmentedLine: ScaleObject input",{scaleX:t,scaleY:e,deltaX:i,deltaY:o,pivotX:n,pivotY:s,preserveAspectRatio:a}),super.ScaleObject(t,e,i,o,n,s,a),this.SegLFormat(this.EndPoint,me.ActionTriggerType.SeglPreserve,0),this.CalcFrame(),F.Debug("= S.SegmentedLine: ScaleObject output",{EndPoint:this.EndPoint,Frame:this.Frame})}GetSegLFace(t,e,i){F.Debug("= S.SegmentedLine: GetSegLFace input",{hookPoint:t,referencePoint:e,testPoint:i});const o=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,null);let n=0,s=null;const a={x:i.x,y:i.y},r={};return si.LineDStyleHit(o,a,this.StyleRecord.Line.Thickness,0,r)&&r.lpHit>=0&&(s=ve.Pt2Rect(o[r.lpHit],o[r.lpHit+1]),n=s.width>=s.height?e.y>=i.y?me.HookPts.KBC:me.HookPts.KTC:e.x>=i.x?me.HookPts.KRC:me.HookPts.KLC),F.Debug("= S.SegmentedLine: GetSegLFace output",{hookDirection:n}),n}GetSpacing(){F.Debug("= S.SegmentedLine: GetSpacing input",{hooks:this.hooks,segl:this.segl,StartPoint:this.StartPoint,EndPoint:this.EndPoint});const t=me.HookPts;let e,i,o={width:null,height:null};switch(2===this.hooks.length&&(e=ws.GetObjectPtr(this.hooks[0].objid,!1),i=ws.GetObjectPtr(this.hooks[1].objid,!1)),this.segl.firstdir){case t.KTC:this.segl.lastdir===t.KBC&&(o.height=Math.abs(this.StartPoint.y-this.EndPoint.y),e&&i&&(e.Frame.y<i.Frame.y?o.height=i.Frame.y-(e.Frame.y+e.Frame.height):o.height=e.Frame.y-(i.Frame.y+i.Frame.height)));break;case t.KBC:this.segl.lastdir===t.KTC&&(o.height=Math.abs(this.StartPoint.y-this.EndPoint.y),e&&i&&(e.Frame.y<i.Frame.y?o.height=i.Frame.y-(e.Frame.y+e.Frame.height):o.height=e.Frame.y-(i.Frame.y+i.Frame.height)));break;case t.KLC:this.segl.lastdir===t.KRC&&(o.width=Math.abs(this.StartPoint.x-this.EndPoint.x),e&&i&&(e.Frame.x<i.Frame.x?o.width=i.Frame.x-(e.Frame.x+e.Frame.width):o.width=e.Frame.x-(i.Frame.x+i.Frame.width)));break;case t.KRC:this.segl.lastdir===t.KLC&&(o.width=Math.abs(this.StartPoint.x-this.EndPoint.x),e&&i&&(e.Frame.x<i.Frame.x?o.width=i.Frame.x-(e.Frame.x+e.Frame.width):o.width=e.Frame.x-(i.Frame.x+i.Frame.width)))}return F.Debug("= S.SegmentedLine: GetSpacing output",o),o}GetShapeConnectPoint(t){let e,i;F.Debug("= S.SegmentedLine: GetShapeConnectPoint input",{hookType:t});let o={},n={},s=this.segl.lastdir,a=this.segl.firstdir;const r=me.Common.DimMax,l=this.segl.pts.length;let h;return t===me.HookPts.KTL?(e=this.segl.pts[0],i=this.segl.pts[1]):(e=this.segl.pts[l-2],i=this.segl.pts[l-1]),e.x===i.x?(o.x=r/2,n.x=r/2,i.y>e.y?(o.y=0,n.y=r,s=me.HookPts.KTC,a=me.HookPts.KBC):(o.y=r,n.y=0,s=me.HookPts.KBC,a=me.HookPts.KTC)):(o.y=r/2,n.y=r/2,i.x>e.x?(o.x=0,n.x=r,s=me.HookPts.KLC,a=me.HookPts.KRC):(o.x=r,n.x=0,s=me.HookPts.KRC,a=me.HookPts.KLC)),t===me.HookPts.KTL?(this.segl.firstdir=a,h=n):(this.segl.lastdir=s,h=o),F.Debug("= S.SegmentedLine: GetShapeConnectPoint output",h),h}ConnectToHook(t,e){F.Debug("= S.SegmentedLine: ConnectToHook input",{connectedObjectId:t,hookType:e});let i=e;return Vo.LineIsReversed(this,null,!1)&&(i===me.HookPts.KTL?i=me.HookPts.KTR:i===me.HookPts.KTR&&(i=me.HookPts.KTL)),F.Debug("= S.SegmentedLine: ConnectToHook output",{result:i}),i}GetBestHook(t,e,i){F.Debug("= S.SegmentedLine: GetBestHook input",{objectId:t,initialHookType:e,referencePoint:i});const o=me.Common.DimMax;ve.Pt2Rect(this.StartPoint,this.EndPoint);const n=me.HookPts,s=this.segl.pts.length;let a,r,l=i.x;2===s&&this.segl.pts[0].x===this.segl.pts[1].x&&(l=i.y),Vo.LineIsReversed(this,null,!1)?0===l?(a=this.segl.pts[s-2],r=this.segl.pts[s-1]):(r=this.segl.pts[0],a=this.segl.pts[1]):l===o?(a=this.segl.pts[s-2],r=this.segl.pts[s-1]):(r=this.segl.pts[0],a=this.segl.pts[1]);const h=ws.GetObjectPtr(t,!1);let c=e;if(h&&h.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)switch(e){case n.KTC:case n.KBC:case n.KRC:case n.KLC:c=a.x===r.x?a.y<r.y?n.KBC:n.KTC:a.x<r.x?n.KRC:n.KLC;break;default:c=e}return F.Debug("= S.SegmentedLine: GetBestHook output",{bestHookType:c}),c}MaintainPoint(t,e,i,o,n){F.Debug("= S.SegmentedLine: MaintainPoint input",{point:t,targetObjectId:e,additionalParams:i,objectToCheck:o,extraParams:n});let s=o,a={},r={},l={};switch(s.DrawingObjectBaseClass){case me.DrawObjectBaseClass.Line:switch(s.LineType){case me.LineType.SEGLINE:case me.LineType.ARCSEGLINE:case me.LineType.POLYLINE:let t=!1;for(let i=0;i<s.hooks.length;i++)if(s.hooks[i].targetid===e){s.HookToPoint(s.hooks[i].hookpt,a),t=!0;break}if(!t)return F.Debug("= S.SegmentedLine: MaintainPoint - no matching hook found, returning true"),F.Debug("= S.SegmentedLine: MaintainPoint output",!0),!0;l=Oe.DeepCopy(s),ve.CopyRect(l.Frame,a),l.StartPoint.x=a.x,l.StartPoint.y=a.y,l.EndPoint.x=a.x+a.width,l.EndPoint.y=a.y+a.height,s=l}break;case me.DrawObjectBaseClass.Shape:return en.LinesMaintainDist(this,i,n,t),F.Debug("= S.SegmentedLine: MaintainPoint processed for SHAPE, returning true"),F.Debug("= S.SegmentedLine: MaintainPoint output",!0),!0}const h=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,null),c=h.length;for(let p=1;p<c;p++){if(r=ve.Pt2Rect(h[p],h[p-1]),l=Oe.DeepCopy(this),ve.CopyRect(l.Frame,r),l.StartPoint.x=r.x,l.StartPoint.y=r.y,l.EndPoint.x=r.x+r.width,l.EndPoint.y=r.y+r.height,ye.opt.LineCheckPoint(l,t))return F.Debug("= S.SegmentedLine: MaintainPoint - LineCheckPoint returned true",{segment:p,lineSegmentRectangle:r}),F.Debug("= S.SegmentedLine: MaintainPoint output",!0),!0;if(ye.opt.LinesIntersect(l,s,t))return F.Debug("= S.SegmentedLine: MaintainPoint - LinesIntersect returned true",{segment:p,lineSegmentRectangle:r}),F.Debug("= S.SegmentedLine: MaintainPoint output",!0),!0}return en.LinesMaintainDist(this,i,n,t),F.Debug("= S.SegmentedLine: MaintainPoint output",true),true}}class xa{constructor(t,e,i,o,n,s){a(this,"x"),a(this,"y"),a(this,"moveto"),a(this,"arrowhead"),a(this,"curvex"),a(this,"curvey"),this.x=t||0,this.y=e||0,this.moveto=i||!1,this.arrowhead=o||!1,this.curvex=n||0,this.curvey=s||0}}class Ca{constructor(t,e,i,o){a(this,"h"),a(this,"v"),a(this,"hend"),a(this,"vend"),this.h=t||0,this.v=e||0,this.hend=i||0,this.vend=o||0}}var Pa=Object.defineProperty,Ta=Object.getOwnPropertyDescriptor;class Oa{constructor(){a(this,"startpoint"),a(this,"endpoint"),a(this,"id"),a(this,"textid"),a(this,"tuniqueid"),a(this,"gap"),a(this,"ogap"),a(this,"extra"),a(this,"comanagerht"),a(this,"isasst"),a(this,"pr"),a(this,"sequence"),a(this,"steps"),this.startpoint={h:0,v:0},this.endpoint={h:0,v:0},this.id=-1,this.textid=-1,this.tuniqueid=-1,this.gap=me.ConnectorDefines.DefaultWd,this.ogap=0,this.extra=0,this.comanagerht=0,this.isasst=!1,this.pr=new fi(0,0,0,0),this.sequence=0,this.steps=[]}}((t,e,i,o)=>{for(var n,s=o>1?void 0:o?Ta(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);o&&s&&Pa(e,i,s)})([jt((()=>fi))],Oa.prototype,"pr",2);var va=Object.defineProperty,wa=Object.getOwnPropertyDescriptor,ka=(t,e,i,o)=>{for(var n,s=o>1?void 0:o?wa(e,i):e,a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o?n(e,i,s):n(s))||s);return o&&s&&va(e,i,s),s};class La{constructor(){a(this,"styleflags"),a(this,"tilt"),a(this,"angle"),a(this,"ht"),a(this,"wd"),a(this,"flags"),a(this,"matchsizelen"),a(this,"lasttexthook"),a(this,"curveparam"),a(this,"profile"),a(this,"coprofile"),a(this,"steps"),a(this,"hook"),this.styleflags=0,this.tilt=0,this.angle=0,this.ht=0,this.wd=0,this.flags=0,this.matchsizelen=0,this.lasttexthook=-1,this.curveparam=0,this.profile=new fi(0,0,0,0),this.coprofile=new fi(0,0,0,0),this.steps=[],this.hook=[]}}ka([jt((()=>fi))],La.prototype,"profile",2),ka([jt((()=>fi))],La.prototype,"coprofile",2);class Aa extends Ns{constructor(t){t=t||{},F.Debug("S.D3Symbol: Input options:",t),t.ShapeType=me.ShapeType.D3Symbol,t.objecttype=Se.FNObjectTypes.D3Symbol,t.TextFlags=t.TextFlags||Se.TextFlags.AttachB,super(),this.SetD3Settings(t.d3Settings),F.Debug("S.D3Symbol: Output options after initialization:",t)}CreateShape(t,e){if(F.Debug("S.D3Symbol: Enter CreateShape with parameters:",{svgDocument:t,applyHiddenEventBehavior:e}),this.flags&Se.ObjFlags.NotVisible)return F.Debug("S.D3Symbol: Object not visible, exiting CreateShape."),null;const i=t.CreateShape(me.CSType.ShapeContainer),o=this.Frame;this.TextFlags=Se.TextFlags.AttachB,i.SetSize(o.width,o.height),i.SetPos(o.x,o.y),i.isShape=!0;const n=t.CreateShape(me.CSType.Group);n.SetSize(o.width,o.height),n.SetID(me.SVGElementClass.Shape);const s=t.CreateShape(me.CSType.Rect);s.SetStrokeColor("white"),s.SetFillColor("none"),s.SetOpacity(0),s.SetStrokeWidth(0),e?s.SetEventBehavior(me.EventBehavior.HiddenAll):s.SetEventBehavior(me.EventBehavior.None),s.SetID(me.SVGElementClass.Slop),s.ExcludeFromExport(!0),s.SetSize(o.width,o.height),i.AddElement(s),i.AddElement(n),this.RenderControl(t,i),-1!==this.DataID&&this.LMAddSVGTextObject(t,i);const a=(this.extraflags&me.ExtraFlags.FlipHoriz)>0,r=(this.extraflags&me.ExtraFlags.FlipVert)>0;return a&&n.SetMirror(a),r&&n.SetFlip(r),ye.opt.bDrawEffects&&this.SetEffects(n,!1,!1),F.Debug("S.D3Symbol: Exit CreateShape with shapeContainer:",i),i}MapData(t){F.Debug("S.D3Symbol: MapData - Input:",t);const e=this.GetPublicParams();if(!t||0===e.length||!this.HasFieldData())return void F.Debug("S.D3Symbol: MapData - No mapping performed (missing data, public params or field data).");const i=TODO.STData.FieldedDataGetFieldList(this.fieldDataTableID,!0),o=[];e.forEach((e=>{const n=t[e];if(n&&n.dataMap){const t=(t=>{const e=(t||"").split(":"),i={name:e[0].toLowerCase(),start:0,flags:null};for(let o=1;o<e.length;o++){const t=e[o];isNaN(parseInt(t,10))?i.flags=t.toLowerCase():i.start=parseInt(t,10)}return i})(n.dataMap),e=((t,e,o,n)=>{if(!t||!o)return null;o=o.toLowerCase();let s=null;for(let l=e=e||0;l<i.length;l++){const e=i[l];if(a=e.type,("string"===(r=o)&&"string"===a||"number"===a&&("int"===r||"float"===r)||"*"===t||"?"===t||a===r)&&("*"===t||"?"===t||e.name.toLowerCase()===t)){if(!n){s=l;break}if(null===s&&(s=[]),s.push(l),"?"===t)break}}var a,r;return s})(t.name,t.start,n.type,n.isArray);if(null!==e){let s=null,a=[];this.fieldDataElemID<0?"all"===t.flags?(a=o,s=[]):a=[o[0]]:a=[this.fieldDataElemID],a.forEach((o=>{let a=null;if(n.isArray)a=[],e.forEach((e=>{const n=i[e],s="label"===t.flags?n.name:TODO.STData.FieldedDataGetFieldValue(this.fieldDataTableID,o,n.fieldID);void 0!==s&&a.push(s)}));else{const n=i[e],s="label"===t.flags?n.name:TODO.STData.FieldedDataGetFieldValue(this.fieldDataTableID,o,n.fieldID);void 0!==s&&(a=s)}null!==a&&(s?Array.isArray(s)?s.push(a):s=[s,a]:s=a)})),null!==s&&(n.value=s)}}})),F.Debug("S.D3Symbol: MapData - Output (mapped data updated in object).")}SetParamValue(t,e){F.Debug("S.D3Symbol: SetParamValue - Input:",{paramName:t,paramValue:e});const i=this.d3Settings?this.d3Settings.renderSettings:null;i&&i[t]&&(ws.GetObjectPtr(this.BlockID,!0),i[t].value=e,i[t].dataMap=null,this.UpdateSizeFromSettings(),ws.AddToDirtyList(this.BlockID)),F.Debug("S.D3Symbol: SetParamValue - Updated renderSettings:",i)}UpdateSizeFromSettings(){}GetRenderParams(){F.Debug("S.D3Symbol: GetRenderParams - Start");const t=this.Frame,e=this.d3Settings?this.d3Settings.renderSettings:null;if(e){const i=Oe.DeepCopy(e);i.width=i.width||{},i.height=i.height||{},i.width.value=t.width,i.height.value=t.height;return(t=>{const i=this.GetFieldDataStyleOverride(),o=i&&i.strokeColor?i.strokeColor:null,n=i&&i.fillColor?i.fillColor:null,s=i&&i.textColor?i.textColor:null;let a=this.StyleRecord.Fill.Paint.Color,r=this.StyleRecord.Line.Paint.Color,l=this.StyleRecord.Text.Paint.Color;this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent?a="none":this.StyleRecord.Fill.Paint.FillType!==Se.FillTypes.Solid&&this.StyleRecord.Fill.Paint.FillType!==Se.FillTypes.Gradient&&(a=null),this.StyleRecord.Line.Paint.FillType===Se.FillTypes.Transparent?r="none":this.StyleRecord.Line.Paint.FillType!==Se.FillTypes.Solid&&this.StyleRecord.Line.Paint.FillType!==Se.FillTypes.Gradient&&(r=null);const h=n||a,c=o||r,p=this.StyleRecord.Line.Thickness,d=s||l;h&&t.fillColor&&(t.fillColor.value=h),c&&t.strokeColor&&(t.strokeColor.value=c),t.strokeWidth&&(t.strokeWidth.value=p),d&&t.textColor&&(t.textColor.value=d),a&&e.fillColor&&(e.fillColor.value=a),r&&e.strokeColor&&(e.strokeColor.value=r),e.strokeWidth&&(e.strokeWidth.value=p),l&&e.textColor&&(e.textColor.value=l)})(i),this.MapData(i),F.Debug("S.D3Symbol: GetRenderParams - Output:",i),i}return F.Debug("S.D3Symbol: GetRenderParams - No renderSettings found."),null}SetDataMap(t,e){F.Debug("S.D3Symbol: SetDataMap - Input:",{paramName:t,dataMap:e});const i=this.d3Settings?this.d3Settings.renderSettings:null;i&&i[t]&&(ws.GetObjectPtr(this.BlockID,!0),i[t].dataMap=e,this.UpdateSizeFromSettings(),ws.AddToDirtyList(this.BlockID)),F.Debug("S.D3Symbol: SetDataMap - Updated renderSettings:",i)}GetPublicParams(){F.Debug("S.D3Symbol: GetPublicParams - Start");const t=this.d3Settings?this.d3Settings.publicAttributes:null,e=[];return t?(t.forEach((t=>{we.Shape.D3Symbol.DefaultStyleParams.indexOf(t)<0&&e.push(t)})),F.Debug("S.D3Symbol: GetPublicParams - Output:",e),e):(F.Debug("S.D3Symbol: GetPublicParams - No public attributes found."),e)}ExportD3Settings(){F.Debug("S.D3Symbol: ExportD3Settings - Start");let t="";return this.d3Settings&&(t=JSON.stringify(this.d3Settings)),F.Debug("S.D3Symbol: ExportD3Settings - Output:",t),t}ImportD3Settings(t){F.Debug("S.D3Symbol: ImportD3Settings - Input:",t);let e=null;try{e=JSON.parse(t)}catch(i){throw Uo.Error("= s.D3Symbol: ImportD3Settings - Error parsing settings:",i),i}e&&this.SetD3Settings(e),F.Debug("S.D3Symbol: ImportD3Settings - Output settings applied.")}SetD3Settings(t){}Resize(t,e,i){}ChangeTextAttributes(t,e,i,o,n,s,a,r){F.Debug("S.D3Symbol: ChangeTextAttributes - Input:",{newText:t,newFont:e,newSize:i,newColor:o,newAlignment:n,newWeight:s,newStyle:a,newDecoration:r}),on.GetActiveTextEdit()===this.BlockID?e=null:t=null,we.Shape.BaseDrawObject.prototype.ChangeTextAttributes.call(this,t,e,i,o,n,s,a,r),ws.AddToDirtyList(this.BlockID),F.Debug("S.D3Symbol: ChangeTextAttributes - Completed")}CreateActionTriggers(t,e,i,o){F.Debug("S.D3Symbol: CreateActionTriggers - Input parameters:",{event:t,triggerType:e,action:i,response:o});const n=we.Shape.BaseShape.prototype.CreateActionTriggers.apply(this,[t,e,i,o]);return F.Debug("S.D3Symbol: CreateActionTriggers - Output result:",n),n}RefreshFromFieldData(t){return F.Debug("S.D3Symbol: RefreshFromFieldData - Input:",t),t&&this.fieldDataTableID!==t?(F.Debug("S.D3Symbol: RefreshFromFieldData - Output: false"),!1):(we.Shape.BaseDrawObject.prototype.RefreshFromFieldData.call(this,t),this.UpdateSizeFromSettings(),ws.AddToDirtyList(this.BlockID),F.Debug("S.D3Symbol: RefreshFromFieldData - Output: true"),!0)}static DefaultD3Settings(t){F.Debug("S.D3Symbol: Input settings:",t);let e={moduleID:null,renderSettings:{},publicAttributes:[]};return t&&(e=$.extend(!0,e,t)),F.Debug("S.D3Symbol: Output settings:",e),e}}a(Aa,"DefaultStyleParams",["fillColor","strokeColor","strokeWidth","textColor"]);class Ia{constructor(){a(this,"id"),a(this,"pt"),a(this,"extra"),this.id=-1,this.pt={x:0,y:0},this.extra=0}}class Ea extends Qn{constructor(t){F.Debug("= S.ShapeContainer constructor - Input:",t),(t=t||{}).ShapeType=me.ShapeType.Rect,super(t),a(this,"ContainerList"),a(this,"zListIndex"),this.dataclass=t.dataclass||tn.ShapeTypes.RECTANGLE,this.ContainerList=t.ContainerList||new we.Shape.ContainerList,this.objecttype=Se.FNObjectTypes.ShapeContainer,this.nativeDataArrayBuffer=t.nativeDataArrayBuffer||null,this.SymbolData=t.SymbolData||null,F.Debug("= S.ShapeContainer constructor - Output:",{ShapeType:t.ShapeType,dataclass:this.dataclass,ContainerList:this.ContainerList,objecttype:this.objecttype,nativeDataArrayBuffer:this.nativeDataArrayBuffer,SymbolData:this.SymbolData})}IsShapeContainer(t,e){F.Debug("= S.ShapeContainer IsShapeContainer - Input:",{shapeToCheck:t,hookPoint:e});const i=Se.ContainerListFlags;if(null==t)return F.Debug("= S.ShapeContainer IsShapeContainer - Output:",!1),!1;if(t.ParentFrameID>=0&&ws.GetObjectPtr(t.ParentFrameID,!1))return F.Debug("= S.ShapeContainer IsShapeContainer - Output:",!1),!1;if(t.flags&Se.ObjFlags.TextOnly)return F.Debug("= S.ShapeContainer IsShapeContainer - Output:",!1),!1;if(t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape){const o=this.ContainerList,n=o.flags&i.Sparse;let s;return e&&(n||o.Arrangement!==Se.ContainerListArrangements.Row?e.id=me.HookPts.KCT:(e.x-=t.Frame.width/2,e.y+=t.Frame.height/2,e.id=me.HookPts.KCL)),s=o.flags&i.AllowOnlyContainers?t instanceof Ea:!(o.flags&i.AllowOnlyNonContainers)||!(t instanceof Ea),F.Debug("= S.ShapeContainer IsShapeContainer - Output:",s),s}return F.Debug("= S.ShapeContainer IsShapeContainer - Output:",!1),!1}CreateConnectHilites(t,e,i,o,n,s){F.Debug("= S.ShapeContainer CreateConnectHilites - Input:",{connectEvent:t,targetObject:e,highlightOptions:i,sourceShape:o,connectionType:n,additionalContext:s});const a={active:!0,eventDetails:t,targetDetails:e,optionsPassed:i,additionalData:{param1:o,param2:n,param3:s}};return F.Debug("= S.ShapeContainer CreateConnectHilites - Output:",a),a}GetBestHook(t,e,i){F.Debug("= S.ShapeContainer GetBestHook - Input:",{connectionEvent:t,proposedHook:e,contextData:i});const o=e;return F.Debug("= S.ShapeContainer GetBestHook - Output:",o),o}GetTargetPoints(t,e,i){F.Debug("= S.ShapeContainer GetTargetPoints - Input:",{options:t,filterCriteria:e,renderContext:i});const o=[],n=this.ContainerList,s=n.List,a=s.length,r=me.Common.DimMax;let l={x:r/2,y:0};const h=n.flags&Se.ContainerListFlags.Sparse,c=this.PrGetContainerFrame().frame.width;let p=n.ndown,d=n.nacross;if(h){for(let t=0;t<=p;t++)for(let e=-1;e<=d;e++)l=new De(e,t),o.push(l);return F.Debug("= S.ShapeContainer GetTargetPoints - Output:",o),o}if(n.Arrangement===Se.ContainerListArrangements.Column){a>0&&(l.x=s[0].pt.x/c*r),o.push(l);for(let t=0;t<a;t++){const e=s[t].pt.x/c*r,i=new De(e,t+1);o.push(i)}}else{l.x=n.HorizontalSpacing,l.y=0,a>0&&(l.x=0),o.push(l);for(let t=0;t<a;t++){const e=s[t].pt.y/c*r,i=new De(e,t+1);o.push(i)}}return F.Debug("= S.ShapeContainer GetTargetPoints - Output:",o),o}PrGetContainerFrame(){F.Debug("= S.ShapeContainer PrGetContainerFrame - Input:",{trect:this.trect});const t={frame:Oe.DeepCopy(this.trect),StartY:0};return F.Debug("= S.ShapeContainer PrGetContainerFrame - Output:",t),t}GetHitTestFrame(t){F.Debug("= S.ShapeContainer GetHitTestFrame - Input:",{target:t});const e={},i=this.ContainerList,o=i.flags&Se.ContainerListFlags.Sparse;return ve.CopyRect(e,this.r),t&&t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape&&(o?(e.width+=i.HorizontalSpacing+i.childwidth,e.x-=i.HorizontalSpacing+i.childwidth/2):e.width+=i.HorizontalSpacing+t.Frame.width/2,e.height+=2*i.VerticalSpacing),F.Debug("= S.ShapeContainer GetHitTestFrame - Output:",e),e}AllowDoubleClick(){F.Debug("= S.ShapeContainer AllowDoubleClick - Input:",{});const t=!!(this.ContainerList.flags&Se.ContainerListFlags.Sparse);return F.Debug("= S.ShapeContainer AllowDoubleClick - Output:",t),t}DoubleClick(t,e){F.Debug("= S.ShapeContainer DoubleClick - Input:",{event:t,target:e});const i=this.ContainerList,o=i.List,n=o.length;let s,a,r=0,l=0,h=null;const c=t=>{let e=0;for(let n=0;n<i.ndown;n++){const s=n*i.nacross+t;let a;if(o[s].id>=0){const t=ws.GetObjectPtr(o[s].id,!1);if(!t)continue;a=t.Frame.width}else a=i.childwidth;a>e&&(e=a)}return e+2*i.HorizontalSpacing};if(i.flags&Se.ContainerListFlags.Sparse){if(e)r=e.Data.row,l=e.Data.col,s=!0,a=Oe.DeepCopy(e.Data.theNewPoint);else{if(s=!1,a=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),a=Oe.DeepCopy(a),a.x-=this.Frame.x,a.y-=this.Frame.y,(this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachB)&&(a.y<10||a.y>this.Frame.height-10)){const e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);return F.Debug("= S.ShapeContainer DoubleClick - Output: activating text edit."),void on.ActivateTextEdit(e.svgObj.SDGObj,t)}const e=this.GetTargetPoints(),n=this.GetPerimPts(null,e,null,!0,null,1);let h=Number.MAX_VALUE,p=-1;for(let t=0;t<n.length;t++){const e=n[t].x-a.x,i=n[t].y-a.y,o=e*e+i*i;o<h&&(h=o,p=t)}if(p>=0)l=e[p].x,r=e[p].y,s=!0;else{let t=!1;for(let n=1;n<i.ndown;n++){const e=n*i.nacross;if(o[e].pt.y>a.y){r=n-1,t=!0;break}}t||(r=i.ndown-1);let e=!1;for(let n=1;n<i.nacross;n++)if(o[n].pt.x>a.x){e=!0;const t=c(n-1),i=o[n-1].pt.x+t/2;l=a.x<i?n-1:n;break}e||(l=i.nacross-1),s=o[i.nacross*r+l].id<0}}if(s){let t;if(e)t=e.Data.closest;else{t=((t,e)=>{let s=-1;if(i.Arrangement===Se.ContainerListArrangements.Column){if(e<=i.nacross&&(e=i.nacross-1)<0)return-1;for(let n=0;n<i.ndown;n++){const a=n*i.nacross+e;if(a<o.length&&o[a].id>=0){if(!(n<t))return s<0?o[a].id:s;s=o[a].id}}}else for(let n=0;n<i.nacross;n++){if(t<=i.ndown&&(t=i.ndown-1)<0)return-1;const a=t*i.nacross+n;if(a<o.length&&o[a].id>=0){if(!(n<e))return s<0?o[a].id:s;s=o[a].id}}if(s<0)for(let i=0;i<n;i++)if(o[i].id>=0)return o[i].id;return s})(r,l)}if(t<0){h=e?e.Data.SymbolID:"currentSymbolId";const t=ye.baseOpt.AddSymbol(h),o=ws.GetObjectPtr(t,!0),n=i.childwidth,s=i.childheight,r={x:a.x,y:a.y,width:n,height:s};o.UpdateFrame(r),o.sizedim.width=n,o.sizedim.height=s,ws.AddToDirtyList(t)}else{const e=ye.baseOpt.DuplicateShape(t,!0,!1);ws.AddToDirtyList(e)}const s={x:l,y:r},c=me.HookPts.KCT,p=[];Yo.UpdateHook(t<0?h:t,-1,this.BlockID,c,s,null),p.push(t<0?h:t),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),xs.CompleteOperation(p)}}F.Debug("= S.ShapeContainer DoubleClick - Output:",{event:t,target:e})}NoRotate(){F.Debug("= S.ShapeContainer NoRotate - Input:",{});return F.Debug("= S.ShapeContainer NoRotate - Output:",true),true}FieldDataAllowed(){F.Debug("= S.ShapeContainer FieldDataAllowed - Input:",{thisContext:this});return F.Debug("= S.ShapeContainer FieldDataAllowed - Output:",true),true}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.ShapeContainer GetPerimPts - Input:",{hookPoint:t,targetPoints:e,hookType:i,considerLayout:o,additionalContext:n,pointIndex:s});const a=[],r=this.ContainerList,l=r.List,h=l.length,c=me.Common.DimMax,p=Se.ContainerListArrangements,d=!!(r.flags&Se.ContainerListFlags.Sparse);1===e.length&&this.flags&Se.ObjFlags.Obj1&&this.PrFormat();const u=this.PrGetContainerFrame(),g=u.frame;if(r.VerticalSpacing,u.StartY,1===e.length&&s<0){let t,o;i===me.HookPts.KCTL?(t=g.x,o=g.y):i===me.HookPts.KCL?(t=g.x,o=g.y+g.height/2):(t=g.x+g.width/2,o=g.y);const n=new De(t,o);return null!=e[0].id&&(n.id=e[0].id),a.push(n),F.Debug("= S.ShapeContainer GetPerimPts - Output (single point):",a),a}if(d&&s>=0){for(let t=0;t<e.length;t++){let i,o=0,n=0;e[t].y<r.ndown?e[t].x<0?(i=e[t].y*r.nacross,n=l[i].pt.y,o=-r.childwidth/2):e[t].x<r.nacross?(i=e[t].y*r.nacross+e[t].x,n=l[i].pt.y,o=l[i].pt.x):(i=e[t].y*r.nacross+r.nacross-1,n=l[i].pt.y,o=r.width+(e[t].x-r.nacross)*r.childwidth+r.childwidth/2,o>g.width-r.HorizontalSpacing/2&&(o=g.width-r.HorizontalSpacing/2)):(n=r.height+(e[t].y-r.ndown)*r.childheight+r.VerticalSpacing,n>g.height-r.VerticalSpacing/2&&(n=g.height-r.VerticalSpacing/2),e[t].x<0?(i=e[t].y*r.nacross,o=-r.childwidth/2):e[t].x<r.nacross?(i=e[t].y>=r.ndown?(r.ndown-1)*r.nacross+e[t].x:(e[t].y-1)*r.nacross+e[t].x,o=l[i].pt.x):(o=r.width+(e[t].x-r.nacross)*r.childwidth+r.childwidth/2,o>g.width-r.HorizontalSpacing/2&&(o=g.width-r.HorizontalSpacing/2)));const s=new De(o+g.x,n+g.y);a.push(s)}return F.Debug("= S.ShapeContainer GetPerimPts - Output (sparse):",a),a}for(let y=0;y<e.length;y++){let t=e[y].y,o=0,n=0;if(r.Arrangement===p.Column?o=e[y].x/c*g.width:n=e[y].x/c*g.height,t<h)n=l[t].pt.y,o=l[t].pt.x;else if(0===h)r.Arrangement===p.Column?n=r.VerticalSpacing:(o=r.HorizontalSpacing,n=this.Frame.height/2);else{t=h-1;const e=ws.GetObjectPtr(l[t].id,!1);if(r.Arrangement===p.Row){if(o=r.width,n=l[t].pt.y,e){const i=l[t].pt.x+e.Frame.width+r.HorizontalSpacing;o=i>r.width?r.width:i}}else{if(n=r.height,e){n=l[t].pt.y+e.Frame.height+r.VerticalSpacing}o=l[t].pt.x}}i===me.HookPts.KAT&&(n=0);const s=new De(o+g.x,n+g.y);null!=e[y].id&&(s.id=e[y].id),e.length>1&&(r.Arrangement===p.Column?s.y-=r.VerticalSpacing/2:s.x-=r.HorizontalSpacing/2),a.push(s)}return F.Debug("= S.ShapeContainer GetPerimPts - Output:",a),a}PrFormat(t){F.Debug("= S.ShapeContainer PrFormat - Input:",{skipSizeUpdate:t});const e=this.ContainerList,i=e.List,o=i.length;let n=0;e.VerticalSpacing;const s=Se.ContainerListArrangements,a=this;let r=0;const l=Boolean(e.flags&Se.ContainerListFlags.Sparse),h=Boolean(e.flags&Se.ContainerListFlags.LeftChanged),c=Boolean(e.flags&Se.ContainerListFlags.TopChanged);e.flags=ve.SetFlag(e.flags,Se.ContainerListFlags.LeftChanged,!1),e.flags=ve.SetFlag(e.flags,Se.ContainerListFlags.TopChanged,!1);const p=function(t,n,s){let l=t,h=e.VerticalSpacing+r,c=e.Wrap,p=0,d=0;for(;l<o;l++){h+=i[l].extra,i[l].pt={x:n,y:h};const t=ws.GetObjectPtr(i[l].id,!1);if(t&&(t.Frame.y!==h&&Ps.SetLinkFlag(t.BlockID,Ee.LinkFlags.Move),t.Frame.width>d&&(d=t.Frame.width),h+=t.Frame.height+e.VerticalSpacing,p++),c>0&&p>=c)break}d+=2*e.HorizontalSpacing,d<e.MinWidth&&(d=e.MinWidth);let u=d;s&&u<s.width&&(u=s.width);let g=!1;for(let e=t;e<l;e++){i[e].pt.x+=u/2;const t=ws.GetObjectPtr(i[e].id,!1);t&&t.Frame.x+t.Frame.width/2!==a.Frame.x+i[e].pt.x&&(Ps.SetLinkFlag(t.BlockID,Ee.LinkFlags.Move),g=!0)}return g&&Ps.SetLinkFlag(a.BlockID,Ee.LinkFlags.Move),{start:l,colwidth:u,top:h}},d=function(t,n,s,r){let l=t,h=e.HorizontalSpacing,c=e.Wrap,p=0,d=0,u=s;for(;l<o;l++){h+=i[l].extra,i[l].pt={x:h,y:u};const t=ws.GetObjectPtr(i[l].id,!1);let o,n;if(t?(t.Frame.y/2!==u&&Ps.SetLinkFlag(t.BlockID,Ee.LinkFlags.Move),o=t.Frame.width,n=t.Frame.height):(o=e.childwidth,n=e.childheight),n>d&&(d=n),h+=o+e.HorizontalSpacing,p++,c>0&&p>=c)break}d+=2*e.VerticalSpacing,d<e.MinHeight&&(d=e.MinHeight);let g=d;r&&g<r.height&&(g=r.height);let y=!1;for(let e=t;e<l;e++){i[e].pt.y+=g/2;const t=ws.GetObjectPtr(i[e].id,!1);t&&t.Frame.y+t.Frame.height/2!==n.y+i[e].pt.y&&(Ps.SetLinkFlag(t.BlockID,Ee.LinkFlags.Move),y=!0)}return y&&Ps.SetLinkFlag(a.BlockID,Ee.LinkFlags.Move),{start:l,rowht:g,left:h}},u=this.PrGetContainerFrame(),g=u.frame;r=u.StartY;let y,S=0,m=e.VerticalSpacing+r,b=0,D=m;if(l){const t=function(t){let i=t,o=[],n=[];for(let s=0;s<e.ndown;s++)for(let t=0;t<e.nacross;t++){const i=s*e.nacross+t,a=e.List[i];null==a.id&&(a.id=-1);const r=ws.GetObjectPtr(a.id,!1),l=r?r.Frame.width:e.childwidth,h=r?r.Frame.height:e.childheight;(null==o[t]||o[t]<l)&&(o[t]=l),(null==n[s]||n[s]<h)&&(n[s]=h)}for(let s=0;s<e.ndown;s++){let t=e.HorizontalSpacing;for(let n=0;n<e.nacross;n++){const a=s*e.nacross+n,r=e.List[a];r.pt.x=t+o[n]/2,r.pt.y=i,t+=o[n]+e.HorizontalSpacing}i+=n[s]+e.VerticalSpacing}return{left:0,top:i}}(m);b=t.left,D=t.top}else switch(e.Arrangement){case s.Column:for(;S<o;)y=p(S,n,null),S=y.start,b+=y.colwidth,n+=y.colwidth,S<o&&(b-=e.HorizontalSpacing,n-=e.HorizontalSpacing),y.top>D&&(D=y.top);break;case s.Row:for(;S<o;)m-=e.VerticalSpacing,y=d(S,g,m,null),S=y.start,D+=y.rowht,m+=y.rowht,y.left>b&&(b=y.left)}if(!t){e.width=b,D+=r,e.height=D,b<e.MinWidth&&(b=e.MinWidth),D<e.MinHeight&&(D=e.MinHeight);let t=b-g.width,i=D-g.height;ve.IsEqual(i,0,1)&&(i=0),ve.IsEqual(t,0,1)&&(t=0);let o=0,n=0;if(t||i){t&&(g.width=b,o=h?-t:t),i&&(g.height=D,n=c?-i:i),this.TRectToFrame(g,!0),ws.AddToDirtyList(this.BlockID);const e=this.hooks.length?ws.GetObjectPtr(this.hooks[0].objid,!1):null;e&&e instanceof Ea&&(e.flags=ve.SetFlag(e.flags,Se.ObjFlags.Obj1,!0),Ps.SetLinkFlag(e.BlockID,Ee.LinkFlags.Move)),(o||n)&&this.OffsetShape(o,n)}this.flags=ve.SetFlag(this.flags,Se.ObjFlags.Obj1,!1)}F.Debug("= S.ShapeContainer PrFormat - Output:",{ContainerList:e})}OnConnect(t,e,i,o,n){if(F.Debug("= S.ShapeContainer OnConnect - Input:",{connectionId:t,targetObject:e,connectionAnchor:i,connectionReference:o,additionalInfo:n}),e instanceof Ea&&(null==this.zListIndex||this.zListIndex<0)){const e=ye.opt.svgObjectLayer.GetElementById(t);e&&(this.zListIndex=ye.opt.svgObjectLayer.GetElementIndex(e),ye.opt.svgObjectLayer.MoveElementToFront(e))}F.Debug("= S.ShapeContainer OnConnect - Output:",{zListIndex:this.zListIndex})}PrGetShapeConnectorInfo(t){F.Debug("= S.ShapeContainer PrGetShapeConnectorInfo - Input:",{eventData:t});const e=this.ContainerList,i=e.flags&Se.ContainerListFlags.Sparse,o=e.flags&Se.ContainerListFlags.Adjust,n=[],s=me.ActionTriggerType;if(i||!o)return F.Debug("= S.ShapeContainer PrGetShapeConnectorInfo - Output:",null),null;const a=e.Arrangement===Se.ContainerListArrangements.Row?{knobID:s.ContainerAdj,cursorType:ze.CursorType.ResizeR,knobData:0,hook:t.hookpt,polyType:"horizontal"}:{knobID:s.ContainerAdj,cursorType:ze.CursorType.ResizeB,knobData:0,hook:t.hookpt,polyType:"vertical"};return n.push(a),F.Debug("= S.ShapeContainer PrGetShapeConnectorInfo - Output:",n),n}GetListOfEnclosedObjects(t){F.Debug("= S.ShapeContainer GetListOfEnclosedObjects - Input:",t);const e=[];return F.Debug("= S.ShapeContainer GetListOfEnclosedObjects - Output:",e),e}ChangeTarget(t,e,i,o,n,s){F.Debug("= S.ShapeContainer ChangeTarget - Input:",{changeEvent:t,targetShapeId:e,connectionAnchor:i,boundingRect:o,gridPosition:n,shouldAttach:s});const a=(t,e)=>{const i=h.List,o=i.length,n=new Ia;if(n.id=t,e>=o)i.push(n);else{const t=i[e].extra;i[e].extra=0,n.extra=t,i.splice(e,0,n)}},r=t=>{const e=h.List,i=e.length;let o=-1;for(let n=0;n<i;n++)if(e[n].id===t){o=n;break}o>=0&&e.splice(o,1)},l=(t,e)=>{const i=h,o=i.List;let n=0,s=0;const a=[],r=[];for(let h=0;h<i.ndown;h++)for(let e=0;e<i.nacross;e++){const n=o[i.nacross*h+e];n.id===t&&(n.id=-1),n.id>=0&&(a[e]=!0,r[h]=!0)}let l=-1;for(let h=0;h<i.nacross;h++)!0===a[h]&&l<0&&(l=h);let c=-1;for(let h=i.nacross-1;h>=0;h--)!0===a[h]&&c<0&&(c=h);let p=-1;null==r[0]&&e&&0===e.y&&(r[0]=!0);for(let h=0;h<i.ndown;h++)!0===r[h]&&p<0&&(p=h);let d=-1;for(let h=i.ndown-1;h>=0;h--)!0===r[h]&&d<0&&(d=h);for(let h=i.ndown-1;h>d;h--)i.ndown>1&&(o.splice(h*i.nacross,i.nacross),i.ndown--);for(let h=p-1;h>=0;h--)i.ndown>1&&(o.splice(h*i.nacross,i.nacross),i.ndown--,s--);for(let h=i.nacross-1;h>c;h--)if(i.nacross>1){for(let t=i.ndown-1;t>=0;t--)o.splice(i.nacross*t+h,1);i.nacross--}for(let h=l-1;h>=0;h--)if(i.nacross>1){for(let t=i.ndown-1;t>=0;t--)o.splice(i.nacross*t+h,1);i.nacross--,n--}return{dx:n,dy:s}},h=this.ContainerList;let c=h.List;const p=this,d=h.flags&Se.ContainerListFlags.Sparse;let u=-1;for(let g=0,y=c.length;g<y;g++)if(c[g].id===e){u=g;break}if(null!=e){const t=ws.GetObjectPtr(e,!1);let i;if(t.OnDisconnect(e,this),d){let o;if(s){u>=0&&(o=l(e,n),n.x+=o.dx,n.y+=o.dy),((t,e)=>{const i=h,o=i.List;const n=Se.ContainerListArrangements,s=(t,e)=>{if(e<0||t<0)return{dx:0,dy:0};if(i.Arrangement===n.Column){let n=-1;for(let s=t+1;s<i.ndown;s++){const t=s*i.nacross+e;o[t].id<0&&n<0&&(n=s)}if(n<0){for(let t=0;t<i.nacross;t++){const t=new Ia;o.push(t)}i.ndown++,n=i.ndown-1}for(let s=n;s>t;s--){const t=(s-1)*i.nacross+e,n=s*i.nacross+e;o[n].id=o[t].id}o[t*i.nacross+e].id=-1}else if(i.Arrangement===n.Row){let n=-1;for(let s=e+1;s<i.nacross;s++){const e=t*i.nacross+s;o[e].id<0&&n<0&&(n=s)}if(n<0){for(let t=i.ndown;t>0;t--){const e=t*i.nacross;for(let t=0;t<i.nacross;t++){const t=new Ia;o.splice(e,0,t)}}i.nacross++,n=i.nacross-1}for(let s=n;s>e;s--){const e=t*i.nacross+(s-1),n=t*i.nacross+s;o[n].id=o[e].id}o[t*i.nacross+e].id=-1}return{dx:0,dy:0}};if(!(t>=h.nacross||e>=h.ndown&&t>=0)){if(e<0||t<0)return s(t,e);const i=h.nacross*e+t;o[i].id>=0&&s(t,e)}})(n.x,n.y),n.y<0&&(n.y=0),n.x<0&&(n.x=0);((t,e,i)=>{const o=h,n=o.List;if(i>=o.ndown)for(let s=o.ndown;s<=i;s++){for(let t=0;t<o.nacross;t++){const t=new Ia;n.push(t)}o.ndown=i+1}if(e>=o.nacross){const t=o.nacross;for(let i=o.ndown-1;i>=0;i--){const o=t*(i+1);for(let i=t;i<=e;i++){const t=new Ia;n.splice(o,0,t)}}o.nacross=e+1}n[i*o.nacross+e].id=t})(e,n.x,n.y),ye.opt.PutInFrontofObject(p.BlockID,e),t.moreflags=ve.SetFlag(t.moreflags,me.ObjMoreFlags.ContainerChild,!0)}else l(e,null),t.moreflags=ve.SetFlag(t.moreflags,me.ObjMoreFlags.ContainerChild,!1),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move);if(s&&(u>=0?(i=n.y,i>u?(a(e,n.y),r(e)):i<u?(r(e),a(e,i)):(a(e,n.y),ye.opt.PutInFrontofObject(p.BlockID,e),t.moreflags=ve.SetFlag(t.moreflags,me.ObjMoreFlags.ContainerChild,!0))):(r(e),t.moreflags=ve.SetFlag(t.moreflags,me.ObjMoreFlags.ContainerChild,!1),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move))),d){(()=>{const t=h,e=t.List;for(let i=0;i<t.ndown;i++)for(let o=0;o<t.nacross;o++){const n=i*t.nacross+o,s=ws.GetObjectPtr(e[n].id,!1);if(s&&s.hooks.length){const t=s.hooks[0].connect;if(t.x!==o||t.y!==i){const t=ws.GetObjectPtr(e[n].id,!0);t.hooks[0].connect.x=o,t.hooks[0].connect.y=i}}}})()}else{(()=>{const t=h.List;for(let e=0,i=t.length;e<i;e++){const i=ws.GetObjectPtr(t[e].id,!0);i&&i.hooks.length&&(i.hooks[0].connect.y=e)}})()}this.PrFormat()}else this.flags=ve.SetFlag(this.flags,Se.ObjFlags.Obj1,!0);F.Debug("= S.ShapeContainer ChangeTarget - Output:",{containerList:this.ContainerList,targetShapeId:e,gridPosition:n})}}}const Fa={ArcLine:class extends es{constructor(t={}){F.Debug("= S.ArcLine constructor input:",t),t.LineType=me.LineType.ARCLINE,super(t),a(this,"CurveAdjust"),a(this,"IsReversed"),a(this,"FromPolygon"),a(this,"FixedPoint"),a(this,"LineOrientation"),a(this,"hoplist"),a(this,"ArrowheadData"),a(this,"StartArrowID"),a(this,"EndArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),a(this,"TextDirection"),a(this,"OriginalCurveAdjust"),a(this,"OriginalIsReversed"),a(this,"OriginalLineSide"),a(this,"OriginalCenterPointDistance"),this.StartPoint=t.StartPoint||{x:0,y:0},this.EndPoint=t.EndPoint||{x:0,y:0},this.CurveAdjust=t.CurveAdjust,this.IsReversed=t.IsReversed||!1,this.FromPolygon=t.FromPolygon||!1,this.CalcFrame(),this.FixedPoint=t.FixedPoint||[0,0],this.LineOrientation=t.LineOrientation||me.LineOrientation.None,this.hoplist=t.hoplist||{nhops:0,hops:[]},this.ArrowheadData=t.ArrowheadData||[],this.StartArrowID=t.StartArrowID||0,this.EndArrowID=t.EndArrowID||0,this.StartArrowDisp=t.StartArrowDisp||!1,this.EndArrowDisp=t.EndArrowDisp||!1,this.ArrowSizeIndex=t.ArrowSizeIndex||0,this.TextDirection=t.TextDirection||!1,F.Debug("= S.ArcLine constructor output:",this)}CalcRadiusAndCenter(t,e,i,o,n,s){F.Debug("= S.ArcLine CalcRadiusAndCenter input:",{startX:t,startY:e,endX:i,endY:o,curveAdjust:n,isReversed:s});const a={centerX:0,centerY:0,actionX:0,actionY:0,radius:0,valid:!1,centerInside:!1},r=t+(i-t)/2,l=e+(o-e)/2,h=i-t,c=o-e;let p=Math.sqrt(h*h+c*c);if(0===p)return F.Debug("= S.ArcLine CalcRadiusAndCenter output:",a),a.valid=!1,a;const d=-c/p,u=h/p,g=p/2,y=n;let S,m,b,D,f,x,C,P,T=Math.abs((g*g+y*y)/(2*y));if(T<y)a.centerInside=!0,S=ve.Sqrt(T*T-g*g),s?(D=r+S*d,f=l+S*u,x=D+T*d,C=f+T*u):(D=r-S*d,f=l-S*u,x=D-T*d,C=f-T*u);else{let t=T;t=s?t+y:t-y,m=d*t,b=u*t,D=r+m,f=l+b,x=D-T*d,C=f-T*u,s&&(P=T-y,D=r+d*P,f=l+u*P)}return a.radius=T,a.centerX=D,a.centerY=f,a.actionX=x,a.actionY=C,a.valid=!0,F.Debug("= S.ArcLine CalcRadiusAndCenter output:",a),a}GetLineChangeFrame(){F.Debug("= S.ArcLine GetLineChangeFrame input:",{StartPoint:this.StartPoint,EndPoint:this.EndPoint});let t=ve.Pt2Rect(this.StartPoint,this.EndPoint);return t.width<me.Common.SegDefLen&&(t.width=me.Common.SegDefLen),t.height<me.Common.SegDefLen&&(t.height=me.Common.SegDefLen),F.Debug("= S.ArcLine GetLineChangeFrame output:",t),t}CreateArcShapeForHops(t,e){if(F.Debug("= S.ArcLine CreateArcShapeForHops input:",{svgDoc:t,isTouch:e}),this.flags&Se.ObjFlags.NotVisible)return F.Debug("= S.ArcLine CreateArcShapeForHops output:",null),null;const i=t.CreateShape(me.CSType.ShapeContainer),o=t.CreateShape(me.CSType.Polyline);o.SetID(me.SVGElementClass.Shape);const n=t.CreateShape(me.CSType.Polyline);n.SetID(me.SVGElementClass.Slop),n.ExcludeFromExport(!0),this.CalcFrame();const s=ve.Pt2Rect(this.StartPoint,this.EndPoint),a=this.StyleRecord,r=this.SVGTokenizerHook(a),l=r.Line.Paint.Color,h=r.Line.Thickness,c=r.Line.Paint.Opacity,p=r.Line.LinePattern;i.SetSize(s.width,s.height),i.SetPos(s.x,s.y);let d=this.GetPolyPoints(me.Common.MaxPolyPoints,!0);const u=ye.opt.InsertHops(this,d,d.length);return d=d.slice(0,u.npts),o.SetPoints(d),o.SetFillColor("none"),o.SetStrokeColor(l),o.SetStrokeOpacity(c),o.SetStrokeWidth(h),0!==p&&o.SetStrokePattern(p),n.SetPoints(d),n.SetStrokeColor("white"),n.SetFillColor("none"),n.SetOpacity(0),e?n.SetEventBehavior(me.EventBehavior.HiddenOut):n.SetEventBehavior(me.EventBehavior.None),n.SetStrokeWidth(h+me.Common.Slop),i.AddElement(o),i.AddElement(n),this.ApplyStyles(o,r),this.ApplyEffects(i,!1,!0),i.isShape=!0,this.AddIcons(t,i),F.Debug("= S.ArcLine CreateArcShapeForHops output:",i),i}CreateShape(t,e){if(F.Debug("= S.ArcLine CreateShape input:",{svgDoc:t,isTouch:e}),this.flags&Se.ObjFlags.NotVisible)return F.Debug("= S.ArcLine CreateShape output:",null),null;if(0===this.hoplist.nhops){const i=t.CreateShape(me.CSType.ShapeContainer),o=t.CreateShape(me.CSType.Path);o.SetID(me.SVGElementClass.Shape);const n=t.CreateShape(me.CSType.Path);n.SetID(me.SVGElementClass.Slop),n.ExcludeFromExport(!0),this.CalcFrame();const s=ve.Pt2Rect(this.StartPoint,this.EndPoint),a=this.StyleRecord,r=this.SVGTokenizerHook(a),l=r.Line.Paint.Color,h=r.Line.Paint.Opacity;let c=r.Line.Thickness;c>0&&c<1&&(c=1);const p=r.Line.LinePattern,d=s.width,u=s.height;return i.SetSize(d,u),i.SetPos(s.x,s.y),o.SetFillColor("none"),o.SetStrokeColor(l),o.SetStrokeOpacity(h),o.SetStrokeWidth(c),0!==p&&o.SetStrokePattern(p),n.SetStrokeColor("white"),n.SetFillColor("none"),n.SetOpacity(0),e?n.SetEventBehavior(me.EventBehavior.HiddenOut):n.SetEventBehavior(me.EventBehavior.None),n.SetStrokeWidth(c+me.Common.Slop),i.AddElement(o),i.AddElement(n),this.ApplyStyles(o,r),this.ApplyEffects(i,!1,!0),i.isShape=!0,this.AddIcons(t,i),F.Debug("= S.ArcLine CreateShape output:",i),i}const i=this.CreateArcShapeForHops(t,e);return F.Debug("= S.ArcLine CreateShape output:",i),i}PostCreateShapeCallback(t,e,i,o){F.Debug("= S.ArcLine PostCreateShapeCallback input:",{svgDoc:t,svgContainer:e,callbackData:i,event:o}),0===this.hoplist.nhops?this.RegenerateGenerateArc(e):this.RegenerateGenerateArcForHops(e),this.DataID>=0&&this.LMAddSVGTextObject(t,e),this.UpdateDimensionLines(e),F.Debug("= S.ArcLine PostCreateShapeCallback output:","Callback completed")}CreateActionTriggers(t,e,i,o){F.Debug("= S.ArcLine CreateActionTriggers input:",{svgDoc:t,targetId:e,triggerType:i,compareId:o});let n=t.CreateShape(me.CSType.Group),s=me.Common.KnobSize,a=me.Common.RKnobSize,r=!0,l=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(l*=2);let h=s/l,c=a/l;this.objecttype===Se.FNObjectTypes.FlWall&&(h*=2);let p=ve.Pt2Rect(this.StartPoint,this.EndPoint),d=p.width+h,u=p.height+h,g=ws.GetObjectPtr(e,!1),y=Oe.DeepCopy(p);y.x-=h/2,y.y-=h/2,y.width+=h,y.height+=h;let S={svgDoc:t,shapeType:me.CSType.Rect,knobSize:h,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",cursorType:this.CalcCursorForSegment(this.StartPoint,this.EndPoint,!1),locked:!1,x:0,y:0,knobID:me.ActionTriggerType.LineStart};if(e!==o&&(S.fillColor="white",S.strokeSize=1,S.strokeColor="black",S.fillOpacity=0),S.x=this.StartPoint.x-p.x,S.y=this.StartPoint.y-p.y,S.knobID=me.ActionTriggerType.LineStart,g&&g.hooks)for(let P=0;P<g.hooks.length;P++)if(g.hooks[P].hookpt===me.HookPts.KTL){S.shapeType=me.CSType.Oval,r=!1;break}this.objecttype===Se.FNObjectTypes.FlWall&&(S.shapeType=me.CSType.Image);let m=this.GenericKnob(S);if(this.objecttype===Se.FNObjectTypes.FlWall&&m.SetURL&&(m.SetURL(S.cursorType===ze.CursorType.NwseResize?ze.Knob.Path+ze.Knob.DiagonLeft:ze.Knob.Path+ze.Knob.DiagonRight),m.ExcludeFromExport(!0)),n.AddElement(m),S.shapeType=me.CSType.Rect,S.x=this.EndPoint.x-p.x,S.y=this.EndPoint.y-p.y,S.knobID=me.ActionTriggerType.LineEnd,g&&g.hooks)for(let P=0;P<g.hooks.length;P++)if(g.hooks[P].hookpt===me.HookPts.KTR){S.shapeType=me.CSType.Oval,r=!1;break}this.objecttype===Se.FNObjectTypes.FlWall&&(S.shapeType=me.CSType.Image),m=this.GenericKnob(S),this.objecttype===Se.FNObjectTypes.FlWall&&m.SetURL&&(m.SetURL(S.cursorType===ze.CursorType.NwseResize?ze.Knob.Path+ze.Knob.DiagonLeft:ze.Knob.Path+ze.Knob.DiagonRight),m.ExcludeFromExport(!0)),n.AddElement(m),S.shapeType=me.CSType.Rect,S.cursorType=this.CalcCursorForSegment(this.StartPoint,this.EndPoint,!0),this.NoGrow()&&(S.cursorType=ze.CursorType.Default);let b=this.StartPoint.x,D=this.StartPoint.y,f=this.EndPoint.x,x=this.EndPoint.y,C=this.CalcRadiusAndCenter(b,D,f,x,this.CurveAdjust,this.IsReversed);if(S.x=C.actionX-p.x,S.y=C.actionY-p.y,S.knobID=me.ActionTriggerType.ModifyShape,m=this.GenericKnob(S),n.AddElement(m),r&&!S.locked&&!this.NoGrow()){S.shapeType=me.CSType.Oval;let t=Math.atan((this.EndPoint.y-this.StartPoint.y)/(this.EndPoint.x-this.StartPoint.x));t<0&&(t=-t),this.EndPoint.x>=this.StartPoint.x?(S.x=this.EndPoint.x-2*c*Math.cos(t)-p.x,S.y=this.EndPoint.y-2*c*Math.sin(t)-p.y):(S.x=this.StartPoint.x-2*c*Math.cos(t)-p.x,S.y=this.StartPoint.y-2*c*Math.sin(t)-p.y),S.cursorType=ze.CursorType.Rotate,S.knobID=me.ActionTriggerType.Rotate,S.fillColor="white",S.fillOpacity=.001,S.strokeSize=1.5,S.strokeColor="black",S.knobSize=c,m=this.GenericKnob(S),n.AddElement(m),S.knobSize=h}if(this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()){let t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.CreateDimensionAdjustmentKnobs(n,t,S)}return n.SetSize(d,u),n.SetPos(y.x,y.y),n.isShape=!0,n.SetID(me.Common.Action+e),F.Debug("= S.ArcLine CreateActionTriggers output:",n),n}GetTextOnLineParams(t){F.Debug("= S.ArcLine GetTextOnLineParams input:",{param:t});let e={Frame:new we.Shape.Rect,StartPoint:new De(0,0),EndPoint:new De(0,0)};switch(e.StartPoint.x=this.StartPoint.x,e.StartPoint.y=this.StartPoint.y,e.EndPoint.x=this.EndPoint.x,e.EndPoint.y=this.EndPoint.y,e.Frame=ve.Pt2Rect(e.StartPoint,e.EndPoint),this.TextAlign){case bi.TextAlign.TopCenter:case bi.TextAlign.Center:case bi.TextAlign.BottomCenter:{const t=en.GetClockwiseAngleBetween2PointsInRadians(e.StartPoint,e.EndPoint),i=[];i.push(new De(e.StartPoint.x,e.StartPoint.y)),i.push(new De(e.EndPoint.x,e.EndPoint.y)),si.RotatePointsAboutCenter(e.Frame,t,i);const o=this.CalcRadiusAndCenter(i[0].x,i[0].y,i[1].x,i[1].y,this.CurveAdjust,this.IsReversed);i[0].y=o.actionY,i[1].y=o.actionY,si.RotatePointsAboutCenter(e.Frame,-t,i),e.StartPoint.x=i[0].x,e.StartPoint.y=i[0].y,e.EndPoint.x=i[1].x,e.EndPoint.y=i[1].y;break}}return F.Debug("= S.ArcLine GetTextOnLineParams output:",e),e}RegenerateGenerateArc(t){F.Debug("= S.ArcLine RegenerateGenerateArc input:",{svgDoc:t});let e=ye.arrowHlkTable[this.StartArrowID],i=ye.arrowHlkTable[this.EndArrowID],o=ye.arrowHsTable[this.ArrowSizeIndex];0===e.id&&(e=null),0===i.id&&(i=null);const n=t.GetElementById(me.SVGElementClass.Shape),s=t.GetElementById(me.SVGElementClass.Slop);if(null!==n&&void 0!==n.PathCreator){const a=n.PathCreator();a.BeginPath();const r=ve.Pt2Rect(this.StartPoint,this.EndPoint),l=this.StartPoint.x-r.x,h=this.StartPoint.y-r.y,c=this.EndPoint.x-r.x,p=this.EndPoint.y-r.y,d=this.CalcRadiusAndCenter(l,h,c,p,this.CurveAdjust,this.IsReversed);d.centerInside?(a.MoveTo(c,p),a.ArcTo(l,h,d.radius,d.radius,0,this.IsReversed,!0,!1)):(a.MoveTo(l,h),a.ArcTo(c,p,d.radius,d.radius,0,!this.IsReversed,!1,!1));const u=a.ToString();n.SetPath(u),s.SetPath(u),t.SetSize(r.width,r.height),t.SetPos(r.x,r.y),(e||i)&&(d.centerInside?(n.SetArrowheads(i,o,e,o,this.EndArrowDisp,this.StartArrowDisp),s.SetArrowheads(i,o,e,o,this.EndArrowDisp,this.StartArrowDisp)):(n.SetArrowheads(e,o,i,o,this.StartArrowDisp,this.EndArrowDisp),s.SetArrowheads(e,o,i,o,this.StartArrowDisp,this.EndArrowDisp)))}F.Debug("= S.ArcLine RegenerateGenerateArc output:",{pathData:n&&n.PathCreator?n.PathCreator().ToString():null})}RegenerateGenerateArcForHops(t){F.Debug("= S.ArcLine RegenerateGenerateArcForHops input:",{svgDoc:t});let e=ye.arrowHlkTable[this.StartArrowID],i=ye.arrowHlkTable[this.EndArrowID],o=ye.arrowHsTable[this.ArrowSizeIndex];0===e.id&&(e=null),0===i.id&&(i=null);const n=t.GetElementById(me.SVGElementClass.Shape),s=t.GetElementById(me.SVGElementClass.Slop);let a=this.GetPolyPoints(me.Common.MaxPolyPoints,!0);const r=ye.opt.InsertHops(this,a,a.length);a=a.slice(0,r.npts);const l=a.length;n.SetPoints(a);const h=ve.Pt2Rect(this.StartPoint,this.EndPoint),c=this.StartPoint.x-h.x,p=this.StartPoint.y-h.y;if(t.SetSize(h.width,h.height),t.SetPos(h.x,h.y),e||i){const t=(c-a[0].x)*(c-a[0].x)+(p-a[0].y)*(p-a[0].y);let r=!1;(c-a[l-1].x)*(c-a[l-1].x)+(p-a[l-1].y)*(p-a[l-1].y)<t&&(r=!0),r?(n.SetArrowheads(i,o,e,o,this.EndArrowDisp,this.StartArrowDisp),s.SetArrowheads(i,o,e,o,this.EndArrowDisp,this.StartArrowDisp)):(n.SetArrowheads(e,o,i,o,this.StartArrowDisp,this.EndArrowDisp),s.SetArrowheads(e,o,i,o,this.StartArrowDisp,this.EndArrowDisp))}F.Debug("= S.ArcLine RegenerateGenerateArcForHops output:",{polyPoints:a,rect:h})}AdjustLineStart(t,e,i){F.Debug("= S.ArcLine AdjustLineStart input:",{svgDoc:t,newStartX:e,newStartY:i});const o={x:this.StartPoint.x,y:this.StartPoint.y};this.StartPoint.x=e,this.StartPoint.y=i,this.EnforceMinimum(!0),this.CalcFrame(),(this.r.x<0||this.r.y<0)&&(this.StartPoint.x=o.x,this.StartPoint.y=o.y,this.CalcFrame()),this.RegenerateGenerateArc(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),new Ke;const n=this.EndPoint.x-this.StartPoint.x,s=this.EndPoint.y-this.StartPoint.y;ve.Sqrt(n*n+s*s),this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(this.Frame,this.StartPoint,ze.CursorTypes.Grow),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),F.Debug("= S.ArcLine AdjustLineStart output:",{updatedStartPoint:this.StartPoint,updatedFrame:this.Frame})}AdjustLineEnd(t,e,i,o){F.Debug("= S.ArcLine AdjustLineEnd input:",{svgDoc:t,newEndX:e,newEndY:i,trigger:o});const n={x:this.EndPoint.x,y:this.EndPoint.y};if(this.EndPoint.x=e,this.EndPoint.y=i,this.EnforceMinimum(!1),this.CalcFrame(),(this.r.x<0||this.r.y<0)&&(this.EndPoint.x=n.x,this.EndPoint.y=n.y,this.CalcFrame()),t){this.RegenerateGenerateArc(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame),new Ke;const e=this.EndPoint.x-this.StartPoint.x,i=this.EndPoint.y-this.StartPoint.y;ve.Sqrt(e*e+i*i),this.UpdateDimensionLines(t),Ts.UpdateDisplayCoordinates(this.Frame,this.EndPoint,ze.CursorTypes.Grow,this),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)}F.Debug("= S.ArcLine AdjustLineEnd output:",{updatedEndPoint:this.EndPoint,frame:this.Frame})}Flip(t){F.Debug("= S.ArcLine Flip input:",{flipFlag:t});let e=!1;const i={};if(ye.opt.ob=Oe.DeepCopy(this),t&me.ExtraFlags.FlipVert&&(i.y=this.StartPoint.y,this.StartPoint.y=this.EndPoint.y,this.EndPoint.y=i.y,e=!0,F.Debug("= S.ArcLine Flip: Performed vertical flip.")),t&me.ExtraFlags.FlipHoriz&&(i.x=this.StartPoint.x,this.StartPoint.x=this.EndPoint.x,this.EndPoint.x=i.x,e=!0,F.Debug("= S.ArcLine Flip: Performed horizontal flip.")),e){this.IsReversed=!this.IsReversed,F.Debug("= S.ArcLine Flip: Toggled IsReversed to",this.IsReversed);const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);t&&(this.UpdateDimensionLines(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)),ye.opt.ob.Frame&&Yo.MaintainLink(this.BlockID,this,ye.opt.ob,me.ActionTriggerType.Rotate),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move)}ye.opt.ob={},F.Debug("= S.ArcLine Flip output:",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,IsReversed:this.IsReversed})}ModifyShape(t,e,i,o,n){F.Debug("= S.ArcLine ModifyShape input:",{svgDoc:t,x:e,y:i,trigger:o,additional:n});let s=this.FindSide(this.StartPoint.x,this.StartPoint.y,this.EndPoint.x,this.EndPoint.y,e,i);-1===o&&(s=this.OriginalLineSide),s!==this.OriginalLineSide&&(0!==this.OriginalLineSide&&(this.IsReversed=!this.IsReversed),this.OriginalLineSide=s);const a=this.StartPoint.x+(this.EndPoint.x-this.StartPoint.x)/2-e,r=this.StartPoint.y+(this.EndPoint.y-this.StartPoint.y)/2-i,l=Math.sqrt(a*a+r*r),h=l-this.OriginalCenterPointDistance,c=this.CurveAdjust,p=this.OriginalCurveAdjust;l<this.OriginalCenterPointDistance?this.CurveAdjust=p-h:this.CurveAdjust=p+h,this.CurveAdjust<1?this.CurveAdjust=1:this.CurveAdjust>500&&(this.CurveAdjust=500),this.CalcFrame(),-1!==o&&(this.r.x<0||this.r.y<0)&&(this.CurveAdjust=c,this.CalcFrame()),(this.Dimensions&Se.DimensionFlags.Select||this.Dimensions&Se.DimensionFlags.Always)&&ws.AddToDirtyList(this.BlockID),t&&(this.RegenerateGenerateArc(t),-1!==this.DataID&&this.LMResizeSVGTextObject(t,this,this.Frame)),F.Debug("= S.ArcLine ModifyShape output:",{CurveAdjust:this.CurveAdjust,Frame:this.Frame})}FindSide(t,e,i,o,n,s){F.Debug("= S.ArcLine FindSide input:",{startX:t,startY:e,endX:i,endY:o,testX:n,testY:s});let a=0;if(t===i)return a=n<t?o>e?1:-1:n>t?o>e?-1:1:0,F.Debug("= S.ArcLine FindSide output:",a),a;if(e===o)return a=s<e?i>t?1:-1:s>e?i>t?-1:1:0,F.Debug("= S.ArcLine FindSide output:",a),a;const r=(o-e)/(i-t)*(n-t)+e;return a=s>r?i>t?1:-1:s<r?i>t?-1:1:0,F.Debug("= S.ArcLine FindSide output:",a),a}BeforeModifyShape(t,e,i){F.Debug("= S.ArcLine BeforeModifyShape input:",{mouseX:t,mouseY:e,extra:i}),this.OriginalCurveAdjust=this.CurveAdjust;const o=this.StartPoint.x+(this.EndPoint.x-this.StartPoint.x)/2-t,n=this.StartPoint.y+(this.EndPoint.y-this.StartPoint.y)/2-e,s=Math.sqrt(o*o+n*n);this.OriginalCenterPointDistance=s,this.OriginalLineSide=this.CurveAdjust<=1?0:this.FindSide(this.StartPoint.x,this.StartPoint.y,this.EndPoint.x,this.EndPoint.y,t,e),F.Debug("= S.ArcLine BeforeModifyShape output:",{OriginalCurveAdjust:this.OriginalCurveAdjust,OriginalCenterPointDistance:this.OriginalCenterPointDistance,OriginalLineSide:this.OriginalLineSide})}StartNewObjectDrawTrackCommon(t,e,i){F.Debug("= S.ArcLine StartNewObjectDrawTrackCommon input:",{drawX:t,drawY:e,extra:i});const o=ye.opt.actionStartX,n=t-o,s=e-ye.opt.actionStartY,a=Math.sqrt(n*n+s*s);Rt.extend(!0,{},ye.opt.actionBBox);let r=a/10;r<1?r=1:r>500&&(r=500),this.CurveAdjust=r,this.IsReversed=!(t>=o),this.AdjustLineEnd(ye.opt.actionSvgObject,t,e,me.ActionTriggerType.LineEnd),F.Debug("= S.ArcLine StartNewObjectDrawTrackCommon output:",{CurveAdjust:this.CurveAdjust,IsReversed:this.IsReversed})}GetPolyPoints(t,e,i,o,n){F.Debug("= S.ArcLine GetPolyPoints input:",{numPoints:t,skipOffset:e,useSuper:i,extraParam1:o,extraParam2:n});let s=[],a={x:0,y:0};if(i)return s=super.GetPolyPoints(t,e,i,o,n),F.Debug("= S.ArcLine GetPolyPoints output (using super):",s),s;const r=ve.Pt2Rect(this.StartPoint,this.EndPoint),l=this.StartPoint.x-r.x,h=this.StartPoint.y-r.y,c=this.EndPoint.x-r.x,p=this.EndPoint.y-r.y,d=c-l,u=p-h,g=Math.sqrt(d*d+u*u);let y=g>0?d/g:0;Math.abs(y)<1e-4&&(y=0);let S=Math.abs(u)<1e-4?0:u,m=Math.asin(y);(S>0||0===S)&&(m=-m);const b=this.CalcRadiusAndCenter(l,h,c,p,this.CurveAdjust,this.IsReversed);a.x=b.centerX,a.y=b.centerY;const D=[];let f,x;if(D.push(new De(l,h)),D.push(new De(c,p)),si.RotatePointsAboutPoint(a,m,D),D[0].y>D[1].y&&!this.FromPolygon?(f=D[1].y,x=D[0].y):(f=D[0].y,x=D[1].y),s=en.ArcToPoly(t-1,a,b.radius,f,x,D[0].x,this.IsReversed,b.centerInside),s.push(new De(s[0].x,x)),si.RotatePointsAboutPoint(a,-m,s),!e)for(let C=0;C<s.length;C++)s[C].x+=r.x,s[C].y+=r.y;return F.Debug("= S.ArcLine GetPolyPoints output:",s),s}GetConnectLine(){F.Debug("= S.ArcLine GetConnectLine input:",{StartPoint:this.StartPoint,EndPoint:this.EndPoint,CurveAdjust:this.CurveAdjust,IsReversed:this.IsReversed});const t=ve.Pt2Rect(this.StartPoint,this.EndPoint),e=this.StartPoint.x-t.x,i=this.StartPoint.y-t.y,o=this.EndPoint.x-t.x,n=this.EndPoint.y-t.y,s={frame:{},length:0,startpt:{x:0,y:0},endpt:{x:0,y:0},center:{}},a=this.CalcRadiusAndCenter(e,i,o,n,this.CurveAdjust,this.IsReversed);if(a.centerInside){const r=o-e,l=n-i;let h=Math.sqrt(r*r+l*l),c=h>0?r/h:0;Math.abs(c)<1e-4&&(c=0);let p=Math.abs(l)<1e-4?0:l,d=Math.asin(c);p>=0&&(d=-d);const u={x:a.centerX,y:a.centerY},g=[];let y,S;g.push(new De(e,i)),g.push(new De(o,n)),si.RotatePointsAboutPoint(u,d,g),g[0].y>g[1].y?(y=g[0].y-g[1].y,S=a.radius-y/2,g[0].y+=S,g[1].y-=S):(y=g[1].y-g[0].y,S=a.radius-y/2,g[1].y+=S,g[0].y-=S),si.RotatePointsAboutPoint(u,-d,g),g[0].x+=t.x,g[0].y+=t.y,g[1].x+=t.x,g[1].y+=t.y;const m=ve.Pt2Rect(g[0],g[1]),b=g[0].x-g[1].x,D=g[0].y-g[1].y,f=Math.sqrt(b*b+D*D);return s.frame=m,s.length=f,s.startpt={x:g[0].x,y:g[0].y},s.endpt={x:g[1].x,y:g[1].y},s.center={x:u.x+t.x,y:u.y+t.y},F.Debug("= S.ArcLine GetConnectLine intermediate values:",{rotatedPoints:g,computedFrame:m,computedLength:f,resultCenter:s.center}),F.Debug("= S.ArcLine GetConnectLine output:",s),s}return F.Debug("= S.ArcLine GetConnectLine output:",null),null}GetTargetPoints(t,e,i){F.Debug("= S.ArcLine GetTargetPoints input:",{hookElement:t,hookFlags:e,targetId:i});const o=[{x:0,y:0}];let n,s={x:0,y:0},a={x:0,y:0};const r=me.HookPts;if(null!=i&&i>=0&&ws.GetObjectPtr(i,!1).DrawingObjectBaseClass===me.DrawObjectBaseClass.Shape)switch(t.id){case r.KTC:case r.KBC:case r.KRC:case r.KLC:const o=super.GetTargetPoints(t,e,i);return F.Debug("= S.ArcLine GetTargetPoints output:",o),o}const l=this.GetConnectLine();l?(s=l.startpt,a=l.endpt):(s=this.StartPoint,a=this.EndPoint);let h=this.EndPoint.x-this.StartPoint.x;Math.abs(h)<1&&(h=1);const c=(this.EndPoint.y-this.StartPoint.y)/h;let p,d;Math.abs(c)>1||e&Se.HookFlags.LcHOnly?(n=ye.opt.ArcToChord(s,a,t,l,this),d=n.y-s.y,p=n.x-s.x):(n=ye.opt.ArcToChord(s,a,t,l,this),p=n.x-s.x,d=n.y-s.y);const u=a.y-s.y,g=a.x-s.x;if(o[0].y=Math.abs(u)>1?d/u*me.Common.DimMax:me.Common.DimMax,o[0].x=Math.abs(g)>1?p/g*me.Common.DimMax:me.Common.DimMax,o[0].x>me.Common.DimMax&&(o[0].x=me.Common.DimMax),o[0].y>me.Common.DimMax&&(o[0].y=me.Common.DimMax),o[0].x<0&&(o[0].x=0),o[0].y<0&&(o[0].y=0),l){const t=2*Math.round(n.x/2)!==n.x;o[0].x=2*Math.round((o[0].x+.5)/2),t&&o[0].x--}return F.Debug("= S.ArcLine GetTargetPoints output:",o),o}GetPerimPts(t,e,i,o,n,s){F.Debug("= S.ArcLine GetPerimPts input:",{event:t,hooks:e,param3:i,param4:o,param5:n,targetId:s});let a=[];const r=ve.Pt2Rect(this.StartPoint,this.EndPoint),l=this.StartPoint.x-r.x,h=this.StartPoint.y-r.y,c=this.EndPoint.x-r.x,p=this.EndPoint.y-r.y;if(e&&2===e.length&&e[0].id&&e[0].id===me.HookPts.KTL&&e[1].id&&e[1].id===me.HookPts.KTR){let t=new De(this.StartPoint.x,this.StartPoint.y);t.id=e[0].id;let i=new De(this.EndPoint.x,this.EndPoint.y);return i.id=e[1].id,a.push(t,i),F.Debug("= S.ArcLine GetPerimPts output (direct start/end):",a),a}const d=ws.GetObjectPtr(s,!1);if(d&&d.objecttype===Se.FNObjectTypes.Multiplicity)return a=super.GetPerimPts(t,e,i,o,n,s),F.Debug("= S.ArcLine GetPerimPts output (Multiplicity):",a),a;if(d&&d.objecttype===Se.FNObjectTypes.ExtraTextLable&&1===e.length)return a=super.GetPerimPts(t,e,i,o,n,s),F.Debug("= S.ArcLine GetPerimPts output (ExtraTextLabel):",a),a;const u=this.CalcRadiusAndCenter(l,h,c,p,this.CurveAdjust,this.IsReversed),g={x:u.centerX+r.x,y:u.centerY+r.y};let y=this.IsReversed;const S=super.GetPerimPts(t,e,i,o,n,s);let m,b,D=!1;const f=this.GetConnectLine();f?(m=f.startpt,b=f.endpt,D=2*Math.round(e[0].x/2)!==e[0].x,y=!1):(m=this.StartPoint,b=this.EndPoint);for(let x=0;x<S.length;x++)a[x]=en.ChordToArc(m,b,g,u.radius,y,D,u.centerInside,S[x]),null!=S[x].id&&(a[x].id=S[x].id);return F.Debug("= S.ArcLine GetPerimPts output:",a),a}MaintainPoint(t,e,i,o,n){F.Debug("= S.ArcLine MaintainPoint input:",{event:t,targetId:e,maintainDistParam:i,drawingObject:o,extraParam:n});let s=!1,a={},r={};switch(o.DrawingObjectBaseClass){case me.DrawObjectBaseClass.Line:switch(o.LineType){case me.LineType.SEGLINE:case me.LineType.ARCSEGLINE:case me.LineType.POLYLINE:for(let t=0;t<o.hooks.length;t++)if(o.hooks[t].targetid===e){o.HookToPoint(o.hooks[t].hookpt,a),s=!0;break}return s?(r=Oe.DeepCopy(o),ve.CopyRect(r.Frame,a),r.StartPoint.x=a.x,r.StartPoint.y=a.y,r.EndPoint.x=a.x+a.width,r.EndPoint.y=a.y+a.height,F.Debug("= S.ArcLine MaintainPoint output:",r),r):(F.Debug("= S.ArcLine MaintainPoint output:",!0),!0)}if(ye.opt.ArcCheckPoint(this,t))return F.Debug("= S.ArcLine MaintainPoint output:",!0),!0;if(ye.opt.ArcIntersect(this,o,t))return F.Debug("= S.ArcLine MaintainPoint output:",!0),!0;ye.opt.LinesMaintainDist(this,i,n,t);break;case me.DrawObjectBaseClass.Shape:ye.opt.LinesMaintainDist(this,i,n,t)}return F.Debug("= S.ArcLine MaintainPoint output:",!0),!0}},ArcSegmentedLine:class extends fa{constructor(t){F.Debug("S.ArcSegmentedLine - Constructor input:",t),(t=t||{}).LineType=t.LineType||me.LineType.ARCSEGLINE,super(t),F.Debug("S.ArcSegmentedLine - Constructor output initialized with:",t)}CreateShape(t,e){F.Debug("S.ArcSegmentedLine - CreateShape input:",{svgContext:t,isPreviewMode:e});let i,o,n,s=[];if(this.flags&Se.ObjFlags.NotVisible)return F.Debug("S.ArcSegmentedLine - CreateShape output:",null),null;const a=t.CreateShape(me.CSType.ShapeContainer),r=0===this.hoplist.nhops;r?(i=t.CreateShape(me.CSType.Path),o=t.CreateShape(me.CSType.Path)):(i=t.CreateShape(me.CSType.Polyline),o=t.CreateShape(me.CSType.Polyline)),i.SetID(me.SVGElementClass.Shape),o.SetID(me.SVGElementClass.Slop),o.ExcludeFromExport(!0),this.CalcFrame();const l=ve.Pt2Rect(this.StartPoint,this.EndPoint);let h=this.StyleRecord;h=this.SVGTokenizerHook(h);const c=h.Line.Paint.Color;let p=h.Line.Thickness;const d=h.Line.Paint.Opacity,u=h.Line.LinePattern;p>0&&p<1&&(p=1);const g=l.width,y=l.height;if(a.SetSize(g,y),a.SetPos(l.x,l.y),i.SetSize(g,y),r)s=we.Shape.SegmentedLine.prototype.GetPolyPoints.call(this,me.Common.MaxPolyPoints,!0,!0,null),n=this.UpdateSVG(i,s);else{if(s=this.GetPolyPoints(me.Common.MaxPolyPoints,!0),0!==this.hoplist.nhops){const t=ye.opt.InsertHops(this,s,s.length);s=s.slice(0,t.npts)}i.SetPoints(s)}return i.SetFillColor("none"),i.SetStrokeColor(c),i.SetStrokeOpacity(d),i.SetStrokeWidth(p),0!==u&&i.SetStrokePattern(u),o.SetSize(g,y),r?o.SetPath(n):o.SetPoints(s),o.SetStrokeColor("white"),o.SetFillColor("none"),o.SetOpacity(0),e?o.SetEventBehavior(me.EventBehavior.HiddenOut):o.SetEventBehavior(me.EventBehavior.None),o.SetStrokeWidth(p+me.Common.Slop),a.AddElement(i),a.AddElement(o),this.ApplyStyles(i,h),this.ApplyEffects(a,!1,!0),a.isShape=!0,this.AddIcons(t,a),F.Debug("S.ArcSegmentedLine - CreateShape output:",a),a}UpdateSVG(t,e){F.Debug("S.ArcSegmentedLine - updateSVG input:",{svgElement:t,points:e});const i=t.PathCreator();i.BeginPath(),i.MoveTo(e[0].x,e[0].y);let o=e[0].x,n=e[0].y;const s=e.length;2===s&&i.LineTo(e[1].x,e[1].y);for(let r=2;r<s;r++){const t=o,a=n;let l,h,c,p,d;e[r-1].x===e[r].x?(r<s-1?(n=(e[r-1].y+e[r].y)/2,h=Math.abs(e[r-1].y-e[r].y)/2):(h=Math.abs(n-e[r].y),n=e[r].y),l=Math.abs(o-e[r].x),c=n-a,p=(o=e[r].x)-t,d=!(p>=0&&c<0||p<0&&c>=0)):(r<s-1?(l=Math.abs(e[r-1].x-e[r].x)/2,o=(e[r-1].x+e[r].x)/2):(l=Math.abs(o-e[r].x),o=e[r].x),h=Math.abs(n-e[r].y),c=(n=e[r].y)-a,p=o-t,d=!(p<0&&c<0||p>=0&&c>=0)),i.ArcTo(o,n,l,h,0,d,!1,!1)}const a=i.ToString();return t.SetPath(a),F.Debug("S.ArcSegmentedLine - updateSVG output:",a),a}GetPolyPoints(t,e,i,o,n){F.Debug("S.ArcSegmentedLine - GetPolyPoints input:",{numPoints:t,useRelativeCoordinates:e,includeStartPoint:i,unusedFlag:o,unusedParam:n});let s,a,r,l,h,c,p,d,u,g,y,S=[];if(s=we.Shape.SegmentedLine.prototype.GetPolyPoints.call(this,me.Common.MaxPolyPoints,!0,!0,!1,null),c=ve.Pt2Rect(this.StartPoint,this.EndPoint),0===this.segl.firstdir&&0===this.segl.lastdir&&(ve.IsEqual(c.height,0)||ve.IsEqual(c.width,0))){if(S=s,!e)for(a=0,r=S.length;a<r;a++)S[a].x+=c.x,S[a].y+=c.y;return F.Debug("S.ArcSegmentedLine - GetPolyPoints output:",S),S}if(this.segl&&this.segl.pts.length){for(l=s[0].x,h=s[0].y,r=s.length,i&&S.push(new De(l,h)),a=2;a<r;a++)p=l,d=h,s[a-1].x===s[a].x?(a<r-1?(h=(s[a-1].y+s[a].y)/2,Math.abs(s[a-1].y-s[a].y)):(Math.abs(h-s[a].y),h=s[a].y),Math.abs(l-s[a].x),g=h-d,u=(l=s[a].x)-p,y=!(u>=0&&g<0||u<0&&g>=0)):(a<r-1?(Math.abs(s[a-1].x-s[a].x),l=(s[a-1].x+s[a].x)/2):(Math.abs(l-s[a].x),l=s[a].x),Math.abs(h-s[a].y),g=(h=s[a].y)-d,u=l-p,y=!(u<0&&g<0||u>=0&&g>=0)),i?(S.push(new De(l,h)),S[S.length-1].notclockwise=!y):en.EllipseToPoints(S,t/2,p,l,d,h,y);if(!e)for(a=0,r=S.length;a<r;a++)S[a].x+=c.x,S[a].y+=c.y}else S=we.Shape.BaseLine.prototype.GetPolyPoints.call(this,t,e,!0,null);return F.Debug("S.ArcSegmentedLine - GetPolyPoints output:",S),S}GetTextOnLineParams(t){if(F.Debug("S.ArcSegmentedLine - GetTextOnLineParams input:",t),3!==this.segl.pts.length){const e=we.Shape.SegmentedLine.prototype.GetTextOnLineParams.call(this,t);return F.Debug("S.ArcSegmentedLine - GetTextOnLineParams output:",e),e}switch(this.TextAlign){case bi.TextAlign.TopCenter:case bi.TextAlign.Center:case bi.TextAlign.BottomCenter:{const t=this.GetPolyPoints(22,!1,!1,!1,null),e=[],i={Frame:new we.Shape.Rect,StartPoint:new De,EndPoint:new De};i.Frame=ve.Pt2Rect(t[0],t[9]);const o=en.GetClockwiseAngleBetween2PointsInRadians(t[0],t[9]);return e.push(new De(t[0].x,t[0].y)),e.push(new De(t[9].x,t[9].y)),e.push(new De(t[7].x,t[7].y)),si.RotatePointsAboutCenter(i.Frame,o,e),e[0].y=e[2].y,e[1].y=e[2].y,si.RotatePointsAboutCenter(i.Frame,-o,e),i.StartPoint.x=e[0].x,i.StartPoint.y=e[0].y,i.EndPoint.x=e[1].x,i.EndPoint.y=e[1].y,i.CenterProp=.3,F.Debug("S.ArcSegmentedLine - GetTextOnLineParams output:",i),i}default:{const e=we.Shape.SegmentedLine.prototype.GetTextOnLineParams.call(this,t);return F.Debug("S.ArcSegmentedLine - GetTextOnLineParams output:",e),e}}}},BaseDrawObject:dn,BaseLine:es,BaseShape:Zn,BaseSymbol:us,BitmapSymbol:class extends us{constructor(t){t.ShapeType=me.ShapeType.BitmapSymbol,super(t)}CreateShape(t){if(this.flags&Se.ObjFlags.NotVisible)return null;const e=t.CreateShape(me.CSType.ShapeContainer),i=t.CreateShape(me.CSType.Image);i.SetID(me.SVGElementClass.Shape),i.SetURL(this.SymbolURL);const o=(this.extraflags&me.ExtraFlags.FlipHoriz)>0,n=(this.extraflags&me.ExtraFlags.FlipVert)>0;o&&i.SetMirror(o),n&&i.SetFlip(n);const s=this.Frame;this.GetFieldDataStyleOverride();const a=s.width,r=s.height;return e.SetSize(a,r),e.SetPos(s.x,s.y),i.SetSize(a,r),e.AddElement(i),e.isShape=!0,-1!==this.DataID&&this.LMAddSVGTextObject(t,e),e}},Connector:class extends dn{constructor(t){F.Debug("S.Connector: Input options:",t),(t=t||{}).DrawingObjectBaseClass=me.DrawObjectBaseClass.Connector,t.targflags=Se.HookFlags.LcShape,t.hookflags=Se.HookFlags.LcShape;let e=t.arraylist||new La;null!=t.styleflags?e.styleflags=t.styleflags:e.styleflags=me.AStyles.PerpConn|me.AStyles.MinZero,e.ht=null==t.arrayht?me.ConnectorDefines.DefaultHt:t.arrayht,e.wd=null==t.arraywd?me.ConnectorDefines.DefaultWd:t.arraywd,e.curveparam=t.curveparam||0;var i=new Oa;i.startpoint.h=0,i.startpoint.v=0,i.endpoint.h=e.wd,i.endpoint.v=0,e.hook.push(i),t.Frame&&(t.Frame.height=e.ht,t.Frame.width=e.wd),t.EndPoint&&(t.EndPoint.x=e.wd,t.EndPoint.y=e.ht),super(t),a(this,"StartPoint"),a(this,"hoplist"),a(this,"ArrowheadData"),a(this,"StartArrowID"),a(this,"EndArrowID"),a(this,"StartArrowDisp"),a(this,"EndArrowDisp"),a(this,"ArrowSizeIndex"),a(this,"TextDirection"),a(this,"arraylist"),a(this,"vertical"),a(this,"arrayht"),a(this,"arraywd"),a(this,"curveparam"),a(this,"theMinTextDim"),a(this,"TextFlags"),a(this,"EndPoint"),a(this,"lasttexthook"),this.arraylist=e,this.StartPoint=t.StartPoint||{x:0,y:0},this.hoplist=t.hoplist||{nhops:0,hops:[]},this.ArrowheadData=t.ArrowheadData||[],this.StartArrowID=t.StartArrowID||0,this.EndArrowID=t.EndArrowID||0,this.StartArrowDisp=t.StartArrowDisp||!1,this.EndArrowDisp=t.EndArrowDisp||!1,this.ArrowSizeIndex=t.ArrowSizeIndex||0,this.TextDirection=t.TextDirection||!1,this.vertical=t.vertical||!1,this.EndPoint=t.EndPoint||{x:this.arraylist.wd,y:this.arraylist.ht},this.theMinTextDim={width:0,height:0},this.TextFlags=ve.SetFlag(this.TextFlags,Se.TextFlags.HorizText,!this.TextDirection),F.Debug("S.Connector: Output instance:",this)}IsChildOfAssistant(){if(F.Debug("S.Connector: Checking if child of assistant. Hooks:",this.hooks),this.hooks.length){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);if(F.Debug("S.Connector: First hook object:",t),t&&t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){const e=t.IsAsstConnector();return F.Debug("S.Connector: Is assistant connector:",e),e}}return F.Debug("S.Connector: Not a child of assistant."),!1}LinkNotVisible(){F.Debug("S.Connector: Checking link visibility.");const t=this.arraylist.styleflags&me.AStyles.CoManager,e=this.IsChildOfAssistant();if(this.flags&Se.ObjFlags.NotVisible){if(!this.hooks.length||t||e)return F.Debug("S.Connector: Link is not visible due to hooks, co-manager, or assistant status."),!0;const i=ws.GetObjectPtr(this.hooks[0].objid,!1);if(i&&i.flags&Se.ObjFlags.NotVisible)return F.Debug("S.Connector: Link is not visible due to first hook object visibility."),!0}return F.Debug("S.Connector: Link is visible."),!1}GetTextOnLineParams(t){F.Debug("S.Connector: Input hook:",t);const e={Frame:Oe.DeepCopy(this.Frame),StartPoint:{x:0,y:0},EndPoint:{x:0,y:0}};return this.vertical?(e.StartPoint.x=t.startpoint.v+this.StartPoint.x,e.StartPoint.y=t.startpoint.h+this.StartPoint.y,e.EndPoint.x=t.endpoint.v+this.StartPoint.x,e.EndPoint.y=t.endpoint.h+this.StartPoint.y):(e.StartPoint.x=t.startpoint.h+this.StartPoint.x,e.StartPoint.y=t.startpoint.v+this.StartPoint.y,e.EndPoint.x=t.endpoint.h+this.StartPoint.x,e.EndPoint.y=t.endpoint.v+this.StartPoint.y),F.Debug("S.Connector: Output params:",e),e}ChangeBackgroundColor(t,e){F.Debug("S.Connector: Input newColor:",t,"currentColor:",e),this.StyleRecord.Fill.Paint.FillType!==Se.FillTypes.Transparent&&this.StyleRecord.Fill.Paint.Color.toLowerCase()===e.toLowerCase()&&(ws.GetObjectPtr(this.BlockID,!0),this.StyleRecord.Fill.Paint.Color=t,ws.AddToDirtyList(this.BlockID)),F.Debug("S.Connector: Updated StyleRecord.Fill.Paint.Color:",this.StyleRecord.Fill.Paint.Color)}AddSVGTextObject(t,e,i){F.Debug("S.Connector: Input svgDoc:",t,"parentElement:",e,"hookIndex:",i);let o,n={},s={};void 0===i&&(i=this.arraylist.lasttexthook);const a=this.arraylist.hook[i];this.vertical?(n.x=a.startpoint.v,n.y=a.startpoint.h,s.x=a.endpoint.v,s.y=a.endpoint.h,o=ve.Pt2Rect(n,s),ve.InflateRect(o,20,0)):(n.x=a.startpoint.h,n.y=a.startpoint.v,s.x=a.endpoint.h,s.y=a.endpoint.v,o=ve.Pt2Rect(n,s),ve.InflateRect(o,0,20));const r=t.CreateShape(me.CSType.Rect);r.SetID(me.SVGElementClass.TextBackground),r.SetUserData(i),r.SetStrokeWidth(0);const l=this.StyleRecord.Fill.Paint.Color;r.SetFillColor(l),this.StyleRecord.Fill.Paint.FillType===Se.FillTypes.Transparent?r.SetOpacity(0):r.SetOpacity(this.StyleRecord.Fill.Paint.Opacity);const h=t.CreateShape(me.CSType.Text);h.SetID(me.SVGElementClass.Text),h.SetUserData(i),h.SetRenderingEnabled(!1),h.SetSize(o.width,o.height),h.SetSpellCheck(this.AllowSpell()),h.InitDataSettings(this.fieldDataTableID,this.fieldDataElemID),e.AddElement(r),e.AddElement(h),e.isText=!0,i===this.arraylist.lasttexthook&&(e.textElem=h);const c=ye.stdObj.GetObject(a.textid);c.Data.runtimeText?(c.Data.runtimeText.vAlign="top",h.SetRuntimeText(c.Data.runtimeText)):(h.SetText(""),h.SetParagraphAlignment(this.TextAlign),h.SetVerticalAlignment("top")),c.Data.runtimeText||(c.Data.runtimeText=h.GetRuntimeText()),h.SetConstraints(ye.opt.header.MaxWorkDim.x,0,o.height),this.bInGroup&&h.DisableHyperlinks(!0),h.SetRenderingEnabled(!0),we.Shape.BaseLine.prototype.TextDirectionCommon.call(this,h,r,!1,a),h.SetEditCallback(ye.opt.TextCallback,e),F.Debug("S.Connector: Output textElement:",h)}CreateShape(t,e){F.Debug("S.Connector: Input svgDoc:",t,"isHidden:",e);let i=(this.arraylist.styleflags&me.AStyles.CoManager)>0,o=this.IsChildOfAssistant(),n=this.IsFlowChartConnector(),s=this.IsGenoConnector(),a=this.objecttype===Se.FNObjectTypes.CauseEffectMain,r=me.ConnectorDefines.NSkip;if(ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),this.flags&Se.ObjFlags.NotVisible){if(this.hooks.length&&!i&&!o&&!n&&!a&&!s){let e=ws.GetObjectPtr(this.hooks[0].objid,!1);if(e&&!(e.flags&Se.ObjFlags.NotVisible)){let e=t.CreateShape(me.CSType.ShapeContainer);return this.CreateCollapseButton(t,e,!0),e.ExcludeFromExport(!0),F.Debug("S.Connector: Output shapeContainer:",e),e}}return F.Debug("S.Connector: Output null due to visibility."),null}let l=t.CreateShape(me.CSType.PolyPolyline);l.SetID(me.SVGElementClass.Shape);let h=t.CreateShape(me.CSType.PolyPolyline);h.SetID(me.SVGElementClass.Slop),h.ExcludeFromExport(!0);let c=this.Frame,p=this.StyleRecord,d=p.Line.Paint.Color,u=p.Line.Thickness,g=p.Line.Paint.Opacity,y=p.Line.LinePattern,S=c.width,m=c.height,b=t.CreateShape(me.CSType.ShapeContainer);return b.SetSize(S,m),b.SetPos(c.x,c.y),l.SetSize(S,m),l.SetFillColor("none"),l.SetStrokeColor(d),l.SetStrokeOpacity(g),l.SetStrokeWidth(u),0!==y&&l.SetStrokePattern(y),h.SetSize(S,m),h.SetStrokeColor("white"),h.SetFillColor("none"),h.SetOpacity(0),e?h.SetEventBehavior(me.EventBehavior.HiddenOut):h.SetEventBehavior(me.EventBehavior.None),h.SetStrokeWidth(u+me.Common.SlopShapeExtra),b.AddElement(l),b.AddElement(h),this.ApplyStyles(l,p),this.ApplyEffects(b,!1,!0),i||o||n||a||s||this.CreateCollapseButton(t,b,!1),b.isShape=!0,this.arraylist.hook.length>r&&this.AddIcons(t,b),F.Debug("S.Connector: Output shapeContainer:",b),b}AddIcon(t,e,i){if(F.Debug("S.Connector: Input svgDoc:",t,"parentElement:",e,"iconParams:",i),e){const t=this.IsFlowChartConnector(),o=this.Frame;this.nIcons,t&&(this.hooks.length>0?this.hooks[0].hookpt===me.HookPts.LL||this.hooks[0].hookpt===me.HookPts.LT?this.vertical?(i.y=this.iconShapeRightOffset+this.nIcons*this.iconSize,i.x=o.width-this.iconShapeBottomOffset-this.iconSize):(i.x=this.iconShapeRightOffset+this.nIcons*this.iconSize,i.y=o.height-this.iconShapeBottomOffset-this.iconSize):(i.x=o.width-this.iconShapeRightOffset-this.iconSize-this.nIcons*this.iconSize,i.y=o.height-this.iconShapeBottomOffset-this.iconSize):this.arraylist.hook.length>me.ConnectorDefines.NSkip+1?this.vertical?(i.y=this.arraylist.hook[me.ConnectorDefines.NSkip+1].startpoint.h+this.iconShapeRightOffset+this.nIcons*this.iconSize,i.x=o.width-this.iconShapeBottomOffset-this.iconSize):(i.x=this.arraylist.hook[me.ConnectorDefines.NSkip+1].startpoint.h+this.iconShapeRightOffset+this.nIcons*this.iconSize,i.y=o.height-this.iconShapeBottomOffset-this.iconSize):(i.x=o.width-this.iconShapeRightOffset-this.iconSize-this.nIcons*this.iconSize,i.y=o.height-this.iconShapeBottomOffset-this.iconSize));const n=this.GenericIcon(i);return this.nIcons++,e.AddElement(n),F.Debug("S.Connector: Output iconElement:",n),n}}PostCreateShapeCallback(t,e,i,o){if(F.Debug("S.Connector: PostCreateShapeCallback input:",t,e,i,o),!(this.flags&Se.ObjFlags.NotVisible)){let i,o,n=me.ConnectorDefines.NSkip,s=e.GetElementById(me.SVGElementClass.Shape),a=e.GetElementById(me.SVGElementClass.Slop),r=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null),l=!1;if(this.arraylist&&(o=(i=this.arraylist.hook.length)-n,o<0&&(o=0),0===o&&i>=n))for(let t=0;t<n;t++)this.arraylist.hook[t].id>=0&&o++;this.hooks.length&&(l=!0),!o&&l&&this.UpdateSVG(t,s,r),this.UpdateSVG(t,a,r);for(let h=0;h<i;h++)this.arraylist.hook[h].textid>=0&&this.AddSVGTextObject(t,e,h)}F.Debug("S.Connector: PostCreateShapeCallback output:",this)}SetRuntimeEffects(t){F.Debug("S.Connector: SetRuntimeEffects input:",t);const e=ye.opt.svgObjectLayer.GetElementById(this.BlockID);e&&this.ApplyEffects(e,t,!0),F.Debug("S.Connector: SetRuntimeEffects output:",this)}ApplyStyles(t,e){F.Debug("S.Connector: ApplyStyles input - shape:",t,"styleRecord:",e);const i=e.Line.Paint.FillType;if(t.SetStrokeOpacity(e.Line.Paint.Opacity),i===Se.FillTypes.Gradient){const i=this.CreateGradientRecord(e.Line.Paint.GradientFlags,e.Line.Paint.Color,e.Line.Paint.Opacity,e.Line.Paint.EndColor,e.Line.Paint.EndOpacity);t.SetGradientStroke(i)}else if(i===Se.FillTypes.RichGradient)t.SetGradientStroke(this.CreateRIchGradientRecord(e.Line.Paint.GradientFlags));else if(i===Se.FillTypes.Texture){const i={url:"",scale:e.Line.Paint.TextureScale.Scale,alignment:e.Line.Paint.TextureScale.AlignmentScalar},o=e.Line.Paint.Texture;i.dim=ye.opt.TextureList.Textures[o].dim,i.url=ye.opt.TextureList.Textures[o].ImageURL,i.url,t.SetTextureStroke(i)}else i===Se.FillTypes.Solid?t.SetStrokeColor(e.Line.Paint.Color):t.SetStrokeColor("none");F.Debug("S.Connector: ApplyStyles output - shape:",t)}CreateRIchGradientRecord(t){throw new Error("Method not implemented.")}GetDimensionPoints(){F.Debug("S.Connector: GetDimensionPoints input:",{Dimensions:this.Dimensions,Frame:this.Frame});let t,e=[],i=[],o=0,n=0,s=0,a=0,r={x:0,y:0},l={x:0,y:0};if(this.Dimensions&Se.DimensionFlags.EndPts)e.push(new De(this.StartPoint.x-this.Frame.x,this.StartPoint.y-this.Frame.y)),e.push(new De(this.EndPoint.x-this.Frame.x,this.EndPoint.y-this.Frame.y));else if(this.Dimensions&Se.DimensionFlags.Total){for(i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null),o=1;o<i.length;o++)s=Math.abs(i[o-1].x-i[o].x),a=Math.abs(i[o-1].y-i[o].y),n+=Math.sqrt(s*s+a*a);let h={x:this.Frame.width/2,y:this.Frame.height/2};r.x=h.x-n/2,r.y=h.y,e.push(new De(r.x,r.y)),l.x=h.x+n/2,l.y=h.y,e.push(new De(l.x,l.y)),t=ye.opt.GetCounterClockwiseAngleBetween2Points(new De(0,0),new De(this.Frame.width,this.Frame.height)),si.RotatePointsAboutPoint(h,t,e)}else e=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,null);return F.Debug("S.Connector: GetDimensionPoints output:",e),e}FindTextLabel(t){F.Debug("S.Connector: _findTextLabel input:",t);const e=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),i=me.ConnectorDefines.NSkip;let o={},n=-1;const s=me.AStyles,a=Boolean(this.arraylist.styleflags&s.Linear),r=Boolean(this.arraylist.styleflags&s.FlowConn);if(t){const s=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),r=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);if(r){const e=r.GetTargetForEvent(t),o=e.GetID();o!==me.SVGElementClass.TextBackground&&o!==me.SVGElementClass.Text||(n=parseInt(e.GetUserData(),10),!a&&n<i&&(n=i))}if(n<0&&this.arraylist.hook.length>=i){const t=si.LineDStyleHit(e,s,this.StyleRecord.Line.Thickness,0,o);void 0!==o.lpHit&&t&&(n=Math.round((o.lpHit-.1)/2),a&&n===i&&(this.arraylist.hook.length>=i+1?n++:n=-1))}}return n<0&&(n=this.arraylist.lasttexthook),n<i&&this.arraylist.hook.length>=i&&(a&&r?this.hooks.length>0?n=this.hooks[0].hookpt===me.HookPts.LR||this.hooks[0].hookpt===me.HookPts.LT?me.ConnectorDefines.ACr:me.ConnectorDefines.ACl:this.arraylist.hook.length>=i+1&&(n=i+1):n<0&&this.arraylist.hook.length>=i&&(n=i)),F.Debug("S.Connector: _findTextLabel output:",n),n}SetTextObject(t){F.Debug("S.Connector: SetTextObject input textId:",t);const e=me.ConnectorDefines.NSkip;let i=this.arraylist.lasttexthook;const o=this.arraylist.hook.length,n=Boolean(this.arraylist.styleflags&me.AStyles.Linear),s=Vo.TextAlignToWin(this.TextAlign),a=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);return this.StyleRecord.Fill.Paint.Color=a.background.Paint.Color,s.vjust===bi.TextJust.Center?(this.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Solid,this.StyleRecord.Fill.Paint.Opacity=1):this.StyleRecord.Fill.Paint.FillType=Se.FillTypes.Transparent,-2===t?(F.Debug("S.Connector: SetTextObject output: false (textId is -2)"),!1):o>=e?(n?i=this.FindTextLabel():i<e&&(i=e),i>=o&&(i=o-1),this.arraylist.hook[i].textid=t,this.DataID=t,this.arraylist.lasttexthook=i,t<0&&(this.arraylist.lasttexthook=-1),F.Debug("S.Connector: SetTextObject output: true"),!0):(F.Debug("S.Connector: SetTextObject output: false"),!1)}GetTextObject(t,e,i){let o;if(F.Debug("S.Connector: GetTextObject input:",{inputEvent:t,hookContext:i}),null===t&&null!==i?o=i.hookindex:(o=this.FindTextLabel(t),null!==i&&(i.hookindex=o)),o<0)return F.Debug("S.Connector: GetTextObject output:",null),null;const n=this.arraylist.hook[o];if(void 0===n)return F.Debug("S.Connector: GetTextObject output:",null),null;this.DataID=n.textid,this.arraylist.lasttexthook=o;const s=ye.opt.svgObjectLayer.GetElementById(this.BlockID);return s&&(s.textElem=s.GetElementById(me.SVGElementClass.Text,o)),F.Debug("S.Connector: GetTextObject output:",n.textid),n.textid}AdjustTextEditBackground(t,e){if(F.Debug("S.Connector: AdjustTextEditBackground input - newColor:",t,"svgDoc:",e),-1!==this.DataID){const t=this.arraylist.hook.length;if(this.arraylist.lasttexthook>=0&&this.arraylist.lasttexthook<t){const t=this.arraylist.hook[this.arraylist.lasttexthook],i=e||ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(i){const o=i.GetElementById(me.SVGElementClass.TextBackground,this.arraylist.lasttexthook),n=i.GetElementById(me.SVGElementClass.Text,this.arraylist.lasttexthook);if(n&&o){const i=null==e;we.Shape.BaseLine.prototype.TextDirectionCommon.call(this,n,o,i,t)}}}}F.Debug("S.Connector: AdjustTextEditBackground output - DataID:",this.DataID)}UpdateSVG(t,e,i){F.Debug("S.Connector: UpdateSVG input:",{svgDoc:t,shapeElement:e,polyPoints:i}),e.Clear();const o=me.AStyles,n=!!(this.arraylist.styleflags&o.Linear);let s=ye.arrowHlkTable[this.StartArrowID],a=ye.arrowHlkTable[this.EndArrowID];const r=ye.arrowHsTable[this.ArrowSizeIndex];0===s.id&&(s=null),0===a.id&&(a=null),e.SetArrowheads(s,r,a,r,this.StartArrowDisp,this.EndArrowDisp);const l=i.length;let h=0;for(;h<l;){if(i[h].curvex||i[h].curvey){let t,o=[],s=1,a=1,r=this.vertical;n&&(r=!r),r?(i[h].curvey>0?(t=i[h].curvey,i[h].curvex>0&&(a=-1),s=-1):(t=i[h].curvey,i[h].curvex<0&&(a=-1),i[h].curvey<0&&(s=-1)),o=ye.opt.LinesAddCurve(r,s,a,i[h].x+i[h].curvex,i[h].y,t)):(i[h].curvex>0?(t=i[h].curvex,i[h].curvey>0&&(a=-1),s=-1):(t=i[h].curvex,i[h].curvey<0&&(a=-1),i[h].curvex<0&&(s=-1)),o=ye.opt.LinesAddCurve(r,s,a,i[h].x,i[h].y+i[h].curvey,t)),e.AddPolyLine(o,!1,!1)}let t=[];t.push({x:i[h].x,y:i[h].y});const o=i[h].arrowhead;let s=!1;for(h++;h<l&&!i[h].moveto;)t.push({x:i[h].x,y:i[h].y}),(h===l-1||i[h+1].moveto)&&(s=i[h].arrowhead),h++;t.length>1&&e.AddPolyLine(t,o,s)}e.BuildPath(),F.Debug("S.Connector: UpdateSVG output:",e)}CreateCollapseButton(t,e,i){let o,n;F.Debug("S.Connector: CreateCollapseButton input:",{svgDocument:t,parentElement:e,adjustCollapse:i});const s=me.Common.CKnobSize,a=me.AStyles,r=0!=(this.arraylist.styleflags&a.ReverseCol),l=0!=(this.arraylist.styleflags&a.BothSides)||0==(this.arraylist.styleflags&a.PerpConn),h=0!=(this.arraylist.styleflags&a.Radial)&&!l,c=s;let p=0,d=0;const u={};n=this.arraylist?this.arraylist.hook.length-me.ConnectorDefines.NSkip:0,n<0&&(n=0);let g,y=!1;if(this.hooks.length>0){switch(y=!0,g=this.HookToPoint(this.hooks[0].hookpt,u),h?this.vertical?(d=0,p=s):(p=0,d=s):0===u.width?d=s:p=s,this.hooks[0].hookpt){case me.HookPts.LR:case me.HookPts.LB:p=-p,d=-d}r&&(d=-d),g.x+=p,g.y+=d}if(0!==n&&y){const n={svgDoc:t,iconSize:c,imageURL:null,iconID:me.Common.HitAreas,userData:me.HitAreaType.ConnExpand,cursorType:ze.CursorType.AddPlus,x:g.x-this.Frame.x-c/2,y:g.y-this.Frame.y-c/2};this.extraflags&me.ExtraFlags.CollapseConn?(n.imageURL=me.Common.ConPlusPath,n.userData=me.HitAreaType.ConnExpand):(n.imageURL=me.Common.ConMinusPath,n.userData=me.HitAreaType.ConnCollapse),o=this.GenericIcon(n),i&&(e.SetSize(c,c),e.SetPos(this.Frame.x,this.Frame.y),e.isShape=!0),e.AddElement(o)}F.Debug("S.Connector: CreateCollapseButton output:",{collapseButton:o})}CreateActionTriggers(t,e,i,o){F.Debug("S.Connector: CreateActionTriggers input:",{svgDoc:t,targetId:e,extraParam:i,refId:o});const n=t.CreateShape(me.CSType.Group),s=me.Common.KnobSize,a=me.AStyles,r=this.arraylist.styleflags&a.ReverseCol,l=me.ConnectorDefines;let h=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(h*=2);const c=s/h,p=this.arraylist&&this.arraylist.hook?this.arraylist.hook.length:0;if(p<=l.NSkip)return F.Debug("S.Connector: CreateActionTriggers output:",n),n;const d=(this.arraylist.styleflags&a.BothSides)>0||0==(this.arraylist.styleflags&a.PerpConn),u=Boolean(this.arraylist.styleflags&a.Linear),g=this.Frame;let y=g.width+c,S=g.height+c;const m=Oe.DeepCopy(g);m.x-=c/2,m.y-=c/2,m.width+=c,m.height+=c;const b=ws.GetObjectPtr(e,!1);let D,f;this.vertical?(D=ze.CursorType.ResizeTB,f=ze.CursorType.ResizeLR):(D=ze.CursorType.ResizeLR,f=ze.CursorType.ResizeTB);const x=r?-1:1;let C={svgDoc:t,shapeType:me.CSType.Rect,knobSize:c,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",cursorType:D};e!==o&&(C.fillColor="white",C.fillOpacity=0,C.strokeSize=1,C.strokeColor="black"),this.flags&Se.ObjFlags.Lock?(C.fillColor="gray",C.locked=!0):this.NoGrow()&&(C.fillColor="red",C.strokeColor="red",f=ze.CursorType.Default,D=ze.CursorType.Default);{C.x=this.StartPoint.x-g.x,C.y=this.StartPoint.y-g.y,C.knobID=me.ActionTriggerType.LineStart;const t=this.GenericKnob(C);n.AddElement(t);var P=t}{C.x=this.EndPoint.x-g.x,C.y=this.EndPoint.y-g.y,C.knobID=me.ActionTriggerType.LineEnd;const t=this.GenericKnob(C);n.AddElement(t);var T=t}if(b&&b.hooks&&p>1)for(let v=0;v<b.hooks.length;v++){const t=Oe.DeepCopy(C);let e;if(d){switch(b.hooks[v].hookpt){case me.HookPts.LL:case me.HookPts.LT:e=me.ConnectorDefines.ACl,n.RemoveElement(P);break;default:e=me.ConnectorDefines.ACr,n.RemoveElement(T)}C.cursorType=D,C.shapeType=me.CSType.Oval,C.fillColor="white",C.fillOpacity=.01,C.strokeSize=1,C.strokeColor="green"}else e=me.ConnectorDefines.ACl,C.cursorType=f;if(e>0){const i=this.arraylist.hook[e];this.vertical?(C.x=i.startpoint.v+this.StartPoint.x-g.x,C.y=i.startpoint.h+this.StartPoint.y-g.y,d&&(C.y+=x*(i.endpoint.h-i.startpoint.h)/2)):(C.x=i.startpoint.h+this.StartPoint.x-g.x,C.y=i.startpoint.v+this.StartPoint.y-g.y,d&&(C.x+=x*(i.endpoint.h-i.startpoint.h)/2)),C.knobID=me.ActionTriggerType.ConnectorHook;const o=this.GenericKnob(C);o.SetUserData(e),n.AddElement(o),C=Oe.DeepCopy(t)}}if(!u&&this.objecttype!==Se.FNObjectTypes.CauseEffectMain){C.shapeType=me.CSType.Rect,C.cursorType=f;for(let t=l.NSkip;t<p;t++){const e=this.arraylist.hook[t];this.vertical?(C.x=e.endpoint.v+this.StartPoint.x-g.x,C.y=x*e.endpoint.h+this.StartPoint.y-g.y):(C.x=e.endpoint.h+this.StartPoint.x-g.x,C.y=e.endpoint.v+this.StartPoint.y-g.y),C.knobID=me.ActionTriggerType.ConnectorRerp;const i=this.GenericKnob(C);i.SetUserData(t-l.NSkip),n.AddElement(i)}}const O=this.PrGetStubIndex();for(let v=l.NSkip+1;v<p&&(u||d||!(p-l.NSkip<=2))&&!(d&&++v>=p);v++){const t=this.arraylist.hook[v-1],e=this.arraylist.hook[v];C.cursorType=D,C.shapeType=me.CSType.Oval,C.fillColor="white",C.fillOpacity=.01,C.strokeSize=1,C.strokeColor="green",this.vertical?u?(O===l.ACr?C.y=(e.startpoint.h+e.endpoint.h)/2+this.StartPoint.y-g.y-e.extra/2:C.y=(e.startpoint.h+e.endpoint.h)/2+this.StartPoint.y-g.y+e.extra/2,C.x=t.startpoint.v+this.StartPoint.x-g.x):(C.y=x*((t.endpoint.h+e.endpoint.h)/2)+this.StartPoint.y-g.y+x*e.extra/2,C.x=t.startpoint.v+this.StartPoint.x-g.x+(e.startpoint.v-t.startpoint.v)/2):u?(O===l.ACr?C.x=(e.startpoint.h+e.endpoint.h)/2+this.StartPoint.x-g.x-e.extra/2:C.x=(e.startpoint.h+e.endpoint.h)/2+this.StartPoint.x-g.x+e.extra/2,C.y=t.startpoint.v+this.StartPoint.y-g.y):(C.x=(t.endpoint.h+e.endpoint.h)/2+this.StartPoint.x-g.x+e.extra/2,C.y=t.startpoint.v+this.StartPoint.y-g.y),C.knobID=me.ActionTriggerType.ConnectorAdj;const i=this.GenericKnob(C);if(i.SetUserData(v),n.AddElement(i),this.AllowTextEdit()){const t=i.DOMElement(),e=Hammer(t),o=Evt_ShapeDoubleTapFactory(this);e.on("doubletap",o)}}return n.SetSize(y,S),n.SetPos(m.x,m.y),n.isShape=!0,n.SetID(me.Common.Action+e),F.Debug("S.Connector: CreateActionTriggers output:",n),n}CreateConnectHilites(t,e,i,o,n,s){F.Debug("S.Connector: CreateConnectHilites input:",{svgDoc:t,targetElement:e,hookIndex:n});const a=me.AStyles,r=t.CreateShape(me.CSType.Group);let l,h,c=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(c*=2);const p=me.Common.ConnPointDim/c,d=[{x:0,y:0},{x:0,y:0}];let u=this.GetTargetPoints(null,Se.HookFlags.LcNoSnaps|Se.HookFlags.LcHookNoExtra,n);if(null!=u){const i=this.GetPerimPts(e,u,null,!0,null,n),o=this.arraylist.hook.length-me.ConnectorDefines.NSkip,s=this.Frame;let c=s.width,g=s.height;const y=Oe.DeepCopy(s);y.x-=p/2,y.y-=p/2,y.width+=p,y.height+=p,c+=p,g+=p;const S={svgDoc:t,shapeType:me.CSType.Oval,x:0,y:0,knobSize:p,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",KnobID:0,cursorType:ze.CursorType.Anchor},m=Boolean(this.arraylist.styleflags&me.AStyles.Linear),b=Boolean(this.arraylist.styleflags&a.BothSides)||0==(this.arraylist.styleflags&a.PerpConn),D=Boolean(this.arraylist.styleflags&a.Radial)&&!b,f=Boolean(this.arraylist.styleflags&a.BothSides),x=this.arraylist.angle;let C;D&&o>0&&(C=this.vertical?{x:this.StartPoint.x-this.Frame.x,y:this.StartPoint.y-this.Frame.y+this.arraylist.hook[me.ConnectorDefines.ACl].startpoint.h}:{x:this.StartPoint.x-this.Frame.x+this.arraylist.hook[me.ConnectorDefines.ACl].startpoint.h,y:this.StartPoint.y-this.Frame.y});for(let t=0;t<i.length;t++){S.x=i[t].x-this.Frame.x,S.y=i[t].y-this.Frame.y,d.length=2,l=this.GenericKnob(S);let e=!1;if(this.vertical){if(0===t)if(o<=0)b?(d[0].x=this.StartPoint.x-this.Frame.x+p/2,d[0].y=this.StartPoint.y-this.Frame.y,d[1].x=this.StartPoint.x-this.Frame.x+p/2,d[1].y=this.EndPoint.y-this.Frame.y,d.push(new De(S.x+p/2,S.y+p/2)),e=!0):(d[0].x=this.StartPoint.x-this.Frame.x,d[0].y=this.StartPoint.y-this.Frame.y+p/2,d[1].x=this.EndPoint.x-this.Frame.x,d[1].y=this.StartPoint.y-this.Frame.y+p/2,d.push(new De(S.x+p/2,S.y+p/2)),e=!0);else if(D)d[0].x=C.x,d[0].y=C.y,d[1].x=S.x+p/2,d[1].y=S.y+p/2,e=!0;else{let t=0;this.arraylist.angle&&(t=S.y*this.arraylist.angle),d[0].x=this.StartPoint.x-this.Frame.x+p/2+t,d[0].y=this.StartPoint.y-this.Frame.y,d[1].x=this.StartPoint.x-this.Frame.x+p/2+t,d[1].y=S.y+p/2,d.push(new De(S.x+p/2,S.y+p/2)),(f||x)&&d.shift(),e=!0}else if(t!==o||D)if(m)i[t].x!==this.StartPoint.x&&(d[0].x=this.StartPoint.x-this.Frame.x+p/2,d[0].y=S.y+p/2,d[1].x=S.x+p/2,d[1].y=S.y+p/2,e=!0);else if(D){switch(u[t].y){case me.ConnectorDefines.Above:d[0].x=this.StartPoint.x-this.Frame.x-this.arraylist.ht,d[0].y=S.y+p/2,d[1].x=S.x+p/2,d[1].y=S.y+p/2;break;case me.ConnectorDefines.Below:d[0].x=this.StartPoint.x-this.Frame.x+this.arraylist.ht,d[0].y=S.y+p/2,d[1].x=S.x+p/2,d[1].y=S.y+p/2;break;default:d[0].x=C.x,d[0].y=C.y,d[1].x=S.x+p/2,d[1].y=S.y+p/2}e=!0}else{let t=0;this.arraylist.angle&&(t=S.y*this.arraylist.angle),d[0].x=this.StartPoint.x-this.Frame.x+p/2+t,d[0].y=S.y+p/2,d[1].x=S.x+p/2,d[1].y=S.y+p/2,e=!0}else if(this.arraylist.angle){let t=S.y*this.arraylist.angle;d[0].x=this.StartPoint.x-this.Frame.x+p/2+t,d[0].y=this.EndPoint.y-this.Frame.y,d[1].x=this.StartPoint.x-this.Frame.x+p/2+t,d[1].y=S.y+p/2,d.push(new De(S.x+p/2,S.y+p/2)),(f||x)&&d.shift(),e=!0}}else if(0===t)if(o<=0)b?(d[0].x=this.StartPoint.x-this.Frame.x,d[0].y=this.StartPoint.y-this.Frame.y+p/2,d[1].x=this.EndPoint.x-this.Frame.x,d[1].y=this.StartPoint.y-this.Frame.y+p/2,d.push(new De(S.x+p/2,S.y+p/2)),e=!0):(d[0].x=this.StartPoint.x-this.Frame.x+p/2,d[0].y=this.StartPoint.y-this.Frame.y,d[1].x=this.StartPoint.x-this.Frame.x+p/2,d[1].y=this.EndPoint.y-this.Frame.y,d.push(new De(S.x+p/2,S.y+p/2)),e=!0);else if(D)d[0].y=C.y,d[0].x=C.x,d[1].y=S.y+p/2,d[1].x=S.x+p/2,e=!0;else{let t=0;this.arraylist.angle&&(t=S.x*this.arraylist.angle),d[0].y=this.StartPoint.y-this.Frame.y+p/2+t,d[0].x=this.StartPoint.x-this.Frame.x,d[1].y=this.StartPoint.y-this.Frame.y+p/2+t,d[1].x=S.x+p/2,d.push(new De(S.x+p/2,S.y+p/2)),(f||x)&&d.shift(),e=!0}else if(t!==o||D)if(m)i[t].y!==this.StartPoint.y&&(d[0].y=this.StartPoint.y-this.Frame.y+p/2,d[0].x=S.x+p/2,d[1].y=S.y+p/2,d[1].x=S.x+p/2,e=!0);else if(D){switch(u[t].y){case me.ConnectorDefines.Above:d[0].y=this.StartPoint.y-this.Frame.y-this.arraylist.ht,d[0].x=S.x+p/2,d[1].y=S.y+p/2,d[1].x=S.x+p/2;break;case me.ConnectorDefines.Below:d[0].y=this.StartPoint.y-this.Frame.y+this.arraylist.ht,d[0].x=S.x+p/2,d[1].y=S.y+p/2,d[1].x=S.x+p/2;break;default:d[0].y=C.y,d[0].x=C.x,d[1].y=S.y+p/2,d[1].x=S.x+p/2}e=!0}else d[0].y=this.StartPoint.y-this.Frame.y+p/2,d[0].x=S.x+p/2,d[1].y=S.y+p/2,d[1].x=S.x+p/2,e=!0;else if(this.arraylist.angle){let t=S.x*this.arraylist.angle;d[0].y=this.StartPoint.y-this.Frame.y+p/2+t,d[0].x=this.EndPoint.x-this.Frame.x,d[1].y=this.StartPoint.y-this.Frame.y+p/2+t,d[1].x=S.x+p/2,d.push(new De(S.x+p/2,S.y+p/2)),(f||x)&&d.shift(),e=!0}r.AddElement(l),e&&(h=ye.opt.svgDoc.CreateShape(me.CSType.Polyline),h&&(h.SetPoints(d),h.SetFillColor("none"),h.SetStrokeColor("black"),h.SetStrokePattern("2,2"),h.SetStrokeWidth(1),r.AddElement(h)))}return r.SetSize(c,g),r.SetPos(y.x,y.y),r.isShape=!0,r.SetID("hilite_"+e),F.Debug("S.Connector: CreateConnectHilites output:",r),r}}SetCursors(){F.Debug("S.Connector: SetCursors input");const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(we.Shape.BaseDrawObject.prototype.SetCursors.call(this),Ps.GetEditMode()===Se.EditState.Default&&t){const e=t.GetElementById(me.Common.HitAreas);e&&e.SetCursor(ze.CursorType.AddPlus)}F.Debug("S.Connector: SetCursors output")}GetArrowheadSelection(t){return F.Debug("S.Connector: GetArrowheadSelection input:",t),t&&(t.StartArrowID=this.StartArrowID,t.StartArrowDisp=this.StartArrowDisp,t.EndArrowID=this.EndArrowID,t.EndArrowDisp=this.EndArrowDisp,t.ArrowSizeIndex=this.ArrowSizeIndex),F.Debug("S.Connector: GetArrowheadSelection output:",t),!0}RightClick(t){const e=ye.opt.svgDoc.ConvertWindowToDocCoords(t.gesture.center.clientX,t.gesture.center.clientY),i=ye.opt.svgObjectLayer.FindElementByDOMElement(t.currentTarget);if(!Qo.SelectObjectFromClick(t,i))return!1;const o=i.GetID(),n=ws.GetObjectPtr(o,!1);if(n){if(n.GetTextObject()>=0){const e=i.textElem;if(e){e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY)>=0&&on.ActivateTextEdit(i,t,!0)}}const e=me.AStyles;n.arraylist.styleflags,e.CoManager,n.arraylist.styleflags,e.PerpConn,n.arraylist.hook.length}if(ye.opt.rClickParam=new Le,ye.opt.rClickParam.targetId=i.GetID(),ye.opt.rClickParam.hitPoint.x=e.x,ye.opt.rClickParam.hitPoint.y=e.y,ye.opt.rClickParam.locked=(this.flags&Se.ObjFlags.Lock)>0,null!=on.GetActiveTextEdit()){const e=ye.opt.svgDoc.GetActiveEdit();e&&e.GetSpellAtLocation(t.gesture.center.clientX,t.gesture.center.clientY),Ts.ShowContextMenu(!0,"Connector","Editable")}else $n.ShowContextMenu(!0,"Connector","Default")}HitAreaClick(t){F.Debug("S.Connector: HitAreaClick input:",t),ye.opt.CloseEdit();let e=this;switch(t){case me.HitAreaType.ConnCollapse:e.CollapseConnector(!0,!1,!0);break;case me.HitAreaType.ConnExpand:e.CollapseConnector(!1,!1,!0)}Zo.FindTreeTop(e,Ee.LinkFlags.Move,{topconnector:-1,topshape:-1,foundtree:!1}),xs.CompleteOperation(),F.Debug("S.Connector: HitAreaClick output")}GetPolyPoints(t,e,i,o,n){let s,a,r,l,h,c,p,d,u,g,y,S,m=[],b={},D=me.AStyles;const f=this.arraylist.styleflags&D.CoManager,x=(this.arraylist.styleflags&D.PerpConn)>0,C=this.arraylist.styleflags&D.StartLeft,P=this.IsAsstConnector(),T=me.ConnectorDefines.NSkip,O=this.arraylist.styleflags&D.ReverseCol,v=this.arraylist.styleflags&me.AStyles.Linear,w=this.arraylist.styleflags&me.AStyles.FlowConn&&v,k=0!==this.arraylist.angle,L=me.ConnectorDefines.ACl,A=this.StartArrowID>0,I=0===this.EndArrowID&&A;let E=!1;const F=this.arraylist.curveparam;let G=0;a=this.arraylist.hook.length,e?(b.x=this.StartPoint.x-this.Frame.x,b.y=this.StartPoint.y-this.Frame.y):b=this.StartPoint;const R=a==T+1&&0==(this.arraylist.styleflags&D.PerpConn),j={index:-1,left:!1};if(this.AllowCurveOnConnector(j)&&(a>T+1||R)&&F>0&&!i){G=F;let t=this.arraylist.ht-function(t){let e,i=0;for(s=0;s<a;s++)if(e=t.arraylist.hook[s],e.comanagerht>i){i=e.comanagerht;break}return i}(this);t<0&&(t=0),P&&!this.vertical?G>this.arraylist.wd&&(G=this.arraylist.wd):G>t&&(G=t)}if(this.vertical){for(d=O?-1:1,h=this.arraylist.ht,s=0;s<a;s++){const t=this.arraylist.hook[s];if(u=ve.IsEqual(t.startpoint.v+b.x,t.endpoint.v+b.x)&&ve.IsEqual(d*t.startpoint.h+b.y,d*t.endpoint.h+b.y),g=(s>=T||w)&&!f&&!P&&!u&&!E,s!==L||!I||u||w||k||(g=!0,E=!0),s===T&&g&&A&&w&&(g=!1),g&&s===L){let e=!1;w&&a>T&&!A&&(y=this.arraylist.hook[T],e=!ve.IsEqual(y.startpoint.h+b.x,y.endpoint.h+b.x)&&ve.IsEqual(y.startpoint.v+b.y,y.endpoint.v+b.y)),e&&(g=!1),P&&G&&s===L?(m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!0,g)),t.endpoint.v<0?m.push(new xa(t.startpoint.v+b.x-G,d*t.startpoint.h+b.y,!1,g)):m.push(new xa(t.startpoint.v+b.x+G,d*t.startpoint.h+b.y,!1,g))):G&&s===L&&R?(m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!0,g)),m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y-d*G,!1,g))):(m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!0,g)),m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y,!1,g)))}else if(s===j.index&&G){let e=1;this.arraylist.hook[L].endpoint.v>0&&(e=-1),j.left?(m.push(new xa(t.startpoint.v+b.x,t.startpoint.h+b.y+G,!0,g,-e*G,G)),m.push(new xa(t.endpoint.v+b.x,t.endpoint.h+b.y-2*G,!1,g))):(m.push(new xa(t.startpoint.v+b.x,t.startpoint.h+b.y+G,!0,g,-e*G,-G)),m.push(new xa(t.endpoint.v+b.x,t.endpoint.h+b.y,!1,g)))}else if(G&&s===L&&R)m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y-d*G,!0,g)),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!1,g));else if(G&&0===s){if(t.endpoint.v===t.startpoint.v&&t.endpoint.h===t.startpoint.h&&P){m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y,!0,g)),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!1,g));continue}x?m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y+G,!0,g)):R?m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y-G,!0,g)):m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y,!0,g));let e=d*G;R&&(e=G),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y-e,!1,g))}else G&&s===T&&x?(S=G,t.endpoint.h===t.startpoint.h&&t.endpoint.v===t.startpoint.v&&(S=0),t.endpoint.v<0?m.push(new xa(t.startpoint.v+b.x-S,d*t.startpoint.h+b.y,!0,g,S,S)):m.push(new xa(t.startpoint.v+b.x+S,d*t.startpoint.h+b.y,!0,g,-S,S)),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!1,g))):G&&s===a-1&&0===v?(t.endpoint.v<0?m.push(new xa(t.startpoint.v+b.x-G,d*t.startpoint.h+b.y,!0,g,G,-d*G)):m.push(new xa(t.startpoint.v+b.x+G,d*t.startpoint.h+b.y,!0,g,-G,-d*G)),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!1,g))):P&&G&&s===L?(t.endpoint.v<0?m.push(new xa(t.startpoint.v+b.x-G,d*t.startpoint.h+b.y,!0,g)):m.push(new xa(t.startpoint.v+b.x+G,d*t.startpoint.h+b.y,!0,g)),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!1,g))):(m.push(new xa(t.startpoint.v+b.x,d*t.startpoint.h+b.y,!0,g)),m.push(new xa(t.endpoint.v+b.x,d*t.endpoint.h+b.y,!1,g)))}if(f)for(C?(r=this.arraylist.coprofile.v,p=-1):(r=this.arraylist.coprofile.vdist,p=1),s=0;s<a;s++){const t=this.arraylist.hook[s];c=C?t.pr.v:t.pr.vdist,l=c?r-(c+2*h):0,G&&0===s?(m.push(new xa(t.startpoint.v+b.x+p*r,t.startpoint.h+b.y+G,!0,!1)),m.push(new xa(-t.endpoint.v-p*l+b.x+p*r,t.endpoint.h+b.y-G,!1,!1))):G&&s===T?(t.endpoint.v<0?m.push(new xa(t.startpoint.v+b.x+p*r+G,t.startpoint.h+b.y,!0,!1,-G,G)):m.push(new xa(t.startpoint.v+b.x+p*r-G,t.startpoint.h+b.y,!0,!1,G,G)),m.push(new xa(-t.endpoint.v-p*l+b.x+p*r,t.endpoint.h+b.y,!1,!1))):G&&s===a-1?(t.endpoint.v<0?m.push(new xa(t.startpoint.v+b.x+p*r+G,t.startpoint.h+b.y,!0,!1,-G,-G)):m.push(new xa(t.startpoint.v+b.x+p*r-G,t.startpoint.h+b.y,!0,!1,G,-G)),m.push(new xa(-t.endpoint.v-p*l+b.x+p*r,t.endpoint.h+b.y,!1,!1))):(m.push(new xa(t.startpoint.v+b.x+p*r,t.startpoint.h+b.y,!0,!1)),m.push(new xa(-t.endpoint.v-p*l+b.x+p*r,t.endpoint.h+b.y,!1,!1)))}}else for(h=this.arraylist.ht,s=0;s<a;s++)this.arraylist.hook[s];return m}OffsetShape(t,e,i){F.Debug("S.Connector: OffsetShape input:",{offsetX:t,offsetY:e,additionalParam:i}),this.Frame.x+=t,this.Frame.y+=e,this.r.x+=t,this.r.y+=e,this.inside.x+=t,this.inside.y+=e,this.trect.x+=t,this.trect.y+=e,this.StartPoint.x+=t,this.StartPoint.y+=e,this.EndPoint.x+=t,this.EndPoint.y+=e,F.Debug("S.Connector: OffsetShape output:",this)}CalcFrame(){F.Debug("S.Connector: CalcFrame input");let t=[];const e=this.arraylist.styleflags&me.AStyles.Linear;this.arraylist?(t=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!0,!1,null),e&&t.push(this.EndPoint),t&&t.length&&ve.GetPolyRect(this.Frame,t)):this.Frame=ve.Pt2Rect(this.StartPoint,this.EndPoint),this.UpdateFrame(this.Frame),F.Debug("S.Connector: CalcFrame output:",this.Frame)}GetDimensions(){F.Debug("S.Connector: GetDimensions input");let t={};const e=this.arraylist.styleflags&me.AStyles.Linear,i=(this.arraylist.styleflags&me.AStyles.BothSides)>0;return this.vertical?(t.y=this.arraylist.hook[0].endpoint.h-this.arraylist.hook[0].startpoint.h,t.x=e?0:this.arraylist.ht,i&&!e&&(t.x/=2)):(t.x=this.arraylist.hook[0].endpoint.h-this.arraylist.hook[0].startpoint.h,t.y=e?0:this.arraylist.ht,i&&!e&&(t.y/=2)),F.Debug("S.Connector: GetDimensions output:",t),t}CanSnapToShapes(){F.Debug("S.Connector: CanSnapToShapes input");const t=this.IsFlowChartConnector(),e=0===this.hooks.length,i=this.arraylist.hook.length===me.ConnectorDefines.NSkip+1;if(t&&e&&i){const t=this.arraylist.hook[me.ConnectorDefines.NSkip].id;return F.Debug("S.Connector: CanSnapToShapes output:",t),t}return F.Debug("S.Connector: CanSnapToShapes output: -1"),-1}ScaleObject(t,e,i,o,n,s,a){F.Debug("S.Connector: ScaleObject input:",{scaleX:t,scaleY:e,offsetX:i,offsetY:o,primaryScale:n,secondaryScale:s,extraFactor:a}),we.Shape.BaseLine.prototype.ScaleObject.call(this,t,e,i,o,n,s,a);const r=this.arraylist.styleflags&me.AStyles.BothSides||0==(this.arraylist.styleflags&me.AStyles.PerpConn),l=me.ConnectorDefines,h=this.arraylist.hook.length,c=l.NSkip;this.vertical?(this.arraylist.ht=this.arraylist.ht*n,this.arraylist.wd=this.arraylist.wd*s,h>=c&&(r?(this.arraylist.hook[l.ACl].gap&&(this.arraylist.hook[l.ACl].gap=this.arraylist.hook[l.ACl].gap*s),this.arraylist.hook[l.ACr].gap&&(this.arraylist.hook[l.ACr].gap=this.arraylist.hook[l.ACr].gap*s)):(this.arraylist.hook[l.ACl].gap&&(this.arraylist.hook[l.ACl].gap=this.arraylist.hook[l.ACl].gap*n),this.arraylist.hook[l.ACr].gap&&(this.arraylist.hook[l.ACr].gap=this.arraylist.hook[l.ACr].gap*n)))):(this.arraylist.wd=this.arraylist.wd*n,this.arraylist.ht=this.arraylist.ht*s,h>=c&&(r?(this.arraylist.hook[l.ACl].gap&&(this.arraylist.hook[l.ACl].gap=this.arraylist.hook[l.ACl].gap*n),this.arraylist.hook[l.ACr].gap&&(this.arraylist.hook[l.ACr].gap=this.arraylist.hook[l.ACr].gap*n)):(this.arraylist.hook[l.ACl].gap&&(this.arraylist.hook[l.ACl].gap=this.arraylist.hook[l.ACl].gap*s),this.arraylist.hook[l.ACr].gap&&(this.arraylist.hook[l.ACr].gap=this.arraylist.hook[l.ACr].gap*s)))),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),F.Debug("S.Connector: ScaleObject output:",{arraylist:this.arraylist,rflags:this.rflags})}SetSize(t,e,i){let o,n,s;F.Debug("S.Connector: SetSize input:",{primarySize:t,secondarySize:e,extraInfo:i});let a,r=this.GetDimensions();const l=me.AStyles,h=(this.arraylist.styleflags&l.BothSides)>0,c=(this.arraylist.styleflags&l.Linear)>0;a=this.arraylist.hook.length-me.ConnectorDefines.NSkip,o=this.PrGetNBackBoneSegments(),h&&(o%2&&o++,o/=2),this.vertical?(e&&a>1&&(s=e-r.y,this.arraylist.wd+=s/o,this.arraylist.wd<0&&(this.arraylist.wd=0)),t&&!c&&(this.arraylist.ht=t,h&&(this.arraylist.ht/=2))):(t&&a>1&&(n=t-r.x,this.arraylist.wd+=n/o,this.arraylist.wd<0&&(this.arraylist.wd=0)),e&&!c&&(this.arraylist.ht=e,h&&(this.arraylist.ht/=2))),this.PrFormat(this.BlockID),this.rflags&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1),this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1)),Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),F.Debug("S.Connector: SetSize output:",{arraylist:this.arraylist,rflags:this.rflags})}UpdateFrame(t){F.Debug("S.Connector: UpdateFrame input:",t);let e=t||this.Frame;if(we.Shape.BaseDrawObject.prototype.UpdateFrame.call(this,e),ye.opt){let t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(null!==t){let e=this.GetSVGFrame(),i=t.GetElementById(me.SVGElementClass.Shape);if(i){let t=i.GetArrowheadBounds();if(t&&t.length)for(let i=0;i<t.length;i++)t[i].x+=e.x,t[i].y+=e.y,this.r=ve.UnionRect(t[i],this.r,this.r)}}}if(this.StyleRecord){let t=this.StyleRecord.Line.Thickness/2;t<me.Common.MinWidth&&(t=me.Common.MinWidth),ve.InflateRect(this.r,t/2,t/2);let e=this.CalcEffectSettings(this.Frame,this.StyleRecord,!1);e&&ve.Add2Rect(this.r,e.extent)}F.Debug("S.Connector: UpdateFrame output:",this.r)}GetHitTestFrame(){F.Debug("S.Connector: GetHitTestFrame input");const t=Boolean(this.arraylist.styleflags&me.AStyles.Linear),e=Boolean(this.arraylist.styleflags&me.AStyles.StartLeft),i=Boolean(this.arraylist.styleflags&me.AStyles.FlowConn),o=Boolean(this.arraylist.styleflags&me.AStyles.BothSides)||0==(this.arraylist.styleflags&me.AStyles.PerpConn),n=Boolean(this.arraylist.styleflags&me.AStyles.Radial)&&!o;let s,a;t&&i?this.vertical?(s=me.Common.FlowConnectorSlop,a=me.Common.ConnectorSlop):(s=me.Common.ConnectorSlop,a=me.Common.FlowConnectorSlop):(s=me.Common.ConnectorSlop,a=s);let r=Oe.DeepCopy(this.Frame);if(ve.InflateRect(r,s,a),n){const t=i?me.Common.FlowRadialSlop:me.Common.ConnectorSlop;this.vertical?e?(r.x-=t,r.width+=t):r.width+=t:e?(r.y-=t,r.height+=t):r.height+=t}return r=ve.UnionRect(this.r,r,r),F.Debug("S.Connector: GetHitTestFrame output",r),r}GetMoveRect(t,e){F.Debug("S.Connector: GetMoveRect input:",{unusedParam:t,shouldInflate:e});let i={};return 1===this.arraylist.hook.length?(ve.CopyRect(i,this.Frame),i.height=0,i.width=0,F.Debug("S.Connector: GetMoveRect output for single hook:",i),i):(e?(ve.CopyRect(i,this.Frame),ve.InflateRect(i,this.StyleRecord.Line.Thickness/2,this.StyleRecord.Line.Thickness/2)):ve.CopyRect(i,this.Frame),F.Debug("S.Connector: GetMoveRect output:",i),i)}SetShapeOrigin(t,e){F.Debug("S.Connector: SetShapeOrigin input: originX =",t,", originY =",e);let i=0,o=0;null!=t&&(i=t-this.Frame.x),null!=e&&(o=e-this.Frame.y),this.OffsetShape(i,o),F.Debug("S.Connector: SetShapeOrigin output: Offset applied with offsetX =",i,", offsetY =",o)}Hit(t,e,i,o){if(F.Debug("S.Connector: Hit input:",{point:t,isBorderCheck:e,additionalParam:i,anotherParam:o}),this.IsCoManager())return F.Debug("S.Connector: Hit output:",0),0;if(e){if(ve.pointInRect(this.r,t))return F.Debug("S.Connector: Hit output:",Se.HitCodes.Border),Se.HitCodes.Border}else{const e=this.GetHitTestFrame();if(ve.pointInRect(e,t))return F.Debug("S.Connector: Hit output:",Se.HitCodes.Border),Se.HitCodes.Border}return F.Debug("S.Connector: Hit output:",0),0}PreventLink(){return!!this.hooks.length}HandleActionTriggerTrackCommon(t,e){const i=this.arraylist.hook.length;if(!this.arraylist||!this.arraylist.hook||i<1)return;ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);const o=ye.opt.actionSvgObject,n=o.GetElementById(me.SVGElementClass.Shape),s=o.GetElementById(me.SVGElementClass.Slop),a=Oe.DeepCopy(this.Frame),r=me.AStyles,l=me.ConnectorDefines;let h=0,c=0;this.vertical?(c=e-ye.opt.actionStartY,h=t-ye.opt.actionStartX):(h=t-ye.opt.actionStartX,c=e-ye.opt.actionStartY);let p=this.arraylist.ht;const d=this.arraylist.wd;let u=d;const g=Boolean(this.arraylist.styleflags&r.ReverseCol),y=Boolean(this.arraylist.styleflags&r.BothSides||0==(this.arraylist.styleflags&r.PerpConn)),S=Boolean(this.arraylist.styleflags&r.BothSides&&0==(this.arraylist.styleflags&r.Stagger)),m=Boolean(this.arraylist.styleflags&r.Stagger&&this.vertical),b=Boolean(this.arraylist.styleflags&r.StartLeft),D=Boolean(this.arraylist.styleflags&r.Linear),f=Boolean(this.arraylist.styleflags&r.FlowConn),x=this.PrGetStubIndex(),C=this.PrGetEndShapeIndex(),P=D&&x===l.ACr;let O=this.PrGetNBackBoneSegments();S&&(O%2&&O++,O/=2),0!==x&&O++,0!==C&&O++;let v,w=0,k=0,L=0,A=0;switch(ye.opt.actionTriggerId){case me.ActionTriggerType.ConnectorAdj:(g||P)&&(h=-h);let t=ye.opt.OldConnectorExtra+h;t<-ye.opt.OldConnectorWd&&(t=-ye.opt.OldConnectorWd),h=t-this.arraylist.hook[ye.opt.actionTriggerData].extra,this.arraylist.hook[ye.opt.actionTriggerData].extra=t,S&&ye.opt.actionTriggerData<this.arraylist.hook.length-1&&(this.arraylist.hook[ye.opt.actionTriggerData+1].extra=t),(g||P)&&(h=-h),c=0;break;case me.ActionTriggerType.LineStart:h=-h,u=ye.opt.OldConnectorWd+h/O,u<0&&(u=0),A=u-d;const e=A*O;this.vertical?a.height+=e:a.width+=e,h=-h,c=0;break;case me.ActionTriggerType.LineEnd:g&&(h=-h),u=ye.opt.OldConnectorWd+h/O,u<0&&(u=0),A=u-d,this.vertical?a.height+=A*O:a.width+=A*O,g&&(h=-h),c=0;break;case me.ActionTriggerType.ConnectorRerp:A=p,(S&&ye.opt.actionTriggerData%2||m&&b)&&(c=-c),(b&&S||b)&&(c=-c),p=ye.opt.OldConnectorHt+c,p<0&&(p=0),c=p-A,(b&&S||b)&&(c=-c),h=0;break;case me.ActionTriggerType.ConnectorHook:v=this.arraylist.hook[ye.opt.actionTriggerData];const i=v.gap;L=y?h:c,g?L=-L:b?y||(L=-L):ye.opt.actionTriggerData===me.ConnectorDefines.ACr&&(L=-L),v.gap=ye.opt.OldConnectorGap+L;const o=ye.opt.OldConnectorExtra+L;v.gap<0&&(v.gap=0),f&&0===v.gap&&(v.gap=.01);let n=o;n<0&&(n=0),L=v.gap-i,D&&!y&&(v.extra=n),g?L=-L:b?y||(L=-L):ye.opt.actionTriggerData===me.ConnectorDefines.ACr&&(L=-L),c=0,h=0,y?(g?v.startpoint.h-=L:v.startpoint.h+=L,this.vertical?(w=0,k=L):(k=0,w=L)):(v.startpoint.v+=L,this.vertical?(k=0,w=L):(w=0,k=L));break;default:return c=0,void(h=0)}this.arraylist.ht=p,this.arraylist.wd=u;const I=this.PrAdjustFormat(h,c,L,ye.opt.actionTriggerId,ye.opt.actionTriggerData,O,x,C);let E,F;if(I&&(E=I.linestart,F=I.linedisp),0===L&&(this.vertical?(w=c,k=h):(w=h,k=c)),o){const i=this.GetPolyPoints(me.Common.MaxPolyPoints,!0,!1,!1,null);if(o.SetSize(a.width,a.height),o.SetPos(a.x,a.y),n.SetSize(a.width,a.height),this.UpdateSVG(ye.opt.svgDoc,n,i),s.SetSize(a.width,a.height),this.UpdateSVG(ye.opt.svgDoc,s,i),ye.opt.ConnectorList){const i=ye.opt.ConnectorList.length;switch(ye.opt.actionTriggerId){case me.ActionTriggerType.ConnectorAdj:this.arraylist.angle&&(w=k*this.arraylist.angle);for(let t=0;t<i;t++){const e=ye.opt.ConnectorList[t].locallist;if(e)for(let t=0;t<e.length;t++){const i=e[t].GetPos();e[t].SetPos(i.x+w,i.y+k)}if(S&&t<i-1){t++;const e=ye.opt.ConnectorList[t].locallist;if(e)for(let t=0;t<e.length;t++){const i=e[t].GetPos();e[t].SetPos(i.x+w,i.y+k)}}}break;case me.ActionTriggerType.LineEnd:case me.ActionTriggerType.LineStart:this.arraylist.angle&&(w=k*this.arraylist.angle);let o=w,n=k,s=-1;ye.opt.actionTriggerId===me.ActionTriggerType.LineEnd&&i>0&&this.arraylist.hook[l.A_Cr].id>=0?s=l.A_Cr:ye.opt.actionTriggerId===me.ActionTriggerType.LineStart&&i>0&&this.arraylist.hook[l.A_Cl].id>=0&&(s=l.A_Cl);let a=S&&this.arraylist.hook.length%2==0&&ye.opt.actionTriggerId===me.ActionTriggerType.LineStart;for(let t=0;t<i;t++){const e=ye.opt.ConnectorList[t].locallist,r=ye.opt.ConnectorList[t].Index;if(e){E&&null!==E[r]&&(this.vertical?(e[0].GetPos(),n=F[r],this.arraylist.angle&&(o=n*this.arraylist.angle)):(e[0].GetPos(),o=F[r]));for(let t=0;t<e.length;t++){const i=e[t].GetPos();e[t].SetPos(i.x+o,i.y+n)}}if(S&&t<i-1&&!a&&s!==ye.opt.ConnectorList[t+1].Index){t++;const e=ye.opt.ConnectorList[t].locallist;if(e)for(let t=0;t<e.length;t++){const i=e[t].GetPos();e[t].SetPos(i.x+o,i.y+n)}}a&&(a=!1),o+=w,n+=k}const r={x:this.Frame.x,y:this.Frame.y,width:T.x,height:T.y},h={x:t,y:e};Ts.UpdateDisplayCoordinates(r,h,ze.CursorTypes.Grow,this);break;case me.ActionTriggerType.ConnectorRerp:let c=0;this.GetTilt()&&(c=-k);for(let t=0;t<i;t++){const e=ye.opt.ConnectorList[t].GetPos();!(!S&&!m)&&(this.vertical?this.arraylist.angle?t%2:e.x<this.StartPoint.x:e.y<this.StartPoint.y)?ye.opt.ConnectorList[t].SetPos(e.x-w+c,e.y-k):ye.opt.ConnectorList[t].SetPos(e.x+w+c,e.y+k)}const p={x:this.Frame.x,y:this.Frame.y,width:T.x,height:T.y},d={x:t,y:e};Ts.UpdateDisplayCoordinates(p,d,ze.CursorTypes.Grow,this);break;default:for(let t=0;t<i;t++){const e=ye.opt.ConnectorList[t].GetPos();ye.opt.ConnectorList[t].SetPos(e.x+w,e.y+k)}}}}}UpdateDimensions(t,e,i){let o,n,s,a=!1,r=this.PrGetNBackBoneSegments();const l=me.AStyles;this.arraylist.styleflags&l.SEDA_BothSides&&(r%2&&r++,r/=2),r<1&&(r=1),this.vertical?(i&&(n=this.arraylist.wd,o=(i-Math.abs(this.EndPoint.y-this.StartPoint.y))/r,this.arraylist.wd+=o,this.arraylist.wd<0&&(this.arraylist.wd=0),a=this.arraylist.wd!==n),t&&(t<0&&(t=0),s=this.arraylist.ht,this.arraylist.ht=t,a=this.arraylist.ht!==s)):(t&&(n=this.arraylist.wd,o=(t-Math.abs(this.EndPoint.x-this.StartPoint.x))/r,this.arraylist.wd+=o,this.arraylist.wd<0&&(this.arraylist.wd=0),a=this.arraylist.wd!==n),e&&(s=this.arraylist.ht,e<0&&(e=0),this.arraylist.ht=e,a=this.arraylist.ht!==s)),a&&this.PrFormat(this.BlockID)}HandleActionTriggerDoAutoScroll(){we.Shape.BaseLine.prototype.HandleActionTriggerDoAutoScroll.call(this)}AutoScrollCommon(t,e,i){return we.Shape.BaseLine.prototype.AutoScrollCommon.call(this,t,e,i)}LMActionTrack(t){we.Shape.BaseLine.prototype.LMActionTrack.call(this,t)}LMActionRelease(t,e){try{let t,i;switch(e||(rn.UnbindActionClickHammerEvents(),this.ResetAutoScrollTimer()),ye.opt.actionTriggerId){case me.ActionTriggerType.LineStart:case me.ActionTriggerType.LineEnd:for(t=this.arraylist.hook.length,i=0;i<t;i++){let t=this.arraylist.hook[i];t.extra<-this.arraylist.wd&&(t.extra=-this.arraylist.wd)}}this.PrFormat(ye.opt.actionStoredObjectId),Ps.SetLinkFlag(ye.opt.actionStoredObjectId,Ee.LinkFlags.Move),ye.opt.UpdateLinks(),e||(this.LMActionPostRelease(ye.opt.actionStoredObjectId),ye.opt.actionStoredObjectId=-1,ye.opt.actionSvgObject=null),vs.ShowOverlayLayer(),xs.CompleteOperation()}catch(i){throw we.Shape.BaseShape.prototype.LMActionClickExpCleanup.call(this,i),ye.opt.ExceptionCleanup(i),i}}LMSetupActionClick(t,e){return we.Shape.BaseLine.prototype.LMSetupActionClick.call(this,t,e)}LMActionClick(t,e){we.Shape.BaseLine.prototype.LMActionClick.call(this,t,e)}LMActionClickExpCleanup(t){we.Shape.BaseLine.prototype.LMActionClickExpCleanup.call(this,t)}LMActionPreTrack(t,e){F.Debug("S.Connector: LMActionPreTrack input:",{actionEvent:t,triggerType:e});let i,o,n,s,a,r,l,h={},c=[],p=1,d=ws.GetObjectPtr(ye.opt.linksBlockId,!1),u=this.arraylist.styleflags&me.AStyles.BothSides&&0==(this.arraylist.styleflags&me.AStyles.Stagger),g=(this.arraylist.styleflags&me.AStyles.Linear)>0,y=me.ConnectorDefines,S=this,m=function(t,e){let i=t.id;if(t.id<0&&(e===y.ACl?i=S.arraylist.hook[y.NSkip].id:e===y.ACr&&(i=S.arraylist.hook[S.arraylist.hook.length-1].id)),ws.GetObjectPtr(i,!1)){c=[],c=Yo.GetHookList(d,c,i,ws.GetObjectPtr(i,!1),Se.ListCodes.MoveHook,h),r=c.length;let t=[];for(s=0;s<r;s++)n=ye.opt.svgObjectLayer.GetElementById(c[s]),n&&(t.push(n),ws.AddToDirtyList(c[s]));let o={Index:e,locallist:t};ye.opt.ConnectorList.push(o)}},b=function(t,e,i,o){let n,s,r;if(a=t.hook.length,e){for(i===y.ACr&&(n=y.ACr,s=t.hook[n],ye.opt.ConnectorWidthList[n]=s.endpoint.h-s.startpoint.h-s.gap),n=me.ConnectorDefines.NSkip;n<a-1-0;n++)s=t.hook[n+0],r=t.hook[n+0+1],ye.opt.ConnectorWidthList[n+0]=r.endpoint.h-s.endpoint.h-t.wd-r.extra,u&&n++;o===y.ACl&&(n=y.ACl,s=t.hook[n],ye.opt.ConnectorWidthList[n]=s.startpoint.h-s.endpoint.h-s.gap)}else{let e=0;for(i===y.ACl&&(e=0,n=y.ACl,s=t.hook[n],ye.opt.ConnectorWidthList[n]=s.startpoint.h-s.endpoint.h-s.gap),u&&(e=1),n=me.ConnectorDefines.NSkip+1+e;n<a;n++)s=t.hook[n],r=t.hook[n-1],ye.opt.ConnectorWidthList[n]=s.endpoint.h-r.endpoint.h-t.wd-s.extra,u&&n++;o===y.ACr&&(n=y.ACr,s=t.hook[n],ye.opt.ConnectorWidthList[n]=s.endpoint.h-s.startpoint.h-s.gap)}};ye.opt.OldConnectorWd=this.arraylist.wd,ye.opt.OldConnectorHt=this.arraylist.ht,ye.opt.ConnectorList=[],ye.opt.ConnectorWidthList=[],u&&(p=2),e===me.ActionTriggerType.ConnectorHook&&(i=this.arraylist.hook[ye.opt.actionTriggerData],ye.opt.OldConnectorGap=i.gap,ye.opt.OldConnectorExtra=i.extra);let D=this.PrGetStubIndex(),f=this.PrGetEndShapeIndex();switch(e){case me.ActionTriggerType.ConnectorAdj:if(p=ye.opt.actionTriggerData,i=this.arraylist.hook[ye.opt.actionTriggerData],ye.opt.OldConnectorExtra=i.extra,a=this.arraylist.hook.length,g&&D===y.ACr)for(s=me.ConnectorDefines.NSkip;s<p;s++)i=this.arraylist.hook[s],m(i,s);else for(s=p;s<a;s++)i=this.arraylist.hook[s],m(i,s);break;case me.ActionTriggerType.LineEnd:for(a=this.arraylist.hook.length,b(this.arraylist,!1,D,f),D===y.ACl&&f===y.ACl||(p=0),s=me.ConnectorDefines.NSkip+p;s<a;s++)i=this.arraylist.hook[s],m(i,s);a&&this.arraylist.hook[y.ACr].id>=0&&m(this.arraylist.hook[y.ACr],y.ACr);break;case me.ActionTriggerType.LineStart:for(a=this.arraylist.hook.length,u&&a%2==0&&(p=1),b(this.arraylist,!0,D,f),D===y.ACr&&f===y.ACr||(p=0),s=a-1-p;s>=me.ConnectorDefines.NSkip;s--)i=this.arraylist.hook[s],m(i,s);a&&this.arraylist.hook[y.ACl].id>=0&&m(this.arraylist.hook[y.ACl],y.ACl);break;case me.ActionTriggerType.ConnectorRerp:case me.ActionTriggerType.ConnectorHook:if(o=ws.GetObjectPtr(t,!1),o&&d){for(c=Yo.GetHookList(d,c,t,o,Se.ListCodes.ChildrenOnly,h),a=c.length,this.arraylist.hook[y.ACl].id>=0&&(l=c.indexOf(this.arraylist.hook[y.ACl].id),l>=0&&c.splice(l,1)),this.arraylist.hook[y.ACr].id>=0&&(l=c.indexOf(this.arraylist.hook[y.ACr].id),l>=0&&c.splice(l,1)),s=0;s<a;s++)n=ye.opt.svgObjectLayer.GetElementById(c[s]),n&&(ye.opt.ConnectorList.push(n),ws.AddToDirtyList(c[s]));o.hooks.length&&Ps.SetLinkFlag(o.hooks[0].objid,Ee.LinkFlags.Move)}}return F.Debug("S.Connector: LMActionPreTrack output:",!0),!0}LMActionDuringTrack(t){F.Debug("S.Connector: LMActionDuringTrack input:",t);const e=t;return F.Debug("S.Connector: LMActionDuringTrack output:",e),e}LMActionPostRelease(t){F.Debug("S.Connector: LMActionPostRelease input:",{releasedConnectorId:t}),ye.opt.ConnectorList=[],ye.opt.ConnectorWidthList=[],Ps.SetEditMode(Se.EditState.Default),F.Debug("S.Connector: LMActionPostRelease output: completed")}GetBestHook(t,e,i){F.Debug("S.Connector: GetBestHook input:",{targetObjectId:t,unusedParam:e,hookPosition:i});const o=this.arraylist.styleflags&me.AStyles.BothSides,n=this.arraylist.styleflags&me.AStyles.Linear;let s,a,r;if(s=o?this.arraylist.styleflags&me.AStyles.StartLeft?i.x%2-1:i.x%2:this.arraylist.styleflags&me.AStyles.StartLeft,this.vertical){if(!n)return a=-1===i.x?me.HookPts.AKCB:-2===i.x?me.HookPts.AKCT:s?me.HookPts.AKCR:me.HookPts.AKCL,F.Debug("S.Connector: GetBestHook output:",a),a;switch(i.y){case me.ConnectorDefines.Above:a=me.HookPts.AKCR;break;case me.ConnectorDefines.Below:a=me.HookPts.AKCL;break;case me.ConnectorDefines.Parent:a=0===i.x?me.HookPts.AKCB:me.HookPts.AKCT;break;default:r=ws.GetObjectPtr(t,!1),a=r&&r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector?r.vertical?me.HookPts.LL:me.HookPts.LT:me.HookPts.AKCT}return F.Debug("S.Connector: GetBestHook output:",a),a}if(!n)return r=ws.GetObjectPtr(t,!1),a=s?r&&r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector?r.vertical?me.HookPts.LB:me.HookPts.LR:me.HookPts.AKCB:r&&r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector?r.vertical?me.HookPts.LT:me.HookPts.LL:me.HookPts.AKCT,F.Debug("S.Connector: GetBestHook output:",a),a;switch(i.y){case me.ConnectorDefines.Above:a=me.HookPts.AKCB;break;case me.ConnectorDefines.Below:a=me.HookPts.AKCT;break;case me.ConnectorDefines.Parent:a=0===i.x?me.HookPts.AKCR:me.HookPts.AKCL;break;default:r=ws.GetObjectPtr(t,!1),a=r&&r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector?r.vertical?me.HookPts.LT:me.HookPts.LL:me.HookPts.AKCL}return F.Debug("S.Connector: GetBestHook output:",a),a}GetHookFlags(){return Se.HookFlags.LcMoveTarget}HookToPoint(t,e){F.Debug("S.Connector: HookToPoint input:",{hookPoint:t,outputRectangle:e});let i={x:0,y:0};const o=me.AStyles,n=me.ConnectorDefines,s=this.arraylist.styleflags&o.BothSides||0==(this.arraylist.styleflags&o.PerpConn),a=this.arraylist.styleflags&o.ReverseCol;if(i.x=this.StartPoint.x,i.y=this.StartPoint.y,null==this.arraylist)return F.Debug("S.Connector: HookToPoint output:",i),i;const r=a?-1:1;if(this.arraylist.hook.length<=n.NSkip||this.flags&Se.ObjFlags.NotVisible){let t=this.vertical;if(!s){t=!t,Boolean(this.arraylist.styleflags&o.StartLeft)&&(t=!t)}const n=this.arraylist.styleflags&o.StartLeft?this.arraylist.hook[0].endpoint:this.arraylist.hook[0].startpoint;if(t?(i.y+=n.h,i.x+=n.v):(i.y+=n.v,i.x+=n.h),e){const t=ve.Pt2Rect(this.StartPoint,this.EndPoint);e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}return F.Debug("S.Connector: HookToPoint output:",i),i}const l=this.arraylist.hook[n.ACl],h=this.arraylist.hook[n.ACr];let c={x:0,y:0},p={x:0,y:0},d={x:0,y:0},u={x:0,y:0};switch(this.vertical?(c.x=this.StartPoint.x+l.endpoint.v,c.y=this.StartPoint.y+r*l.endpoint.h,p.x=this.StartPoint.x+h.endpoint.v,p.y=this.StartPoint.y+r*h.endpoint.h,d.x=this.StartPoint.x+l.startpoint.v,d.y=this.StartPoint.y+r*l.startpoint.h,u.x=this.StartPoint.x+h.startpoint.v,u.y=this.StartPoint.y+r*h.startpoint.h):(c.x=this.StartPoint.x+l.endpoint.h,c.y=this.StartPoint.y+l.endpoint.v,p.x=this.StartPoint.x+h.endpoint.h,p.y=this.StartPoint.y+h.endpoint.v,d.x=this.StartPoint.x+l.startpoint.h,d.y=this.StartPoint.y+l.startpoint.v,u.x=this.StartPoint.x+h.startpoint.h,u.y=this.StartPoint.y+h.startpoint.v),s||(t=me.HookPts.LL),t){case me.HookPts.LL:case me.HookPts.LT:if(i.x=c.x,i.y=c.y,e){const t=ve.Pt2Rect(c,d);e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}break;default:if(i.x=p.x,i.y=p.y,e){const t=ve.Pt2Rect(p,u);e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height}}return F.Debug("S.Connector: HookToPoint output:",i),i}GetTargetPoints(t,e,i){F.Debug("S.Connector: GetTargetPoints input:",{unusedParam:t,hookFlags:e,excludedHookId:i});let o=[];if(null==this.arraylist)return F.Debug("S.Connector: GetTargetPoints output:",{points:o}),o;const n=this.arraylist.hook.length,s=Boolean(this.arraylist.styleflags&me.AStyles.FlowConn),a=Boolean(this.arraylist.styleflags&me.AStyles.Linear),r=Boolean(this.arraylist.styleflags&me.AStyles.StartLeft),l=Boolean(this.arraylist.styleflags&me.AStyles.BothSides)||0==(this.arraylist.styleflags&me.AStyles.PerpConn),h=Boolean(this.arraylist.styleflags&me.AStyles.Radial)&&!l;let c=Boolean(this.arraylist.styleflags&me.AStyles.EndConn);const p=me.ConnectorDefines,d=me.HookPts;e&Se.HookFlags.LcHookNoExtra&&(c=!1);const u=n-p.NSkip;if(u<=0&&!c)o.push(new De(-3,0));else{for(let t=p.NSkip;t<n+1;t++)o.push(new De(t-p.NSkip,0));if(c)if(0==(e&Se.HookFlags.LcForceEnd)&&(this.arraylist.hook[p.ACl].index>=0||this.arraylist.hook[p.ACr].index>=0))c=!1;else if(this.hooks.length)switch(this.hooks[0].hookpt){case d.LL:case d.LT:o.push(new De(-p.ACr,0));break;default:o.push(new De(-p.ACl,0))}else o.push(new De(-p.ACl,0));if(s&&a){for(let t=p.NSkip;t<n;t++)i&&this.arraylist.hook[t].id===i||(o.push(new De(t-p.NSkip,p.Above)),o.push(new De(t-p.NSkip,p.Below)));if(this.hooks.length)switch(this.hooks[0].hookpt){case me.HookPts.LL:case me.HookPts.LT:o.push(new De(0,p.Parent));break;default:o.push(new De(u,p.Parent))}}else if(s&&h)for(let t=p.NSkip;t<n;t++)i&&this.arraylist.hook[t].id===i||(r?o.push(new De(t-p.NSkip,p.Above)):o.push(new De(t-p.NSkip,p.Below)))}return F.Debug("S.Connector: GetTargetPoints output:",{points:o}),o}AllowMaintainLink(){return!1}ChangeHook(t,e,i){F.Debug("S.Connector: ChangeHook called with",{triggerEvent:t,isUserInitiated:e,additionalInfo:i});const o=me.AStyles;ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),this.arraylist.styleflags,o.Linear,this.arraylist.styleflags,o.FlowConn,F.Debug("S.Connector: ChangeHook completed")}ChangeTarget(t,e,i,o,n,s){F.Debug("S.Connector: ChangeTarget called with",{connectorBlockId:t,targetHookId:e,unusedParam1:i,unusedParam2:o,newHookIndexInfo:n,shouldUpdate:s});let a=-1,r=-1;const l=this.arraylist.styleflags&me.AStyles.BothSides,h=this.arraylist.styleflags&me.AStyles.Linear;this.arraylist.styleflags,me.AStyles.FlowConn;const c=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1).flags&me.SessionFlags.NoTreeOverlap,p=me.ConnectorDefines.NSkip;if(null!=e){const i=this.arraylist.hook.length;for(let t=0;t<i;t++){if(this.arraylist.hook[t].id===e){a=t;break}}if(s)if(a>=0){const t=n.x+me.ConnectorDefines.NSkip;t!==a&&(r=this.arraylist.hook[a].textid,a<t?(l&&n.x++,this.PrAddHookedObject(e,n.x,r),this.PrRemoveHookedObject(e,a)):(this.PrRemoveHookedObject(e,a),this.PrAddHookedObject(e,n.x,r)))}else this.PrAddHookedObject(e,n.x,-1);else if(a>=0){let t=this.arraylist.hook[a];if(t.textid>=0&&(ye.opt.DeleteBlock(t.textid),t.textid=-1),this.PrRemoveHookedObject(e,a),ws.GetObjectPtr(e,!0),h&&a===p&&this.arraylist.hook.length>=p)if(this.arraylist.hook.length===p)for(let e=0;e<p;e++){let t=this.arraylist.hook[e];t.textid>=0&&(ye.opt.DeleteBlock(t.textid),t.textid=-1)}else if(this.arraylist.hook[p].textid>=0)if(!this.hooks.length||this.hooks[0].hookpt!==me.HookPts.LL&&this.hooks[0].hookpt!==me.HookPts.LT){let t=this.arraylist.hook[p];ye.opt.DeleteBlock(t.textid),t.textid=-1}else{let t=this.arraylist.hook[me.ConnectorDefines.ACl];t.textid>=0&&(ye.opt.DeleteBlock(t.textid),t.textid=-1),t.textid=this.arraylist.hook[p].textid,this.arraylist.hook[p].textid=-1}this.arraylist.styleflags&me.AStyles.CoManager?this.CollapseCoManager(e):this.IsAsstConnector()&&this.CollapseAssistant()}if(Ps.SetLinkFlag(t,Ee.LinkFlags.Move),c)Zo.FindTreeTop(this,Ee.LinkFlags.Move,{topconnector:-1,topshape:-1,foundtree:!1});else{const e=ws.GetObjectPtr(t,!0);e&&e.hooks.length&&Ps.SetLinkFlag(e.hooks[0].objid,Ee.LinkFlags.Move)}this.PrFormat(t),ws.AddToDirtyList(t)}else this.flags=ve.SetFlag(this.flags,Se.ObjFlags.Obj1,!0);F.Debug("S.Connector: ChangeTarget completed")}DeleteObject(){F.Debug("S.Connector: DeleteObject called with no input parameters");const t=me.AStyles;ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),Boolean(this.arraylist.styleflags&t.FlowConn);const e=this.arraylist.hook.length;for(let i=0;i<e;i++){const t=this.arraylist.hook[i];if(-1!==t.textid){const e=ye.stdObj.GetObject(t.textid);e&&(F.Debug("S.Connector: Deleting text object with id",t.textid),e.Delete())}}F.Debug("S.Connector: DeleteObject completed with no output")}IsAsstConnector(){F.Debug("S.Connector: IsAsstConnector called");const t=me.AStyles,e=(this.arraylist.styleflags&t.Linear)>0,i=(this.arraylist.styleflags&t.PerpConn)>0,o=e&&i;return F.Debug("S.Connector: IsAsstConnector returning",o),o}AllowCurveOnConnector(t){F.Debug("S.Connector: AllowCurveOnConnector called with",t);const e=me.AStyles,i=0==(this.arraylist.styleflags&e.Linear),o=0==(this.arraylist.styleflags&e.BothSides),n=0==(this.arraylist.styleflags&e.Radial),s=0===this.arraylist.tilt,a=0===this.arraylist.angle,r=i&&o&&n&&s&&a;if(this.IsAsstConnector()&&this.arraylist.hook.length>me.ConnectorDefines.NSkip){let e=-1,i=-1,o=!1;if(this.arraylist.hook[me.ConnectorDefines.NSkip].isasst?(e=this.arraylist.hook[me.ConnectorDefines.NSkip].id,i=me.ConnectorDefines.NSkip+1,o=!1):this.arraylist.hook[this.arraylist.hook.length-1].isasst&&(e=this.arraylist.hook[this.arraylist.hook.length-1].id,i=this.arraylist.hook.length-1,o=!0),e>=0){const n=ws.GetObjectPtr(e,!1);if(n&&n.arraylist&&n.arraylist.hook.length<=me.ConnectorDefines.NSkip)return t&&(t.index=i,t.left=o),F.Debug("S.Connector: AllowCurveOnConnector returning true"),!0}}return F.Debug("S.Connector: AllowCurveOnConnector returning",r),r}IsGenoConnector(){F.Debug("S.Connector: IsGenoConnector called");const t=me.AStyles,e=(this.arraylist.styleflags&t.Linear)>0,i=(this.arraylist.styleflags&t.GenoConn)>0,o=e&&i;return F.Debug("S.Connector: IsGenoConnector returning",o),o}IsCoManager(t){F.Debug("S.Connector: IsCoManager called with output:",t);const e=(this.arraylist.styleflags&me.AStyles.CoManager)>0,i=me.AStyles,o=this.arraylist.styleflags&i.StartLeft;return e&&t&&(this.flags&Se.ObjFlags.Obj1&&this.PrFormat(this.BlockID),this.vertical?(t.y=(this.EndPoint.y+this.StartPoint.y)/2,t.x=o?this.StartPoint.x-this.arraylist.coprofile.v:this.StartPoint.x+this.arraylist.coprofile.vdist,t.ht=this.arraylist.ht):(t.x=(this.EndPoint.x+this.StartPoint.x)/2,t.y=o?this.StartPoint.y-this.arraylist.coprofile.v:this.StartPoint.y+this.arraylist.coprofile.vdist,t.ht=this.arraylist.ht)),F.Debug("S.Connector: IsCoManager returning",e),e}GetChildFrame(t){F.Debug("S.Connector: GetChildFrame called with hookIndex:",t);let e={x:0,y:0,width:150,height:75};const i=this.arraylist.hook.length;if((t+=me.ConnectorDefines.NSkip)>0&&t<i){const i=this.arraylist.hook[t].id;if(i>=0){const t=ws.GetObjectPtr(i,!1);t&&(e=Oe.DeepCopy(t.Frame))}}return F.Debug("S.Connector: GetChildFrame returning",e),e}GetPerimeterPoints(t,e,i,o,n,s){F.Debug("S.Connector: GetPerimeterPoints input:",{formatParam:t,inputPoints:e,unusedParamA:i,unusedParamR:o,unusedParamI:n,unusedParamN:s});let a,r,l,h,c,p,d,u,g,y,S,m,b,D,f,x,C,P,T,O,v,w=[];const k=this.arraylist.styleflags,L=k&me.AStyles.ReverseCol,A=me.ConnectorDefines;if(O=me.Common.FlowConnectorDisp,v=me.Common.FlowConnectorSlop,r=e.length,h=this.arraylist.hook.length,p=h-A.NSkip,p<0&&(p=0),b=k&me.AStyles.BothSides&&0==(k&me.AStyles.Stagger),D=k&me.AStyles.Linear,f=k&me.AStyles.StartLeft,x=k&me.AStyles.BothSides||0==(k&me.AStyles.PerpConn),C=k&me.AStyles.Radial&&!x,P=(k&me.AStyles.Stagger)>0,T=L?-1:1,1===r&&this.flags&Se.ObjFlags.Obj1&&this.PrFormat(t),e[0].x<0){for(a=0;a<r;a++){if(-3===e[a].x)return x&&(f=L)&&(c=this.arraylist.hook[0]),this.vertical?w.push(new De(c.startpoint.v+this.StartPoint.x,c.startpoint.h+this.StartPoint.y)):w.push(new De(c.startpoint.h+this.StartPoint.x,c.startpoint.v+this.StartPoint.y)),F.Debug("S.Connector: GetPerimeterPoints output:",w),w;e[a].x===-A.ACl?c=this.arraylist.hook[A.ACl]:e[a].x===-A.ACr&&(c=this.arraylist.hook[A.ACr]),c&&(this.vertical?w.push(new De(c.endpoint.v+this.StartPoint.x,c.endpoint.h+this.StartPoint.y)):w.push(new De(c.endpoint.h+this.StartPoint.x,c.endpoint.v+this.StartPoint.y)),void 0!==e[a].id&&(w[a].id=e[a].id))}return F.Debug("S.Connector: GetPerimeterPoints output:",w),w}if(1===r)w.push(new De(0,0)),l=e[0].x+A.NSkip,l>=h&&(l=h-1),c=this.arraylist.hook[l],this.vertical?(w[0].x=c.endpoint.v,w[0].y=T*c.endpoint.h):(w[0].x=c.endpoint.h,w[0].y=T*c.endpoint.v),w[0].x+=this.StartPoint.x,w[0].y+=this.StartPoint.y;else for(d=this.GetPolyPoints(me.Common.MaxPolyPoints,!1,!1,!1,null),a=0;a<r;a++)if(e[a].y===A.Parent)0===e[a].x?(l=2*A.ACl,w.push(new De(d[l+1].x,d[l+1].y))):(l=2*A.ACr,w.push(new De(d[l+1].x,d[l+1].y)));else if(0===a||0===e[a].x){l=2*(e[a].x+A.NSkip);let t=this.StartPoint.y,i=this.StartPoint.x;if(p>1?(m=2*(e[a].x+1+A.NSkip),y=d[m].y,S=d[m].x):(y=this.EndPoint.y,S=this.EndPoint.x),this.vertical)switch(e[a].y){case A.Above:C?(u=this.GetChildFrame(e[a].x),w.push(new De(d[l+1].x-u.width-this.arraylist.ht,d[l+1].y))):(g=d[l].x-v,w.push(new De(g,(y+t)/2)));break;case A.Below:C?(u=this.GetChildFrame(e[a].x),w.push(new De(d[l+1].x+u.width+this.arraylist.ht,d[l+1].y))):(g=d[l].x+v,w.push(new De(g,(y+t)/2)));break;default:C?w.push(new De(d[l+1].x,d[l+1].y-10)):w.push(new De(d[l+1].x,d[l].y-10))}else switch(e[a].y){case A.Above:if(C)u=this.GetChildFrame(e[a].x),w.push(new De(d[l+1].x,d[l+1].y-u.height-this.arraylist.ht));else{let t=d[l].y-O;w.push(new De((S+i)/2,t))}break;case A.Below:if(C)u=this.GetChildFrame(e[a].x),w.push(new De(d[l+1].x,d[l+1].y+u.height+this.arraylist.ht));else{let t=d[l].y+O;w.push(new De((S+i)/2,t))}break;default:C?w.push(new De(d[l+1].x-10,d[l+1].y)):w.push(new De(d[l].x-10,d[l+1].y))}b&&a+1<r&&(l=2*(e[++a].x+A.NSkip),l<d.length-1&&(this.vertical?w.push(new De(d[l+1].x,d[l].y-10)):w.push(new De(d[l].x-10,d[l+1].y))))}else if(e[a].x>0&&e[a].x<p)if(l=2*(e[a].x-1+A.NSkip),m=2*(e[a].x+A.NSkip),e[a].x<p-1?(y=d[2*(e[a].x+1+A.NSkip)].y,S=d[2*(e[a].x+1+A.NSkip)].x):(y=this.EndPoint.y,S=this.EndPoint.x),this.vertical)if(D)switch(e[a].y){case A.Above:g=d[m+1].x-v,w.push(new De(g,(y+d[m+1].y)/2));break;case A.Below:g=d[m+1].x+v,w.push(new De(g,(y+d[m+1].y)/2));break;default:g=d[m+1].x,w.push(new De(g,(d[m].y+d[m+1].y)/2))}else if(C)switch(e[a].y){case A.Above:u=this.GetChildFrame(e[a].x),w.push(new De(d[m+1].x-u.width-this.arraylist.ht,d[m+1].y));break;case A.Below:u=this.GetChildFrame(e[a].x),w.push(new De(d[m+1].x+u.width+this.arraylist.ht,d[m+1].y));break;default:w.push(new De(d[m+1].x,(d[m+1].y+d[l+1].y)/2))}else{let t=(d[m].y-d[l].y)/2*this.arraylist.angle;b?w.push(new De(d[l-1].x+t,(d[m].y+d[l].y)/2)):(t=-t,w.push(new De(d[m+1].x+t,(d[m].y+d[l].y)/2)))}else{if(D)switch(e[a].y){case A.Above:let t=d[l].y-O;w.push(new De((S+this.StartPoint.x)/2,t));break;case A.Below:t=d[l].y+O,w.push(new De((S+this.StartPoint.x)/2,t));break;default:t=d[l].y,w.push(new De((d[m].x+d[m+1].x)/2,t))}else if(C)switch(e[a].y){case A.Above:u=this.GetChildFrame(e[a].x),w.push(new De(d[m+1].x,d[m+1].y-u.height-this.arraylist.ht));break;case A.Below:u=this.GetChildFrame(e[a].x),w.push(new De(d[m+1].x,d[m+1].y+u.height+this.arraylist.ht));break;default:w.push(new De((d[m+1].x+d[l+1].x)/2,d[m+1].y))}else w.push(new De((d[m].x+d[l].x)/2,d[m+1].y));if(b){if(this.vertical){let t=(d[m].y-d[l].y)/2*this.arraylist.angle;w.push(new De(d[m-1].x+t,(d[m].y+d[l].y)/2))}else w.push(new De((d[m].x+d[l].x)/2,d[l+1].y));a++}}else if(a===p){if(l=2*(e[a-1].x+A.NSkip),this.vertical)if(b)w.push(new De(d[l-1].x,d[l].y+10));else if(D)w.push(new De(d[l+1].x,this.EndPoint.y+10));else if(C)w.push(new De(d[l+1].x,d[l+1].y+10));else{let t=10*this.arraylist.angle;P&&!f?w.push(new De(d[l].x-(d[l+1].x-d[l].x)+t,d[l].y+10)):w.push(new De(d[l+1].x+t,d[l].y+10))}else b?w.push(new De(d[l].x+10,d[l-1].y)):D?w.push(new De(this.EndPoint.x+10,d[l].y)):C?w.push(new De(d[l+1].x+10,d[l+1].y)):w.push(new De(d[l].x+10,d[l+1].y));b&&a+1<r&&(l=2*(e[++a].x+A.SEDA_NSkip),l<d.length-1&&(this.vertical?w.push(new De(d[l+1].x,d[l].y-10)):w.push(new De(d[l].x-10,d[l+1].y))))}return F.Debug("S.Connector: GetPerimeterPoints output:",w),w}SetHookAlign(t,e){F.Debug("S.Connector: SetHookAlign called with",{currentHook:t,targetHook:e});const i=me.ConnectorDefines;if(this.arraylist.angle&&this.arraylist.hook.length&&e!==t){let t,e;this.arraylist.hook[i.ACl].id>=0?(this.arraylist.hook[i.ACr].id=this.arraylist.hook[i.ACl].id,this.arraylist.hook[i.ACl].id=-1,t=this.arraylist.hook[i.ACr].gap,this.arraylist.hook[i.ACr].gap=this.arraylist.hook[i.ACl].gap,this.arraylist.hook[i.ACl].gap=t,e=ws.GetObjectPtr(this.arraylist.hook[i.ACr].id,!0),e&&e.hooks.length&&(e.hooks[0].hookpt=me.HookPts.AKCT,e.hooks[0].connect.x=-i.ACr)):this.arraylist.hook[i.ACr].id>=0&&(this.arraylist.hook[i.ACl].id=this.arraylist.hook[i.ACr].id,this.arraylist.hook[i.ACr].id=-1,t=this.arraylist.hook[i.ACl].gap,this.arraylist.hook[i.ACr].gap=this.arraylist.hook[i.ACr].gap,this.arraylist.hook[i.ACr].gap=t,e=ws.GetObjectPtr(this.arraylist.hook[i.ACl].id,!0),e&&e.hooks.length&&(e.hooks[0].hookpt=me.HookPts.AKCB,e.hooks[0].connect.x=-i.ACl)),this.arraylist.angle=-this.arraylist.angle,this.flags=ve.SetFlag(this.flags,Se.ObjFlags.Obj1,!0)}F.Debug("S.Connector: SetHookAlign completed")}GetHookPoints(){F.Debug("S.Connector: GetHookPoints called");const t=[],e=me.AStyles;if(null==this.arraylist)return F.Debug("S.Connector: GetHookPoints returning null"),null;const i=this.arraylist.hook.length,o=this.arraylist.styleflags&e.BothSides||0==(this.arraylist.styleflags&e.PerpConn),n=(this.arraylist.styleflags&e.Linear)>0;return i>1||n?(t.push(new De(-1,0)),this.vertical?t[0].id=me.HookPts.LT:t[0].id=me.HookPts.LL,o&&(t.push(new De(-2,0)),this.vertical?t[1].id=me.HookPts.LB:t[1].id=me.HookPts.LR)):(t.push(new De(-1,0)),this.vertical?t[0].id=me.HookPts.LT:t[0].id=me.HookPts.LL),F.Debug("S.Connector: GetHookPoints returning",t),t}GetTextIDs(){F.Debug("S.Connector: GetTextIDs called");const t=[],e=this.arraylist.hook.length;for(let i=0;i<e;i++){const e=this.arraylist.hook[i];e.textid>=0&&t.push(e.textid)}return F.Debug("S.Connector: GetTextIDs returning",t),t}NoFlip(){F.Debug("S.Connector: NoFlip called");return F.Debug("S.Connector: NoFlip returning",true),true}NoRotate(){F.Debug("S.Connector: NoRotate called");return F.Debug("S.Connector: NoRotate returning",true),true}AllowTextEdit(){F.Debug("S.Connector: AllowTextEdit called");const t=this.flags&Se.ObjFlags.Lock,e=this.TextFlags&Se.TextFlags.AttachC,i=!t&&e;return F.Debug("S.Connector: AllowTextEdit returning",i),i}GetArrowheadFormat(){F.Debug("S.Connector: GetArrowheadFormat called");const t=new ts;return t.StartArrowID=this.StartArrowID,t.EndArrowID=this.EndArrowID,t.StartArrowDisp=this.StartArrowDisp,t.EndArrowDisp=this.EndArrowDisp,t.ArrowSizeIndex=this.ArrowSizeIndex,F.Debug("S.Connector: GetArrowheadFormat returning",t),t}ChangeTextAttributes(t,e,i,o,n,s,a,r){if(F.Debug("S.Connector: ChangeTextAttributes called with",{fontName:t,fontAttributes:e,fontSize:i,fontFace:o,fontColor:n,opacity:s,svgElement:a,additionalParams:r}),(t||e||i||o||r)&&0!==this.GetTextIDs().length){let n,l=a||ye.opt.svgObjectLayer.GetElementById(this.BlockID);const h=this.arraylist.hook.length;e&&(void 0!==e.FontName&&(this.StyleRecord.Text.FontName=e.FontName),void 0!==e.FontId&&(this.StyleRecord.Text.FontId=e.FontId),void 0!==e.FontSize&&(this.StyleRecord.Text.FontSize=e.FontSize),void 0!==e.Face&&(this.StyleRecord.Text.Face=e.Face),void 0!==e.Color&&(this.StyleRecord.Text.Paint.Color=e.Color),void 0!==e.Opacity&&(this.StyleRecord.Text.Paint.Opacity=e.Opacity));for(let a=0;a<h;++a)n=this.arraylist.hook[a],n.textid>=0&&(this.DataID=n.textid,this.arraylist.lasttexthook=a,l&&(l.textElem=l.GetElementById(me.SVGElementClass.Text,a)),ye.opt.ChangeObjectTextAttributes(this.BlockID,t,e,o,i,s,l,r));this.DataID=-1,this.lasttexthook=-1}F.Debug("S.Connector: ChangeTextAttributes completed")}CollapseCoManager(t){F.Debug("S.Connector: CollapseCoManager called with connectorId:",t);let e=this.arraylist.hook.length-me.ConnectorDefines.NSkip,i=[];if(ws.GetObjectPtr(t,!0)&&e>=1){let e=this.arraylist.hook[me.ConnectorDefines.NSkip].id,i=ye.opt.FindChildArray(t,-1);if(i>=0){let t=ws.GetObjectPtr(i,!0);t&&Yo.UpdateHook(i,0,e,t.hooks[0].hookpt,t.hooks[0].connect,null)}else i=ye.opt.FindChildArray(e,-1),i>=0&&Ps.SetLinkFlag(e,Ee.LinkFlags.Move)}if(e<=1){let t=-1,o={x:0,y:0};if(this.hooks.length&&(t=this.hooks[0].objid,o.x=this.hooks[0].connect.x),t>=0){Yo.UpdateHook(this.BlockID,0,-1,this.hooks[0].hookpt,this.hooks[0].connect,null);let n=ws.GetObjectPtr(t,!1);if(1===e){let e=this.arraylist.hook[me.ConnectorDefines.NSkip].id,i=ws.GetObjectPtr(e,!0);i&&n&&(i.hooks[0].hookpt=n.GetBestHook(e,i.hooks[0].hookpt,i.hooks[0].connect),Yo.UpdateHook(e,0,t,i.hooks[0].hookpt,o,null));let s=ye.opt.FindChildArray(e,-1);if(s>=0){let t=ws.GetObjectPtr(s,!0);t&&t.FixHook(!1,!0)}}i.push(this.BlockID),ws.DeleteObjects(i,!1)}}F.Debug("S.Connector: CollapseCoManager completed")}CollapseAssistant(){F.Debug("S.Connector: CollapseAssistant called");let t=this.arraylist.hook.length-me.ConnectorDefines.NSkip,e=[];if(1===t){let i=this.arraylist.hook[me.ConnectorDefines.NSkip],o=ws.GetObjectPtr(i.id,!0);if(o&&o.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){let e=this.hooks.length?this.hooks[0].objid:-1;if(e>=0){o.FixHook(!1,!1);let n=ws.GetObjectPtr(e,!0);n&&n.IsCoManager()&&(o.hooks[0].connect.y=-me.AStyles.CoManager),Yo.UpdateHook(i.id,0,e,o.hooks[0].hookpt,o.hooks[0].connect,null),Yo.UpdateHook(this.BlockID,0,-1,this.hooks[0].hookpt,this.hooks[0].connect,null),t=0,Ps.SetLinkFlag(e,Ee.LinkFlags.Move)}}t<1&&(e.push(this.BlockID),ws.DeleteObjects(e,!1))}F.Debug("S.Connector: CollapseAssistant completed")}PrFormat(t){F.Debug("S.Connector: PrFormat input:",{connectorBlockId:t});let e,i,o,n,s,a,r,l,h,c={},p={},d={},u=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),g=[],y=!1,S={},m={lgap:0},b=0;if(this.arraylist.styleflags&me.AStyles.MatchSize&&this.MatchSize(!1,0),this.flags=ve.SetFlag(this.flags,Se.ObjFlags.Obj1,!1),null==this.arraylist||0===(e=this.arraylist.hook.length))return void F.Debug("S.Connector: PrFormat early exit - no hooks");n=me.ConnectorDefines.NSkip;const D=this.arraylist.styleflags&me.AStyles.Linear,f=this.arraylist.styleflags&me.AStyles.BothSides||0==(this.arraylist.styleflags&me.AStyles.PerpConn),x=this.arraylist.styleflags&me.AStyles.BothSides,C=this.arraylist.styleflags&me.AStyles.Stagger,P=this.arraylist.styleflags&me.AStyles.StartLeft,T=this.arraylist.styleflags&me.AStyles.FlowConn,O=this.arraylist.styleflags&me.AStyles.CoManager,v=this.IsAsstConnector(),w=this.IsGenoConnector(),k=this.arraylist.styleflags&me.AStyles.Radial&&!f,L=0==(this.arraylist.styleflags&me.AStyles.Linear)&&this.arraylist.styleflags&me.AStyles.FlowConn;r=u.flags&me.SessionFlags.NoTreeOverlap,l=0==(u.flags&me.SessionFlags.NoStepFormatting),l&&(r=!0),T?(r=!1,l=!1):(this.objecttype,Se.FNObjectTypes.CauseEffectMain,r=!0,l=!0),L&&(r=!0);const A=this.arraylist.ht,I=this.arraylist.wd;if(this.hooks.length&&(parentObject=ws.GetObjectPtr(this.hooks[0].objid,!1))&&(y=parentObject.IsCoManager(S),parentObject.IsAsstConnector()&&(b=parentObject.arraylist.coprofile.vdist,e>=n&&(this.arraylist.hook[1].gap>0&&(this.arraylist.hook[1].gap=A),this.arraylist.hook[2].gap>0&&(this.arraylist.hook[2].gap=A)))),o=e-n,o<0&&(o=0),e>=n)for(i=1;i<n;i++)this.arraylist.hook[i].id>=0&&o++;let E=new fi(0,0,0,0);d.h=this.arraylist.profile.h,d.hdist=this.arraylist.profile.hdist,d.v=this.arraylist.profile.v,d.vdist=this.arraylist.profile.vdist;let G=0;if(e&&this.hooks&&this.hooks.length)switch(f?this.hooks[0].hookpt:me.HookPts.LL){case me.HookPts.LL:case me.HookPts.LT:G=me.HookPts.LL,0===o?(s=this.arraylist.hook[0],c.h=s.startpoint.h,c.v=s.startpoint.v):(s=this.arraylist.hook[me.ConnectorDefines.ACl],c.h=s.endpoint.h,c.v=s.endpoint.v);break;default:G=me.HookPts.LR,0===o?(s=this.arraylist.hook[0],c.h=s.endpoint.h,c.v=s.endpoint.v):(s=this.arraylist.hook[me.ConnectorDefines.ACr],c.h=s.endpoint.h,c.v=s.endpoint.v)}else c.h=0,c.v=0;if(0===o||this.flags&Se.ObjFlags.NotVisible){for(f?(this.arraylist.hook[0].startpoint.h=0,this.arraylist.hook[0].startpoint.v=0,this.arraylist.hook[0].endpoint.v=0,this.arraylist.hook[0].endpoint.h=I,G===me.HookPts.LR&&(this.arraylist.hook[0].endpoint.h=-I),this.vertical?(this.EndPoint.x=this.StartPoint.x,this.EndPoint.y=this.StartPoint.y+this.arraylist.hook[0].endpoint.h):(this.EndPoint.y=this.StartPoint.y,this.EndPoint.x=this.StartPoint.x+this.arraylist.hook[0].endpoint.h)):(this.arraylist.hook[0].startpoint.h=0,this.arraylist.hook[0].startpoint.v=0,this.arraylist.hook[0].endpoint.h=0,this.arraylist.hook[0].endpoint.v=A,G===me.HookPts.LR&&(this.arraylist.hook[0].endpoint.v=-A),this.vertical?(this.EndPoint.y=this.StartPoint.y,this.EndPoint.x=this.StartPoint.x+this.arraylist.hook[0].endpoint.v):(this.EndPoint.x=this.StartPoint.x,this.EndPoint.y=this.StartPoint.y+this.arraylist.hook[0].endpoint.v)),i=1;i<e;i++)this.arraylist.hook[i].startpoint.h=0,this.arraylist.hook[i].startpoint.v=0,this.arraylist.hook[i].endpoint.h=this.arraylist.hook[0].endpoint.h,this.arraylist.hook[i].endpoint.v=this.arraylist.hook[0].endpoint.h;return 0===o&&(this.arraylist.profile.h=0,this.arraylist.profile.v=0,this.arraylist.profile.hdist=0,this.arraylist.profile.vdist=0,this.arraylist.steps.length=0),this.CalcFrame(),void F.Debug("S.Connector: PrFormat exit for empty connector:",this.arraylist)}let R=0,j=0,B=0,M=0,H=x?1:0,_=P;for(i=n;i<e;i++){s=this.arraylist.hook[i],s.pr.h=0,s.pr.v=0,s.pr.hdist=0,s.pr.vdist=0,s.steps.splice(0),s.comanagerht=0,s.isasst=!1;let t=ws.GetObjectPtr(s.id,!1);if(t){a=t.GetArrayRect(this.vertical);let e=a.h+a.hdist/2;if(s.pr.h=e,s.pr.hdist=0,D?(s.pr.v=a.vdist/2,s.pr.vdist=a.vdist/2):(s.pr.v=0,s.pr.vdist=a.vdist),s.gap=a.hdist/2,s.ogap=a.hdist/2,s.steps.push(new Ca(-a.hdist/2,0,a.hdist/2,a.vdist)),s.comanagerht=0,t.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&(t.arraylist.styleflags&me.AStyles.CoManager&&(s.comanagerht=t.arraylist.ht),this.IsAsstConnector()&&(s.isasst=!0)),C&&(i-n)%2==0&&j<a.vdist&&(j=a.vdist),r){let t=this.GetElementProfile(s.id,_,l,null,L,!1);t&&(s.pr.h=t.frame.h,s.pr.v=t.frame.v,s.pr.hdist=t.frame.hdist,s.pr.vdist=t.frame.vdist,s.gap=s.pr.h,s.ogap=s.pr.hdist,a=s.pr,s.steps=t.steps),L&&(s.pr.v=0,s.pr.vdist=0)}R<a.vdist&&(R=a.vdist),x?(_=!_,(i-n)%2==0?P?B<a.vdist&&(B=a.vdist):B<a.v&&(B=a.v):P?M<a.v&&(M=a.v):M<a.vdist&&(M=a.vdist)):P?B<a.vdist&&(B=a.vdist):B<a.v&&(B=a.v)}else s.gap=0,s.ogap=0,a=new wi(0,0,0,0)}j+=A<8?8:A,this.objecttype===Se.FNObjectTypes.CauseEffectMain&&(B=0,M=0);let U=0;if(D)g=this.FormatLinear(u,t,l,E,g,v,m),U=E.x;else for(i=n;i<e;i++){s=this.arraylist.hook[i];let t,o=s.gap,a=l?0:s.ogap,r=s.extra;if(x&&i+1<e?(t=this.arraylist.hook[i+1],t.gap>o&&(o=t.gap),t.extra>r&&(r=t.extra),t.ogap>a&&(a=t.ogap)):t=null,i>n)if(l){if(C&&!x&&(i-n)%2==1){let t=new Ca(-this.StyleRecord.Line.Thickness,0,this.StyleRecord.Line.Thickness,j);this._InsertStepIntoProfile(s.steps,t)}if(U=this.CompareSteps(g,s.steps)+I+r,t){let e=this.CompareSteps(g,t.steps)+I+r;e>U&&(U=e)}}else U+=r,U+=o;s.startpoint.h=U,s.startpoint.v=0,s.endpoint.h=U,s.endpoint.v=A+B-s.comanagerht,s.endpoint.v<0&&(s.endpoint.v=0),t&&(t.startpoint.h=U,t.startpoint.v=0,t.endpoint.h=U,t.endpoint.v=-(A+M)),C&&(x?t&&(a<0&&(a=0),U+=a+I/2,a=0,t.startpoint.h=U,t.endpoint.h=U):(i-n)%2==1&&(s.endpoint.v+=j)),P&&(s.endpoint.v=-s.endpoint.v,t&&(t.endpoint.v=-t.endpoint.v)),this.UpdateCurrentProfile(E,s,h),t&&this.UpdateCurrentProfile(E,t,h),l&&(g=i===n?Oe.DeepCopy(s.steps):this.AddStepsToProfile(g,s.steps,!1,!1,s.startpoint.h,0),t&&(g=this.AddStepsToProfile(g,t.steps,!1,!1,t.startpoint.h,0))),(i+=H)<e-1&&(l||(U+=C&&x?a+I/2:a+I))}let N=this.arraylist.hook[me.ConnectorDefines.ABk];N.startpoint.h=0,N.startpoint.v=0,N.endpoint.h=D?0:U,N.endpoint.v=0;let V,z=this.arraylist.hook[me.ConnectorDefines.ACl],W=this.arraylist.hook[me.ConnectorDefines.ACr];if(z.id>=0&&(hookedObject=ws.GetObjectPtr(z.id,!1))){a=hookedObject.GetArrayRect(this.vertical);let t=a.h+a.hdist/2;z.pr.h=t,z.pr.hdist=0,z.pr.v=0,z.pr.vdist=a.vdist,this.UpdateCurrentProfile(E,z,h)}if(W.id>=0&&(hookedObject=ws.GetObjectPtr(W.id,!1))){a=hookedObject.GetArrayRect(this.vertical);let t=a.h+a.hdist/2;W.pr.h=t,W.pr.hdist=0,W.pr.v=0,W.pr.vdist=a.vdist,this.UpdateCurrentProfile(E,W,h)}if(0===G&&(z.gap=0),O&&(z.gap=0),V=y?S.ht>this.arraylist.ht/2?S.ht:this.arraylist.ht/2:0,f){let t,i;if(e>n){let o=this.arraylist.hook[n];x&&!C&&e>n+1&&this.arraylist.hook[n+1].gap>this.arraylist.hook[n].gap&&(o=this.arraylist.hook[n+1]);let s=this.arraylist.hook[e-1];x&&!C&&e>n+1&&this.arraylist.hook[e-2].gap>this.arraylist.hook[e-1].gap&&(s=this.arraylist.hook[e-2]),t=o.gap,i=s.gap}else t=0,i=0;let o=this.GetTilt();if(D&&(t=0,i=0,0===G&&(W.gap=0)),this.hooks.length)switch(this.hooks[0].hookpt){case me.HookPts.LL:case me.HookPts.LT:W.gap=0,i=0,t-=V-b,D&&T&&0==(this.arraylist.flags&me.ArrayFlags.LeaveACl)&&0===z.gap&&(z.gap=I);break;case me.HookPts.LB:case me.HookPts.LR:z.gap=0,t=0,i-=V-b,D&&T&&0==(this.arraylist.flags&me.ArrayFlags.LeaveACr)&&0===W.gap&&(W.gap=I)}if(z.id>=0&&(0===z.gap&&(z.gap=C?I/2:I,this.arraylist.hook[n]&&(z.gap+=this.arraylist.hook[n].gap)),this.arraylist.matchsizelen)){let t=z.gap;z.gap=this.arraylist.matchsizelen-U,z.gap<t&&(z.gap=t)}if(W.id>=0&&(W.gap=C?I/2:I,this.arraylist.hook[e-1]&&(W.gap+=this.arraylist.hook[e-1].gap),this.arraylist.matchsizelen)){let t=W.gap;W.gap=this.arraylist.matchsizelen-U,W.gap<t&&(W.gap=t)}z.startpoint.h=0,z.startpoint.v=0,this.arraylist.angle?z.endpoint.h=-z.gap:(z.endpoint.h=-z.gap-t,0===u.moreflags&&T&&D&&(z.endpoint.h-=z.extra)),G===me.HookPts.LL&&(z.endpoint.h+=o),z.endpoint.v=0,W.startpoint.h=U+m.lgap,W.startpoint.v=0,o||this.arraylist.angle?W.endpoint.h=U+W.gap:(W.endpoint.h=U+W.gap+i,0===u.moreflags&&T&&D&&(W.endpoint.h+=W.extra)),W.endpoint.v=0}else{let t;if(null!=E.firstconnector_x?(t=E.firstconnector_x?2*(E.firstconnector_x+I):0,z.gap=-E.v+A+z.extra):t=U,z.startpoint.h=t/2,z.startpoint.v=0,z.endpoint.h=t/2,z.endpoint.v=P?z.gap-V+b:-z.gap+V-b,W.startpoint.h=t/2,W.startpoint.v=0,W.endpoint.h=t/2,W.endpoint.v=0,k){for(N.startpoint.h=t/2,N.endpoint.h=t/2,i=n;i<e;i++)this.arraylist.hook[i].startpoint.h=t/2;z.endpoint.v=0}}if(this.arraylist.angle?this.AdjustAngleConnector():this.arraylist.tilt&&this.AdjustTiltConnector(),this.vertical?(this.EndPoint.x=this.StartPoint.x+N.endpoint.v,this.EndPoint.y=this.StartPoint.y+U):(this.EndPoint.y=this.StartPoint.y,this.EndPoint.x=this.StartPoint.x+U),this.CalcFrame(),this.hooks&&this.hooks.length){if(f)switch(this.hooks[0].hookpt){case me.HookPts.LL:case me.HookPts.LT:s=this.arraylist.hook[me.ConnectorDefines.ACl];break;default:s=this.arraylist.hook[me.ConnectorDefines.ACr]}else s=this.arraylist.hook[me.ConnectorDefines.ACl];p.h=s.endpoint.h,p.v=s.endpoint.v,null==c.h||ve.IsEqual(c.h,p.h)&&ve.IsEqual(c.v,p.v)||Ps.SetLinkFlag(this.hooks[0].objid,Ee.LinkFlags.Move)}else p.h=0,p.v=0;if(this.arraylist.coprofile=Oe.DeepCopy(E),this.arraylist.profile.h=p.h-E.h,this.arraylist.profile.hdist=E.hdist-p.h,this.arraylist.profile.v=p.v-E.v,this.arraylist.profile.vdist=E.vdist-p.v,O&&(P?this.arraylist.profile.v+=A:this.arraylist.profile.vdist+=A,this.arraylist.coprofile=Oe.DeepCopy(this.arraylist.profile),l&&g.length&&(g[0].vend+=2*A,g[0].v-=2*A),g=this.AddCoManagerChildren(P,l,g)),(v||w)&&(g=this.AddAssistantChildren(P,l,g)),l){if(f){g=this.BuildSideConnectorSteps();for(let e=0,i=g.length;e<i;e++)x||(P?g[e].hend=p.v:g[e].h=p.v);let t=new Ca(-this.StyleRecord.Line.Thickness,0,this.StyleRecord.Line.Thickness,-p.h);this._InsertStepIntoProfile(g,t),g.length>1&&(g[0].vend=g[1].v)}else{for(let t=0,e=g.length;t<e;t++)g[t].h-=p.h,g[t].hend-=p.h;if(v){let t=P?s.endpoint.v:-s.endpoint.v,e=new Ca(-this.StyleRecord.Line.Thickness,0,this.StyleRecord.Line.Thickness,t);this._InsertStepIntoProfile(g,e)}else if(!O){let t=new Ca(-p.h,0,N.endpoint.h-p.h,A);this._InsertStepIntoProfile(g,t);let e=P?s.endpoint.v:-s.endpoint.v;t=new Ca(-this.StyleRecord.Line.Thickness,0,this.StyleRecord.Line.Thickness,e),this._InsertStepIntoProfile(g,t)}}this.arraylist.steps=g}ws.AddToDirtyList(t),ve.IsEqual(this.arraylist.profile.h,d.h)&&ve.IsEqual(this.arraylist.profile.v,d.v)&&ve.IsEqual(this.arraylist.profile.hdist,d.hdist)&&ve.IsEqual(this.arraylist.profile.vdist,d.vdist)||!r||(Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),Zo.FindTreeTop(this,Ee.LinkFlags.Move,{topconnector:-1,topshape:-1,foundtree:!1})),F.Debug("S.Connector: PrFormat output:",{horizontalPosition:U,stepsCount:g.length,profile:this.arraylist.profile})}GetAngleDisp(t){F.Debug("S.Connector: GetAngleDisp called with hook:",t);const e={start:0,end:0};return this.arraylist.angle&&(e.start=-t.startpoint.h*this.arraylist.angle,e.end=-t.endpoint.h*this.arraylist.angle),F.Debug("S.Connector: GetAngleDisp returning angleDisplacement:",e),e}AdjustAngleConnector(){F.Debug("S.Connector: AdjustAngleConnector called");const t=me.ConnectorDefines,e=t.NSkip,i=this.arraylist.hook.length;if(i<e)return;let o,n;o=this.arraylist.hook[t.ABk],n=this.GetAngleDisp(o),o.startpoint.v+=n.start,o.endpoint.v-=n.end,o=this.arraylist.hook[t.ACl],n=this.GetAngleDisp(o),o.startpoint.v+=n.start,o.endpoint.v-=n.end,o=this.arraylist.hook[t.ACr],n=this.GetAngleDisp(o),o.startpoint.v-=n.start,o.endpoint.v-=n.end;for(let s=e;s<i;s++)o=this.arraylist.hook[s],n=this.GetAngleDisp(o),o.startpoint.v-=n.end,o.endpoint.v-=n.end;F.Debug("S.Connector: AdjustAngleConnector completed")}GetTilt(t){F.Debug("S.Connector: GetTilt called with height:",t);let e=0;if(this.arraylist.tilt){const i=this.arraylist.tilt/180*Math.PI,o=Math.tan(i);if(o){const i=1/o;e=void 0!==t?t*i:this.arraylist.ht/i}}return F.Debug("S.Connector: GetTilt returning tiltValue:",e),e}AdjustTiltConnector(){F.Debug("S.Connector: AdjustTiltConnector called");const t=me.ConnectorDefines.NSkip,e=this.GetTilt();if(e){const i=this.arraylist.hook.length;if(i<t)return;for(let o=t;o<i;o++)this.arraylist.hook[o].endpoint.h-=e}F.Debug("S.Connector: AdjustTiltConnector completed")}FormatLinear(t,e,i,o,n,s,a){F.Debug("S.Connector: FormatLinear called with input:",{session:t,useSteps:i,resultFrame:o,stepsBuffer:n,skipAdjustment:s,output:a});const r=me.ConnectorDefines.NSkip;let l=this.arraylist.hook.length,h=0,c=0,p=this.arraylist.wd,d=0,u=0,g=!1,y=!1,S=!1,m=0;if(l>=r&&this.hooks.length&&!s&&(()=>{const t=this.hooks[0].hookpt===me.HookPts.LL||this.hooks[0].hookpt===me.HookPts.LT;return y=this.arraylist.hook[1].gap>1&&t,S=this.arraylist.hook[2].gap>1&&!t,false})()){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);if(t){const e=0-t.GetArrayRect(this.vertical).hdist;if(y){const t=this.arraylist.hook[r].gap;m=(0-this.arraylist.hook[r].ogap-t)/2,this.arraylist.hook[1].gap=p+e/2+m+this.arraylist.hook[1].extra,this.arraylist.hook[1].gap<p/2&&(this.arraylist.hook[1].gap=p/2)}if(S){const t=this.arraylist.hook[l-1].gap;m=(0-this.arraylist.hook[l-1].ogap-t)/2,this.arraylist.hook[2].gap=p+e/2+m+this.arraylist.hook[2].extra,this.arraylist.hook[2].gap<p/2&&(this.arraylist.hook[2].gap=p/2)}}}for(let b=r;b<l;b++){m=0;const t=this.arraylist.hook[b];t.isasst&&!g&&(o.firstconnector_x=h,g=!0);const e=t.gap,s=i?0:t.ogap;l===r+1&&(t.extra=0),c+=t.extra;const a=this.GetLeftAdjustment(t.id);t.startpoint.h=h+d,t.startpoint.v=0,t.endpoint.h=c,(b>r||y)&&(t.endpoint.h+=a),t.endpoint.v=0,d=this.GetRightAdjustment(t.id),this.UpdateCurrentProfile(o,t,!1),i?(n=b===r?Oe.DeepCopy(t.steps):this.AddStepsToProfile(n,t.steps,!1,!1,t.endpoint.h,0),t.steps.length&&(t.steps[0].v<u&&(u=t.steps[0].v),t.steps[0].vend>0&&t.steps[0].vend),h=this.CompareSteps(n,t.steps),c=h-a+p):(h=c,h+=e+s,c=h-a+p)}return i&&s&&n.length&&(n[0].v>u&&(n[0].v=u),n[0].vend<0&&(n[0].vend=0)),S?a.lgap=d:h+=d,o.x=h,F.Debug("S.Connector: FormatLinear output:",{resultFrame:o,stepsBuffer:n}),n}AddCoManagerChildren(t,e,i){F.Debug("S.Connector: AddCoManagerChildren input:",{useStartPointFlag:t,copySteps:e,currentSteps:i});const o=me.ConnectorDefines.NSkip;if(this.arraylist.hook.length>=o){const n=this.arraylist.hook[o],s=i.length;this.arraylist.steps.length=0;for(let t=0;t<s;t++)this.arraylist.steps.push(new Ca(i[t].h,i[t].v,i[t].hend,i[t].vend));const a=this.GetElementProfile(n.id,t,e,this,!1,!1);a&&(i=a.steps,this.arraylist.profile=a.frame)}return F.Debug("S.Connector: AddCoManagerChildren output:",i),i}AddAssistantChildren(t,e,i){F.Debug("S.Connector: AddAssistantChildren input:",{useStartPointFlag:t,copySteps:e,currentSteps:i});let o=this.arraylist.hook.length;let n=-1,s=0,a=!1;for(let r=me.ConnectorDefines.NSkip;r<o;r++){const t=this.arraylist.hook[r],e=ws.GetObjectPtr(t.id,!1);if(e&&e.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){n=r,s=t.endpoint.h,a=Boolean(e.arraylist.styleflags&me.AStyles.ReverseCol);break}}if(n>=0){const o=this.arraylist.hook[n],r=i.length;this.arraylist.steps.length=0;for(let t=0;t<r;t++)this.arraylist.steps.push(new Ca(i[t].h,i[t].v,i[t].hend,i[t].vend));const l=this.GetElementProfile(o.id,t,e,this,!1,!0);if(l){if(a){const t=l.frame.v;l.frame.v=l.frame.vdist,l.frame.vdist=t}if(l.frame.h>this.arraylist.profile.h&&(this.arraylist.profile.h=l.frame.h),l.frame.hdist>this.arraylist.profile.hdist&&(this.arraylist.profile.hdist=l.frame.hdist),l.frame.v>this.arraylist.profile.v&&(this.arraylist.profile.v=l.frame.v),l.frame.vdist>this.arraylist.profile.vdist&&(this.arraylist.profile.vdist=l.frame.vdist),e){const t=l.steps.length,e=i[0].vend;for(let o=0;o<t;o++)i.push(new Ca(l.steps[o].h+s,l.steps[o].v+e,l.steps[o].hend+s,l.steps[o].vend+e))}}const h=i.length;for(let t=0;t<h;t++)i[t].h>0&&(i[t].h=0)}return F.Debug("S.Connector: AddAssistantChildren output:",i),i}CompareSteps(t,e){F.Debug("S.Connector: CompareSteps called with",{existingSteps:JSON.stringify(t),newSteps:JSON.stringify(e)});let i=0;const o=t.length,n=e.length;let s=0;for(let a=0;a<n;a++)(void 0===s||e[a].vend>s)&&(s=e[a].vend);if(n>0){for(let a=0;a<o&&!(t[a].v>s);a++)for(let o=0;o<n;o++)if(e[o].vend>t[a].v&&e[o].v<t[a].vend){const n=t[a].hend-e[o].h;n>i&&(i=n)}else if(e[o].v>t[a].vend)break}else for(let a=0;a<o;a++)t[a].hend>i&&(i=t[a].hend);return F.Debug("S.Connector: CompareSteps returning output:",i),i}AddStepsToProfile(t,e,i,o,n,s){F.Debug("S.Connector: AddStepsToProfile called with",{existingSteps:JSON.stringify(t),newSteps:JSON.stringify(e),transform:i,invert:o,offset:n,newOffset:s});let a=t.length,r=e.length,l=[],h=0,c=[];const p=me.Common.MaxSteps;if(a&&0===r&&n){for(let e=0;e<a;e++)l.push(new Ca(t[e].h,t[e].v,n,t[e].vend));return F.Debug("S.Connector: AddStepsToProfile output",JSON.stringify(l)),l}if(i){for(let t=0;t<r;t++)o?c.push(new Ca(-e[t].vend,e[t].h+n,e[t].v,e[t].hend+n)):c.push(new Ca(e[t].v,e[t].h+n,e[t].vend,e[t].hend+n));n=s}else c=e;for(let g=0;g<a;g++){h<p?(h>0&&(l[h-1].vend=t[g].v),l.push(new Ca(t[g].h,t[g].v,t[g].hend,t[g].vend)),h++):(t[g].vend>l[h-1].vend&&(l[h-1].vend=t[g].vend),l[h-1].h<t[g].h&&(l[h-1].h=t[g].h),l[h-1].hend<t[g].hend&&(l[h-1].hend=t[g].hend));for(let e=0;e<r;e++)if(c[e].vend>t[g].v&&c[e].v<=t[g].vend)if(c[e].v<=l[h-1].v?(l[h-1].hend<c[e].hend+n&&(l[h-1].hend=c[e].hend+n),l[h-1].h>c[e].h+n&&(l[h-1].h=c[e].h+n)):h<p?(l[h-1].vend=c[e].v,l.push(new Ca(t[g].h,t[g].v,t[g].hend,t[g].vend)),l[h].v=l[h-1].vend,l[h].hend=c[e].hend+n,l[h].h>c[e].h+n&&(l[h].h=c[e].h+n),h++):(c[e].vend>l[h-1].vend&&(l[h-1].vend=c[e].vend),l[h-1].hend<c[e].hend+n&&(l[h-1].hend=c[e].hend+n),l[h-1].h<c[e].h+n&&(l[h-1].h=c[e].h+n)),c[e].vend<t[g].vend)h<p?(l[h-1].vend=c[e].vend,l.push(new Ca(t[g].h,t[g].v,t[g].hend,t[g].vend)),c[e].v<l[h].v&&(l[h].v=l[h-1].vend),h++):c[e].vend>l[h-1].vend&&(l[h-1].vend=c[e].vend);else if(c[e].v>t[g].vend)break}let d;h?d=l[h-1].vend:(d=0,r&&(d=c[0].v));for(let g=0;g<r;g++)c[g].vend>d&&(h<p?(l.push(new Ca(c[g].h,c[g].v,c[g].hend,c[g].vend)),c[g].v<d&&h>0&&(l[h].v=d),h++):(c[g].vend>l[h-1].vend&&(l[h-1].vend=c[g].vend),l[h-1].hend<c[g].hend+n&&(l[h-1].hend=c[g].hend+n),l[h-1].h<c[g].h+n&&(l[h-1].h=c[g].h+n)));let u=1;for(let g=1;g<h;g++)l[u-1].h===l[g].h&&l[u-1].hend===l[g].hend?l[u-1].vend=l[g].vend:(u<g&&(l[u]=Oe.DeepCopy(l[g])),u++);return l.length=l.length>=u?u:l.length,F.Debug("S.Connector: AddStepsToProfile output",JSON.stringify(l)),l}BuildSideConnectorSteps(){F.Debug("S.Connector: BuildSideConnectorSteps called, total hooks =",this.arraylist.hook.length);let t=[];const e=me.AStyles,i=Boolean(this.arraylist.styleflags&e.StartLeft),o=Boolean(this.arraylist.styleflags&e.BothSides);this.arraylist.styleflags;const n=this.arraylist.hook.length,s=me.ConnectorDefines.NSkip;let a=i;if(n>s){const e=this.arraylist.hook[s],r=e.steps.length;for(let o=0;o<r;o++)i?t.push(new Ca(-e.steps[o].vend+e.endpoint.v,1*e.steps[o].h,e.steps[o].v+e.endpoint.v,1*e.steps[o].hend)):t.push(new Ca(e.steps[o].v+e.endpoint.v,1*e.steps[o].h,e.steps[o].vend+e.endpoint.v,1*e.steps[o].hend));for(let i=s+1;i<n;i++){o&&(a=!a);const e=this.arraylist.hook[i],n=e.endpoint.v;t=this.AddStepsToProfile(t,e.steps,!0,a,1*e.startpoint.h,n)}}return F.Debug("S.Connector: BuildSideConnectorSteps completed with output:",JSON.stringify(t)),t}InsertStepIntoProfile(t,e){F.Debug("S.Connector: InsertStepIntoProfile called with",{profileSteps:JSON.stringify(t),newStep:JSON.stringify(e)}),t.unshift(e);const i=e.vend-e.v;for(let o=1;o<t.length;o++)t[o].v+=i,t[o].vend+=i;F.Debug("S.Connector: InsertStepIntoProfile completed with output",JSON.stringify(t))}UpdateCurrentProfile(t,e,i){let o,n;F.Debug("S.Connector: UpdateCurrentProfile called with",{profile:JSON.stringify(t),hook:JSON.stringify(e),flag:i}),o=e.endpoint.h-e.pr.h,o<t.h&&(t.h=o),n=e.endpoint.h+e.pr.hdist,n>t.hdist&&(t.hdist=n),o=e.endpoint.v-e.pr.v,o<t.v&&(t.v=o),n=e.endpoint.v+e.pr.vdist,n>t.vdist&&(t.vdist=n),F.Debug("S.Connector: UpdateCurrentProfile completed with output",JSON.stringify(t))}GetFullShapeProfile(t,e,i,o,n){F.Debug("S.Connector: GetFullShapeProfile called with",{targetObjectId:t,offsetX:e,offsetY:i,resultRect:o,updateUnion:n});let s=ws.GetObjectPtr(t,!1);const a=me.ConnectorDefines.NSkip;let r,l={lindex:-1,id:-1,hookpt:0},h={x:0,y:0,width:0,height:0},c=[];if(s)for(ve.CopyRect(h,s.Frame),h.x+=e,h.y+=i,n?ve.CopyRect(o,h):ve.UnionRect(o,h,o);ye.opt.FindChildArrayByIndex(t,l)>0;){let t=ws.GetObjectPtr(l.id,!1);if(!t)break;let n=t.HookToPoint(t.hooks[0].hookpt,null);c=[],c.push(new De(t.hooks[0].connect.x,t.hooks[0].connect.y)),r=s.GetPerimPts(s.BlockID,c,t.hooks[0].hookpt,!0,null,-1),r&&n&&(e+=r[0].x-n.x,i+=r[0].y-n.y),ve.CopyRect(h,t.Frame),h.x+=e,h.y+=i,ve.UnionRect(o,h,o);let p=t.arraylist.hook.length;for(let s=a;s<p;s++){let n=t.arraylist.hook[s],a=ws.GetObjectPtr(n.id,!1);if(a){let s=a.HookToPoint(a.hooks[0].hookpt,null);if(c=[],c.push(new De(a.hooks[0].connect.x,a.hooks[0].connect.y)),r=t.GetPerimPts(t.BlockID,c,a.hooks[0].hookpt,!0,null,-1),r&&s){let a=e+r[0].x-s.x,l=i+r[0].y-s.y;t.GetFullShapeProfile(n.id,a,l,o,!1)}}}}F.Debug("S.Connector: GetFullShapeProfile completed with resultRect:",o)}GetRightAdjustment(t){F.Debug("S.Connector: GetRightAdjustment called with hookedObjectId:",t);const e=me.HookPts,i=ws.GetObjectPtr(t,!1);if(null==i)return F.Debug("S.Connector: GetRightAdjustment returning output: 0 (hookedObject is null)"),0;if(0===i.hooks.length)return F.Debug("S.Connector: GetRightAdjustment returning output: 0 (hookedObject has no hooks)"),0;let o,n,s=0;switch(i.hooks[0].hookpt){case e.AKCT:o=e.AKCB;break;case e.AKCB:o=e.AKCT;break;case e.AKCR:o=e.AKCL;break;case e.AKCL:o=e.AKCR}if(o&&(n=i.HookToPoint(o,null),n)){switch(o){case e.AKCT:s=n.y-i.Frame.y;break;case e.AKCB:s=n.y-i.Frame.y-i.Frame.height;break;case e.AKCR:s=n.x-i.Frame.x-i.Frame.width;break;case e.AKCL:s=n.x-i.Frame.x}ve.IsEqual(s,0)&&(s=0)}return F.Debug("S.Connector: GetRightAdjustment returning output:",s),s}GetLeftAdjustment(t){F.Debug("S.Connector: GetLeftAdjustment called with hookObjectId:",t);const e=me.HookPts,i=ws.GetObjectPtr(t,!1);if(null==i)return F.Debug("S.Connector: GetLeftAdjustment returning 0 because hookedObject is null"),0;if(i.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Shape)return F.Debug("S.Connector: GetLeftAdjustment returning 0 because hookedObject is not of type SHAPE"),0;if(0===i.hooks.length)return F.Debug("S.Connector: GetLeftAdjustment returning 0 because hookedObject has no hooks"),0;let o,n=i.hooks[0].hookpt,s=0;if(n&&(o=i.HookToPoint(n,null),o)){switch(n){case e.AKCT:s=o.y-i.Frame.y;break;case e.AKCB:s=o.y-i.Frame.y-i.Frame.height;break;case e.AKCR:s=o.x-i.Frame.x-i.Frame.width;break;case e.AKCL:s=o.x-i.Frame.x}ve.IsEqual(s,0)&&(s=0)}return F.Debug("S.Connector: GetLeftAdjustment returning leftAdjustment:",s),s}GetElementProfile(e,i,o,n,s,a){let r,l,h,c,p,d;F.Debug("S.Connector: GetElementProfile called with",{targetObjectId:e,useStartPointFlag:i,copySteps:o,referenceConnector:n,useFullShapeProfile:s,ignoreGenoFlag:a});let u={},g={},y={h:0,v:0},S={},m={frame:{},nsteps:0,steps:[]};const b=me.AStyles,D=me.ConnectorDefines.NSkip,f=ws.GetObjectPtr(e,!1);if(null==f)return null;let x=this.arraylist.styleflags&b.CoManager;n&&(x=!1);let C=this.arraylist.styleflags&b.Linear,P=this.IsAsstConnector(),T=this.IsGenoConnector();if(a&&(T=!1),P&&n&&(P=!1),f.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){if(P||T)return m.frame.h=0,m.frame.hdist=0,m.frame.v=0,m.frame.vdist=0,this.arraylist.hook[D].id!=e&&(m.frame.v=this.arraylist.hook[D].pr.v),m.steps.push(new Ca(-m.frame.h,-m.frame.v,m.frame.hdist,m.frame.vdist)),F.Debug("S.Connector: GetElementProfile output",m),m;const t=f.arraylist.styleflags&b.BothSides||0==(f.arraylist.styleflags&b.PerpConn);if(f.vertical===this.vertical?(m.frame.h=f.arraylist.profile.h,m.frame.hdist=f.arraylist.profile.hdist,m.frame.v=f.arraylist.profile.v,m.frame.vdist=f.arraylist.profile.vdist):(m.frame.v=f.arraylist.profile.h,m.frame.vdist=f.arraylist.profile.hdist,f.arraylist.styleflags&b.CoManager&&this.arraylist.styleflags&b.ReverseCol?(m.frame.h=f.arraylist.profile.vdist,m.frame.hdist=f.arraylist.profile.v):(m.frame.h=f.arraylist.profile.v,m.frame.hdist=f.arraylist.profile.vdist)),o){const e=f.arraylist.steps.length;p=f.arraylist.steps;let i=f.vertical===this.vertical;if(t&&(i=!i),i)for(let t=0;t<e;t++)m.steps.push(new Ca(p[t].h,p[t].v,p[t].hend,p[t].vend));else for(let t=0;t<e;t++)m.steps.push(new Ca(p[t].v,p[t].h,p[t].vend,p[t].hend))}return F.Debug("S.Connector: GetElementProfile output",m),m}if(f.hooks.length&&f.hooks[0].objid===this.BlockID)if(n){m.frame.h=n.arraylist.profile.h,m.frame.v=n.arraylist.profile.v,m.frame.hdist=n.arraylist.profile.hdist,m.frame.vdist=n.arraylist.profile.vdist;const t=this.arraylist.steps.length;for(let e=0;e<t;e++)m.steps.push(new Ca(this.arraylist.steps[e].h,this.arraylist.steps[e].v,this.arraylist.steps[e].hend,this.arraylist.steps[e].vend));o?(g.x=this.StartPoint.x,g.y=this.StartPoint.y):g=n.HookToPoint(f.hooks[0].hookpt,null),r=ve.Pt2CPoint(g,this.vertical),r.v+=this.arraylist.ht}else g=f.HookToPoint(f.hooks[0].hookpt,null),r=ve.Pt2CPoint(g,this.vertical),s?(this.GetFullShapeProfile(e,0,0,u,!0),l=ve.Rect2CRect(u,this.vertical)):l=f.GetArrayRect(this.vertical),m.frame.h=r.h-l.h,m.frame.hdist=l.h+l.hdist-r.h,m.frame.v=r.v-l.v,m.frame.vdist=l.v+l.vdist-r.v,o&&(i&&!C?m.steps.push(new Ca(-m.frame.h,m.frame.vdist,m.frame.hdist,m.frame.v)):m.steps.push(new Ca(-m.frame.h,-m.frame.v,m.frame.hdist,m.frame.vdist)));else g=f.HookToPoint(f.hooks[0].hookpt,null),r=ve.Pt2CPoint(g,this.vertical),s?(this.GetFullShapeProfile(e,0,0,u,!0),l=ve.Rect2CRect(u,this.vertical)):l=f.GetArrayRect(this.vertical),m.frame.h=r.h-l.h,m.frame.hdist=l.h+l.hdist-r.h,m.frame.v=r.v-l.v,m.frame.vdist=l.v+l.vdist-r.v,o&&(i&&!C?m.steps.push(new Ca(-m.frame.h,m.frame.vdist,m.frame.hdist,m.frame.v)):m.steps.push(new Ca(-m.frame.h,-m.frame.v,m.frame.hdist,m.frame.vdist)));if(d=ye.opt.FindChildArray(e,-1),!C&&!x&&!P&&d>=0){const e=ws.GetObjectPtr(d,!1);if(e&&e.hooks.length&&e.arraylist.hook.length-me.ConnectorDefines.NSkip>0&&0==(e.flags&Se.ObjFlags.NotVisible)){if(c=[],c.push(new De(e.hooks[0].connect.x,e.hooks[0].connect.y)),h=e.GetPerimPts(e.BlockID,c,e.hooks[0].hookpt,!0,null,-1),h&&r){let t=ve.Pt2CPoint(h[0],this.vertical);y.h=r.h-t.h,y.v=r.v-t.v}const o=e.arraylist.steps.length;if(p=e.arraylist.steps,e.vertical===this.vertical?(e.arraylist.styleflags&b.ReverseCol&&(y.h=-y.h),S.h=e.arraylist.profile.h+y.h,S.hdist=e.arraylist.profile.hdist-y.h,S.v=e.arraylist.profile.v+y.v,S.vdist=e.arraylist.profile.vdist-y.v):(e.arraylist.styleflags&b.ReverseCol&&(y.v=-y.v),e.arraylist.styleflags&b.StartLeft&&!bothSides?(S.hdist=e.arraylist.profile.v+y.h,S.h=e.arraylist.profile.vdist-y.h):(S.h=e.arraylist.profile.v+y.h,S.hdist=e.arraylist.profile.vdist-y.h),e.arraylist.styleflags&b.ReverseCol?(S.vdist=e.arraylist.profile.h+y.v,S.v=e.arraylist.profile.hdist-y.v):(S.v=e.arraylist.profile.h+y.v,S.vdist=e.arraylist.profile.hdist-y.v)),S.h>m.frame.h&&(m.frame.h=S.h),S.v>m.frame.v&&(m.frame.v=S.v),S.hdist>m.frame.hdist&&(m.frame.hdist=S.hdist),S.vdist>m.frame.vdist&&(m.frame.vdist=S.vdist),o){if(e.vertical===this.vertical){let e=t?-y.v:y.v;for(let t=0;t<o;t++)m.steps.push(new Ca(p[t].h-y.h,p[t].v-e,p[t].hend-y.h,p[t].vend-e))}else{let n=i&&e.arraylist.styleflags&b.StartLeft?-y.h:y.h;if(t)for(let t=0;t<o;t++)m.steps.push(new Ca(p[t].v-n,-p[t].hend-y.v,p[t].vend-n,-p[t].h-y.v));else for(let t=0;t<o;t++)m.steps.push(new Ca(p[t].v-n,p[t].h-y.v,p[t].vend-n,p[t].hend-y.v))}}}}else if(childObj){let e=t?-y.v:y.v,i=childObj.arraylist.styleflags&b.StartLeft?-y.h:y.h;if(t)for(let t=0;t<p.length;t++)m.steps.push(new Ca(p[t].v-i,-p[t].hend-e,p[t].vend-i,-p[t].h-e));else for(let t=0;t<p.length;t++)m.steps.push(new Ca(p[t].v-i,p[t].h-e,p[t].vend-i,p[t].hend-e))}return F.Debug("S.Connector: GetElementProfile output",m),m}PrAdjustHooks(t,e){F.Debug("S.Connector: PrAdjustHooks called with startIndex:",t,"offsetAdjustment:",e);const i=me.ConnectorDefines.NSkip,o=this.arraylist.hook.length;for(let n=t;n<o;n++){const t=this.arraylist.hook[n];if(t.id>=0){const e=ws.GetObjectPtr(t.id,!0);if(e&&e.hooks.length){e.hooks[0].connect.x=n-i;const o=e.hooks[0].hookpt;e.hooks[0].hookpt=this.GetBestHook(t.id,o,e.hooks[0].connect),e.SetHookAlign(e.hooks[0].hookpt,o)}}}F.Debug("S.Connector: PrAdjustHooks completed")}PrAddHookedObject(t,e,i){let o,n;F.Debug("S.Connector: PrAddHookedObject called with objectId:",t,"hookPoint:",e,"textId:",i);let s=new Oa,a=!1;const r=me.AStyles,l=this.arraylist.styleflags&r.BothSides||0==(this.arraylist.styleflags&r.PerpConn),h=this.arraylist.styleflags&r.Linear,c=this.arraylist.styleflags&r.Radial;if(null!=this.arraylist){this.arraylist.matchsizelen=0;let r=ws.GetObjectPtr(t,!1);if(e===me.ConnectorDefines.StubHookPt)e=0,a=!0;else{if(-1===e||-2===e)return this.arraylist.hook[-e].id=t,void F.Debug("S.Connector: PrAddHookedObject early exit for negative hookPoint:",e);r.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector&&r.arraylist.angle&&(a=!0)}if(e>=0){if(this.vertical,o=this.arraylist.hook.length,o<me.ConnectorDefines.NSkip)for(let t=o;t<me.ConnectorDefines.NSkip;t++){let t=new Oa;l?1!==this.arraylist.hook.length||h||c?t.gap=this.arraylist.wd:t.gap=me.Common.CITreeSpaceExtra+this.arraylist.wd:1!==this.arraylist.hook.length||h||c?t.gap=this.arraylist.ht:t.gap=me.Common.CITreeSpaceExtra+this.arraylist.ht,this.arraylist.hook.push(t)}if(n=e+me.ConnectorDefines.NSkip,0===e&&i>=0&&h&&(0===this.hooks.length||this.hooks[0].hookpt!==me.HookPts.LL&&this.hooks[0].hookpt!==me.HookPts.LT)){let t=ye.stdObj.GetObject(i);t&&t.Delete(),i=-1}s.id=t,i&&(s.textid=i),o=this.arraylist.hook.length,o<n&&(n=o,a=!0),this.arraylist.hook.splice(n,0,s),o=this.arraylist.hook.length,a?this.PrAdjustHooks(n,0):(r=ws.GetObjectPtr(t,!0),r&&r.SetHookAlign(r.hooks[0].hookpt,r.hooks[0].hookpt)),this.PrAdjustHooks(n+1,1)}}F.Debug("S.Connector: PrAddHookedObject completed with objectId:",t)}PrRemoveHookedObject(t,e){F.Debug("S.Connector: PrRemoveHookedObject called with objectId:",t,"hookIndex:",e);let i=0;if(null!=this.arraylist){this.arraylist.matchsizelen=0;let t=this.arraylist.hook.length;if(e>=me.ConnectorDefines.NSkip&&e<t&&(e<t-1&&e>me.ConnectorDefines.NSkip&&(i=this.arraylist.hook[e].extra),this.arraylist.hook.splice(e,1)),this.arraylist.hook.length===me.ConnectorDefines.NSkip+2){let t=this.arraylist.hook[me.ConnectorDefines.NSkip+1];(this.arraylist.styleflags&me.AStyles.PerpConn)>0&&(0===t.extra&&0===i||(this.arraylist.wd+=t.extra+i,this.arraylist.wd<0&&(this.arraylist.wd=0),t.extra=0))}this.PrAdjustHooks(e,-1)}F.Debug("S.Connector: PrRemoveHookedObject completed for hookIndex:",e)}PrGetNBackBoneSegments(){F.Debug("S.Connector: PrGetNBackBoneSegments() called, input: none");let t=this.arraylist.hook.length-me.ConnectorDefines.NSkip;t<2&&(t=2);const e=t-1;return F.Debug("S.Connector: PrGetNBackBoneSegments() returning output:",e),e}PrGetStubIndex(){F.Debug("S.Connector: PrGetStubIndex called");let t=0;const e=me.AStyles,i=this.arraylist.styleflags&e.BothSides||0==(this.arraylist.styleflags&e.PerpConn),o=me.ConnectorDefines,n=me.HookPts;if(i&&this.hooks.length)switch(this.hooks[0].hookpt){case n.LL:case n.LT:t=o.ACl;break;default:t=o.ACr}return F.Debug("S.Connector: PrGetStubIndex returning output:",t),t}PrGetEndShapeIndex(){F.Debug("S.Connector: PrGetEndShapeIndex called");let t=0;const e=me.AStyles,i=me.ConnectorDefines,o=me.HookPts;if(this.arraylist.styleflags&e.EndConn&&this.hooks.length>0)switch(this.hooks[0].hookpt){case o.LL:case o.LT:t=i.ACr;break;default:t=i.ACl}return F.Debug("S.Connector: PrGetEndShapeIndex returning output:",t),t}PrAdjustFormat(t,e,i,o,n,s,a,r){F.Debug("S.Connector: PrAdjustFormat input:",{horizontalOffset:t,verticalOffset:e,gapAdjustment:i,actionTriggerType:o,actionTriggerData:n,backboneSegments:s,stubIndex:a,endShapeIndex:r});let l,h,c,p,d=0;const u=me.AStyles,g=this.arraylist.styleflags&u.BothSides||0==(this.arraylist.styleflags&u.PerpConn),y=this.arraylist.styleflags&u.BothSides&&0==(this.arraylist.styleflags&u.Stagger),S=this.arraylist.styleflags&u.Stagger&&this.vertical,m=this.arraylist.styleflags&u.Linear,b=this.arraylist.styleflags&u.ReverseCol,D=this.arraylist.styleflags&u.StartLeft,f=this.arraylist.styleflags&u.Radial,x=me.ConnectorDefines,C=[],P=[],T=[],O=[],v=[],w=this,k=function(t,e){let i,o=0,n=0;for(a!==x.ACl&&a!==x.ACr||(l=a,c=w.arraylist.hook[l],C[l]=c.startpoint.h,P[l]=c.gap+T[l],o++,T[l]<0?P[l]<-T[l]&&(i=P[l],i<0&&(i=0),n+=-T[l]+i,P[l]<0&&(P[l]=0),o--,T[l]=0):P[l]<T[l]&&(i=P[l],i<0&&(i=0),n+=T[l]-i,P[l]<0&&(P[l]=0),o--,T[l]=0)),l=t;l<e;l++)0!==T[l]&&(c=w.arraylist.hook[l],C[l]=c.startpoint.h,P[l]=w.arraylist.wd+c.extra,o++,T[l]<0?P[l]<-T[l]&&(i=P[l],i<0&&(i=0),n+=-T[l]+i,P[l]<0&&(P[l]=0),o--,T[l]=0):P[l]<T[l]&&(i=P[l],i<0&&(i=0),n+=T[l]-i,P[l]<0&&(P[l]=0),o--,T[l]=0));return o<=0&&(n=0),n/o},L=function(e,i,o){let n,s=2,r=!1,h=0;for(a===x.ACl?(l=a,n=w.arraylist.hook[l],O[l]=n.startpoint.h-n.endpoint.h,T[l]=t):a===x.ACr&&(l=a,n=w.arraylist.hook[l],O[l]=n.endpoint.h-n.startpoint.h,T[l]=-t),l=e;l<i;l++)n=w.arraylist.hook[l],T[l]=o?-t:t,O[l]=n.endpoint.h-n.startpoint.h;for(;Math.abs(s)>1;){if(s=k(e,i),Math.abs(s>1))for(l=e;l<i;l++)0!==T[l]&&(r=!0,T[l]+=s);if(!r)break}if(o){const t=w.arraylist.hook.length;for(a===x.ACr&&(h-=P[l=a]-O[l],C[l]+=h,v[t-1]=h),l=i-1;l>=e;l--)h-=P[l]-O[l],C[l]+=h,v[l-1]=h}else{for(a===x.ACl&&(h+=P[l=a]-O[l],C[l]+=h,C[x.NSkip]+=h,v[x.NSkip]=h,P[x.NSkip]=0),l=e+1;l<i;l++)h+=P[l-1]-O[l-1],C[l]+=h,v[l-1]=h;h+=P[i-1]-O[i-1],v[i-1]=h}},A=function(t,e,i){let o,n,s,h=0,p=0;const d=i?1:0,u=function(t){if(t!==x.ACl&&t!==x.ACr)return;if(o=t,n=w.arraylist.hook[o],C[o]=n.startpoint.h,t===x.ACl)P[o]=n.gap+T[o],C[x.NSkip]=n.startpoint.h;else{const t=w.arraylist.hook.length;P[o]=n.gap+T[o],t>x.NSkip&&(C[t-1]=n.startpoint.h,P[t-1]=0)}p++;let e=O[o]-ye.opt.ConnectorWidthList[o];T[o]<0?e<-T[o]&&(s=e,s<0&&(s=0),h+=-T[o]+s,P[o]<0&&(P[o]=0),p--,T[o]=0):P[o]<T[o]&&(s=P[o],s<0&&(s=0),h+=T[o]-s,P[o]<0&&(P[o]=0),p--,T[o]=0),P[o]+=ye.opt.ConnectorWidthList[o]};for(u(a),u(r),l=t;l<e;l++)y&&i&&l++,0!==T[l]&&(n=w.arraylist.hook[l],c=w.arraylist.hook[l+d],C[l]=f?n.endpoint.h:n.startpoint.h,P[l]=w.arraylist.wd+c.extra,p++,T[l]<0?P[l]<-T[l]&&(s=P[l],s<0&&(s=0),h+=-T[l]+s,P[l]<0&&(P[l]=0),p--,T[l]=0):P[l]<T[l]&&(s=P[l],s<0&&(s=0),h+=T[l]-s,P[l]<0&&(P[l]=0),p--,T[l]=0),P[l]+=ye.opt.ConnectorWidthList[l],y&&!i&&l++);return p<=0&&(h=0),h/p},I=function(e,i,o){let n,s,l=2,h=!1,c=0,p=0;if(a===x.ACl?(n=a,s=w.arraylist.hook[n],O[n]=s.startpoint.h-s.endpoint.h,T[n]=t):a===x.ACr&&(n=a,s=w.arraylist.hook[n],O[n]=s.endpoint.h-s.startpoint.h,T[n]=-t),r===x.ACl?(n=r,s=w.arraylist.hook[n],O[n]=s.startpoint.h-s.endpoint.h,T[n]=-t):r===x.ACr&&(n=r,s=w.arraylist.hook[n],O[n]=s.endpoint.h-s.startpoint.h,T[n]=t),o)for(y&&(p=1),n=e;n<i;n++)s=w.arraylist.hook[n],T[n+p]=-t,O[n+p]=w.arraylist.hook[n+1+p].endpoint.h-s.endpoint.h,y&&n++;else for(n=e;n<i;n++)s=w.arraylist.hook[n],T[n]=t,O[n]=s.endpoint.h-w.arraylist.hook[n-1].endpoint.h,y&&n++;for(;Math.abs(l)>1;){if(l=A(e,i,o),Math.abs(l>1))for(n=e;n<i;n++)0!==T[n]&&(h=!0,T[n]+=l),y&&n++;if(!h)break}const d=w.arraylist.hook.length;if(o){for(a===x.ACr&&(c-=P[n=a]-O[n],C[n]+=c,d>x.NSkip&&(v[d-1]=c,P[d-1]=0),P[n]-=ye.opt.ConnectorWidthList[n]),n=i-1;n>=e;n--)y&&n++,c-=P[n]-O[n],v[n]=c,C[n]+=c,y&&n--,y&&n--;r===x.ACl&&(c-=P[n=r]-O[n],C[n]+=c,v[n]=b?-c:c,P[n]-=ye.opt.ConnectorWidthList[n])}else{for(a===x.ACl&&(c+=P[n=a]-O[n],C[n]+=c,w.arraylist.hook.length>x.NSkip&&(C[x.NSkip]+=c,v[x.NSkip]=b?-c:c),P[x.NSkip]=0,P[n]-=ye.opt.ConnectorWidthList[n]),n=e;n<i;n++)c+=P[n]-O[n],v[n]=b?-c:c,C[n]+=c,y&&n++;r===x.ACr&&(c+=P[n=r]-O[n],C[n]+=c,v[x.ACr]=c,P[n]-=ye.opt.ConnectorWidthList[n])}for(n=e;n<i;n++)y&&o&&n++,P[n]=0};if(h=this.arraylist.hook.length,t){let e=y?2:1;if(d=t,b&&(t=-t),o===me.ActionTriggerType.ConnectorAdj){if(m&&a===x.ACr)for(l=n;l>x.NSkip;l--)c=this.arraylist.hook[l],m&&l===n||f||(c.startpoint.h+=d),c.endpoint.h+=d;else for(l=n;l<h;l++)c=this.arraylist.hook[l],m&&l===n||f||(c.startpoint.h+=d),c.endpoint.h+=d,this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle,c.endpoint.v+=d*this.arraylist.angle),y&&l<h-1&&(l++,c=this.arraylist.hook[l],c.startpoint.h+=d,c.endpoint.h+=d,this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle,c.endpoint.v+=d*this.arraylist.angle));m||f||(this.arraylist.hook[0].endpoint.h+=d,this.arraylist.angle&&(this.arraylist.hook[0].endpoint.v+=d*this.arraylist.angle))}else if(o===me.ActionTriggerType.LineStart){let t=!1;for(y&&h%2==0?(e=2,t=!0):e=y?3:1,m?L(x.NSkip,h-1-e+(m?1:0)+1,!0):I(x.NSkip+(m?1:0),h-1-e+(m?1:0)+1,!0),a===x.ACr&&(c=this.arraylist.hook[a],c.gap=P[a],d=C[a]-c.startpoint.h,c.startpoint.h=C[a],this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle),m||(e=0,h>x.NSkip&&(c=this.arraylist.hook[0],c.endpoint.h=C[a],this.arraylist.angle&&(c.endpoint.v+=d*this.arraylist.angle)))),l=h-1-e+(m?1:0);l>=x.NSkip+(m?1:0);l--)c=this.arraylist.hook[l],f?(d=C[l]-c.endpoint.h,c.endpoint.h=C[l]):(d=C[l]-c.startpoint.h,c.startpoint.h=C[l],this.arraylist.tilt?c.endpoint.h=c.endpoint.h+d:c.endpoint.h=c.startpoint.h+P[l]),this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle,c.endpoint.v+=d*this.arraylist.angle),p=c,y&&l>x.NSkip&&!t&&(l--,c=this.arraylist.hook[l],c.startpoint.h+=d,c.endpoint.h+=d,this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle,c.endpoint.v+=d*this.arraylist.angle)),t=!1;m||f||(this.arraylist.hook[0].startpoint.h+=d,this.arraylist.angle&&(this.arraylist.hook[0].startpoint.v+=d*this.arraylist.angle,this.arraylist.hook[x.ACl].endpoint.h!=this.arraylist.hook[x.ACl].startpoint.h&&(l=x.ACl,c=this.arraylist.hook[x.ACl],c.gap=P[l],d=C[l]-c.startpoint.h,h>x.NSkip?(c.startpoint.h=this.arraylist.hook[x.NSkip].endpoint.h,c.startpoint.v=this.arraylist.hook[x.NSkip].startpoint.v):(c.startpoint.h=this.arraylist.hook[x.ACr].startpoint.h,c.startpoint.v=this.arraylist.hook[x.ACr].startpoint.v),c.endpoint.h=c.startpoint.h-P[x.ACl],this.arraylist.angle&&(c.endpoint.v+=d*this.arraylist.angle))))}else{for(m?(a===x.ACl&&(e=0),L(x.NSkip+e,h,!1)):I(x.NSkip+e,h,!1),a===x.ACl&&(e=0,c=this.arraylist.hook[a],c.gap=P[a],d=C[a]-c.startpoint.h,c.startpoint.h=C[a],this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle),!m&&h>x.NSkip&&(c=this.arraylist.hook[0],c.startpoint.h=C[a],this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle))),l=x.NSkip+e;l<h;l++)c=this.arraylist.hook[l],f?(d=C[l]-c.endpoint.h,c.endpoint.h=C[l]):(d=C[l]-c.startpoint.h,c.startpoint.h=C[l],c.endpoint.h=c.startpoint.h+P[l]),this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle,c.endpoint.v+=d*this.arraylist.angle),p=c,y&&l<h-1&&(l++,c=this.arraylist.hook[l],c.startpoint.h=p.startpoint.h,c.endpoint.h=p.endpoint.h,this.arraylist.angle&&(c.startpoint.v+=d*this.arraylist.angle,c.endpoint.v+=d*this.arraylist.angle));m||f||(this.arraylist.hook[0].endpoint.h+=d,this.arraylist.angle&&(this.arraylist.hook[0].endpoint.v+=d*this.arraylist.angle,this.arraylist.hook[x.ACr].endpoint.h!=this.arraylist.hook[x.ACr].startpoint.h&&(c=this.arraylist.hook[x.ACr],l=x.ACr,c.gap=P[l],d=C[l]-c.startpoint.h,h>x.NSkip?(c.startpoint.h=this.arraylist.hook[h-1].endpoint.h,c.startpoint.v=this.arraylist.hook[h-1].startpoint.v):(c.startpoint.h=this.arraylist.hook[x.ACl].startpoint.h,c.startpoint.v=this.arraylist.hook[x.ACl].startpoint.v),c.endpoint.h=c.startpoint.h+P[l],this.arraylist.angle&&(c.endpoint.v+=d*this.arraylist.angle))))}}if(e){const t=this.GetTilt();for(l=x.NSkip;l<h;l++)c=this.arraylist.hook[l],S&&D?c.endpoint.v-=e:c.endpoint.v+=e,t&&(c.endpoint.h-=e),y&&l<h-1&&(l++,c=this.arraylist.hook[l],c.endpoint.v-=e,t&&(c.endpoint.h-=e))}if(i)if(g)for(b&&(i=-i),this.arraylist.hook[0].startpoint.h+=i,this.arraylist.hook[0].endpoint.h+=i,l=x.NSkip;l<h;l++)c=this.arraylist.hook[l],c.startpoint.h+=i,c.endpoint.h+=i;else for(this.arraylist.hook[0].startpoint.v+=i,this.arraylist.hook[0].endpoint.v+=i,l=x.NSkip;l<h;l++)c=this.arraylist.hook[l],c.startpoint.v+=i,c.endpoint.v+=i;const E={linestart:C,linelen:P,linedisp:v};return F.Debug("S.Connector: PrAdjustFormat output:",E),E}PrGetShapeConnectorInfo(t){let e,i;F.Debug("S.Connector: PrGetShapeConnectorInfo called with input:",t);let o=0;const n=me.AStyles,s=Boolean(this.arraylist.styleflags&n.BothSides||0==(this.arraylist.styleflags&n.PerpConn)),a=Boolean(this.arraylist.styleflags&n.BothSides),r=me.ConnectorDefines,l=me.HookPts,h=me.ActionTriggerType,c=Boolean(this.arraylist.styleflags&n.Linear),p=[];if(s&&this.hooks.length)switch(e=this.hooks[0],e.hookpt){case l.LL:case l.LT:o=r.ACl;break;default:o=r.ACr}let d=t.connect.x;if(this.vertical)if(c)if(o===r.ACr){let e=t.hookpt;d+r.NSkip<this.arraylist.hook.length-1?d>=0&&(i={knobID:h.ConnectorAdj,cursorType:ze.CursorType.ResizeT,knobData:d+r.NSkip+1,hook:e,polyType:"vertical",position:"bottom"},p.push(i)):(i={knobID:h.ConnectorHook,cursorType:ze.CursorType.ResizeT,knobData:r.ACr,hook:e,polyType:"vertical",position:"bottom"},p.push(i))}else d>0?(i={knobID:h.ConnectorAdj,cursorType:ze.CursorType.ResizeT,knobData:d+r.NSkip,hook:t.hookpt,polyType:"vertical"},p.push(i)):o===r.ACl&&(i={knobID:h.ConnectorHook,cursorType:ze.CursorType.ResizeT,knobData:r.ACl,hook:t.hookpt,polyType:"vertical"},p.push(i));else i={knobID:h.ConnectorRerp,cursorType:ze.CursorType.ResizeR,knobData:t.connect.x,hook:t.hookpt,polyType:"horizontal"},p.push(i),a&&d%2!=0&&d--,d>0?(i={knobID:h.ConnectorAdj,cursorType:ze.CursorType.ResizeT,knobData:d+r.NSkip,hook:t.hookpt,polyType:"vertical"},p.push(i)):o===r.ACl&&(i={knobID:h.ConnectorHook,cursorType:ze.CursorType.ResizeT,knobData:r.ACl,hook:t.hookpt,polyType:"vertical"},p.push(i));else if(c)if(o===r.ACr){let e=t.hookpt;d+r.NSkip<this.arraylist.hook.length-1?d>=0&&(i={knobID:h.ConnectorAdj,cursorType:ze.CursorType.ResizeR,knobData:d+r.NSkip+1,hook:e,polyType:"horizontal",position:"right"},p.push(i)):(i={knobID:h.ConnectorHook,cursorType:ze.CursorType.ResizeR,knobData:r.ACr,hook:e,polyType:"horizontal",position:"right"},p.push(i))}else d>0?(i={knobID:h.ConnectorAdj,cursorType:ze.CursorType.ResizeR,knobData:d+r.NSkip,hook:t.hookpt,polyType:"horizontal"},p.push(i)):o===r.ACl&&(i={knobID:h.ConnectorHook,cursorType:ze.CursorType.ResizeR,knobData:r.ACl,hook:t.hookpt,polyType:"horizontal"},p.push(i));else i={knobID:h.ConnectorRerp,cursorType:ze.CursorType.ResizeT,knobData:t.connect.x,hook:t.hookpt,polyType:"vertical"},p.push(i),a&&d%2!=0&&d--,d>0?(i={knobID:h.ConnectorAdj,cursorType:ze.CursorType.ResizeR,knobData:d+r.NSkip,hook:t.hookpt,polyType:"horizontal"},p.push(i)):o===r.ACl&&(i={knobID:h.ConnectorHook,cursorType:ze.CursorType.ResizeR,knobData:r.ACl,hook:e.hookpt,polyType:"horizontal"},p.push(i));return F.Debug("S.Connector: PrGetShapeConnectorInfo returning output:",p),p}GetConnectorOrientation(t){F.Debug("S.Connector: GetConnectorOrientation called with isReversed:",t);const e=me.AStyles;let i=Boolean(this.arraylist.styleflags&e.StartLeft);let o;return Boolean(this.arraylist.styleflags&e.BothSides||0==(this.arraylist.styleflags&e.PerpConn))&&(i=!1,t&&(i=!0)),o=this.vertical?i?we.Shape.ConnectorDir.ORG_HORIZONTALRIGHT:we.Shape.ConnectorDir.ORG_HORIZONTAL:i?we.Shape.ConnectorDir.ORG_VERTICALUP:we.Shape.ConnectorDir.ORG_VERTICALDOWN,F.Debug("S.Connector: GetConnectorOrientation result:",o),o}IsFlowChartConnector(){F.Debug("S.Connector: IsFlowChartConnector called");const t=me.AStyles,e=(this.arraylist.styleflags&t.FlowConn)>0;return F.Debug("S.Connector: IsFlowChartConnector result:",e),e}IsOrgChartConnector(t){F.Debug("S.Connector: IsOrgChartConnector called with allowedTypes:",t);let e=0===this.objecttype;if(t)for(let o=0;o<t.length;o++)if(this.objecttype===t[o]){e=!0;break}const i=!this.IsFlowChartConnector()&&e;return F.Debug("S.Connector: IsOrgChartConnector result:",i),i}IsCauseAndEffectChartConnector(){F.Debug("S.Connector: IsCauseAndEffectChartConnector called");const t=Se.FNObjectTypes,e=this.objecttype===t.CauseEffectMain;return F.Debug("S.Connector: IsCauseAndEffectChartConnector result:",e),e}IsOrgChartTypeConnector(){F.Debug("S.Connector: IsOrgChartTypeConnector called");let t=!1;return this.objecttype,t=!1,F.Debug("S.Connector: IsOrgChartTypeConnector result:",t),t}FixHook(t,e){F.Debug("S.Connector: FixHook called with preserveOriginalPosition:",t,"forceCoManagerUpdate:",e);const i=me.AStyles,o=me.Common.DimMax,n=Boolean(this.arraylist.styleflags&i.StartLeft),s=Boolean(this.arraylist.styleflags&i.BothSides||0==(this.arraylist.styleflags&i.PerpConn)),a=Boolean(this.arraylist.styleflags&i.BothSides),r=Boolean(this.arraylist.styleflags&i.ReverseCol),l={x:this.hooks[0].connect.x,y:this.hooks[0].connect.y};let h=!1;if(this.hooks.length){if(!t){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);t&&t.IsCoManager(null)&&(e||(h=!0))}const i=this.hooks[0].hookpt===me.HookPts.LL||this.hooks[0].hookpt===me.HookPts.LT;Ps.SetLinkFlag(this.hooks[0].objid,Ee.LinkFlags.Move),this.vertical?s?n?(i?(this.hooks[0].connect.y=r?0:o,this.hooks[0].hookpt=me.HookPts.LT):(this.hooks[0].connect.y=0,this.hooks[0].hookpt=me.HookPts.LB),this.hooks[0].connect.x=a?o/2:3*o/4):(i?(this.hooks[0].connect.y=r?0:o,this.hooks[0].hookpt=me.HookPts.LT):(this.hooks[0].connect.y=0,this.hooks[0].hookpt=me.HookPts.LB),this.hooks[0].connect.x=a?o/2:o/4):n?(this.hooks[0].connect.x=0,this.hooks[0].hookpt=me.HookPts.LR,this.hooks[0].connect.y=o/2):(this.hooks[0].connect.x=o,this.hooks[0].hookpt=me.HookPts.LL,this.hooks[0].connect.y=o/2):s?(i?(this.hooks[0].connect.x=o,this.hooks[0].hookpt=me.HookPts.LL):(this.hooks[0].connect.y=0,this.hooks[0].hookpt=me.HookPts.LR),this.hooks[0].connect.x=o/2):n?(this.hooks[0].connect.y=0,this.hooks[0].hookpt=me.HookPts.LB,this.hooks[0].connect.x=o/2):(this.hooks[0].connect.y=o,this.hooks[0].hookpt=me.HookPts.LT,this.hooks[0].connect.x=o/2),t&&(this.hooks[0].connect.x=l.x,this.hooks[0].connect.y=l.y),h&&(this.hooks[0].connect.y=-me.AStyles.CoManager)}F.Debug("S.Connector: FixHook completed with hook position:",this.hooks[0].connect,"hook point:",this.hooks[0].hookpt)}SetDirection(t,e,i){F.Debug("S.Connector: SetDirection called with invertStyle:",t,"toggleOrientation:",e,"propagate:",i);const o=me.AStyles,n=me.ConnectorDefines.NSkip;let s=this.arraylist.styleflags&o.BothSides||0==(this.arraylist.styleflags&o.PerpConn);const a=this.arraylist.styleflags&o.CoManager,r=this.arraylist.styleflags&o.ReverseCol;let l=!1;const h=this.arraylist.hook.length;if(e&&(s?(l=(this.arraylist.styleflags&me.AStyles.ReverseCol)>0,this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.PerpConn,!0),this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.StartLeft,!1),this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.ReverseCol,!1),this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.BothSides,!1),s=!1):this.vertical=!this.vertical),this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.ReverseCol,!1),t)if(s)this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.ReverseCol,0===r);else{if(a&&i){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);t&&(t.arraylist.styleflags&o.BothSides||(t.arraylist.styleflags,o.PerpConn))}l||(this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.StartLeft,0==(this.arraylist.styleflags&me.AStyles.StartLeft)))}else l&&(this.arraylist.styleflags=ve.SetFlag(this.arraylist.styleflags,me.AStyles.StartLeft,!0));Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move|Ee.LinkFlags.Change),this.flags=ve.SetFlag(this.flags,Se.ObjFlags.Obj1,!0),this.FixHook(i,!1);for(let c=n;c<h;c++){const i=this.arraylist.hook[c],o=ws.GetObjectPtr(i.id,!0);if(o&&o.hooks.length)if(o.hooks[0].hookpt=this.GetBestHook(i.id,o.hooks[0].hookpt,o.hooks[0].connect),Ps.SetLinkFlag(i.id,Ee.LinkFlags.Move),o.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector)o.SetDirection(t,e,!0);else{const o=ye.opt.FindChildArray(i.id,-1);if(o>=0){const i=ws.GetObjectPtr(o,!0);i&&i.SetDirection(t,e,!1)}}}F.Debug("S.Connector: SetDirection completed")}SetSpacing(t,e){F.Debug("S.Connector: SetSpacing called with adjustPrimaryDimension:",t,"spacingValue:",e);let i,o,n=e,s=this.arraylist.hook.length;const a=me.AStyles;let r=this.arraylist.styleflags&a.BothSides||0==(this.arraylist.styleflags&a.PerpConn);const l=this.arraylist.styleflags&a.CoManager,h=me.ConnectorDefines.NSkip,c=function(t,e){for(let o=h;o<s;o++)i=t.hook[o],i.extra+e<0&&(i.extra=-e)};if(l&&this.vertical!==t&&(n=e/2),this.hooks.length)switch(this.hooks[0].hookpt){case me.HookPts.LT:case me.HookPts.LB:t&&(o=null,r?(i=s>2?this.hooks[0].hookpt===me.HookPts.LT?this.arraylist.hook[me.ConnectorDefines.ACl]:this.arraylist.hook[me.ConnectorDefines.ACr]:this.arraylist.hook[me.ConnectorDefines.ABk],null!==o?i.gap=o:(i.gap+=n-this.arraylist.wd,i.gap<0&&(i.gap=0))):(i=s>2?this.arraylist.hook[me.ConnectorDefines.ACl]:this.arraylist.hook[me.ConnectorDefines.ABk],null!==o?i.gap=o:(i.gap+=n-this.arraylist.ht,i.gap<0&&(i.gap=0))));break;case me.HookPts.LL:case me.HookPts.LR:t||(o=null,r?(i=s>2?this.hooks[0].hookpt===me.HookPts.LL?this.arraylist.hook[me.ConnectorDefines.ACl]:this.arraylist.hook[me.ConnectorDefines.ACr]:this.arraylist.hook[me.ConnectorDefines.ABk],null!==o?i.gap=o:(i.gap+=n-this.arraylist.wd,i.gap<0&&(i.gap=0))):(i=s>2?this.arraylist.hook[me.ConnectorDefines.ACl]:this.arraylist.hook[me.ConnectorDefines.ABk],null!==o?i.gap=o:(i.gap+=n-this.arraylist.ht,i.gap<0&&(i.gap=0))))}this.vertical?t?(F.Debug("S.Connector: Setting width to",n),this.arraylist.wd=n,c(this.arraylist,n)):(F.Debug("S.Connector: Setting height to",n),this.arraylist.ht=n):t?(F.Debug("S.Connector: Setting height to",n),this.arraylist.ht=n):(F.Debug("S.Connector: Setting width to",n),this.arraylist.wd=n,c(this.arraylist,n)),F.Debug("S.Connector: SetSpacing completed")}CollapseConnector(t,e,i){F.Debug("S.Connector: CollapseConnector called with collapseState:",t,"updateLinkFlags:",e,"propagateCollapse:",i);var o,n,s,a=Se.ObjFlags.NotVisible,r=me.ExtraFlags.CollapseConn,l=[];-1==t&&(t=0==(this.extraflags&r));var h=this.extraflags&r;if(e&&(h&&0==(this.flags&a)?(t=!0,this.extraflags=ve.SetFlag(this.extraflags,r,!1)):!h&&this.flags&a?(t=!1,this.extraflags=ve.SetFlag(this.extraflags,r,!0)):t=(this.extraflags&r)>0),i&&this.hooks.length>0&&Ps.SetLinkFlag(this.hooks[0].objid,Ee.LinkFlags.Move),(this.extraflags&r)>0!=t||!i){(i||e)&&Ps.SetLinkFlag(this.BlockID,Ee.LinkFlags.Move),!i&&t?this.flags=ve.SetFlag(this.flags,a,t):0===h&&(this.flags=ve.SetFlag(this.flags,a,!1)),ws.AddToDirtyList(this.BlockID),ye.opt.dirtyListReOrder=!0,this.flags&a&&(l.push(this.BlockID),ye.opt.DeSelect(l));for(var c=this.arraylist.hook.length,p=me.ConnectorDefines.NSkip;p<c;p++)if(this.arraylist.hook[p].id>=0&&(o=ws.GetObjectPtr(this.arraylist.hook[p].id,!0)))switch(o.DrawingObjectBaseClass){case me.DrawObjectBaseClass.Connector:o.CollapseConnector(t,e,i);break;default:if(i||t?o.flags=ve.SetFlag(o.flags,a,t):0===h&&(o.flags=ve.SetFlag(o.flags,a,!1)),ws.AddToDirtyList(this.arraylist.hook[p].id),ye.opt.dirtyListReOrder=!0,o.flags&a&&l.push(this.arraylist.hook[p].id),o.flags&a&&!1!==t)break;(n=ye.opt.FindChildArray(this.arraylist.hook[p].id,-1))>=0&&(ws.GetObjectPtr(n,!0).CollapseConnector(t,e,!1),(s=ye.opt.FindChildArray(this.arraylist.hook[p].id,n))>=0&&ws.GetObjectPtr(s,!0).CollapseConnector(t,e,!1))}ye.opt.DeSelect(l),this.PrFormat(this.BlockID)}F.Debug("S.Connector: CollapseConnector completed for BlockID:",this.BlockID,"with collapseState:",t)}MatchSize(t,e){let i;F.Debug("S.Connector: MatchSize called with applyNewWidth:",t,"newWidth:",e);const o=this.arraylist.hook.length;let n,s,a;const r=[],l=me.ConnectorDefines.NSkip,h=me.ConnectorDefines,c=me.HookPts;let p=!1,d=!1;function u(t,e,i,o){this.cobj=t,this.bkdist=e,this.stubindex=i,this.stubdist=o}for(i=l;i<o;i++)if(n=ws.GetObjectPtr(this.arraylist.hook[i].id,!1),n&&n.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector){void 0===s?s=n.arraylist.wd:ve.IsEqual(s,n.arraylist.wd)||(p=!0,n.arraylist.wd>s&&(s=n.arraylist.wd));const t=n.arraylist.hook[h.A_Bk].endpoint.h-n.arraylist.hook[h.A_Bk].startpoint.h,e=n.hooks[0].hookpt===c.SED_LL||n.hooks[0].hookpt===c.SED_LT?h.A_Cr:h.A_Cl,i=Math.abs(n.arraylist.hook[e].endpoint.h-n.arraylist.hook[e].startpoint.h),o=t+i;void 0===a?a=o:ve.IsEqual(o,a)||(d=!0,o>a&&(a=o));const l=new u(n,t,e,i);r.push(l)}if(t&&(ve.IsEqual(s,e)||(s=e,p=!0)),p){const t=r.length;for(a=void 0,d=!0,i=0;i<t;i++){n=ws.GetObjectPtr(r[i].cobj.BlockID,!0),n.arraylist.matchsizelen=0,Ps.SetLinkFlag(n.BlockID,Ee.LinkFlags.Move);const t=n.hooks[0].hookpt===c.LL||n.hooks[0].hookpt===c.LT?h.ACl:h.ACr;n.arraylist.hook[t].gap=s,n.PrFormat(n.BlockID);const e=n.arraylist.hook[h.ABk].endpoint.h-n.arraylist.hook[h.ABk].startpoint.h,o=Math.abs(n.arraylist.hook[r[i].stubindex].endpoint.h-n.arraylist.hook[r[i].stubindex].startpoint.h);r[i].bkdist=e,r[i].stubdist=o;const l=e+o;(void 0===a||!ve.IsEqual(l,a)&&l>a)&&(a=l)}}if(d){const t=r.length;if(!p)for(a=void 0,i=0;i<t;i++){n=ws.GetObjectPtr(r[i].cobj.BlockID,!0),n.arraylist.matchsizelen=0,Ps.SetLinkFlag(n.BlockID,Ee.LinkFlags.Move),n.PrFormat(n.BlockID),r[i].bkdist=n.arraylist.hook[h.ABk].endpoint.h-n.arraylist.hook[h.ABk].startpoint.h,r[i].stubdist=Math.abs(n.arraylist.hook[r[i].stubindex].endpoint.h-n.arraylist.hook[r[i].stubindex].startpoint.h);const t=r[i].bkdist+r[i].stubdist;(void 0===a||!ve.IsEqual(t,a)&&t>a)&&(a=t)}for(i=0;i<t;i++){const t=r[i].bkdist+r[i].stubdist;ve.IsEqual(t,a)||(n=r[i].cobj,n.arraylist.matchsizelen=a,n.PrFormat(n.BlockID))}}F.Debug("S.Connector: MatchSize completed with reference width:",s,"max combined distance:",a)}FoundText(t,e,i){F.Debug("S.Connector: FoundText called with searchText:",t,"length:",e,"blockID:",i);let o=0;const n=this.arraylist.hook.length,s=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(null!=s){i===this.BlockID&&(o=this.arraylist.lasttexthook+1);for(let i=o;i<n;i++)if(this.arraylist.hook[i].textid>=0){const o=s.GetElementById(me.SVGElementClass.Text,i);if(o&&o.GetText(0).search(t)>=0)return this.arraylist.lasttexthook=i,on.ActivateTextEdit(s),o.SetSelectedRange(o.GetText(0).search(t),o.GetText(0).search(t)+e),F.Debug("S.Connector: FoundText found text at hook index:",i),!0}}return F.Debug("S.Connector: FoundText did not find the text"),!1}FieldDataAllowed(){F.Debug("S.Connector: Checking if field data is allowed");return F.Debug("S.Connector: Field data allowed:",false),false}},D3Symbol:Aa,FreehandLine:class extends es{constructor(t){(t=t||{}).LineType=me.LineType.FREEHAND,t.TextFlags=t.TextFlags|Se.TextFlags.None,super(t),a(this,"StartPoint"),a(this,"EndPoint"),a(this,"pointlist"),this.TextFlags=t.TextFlags||0,this.StartPoint=t.StartPoint||{x:0,y:0},this.EndPoint=t.EndPoint||{x:0,y:0},this.pointlist=t.pointlist||[],this.RotationAngle=t.RotationAngle||0,this.flags=t.flags||0,this.CalcFrame()}GetFreehandPoints(t){let e=[],i=this.StartPoint.x,o=this.StartPoint.y;if(!0===t&&(i-=this.Frame.x,o-=this.Frame.y),this.pointlist)for(let n=0;n<this.pointlist.length;n++){const t=this.pointlist[n];let s={x:t.x+i,y:t.y+o};e.push(s)}return e}CalcFrame(){let t={width:0,height:0,x:0,y:0},e=[];this.pointlist&&this.pointlist.length&&(e=this.GetFreehandPoints(!1),ve.GetPolyRect(t,e),t.width<1&&(t.width=1),t.height<1&&(t.height=1),this.Frame=Oe.DeepCopy(t)),this.UpdateFrame(this.Frame)}GetDimensionsForDisplay(){return{x:this.Frame.x,y:this.Frame.y,width:this.Frame.width,height:this.Frame.height}}GetSVGFrame(t){var e={};return null==t&&(t=this.Frame),ve.CopyRect(e,t),e}UpdateDrawing(t){var e=t.GetElementById(me.SVGElementClass.Shape),i=t.GetElementById(me.SVGElementClass.Slop);this.CalcFrame();var o=this.GetFreehandPoints(!0);t.SetSize(this.Frame.width,this.Frame.height),t.SetPos(this.Frame.x,this.Frame.y),e.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(e,o),i.SetSize(this.Frame.width,this.Frame.height),this.UpdateSVG(i,o)}UpdateSVG(t,e){var i,o=e.length;if(t&&t.PathCreator){(i=t.PathCreator()).BeginPath(),o>1&&i.MoveTo(e[0].x,e[0].y);for(let t=1;t<o;t++)i.LineTo(e[t].x,e[t].y);i.Apply()}}CreateShape(t,e){if(this.flags&Se.ObjFlags.NotVisible)return null;let i=[],o=t.CreateShape(me.CSType.ShapeContainer),n=t.CreateShape(me.CSType.Path);n.SetID(me.SVGElementClass.Shape);let s=t.CreateShape(me.CSType.Path);s.SetID(me.SVGElementClass.Slop),s.ExcludeFromExport(!0),this.CalcFrame();let a=this.Frame,r=this.StyleRecord;if(r=this.SVGTokenizerHook(r),null==r){let t=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1);t&&(r=t.def.style)}let l=a.width,h=a.height;o.SetSize(l,h),o.SetPos(this.Frame.x,this.Frame.y),n.SetSize(l,h),i=this.GetFreehandPoints(!0),this.UpdateSVG(n,i);let c=r.Line.Paint.Color,p=r.Line.Thickness;r.Line.Thickness>0&&r.Line.Thickness<1&&(p=1);let d=r.Line.Paint.Opacity;return n.SetFillColor("none"),n.SetStrokeColor(c),n.SetStrokeOpacity(d),n.SetStrokeWidth(p),s.SetSize(l,h),this.UpdateSVG(s,i),s.SetStrokeColor("white"),s.SetFillColor("none"),s.SetOpacity(0),e?s.SetEventBehavior(me.EventBehavior.HiddenOut):s.SetEventBehavior(me.EventBehavior.None),s.SetStrokeWidth(p+me.Common.Slop),o.AddElement(n),o.AddElement(s),this.ApplyStyles(n,r),this.ApplyEffects(o,!1,!0),o.isShape=!0,o}PostCreateShapeCallback(t,e,i,o){}CreateActionTriggers(t,e,i,o){let n=me.Common.KnobSize,s=t.CreateShape(me.CSType.Group),a=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(a*=2);let r=n/a,l=this.Frame,h=l.width,c=l.height;ws.GetObjectPtr(e,!1),h+=r,c+=r;let p=Oe.DeepCopy(l);p.x-=r/2,p.y-=r/2,p.width+=r,p.height+=r;let d={svgDoc:t,shapeType:me.CSType.Rect,knobSize:r,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",cursorType:ze.CursorType.ResizeLT,locked:!1};e!==o&&(d.fillColor="white",d.strokeSize=1,d.strokeColor="black",d.fillOpacity=0),d.knobID=me.ActionTriggerType.TopLeft,d.cursorType=ze.CursorType.ResizeLT;let u=this.GenericKnob(d);return s.AddElement(u),d.x=h-r,d.y=0,d.cursorType=ze.CursorType.ResizeRT,d.knobID=me.ActionTriggerType.TopRight,u=this.GenericKnob(d),s.AddElement(u),d.x=h-r,d.y=c-r,d.cursorType=ze.CursorType.ResizeRB,d.knobID=me.ActionTriggerType.BottomRight,u=this.GenericKnob(d),s.AddElement(u),d.x=0,d.y=c-r,d.cursorType=ze.CursorType.ResizeLB,d.knobID=me.ActionTriggerType.BottomLeft,u=this.GenericKnob(d),s.AddElement(u),s.SetSize(h,c),s.SetPos(p.x,p.y),s.isShape=!0,s.SetID(me.Common.Action+e),s}ModifyShape(t,e,i,o,n){let s={x:e,y:i},a=Oe.DeepCopy(ye.opt.actionBBox),r=0,l=0;switch(ye.opt.actionTriggerId){case me.ActionTriggerType.TopLeft:r=a.x-e,l=a.y-i,a.x=e,a.y=i,a.width+=r,a.height+=l,a.width<0&&(a.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,a.width=-a.width),a.height<0&&(a.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,a.height=-a.height),ye.opt.actionNewBBox=Oe.DeepCopy(a),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,s);break;case me.ActionTriggerType.TopRight:l=a.y-i,a.y=i,a.height=a.height+l,a.width=e-a.x,a.width<0&&(a.x=e,a.width=-a.width),a.height<0&&(a.y=ye.opt.actionBBox.y+ye.opt.actionBBox.height,a.height=-a.height),ye.opt.actionNewBBox=Oe.DeepCopy(a),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,s);break;case me.ActionTriggerType.BottomRight:a.width=e-a.x,a.height=i-a.y,a.width<0&&(a.x=e,a.width=-a.width),a.height<0&&(a.y=i,a.height=-a.height),ye.opt.actionNewBBox=Oe.DeepCopy(a),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,s);break;case me.ActionTriggerType.BottomLeft:a.height=i-a.y,r=a.x-e,a.x=e,a.width+=r,a.width<0&&(a.x=ye.opt.actionBBox.x+ye.opt.actionBBox.width,a.width=-a.width),a.height<0&&(a.y=i,a.height=-a.height),ye.opt.actionNewBBox=Oe.DeepCopy(a),this.HandleActionTriggerCallResize(ye.opt.actionNewBBox,!0,s)}}SetSize(t,e,i){let o,n,s={};s.x=this.Frame.x,s.y=this.Frame.y,s.width=this.Frame.width,s.height=this.Frame.height,t&&(s.width=t),e&&(s.height=e),(t||e)&&(o=ye.opt.actionBBox,n=ye.opt.actionNewBBox,ye.opt.actionBBox=Oe.DeepCopy(this.Frame),ye.opt.actionNewBBox=Oe.DeepCopy(this.Frame),this.HandleActionTriggerCallResize(s,i,null),ye.opt.actionBBox=o,ye.opt.actionNewBBox=n,ws.AddToDirtyList(this.BlockID),this.rflags&&(t&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Width,!1)),e&&(this.rflags=ve.SetFlag(this.rflags,Se.FloatingPointDim.Height,!1))))}HandleActionTriggerCallResize(t,e,i){this.prevBBox=Oe.DeepCopy(this.Frame);let o=Oe.DeepCopy(this.Frame);t.width<me.Common.MinDim&&(t.width=me.Common.MinDim),t.height<me.Common.MinDim&&(t.height=me.Common.MinDim);let n=1,s=1;t.width&&!ve.IsEqual(this.Frame.width,0)&&(n=t.width/this.Frame.width),t.height&&!ve.IsEqual(this.Frame.height,0)&&(s=t.height/this.Frame.height);let a=t.x-o.x,r=t.y-o.y;this.StartPoint.x+=a,this.StartPoint.y+=r;let l=this.pointlist.length;for(let h=0;h<l;h++)this.pointlist[h].x*=n,this.pointlist[h].y*=s;if(this.CalcFrame(),e===me.ActionTriggerType.LineLength&&(e=0,noMin=!0),ye.opt.actionStoredObjectId===this.BlockID&&i&&Ts.UpdateDisplayCoordinates(t,i,ze.CursorTypes.Grow,this),e&&ye.opt.actionSvgObject&&ye.opt.actionStoredObjectId===this.BlockID){if(null===ye.opt.actionSvgObject)return;this.prevBBox,Oe.DeepCopy(this.trect),this.UpdateDrawing(ye.opt.actionSvgObject)}}AllowHook(t,e,i){return!1}AllowLink(){return!1}PreventLink(){return!0}NoRotate(){return!0}CustomSnap(t){return!0}AdjustLineEnd(t,e,i,o){let n=this.pointlist[this.pointlist.length-1],s=e-n.x,a=i-n.y;if(Math.sqrt(s*s+a*a)>3){let t=e-this.StartPoint.x,o=i-this.StartPoint.y,n=new De(t,o);this.pointlist.push(n)}this.AdjustLine(t,e,i,o)}AdjustLine(t,e,i,o){t?this.UpdateDrawing(t):this.CalcFrame()}LMActionDuringTrack(t){return t}LMDrawDuringTrack(t){return t}LMDrawRelease(t){t&&(ve.StopPropagationAndDefaults(t),t.gesture.stopDetect()),rn.UnbindActionClickHammerEvents(),Rt(window).unbind("mousemove"),ye.opt.WorkAreaHammer.on("tap",Ls.Evt_WorkAreaHammerClick),this.ResetAutoScrollTimer(),Oe.DeepCopy(ye.opt.drawShape.StyleRecord),ye.opt.drawShape.StartArrowID,ye.opt.drawShape.EndArrowID,ye.opt.drawShape.StartArrowDisp,ye.opt.drawShape.ArrowSizeIndex,ye.opt.drawShape.TextGrow,ye.opt.drawShape.TextAlign,ye.opt.drawShape.TextDirection,ye.opt.drawShape.Dimensions,Oe.DeepCopy(ye.opt.drawShape.StartPoint),Oe.DeepCopy(ye.opt.drawShape.EndPoint),Oe.DeepCopy(ye.opt.drawShape.Frame),this.pointlist&&Oe.DeepCopy(this.pointlist),Oe.DeepCopy(ye.opt.linkParams),this.LMDrawPostRelease(ye.opt.actionStoredObjectId),xs.PostObjectDraw()}LMDrawClick(t,e){F.Debug("= s.FreehandLine LMDrawClick mouseX, mouseY=>",t,e);try{this.Frame.x=t,this.Frame.y=e,this.Frame.width=0,this.Frame.height=0,this.StartPoint={x:t,y:e},this.EndPoint={x:t,y:e},ye.opt.WorkAreaHammer.off("dragstart"),ye.opt.WorkAreaHammer.on("drag",Ls.Evt_DrawTrackHandlerFactory(this)),ye.opt.WorkAreaHammer.on("dragend",Ls.Evt_DrawReleaseHandlerFactory(this))}catch(i){throw this.LMDrawClickExceptionCleanup(i),ye.opt.ExceptionCleanup(i),i}}},GroupSymbol:class extends us{constructor(t){(t=t||{}).ShapeType=me.ShapeType.GroupSymbol,t.flags=Se.ObjFlags.ImageOnly,F.Debug("S.GroupSymbol - Input options:",t),super(t),a(this,"collabGlowColor"),F.Debug("S.GroupSymbol - GroupSymbol created")}CreateShape(t,e){if(F.Debug("S.GroupSymbol - CreateShape input:",{svgDocument:t,shapeOptions:e}),this.flags&Se.ObjFlags.NotVisible)return F.Debug("S.GroupSymbol - CreateShape output:",null),null;this.GetFieldDataStyleOverride();const i=t.CreateShape(me.CSType.ShapeContainer);return F.Debug("S.GroupSymbol - CreateShape output:",i),i}PostCreateShapeCallback(t,e,i,o){if(F.Debug("S.GroupSymbol - PostCreateShapeCallback input:",{svgDocument:t,groupElement:e,eventSettings:i,extraFlags:o}),!(this.flags&Se.ObjFlags.NotVisible)){let n=t.CreateShape(me.CSType.Group);n.SetID(me.SVGElementClass.Shape),e.AddElement(n);let s=this.Frame,a=s.width,r=s.height;e.SetSize(a,r),e.SetPos(s.x,s.y);let l,h=this.ShapesInGroup.length,c=null,p=null,d=0,u=null,g=(this.extraflags&me.ExtraFlags.FlipHoriz)>0,y=(this.extraflags&me.ExtraFlags.FlipVert)>0,S=g,m=y,b=0;null!=o&&((o&me.ExtraFlags.FlipHoriz)>0&&(S=!S),(o&me.ExtraFlags.FlipVert)>0&&(m=!m)),b=ve.SetFlag(b,me.ExtraFlags.FlipHoriz,S),b=ve.SetFlag(b,me.ExtraFlags.FlipVert,m);for(let e=0;e<h;++e){let i=this.ShapesInGroup[e];l=ws.GetObjectPtr(i,!1),c=l.Dimensions,l.Dimensions=0,p=l.CreateShape(t),p&&(p.SetID(i),n.AddElement(p),l.PostCreateShapeCallback(t,p,null,b)),l.Dimensions=c,d=l.RotationAngle,l instanceof we.Shape.BaseShape&&(0!==d&&p.SetRotation(d),l.DataID>=0&&(S||m)&&(u=p.GetElementById(me.SVGElementClass.Text),u&&(S&&u.SetMirror(S),m&&u.SetFlip(m))))}n.SetSize(a,r),e.isShape=!0;let D=t.CreateShape(me.CSType.Rect);D.SetStrokeColor("white"),D.SetFillColor("none"),D.SetOpacity(0),D.SetStrokeWidth(5),i?D.SetEventBehavior(me.EventBehavior.HiddenAll):D.SetEventBehavior(me.EventBehavior.None),e.AddElement(D),D.SetID(me.SVGElementClass.Slop),D.ExcludeFromExport(!0),D.SetSize(a,r),n.SetScale(a/this.InitialGroupBounds.width,r/this.InitialGroupBounds.height),g&&n.SetMirror(g),y&&n.SetFlip(y),-1!==this.DataID&&this.LMAddSVGTextObject(t,e),this.UpdateDimensionLines(e),this.AddIcons(t,e),this.ApplyEffects(e,!1,!1)}F.Debug("S.GroupSymbol - PostCreateShapeCallback output executed")}SetObjectStyle(t){if(F.Debug("S.GroupSymbol - SetObjectStyle input:",t),t.ImageURL&&""!==t.ImageURL)F.Debug("S.GroupSymbol - SetObjectStyle output: No changes applied since ImageURL exists");else{const e=ye.opt.ApplyColorFilter(t,this,this.StyleRecord,this.colorfilter);ye.opt.ApplyGroupProperties(e,this),F.Debug("S.GroupSymbol - SetObjectStyle output: Applied color filter and group properties")}}ChangeTextAttributes(t,e,i,o,n,s,a,r){let l,h;F.Debug("S.GroupSymbol - ChangeTextAttributes input:",{textContent:t,styleOptions:e,textAlignment:i,textRotation:o,textMargin:n,textPadding:s,parentElementOverride:a,forceUpdate:r});const c=this.ShapesInGroup,p=c.length;let d=!1;if(0!==p){let u,g;if(u=a||ye.opt.svgObjectLayer.GetElementById(this.BlockID),u&&(g=u.GetElementById(me.SVGElementClass.Shape)),null!=g){this.AllowTextEdit()&&we.Shape.BaseSymbol.prototype.ChangeTextAttributes.call(this,t,e,i,o,n,s,g,r),e&&(void 0!==e.FontName&&(this.StyleRecord.Text.FontName=e.FontName),void 0!==e.FontId&&(this.StyleRecord.Text.FontId=e.FontId),void 0!==e.FontSize&&(this.StyleRecord.Text.FontSize=e.FontSize),void 0!==e.Face&&(this.StyleRecord.Text.Face=e.Face),void 0!==e.Color&&(this.StyleRecord.Text.Paint.Color=e.Color),void 0!==e.Opacity&&(this.StyleRecord.Text.Paint.Opacity=e.Opacity));for(let a=0;a<p;++a){let p=ws.GetObjectPtr(c[a],!0);if(p&&0==(p.colorfilter&Ne.ColorFilters.NCText)){let a=g.GetElementById(p.BlockID);l=p.Frame.height,h=p.Frame.width,p.ChangeTextAttributes(t,e,i,o,n,s,a,r),p.Frame.width===h&&p.Frame.height===l||(d=!0)}}if(d){ws.AddToDirtyList(this.BlockID);const t=this.Frame.width/this.InitialGroupBounds.width,e=this.Frame.height/this.InitialGroupBounds.height;if(!isNaN(t)&&!isNaN(e)){const i=Oe.DeepCopy(this.Frame);i.width=t*this.InitialGroupBounds.width,i.height=e*this.InitialGroupBounds.height,this.UpdateFrame(i)}}this.ConvertToNative(ye.opt.richGradients,!1)}}F.Debug("S.GroupSymbol - ChangeTextAttributes output executed")}GetTextures(t){F.Debug("S.GroupSymbol - GetTextures input:",t);const e=this.ShapesInGroup.length;for(let i=0;i<e;i++){const e=ws.GetObjectPtr(this.ShapesInGroup[i],!1);e&&e.GetTextures(t)}F.Debug("S.GroupSymbol - GetTextures output executed")}Resize(t,e,i){F.Debug("S.GroupSymbol - Resize input:",{svgElement:t,newDimensions:e,resizeInfo:i});const o=t.GetRotation(),n=Oe.DeepCopy(this.prevBBox),s=Oe.DeepCopy(e),a=ye.opt.svgDoc.CalculateRotatedOffsetForResize(n,s,o);t.SetSize(e.width,e.height),t.SetPos(e.x+a.x,e.y+a.y);const r=t.GetElementById(me.SVGElementClass.Shape);r.SetSize(e.width,e.height),r.SetScale(e.width/this.InitialGroupBounds.width,e.height/this.InitialGroupBounds.height);return t.GetElementById(me.SVGElementClass.Slop).SetSize(e.width,e.height),this.LMResizeSVGTextObject(t,i,e),t.SetRotation(o),this.UpdateDimensionLines(t),F.Debug("S.GroupSymbol - Resize output:",a),a}CreateActionTriggers(t,e,i,o){F.Debug("S.GroupSymbol - CreateActionTriggers input:",{svgDocument:t,triggerType:e,shapeOptions:i,actionRequest:o});const n=this.BaseShapeCreateActionTriggers(t,e,i,o);return F.Debug("S.GroupSymbol - CreateActionTriggers output:",n),n}BaseShapeCreateActionTriggers(t,e,i,o){F.Debug("S.GroupSymbol - BaseShapeCreateActionTriggers input:",{svgDocument:t,triggerType:e,shapeOptions:i,actionRequest:o});const n=[ze.CursorType.ResizeLT,ze.CursorType.ResizeT,ze.CursorType.ResizeRT,ze.CursorType.ResizeR,ze.CursorType.ResizeRB,ze.CursorType.ResizeB,ze.CursorType.ResizeLB,ze.CursorType.ResizeL];let s=t.CreateShape(me.CSType.Group);const a=me.Common.KnobSize,r=me.Common.RKnobSize;let l=this.extraflags&me.ExtraFlags.SideKnobs&&this.dataclass===tn.ShapeTypes.POLYGON;const h=me.Common.MinSidePointLength;let c=t.docInfo.docToScreenScale;t.docInfo.docScale<=.5&&(c*=2);const p=a/c,d=r/c;const u=this.Frame;let g=u.width,y=u.height;g+=p,y+=p;let S=Oe.DeepCopy(u);S.x-=p/2,S.y-=p/2,S.width+=p,S.height+=p;let m=i.GetRotation()+22.5;m>=360&&(m=0);const b=Math.floor(m/45);let D=n.slice(b).concat(n.slice(0,b)),f=!0,x=!l,C=!l;switch(this.ObjGrow){case me.GrowBehavior.Horiz:f=!1,C=!1;break;case me.GrowBehavior.Vertical:f=!1,x=!1;break;case me.GrowBehavior.ProPortional:f=!0,x=!1,C=!1}let P={svgDoc:t,shapeType:me.CSType.Rect,x:0,y:0,knobSize:p,fillColor:"black",fillOpacity:1,strokeSize:1,strokeColor:"#777777",locked:!1,knobID:0,cursorType:""};if(e!==o&&(P.fillColor="white",P.strokeSize=1,P.strokeColor="black",P.fillOpacity=0),this.flags&Se.ObjFlags.Lock?(P.fillColor="gray",P.locked=!0,l=!1):this.NoGrow()&&(P.fillColor="red",l=!1,P.strokeColor="red",D=[ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default,ze.CursorType.Default]),f){P.knobID=me.ActionTriggerType.TopLeft,P.cursorType=D[0];let t=this.GenericKnob(P);s.AddElement(t),P.x=g-p,P.y=0,P.cursorType=D[2],P.knobID=me.ActionTriggerType.TopRight,t=this.GenericKnob(P),s.AddElement(t),P.x=g-p,P.y=y-p,P.cursorType=D[4],P.knobID=me.ActionTriggerType.BottomRight,t=this.GenericKnob(P),s.AddElement(t),P.x=0,P.y=y-p,P.cursorType=D[6],P.knobID=me.ActionTriggerType.BottomLeft,t=this.GenericKnob(P),s.AddElement(t)}if(C){P.x=g/2-p/2,P.y=0,P.cursorType=D[1],P.knobID=me.ActionTriggerType.TopCenter;let t=this.GenericKnob(P);s.AddElement(t),P.x=g/2-p/2,P.y=y-p,P.cursorType=D[5],P.knobID=me.ActionTriggerType.BottomCenter,t=this.GenericKnob(P),s.AddElement(t)}if(x){P.x=0,P.y=y/2-p/2,P.cursorType=D[7],P.knobID=me.ActionTriggerType.CenterLeft;let t=this.GenericKnob(P);s.AddElement(t),P.x=g-p,P.y=y/2-p/2,P.cursorType=D[3],P.knobID=me.ActionTriggerType.CenterRight,t=this.GenericKnob(P),s.AddElement(t)}const T=function(t){let e=null;if(t.hooks.length){const i=ws.GetObjectPtr(t.hooks[0].objid,!1);(i&&i.DrawingObjectBaseClass===me.DrawObjectBaseClass.Connector||i&&i instanceof we.Shape.ShapeContainer)&&(e=i.PrGetShapeConnectorInfo(t.hooks[0]))}return e}(this);if(T&&T.length){const e={svgDoc:t,iconSize:14,imageURL:null,iconID:0,userData:0,cursorType:0,x:0,y:0};for(let t=0,i=T.length;t<i;t++){"right"===T[t].position?e.x=g-14-1-p:"bottom"===T[t].position?e.y=y-14-1-p:(e.x=p+1,e.y=p+1),e.cursorType=T[t].cursorType,e.iconID=T[t].knobID,e.imageURL="vertical"===T[t].polyType?me.Common.ConMoveVerticalPath:me.Common.ConMoveHorizontalPath,e.userData=T[t].knobData;let i=this.GenericIcon(e);s.AddElement(i),e.x+=16}}if(l){let t=Oe.DeepCopy(this);t.inside=Oe.DeepCopy(t.Frame);let e=ye.opt.ShapeToPolyLine(this.BlockID,!1,!0,t).GetPolyPoints(me.Common.MaxPolyPoints,!0,!0,!1,[]);if(e)for(let i=1,o=e.length;i<o;i++){const t=e[i].x-e[i-1].x,o=e[i].y-e[i-1].y;if(ve.Sqrt(t*t+o*o)>h){P.cursorType=t*t>o*o?ze.CursorType.ResizeTB:ze.CursorType.ResizeLR,P.x=e[i-1].x+t/2,P.y=e[i-1].y+o/2;let n=this.GenericKnob(P);n.SetUserData(i),s.AddElement(n)}}}const O=this.NoRotate()||this.NoGrow()||P.locked,v=u.width<44;let w=this.hooks.length>0;if(w){const t=ws.GetObjectPtr(this.hooks[0].objid,!1);t&&t.DrawingObjectBaseClass!==me.DrawObjectBaseClass.Connector&&(w=!1)}if(!O&&!v&&!w){const t=this.TextGrow===Se.TextGrowBehavior.Horizontal&&this.flags&Se.ObjFlags.TextOnly&&Vo.TextAlignToWin(this.TextAlign).just===bi.TextJust.Left;P.shapeType=me.CSType.Oval,P.x=t?g+d:g-3*d,P.y=y/2-d/2,P.cursorType=ze.CursorType.Rotate,P.knobID=me.ActionTriggerType.Rotate,P.fillColor="white",P.fillOpacity=.001,P.strokeSize=1.5,P.strokeColor="black";let e=this.GenericKnob(P);s.AddElement(e)}if(this.Dimensions&Se.DimensionFlags.Standoff&&this.CanUseStandOffDimensionLines()){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);this.CreateDimensionAdjustmentKnobs(s,t,P)}return s.SetSize(g,y),s.SetPos(S.x,S.y),s.isShape=!0,s.SetID(me.Common.Action+e),F.Debug("S.GroupSymbol - BaseShapeCreateActionTriggers output:",s),s}ContainsText(){if(F.Debug("S.GroupSymbol - ContainsText input:",{DataID:this.DataID,BlockID:this.BlockID,ShapesCount:this.ShapesInGroup.length}),this.DataID>=0)return F.Debug("S.GroupSymbol - ContainsText output:",!1),!1;for(let t=0;t<this.ShapesInGroup.length;t++){if(ws.GetObjectPtr(this.ShapesInGroup[t],!1).ContainsText())return F.Debug("S.GroupSymbol - ContainsText output:",!0),!0}return F.Debug("S.GroupSymbol - ContainsText output:",!1),!1}ConvertToNative(t,e){let i;F.Debug("S.GroupSymbol - ConvertToNative input:",{richGradients:t,shouldReturnBuffer:e});const o=new eo;o.richGradients=t;const n=this.ShapesInGroup.length;if(n>0){for(let e=0;e<n;e++){const t=this.ShapesInGroup[e];o.zList.push(t);const i=ws.GetObjectPtr(t,!1);i.layer=this.Layer,i.GetTextures(o.TextureList)}o.sdp=ws.GetObjectPtr(ye.opt.sdDataBlockId,!1),o.tLMB=ws.GetObjectPtr(ye.opt.layersManagerBlockId,!1),o.ctp=ye.opt.header,o.GroupOffset.x=0,o.GroupOffset.y=0,o.WriteGroupBlock=!0,o.fontlist=ye.opt.header.FontList,ye.docUtil.svgDoc.GetWorkArea(),o.docDpi=ye.docUtil.svgDoc.docInfo.docDpi;const t=Vo.WriteBuffer(o,!0,!0,!0);if(!0===e)return F.Debug("S.GroupSymbol - ConvertToNative output:",t),t;let s=null;t&&(s=new Uint8Array(t),this.NativeID>=0?(i=ye.stdObj.PreserveBlock(this.NativeID),i&&(i.Data=s)):(i=ye.stdObj.CreateBlock(Ce.StoredObjectType.HNativeObject,s),this.NativeID=i.ID)),F.Debug("S.GroupSymbol - ConvertToNative output:",{preservedBlock:i})}else F.Debug("S.GroupSymbol - ConvertToNative output: No shapes in group")}DeleteObject(){F.Debug("S.GroupSymbol - DeleteObject input: none");const t=this.ShapesInGroup,e=t.length;for(let i=0;i<e;i++){const e=ws.GetObjectPtr(t[i],!1);if(e){const o=ye.stdObj.GetObject(t[i]);e.DeleteObject(),o&&o.Delete()}}this.BaseDrawObjectDeleteObject(),F.Debug("S.GroupSymbol - DeleteObject output: deleted")}BaseDrawObjectDeleteObject(){F.Debug("S.GroupSymbol - BaseDrawObjectDeleteObject input: none");let t=null,e=null,i=null,o=[];-1!==this.DataID&&(t=ye.stdObj.GetObject(this.DataID),t&&t.Delete()),-1!==this.NoteID&&(t=ye.stdObj.GetObject(this.NoteID),t&&t.Delete()),-1!==this.NativeID&&(t=ye.stdObj.GetObject(this.NativeID),t&&t.Delete()),-1!==this.BlobBytesID&&(t=ye.stdObj.GetObject(this.BlobBytesID),t&&t.Delete(),Ps.IsBlobURL(this.ImageURL)&&Ps.DeleteURL(this.ImageURL)),-1!==this.EMFBlobBytesID&&(t=ye.stdObj.GetObject(this.EMFBlobBytesID),t&&t.Delete()),-1!==this.OleBlobBytesID&&(t=ye.stdObj.GetObject(this.OleBlobBytesID),t&&t.Delete()),this.BaseDrawObjectRemoveFieldData(!0),this.hooks.length&&(e=ws.GetObjectPtr(this.hooks[0].objid,!1),!e||e.objecttype!==Se.FNObjectTypes.FlWall||e.Dimensions&Se.DimensionFlags.HideHookedObjDimensions||(o=Oe.DeepCopy(this.hooks),this.hooks=[],i=ye.opt.svgObjectLayer.GetElementById(e.BlockID),e.UpdateDimensionLines(i),this.hooks=o)),F.Debug("S.GroupSymbol - BaseDrawObjectDeleteObject output: executed")}BaseDrawObjectRemoveFieldData(t,e){F.Debug("S.GroupSymbol - BaseDrawObjectRemoveFieldData input:",{shouldRemove:t,fieldDataTableId:e}),!this.HasFieldData()||e&&this.fieldDataTableID!==e||(ws.GetObjectPtr(this.BlockID,!0),t&&(this.fieldDataElemID<0?TODO.STData.DeleteFieldedDataTable(this.fieldDataTableID):TODO.STData.FieldedDataDelRecord(this.fieldDataTableID,this.fieldDataElemID)),this.fieldDataDatasetID=-1,this.fieldDataTableID=-1,this.fieldDataElemID=-1,this.dataStyleOverride=null,ws.AddToDirtyList(this.BlockID),this.BaseDrawObjectRefreshFromFieldData()),F.Debug("S.GroupSymbol - BaseDrawObjectRemoveFieldData output executed")}BaseDrawObjectRefreshFromFieldData(t){if(F.Debug("S.GroupSymbol - BaseDrawingObject_RefreshFromFieldData input:",{tableId:t}),t&&this.fieldDataTableID!==t)return F.Debug("S.GroupSymbol - BaseDrawingObject_RefreshFromFieldData output:",!1),!1;const e=this.HasFieldDataInText(t),i=this.HasFieldDataRules(t);let o=!1;return e||i?(this.GetFieldDataStyleOverride(),e&&(this.ChangeTextAttributes(null,null,null,null,null,null,null,!0),o=!0),TODO.STData.FieldedDataHasRulesForRecord(this.fieldDataTableID,this.fieldDataElemID)&&(ws.AddToDirtyList(this.BlockID),o=!0),F.Debug("S.GroupSymbol - BaseDrawingObject_RefreshFromFieldData output:",o),o):(F.Debug("S.GroupSymbol - BaseDrawingObject_RefreshFromFieldData output:",!1),!1)}ApplyEffects(t,e,i){if(F.Debug("S.GroupSymbol - ApplyEffects input:",{svgElement:t,isHighlighted:e,extraParam:i}),!(t=t||ye.opt.svgObjectLayer.GetElementById(this.BlockID)))return void F.Debug("S.GroupSymbol - ApplyEffects output: No SVG element found");if(!ye.opt.bDrawEffects||ye.opt.bTokenizeStyle)return void F.Debug("S.GroupSymbol - ApplyEffects output: Global flags disable effects");const o=t.shapeGroup||t,n=[];let s=null,a=4;e?s="#FFD64A":this.collabGlowColor?(s=this.collabGlowColor,a=6):this.dataStyleOverride&&this.dataStyleOverride.glowColor&&(s=this.dataStyleOverride.glowColor),s?(n.push({type:ai.EffectType.GLOW,params:{color:s,size:a,asSecondary:!0}}),o.Effects().SetEffects(n,this.Frame),F.Debug("S.GroupSymbol - ApplyEffects output:","Effects applied with glowColor",s)):F.Debug("S.GroupSymbol - ApplyEffects output: No glow color configured")}AllowTextEdit(){F.Debug("S.GroupSymbol - AllowTextEdit input:",{});const t=Boolean(this.TextFlags&Se.TextFlags.AttachB||this.TextFlags&Se.TextFlags.AttachA||this.TextFlags&Se.TextFlags.AttachD||this.DataID>=0);return F.Debug("S.GroupSymbol - AllowTextEdit output:",t),t}RemoveFieldData(t,e){F.Debug("S.GroupSymbol - RemoveFieldData input:",{fieldKey:t,fieldValue:e}),we.Shape.BaseSymbol.prototype.RemoveFieldData.call(this,t,e);const i=this.ShapesInGroup,o=i.length;for(let n=0;n<o;n++){const o=ws.GetObjectPtr(i[n],!1);o&&o.RemoveFieldData(t,e)}F.Debug("S.GroupSymbol - RemoveFieldData output executed")}HasFieldDataInText(t){F.Debug("S.GroupSymbol - HasFieldDataInText input:",{fieldData:t});const e=this.ShapesInGroup,i=e.length;if(we.Shape.BaseSymbol.prototype.HasFieldDataInText.call(this,t))return F.Debug("S.GroupSymbol - HasFieldDataInText output:",!0),!0;for(let o=0;o<i;++o){const i=ws.GetObjectPtr(e[o],!1);if(i&&i.HasFieldDataInText(t))return F.Debug("S.GroupSymbol - HasFieldDataInText output:",!0),!0}return F.Debug("S.GroupSymbol - HasFieldDataInText output:",!1),!1}HasFieldDataRules(t){F.Debug("S.GroupSymbol - HasFieldDataRules input:",{criteria:t});const e=this.ShapesInGroup,i=e.length;if(we.Shape.BaseSymbol.prototype.HasFieldDataRules.call(this,t))return F.Debug("S.GroupSymbol - HasFieldDataRules output:",!0),!0;for(let o=0;o<i;o++){const i=ws.GetObjectPtr(e[o],!1);if(i&&i.HasFieldDataRules(t))return F.Debug("S.GroupSymbol - HasFieldDataRules output:",!0),!0}return F.Debug("S.GroupSymbol - HasFieldDataRules output:",!1),!1}HasFieldDataForTable(t){F.Debug("S.GroupSymbol - HasFieldDataForTable input:",{tableId:t});const e=this.ShapesInGroup,i=e.length;if(we.Shape.BaseSymbol.prototype.HasFieldDataForTable.call(this,t))return F.Debug("S.GroupSymbol - HasFieldDataForTable output:",!0),!0;for(let o=0;o<i;o++){const i=ws.GetObjectPtr(e[o],!1);if(i&&i.HasFieldDataForTable(t))return F.Debug("S.GroupSymbol - HasFieldDataForTable output:",!0),!0}return F.Debug("S.GroupSymbol - HasFieldDataForTable output:",!1),!1}HasFieldDataRecord(t,e,i){F.Debug("S.GroupSymbol - HasFieldDataRecord input:",{fieldKey:t,fieldValue:e,recordId:i});const o=this.ShapesInGroup,n=o.length;if(we.Shape.BaseSymbol.prototype.HasFieldDataRecord.call(this,t,e,i))return F.Debug("S.GroupSymbol - HasFieldDataRecord output:",!0),!0;if(!i)return F.Debug("S.GroupSymbol - HasFieldDataRecord output:",!1),!1;for(let s=0;s<n;++s){const n=ws.GetObjectPtr(o[s],!1);if(n&&n.HasFieldDataRecord(t,e,i))return F.Debug("S.GroupSymbol - HasFieldDataRecord output:",!0),!0}return F.Debug("S.GroupSymbol - HasFieldDataRecord output:",!1),!1}RefreshFromFieldData(t){F.Debug("S.GroupSymbol - refreshFromFieldData input:",t);let e=!1;return we.Shape.BaseSymbol.prototype.RefreshFromFieldData.call(this,t)&&(e=!0),this.HasFieldDataInText(t)&&(this.GetFieldDataStyleOverride(),this.ChangeTextAttributes(null,null,null,null,null,null,null,!0),e=!0),this.HasFieldDataRules(t)&&(ws.AddToDirtyList(this.BlockID),e=!0),F.Debug("S.GroupSymbol - refreshFromFieldData output:",e),e}RemapDataFields(t){F.Debug("S.GroupSymbol - remapDataFields input:",t),we.Shape.BaseSymbol.prototype.RemapDataFields.call(this,t);const e=this.ShapesInGroup;for(let i=0;i<e.length;i++){const o=ws.GetObjectPtr(e[i],!1);o&&o.RemapDataFields(t)}F.Debug("S.GroupSymbol - remapDataFields output: completed")}},Line:rs,Oval:ds,Polygon:cs,PolyLine:ss,PolyLineContainer:as,Rect:Qn,RRect:ps,SegmentedLine:fa,ShapeContainer:Ea,SvgSymbol:gs,BitmapImporter:class{ImportBitmapV1(t,e,i,o,n){if(F.Debug("S.BitmapImporter - Input:",{imageFile:t,targetWidth:e,targetHeight:i,resolution:o}),!t||!n||o<=0)return;ye.opt.bitmapImportDestWidth=e,ye.opt.bitmapImportDestHeight=i,ye.opt.bitmapImportDPI=o;const s=t.type;if(ye.opt.bitmapImportMimeType=s,"image/jpeg"===s||"image/png"===s){ye.opt.bitmapImportOriginalSize=t.size,ye.opt.scaledBitmapCallback=n;const e=new FileReader;e.onload=function(e){ye.opt.bitmapImportEXIFdata=null,ye.opt.bitmapImportFile=t,ye.opt.bitmapImportResult=e.target.result,F.Debug("S.BitmapImporter - Output (JPEG/PNG):",{result:e.target.result})},e.readAsDataURL(t)}else{const e=new FileReader;e.onload=function(){const t=new Blob([this.result],{type:s}),e=new Uint8Array(this.result),i=window.URL||window.webkitURL;if(i&&i.createObjectURL){const o=i.createObjectURL(t);F.Debug(`S.BitmapImporter - Output (${"image/svg+xml"===s?"SVG":"Other"}):`,{objectUrl:o,blob:t,byteArray:e}),n(o,t,e)}},e.readAsArrayBuffer(t)}}ImportBitmap(t,e,i,o,n){let s;if(!t||!n||o<=0)return;ye.opt.bitmapImportDestWidth=e,ye.opt.bitmapImportDestHeight=i,ye.opt.bitmapImportDPI=o;const a=t.type;ye.opt.bitmapImportMimeType=a,t instanceof File?"image/jpeg"===a||"image/png"===a?(ye.opt.bitmapImportOriginalSize=t.size,ye.opt.scaledBitmapCallback=n,s=new FileReader,s.onload=function(){const t=new Blob([this.result],{type:a}),e=new Uint8Array(this.result),i=window.URL||window.webkitURL;let o="";i&&i.createObjectURL&&(o=i.createObjectURL(t),n&&n(o,t,e))},s.readAsArrayBuffer(t)):"image/svg+xml"===a&&(s=new FileReader,s.onload=function(){const t=new Blob([this.result],{type:a}),e=new Uint8Array(this.result),i=window.URL||window.webkitURL;let o="";i&&i.createObjectURL&&(o=i.createObjectURL(t),n&&n(o,t,e))},s.readAsArrayBuffer(t)):(s=new FileReader,s.onload=function(){const t=new Blob([this.result],{type:a}),e=new Uint8Array(this.result),i=window.URL||window.webkitURL;let o="";i&&i.createObjectURL&&(o=i.createObjectURL(t),n&&n(o,t,e))},s.readAsArrayBuffer(t))}},SvgImporter:class{ImportSvg(t,e){F.Debug("= S.SvgImporter - Input file:",t);const i=t.type;if("image/svg+xml"===i){const o=new FileReader;o.onload=function(){const n=o.result,s=new Blob([n],{type:i}),a=new Uint8Array(n),r=window.URL||window.webkitURL;let l="";r&&r.createObjectURL&&(l=r.createObjectURL(s),F.Debug("= S.SvgImporter - Generated URL:",l),F.Debug("= S.SvgImporter - Generated Blob:",s),F.Debug("= S.SvgImporter - Generated Uint8Array:",a),e&&e(l,s,a)),void 0!==t.msClose&&(F.Debug("= S.SvgImporter - Calling msClose"),t.msClose())},o.readAsArrayBuffer(t)}else F.Debug("= S.SvgImporter - Unsupported file type:",i)}},ForeignObject:class extends Zn{constructor(t){F.Debug("= S.ForeignObject Input:",t),F.Debug("= S.ForeignObject Input:",t),(t=t||{}).ShapeType=me.ShapeType.ForeignObject,super(t),a(this,"vueInstance",null),a(this,"htmlContent",null),a(this,"vueComponent",null),a(this,"vueProps",{}),this.dataclass=t.dataclass||tn.ShapeTypes.RECTANGLE,this.vueComponent=t.vueComponent||null,this.vueProps=t.vueProps||{},this.htmlContent=t.htmlContent||null,F.Debug("= S.ForeignObject Created instance:",this)}CreateShape(t,e){if(this.flags&Se.ObjFlags.NotVisible)return null;const i=t.CreateShape(me.CSType.ShapeContainer),o=Oe.DeepCopy(this.Frame),n=this.StyleRecord,s=this.SVGTokenizerHook(n),a=s.Line.Paint.Color,r=s.Line.Thickness,l=s.Line.LinePattern,h=s.Line.Paint.Opacity,c=o.width,p=o.height;i.SetSize(c,p),i.SetPos(o.x,o.y);const d=t.CreateShape(me.CSType.ForeignObject);if(d.SetID(me.SVGElementClass.Shape),d.SetSize(c,p),d.SetStrokeColor(a),d.SetStrokeOpacity(h),d.SetStrokeWidth(r),0!==l&&d.SetStrokePattern(l),i.AddElement(d),this.htmlContent)d.SetHtmlContent(this.htmlContent);else if(this.vueComponent)if("string"==typeof this.vueComponent){const t=this.vueComponent,e={"ObjectType2.vue":()=>_t((()=>import("./ObjectType2.e447276c.js")),["assets/ObjectType2.e447276c.js","assets/index.3bd6c859.js","assets/index.4cd415b0.css","assets/IdxUtils.d6cf2722.js","assets/T3Data.63f93fe7.js","assets/_commonjsHelpers.a5007c1f.js","assets/EditOutlined.97ce15d8.js","assets/AntdIcon.b18ae2a5.js","assets/button.a53ae65b.js","assets/index.af4b72c2.js","assets/Serializer.f6a5f515.js","assets/_getTag.58f99b8e.js"])};e[t]?e[t]().then((t=>{const e=t.default||t;d.MountVueComponent(e,this.vueProps)})).catch((e=>{Uo.Error(`= s.ForeignObject CreateShape Failed to load component: ${t}`,e)})):Uo.Error(`= s.ForeignObject CreateShape Component not found in registry: ${t}`)}else if(this.vueComponent&&"object"==typeof this.vueComponent)if("function"==typeof this.vueComponent.render||"function"==typeof this.vueComponent.setup)d.MountVueComponent(this.vueComponent,this.vueProps);else{const t=this.vueComponent.name||this.vueComponent.__name;if(console.warn(`Component missing render/setup functions, attempting to reload: ${t}`),t){F.Debug(`Attempting to load component by name: ${t}`),F.Debug("this.vueProps:  ",this.vueProps);let e=`../../../../components/${t}.vue`;"AntdTest"===t&&(e=`../../../../components/NewUI/${t}.vue`),_t((()=>import(e)),[]).then((t=>{const e=t.default||t;d.MountVueComponent(e,this.vueProps)})).catch((e=>{Uo.Error(`= s.ForeignObject CreateShape Failed to load component by name: ${t}`,e)}))}}else Uo.Error("= s.ForeignObject CreateShape Invalid vue component provided:",this.vueComponent);if(this.ApplyStyles(d,s),this.ApplyEffects(i,!1,!1),!(this instanceof we.Shape.ShapeContainer)){const o=me.Common.Slop,n=t.CreateShape(me.CSType.Rect);n.SetStrokeColor("white"),n.SetFillColor("none"),n.SetOpacity(0),n.SetStrokeWidth(r+o),e?n.SetEventBehavior(me.EventBehavior.HiddenAll):n.SetEventBehavior(me.EventBehavior.None),n.SetID(me.SVGElementClass.Slop),n.ExcludeFromExport(!0),n.SetSize(c||1,p),i.AddElement(n)}return i.isShape=!0,this.DataID>=0&&this.LMAddSVGTextObject(t,i),i}GetPolyPoints(t,e,i,o,n){F.Debug("= S.ForeignObject GetPolyPoints Input:",{event:t,type:e,arg:i,rect:o,index:n});const s=[];let a={};ve.CopyRect(a,this.Frame);const r=this.StyleRecord.Line.Thickness/2;if(o&&ve.InflateRect(a,r,r),s.push(new De(0,0)),s.push(new De(a.width,0)),s.push(new De(a.width,a.height)),s.push(new De(0,a.height)),s.push(new De(0,0)),!e)for(let l=0,h=s.length;l<h;l++)s[l].x+=a.x,s[l].y+=a.y;return F.Debug("= S.ForeignObject GetPolyPoints Output:",s),s}SetHtmlContent(t){return F.Debug("= S.ForeignObject SetHtmlContent Input:",t),this.htmlContent=t,this.vueComponent=null,this.vueProps={},this.vueInstance=null,F.Debug("= S.ForeignObject SetHtmlContent Output: Updated content"),!0}SetVueComponent(t,e={}){return F.Debug("= S.ForeignObject SetVueComponent Input:",{component:t,props:e}),this.vueComponent=t,this.vueProps=e||{},this.htmlContent=null,F.Debug("= S.ForeignObject SetVueComponent Output: Updated component"),!0}GetTextDefault(t){if(this.vueComponent||this.htmlContent){return{}}return super.GetTextDefault(t)}SetShapeProperties(t){F.Debug("= S.ForeignObject SetShapeProperties Input:",t);let e=!1;return void 0!==t.htmlContent&&t.htmlContent!==this.htmlContent&&(this.SetHtmlContent(t.htmlContent),e=!0),void 0!==t.vueComponent&&t.vueComponent!==this.vueComponent&&(this.SetVueComponent(t.vueComponent,t.vueProps),e=!0),super.SetShapeProperties(t)&&(e=!0),F.Debug("= S.ForeignObject SetShapeProperties Output:",e),e}RemoveElement(){F.Debug("= S.ForeignObject RemoveElement"),this.vueInstance&&("function"==typeof this.vueInstance.unmount?this.vueInstance.unmount():"function"==typeof this.vueInstance.$destroy&&this.vueInstance.$destroy(),this.vueInstance=null),super.RemoveElement()}LMActionPostRelease(t){if(F.Debug("= S.ForeignObject LMActionPostRelease Input:",t),super.LMActionPostRelease(t),this.vueComponent){const t=ye.opt.svgObjectLayer.GetElementById(this.BlockID);if(t){const e=t.GetElementById(me.SVGElementClass.Shape);e&&(e.MountVueComponent(this.vueComponent,this.vueProps),F.Debug("= S.ForeignObject LMActionPostRelease: Vue component refreshed"))}}F.Debug("= S.ForeignObject LMActionPostRelease Output: completed")}}};SVGElement.prototype.getTransformToElement=function(t){return t.getScreenCTM().inverse().multiply(this.getScreenCTM())};const Ga={value:{active:!1,data:null}};class Ra{}a(Ra,"DeviceList",[{id:0,label:"All Devices",icon:"devices",children:[{id:1,label:"T3-XX-ESP 1",icon:"horizontal_rule"},{id:2,label:"T3-XX-ESP 2",icon:"horizontal_rule"},{id:3,label:"T3-XX-ESP 3",icon:"horizontal_rule"},{id:4,label:"T3-XX-ESP 4",icon:"horizontal_rule"},{id:5,label:"T3-XX-ESP 5",icon:"horizontal_rule"},{id:6,label:"T3-XX-ESP 6",icon:"horizontal_rule"},{id:7,label:"T3-XX-ESP 7",icon:"horizontal_rule"},{id:8,label:"T3-XX-ESP 8",icon:"horizontal_rule"},{id:9,label:"T3-XX-ESP 9",icon:"horizontal_rule"},{id:10,label:"T3-XX-ESP 10",icon:"horizontal_rule"},{id:11,label:"T3-XX-ESP 11",icon:"horizontal_rule"},{id:12,label:"T3-XX-ESP 12",icon:"horizontal_rule"},{id:13,label:"T3-XX-ESP 13",icon:"horizontal_rule"},{id:14,label:"T3-XX-ESP 14",icon:"horizontal_rule"},{id:15,label:"T3-XX-ESP 15",icon:"horizontal_rule"},{id:16,label:"T3-XX-ESP 16",icon:"horizontal_rule"},{id:17,label:"T3-XX-ESP 17",icon:"horizontal_rule"},{id:18,label:"T3-XX-ESP 18",icon:"horizontal_rule"}]}]),a(Ra,"GraphicList",[{id:1,fullLabel:"T3-xx-ESP1 full label 1",label:"label 1",pictureFile:"",elementCount:0},{id:2,fullLabel:"T3-xx-ESP1 full label 2",label:"label 2",pictureFile:"",elementCount:0},{id:3,fullLabel:"T3-xx-ESP1 full label 3",label:"label 3",pictureFile:"",elementCount:0},{id:4,fullLabel:"T3-xx-ESP1 full label 4",label:"label 4",pictureFile:"",elementCount:0},{id:5,fullLabel:"T3-xx-ESP1 Default",label:"label 5",pictureFile:"",elementCount:0},{id:6,fullLabel:"T3-xx-ESP1 full label 6",label:"label 6",pictureFile:"",elementCount:0},{id:7,fullLabel:"T3-xx-ESP1 full label 7",label:"label 7",pictureFile:"",elementCount:0},{id:8,fullLabel:"T3-xx-ESP1 Default",label:"label 8",pictureFile:"",elementCount:0}]);class ja{constructor(){a(this,"object_instance"),a(this,"online_time"),a(this,"panel_name"),a(this,"panel_number"),a(this,"pid"),a(this,"serial_number")}}class Ba{constructor(){a(this,"id"),a(this,"label"),a(this,"icon"),a(this,"children"),a(this,"pl")}initData(t,e,i,o,n){this.id=t,this.label=e,this.icon=i,this.children=o,this.pl=n}}class Ma{saveAppState(t){localStorage.setItem("appState",JSON.stringify(t))}saveDeviceAppState(t){localStorage.setItem("deviceAppState",JSON.stringify(t))}loadDeviceAppStateLS(){const t=localStorage.getItem("deviceAppState");return t?JSON.parse(t):null}loadAppStateLS(){const t=localStorage.getItem("appState");return null!=t?t:null}loadParsedAppStateLS(){const t=localStorage.getItem("appState");return t?JSON.parse(t):null}}class Ha{constructor(){a(this,"lsOpt"),a(this,"mockDeviceList"),a(this,"mockGraphicList"),a(this,"panelList"),a(this,"deviceList"),a(this,"graphicList"),a(this,"currentDevice"),this.lsOpt=new Ma,this.mockDeviceList=Ra.DeviceList,this.mockGraphicList=Ra.GraphicList,this.panelList=[],this.deviceList=[],this.graphicList=[],this.currentDevice={}}initPanelList(t){if(null==t)return;const e=t.map((t=>{const e=new ja;return e.object_instance=t.object_instance,e.online_time=t.online_time,e.panel_name=t.panel_name,e.panel_number=t.panel_number,e.pid=t.pid,e.serial_number=t.serial_number,e}));this.panelList=e}initDeviceList(t){this.initPanelList(t);const e=this.panelList.map((t=>{const e=new Ba;return e.initData(t.panel_number,t.panel_name,"horizontal_rule",[],t),e})),i=new Ba;i.initData(-1,"All Devices","devices",e,{}),this.deviceList=[i],Bo.deviceList.value=this.deviceList}initGraphicList(t){F.Debug("= Dvopt t3 graphic data",t);const e=t.filter((t=>t.id.startsWith("GRP"))).slice(0,8).map((t=>({id:t.id.includes("GRP")?parseInt(t.id.replace("GRP",""),10):parseInt(t.id,10),fullLabel:t.description||"",label:t.label||"",elementCount:Number(t.count)||0})));F.Debug("= Dvopt t3 transformedGraphicItems",e),this.graphicList=e,Bo.graphicList.value=e,F.Debug("= Dvopt t3 graphicList",Bo.graphicList.value)}calculateElementCount(t){const e=Bo.currentDevice.value;if(!e)return 0;const i=this.lsOpt.loadDeviceAppStateLS();if(i){const o=i.find((i=>{var o,n;return(null==(o=null==i?void 0:i.device)?void 0:o.deviceId)===(null==e?void 0:e.deviceId)&&(null==(n=null==i?void 0:i.device)?void 0:n.graphic)===t}));if(o)return o.appState.items.length}return 0}syncTempAppStateToDeviceAppState(){const t=localStorage.getItem("tempAppState"),e=this.getCurrentDevice();if(!t||!e)return;const i=JSON.parse(t),o=this.lsOpt.loadDeviceAppStateLS()||[],n=o.findIndex((t=>{var i,o;return(null==(i=null==t?void 0:t.device)?void 0:i.device)===(null==e?void 0:e.device)&&(null==(o=null==t?void 0:t.device)?void 0:o.graphic)===(null==e?void 0:e.graphic)}));-1!==n?o[n].appState=i:o.push({device:e,appState:i}),localStorage.setItem("deviceAppState",JSON.stringify(o))}saveCurrentDevice(t){localStorage.setItem("currentDevice",JSON.stringify(t))}getCurrentDevice(){return localStorage.getItem("currentDevice")?JSON.parse(localStorage.getItem("currentDevice")):null}saveAppState(t){localStorage.setItem("appState",JSON.stringify(t))}findAllNodes(t,e){for(const i of t){if(i.label===e)return i;if(i.children){const t=this.findAllNodes(i.children,e);if(t)return t}}return null}setDeviceAndGraphicDefaultData(t){const e=this.findAllNodes(Bo.deviceList.value,t.device);e&&(e.icon="check")}saveDeviceAppState(t,e,i){let o=e.value.data;if(!o.device&&(o=this.getCurrentDevice(),null===o))return;const n=this.lsOpt.loadDeviceAppStateLS();null!==n&&(t.value=n);if(t.value.some((t=>{var e,i;return(null==(e=null==t?void 0:t.device)?void 0:e.device)===(null==o?void 0:o.device)&&(null==(i=null==t?void 0:t.device)?void 0:i.graphic)===(null==o?void 0:o.graphic)})))t.value.forEach((t=>{var e,n;if((null==(e=null==t?void 0:t.device)?void 0:e.device)===(null==o?void 0:o.device)&&(null==(n=null==t?void 0:t.device)?void 0:n.graphic)===(null==o?void 0:o.graphic)){const e=h.exports.cloneDeep(i);t.appState=e}}));else{const e=h.exports.cloneDeep(i),n={device:o,appState:e};t.value.push(n)}this.lsOpt.saveDeviceAppState(t.value),this.refreshCurrentDeviceCount(e)}loadDeviceAppState(t,e,i){const o=this.lsOpt.loadDeviceAppStateLS();null!==o&&(t.value=o);const n=t.value.find((t=>{var i,o;return(null==(i=null==t?void 0:t.device)?void 0:i.device)===(null==e?void 0:e.device)&&(null==(o=null==t?void 0:t.device)?void 0:o.graphic)===(null==e?void 0:e.graphic)}));if(n){const t=h.exports.cloneDeep(n.appState);return t.selectedTarget=[],t.selectedTargets=[],t.activeItemIndex=-1,t}}refreshCurrentDeviceCount(t){const e=this.lsOpt.loadDeviceAppStateLS(),i=this.getCurrentDevice();i&&i.graphicFull&&e&&(e.forEach((e=>{var o,n,s,a,r;if((null==(o=null==e?void 0:e.device)?void 0:o.device)===(null==i?void 0:i.device)&&(null==(n=null==e?void 0:e.device)?void 0:n.graphic)===(null==i?void 0:i.graphic)){const o=null!=(r=null==(a=null==(s=null==e?void 0:e.appState)?void 0:s.items)?void 0:a.length)?r:0;return i.graphicFull.elementCount=o,void(t&&(t.value.data=i))}})),localStorage.setItem("currentDevice",JSON.stringify(i)))}refreshGraphicPanelElementCount(t){const e=this.lsOpt.loadDeviceAppStateLS();if(!e)return;const i=e.filter((e=>{var i;return(null==(i=null==e?void 0:e.device)?void 0:i.device)===(null==t?void 0:t.device)}));Bo.graphicList.value.forEach((t=>{var e,o,n;const s=i.find((e=>{var i;return(null==(i=null==e?void 0:e.device)?void 0:i.graphic)===t.id}));if(s){const i=null!=(n=null==(o=null==(e=null==s?void 0:s.appState)?void 0:e.items)?void 0:o.length)?n:0;t.elementCount=i}})),F.Debug("= Dvopt refresh element count",Bo.graphicList.value)}clearGraphicPanelElementCount(){Bo.graphicList.value.forEach((t=>{t.elementCount=0}))}clearDirtyCurrentDevice(){const t=this.getCurrentDevice();Bo.deviceList.value.length>0&&Bo.deviceList.value[0].children.forEach((e=>{"check"===e.icon&&e.label!==t.device&&(e.icon="horizontal_rule")}))}loadGraphicPanelData(t){Ra.GraphicList.forEach((e=>{e.fullLabel=`${t.device} mock real ${e.id}`,e.label=`mock real ${e.id}`,e.pictureFile="",e.elementCount=0}))}getSerialNumber(t){var e,i,o;let n=-1;if(0===Bo.deviceList.value.length){const t=this.getCurrentDevice();n=null!=(e=null==t?void 0:t.serialNumber)?e:-1}else{const e=null==(o=null==(i=Bo.deviceList.value[0])?void 0:i.children)?void 0:o.find((e=>e.pl.panel_number===t));e&&(n=e.pl.serial_number)}return n}refreshDeviceAppState(){var t,e;F.Debug("= Dvopt: refreshDeviceAppState / start to refresh deviceAppState");const i=this.loadDeviceAppState(go,yo.value.data,null);F.Debug("= Dvopt: refreshDeviceAppState / existAppState",i),i?po.value=i:(po.value=h.exports.cloneDeep(co),po.value.rulersGridVisible=So.value),F.Debug("= Dvopt: refreshDeviceAppState / appState.value",po.value),this.saveAppState(po.value),So.value=null!=(e=null==(t=po.value)?void 0:t.rulersGridVisible)&&e}refreshCurrentDevice(){const t=this.getCurrentDevice();if(!t||!t.graphicFull)return;const e=po.value.items.length;e!==t.graphicFull.elementCount&&(t.graphicFull.elementCount=e,this.saveCurrentDevice(t))}addPresetsData(){var t,e;const i=h.exports.cloneDeep(co);localStorage.setItem("tempAppState",JSON.stringify(i)),F.Debug("= Dvopt: addPresetsData / set the tempAppState to empty project",i);const o=this.getCurrentDevice(),n=null!=(t=null==o?void 0:o.device)?t:"-";null==o||o.deviceId;const s=null!=(e=null==o?void 0:o.graphic)?e:-1;F.Debug("= Dvopt: addPresetsData / currentDevice",o),o.graphicFull.elementCount=0,this.saveCurrentDevice(o),po.value=h.exports.cloneDeep(co),So.value=!1,F.Debug("= Dvopt: addPresetsData / set the appState value to empty project",po.value),this.saveAppState(po.value),F.Debug("= Dvopt: addPresetsData / save the appState value to local storage",po.value);const a=this.lsOpt.loadDeviceAppStateLS();if(F.Debug("= Dvopt: addPresetsData / load deviceAppStateLS",a),!a)return;const r=a.findIndex((t=>{var e,i;return(null==(e=null==t?void 0:t.device)?void 0:e.device)===n&&(null==(i=null==t?void 0:t.device)?void 0:i.graphic)===s}));-1!==r&&(a[r].appState=h.exports.cloneDeep(co)),localStorage.setItem("deviceAppState",JSON.stringify(a)),F.Debug("= Dvopt: addPresetsData / save the deviceAppState to local storage",a)}mergeAppState(t){if(!po.value&&!t)return;const e=po.value.version,i=t.items.length>0?Math.max(...t.items.map((t=>t.id))):0;po.value.items.forEach((t=>{t.id=i+t.id}));const o={version:e,items:[...t.items,...po.value.items],selectedTargets:[],elementGuidelines:[],itemsCount:po.value.itemsCount+t.itemsCount,groupCount:po.value.groupCount+t.groupCount,activeItemIndex:-1,viewportTransform:po.value.viewportTransform,rulersGridVisible:po.value.rulersGridVisible||t.rulersGridVisible};po.value=o,this.saveAppState(po.value),F.Debug("= Dvopt mergeAppState",po.value)}isCurrentDeviceMessage(t){var e,i,o,n,s,a;const r=null!=(e=null==t?void 0:t.panelId)?e:-1,l=null!=(i=null==t?void 0:t.viewitem)?i:-1,h=null!=(o=null==t?void 0:t.serialNumber)?o:-1;if(F.Debug("= Dvopt: isCurrentDeviceMessage / msgData",t),F.Debug("= Dvopt: isCurrentDeviceMessage / panelId,viewitem,serialNumber",r,l,h),!r||!l||!h)return F.Error("= Dvopt: isCurrentDeviceMessage / Invalid message data"),!1;const c=this.getCurrentDevice();if(F.Debug("= Dvopt: isCurrentDeviceMessage / currentDevice",c),!c)return F.Error("= Dvopt: isCurrentDeviceMessage / No current device found"),!1;null==c||c.device;const p=null!=(n=null==c?void 0:c.deviceId)?n:-1,d=null!=(s=null==c?void 0:c.graphic)?s:-1,u=null!=(a=null==c?void 0:c.serialNumber)?a:-1;F.Debug("= Dvopt: isCurrentDeviceMessage / crtPanelId,crtGraphicId,crtSerialNumber",p,d,u);const g=p===r,y=u===h,S=d===l+1;return F.Debug("= Dvopt: isCurrentDeviceMessage / isSamePanel",g,"isSameSerial",y,"isSameViewItem",S),g&&y&&S}}class _a{}a(_a,"DATA_SERVER_ONLINE",-1),a(_a,"GET_PANEL_DATA",0),a(_a,"GET_INITIAL_DATA",1),a(_a,"SAVE_GRAPHIC_DATA",2),a(_a,"UPDATE_ENTRY",3),a(_a,"GET_PANELS_LIST",4),a(_a,"GET_PANEL_RANGE_INFO",5),a(_a,"GET_ENTRIES",6),a(_a,"LOAD_GRAPHIC_ENTRY",7),a(_a,"OPEN_ENTRY_EDIT_WINDOW",8),a(_a,"SAVE_IMAGE",9),a(_a,"SAVE_LIBRARY_DATA",10),a(_a,"DELETE_IMAGE",11),a(_a,"GET_SELECTED_DEVICE_INFO",12),a(_a,"BIND_DEVICE",13),a(_a,"SAVE_NEW_LIBRARY_DATA",14),a(_a,"GET_PANEL_DATA_RES","GET_PANEL_DATA_RES"),a(_a,"GET_INITIAL_DATA_RES","GET_INITIAL_DATA_RES"),a(_a,"SAVE_GRAPHIC_DATA_RES","SAVE_GRAPHIC_DATA_RES"),a(_a,"UPDATE_ENTRY_RES","UPDATE_ENTRY_RES"),a(_a,"GET_PANELS_LIST_RES","GET_PANELS_LIST_RES"),a(_a,"GET_PANEL_RANGE_INFO_RES","GET_PANEL_RANGE_INFO_RES"),a(_a,"GET_ENTRIES_RES","GET_ENTRIES_RES"),a(_a,"LOAD_GRAPHIC_ENTRY_RES","LOAD_GRAPHIC_ENTRY_RES"),a(_a,"OPEN_ENTRY_EDIT_WINDOW_RES","OPEN_ENTRY_EDIT_WINDOW"),a(_a,"SAVE_IMAGE_RES","SAVE_IMAGE_RES"),a(_a,"SAVE_LIBRARY_DATA_RES","SAVE_LIBRAY_DATA_RES"),a(_a,"DELETE_IMAGE_RES","DELETE_IMAGE_RES"),a(_a,"GET_SELECTED_DEVICE_INFO_RES","GET_SELECTED_DEVICE_INFO_RES"),a(_a,"BIND_DEVICE_RES","BIND_DEVICE_RES"),a(_a,"SAVE_NEW_LIBRARY_DATA_RES","SAVE_NEW_LIBRARY_DATA_RES");class Ua{constructor(){a(this,"deviceOpt"),a(this,"browserType"),a(this,"header"),a(this,"message"),a(this,"currentDevice"),this.deviceOpt=new Ha,this.loadCurrentDevice(),this.browserType=this.getBrowserType(),this.header={from:this.browserType},this.message={}}getBrowserType(){const t=navigator.userAgent;return t.indexOf("Firefox")>-1?"Firefox":t.indexOf("Chrome")>-1?"Chrome":t.indexOf("Safari")>-1?"Safari":t.indexOf("MSIE")>-1||document.DOCUMENT_NODE?"IE":"Unknown"}loadCurrentDevice(){const t=this.deviceOpt.getCurrentDevice();null===t?this.setEmptyDevice():this.currentDevice=t}setEmptyDevice(){this.currentDevice={device:"",deviceId:-1,serialNumber:-1,graphic:-1,graphicFull:{id:-1,fullLabel:"",label:"",elementCount:""}}}setHeader(){this.header.from=this.getBrowserType()}setMessage(t,e,i,o,n,s){null!=t&&(this.message.action=t),null!=e&&(this.message.panelId=e),null!=i&&(this.message.viewitem=i-1,this.message.viewitem<0&&(this.message.viewitem=-1)),null!=o&&void 0!==o&&(this.message.data=o),null!=s&&void 0!==s&&(this.message.clientId=Oe.GenerateUUID()),this.message.msgId=Oe.GenerateUUID();null!=e&&null!=n&&(this.message.serialNumber=n)}formatMessageData(){return{header:this.header,message:this.message}}}class Na{static ShowNotification(t,e,i){Ut[t]({message:e,description:i,style:{fontSize:"12px"},duration:730,placement:"topRight",onClick:()=>{F.Debug("= u.AntdUtil: ShowNotification/ Message callback clicked")}})}static ShowTopAlert(t,e,i){Dn.value=!0,fn.value=i;const o=Dn.value?42:0;ye.docUtil&&ye.docUtil.UpdateWorkArea(o)}static CloseGlobalMsg(){Dn.value=!1;const t=Dn.value?42:0;ye.docUtil&&ye.docUtil.UpdateWorkArea(t)}static ShowMessage(t,e){switch(t){case"error":Nt.error(e);break;case"warning":Nt.warning(e);break;case"success":Nt.success(e)}}}class Va{static ShowWebSocketError(t){Na.ShowTopAlert("error","WebSocket Error",t)}static ShowZoomInOutError(t){Na.ShowTopAlert("error","Zoom In/Out Error",t)}static SetNavVisiblity(t){Wn.value=!0,Kn.value=!0,Yn.value=!0}}let za=null;class Wa{constructor(){a(this,"webview",null==(i=window.chrome)?void 0:i.webview),a(this,"zoom"),a(this,"getPanelsInterval"),a(this,"autoSaveInterval"),a(this,"$q"),this.initZoom()}initPage(){Ka.WebClient.initMessageHandler(),this.initGlobalNav(),this.isLoggedIn(),this.restoreAppState(),this.setDocMarginOffset(),this.initPanzoom(),this.initMessageClient(),this.initScorller(),this.initAutoSaveInterval(),this.initWindowListener(),this.refreshMoveableGuides(),this.resetPanzoom(),this.clearGrpSwitch()}initPage5(){Ka.WebClient.initMessageHandler(),this.initGlobalNav(),this.isLoggedIn(),this.restoreAppState(),this.setDocMarginOffset(),this.initMessageClient(),this.initAutoSaveInterval(),this.initWindowListener5(),this.refreshMoveableGuides(),Ka.UI.Initialize()}initQuasar(t){this.$q=t,Ka.WebClient.initQuasar(this.$q),Ka.QuasarUtil.initQuasar(this.$q)}zoomAction(t="in",e=null){"out"===t?this.zoom.value-=10:"set"===t?this.zoom.value=e:this.zoom.value+=10,F.Debug("= Idx zoomAction",this.zoom.value)}initWindowListener(){window.addEventListener("beforeunload",(function(t){Ka.IdxPage.clearAutoSaveInterval(),Ka.WsClient.clearInitialDataInterval()})),window.addEventListener("resize",(()=>{Wa.restDocumentAreaPosition(null)}))}initWindowListener5(){window.addEventListener("beforeunload",(function(t){Ka.IdxPage.clearAutoSaveInterval(),Ka.WsClient.clearInitialDataInterval()})),window.addEventListener("resize",(()=>{}))}initGlobalNav(){bo.value.title="HVAC Drawer",bo.value.back=null,bo.value.home="/"}restoreAppState(){var t;if(null==(t=this.webview)?void 0:t.postMessage)return;const e=Ka.LsOpt.loadParsedAppStateLS();e&&(po.value=e,So.value=po.value.rulersGridVisible)}setDocMarginOffset(){this.webview?(fo.value=!0,xo.value.widthOffset="128px",xo.value.heightOffset="68px",Co.top=56):(fo.value=!1,Co.top=117)}initPanzoom(){const t={maxZoom:4,minZoom:.1,zoomDoubleClickSpeed:1,filterKey:function(){return!0},beforeMouseDown:function(t){return!!To.value||!t.altKey},beforeWheel:function(t){return!!To.value}};za=Ht(Po.value,t),za.on("transform",(function(t){po.value.viewportTransform=t.getTransform(),Wa.restDocumentAreaPosition(t.getTransform()),Ka.QuasarUtil.setLocalSettings("transform",t.getTransform())}))}resetPanzoom(){let t=po.value.viewportTransform;(!t||0===t.x&&0===t.y&&1===t.scale)&&(t=Ka.QuasarUtil.getLocalSettings("transform")),t&&za&&(za.zoomAbs(t.x,t.y,t.scale),za.moveTo(t.x,t.y))}clearGrpSwitch(){_o.ClearGrpSwitch()}initZoom(){var t;this.zoom="function"==typeof(t={get:()=>parseInt(100*po.value.viewportTransform.scale+""),set(t){if(!t)return;const e=t/100,i=po.value.viewportTransform.x,o=po.value.viewportTransform.y;po.value.viewportTransform.scale=e,za&&za.zoomAbs(i,o,e)}})?{value:t()}:{get value(){var e;return(null==(e=t.get)?void 0:e.call(t))||null},set value(e){var i;null==(i=t.set)||i.call(t,e)}}}static restDocumentAreaPosition(t){const e=document.querySelector(".full-area");e&&(xo.value.workAreaPadding=To.value?"0px":"110px",xo.value.hRulerWOffset=To.value?"24px":"128px",xo.value.wpwWOffset=To.value?"24px":"128px",xo.value.wpWOffset=To.value?"26px":"136px",xo.value.hRuler={width:e.clientWidth,height:20},xo.value.vRuler={width:20,height:e.clientHeight},xo.value.hvGrid={width:e.clientWidth,height:e.clientHeight},xo.value.wiewPortWH={width:"calc(100vw - v-bind('documentAreaPosition.wpWOffset'))",height:"calc(100vh - 93px)"},xo.value.widthOffset=To.value?"24px":"128px",fo.value?xo.value.heightOffset=(To.value,"68px"):xo.value.heightOffset=(To.value,"115px"))}refreshMoveableGuides(){setTimeout((()=>{Jn.refreshMoveableGuides()}),100)}handleScroll(t){xo.value.vRuler.height+=t.target.scrollTop,xo.value.hRuler.width+=t.target.scrollLeft,document.querySelector(".v-ruler").scroll(0,t.target.scrollTop),document.querySelector(".h-ruler").scroll(t.target.scrollLeft,0)}initScorller(){const t=document.querySelector(".viewport-wrapper");t.addEventListener("scroll",this.handleScroll),xo.value.hRuler={width:t.clientWidth,height:20},xo.value.vRuler={width:20,height:t.clientHeight},xo.value.hvGrid={width:t.clientWidth,height:t.clientHeight}}initFetchPanelEntryInterval(){var t;(null==(t=this.webview)?void 0:t.postMessage)&&(this.getPanelsInterval=setInterval((()=>{Ka.WebClient.GetPanelsList()}),1e4),setInterval((function(){const t=Jn.getLinkedEntries();if(t.length<=0)return;const e=t.map((t=>({panelId:t.t3Entry.pid,index:t.t3Entry.index,type:Oo[t.t3Entry.type]})));Ka.WebClient.GetEntries(null,null==e?void 0:e.index,e)}),1e4))}initMessageClient(){if(fo.value)return Ka.WebClient.GetInitialData(),Ka.WebClient.GetPanelsList(),void this.initFetchPanelEntryInterval();fo.value||this.initExternalBrowserOpt()}initExternalBrowserOpt(){fo.value||(Ka.WsClient.initQuasar(this.$q),Ka.WsClient.connect(),setTimeout((()=>{const t=Ka.DeviceOpt.getCurrentDevice();t?(yo.value.active=!1,yo.value.data=t,Ka.WsClient.GetInitialData(t.deviceId,t.graphic,!0)):yo.value.active=!0}),1e3),setInterval((function(){const t=Jn.getLinkedEntries();if(0===t.length)return;const e=t.map((t=>({panelId:t.t3Entry.pid,index:t.t3Entry.index,type:Oo[t.t3Entry.type]})));Ka.WsClient.GetEntries(e)}),1e4))}clearGetPanelsInterval(){this.getPanelsInterval&&clearInterval(this.getPanelsInterval)}clearIdx(){po.value.selectedTargets=[],za&&(za.dispose(),za=null)}isLoggedIn(){this.$q.cookies.has("token")?(null.get("hvacTools").then((async t=>{const e=await t.json();e.length>0&&(null==e||e.forEach((t=>{this.addOnlineLibImage(t)})))})).catch((t=>{F.Debug(t)})),null.get("hvacObjectLibs").then((async t=>{const e=await t.json();e.length>0&&e.forEach((t=>{Do.value.objLib.push({id:t.id,label:t.label,items:t.items,online:!0})}))})).catch((t=>{F.Debug(t)})),null.get("me").then((async t=>{mo.value=await t.json()})).catch((t=>{}))):mo.value=null}T3UpdateEntryField(t,e){if(!e.t3Entry)return;let i=e.t3Entry[t];const o=i;Math.abs(i)>=1e3&&(i/=1e3),"value"!==t&&"control"!==t||Jn.refreshObjectStatus(e);const n={action:3,field:t,value:i,panelId:e.t3Entry.pid,entryIndex:e.t3Entry.index,entryType:Oo[e.t3Entry.type]};fo.value?Ka.WebClient.UpdateEntry(n):Ka.WsClient.UpdateEntry(n),F.Debug("= Idx T3UpdateEntryField to T3 before, after",o,i)}newProject(){var t;if(fo.value)po.value=h.exports.cloneDeep(co),Eo.value=[],Fo.value=[],this.refreshMoveable(),(null==(t=this.webview)?void 0:t.postMessage)||localStorage.removeItem("appState");else{po.value=h.exports.cloneDeep(co),Eo.value=[],Fo.value=[],this.refreshMoveable(),localStorage.setItem("appState",JSON.stringify(po.value));const t=Ka.DeviceOpt.getCurrentDevice(),e=Ka.LsOpt.loadDeviceAppStateLS();if(t){const i=e.find((e=>e.device.device===t.device&&e.device.graphic===t.graphic));i&&(i.appState=h.exports.cloneDeep(co),localStorage.setItem("deviceAppState",JSON.stringify(e)))}localStorage.setItem("tempAppState",JSON.stringify(po.value)),t.graphicFull.elementCount=0,localStorage.setItem("currentDevice",JSON.stringify(t))}}refreshMoveable(){setTimeout((()=>{Go.value.updateRect()}),1)}save(t=!1,e=!1,i=!1){Io.value=t,this.saveToLocal(),e&&this.saveToT3000(i)}prepareSaveData(){const t=h.exports.cloneDeep(po.value);return t.itemsCount=t.items.filter((t=>0!==t.width)).length,t.selectedTargets=[],t.elementGuidelines=[],t.rulersGridVisible=So.value,t.locked=To.value,t}saveToLocal(){const t=this.prepareSaveData();if(Ka.LsOpt.saveAppState(t),!fo.value){_o.LoadGrpSwitch()||Ka.DeviceOpt.saveDeviceAppState(go,yo,t)}}saveToT3000(t=!1){const e=this.prepareSaveData(),i=_o.LoadGrpSwitch();F.Debug("= Idx saveToT3000 called:",{isAutoSave:t,hasGrpSwitch:!!i});const o=Ro.value.find((t=>"get_initial_data"===t.msgType)),n=Ro.value.find((t=>"load_graphic_entry"===t.msgType));if(o||n)F.Debug("= Idx save to T3000 - currently loading data, skip save to prevent race condition");else if(i)t?F.Debug("= Idx saveToT3000 - auto-save skipped during GRP navigation"):F.Debug("= Idx saveToT3000 - manual save skipped during GRP navigation to prevent race condition");else if(fo.value)F.Debug("= Idx saveToT3000 using current device (null params)"),Ka.WebClient.SaveGraphicData(null,null,e);else{const t=Ka.DeviceOpt.getCurrentDevice();let i=null==t?void 0:t.deviceId,o=null==t?void 0:t.graphic;F.Debug("= Idx saveToT3000 using currentDevice:",{panelId:i,graphicId:o}),i&&o?Ka.WsClient.SaveGraphic(i,o,e):F.Debug("= Idx save to T3000 current device is null")}}initAutoSaveInterval(){setTimeout((()=>{this.autoSaveInterval=setInterval((()=>{F.Debug("= Idx auto save every 30s",(new Date).toLocaleString()),this.save(!0,!0,!0)}),15e3)}),1e4)}clearAutoSaveInterval(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval)}addOnlineLibImage(t){const e=Do.value.images.findIndex((e=>e.id==="IMG-"+t.id));-1!==e&&Do.value.images.splice(e,1),Do.value.images.push({id:"IMG-"+t.id,dbId:t.id,name:t.name,path:{}.API_URL+"/file/"+t.file.path,online:!0})}}const Ka={PageMain:new class{constructor(){a(this,"ResetLeftPanel",(t=>{const e=document.getElementById(ge.DocumentAreaModel.LEFT_PANEL_ID),i=t?0:ge.DocumentAreaModel.LEFT_PANEL_WIDTH;e.setAttribute("style",`width: ${i}px`);const o=document.getElementById(ge.DocumentAreaModel.WORK_AREA_ID),n=t?0:ge.DocumentAreaModel.WORK_AREA_PADDING_LEFT;o.setAttribute("style",`padding-left: ${n}px`),F.Debug("ResetLeftPanel=>",`isLocked=${t}`,`newWidth=${i}`,`newPaddingLeft=${n}`)})),a(this,"ResetZoom",(()=>{F.Debug("ResetZoom=>")})),a(this,"UpdateExteriorWallStroke",((t,e,i)=>{if(!t)return;const o=this.GetExteriorWallStrokeWidth(i);t.value.items[e].settings.strokeWidth=o})),a(this,"GetExteriorWallHeight",(t=>.5128205128205128*t)),a(this,"GetExteriorWallStrokeWidth",(t=>1.95*t)),a(this,"ClearItemsWithZeroWidth",(t=>{if(!t)return;const e=t.value.items.filter((t=>0!==t.width));t.value.items=h.exports.cloneDeep(e),null!=t.value.activeItemIndex&&(t.value.activeItemIndex=t.value.items.length-1)})),a(this,"SetWallDimensionsVisible",((t,e,i,o)=>{if("all"==t&&i.value.items.forEach((t=>{"Int_Ext_Wall"===t.type&&(t.showDimensions=o)})),"select"===t){if(e)return;{const t=i.value.selectedTargets.map((t=>i.value.items.findIndex((e=>`moveable-item-${e.id}`===t.id&&"Int_Ext_Wall"===e.type))));i.value.items.forEach(((e,i)=>{"Int_Ext_Wall"===e.type&&(e.showDimensions=t.includes(i))}))}}})),a(this,"GetPreviousItem",(t=>{let e=t.value.activeItemIndex-1;for(;e>=0&&0===t.value.items[e].width;)e--;return e>=0?e:-1})),a(this,"StartAutoJoinWall",((t,e)=>{F.Debug("AutoJoinWall StartAutoJoinWall=>",t.value.items,t.value.activeItemIndex,e);const i=t.value.items[t.value.activeItemIndex],o=this.GetPreviousItem(t),n=t.value.items[o];F.Debug("AutoJoinWall StartAutoJoinWall Current item:",i),F.Debug("AutoJoinWall StartAutoJoinWall Previous item:",n),null!=n&&(n.joinWall?n.joinWall.push(h.exports.cloneDeep(i)):n.joinWall=[h.exports.cloneDeep(i)])})),a(this,"AutoJoinWall",((t,e,i,o,n)=>{var s;F.Debug("AutoJoinWall=>",t.value.items,t.value.activeItemIndex,e,i,o,n);const a=this.GetPreviousItem(t),r=t.value.items[a];null!=r&&(null==(s=null==r?void 0:r.joinWall)||s.forEach((t=>{t.x=e,t.y=i,t.rotate=o,t.width=n})))}))}},UI:null,KiOpt:new class{constructor(){a(this,"insertT3EntryDialog"),this.insertT3EntryDialog=Ga.value}InsertT3EntryDialog(){F.Debug("= O.KeyInsertOpt InsertT3EntryDialog: The insert key has been pressed"),F.Debug("= O.KeyInsertOpt InsertT3EntryDialog: The insertT3EntryDialog data been initial with value",this.insertT3EntryDialog),this.insertT3EntryDialog.active=!0}CloseT3EntryDialog(){this.insertT3EntryDialog.active=!1}InsertT3EntrySelect(t){F.Debug("= O.KeyInsertOpt InsertT3EntryDialog: value",t)}},QuasarUtil:new $n,LsOpt:new Ma,DeviceOpt:new Ha,WsClient:new class{constructor(){a(this,"socket",null),a(this,"retries",0),a(this,"maxRetries",10),a(this,"pingInterval",1e4),a(this,"pingIntervalId",null),a(this,"reconnectTimeoutId",null),a(this,"uri"),a(this,"messageModel"),a(this,"messageData"),a(this,"needRefresh",!0),a(this,"$q"),a(this,"reloadInitialDataInterval"),a(this,"isDestroyed",!1),a(this,"messageQueue",[]),a(this,"deviceOpt",null),a(this,"idxPage",null),a(this,"quasarUtil",null),a(this,"messageHandlers",{[_a.GET_PANEL_DATA_RES]:this.HandleGetPanelDataRes.bind(this),[_a.GET_INITIAL_DATA_RES]:this.HandleGetInitialDataRes.bind(this),[_a.SAVE_GRAPHIC_DATA_RES]:this.HandleSaveGraphicRes.bind(this),[_a.UPDATE_ENTRY_RES]:this.HandleUpdateEntryRes.bind(this),[_a.GET_PANELS_LIST_RES]:this.HandleGetPanelsListRes.bind(this),[_a.GET_ENTRIES_RES]:this.HandleGetEntriesRes.bind(this),[_a.LOAD_GRAPHIC_ENTRY_RES]:this.HandleLoadGraphicEntryRes.bind(this),[_a.OPEN_ENTRY_EDIT_WINDOW_RES]:this.HandleOpenEntryEditWindowRes.bind(this),[_a.SAVE_IMAGE_RES]:this.HandleSaveImageRes.bind(this),[_a.SAVE_LIBRARY_DATA_RES]:this.HandleSaveLibraryDataRes.bind(this),[_a.SAVE_NEW_LIBRARY_DATA_RES]:this.HandleSaveNewLibraryDataRes.bind(this),[_a.DELETE_IMAGE_RES]:this.HandleDeleteImageRes.bind(this),[_a.DATA_SERVER_ONLINE]:this.HandleDataServerOnline.bind(this)})}setDependencies(t,e,i){this.deviceOpt=t,this.idxPage=e,this.quasarUtil=i}connect(){if(this.isDestroyed)return void F.Error("Cannot connect: WebSocketClient has been destroyed");this.cleanup(),this.uri=this.getUri();const t=`ws://${this.uri}:9104`;try{this.socket=new WebSocket(t),this.setupEventHandlers()}catch(e){F.Error("Failed to create WebSocket connection:",e),this.attemptReconnect()}}setupEventHandlers(){this.socket&&(this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=this.onError.bind(this))}onOpen(t){F.Debug("= ws: connection opened:",t),this.retries=0,this.socket&&this.socket.readyState===WebSocket.OPEN&&(this.bindCurrentClient(),this.processPendingMessages()),this.GetPanelsList()}onMessage(t){F.Debug("= Ws message received:",t.data);try{this.processMessage(t.data)}catch(e){F.Error("Error processing WebSocket message:",e)}}onClose(t){F.Debug("= ws: connection closed:",t),this.cleanup(),this.isDestroyed||this.attemptReconnect()}onError(t){Uo.Error("= ws: onError/",t);Va.ShowWebSocketError("Load device data failed, please check whether the T3000 application is running or not."),this.cleanup(),this.isDestroyed||this.attemptReconnect()}cleanup(){this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=null),this.reconnectTimeoutId&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=null),this.reloadInitialDataInterval&&(clearInterval(this.reloadInitialDataInterval),this.reloadInitialDataInterval=null),this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.readyState===WebSocket.OPEN&&this.socket.close(),this.socket=null)}startPing(){this.pingIntervalId&&clearInterval(this.pingIntervalId),this.pingIntervalId=setInterval((()=>{if(this.socket&&this.socket.readyState===WebSocket.OPEN)try{this.socket.send("ping")}catch(t){F.Error("Failed to send ping:",t)}}),this.pingInterval)}attemptReconnect(){if(this.retries>=this.maxRetries||this.isDestroyed)return;const t=Math.min(1e3*Math.pow(2,this.retries),3e4);this.reconnectTimeoutId=setTimeout((()=>{this.retries++,this.connect()}),t)}getUri(){return new URL(window.location.href).hostname}bindCurrentClient(){const t=Oe.GenerateUUID();this.messageModel=new Ua,this.messageModel.setHeader(),this.messageModel.setMessage(13,null,null,null,null,t);const e=this.messageModel.formatMessageData();this.messageData=JSON.stringify(e),this.sendMessage(this.messageData)}sendMessage(t){var e;if(this.isDestroyed)F.Error("Cannot send message: WebSocketClient has been destroyed");else if(this.socket&&this.socket.readyState===WebSocket.OPEN)try{this.socket.send(t);const e=(new Date).toLocaleString();try{const i=JSON.parse(t),o=(null==i?void 0:i.message)||i,n=this.getActionDetails(null==o?void 0:o.action);F.Debug("= WS: Sent message to T3000 backend:",{messageDetails:{action:null==o?void 0:o.action,actionName:n.name,actionDescription:n.description,actionCategory:n.category,implemented:n.implemented},messageContext:{panelId:null==o?void 0:o.panelId,viewitem:null==o?void 0:o.viewitem,msgId:null==o?void 0:o.msgId,serialNumber:null==o?void 0:o.serialNumber,hasData:!!(null==o?void 0:o.data),dataType:(null==o?void 0:o.data)?typeof o.data:null,dataLength:Array.isArray(null==o?void 0:o.data)||"string"==typeof(null==o?void 0:o.data)?o.data.length:null},connectionInfo:{socketState:this.socket.readyState,socketUrl:this.socket.url,timestamp:e},rawMessage:t})}catch{F.Debug("= WS: Sent message to T3000 backend (unparseable):",{messageType:"RAW_STRING",messageLength:(null==t?void 0:t.length)||0,timestamp:e,rawMessage:t})}}catch(i){F.Error("Failed to send message:",i),this.messageQueue.push(t),this.attemptReconnect()}else this.messageQueue.push(t),F.Debug("= ws: sendMessage / socket not open, message queued. Ready state:",null==(e=this.socket)?void 0:e.readyState),this.socket&&this.socket.readyState!==WebSocket.CLOSED||this.connect()}processPendingMessages(){for(var t;this.messageQueue.length>0&&(null==(t=this.socket)?void 0:t.readyState)===WebSocket.OPEN;){const t=this.messageQueue.shift();if(t)try{this.socket.send(t),F.Debug("= ws: pending message sent:",t)}catch(e){F.Error("Failed to send pending message:",e),this.messageQueue.unshift(t);break}}}destroy(){this.isDestroyed=!0,this.cleanup(),this.messageQueue=[],F.Debug("= ws: WebSocketClient destroyed")}FormatMessageData(t,e,i,o){var n,s;const a=null!=(s=null==(n=this.deviceOpt)?void 0:n.getSerialNumber(e))?s:-1;this.messageModel=new Ua,this.messageModel.setHeader(),this.messageModel.setMessage(t,e,i,o,a);const r=this.messageModel.formatMessageData();this.messageData=JSON.stringify(r)}FormatUpdateEntryData(t){var e,i,o;const n=t.panelId,s=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();if(null===s||null==s)return;const a=s.graphic,r=null!=(o=null==(i=this.deviceOpt)?void 0:i.getSerialNumber(n))?o:-1;this.messageModel=new Ua,this.messageModel.setHeader(),this.messageModel.setMessage(_a.UPDATE_ENTRY,n,a,null,r),this.messageModel.message.field=t.field,this.messageModel.message.value=t.value,this.messageModel.message.entryIndex=t.entryIndex,this.messageModel.message.entryType=t.entryType,void 0!==t.data&&(this.messageModel.message.data=t.data);const l=this.messageModel.formatMessageData();this.messageData=JSON.stringify(l)}FormatSaveImageData(t){var e,i,o;const n=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();if(null==n)return;const s=n.panelId,a=n.graphic,r=null!=(o=null==(i=this.deviceOpt)?void 0:i.getSerialNumber(s))?o:-1;this.messageModel=new Ua,this.messageModel.setHeader(),this.messageModel.setMessage(_a.SAVE_IMAGE,s,a,null,r),this.messageModel.message.filename=t.filename,this.messageModel.message.fileLength=t.fileLength,this.messageModel.message.fileData=t.fileData;const l=this.messageModel.formatMessageData();this.messageData=JSON.stringify(l)}FormatLoadGraphicEntryData(t){var e,i,o;const n=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();if(null==n)return;const s=t.panelId||n.panenId,a=n.graphic,r=null!=(o=null==(i=this.deviceOpt)?void 0:i.getSerialNumber(s))?o:-1;this.messageModel=new Ua,this.messageModel.setHeader(),this.messageModel.setMessage(_a.LOAD_GRAPHIC_ENTRY,s,a,null,r),this.messageModel.message.entryIndex=t.entryIndex,this.messageModel.message.viewitem=t.entryIndex;const l=this.messageModel.formatMessageData();this.messageData=JSON.stringify(l)}FormatOpenEntryEditWindow(t){var e,i,o;const n=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();if(null==n)return;const s=t.panelId||n.panenId,a=n.graphic,r=null!=(o=null==(i=this.deviceOpt)?void 0:i.getSerialNumber(s))?o:-1;this.messageModel=new Ua,this.messageModel.setHeader(),this.messageModel.setMessage(_a.OPEN_ENTRY_EDIT_WINDOW,s,a,null,r),this.messageModel.message.entryType=t.entryType,this.messageModel.message.entryIndex=t.entryIndex;const l=this.messageModel.formatMessageData();this.messageData=JSON.stringify(l)}GetData(t){this.sendMessage(JSON.stringify({action:t}))}GetPanelData(t){var e,i;const o=(new Error).stack,n=o?o.split("\n"):[],s=n.slice(1,6),a=n[2]||"Unknown caller",r=a.match(/at\s+(.+)\s+\((.+):(\d+):(\d+)\)/),l=r?{functionName:r[1],fileName:r[2].split("/").pop()||r[2],lineNumber:r[3],columnNumber:r[4]}:{functionName:"Unknown",fileName:a.trim(),lineNumber:"Unknown",columnNumber:"Unknown"};console.log("= WS: GET PANEL DATA REQUEST - Sending WebSocket request to T3000 backend:",{action:"GET_PANEL_DATA",messageType:_a.GET_PANEL_DATA,targetPanelId:t,callerInformation:{immediateCallerFunction:l.functionName,callerFile:l.fileName,callerLine:l.lineNumber,callerColumn:l.columnNumber,fullCallerContext:a.trim()},callStackTrace:{topCallers:s.map((t=>t.trim())),requestOrigin:this.identifyRequestOrigin(s),triggerSource:this.categorizeCallSource(s)},currentT3000State:{panelsDataLength:(null==(e=vo.value.panelsData)?void 0:e.length)||0,panelsListLength:(null==(i=vo.value.panelsList)?void 0:i.length)||0,loadingPanel:vo.value.loadingPanel},timestamp:(new Date).toISOString()}),this.FormatMessageData(_a.GET_PANEL_DATA,t,null,null),this.sendMessage(this.messageData)}GetInitialData(t,e,i){this.needRefresh=null==i||i,this.FormatMessageData(_a.GET_INITIAL_DATA,t,e,null),this.sendMessage(this.messageData)}SaveGraphic(t,e,i){this.FormatMessageData(_a.SAVE_GRAPHIC_DATA,t,e,i),this.sendMessage(this.messageData)}UpdateEntry(t){this.FormatUpdateEntryData(t),this.sendMessage(this.messageData)}GetPanelsList(){var t,e;const i=(new Error).stack,o=i?i.split("\n"):[],n=o.slice(1,6),s=o[2]||"Unknown caller",a=s.match(/at\s+(.+)\s+\((.+):(\d+):(\d+)\)/),r=a?{functionName:a[1],fileName:a[2].split("/").pop()||a[2],lineNumber:a[3],columnNumber:a[4]}:{functionName:"Unknown",fileName:s.trim(),lineNumber:"Unknown",columnNumber:"Unknown"};console.log("= WS: GET PANELS LIST REQUEST - Sending WebSocket request to T3000 backend:",{action:"GET_PANELS_LIST",messageType:_a.GET_PANELS_LIST,callerInformation:{immediateCallerFunction:r.functionName,callerFile:r.fileName,callerLine:r.lineNumber,callerColumn:r.columnNumber,fullCallerContext:s.trim()},callStackTrace:{topCallers:n.map((t=>t.trim())),requestOrigin:this.identifyRequestOrigin(n),triggerSource:this.categorizeCallSource(n)},currentT3000State:{panelsDataLength:(null==(t=vo.value.panelsData)?void 0:t.length)||0,panelsListLength:(null==(e=vo.value.panelsList)?void 0:e.length)||0,loadingPanel:vo.value.loadingPanel},timestamp:(new Date).toISOString()}),this.FormatMessageData(_a.GET_PANELS_LIST,null,null,null),this.sendMessage(this.messageData)}GetEntries(t){var e;console.log("= ws: GetEntries / data:",t);const i=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();if(null==i)return;const o=i.deviceId,n=i.graphic;i.serialNumber,this.FormatMessageData(_a.GET_ENTRIES,o,n,t),this.sendMessage(this.messageData)}LoadGraphicEntry(t){this.FormatLoadGraphicEntryData(t),this.sendMessage(this.messageData)}OpenEntryEditWindow(t){this.FormatOpenEntryEditWindow(t),this.sendMessage(this.messageData)}SaveImage(t){this.FormatSaveImageData(t),this.sendMessage(this.messageData)}SaveLibraryData(t,e,i){this.FormatMessageData(_a.SAVE_LIBRARY_DATA,t,e,i),this.sendMessage(this.messageData)}SaveNewLibraryData(t,e,i){this.FormatMessageData(_a.SAVE_NEW_LIBRARY_DATA,t,e,i),this.sendMessage(this.messageData)}DeleteImage(t){var e;const i=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();if(null==i)return;const o=i.deviceId,n=i.graphic;this.FormatMessageData(_a.DELETE_IMAGE,o,n,t),this.sendMessage(this.messageData)}printLog(t){try{if("GET_INITIAL_DATA_RES"==t.action){const e=JSON.parse(t.data),i=t.entry,o=null!=t.library&&""!==t.library?JSON.parse(t.library):{};F.Debug("= ws: printLog / Received data:",!0,{action:"GET_INITIAL_DATA_RES",data:e,entry:i,library:o})}else F.Debug("= ws: printLog / Received data:",t)}catch(e){F.Debug("= ws: printLog / Received data error",e)}}processMessage(t){F.Debug("= ws: printLog / received origin data",t);try{const e=JSON.parse(t);if(void 0!==e.error||!1===(null==e?void 0:e.status))return void this.handleError(e);this.printLog(e),this.processMessageData(e),this.showSuccess(e),F.Debug("= ========================")}catch(e){Uo.Error("= ws: processMessage/ failed to parse | process data:",e)}}processMessageData(t){const e=this.messageHandlers[t.action];e?e(t):F.Warn("No handler for message action:",t.action,t)}HandleGetPanelDataRes(t){var e,i,o,n,s,a,r,l;if(F.Debug("= ws: HandleGetPanelDataRes START ================="),F.Debug("= ws: HandleGetPanelDataRes / received panel_id:",null==t?void 0:t.panel_id),F.Debug("= ws: HandleGetPanelDataRes / received data length:",(null==(e=null==t?void 0:t.data)?void 0:e.length)||0),F.Debug("= ws: HandleGetPanelDataRes / current loadingPanel:",vo.value.loadingPanel),F.Debug("= ws: HandleGetPanelDataRes / total panels in list:",vo.value.panelsList.length),F.Debug("= ws: HandleGetPanelDataRes / BEFORE - panelsData length:",vo.value.panelsData.length),(null==t?void 0:t.data)&&t.data.length>0&&F.Debug("= ws: HandleGetPanelDataRes / sample received data items (first 3):",t.data.slice(0,3).map((t=>({pid:t.pid,index:t.index,type:t.type,label:t.label||t.description})))),null==(i=this.deviceOpt)||i.initGraphicList(t.data),(null==t?void 0:t.panel_id)&&(null==(o=this.idxPage)||o.clearGetPanelsInterval()),null==t?void 0:t.panel_id){if(null!==vo.value.loadingPanel&&vo.value.loadingPanel<vo.value.panelsList.length-1){F.Debug("= ws: HandleGetPanelDataRes / triggering next panel load, increment loadingPanel from:",vo.value.loadingPanel),vo.value.loadingPanel++;const t=vo.value.loadingPanel,e=vo.value.panelsList[t].panel_number;F.Debug("= ws: HandleGetPanelDataRes / loading next panel at index:",t,"panel_number:",e),this.GetPanelData(e)}null!==vo.value.loadingPanel&&vo.value.loadingPanel===vo.value.panelsList.length-1&&(F.Debug("= ws: HandleGetPanelDataRes / reached last panel, setting loadingPanel to null"),vo.value.loadingPanel=null),console.log("= WS: PANEL DATA RESPONSE START - Processing panel data from WebSocket:",{incomingPanelId:t.panel_id,incomingDataLength:(null==(n=t.data)?void 0:n.length)||0,incomingRangesLength:(null==(s=t.ranges)?void 0:s.length)||0,beforeUpdate:{panelsDataLength:(null==(a=vo.value.panelsData)?void 0:a.length)||0,panelsRangesLength:(null==(r=vo.value.panelsRanges)?void 0:r.length)||0,loadingPanel:vo.value.loadingPanel},timestamp:(new Date).toISOString()});const e=vo.value.panelsData.length,i=vo.value.panelsData.filter((e=>e.pid===t.panel_id));console.log("= WS: PANEL DATA FILTER - Removing existing data for panel:",{panelId:t.panel_id,beforeFilterLength:e,itemsToRemoveCount:i.length,timestamp:(new Date).toISOString()}),vo.value.panelsData=vo.value.panelsData.filter((e=>e.pid!==t.panel_id));const o=vo.value.panelsData.length;console.log("= WS: PANEL DATA FILTERED - Completed filtering:",{afterFilterLength:o,removedItems:e-o,timestamp:(new Date).toISOString()});const h=t.data?t.data.length:0;console.log("= WS: PANEL DATA CONCAT - Adding new data:",{newDataLength:h,addedItemsSample:null==(l=t.data)?void 0:l.slice(0,3),timestamp:(new Date).toISOString()}),vo.value.panelsData=vo.value.panelsData.concat(t.data);const c=vo.value.panelsData.length;console.log("= WS: PANEL DATA ADDED - Completed adding new data:",{finalLength:c,expectedLength:o+h,actuallyAdded:c-o,timestamp:(new Date).toISOString()});const p={};vo.value.panelsData.forEach((t=>{p[t.pid]=(p[t.pid]||0)+1})),console.log("= WS: PANEL DATA PID ANALYSIS - PID distribution after update:",{pidCounts:p,uniquePanels:Object.keys(p).length,totalItems:c,timestamp:(new Date).toISOString()});const d=Object.keys(p).filter((t=>p[t]>1));d.length>0&&F.Debug("= ws: HandleGetPanelDataRes / WARNING: Found items with same PID after filtering!",d),vo.value.panelsData.sort(((t,e)=>t.pid-e.pid)),ko.value=vo.value.panelsData;const u=vo.value.panelsRanges.length;vo.value.panelsRanges=vo.value.panelsRanges.filter((e=>e.pid!==t.panel_id));const g=vo.value.panelsRanges.length;vo.value.panelsRanges=vo.value.panelsRanges.concat(t.ranges);const y=vo.value.panelsRanges.length;F.Debug("= ws: HandleGetPanelDataRes / ranges: before filter:",u,"after filter:",g,"after concat:",y,"new ranges added:",t.ranges?t.ranges.length:0),Jn.refreshLinkedEntries(t.data),Jn.refreshLinkedEntries2(t.data),F.Debug("= ws: HandleGetPanelDataRes / FINAL - panelsData length:",vo.value.panelsData.length),F.Debug("= ws: HandleGetPanelDataRes END ===================")}}HandleGetInitialDataRes(t){var e,i,o,n,s;F.Debug("= ws: HandleGetInitialDataRes / msgData:",t);if(!(null==(e=this.deviceOpt)?void 0:e.isCurrentDeviceMessage(t)))return void F.Debug("= ws: HandleGetInitialDataRes / not current device message, return");const a=t.data;null!=a&&localStorage.setItem("tempAppState",a);const r=JSON.parse(a);F.Debug("= ws: HandleGetInitialDataRes / GET_INITIAL_DATA_RES msgData-appState | needRefresh:",r,this.needRefresh),this.needRefresh&&(null==(i=this.deviceOpt)||i.syncTempAppStateToDeviceAppState(),null==(o=this.deviceOpt)||o.refreshDeviceAppState(),null==(n=this.deviceOpt)||n.refreshCurrentDevice(),wo.value=[t.entry],t.library&&(t.library=JSON.parse(t.library),Do.value=t.library),setTimeout((()=>{Jn.refreshMoveableGuides()}),100),this.clearInitialDataInterval(),null==(s=this.quasarUtil)||s.clearGlobalMsg("get_initial_data"))}HandleSaveGraphicRes(t){Jn.saveGraphicData(t,this.$q)}HandleUpdateEntryRes(t){}HandleGetPanelsListRes(t){var e,i,o;const n=t.data;if(void 0===n)return;null==(e=this.deviceOpt)||e.initDeviceList(n),F.Debug("= ws: GET_PANELS_LIST_RES",null==(i=this.deviceOpt)?void 0:i.deviceList);const s=n.length>0?n[0].panel_number:null;null!==s&&this.GetPanelData(s);const a=JSON.parse(localStorage.getItem("currentDevice")||"{}");if(a&&!a.deviceId){const t=a.device,e=n.find((e=>e.panel_name===t));e&&(a.deviceId=e.panel_number,a.serialNumber=e.serial_number,localStorage.setItem("currentDevice",JSON.stringify(a)))}(null==(o=t.data)?void 0:o.length)&&(vo.value.panelsList=t.data,vo.value.loadingPanel=0)}HandleGetEntriesRes(t){t.data.forEach(((t,e)=>{var i,o;const n=vo.value.panelsData.findIndex((e=>e.index===t.index&&e.type===t.type&&e.pid===t.pid));if(-1!==n){const e=vo.value.panelsData[n],s="MON"===e.type&&(Array.isArray(e.input)||Array.isArray(e.range)||e.num_inputs>0),a="MON"===t.type&&!Array.isArray(t.input)&&!Array.isArray(t.range)&&!t.num_inputs,r=this.hasComplexDataStructures(e),l=!this.hasComplexDataStructures(t),h=r&&l;if(s&&a){F.Warn(" DATA CORRUPTION PREVENTED! Attempted to replace detailed monitor config with simplified version:",{id:t.id,pid:t.pid,existingDetails:{input:!!e.input,range:!!e.range,num_inputs:e.num_inputs,inputLength:null==(i=e.input)?void 0:i.length},newDetails:{input:!!t.input,range:!!t.range,num_inputs:t.num_inputs,inputLength:null==(o=t.input)?void 0:o.length}});const n=["input","range","num_inputs","an_inputs"],s=Object.keys(e),a=Object.keys(t);s.filter((t=>a.includes(t))).filter((t=>!n.includes(t))).forEach((i=>{e[i]!==t[i]&&(e[i]=t[i])}))}else if(h){const i=this.getComplexFields(e),o=Object.keys(e),n=Object.keys(t);o.filter((t=>n.includes(t))).filter((t=>!i.includes(t))).forEach((i=>{e[i]!==t[i]&&(e[i]=t[i])}))}else vo.value.panelsData[n]=t}})),Lo.value.active||(ko.value=vo.value.panelsData),Jn.refreshLinkedEntries(t.data),Jn.refreshLinkedEntries2(t.data)}HandleLoadGraphicEntryRes(t){var e,i;if(t.data=JSON.parse(t.data),po.value=t.data,void 0!==po.value.rulersGridVisible&&(So.value=po.value.rulersGridVisible),void 0!==po.value.locked&&(To.value=po.value.locked),wo.value.length>1){const e=wo.value[wo.value.length-2];e.index!==t.entry.index||e.pid!==t.entry.pid?wo.value.push(t.entry):wo.value.pop()}else wo.value.push(t.entry);setTimeout((()=>{Jn.refreshMoveableGuides()}),100);const o=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();o&&(null==(i=this.deviceOpt)||i.refreshGraphicPanelElementCount(o))}HandleOpenEntryEditWindowRes(t){}HandleSaveImageRes(t){Do.value.imagesCount++,Do.value.images.push({id:"IMG-"+Do.value.imagesCount,name:t.data.name,path:t.data.path,online:!1}),Jn.saveLib()}HandleSaveLibraryDataRes(t){}HandleSaveNewLibraryDataRes(t){F.Debug("= ws: Handle SAVE_NEW_LIBRARY_DATA_RES",t.data)}HandleDeleteImageRes(t){}HandleGetAllDevicesDataRes(t){}HandleDataServerOnline(t){var e;this.GetPanelsList();const i=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice(),o=null==i?void 0:i.deviceId,n=null==i?void 0:i.graphic;o&&n&&this.GetInitialData(o,n)}initQuasar(t){this.$q=t}handleError(t){var e;if(!t&&!t.error)return;Uo.Error("= ws: handleError/ messageData:",t);const i=null!=(e=null==t?void 0:t.error)?e:"";t.action===_a.GET_PANEL_DATA_RES||t.action===_a.GET_INITIAL_DATA_RES||t.action===_a.GET_PANELS_LIST_RES?this.handleSpecialMessage(t):""!==i&&Va.ShowWebSocketError(i)}showSuccess(t){var e,i,o,n,s;const a=null!=(e=null==t?void 0:t.action)?e:-1,r=null!=(o=null==(i=null==t?void 0:t.data)?void 0:i.status)&&o;F.Debug("= ws: showSuccess | action:",a,"| status:",r),a==_a.LOAD_GRAPHIC_ENTRY_RES&&(null==(n=this.quasarUtil)||n.ShowLOAD_GRAPHIC_ENTRY_RESSuccess()),a==_a.GET_INITIAL_DATA_RES&&(null==(s=this.quasarUtil)||s.ShowGET_INITIAL_DATA_RESSuccess())}handleSpecialMessage(t){var e;const i=t.action;if(i==_a.GET_PANEL_DATA_RES||i==_a.GET_PANELS_LIST_RES){const e=`Load device data failed with error: "${t.error}". Please check whether the T3000 application is running or not.`;Va.ShowWebSocketError(e),this.GetPanelsList()}if(i==_a.GET_INITIAL_DATA_RES){const i=`Load initial data failed with error: "${t.error}". Please try not update the graphic area, this may cause data loss. Please check whether the T3000 application is running or not.`;Va.ShowWebSocketError(i),this.reloadInitialData(),null==(e=this.quasarUtil)||e.setGlobalMsg("error",i,!1,"get_initial_data",null)}}reloadInitialData(){this.needRefresh&&(this.reloadInitialDataInterval||(this.reloadInitialDataInterval=setInterval((()=>{var t;const e=null==(t=this.deviceOpt)?void 0:t.getCurrentDevice(),i=null==e?void 0:e.deviceId,o=null==e?void 0:e.graphic;i&&o&&this.GetInitialData(i,o)}),2e3)))}clearInitialDataInterval(){this.reloadInitialDataInterval&&clearInterval(this.reloadInitialDataInterval),this.reloadInitialDataInterval=null,F.Debug("= ws: clearInitialDataInterval / this.reloadInitialDataInterval ",this.reloadInitialDataInterval)}hasComplexDataStructures(t){if(!t||"object"!=typeof t)return!1;const e=Object.values(t).some((t=>Array.isArray(t))),i=Object.values(t).some((t=>t&&"object"==typeof t&&!Array.isArray(t)&&Object.keys(t).length>0)),o=({MON:["input","range","num_inputs","an_inputs"],GRP:["items","controls","children"],SCH:["schedule","items","events"]}[t.type]||[]).some((e=>void 0!==t[e]));return e||i||o}getDataComplexityInfo(t){if(!t||"object"!=typeof t)return{simple:!0};const e=Object.keys(t).filter((e=>Array.isArray(t[e]))),i=Object.keys(t).filter((e=>t[e]&&"object"==typeof t[e]&&!Array.isArray(t[e])));return{totalFields:Object.keys(t).length,arrays:e.length,arrayFields:e,objects:i.length,objectFields:i,hasComplexity:this.hasComplexDataStructures(t)}}getComplexFields(t){if(!t||"object"!=typeof t)return[];const e=[];Object.keys(t).forEach((i=>{Array.isArray(t[i])&&e.push(i)})),Object.keys(t).forEach((i=>{t[i]&&"object"==typeof t[i]&&!Array.isArray(t[i])&&Object.keys(t[i]).length>0&&e.push(i)}));return({MON:["input","range","num_inputs","an_inputs"],GRP:["items","controls","children"],SCH:["schedule","items","events"],PID:["parameters","settings","config"]}[t.type]||[]).forEach((i=>{void 0===t[i]||e.includes(i)||e.push(i)})),e}identifyRequestOrigin(t){for(const e of t){if(e.includes("IndexPageSocket"))return"TrendLogIndexPageSocket.vue";if(e.includes("IndexPage"))return"IndexPage.vue";if(e.includes("initializeT3000Data"))return"T3000_Data_Initialization";if(e.includes("onMounted"))return"Component_OnMounted_Lifecycle";if(e.includes("setTimeout"))return"Delayed_Timer_Execution";if(e.includes("HandleGetPanelsListRes"))return"Auto_Chain_After_PanelsList_Response";if(e.includes("HandleGetPanelDataRes"))return"Auto_Chain_After_PanelData_Response";if(e.includes("watch"))return"Vue_Reactive_Watcher";if(e.includes("loadTrendLogItemData"))return"Data_Loading_Function";if(e.includes("connect"))return"WebSocket_Connection_Establishment"}return"Unknown_Origin"}categorizeCallSource(t){const e=t.join(" ");return e.includes("initializeT3000Data")?"INITIALIZATION_REQUEST":e.includes("onMounted")?"COMPONENT_MOUNT_REQUEST":e.includes("setTimeout")?"DELAYED_EXECUTION_REQUEST":e.includes("HandleGetPanelsListRes")?"AUTO_CHAIN_AFTER_PANELS_LIST":e.includes("HandleGetPanelDataRes")?"AUTO_CHAIN_AFTER_PANEL_DATA":e.includes("watch")?"REACTIVE_WATCHER_TRIGGER":e.includes("loadTrendLogItemData")?"EXPLICIT_DATA_LOAD_REQUEST":e.includes("retry")||e.includes("Retry")?"USER_RETRY_REQUEST":e.includes("route")?"ROUTE_CHANGE_TRIGGER":e.includes("connect")?"WEBSOCKET_CONNECTION_TRIGGER":"MANUAL_OR_DIRECT_CALL"}getActionDetails(t){return{0:{name:"GET_PANEL_DATA",description:"Request panel data from T3000 backend",category:"Data_Request",implemented:!0,responseAction:"GET_PANEL_DATA_RES"},1:{name:"GET_INITIAL_DATA",description:"Request initial application data and state",category:"Initialization",implemented:!0,responseAction:"GET_INITIAL_DATA_RES"},2:{name:"SAVE_GRAPHIC_DATA",description:"Save graphic/layout data to T3000",category:"Data_Save",implemented:!0,responseAction:"SAVE_GRAPHIC_DATA_RES"},3:{name:"UPDATE_ENTRY",description:"Update a specific entry/field value",category:"Data_Update",implemented:!0,responseAction:"UPDATE_ENTRY_RES"},4:{name:"GET_PANELS_LIST",description:"Request list of available panels",category:"Data_Request",implemented:!0,responseAction:"GET_PANELS_LIST_RES"},5:{name:"GET_PANEL_RANGE_INFO",description:"Request panel range information",category:"Data_Request",implemented:!1,responseAction:"GET_PANEL_RANGE_INFO_RES"},6:{name:"GET_ENTRIES",description:"Request specific entries data",category:"Data_Request",implemented:!0,responseAction:"GET_ENTRIES_RES"},7:{name:"LOAD_GRAPHIC_ENTRY",description:"Load graphic entry for editing",category:"UI_Navigation",implemented:!0,responseAction:"LOAD_GRAPHIC_ENTRY_RES"},8:{name:"OPEN_ENTRY_EDIT_WINDOW",description:"Open entry edit window in T3000",category:"UI_Action",implemented:!0,responseAction:"OPEN_ENTRY_EDIT_WINDOW_RES"},9:{name:"SAVE_IMAGE",description:"Save image file to T3000 library",category:"File_Operation",implemented:!0,responseAction:"SAVE_IMAGE_RES"},10:{name:"SAVE_LIBRARY_DATA",description:"Save library data to T3000",category:"Data_Save",implemented:!0,responseAction:"SAVE_LIBRARY_DATA_RES"},11:{name:"DELETE_IMAGE",description:"Delete image from T3000 library",category:"File_Operation",implemented:!0,responseAction:"DELETE_IMAGE_RES"},12:{name:"GET_SELECTED_DEVICE_INFO",description:"Get information about selected device",category:"Device_Info",implemented:!0,responseAction:"GET_SELECTED_DEVICE_INFO_RES"},13:{name:"BIND_DEVICE",description:"Bind/connect to a device",category:"Device_Operation",implemented:!1,responseAction:"BIND_DEVICE_RES"},14:{name:"SAVE_NEW_LIBRARY_DATA",description:"Save new library data to T3000",category:"Data_Save",implemented:!1,responseAction:"SAVE_NEW_LIBRARY_DATA_RES"}}[t]||{name:"UNKNOWN_ACTION",description:`Unknown action code: ${t}`,category:"Unknown",implemented:!1,responseAction:"UNKNOWN_RES"}}},IdxPage:new Wa,WebClient:null,IdxUtils:Jn,IdxPage2:new class{constructor(){a(this,"webview",null==(n=window.chrome)?void 0:n.webview),a(this,"$q"),a(this,"getPanelsInterval"),a(this,"autoSaveInterval")}initPage(){}initQuasar(t){this.$q=t,Ka.WebClient.initQuasar(this.$q),Ka.QuasarUtil.initQuasar(this.$q)}initGlobalNav(){bo.value.title="HVAC Drawer",bo.value.back=null,bo.value.home="/"}restoreAppState(){var t;if(null==(t=this.webview)?void 0:t.postMessage)return;const e=Ka.LsOpt.loadParsedAppStateLS();e&&(uo.value=e)}isLoggedIn(){this.$q.cookies.has("token")?(null.get("hvacTools").then((async t=>{const e=await t.json();e.length>0&&(null==e||e.forEach((t=>{this.addOnlineLibImage(t)})))})).catch((t=>{F.Debug(t)})),null.get("hvacObjectLibs").then((async t=>{const e=await t.json();e.length>0&&e.forEach((t=>{Do.value.objLib.push({id:t.id,label:t.label,items:t.items,online:!0})}))})).catch((t=>{F.Debug(t)})),null.get("me").then((async t=>{mo.value=await t.json()})).catch((t=>{}))):mo.value=null}static autoManualToggle(t){F.Debug("5555555 IndexPage2.vue->autoManualToggle->item, locked value",t),t.t3Entry.auto_manual=t.t3Entry.auto_manual?0:1,this.T3UpdateEntryField("auto_manual",t)}static T3UpdateEntryField(t,e){if(!e.t3Entry)return;let i=e.t3Entry[t];const o=i;Math.abs(i)>=1e3&&(i/=1e3),"value"!==t&&"control"!==t||Jn.refreshObjectStatus(e);const n={action:3,field:t,value:i,panelId:e.t3Entry.pid,entryIndex:e.t3Entry.index,entryType:Oo[e.t3Entry.type]};fo.value?Ka.WebClient.UpdateEntry(n):Ka.WsClient.UpdateEntry(n),F.Debug("= Idx T3UpdateEntryField to T3 before, after",o,i)}initFetchPanelEntryInterval(){var t;(null==(t=this.webview)?void 0:t.postMessage)&&(this.getPanelsInterval=setInterval((()=>{Ka.WebClient.GetPanelsList()}),1e4),setInterval((function(){const t=Jn.getLinkedEntries();if(t.length<=0)return;const e=t.map((t=>({panelId:t.t3Entry.pid,index:t.t3Entry.index,type:Oo[t.t3Entry.type]})));Ka.WebClient.GetEntries(null,null,e)}),1e4))}initMessageClient(){if(fo.value)return Ka.WebClient.GetInitialData(),Ka.WebClient.GetPanelsList(),void this.initFetchPanelEntryInterval();fo.value||this.initExternalBrowserOpt()}initExternalBrowserOpt(){fo.value||(Ka.WsClient.initQuasar(this.$q),Ka.WsClient.connect(),setTimeout((()=>{const t=Ka.DeviceOpt.getCurrentDevice();t?(yo.value.active=!1,yo.value.data=t,Ka.WsClient.GetInitialData(t.deviceId,t.graphic,!0)):yo.value.active=!0}),1e3),setInterval((function(){const t=Jn.getLinkedEntries();if(0===t.length)return;const e=t.map((t=>({panelId:t.t3Entry.pid,index:t.t3Entry.index,type:Oo[t.t3Entry.type]})));Ka.WsClient.GetEntries(e)}),1e4))}save(t=!1,e=!1){F.Debug("= Idx2 save to local storage",(new Date).toLocaleString()),Io.value=t,_o.SaveToLocalStorage(),e&&_o.SaveToT3000()}saveToLocal(){const t=this.prepareSaveData();Ka.LsOpt.saveAppState(t),fo.value||Ka.DeviceOpt.saveDeviceAppState(go,yo,t)}saveToT3000(){const t=this.prepareSaveData();if(fo.value)Ka.WebClient.SaveGraphicData(null,null,t);else{if(Ro.value.find((t=>"get_initial_data"===t.msgType)))return void F.Debug("= Idx save to T3000 with initial data status error, cancel auto save");const e=Ka.DeviceOpt.getCurrentDevice(),i=null==e?void 0:e.deviceId,o=null==e?void 0:e.graphic;i&&o?Ka.WsClient.SaveGraphic(i,o,t):F.Debug("= Idx save to T3000 current device is null")}}initAutoSaveInterval(){setTimeout((()=>{this.autoSaveInterval=setInterval((()=>{this.save(!0,!0)}),15e3)}),1e4)}prepareSaveData(){const t=h.exports.cloneDeep(uo.value);return t.itemsCount=t.items.filter((t=>0!==t.width)).length,t.selectedTargets=[],t.elementGuidelines=[],t.rulersGridVisible=So.value,t}T3UpdateEntryField(t,e){if(F.Debug("idx page 2  T3UpdateEntryField appState before",uo.value),!e.t3Entry)return;let i=e.t3Entry[t];const o=i;Math.abs(i)>=1e3&&(i/=1e3),"value"!==t&&"control"!==t||Jn.refreshObjectStatus(e);const n={action:3,field:t,value:i,panelId:e.t3Entry.pid,entryIndex:e.t3Entry.index,entryType:Oo[e.t3Entry.type]};fo.value?Ka.WebClient.UpdateEntry(n):Ka.WsClient.UpdateEntry(n),F.Debug("= Idx T3UpdateEntryField to T3 before, after",o,i)}addOnlineLibImage(t){const e=Do.value.images.findIndex((e=>e.id==="IMG-"+t.id));-1!==e&&Do.value.images.splice(e,1),Do.value.images.push({id:"IMG-"+t.id,dbId:t.id,name:t.name,path:{}.API_URL+"/file/"+t.file.path,online:!0})}addToNewLibrary(){if(uo.value.selectedTargets.length<1||To.value)return;const t=uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`))));let e=!1;const i=h.exports.cloneDeep(t);Do.value.objLibItemsCount++;let o=null;mo.value&&(e=!0,null.post("hvacObjectLibs",{json:{label:"Item "+Do.value.objLibItemsCount,items:i.map((t=>(delete t.id,t)))}}).then((async t=>{o=await t.json(),Na.ShowMessage("success","Successfully saved to library"),Do.value.objLib.push({id:(null==o?void 0:o.id)||Do.value.objLibItemsCount,label:"Item "+Do.value.objLibItemsCount,items:o.items,online:e}),Jn.saveNewLib()})).catch((t=>{Na.ShowMessage("error",t.message)}))),Do.value.objLib.push({id:(null==o?void 0:o.id)||Do.value.objLibItemsCount,label:"Item "+Do.value.objLibItemsCount,items:i,online:e}),Jn.saveNewLib()}viewportLeftClick(t){t.preventDefault();if(!To.value&&"Pointer"!==On.value.name&&"Wall"!=On.value.name&&!xn.value&&"Int_Ext_Wall"!=On.value.name&&"Duct"!=On.value.name){var e={rect:{width:60,height:60,top:t.clientY,left:t.clientX},clientX:t.clientX,clientY:t.clientY};onSelectoDragEnd(e),this.selectTool(Mo[0])}}selectTool(t,e="default"){F.Debug("= IdxPage selectTool",t,e),On.value=t,"string"==typeof t&&(On.value=Mo.find((e=>e.name===t))),On.value.type=e,Ka.UI.evtOpt.HandleSidebarToolEvent(On)}viewportRightClick(t){t.preventDefault(),this.selectTool(Mo[0]),xn.value&&(xn.value=!1,this.undoAction(),setTimeout((()=>{this.refreshObjects()}),10),Ka.PageMain.ClearItemsWithZeroWidth(uo),Ka.PageMain.SetWallDimensionsVisible("all",xn.value,uo,!1))}undoAction(){Eo.value.length<1||(Fo.value.unshift({title:null,state:h.exports.cloneDeep(uo.value)}),uo.value=h.exports.cloneDeep(Eo.value[0].state),Eo.value.shift(),Ka.IdxPage.refreshMoveable())}redoAction(){Fo.value.length<1||(Eo.value.unshift({title:null,state:h.exports.cloneDeep(uo.value)}),uo.value=h.exports.cloneDeep(Fo.value[0].state),Fo.value.shift(),Ka.IdxPage.refreshMoveable())}updateWeldModelCanvas(t,e){uo.value.items.map((i=>{var o,n,s;if(("Weld_General"===i.type||"Weld_Duct"===i.type)&&i.id===t.id){const t=null==(o=null==i?void 0:i.weldItems[0])?void 0:o.translate[0],a=null==(n=null==i?void 0:i.weldItems[0])?void 0:n.translate[1];null==(s=null==i?void 0:i.weldItems)||s.forEach((i=>{const o=null==e?void 0:e.find((t=>{var e;return(null==(e=null==t?void 0:t.item)?void 0:e.id)===(null==i?void 0:i.id)}));o&&(i.width=o.newPos.width,i.height=o.newPos.height,i.translate[0]=t+o.newPos.trsx,i.translate[1]=a+o.newPos.trsy)}))}}))}updateWeldModel(t,e){uo.value.items.map((i=>{"Weld"===i.type&&i.id===t.id&&(i.settings.weldItems=e)}))}toggleRulersGrid(t){So.value="Enable"===t,uo.value.rulersGridVisible=So.value,this.save(!1,!1)}convertObjectType(t,e){var i;if(t||(t=uo.value.items[uo.value.activeItemIndex]),!t)return;addActionToHistory("Convert object to "+e);const o=h.exports.cloneDeep(null==(i=Mo.find((t=>t.name===e)))?void 0:i.settings)||{},n=Object.keys(o).reduce(((t,e)=>(t[e]=o[e].value,t)),{}),s={};for(const r in n)Object.hasOwnProperty.call(n,r)&&(void 0!==t.settings[r]?s[r]=t.settings[r]:s[r]=n[r]);const a=["bgColor","textColor","title","t3EntryDisplayField"];for(const r of a)void 0===s[r]&&(s[r]=t.settings[r]);t.type=e,t.settings=s}deleteLibImage(t){t.online&&null.delete("hvacTools/"+t.dbId||t.id.slice(4)).then((async()=>{this.$q.notify({type:"positive",message:"Successfully deleted"})})).catch((t=>{this.$q.notify({type:"negative",message:t.message})}));const e=Do.value.images.findIndex((e=>e.name===t.name));if(-1!==e&&(Do.value.images.splice(e,1),!t.online)){if(Do.value.images.length<=0)return;const t=h.exports.cloneDeep(Do.value.images[e].path);fo.value?Ka.WebClient.DeleteImage(t):Ka.WsClient.DeleteImage(t),Jn.saveLib()}}renameLibItem(t,e){mo.value&&t.online&&null.patch("hvacObjectLibs/"+t.id,{json:{label:e}}).then((async()=>{this.$q.notify({type:"positive",message:"Successfully updated"})})).catch((t=>{this.$q.notify({type:"negative",message:t.message})}));const i=Do.value.objLib.findIndex((e=>e.name===t.name));-1!==i&&(Do.value.objLib[i].label=e),Jn.saveLib()}deleteLibItem(t){mo.value&&t.online&&null.delete("hvacObjectLibs/"+t.id).then((async()=>{this.$q.notify({type:"positive",message:"Successfully deleted"})})).catch((t=>{this.$q.notify({type:"negative",message:t.message})}));const e=Do.value.objLib.findIndex((e=>e.name===t.name));-1!==e&&Do.value.objLib.splice(e,1),Jn.saveLib()}pasteFromClipboard(){if(To.value)return;let t=[];const e=localStorage.getItem("clipboard");if(e&&(t=JSON.parse(e)),!t)return;this.addActionToHistory("Paste");const i=[],o=[];t.forEach((t=>{o.push(this.cloneObject(t))})),setTimeout((()=>{o.forEach((t=>{const e=document.querySelector(`#moveable-item-${t.id}`);i.push(e)})),uo.value.selectedTargets=i,Tn.value.setSelectedTargets(i),uo.value.activeItemIndex=null}),10)}saveSelectedToClipboard(){if(To.value)return;if(0===uo.value.selectedTargets.length)return;const t=uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`))));localStorage.setItem("clipboard",JSON.stringify(t)),Un.value=!0}rotate90Selected(t=!1){Go.value.request("rotatable",{deltaRotate:t?-90:90},!0),Ka.IdxPage.refreshMoveable()}sendSelectedToBack(){this.addActionToHistory("Send selected objects to back");uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`)))).forEach((t=>{t.zindex=t.zindex-1}))}bringSelectedToFront(){this.addActionToHistory("Bring selected objects to front");uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`)))).forEach((t=>{t.zindex=t.zindex+1}))}objectSettingsUnchanged(){Eo.value.shift()}addToLibrary(){if(uo.value.selectedTargets.length<1||To.value)return;const t=uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`))));let e=!1;const i=h.exports.cloneDeep(t);Do.value.objLibItemsCount++;let o=null;mo.value&&(e=!0,null.post("hvacObjectLibs",{json:{label:"Item "+Do.value.objLibItemsCount,items:i.map((t=>(delete t.id,t)))}}).then((async t=>{o=await t.json(),this.$q.notify({type:"positive",message:"Successfully saved to library"}),Do.value.objLib.push({id:(null==o?void 0:o.id)||Do.value.objLibItemsCount,label:"Item "+Do.value.objLibItemsCount,items:o.items,online:e}),Jn.saveLib()})).catch((t=>{this.$q.notify({type:"negative",message:t.message})}))),Do.value.objLib.push({id:(null==o?void 0:o.id)||Do.value.objLibItemsCount,label:"Item "+Do.value.objLibItemsCount,items:i,online:e}),Jn.saveLib()}navGoBack(){if(wo.value.length>1){const t=wo.value[wo.value.length-2],e={action:7,panelId:t.pid,entryIndex:t.index};fo.value?Ka.WebClient.LoadGraphicEntry(e):Ka.WsClient.LoadGraphicEntry(e)}else if(fo.value)Ka.WebClient.GetInitialData();else{const t=Ka.DeviceOpt.getCurrentDevice(),e=t.panelId,i=t.graphic;Ka.WsClient.GetInitialData(e,i,!0)}}setTheSettingContextMenuVisible(){if(uo.value.selectedTargets.length>1)wn.value=!1,En.value=!1,Gn.value=!1;else if(1===uo.value.selectedTargets.length){const t=uo.value.items.find((t=>`moveable-item-${t.id}`===uo.value.selectedTargets[0].id));null!==t.t3Entry?(wn.value=!0,this.ObjectRightClicked(t,null)):(wn.value=!1,En.value=!1,Gn.value=!1)}}toggleClicked(t,e,i){"mode"===e&&("Auto"===Ln.value?(In.value=!0,Fn.value=!0):(In.value=!1,Fn.value=!1),t.t3Entry.auto_manual="Auto"===Ln.value?0:1,this.T3UpdateEntryField("auto_manual",t)),"value"==e&&(t.t3Entry.control="Off"===An.value?0:1,this.T3UpdateEntryField("control",t)),"number-value"===e&&(t.t3Entry.value=1*Rn.value,this.T3UpdateEntryField("value",t)),this.save(!1,!0)}ObjectRightClicked(t,e){null!==t.t3Entry?(kn.value=!0,1===t.t3Entry.auto_manual?(Ln.value="Manual",In.value=!1,Fn.value=!1):(Ln.value="Auto",In.value=!0,Fn.value=!0),0===t.t3Entry.digital_analog?En.value=!0:En.value=!1,1===t.t3Entry.control?An.value="On":An.value="Off",1===t.t3Entry.digital_analog&&101!==t.t3Entry.range?(Gn.value=!0,Rn.value=1*t.t3Entry.value):Gn.value=!1):kn.value=!1}changeEntryValue(t,e,i){const o=i?"control":"value",n=uo.value.items.find((e=>e.id===t.id));n.t3Entry[o]=e,this.T3UpdateEntryField(o,n)}autoManualToggle(t){F.Debug("5555555 IndexPage.vue->autoManualToggle->item, locked value",t),t.t3Entry.auto_manual=t.t3Entry.auto_manual?0:1,this.T3UpdateEntryField("auto_manual",t)}objectClicked(t){var e,i,o,n,s;if(F.Debug("= P.IDX2 objectClicked"),this.setTheSettingContextMenuVisible(),To.value)if("GRP"===(null==(e=t.t3Entry)?void 0:e.type)){const e={action:7,panelId:t.t3Entry.pid,entryIndex:t.t3Entry.index};fo.value?Ka.WebClient.LoadGraphicEntry(e):Ka.WsClient.LoadGraphicEntry(e)}else if(["SCHEDULE","PROGRAM","HOLIDAY"].includes(null==(i=t.t3Entry)?void 0:i.type)){const e={action:8,panelId:t.t3Entry.pid,entryType:Oo[t.t3Entry.type],entryIndex:t.t3Entry.index};fo.value?Ka.WebClient.OpenEntryEditWindow(e):Ka.WsClient.OpenEntryEditWindow(e)}else 1===(null==(o=t.t3Entry)?void 0:o.auto_manual)&&0===(null==(n=t.t3Entry)?void 0:n.digital_analog)&&(null==(s=t.t3Entry)?void 0:s.range)&&(t.t3Entry.control=1===t.t3Entry.control?0:1,this.T3UpdateEntryField("control",t))}lockToggle(){uo.value.activeItemIndex=null,uo.value.selectedTargets=[],To.value=!To.value,To.value&&this.selectTool("Pointer"),Ka.IdxPage.restDocumentAreaPosition()}entryLabel(t){let e=t.description&&t.id!==t.description||!t.description&&t.id!==t.label?t.id+" - ":"";return e=t.description||t.label?e:t.id,e+(t.description||t.label||"")}reloadPanelsData(){vo.value.loadingPanel=null,fo.value?Ka.WebClient.GetPanelsList():Ka.WsClient.GetPanelsList()}duplicateSelected(){if(uo.value.selectedTargets.length<1)return;this.addActionToHistory("Duplicate the selected objects");const t=[],e={};uo.value.selectedTargets.forEach((i=>{const o=uo.value.items.find((t=>`moveable-item-${t.id}`===i.id));if(o){let i;o.group&&(e[`${o.group}`]||(uo.value.groupCount++,e[`${o.group}`]=uo.value.groupCount),i=e[`${o.group}`]);const n=this.cloneObject(o,i);setTimeout((()=>{const e=document.querySelector(`#moveable-item-${n.id}`);t.push(e)}),10)}})),setTimeout((()=>{uo.value.selectedTargets=t,Tn.value.setSelectedTargets(t),uo.value.activeItemIndex=null}),20)}executeImportFromJson(){var t,e;const i=JSON.parse(_n.value.data);(null==(t=i.items)?void 0:t[0].type)?(null==(e=uo.value.items)?void 0:e.length)>0?this.$q.dialog({dark:!0,title:"You have unsaved drawing!",message:"Before proceeding with the import, please note that any unsaved drawing will be lost,\n           and your undo history will also be erased. Are you sure you want to proceed?",cancel:!0,persistent:!0}).onOk((()=>{Eo.value=[],Fo.value=[],_n.value.active=!1,uo.value=i,_n.value.data=null,setTimeout((()=>{Jn.refreshMoveableGuides()}),100),Ka.IdxPage.refreshMoveable()})).onCancel((()=>{_n.value.active=!1})):(Eo.value=[],Fo.value=[],_n.value.active=!1,uo.value=i,_n.value.data=null,setTimeout((()=>{Jn.refreshMoveableGuides()}),100),Ka.IdxPage.refreshMoveable()):this.$q.notify({message:"Error, Invalid json file",color:"negative",icon:"error",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]})}async saveLibImage(t){if(mo.value)return F.Debug("= Idx saveLibImage file",t),F.Debug("= Idx saveLibImage user",mo.value),void null.post("hvacTools",{json:{name:t.name,fileId:t.id}}).then((async t=>{this.$q.notify({color:"positive",message:"Image successfully saved"});const e=await t.json();this.addOnlineLibImage(e)})).catch((t=>{this.$q.notify({color:"negative",message:t.message})}));Do.value.imagesCount++;const e={action:9,filename:t.name,fileLength:t.size,fileData:await this.readFile(t.data)};fo.value?Ka.WebClient.SaveImage(e):Ka.WsClient.SaveImage(e)}drawObject(t,e,i){var o;if("libItem"===(i=i||On.value).type)return void this.addLibItem(i.items,t,e);const n=1/uo.value.viewportTransform.scale,s=h.exports.cloneDeep(null==(o=Mo.find((t=>t.name===i.name)))?void 0:o.settings)||{},a=Object.keys(s).reduce(((t,e)=>(t[e]=s[e].value,t)),{});"G_Rectangle"===i.name&&(t.width=100);const r={title:null,active:!1,type:i.name,translate:[(e.left-Co.left-uo.value.viewportTransform.x)*n,(e.top-Co.top-uo.value.viewportTransform.y)*n],width:t.width*n,height:t.height*n,rotate:0,scaleX:1,scaleY:1,settings:a,zindex:1,t3Entry:null,showDimensions:!0};if("Image"===i.type&&(r.image=i,r.type=i.id),i.cat){const[t]=i.cat;r.cat=t}const l=this.addObject(r);return["Value","Icon","Switch"].includes(i.name)&&(Lo.value.active=!0),setTimeout((()=>{To.value||(uo.value.activeItemIndex=uo.value.items.findIndex((t=>t.id===l.id)))}),10),setTimeout((()=>{if(To.value)return;const t=document.querySelector(`#moveable-item-${l.id}`);uo.value.selectedTargets=[t],Tn.value.setSelectedTargets([t])}),100),l}toolDropped(t,e){F.Debug("toolDropped->tool",t,e)}ungroupSelected(){uo.value.selectedTargets.length<2||(this.addActionToHistory("Ungroup the selected objects"),uo.value.selectedTargets.length>0&&uo.value.selectedTargets.forEach((t=>{const e=uo.value.items.find((e=>`moveable-item-${e.id}`===t.id));e&&(e.group=void 0)})))}groupSelected(){uo.value.selectedTargets.length<2||(this.addActionToHistory("Group the selected objects"),uo.value.selectedTargets.length>0&&(uo.value.groupCount++,uo.value.selectedTargets.forEach((t=>{const e=uo.value.items.find((e=>`moveable-item-${e.id}`===t.id));e&&(e.group=uo.value.groupCount)}))))}exportToJsonAction(){const t=h.exports.cloneDeep(uo.value);t.selectedTargets=[],t.elementGuidelines=[];const e=document.createElement("a"),i=new Blob([JSON.stringify(t)],{type:"application/json"});e.href=URL.createObjectURL(i),e.download="HVAC_Drawer_Project.json",e.click()}gaugeSettingsSave(t){const e=uo.value.items.findIndex((e=>e.id===t.id));uo.value.items[e]=t,jn.value.active=!1,jn.value.data={}}gaugeSettingsDialogAction(t){jn.value.active=!0,jn.value.data=t}readFile(t){return new Promise(((e,i)=>{var o=new FileReader;o.onload=()=>{e(o.result)},o.onerror=i,o.readAsDataURL(t)}))}weldSelected(){if(uo.value.selectedTargets.length<2)return;if(uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`)))).some((t=>"Weld"===t.type)))return void this.$q.notify({type:"warning",message:"Currently not supported!"});this.addActionToHistory("Weld selected objects");const t=uo.value.items.filter((t=>uo.value.selectedTargets.some((e=>e.id===`moveable-item-${t.id}`)))),e=t.every((t=>"General"===t.cat)),i=t.every((t=>"Duct"===t.type));e||i?this.drawWeldObjectCanvas(t):this.drawWeldObject(t),t.forEach((t=>{const e=uo.value.items.findIndex((e=>e.id===t.id));-1!==e&&uo.value.items.splice(e,1)})),Ka.IdxPage.refreshMoveable()}checkIsOverlap(t){const e=[];return t.map((t=>{const i=document.querySelector(`#moveable-item-${t.id} .duct-start`),o=document.querySelector(`#moveable-item-${t.id} .duct-end`),n=this.isDuctOverlap(i),s=this.isDuctOverlap(o);e.push({id:t.id,isStartOverlap:n,isEndOverlap:s})})),e}isDuctOverlap(t){const e=t.closest(".moveable-item.Duct"),i=getElementInfo(t),o=document.querySelectorAll(".moveable-item.Duct");for(const n of Array.from(o)){if(e.isSameNode(n))continue;const t=getElementInfo(n),o=getDuctPoints(i),s=getDuctPoints(t);if(getOverlapSize(o,s)>0)return!0}return!1}getDuctPoints(t){const{left:e,top:i,pos1:o,pos2:n,pos3:s,pos4:a}=t;return[o,n,a,s].map((t=>[e+t[0],i+t[1]]))}drawWeldObjectCanvas(t){const e=1/uo.value.viewportTransform.scale,i=t[0].translate[0];t[0].translate[1];const o=Math.min(...t.map((t=>t.translate[0])));let n=Math.min(...t.map((t=>t.translate[1])));const s=Math.max(...t.map((t=>t.translate[0]+t.width))),a=Math.max(...t.map((t=>t.translate[1]+t.height)));let r=i<o?i:o;const l=t.reduce(((t,e)=>{const i=e.rotate*Math.PI/180,o=Math.cos(i),n=Math.sin(i);return[{x:e.translate[0],y:e.translate[1]},{x:e.translate[0]+e.width*o,y:e.translate[1]+e.width*n},{x:e.translate[0]-e.height*n,y:e.translate[1]+e.height*o},{x:e.translate[0]+e.width*o-e.height*n,y:e.translate[1]+e.width*n+e.height*o}].forEach((e=>{t.minX=Math.min(t.minX,e.x),t.minY=Math.min(t.minY,e.y),t.maxX=Math.max(t.maxX,e.x),t.maxY=Math.max(t.maxY,e.y)})),t}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});l.minX,l.minY,l.maxX,l.minX,l.maxY,l.minY;const c=t.map((t=>{var e;return null!=(e=null==t?void 0:t.type)?e:""})).join("-");let p=t[0].zindex;t.forEach((t=>{t.zindex=p-1,p=t.zindex}));const d=t.every((t=>"Duct"===t.type));if(d){const e=this.checkIsOverlap(t);t.forEach((t=>{const i=e.find((e=>e.id===t.id));i&&(t.overlap={isStartOverlap:i.isStartOverlap,isEndOverlap:i.isEndOverlap})}))}const u={title:`Weld-${c}`,active:!1,cat:"General",type:d?"Weld_Duct":"Weld_General",translate:[r,n],width:(s-o)*e+8,height:(a-n)*e+8,rotate:0,scaleX:1,scaleY:1,settings:{active:!1,fillColor:"#659dc5",fontSize:16,inAlarm:!1,textColor:"inherit",titleColor:"inherit"},weldItems:h.exports.cloneDeep(t),zindex:1,t3Entry:null,id:uo.value.itemsCount+1};this.addObject(u)}addObject(t,e,i=!0){var o;i&&this.addActionToHistory(`Add ${null!=(o=null==t?void 0:t.type)?o:""}`),uo.value.itemsCount++,t.id=uo.value.itemsCount,t.group=e,t.settings.titleColor||(t.settings.titleColor="inherit"),t.settings.bgColor||(t.settings.bgColor="inherit"),t.settings.textColor||(t.settings.textColor="inherit"),t.settings.fontSize||(t.settings.fontSize=16),uo.value.items.push(t);const n=document.querySelectorAll(".moveable-item");return uo.value.elementGuidelines=[],Array.from(n).forEach((function(t){uo.value.elementGuidelines.push(t)})),t}drawWeldObject(t){const e=1/uo.value.viewportTransform.scale,i=t[0].translate[0];t[0].translate[1];const o=Math.min(...t.map((t=>t.translate[0]))),n=Math.min(...t.map((t=>t.translate[1]))),s=Math.max(...t.map((t=>t.translate[0]+t.width))),a=Math.max(...t.map((t=>t.translate[1]+t.height))),r=i<o?i:o,l=t.map((t=>{var e;return null!=(e=null==t?void 0:t.type)?e:""})).join("-");let c=t[0].zindex;t.forEach((t=>{t.zindex=c-1,c=t.zindex}));const p={title:`Weld-${l}`,active:!1,type:"Weld",translate:[r,n],width:(s-o)*e,height:(a-n)*e,rotate:0,scaleX:1,scaleY:1,settings:{active:!1,fillColor:"#659dc5",fontSize:16,inAlarm:!1,textColor:"inherit",titleColor:"inherit",weldItems:h.exports.cloneDeep(t)},zindex:1,t3Entry:null,id:uo.value.itemsCount+1};this.addObject(p)}deleteSelected(){this.addActionToHistory("Remove selected objects"),uo.value.selectedTargets.length>0&&(uo.value.selectedTargets.forEach((t=>{const e=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.id));-1!==e&&uo.value.items.splice(e,1)})),uo.value.selectedTargets=[],uo.value.activeItemIndex=null)}newProject(){var t;(null==(t=uo.value.items)?void 0:t.length)>0?this.$q.dialog({dark:!0,title:"Do you want to clear the drawing and start over?",message:"This will also erase your undo history",cancel:!0,persistent:!0}).onOk((()=>{Ka.IdxPage.newProject()})).onCancel((()=>{})):Ka.IdxPage.newProject()}insertT3EntryOnSave(){if(this.addActionToHistory("Link object to T3000 entry"),uo.value.items[uo.value.activeItemIndex].settings.t3EntryDisplayField||(void 0===uo.value.items[uo.value.activeItemIndex].label?uo.value.items[uo.value.activeItemIndex].settings.t3EntryDisplayField="description":uo.value.items[uo.value.activeItemIndex].settings.t3EntryDisplayField="label"),uo.value.items[uo.value.activeItemIndex].t3Entry=h.exports.cloneDeep(Ga.value.data),"Icon"===uo.value.items[uo.value.activeItemIndex].type){let t="fa-solid fa-camera-retro";"GRP"===Ga.value.data.type?t="fa-solid fa-camera-retro":"SCHEDULE"===Ga.value.data.type?t="schedule":"PROGRAM"===Ga.value.data.type?t="fa-solid fa-laptop-code":"HOLIDAY"===Ga.value.data.type&&(t="calendar_month"),uo.value.items[uo.value.activeItemIndex].settings.icon=t}Jn.refreshObjectStatus(uo.value.items[uo.value.activeItemIndex]),Ga.value.data=null,Ga.value.active=!1}insertT3EntrySelect(t){this.addActionToHistory("Insert object to T3000 entry");const e={clientX:300,clientY:100,top:100,left:200+80*Bn.value},i=Mo.find((t=>"Pump"===t.name)),o=this.drawObject({width:60,height:60},e,i),n=uo.value.items.findIndex((t=>t.id===o.id));uo.value.activeItemIndex=n,this.insertT3EntryOnSave(),Bn.value++}selectPanelFilterFn(t,e){e(""!==t?()=>{const e=t.toUpperCase();ko.value=vo.value.panelsData.filter((t=>{var i,o;return t.command.toUpperCase().indexOf(e)>-1||(null==(i=t.description)?void 0:i.toUpperCase().indexOf(e))>-1||(null==(o=t.label)?void 0:o.toUpperCase().indexOf(e))>-1}))}:()=>{ko.value=vo.value.panelsData})}rotate90(t,e=!1){t&&(this.addActionToHistory("Rotate object"),t.rotate=e?t.rotate-90:t.rotate+90,Ka.IdxPage.refreshMoveable())}flipH(t){this.addActionToHistory("Flip object H"),1===t.scaleX?t.scaleX=-1:t.scaleX=1,Ka.IdxPage.refreshMoveable()}flipV(t){this.addActionToHistory("Flip object V"),1===t.scaleY?t.scaleY=-1:t.scaleY=1,Ka.IdxPage.refreshMoveable()}bringToFront(t){this.addActionToHistory("Bring object to front"),t.zindex=t.zindex+1}sendToBack(t){this.addActionToHistory("Send object to back"),t.zindex=t.zindex-1}removeObject(t){this.addActionToHistory("Remove object");const e=uo.value.items.findIndex((e=>e.id===t.id));uo.value.activeItemIndex=null,uo.value.items.splice(e,1),uo.value.selectedTargets=[]}duplicateObject(t){this.addActionToHistory(`Duplicate ${t.type}`),uo.value.activeItemIndex=null;const e=this.cloneObject(t);uo.value.selectedTargets=[],setTimeout((()=>{this.selectObject(e)}),10)}cloneObject(t,e){const i=h.exports.cloneDeep(t);i.translate[0]=i.translate[0]+5,i.translate[1]=i.translate[1]+5;return this.addObject(i,e,!1)}selectObject(t){const e=document.querySelector(`#moveable-item-${t.id}`);uo.value.selectedTargets=[e],uo.value.activeItemIndex=uo.value.items.findIndex((e=>e.id===t.id))}addLibItem(t,e,i){const o=[],n=[];uo.value.groupCount++,t.forEach((t=>{n.push(this.cloneObject(t,uo.value.groupCount))})),setTimeout((()=>{n.forEach((t=>{const e=document.querySelector(`#moveable-item-${t.id}`);o.push(e)})),uo.value.selectedTargets=o,Tn.value.setSelectedTargets(o),uo.value.activeItemIndex=null;const t=1/uo.value.viewportTransform.scale;setTimeout((()=>{Go.value.request("draggable",{x:(i.clientX-Co.left-uo.value.viewportTransform.x)*t-e.width*t,y:(i.clientY-Co.top-uo.value.viewportTransform.y)*t-e.height*t},!0),setTimeout((()=>{Ka.IdxPage.refreshMoveable()}),1)}),10)}),10)}onRotateGroupStart(t){this.addActionToHistory("Rotate Group"),t.events.forEach((t=>{const e=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.target.id));t.set(uo.value.items[e].rotate),t.dragStart&&t.dragStart.set(uo.value.items[e].translate)}))}onRotateGroup(t){t.events.forEach(((t,e)=>{const i=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.target.id));uo.value.items[i].translate=t.drag.beforeTranslate,uo.value.items[i].rotate=t.rotate}))}onResizeGroup(t){t.events.forEach(((t,e)=>{t.target.style.width=`${t.width}px`,t.target.style.height=`${t.height}px`,t.target.style.transform=t.drag.transform}))}onResizeGroupEnd(t){t.events.forEach((t=>{const e=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.lastEvent.target.id));uo.value.items[e].width=t.lastEvent.width,uo.value.items[e].height=t.lastEvent.height,uo.value.items[e].translate=t.lastEvent.drag.beforeTranslate})),this.refreshObjects(),Pn.value=!1}onRotate(t){uo.value.items.find((e=>`moveable-item-${e.id}`===t.target.id)).rotate=t.rotate}onResizeEnd(t){if(null===t.lastEvent||void 0===t.lastEvent)return;const e=uo.value.items.findIndex((e=>{var i,o;return`moveable-item-${e.id}`===(null==(o=null==(i=null==t?void 0:t.lastEvent)?void 0:i.target)?void 0:o.id)}));uo.value.items[e].width=t.lastEvent.width,uo.value.items[e].height=t.lastEvent.height,uo.value.items[e].translate=t.lastEvent.drag.beforeTranslate,Ka.PageMain.UpdateExteriorWallStroke(uo,e,t.lastEvent.height),this.refreshObjects()}onResize(t){const e=uo.value.items.find((e=>`moveable-item-${e.id}`===t.target.id));t.target.style.width=`${t.width}px`,t.target.style.height=`${t.height}px`,t.target.style.transform=`translate(${t.drag.beforeTranslate[0]}px, ${t.drag.beforeTranslate[1]}px) rotate(${e.rotate}deg) scaleX(${e.scaleX}) scaleY(${e.scaleY})`}onDrag(t){uo.value.items.find((e=>`moveable-item-${e.id}`===t.target.id)),t.target.style.transform=t.transform}onDragEnd(t){if(t.lastEvent){uo.value.items.find((e=>`moveable-item-${e.id}`===t.target.id)).translate=t.lastEvent.beforeTranslate,this.save(!1,!1),this.refreshObjects()}else Eo.value.shift()}onDragGroupStart(t){this.addActionToHistory("Move Group"),t.events.forEach(((t,e)=>{const i=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.target.id));t.set(uo.value.items[i].translate)}))}onDragGroup(t){t.events.forEach(((t,e)=>{const i=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.target.id));uo.value.items[i].translate=t.beforeTranslate}))}onDragGroupEnd(t){t.lastEvent?this.refreshObjects():Eo.value.shift()}onSelectoDragStart(t){const e=t.inputEvent.target;(Go.value.isMoveableElement(e)||uo.value.selectedTargets.some((t=>t===e||t.contains(e))))&&t.stop()}onSelectoSelectEnd(t){var e;if(uo.value.selectedTargets=t.selected,(null==t?void 0:t.selected)&&!(null==(e=null==t?void 0:t.inputEvent)?void 0:e.ctrlKey)){const e=uo.value.items.filter((e=>t.selected.some((t=>t.id===`moveable-item-${e.id}`))));[...new Set(e.filter((t=>t.group)).map((t=>t.group)))].forEach((t=>{this.selectGroup(t)}))}1===uo.value.selectedTargets.length?uo.value.activeItemIndex=uo.value.items.findIndex((t=>`moveable-item-${t.id}`===uo.value.selectedTargets[0].id)):uo.value.activeItemIndex=null,t.isDragStart&&(t.inputEvent.preventDefault(),setTimeout((()=>{Go.value.dragStart(t.inputEvent)}))),uo.value.selectedTargets.length>1&&!To.value?setTimeout((()=>{mn.value.isShow=!0}),100):mn.value.isShow=!1,Jn.refreshMoveableGuides(),setTimeout((()=>{Ka.PageMain.SetWallDimensionsVisible("select",xn.value,uo,null)}),100)}selectGroup(t){const e=[];uo.value.items.filter((e=>e.group===t&&!uo.value.selectedTargets.some((t=>t.id===`moveable-item-${e.id}`)))).forEach((t=>{const i=document.querySelector(`#moveable-item-${t.id}`);e.push(i)})),uo.value.selectedTargets=uo.value.selectedTargets.concat(e),Tn.value.setSelectedTargets(uo.value.selectedTargets)}onResizeStart(t){this.addActionToHistory("Resize object");const e=uo.value.items.findIndex((e=>`moveable-item-${e.id}`===t.target.id));t.setOrigin(["%","%"]),t.dragStart&&t.dragStart.set(uo.value.items[e].translate)}addActionToHistory(t){"Move Object"!==t&&setTimeout((()=>{this.save(!1,!1),this.refreshObjects()}),200),Fo.value=[],Eo.value.unshift({title:t,state:h.exports.cloneDeep(uo.value)}),Eo.value.length>20&&Eo.value.pop()}viewportMouseMoved(t){Mn.value.x=t.clientX-Co.left,Mn.value.y=t.clientY-Co.top;const e=1/uo.value.viewportTransform.scale;if(xn.value&&vn.includes(On.value.name)&&null!==uo.value.activeItemIndex){const i=t.ctrlKey,o=(t.clientX-Co.left-uo.value.viewportTransform.x)*e,n=(t.clientY-Co.top-uo.value.viewportTransform.y)*e,s=o-Cn.value[0],a=n-Cn.value[1];let r=Math.atan2(a,s)*(180/Math.PI);i&&(r=5*Math.round(r/5));const l=Math.sqrt(s*s+a*a);uo.value.items[uo.value.activeItemIndex].rotate=r,uo.value.items[uo.value.activeItemIndex].width=l,this.refreshObjects()}}refreshObjects(){if(Hn.value)for(const t of Hn.value)t.refresh&&t.refresh()}showMoreDevices(){Ka.DeviceOpt.clearDirtyCurrentDevice(),yo.value.active=!0,uo.value.selectedTarget=[],uo.value.selectedTargets=[],uo.value.activeItemIndex=null,Ka.DeviceOpt.refreshGraphicPanelElementCount(yo.value.data)}updateDeviceModel(t,e){yo.value.active=t,yo.value.data=e}}};Ka.WsClient.setDependencies(Ka.DeviceOpt,Ka.IdxPage,Ka.QuasarUtil),Ka.UI=new class{constructor(){a(this,"evtOpt"),a(this,"userOpt"),this.evtOpt=new fs,this.userOpt=new ma}Initialize(t){var e,i,o,n;ye.quasar=t,$n.quasar=t,ke(ba,Fa),_o.InitStateAndStore(),ye.docUtil=new oa,ye.opt=new da,ye.opt.InitializeProperties(),ye.opt.Initialize(),ye.wallOpt=new ls,window.oncontextmenu=function(t){t.preventDefault()},window.onkeydown=ya.OnKeyDown,window.onkeyup=ya.OnKeyUp,window.onkeypress=ya.OnKeyPress,window.docUtil=ye.docUtil,window.wallOpt=ye.wallOpt,this.evtOpt.BindElemCtlEvent(),Jo.Init(),_o.InitStoredData(),_o.LoadAppStateV2(),Os.RenderAllSVGObjects(),this.userOpt.Initialize(),F.Debug("= o.T3Opt: Initialize/ - After initialize all and the T3Gv.stdObj loaded from storage data:",ye.opt.sdDataBlockId,ye.stdObj),ye.docUtil.LoadRulersSetting(),ye.docUtil.LoadGridSetting();const s=_o.LoadDocSettingData(),a=100*(null!=(i=null==(e=null==s?void 0:s.docInfo)?void 0:e.docScale)?i:1);ye.docUtil.SetZoomLevel(a),ye.docUtil.UpdateRefZoomScale(null!=(n=null==(o=null==s?void 0:s.docInfo)?void 0:o.docScale)?n:1),F.Debug(`= o.T3Opt: Initialize/ - After initialize all and set SetZoomLevel for resizing the work area:${a}`)}ReInitialize(){var t,e,i,o;console.log("T3Gv.state.currentStateId ",ye.state.currentStateId),ke(ba,Fa),_o.InitStateAndStore(),ye.opt.InitializeProperties(),ye.opt.Initialize(!1),_o.SaveToLocalStorage(),ye.wallOpt=new ls,window.oncontextmenu=function(t){t.preventDefault()},window.onkeydown=ya.OnKeyDown,window.onkeyup=ya.OnKeyUp,window.onkeypress=ya.OnKeyPress,window.docUtil=ye.docUtil,window.wallOpt=ye.wallOpt,this.evtOpt.BindElemCtlEvent(),Jo.Init(),_o.InitStoredData(),_o.LoadAppStateV2(),this.userOpt.Initialize(),F.Debug("= o.T3Opt: Initialize/ - After initialize all and the T3Gv.stdObj loaded from storage data:",ye.opt.sdDataBlockId,ye.stdObj),ye.docUtil.LoadRulersSetting(),ye.docUtil.LoadGridSetting();const n=_o.LoadDocSettingData(),s=100*(null!=(e=null==(t=null==n?void 0:n.docInfo)?void 0:t.docScale)?e:1);ye.docUtil.SetZoomLevel(s),ye.docUtil.UpdateRefZoomScale(null!=(o=null==(i=null==n?void 0:n.docInfo)?void 0:i.docScale)?o:1),F.Debug(`= o.T3Opt: Initialize/ - After initialize all and set SetZoomLevel for resizing the work area:${s}`)}},Ka.WebClient=new class{constructor(){a(this,"webview",null==(o=window.chrome)?void 0:o.webview),a(this,"message"),a(this,"messageData"),a(this,"$q"),a(this,"deviceOpt"),a(this,"idxPage"),a(this,"idxUtils"),a(this,"messageHandlers",{[_a.GET_PANEL_DATA_RES]:this.HandleGetPanelDataRes.bind(this),[_a.GET_INITIAL_DATA_RES]:this.HandleGetInitialDataRes.bind(this),[_a.SAVE_GRAPHIC_DATA_RES]:this.HandleSaveGraphicDataRes.bind(this),[_a.UPDATE_ENTRY_RES]:this.HandleUpdateEntryRes.bind(this),[_a.GET_PANELS_LIST_RES]:this.HandleGetPanelsListRes.bind(this),[_a.GET_ENTRIES_RES]:this.HandleGetEntriesRes.bind(this),[_a.LOAD_GRAPHIC_ENTRY_RES]:this.HandleLoadGraphicEntryRes.bind(this),[_a.OPEN_ENTRY_EDIT_WINDOW_RES]:this.HandleOpenEntryEditWindowRes.bind(this),[_a.SAVE_IMAGE_RES]:this.HandleSaveImageRes.bind(this),[_a.SAVE_LIBRARY_DATA_RES]:this.HandleSaveLibraryDataRes.bind(this),[_a.SAVE_NEW_LIBRARY_DATA_RES]:this.HandleSaveNewLibraryDataRes.bind(this),[_a.DELETE_IMAGE_RES]:this.HandleDeleteImageRes.bind(this)}),this.message={}}setDependencies(t,e,i){this.deviceOpt=t,this.idxPage=e,this.idxUtils=i}initMessageHandler(){this.webview&&this.webview.addEventListener("message",this.handleMessage.bind(this))}initQuasar(t){this.$q=t}sendMessage(t){if(!this.webview)return void F.Debug("= Wv2 window.chrome.webview is not available");const e=this.getActionDetails(null==t?void 0:t.action),i=new Date,o=`${i.toLocaleTimeString()}.${i.getMilliseconds().toString().padStart(3,"0")}`;this.webview.postMessage(t),F.Debug(`= Wv2 Sent message to T3 [${o}], action= ${e.name} | ${null==t?void 0:t.action}, message=`,t)}handleMessage(t){var e;const i=null!=(e=null==t?void 0:t.data)?e:{},o=new Date,n=`${o.toLocaleTimeString()}.${o.getMilliseconds().toString().padStart(3,"0")}`,s=this.getActionDetails(null==i?void 0:i.action);F.Debug(`= Wv2 Received message from T3 [${n}], action= ${null==i?void 0:i.action} | ${"UNKNOWN_ACTION"==s.name?-1:s.name}, message=`,i);try{this.processMessageData(i)}catch(a){Uo.Error("= wv2: handleMessage failed to parse | process data:",a)}}FormatMessageData(t,e,i,o){this.setMessageData(t,e,i,o),this.messageData=this.message}FormatUpdateEntryData(t){this.message={},this.message.action=_a.UPDATE_ENTRY,this.message.field=t.field,this.message.value=t.value,this.message.panelId=t.panelId,this.message.entryIndex=t.entryIndex,this.message.entryType=t.entryType,this.message.viewitem=t.entryIndex,this.messageData=this.message}FormatSaveImageData(t){this.message={},this.message.action=_a.SAVE_IMAGE,this.message.filename=t.filename,this.message.fileLength=t.fileLength,this.message.fileData=t.fileData,this.message.viewitem=t.entryIndex,this.messageData=this.message}FormatLoadGraphicEntryData(t){this.message={},this.message.action=_a.LOAD_GRAPHIC_ENTRY,this.message.panelId=t.panelId,this.message.entryIndex=t.entryIndex,this.message.viewitem=t.entryIndex,this.messageData=this.message}FormatOpenEntryEditWindowData(t){this.message={},this.message.action=_a.OPEN_ENTRY_EDIT_WINDOW,this.message.panelId=t.panelId,this.message.entryType=t.entryType,this.message.entryIndex=t.entryIndex,this.messageData=this.message}setMessageData(t,e,i,o){var n,s,a;this.message={};let r=null;if(this.deviceOpt&&"function"==typeof this.deviceOpt.getSerialNumber)try{r=this.deviceOpt.getSerialNumber(e)}catch(l){}if(!r){const t=new URLSearchParams(window.location.search).get("sn");t&&(r=parseInt(t,10),isNaN(r)&&(r=t))}if(!r&&e&&void 0!==vo&&(null==(n=vo.value)?void 0:n.panelsList)){const t=vo.value.panelsList.find((t=>t.panel_number===e));t&&t.serial_number&&(r=t.serial_number)}null!=t&&(this.message.action=t),null!=e&&(this.message.panelId=e),null!=i&&(this.message.viewitem=i-1,this.message.viewitem<0&&(this.message.viewitem=-1)),null!=o&&void 0!==o&&(this.message.data=o),this.message.msgId=Oe.GenerateUUID();null!=e&&null!=r?(this.message.serialNumber=r,F.Debug("= Wv2 SetMessageData - Serial number resolved:",{panelId:e,serialNumber:r,method:this.deviceOpt?"deviceOpt":new URLSearchParams(window.location.search).get("sn")?"URL_param":"panels_list",action:t})):null!=e&&F.Warn("= Wv2 SetMessageData - No serial number found for panelId:",e,{hasDeviceOpt:!!this.deviceOpt,urlSn:new URLSearchParams(window.location.search).get("sn"),panelsListLength:void 0!==vo?(null==(a=null==(s=vo.value)?void 0:s.panelsList)?void 0:a.length)||0:"N/A"})}GetInitialData(t,e,i){this.FormatMessageData(_a.GET_INITIAL_DATA,t,e,i),this.sendMessage(this.messageData)}GetPanelsList(t,e,i){this.FormatMessageData(_a.GET_PANELS_LIST,t,e,i),this.sendMessage(this.messageData)}GetPanelData(t,e,i){this.FormatMessageData(_a.GET_PANEL_DATA,t,e,i),this.sendMessage(this.messageData)}GetEntries(t,e,i){this.FormatMessageData(_a.GET_ENTRIES,t,e,i),this.sendMessage(this.messageData)}SaveLibraryData(t,e,i){this.FormatMessageData(_a.SAVE_LIBRARY_DATA,t,e,i),this.sendMessage(this.messageData)}SaveNewLibraryData(t,e,i){this.FormatMessageData(_a.SAVE_NEW_LIBRARY_DATA,t,e,i),this.sendMessage(this.messageData)}SaveGraphicData(t,e,i){this.FormatMessageData(_a.SAVE_GRAPHIC_DATA,t,e,i),this.sendMessage(this.messageData)}UpdateEntry(t){this.FormatUpdateEntryData(t),this.sendMessage(this.messageData)}SaveImage(t){this.FormatSaveImageData(t),this.sendMessage(this.messageData)}LoadGraphicEntry(t){this.FormatLoadGraphicEntryData(t),this.sendMessage(this.messageData)}OpenEntryEditWindow(t){this.FormatOpenEntryEditWindowData(t),this.sendMessage(this.messageData)}DeleteImage(t){this.FormatMessageData(_a.DELETE_IMAGE,null,null,t),this.sendMessage(this.messageData)}processMessageData(t){const e=this.messageHandlers[t.action];e?e(t):F.Warn("No handler for message action:",t.action,t)}HandleGetPanelDataRes(t){if((null==t?void 0:t.panel_id)&&this.idxPage.clearGetPanelsInterval(),null==t?void 0:t.panel_id){if(null!==vo.value.loadingPanel&&vo.value.loadingPanel<vo.value.panelsList.length-1){vo.value.loadingPanel++;const t=vo.value.loadingPanel;this.GetPanelData(vo.value.panelsList[t].panel_number)}null!==vo.value.loadingPanel&&vo.value.loadingPanel===vo.value.panelsList.length-1&&(vo.value.loadingPanel=null),vo.value.panelsData=vo.value.panelsData.filter((e=>e.pid!==t.panel_id)),vo.value.panelsData=vo.value.panelsData.concat(t.data),vo.value.panelsData.sort(((t,e)=>t.pid-e.pid)),ko.value=vo.value.panelsData,vo.value.panelsRanges=vo.value.panelsRanges.filter((e=>e.pid!==t.panel_id)),vo.value.panelsRanges=vo.value.panelsRanges.concat(t.ranges),this.idxUtils.refreshLinkedEntries(t.data),this.idxUtils.refreshLinkedEntries2(t.data)}}HandleGetInitialDataRes(t){t.data=JSON.parse(t.data),po.value=t.data,So.value=po.value.rulersGridVisible,void 0!==po.value.locked&&(To.value=po.value.locked),wo.value=[t.entry],t.library&&(t.library=JSON.parse(t.library),Do.value=t.library),setTimeout((()=>{this.idxUtils.refreshMoveableGuides()}),100)}HandleSaveGraphicDataRes(t){this.idxUtils.saveGraphicData(t,this.$q)}HandleUpdateEntryRes(t){}HandleGetPanelsListRes(t){var e;(null==(e=t.data)?void 0:e.length)&&(vo.value.panelsList=t.data,vo.value.loadingPanel=0,this.GetPanelData(vo.value.panelsList[0].panel_number))}HandleGetEntriesRes(t){F.Debug("= Wv2 Received message from T3 [HandleGetEntriesRes], msgData=",t),t.data&&t.data.length,t.data.forEach(((t,e)=>{const i=vo.value.panelsData.findIndex((e=>e.index===t.index&&e.type===t.type&&e.pid===t.pid));if(-1!==i){const e=vo.value.panelsData[i],o="MON"===e.type&&(Array.isArray(e.input)||Array.isArray(e.range)||e.num_inputs>0),n="MON"===t.type&&!Array.isArray(t.input)&&!Array.isArray(t.range)&&!t.num_inputs,s=this.hasComplexDataStructures(e),a=!this.hasComplexDataStructures(t),r=s&&a;if(o&&n){const i=["input","range","num_inputs","an_inputs"],o=Object.keys(e),n=Object.keys(t);o.filter((t=>n.includes(t))).filter((t=>!i.includes(t))).forEach((i=>{e[i]!==t[i]&&(e[i]=t[i])}))}else if(r){const i=this.getComplexFields(e),o=Object.keys(e),n=Object.keys(t);o.filter((t=>n.includes(t))).filter((t=>!i.includes(t))).forEach((i=>{e[i]!==t[i]&&(e[i]=t[i])}))}else vo.value.panelsData[i]=t}})),Lo.value.active||(ko.value=vo.value.panelsData),this.idxUtils.refreshLinkedEntries(t.data),this.idxUtils.refreshLinkedEntries2(t.data)}HandleLoadGraphicEntryRes(t){var e,i;if(t.data=JSON.parse(t.data),po.value=t.data,wo.value.length>1){const e=wo.value[wo.value.length-2];e.index!==t.entry.index||e.pid!==t.entry.pid?wo.value.push(t.entry):wo.value.pop()}else wo.value.push(t.entry);setTimeout((()=>{this.idxUtils.refreshMoveableGuides()}),100);const o=null==(e=this.deviceOpt)?void 0:e.getCurrentDevice();o&&(null==(i=this.deviceOpt)||i.refreshGraphicPanelElementCount(o))}HandleOpenEntryEditWindowRes(t){}HandleSaveImageRes(t){Do.value.imagesCount++,Do.value.images.push({id:"IMG-"+Do.value.imagesCount,name:t.data.name,path:t.data.path,online:!1}),this.idxUtils.saveLib()}HandleSaveLibraryDataRes(t){}HandleSaveNewLibraryDataRes(t){F.Debug("= Wv2 Handle SAVE_NEW_LIBRARY_DATA_RES:",t)}HandleDeleteImageRes(t){}HandleGetAllDevicesDataRes(t){}hasComplexDataStructures(t){if(!t||"object"!=typeof t)return!1;const e=Object.values(t).some((t=>Array.isArray(t))),i=Object.values(t).some((t=>t&&"object"==typeof t&&!Array.isArray(t)&&Object.keys(t).length>0)),o=({MON:["input","range","num_inputs","an_inputs"],GRP:["items","controls","children"],SCH:["schedule","items","events"]}[t.type]||[]).some((e=>void 0!==t[e]));return e||i||o}getDataComplexityInfo(t){if(!t||"object"!=typeof t)return{simple:!0};const e=Object.keys(t).filter((e=>Array.isArray(t[e]))),i=Object.keys(t).filter((e=>t[e]&&"object"==typeof t[e]&&!Array.isArray(t[e])));return{totalFields:Object.keys(t).length,arrays:e.length,arrayFields:e,objects:i.length,objectFields:i,hasComplexity:this.hasComplexDataStructures(t)}}getComplexFields(t){if(!t||"object"!=typeof t)return[];const e=[];Object.keys(t).forEach((i=>{Array.isArray(t[i])&&e.push(i)})),Object.keys(t).forEach((i=>{t[i]&&"object"==typeof t[i]&&!Array.isArray(t[i])&&Object.keys(t[i]).length>0&&e.push(i)}));return({MON:["input","range","num_inputs","an_inputs"],GRP:["items","controls","children"],SCH:["schedule","items","events"],PID:["parameters","settings","config"]}[t.type]||[]).forEach((i=>{void 0===t[i]||e.includes(i)||e.push(i)})),e}getActionDetails(t){return{0:{name:"GET_PANEL_DATA",description:"Request panel data from T3000 backend",category:"Data_Request",implemented:!0,responseAction:"GET_PANEL_DATA_RES"},1:{name:"GET_INITIAL_DATA",description:"Request initial application data and state",category:"Initialization",implemented:!0,responseAction:"GET_INITIAL_DATA_RES"},2:{name:"SAVE_GRAPHIC_DATA",description:"Save graphic/layout data to T3000",category:"Data_Save",implemented:!0,responseAction:"SAVE_GRAPHIC_DATA_RES"},3:{name:"UPDATE_ENTRY",description:"Update a specific entry/field value",category:"Data_Update",implemented:!0,responseAction:"UPDATE_ENTRY_RES"},4:{name:"GET_PANELS_LIST",description:"Request list of available panels",category:"Data_Request",implemented:!0,responseAction:"GET_PANELS_LIST_RES"},5:{name:"GET_PANEL_RANGE_INFO",description:"Request panel range information",category:"Data_Request",implemented:!1,responseAction:"GET_PANEL_RANGE_INFO_RES"},6:{name:"GET_ENTRIES",description:"Request specific entries data",category:"Data_Request",implemented:!0,responseAction:"GET_ENTRIES_RES"},7:{name:"LOAD_GRAPHIC_ENTRY",description:"Load graphic entry for editing",category:"UI_Navigation",implemented:!0,responseAction:"LOAD_GRAPHIC_ENTRY_RES"},8:{name:"OPEN_ENTRY_EDIT_WINDOW",description:"Open entry edit window in T3000",category:"UI_Action",implemented:!0,responseAction:"OPEN_ENTRY_EDIT_WINDOW_RES"},9:{name:"SAVE_IMAGE",description:"Save image file to T3000 library",category:"File_Operation",implemented:!0,responseAction:"SAVE_IMAGE_RES"},10:{name:"SAVE_LIBRARY_DATA",description:"Save library data to T3000",category:"Data_Save",implemented:!0,responseAction:"SAVE_LIBRARY_DATA_RES"},11:{name:"DELETE_IMAGE",description:"Delete image from T3000 library",category:"File_Operation",implemented:!0,responseAction:"DELETE_IMAGE_RES"},12:{name:"GET_SELECTED_DEVICE_INFO",description:"Get information about selected device",category:"Device_Info",implemented:!0,responseAction:"GET_SELECTED_DEVICE_INFO_RES"},13:{name:"BIND_DEVICE",description:"Bind/connect to a device",category:"Device_Operation",implemented:!1,responseAction:"BIND_DEVICE_RES"},14:{name:"SAVE_NEW_LIBRARY_DATA",description:"Save new library data to T3000",category:"Data_Save",implemented:!1,responseAction:"SAVE_NEW_LIBRARY_DATA_RES"}}[t]||{name:"UNKNOWN_ACTION",description:`Unknown action code: ${t}`,category:"Unknown",implemented:!1,responseAction:"UNKNOWN_RES"}}},Ka.IdxUtils.setDependencies(Ka.WebClient,Ka.DeviceOpt,Ka.WsClient),Ka.WebClient.setDependencies(Ka.DeviceOpt,Ka.IdxPage,Ka.IdxUtils);function Ya(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+t+(i.length?" "+i.map((function(t){return"'"+t+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Xa(t){return!!t&&!!t[Fr]}function qa(t){var e;return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var i=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return i===Object||"function"==typeof i&&Function.toString.call(i)===Gr}(t)||Array.isArray(t)||!!t[Er]||!!(null===(e=t.constructor)||void 0===e?void 0:e[Er])||tr(t)||er(t))}function Ja(t,e,i){void 0===i&&(i=!1),0===$a(t)?(i?Object.keys:Rr)(t).forEach((function(o){i&&"symbol"==typeof o||e(o,t[o],t)})):t.forEach((function(i,o){return e(o,i,t)}))}function $a(t){var e=t[Fr];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:tr(t)?2:er(t)?3:0}function Za(t,e){return 2===$a(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Qa(t,e,i){var o=$a(t);2===o?t.set(e,i):3===o?t.add(i):t[e]=i}function tr(t){return kr&&t instanceof Map}function er(t){return Lr&&t instanceof Set}function ir(t){return t.o||t.t}function or(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=jr(t);delete e[Fr];for(var i=Rr(e),o=0;o<i.length;o++){var n=i[o],s=e[n];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[n]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[n]})}return Object.create(Object.getPrototypeOf(t),e)}function nr(t,e){return void 0===e&&(e=!1),ar(t)||Xa(t)||!qa(t)||($a(t)>1&&(t.set=t.add=t.clear=t.delete=sr),Object.freeze(t),e&&Ja(t,(function(t,e){return nr(e,!0)}),!0)),t}function sr(){Ya(2)}function ar(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function rr(t){var e=Br[t];return e||Ya(18,t),e}function lr(){return vr}function hr(t,e){e&&(rr("Patches"),t.u=[],t.s=[],t.v=e)}function cr(t){pr(t),t.p.forEach(ur),t.p=null}function pr(t){t===vr&&(vr=t.l)}function dr(t){return vr={p:[],l:vr,h:t,m:!0,_:0}}function ur(t){var e=t[Fr];0===e.i||1===e.i?e.j():e.g=!0}function gr(t,e){e._=e.p.length;var i=e.p[0],o=void 0!==t&&t!==i;return e.h.O||rr("ES5").S(e,t,o),o?(i[Fr].P&&(cr(e),Ya(4)),qa(t)&&(t=yr(e,t),e.l||mr(e,t)),e.u&&rr("Patches").M(i[Fr].t,t,e.u,e.s)):t=yr(e,i,[]),cr(e),e.u&&e.v(e.u,e.s),t!==Ir?t:void 0}function yr(t,e,i){if(ar(e))return e;var o=e[Fr];if(!o)return Ja(e,(function(n,s){return Sr(t,o,e,n,s,i)}),!0),e;if(o.A!==t)return e;if(!o.P)return mr(t,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var n=4===o.i||5===o.i?o.o=or(o.k):o.o,s=n,a=!1;3===o.i&&(s=new Set(n),n.clear(),a=!0),Ja(s,(function(e,s){return Sr(t,o,n,e,s,i,a)})),mr(t,n,!1),i&&t.u&&rr("Patches").N(o,i,t.u,t.s)}return o.o}function Sr(t,e,i,o,n,s,a){if(Xa(n)){var r=yr(t,n,s&&e&&3!==e.i&&!Za(e.R,o)?s.concat(o):void 0);if(Qa(i,o,r),!Xa(r))return;t.m=!1}else a&&i.add(n);if(qa(n)&&!ar(n)){if(!t.h.D&&t._<1)return;yr(t,n),e&&e.A.l||mr(t,n)}}function mr(t,e,i){void 0===i&&(i=!1),!t.l&&t.h.D&&t.m&&nr(e,i)}function br(t,e){var i=t[Fr];return(i?ir(i):t)[e]}function Dr(t,e){if(e in t)for(var i=Object.getPrototypeOf(t);i;){var o=Object.getOwnPropertyDescriptor(i,e);if(o)return o;i=Object.getPrototypeOf(i)}}function fr(t){t.P||(t.P=!0,t.l&&fr(t.l))}function xr(t){t.o||(t.o=or(t.t))}function Cr(t,e,i){var o=tr(e)?rr("MapSet").F(e,i):er(e)?rr("MapSet").T(e,i):t.O?function(t,e){var i=Array.isArray(t),o={i:i?1:0,A:e?e.A:lr(),P:!1,I:!1,R:{},l:e,t:t,k:null,o:null,j:null,C:!1},n=o,s=Mr;i&&(n=[o],s=Hr);var a=Proxy.revocable(n,s),r=a.revoke,l=a.proxy;return o.k=l,o.j=r,l}(e,i):rr("ES5").J(e,i);return(i?i.A:lr()).p.push(o),o}function Pr(t){return Xa(t)||Ya(22,t),function t(e){if(!qa(e))return e;var i,o=e[Fr],n=$a(e);if(o){if(!o.P&&(o.i<4||!rr("ES5").K(o)))return o.t;o.I=!0,i=Tr(e,n),o.I=!1}else i=Tr(e,n);return Ja(i,(function(e,n){o&&function(t,e){return 2===$a(t)?t.get(e):t[e]}(o.t,e)===n||Qa(i,e,t(n))})),3===n?new Set(i):i}(t)}function Tr(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return or(t)}new class{constructor(t=""){a(this,"api"),a(this,"baseUrl"),this.baseUrl=t,this.api=Vt.create({prefixUrl:t,headers:{"Content-Type":"application/json",auth:""},hooks:{beforeRequest:[t=>{}],afterResponse:[(t,e,i)=>{i.status}]}})}async getTableRecords(t,e){var i,o,n;const s=new URLSearchParams;(null==e?void 0:e.page)&&s.set("page",e.page.toString()),(null==e?void 0:e.per_page)&&s.set("per_page",e.per_page.toString()),(null==e?void 0:e.search)&&s.set("search",e.search);const a=`api/t3_device/${t}${s.toString()?"?"+s.toString():""}`,r=await this.api.get(a).json();return{data:r.data||[],total:r.total||r.count||(null==(i=r.data)?void 0:i.length)||0,message:r.message||`Retrieved ${r.total||r.count||(null==(o=r.data)?void 0:o.length)||0} records from ${t}`,count:r.total||r.count||(null==(n=r.data)?void 0:n.length)||0}}async getTableCount(t){return await this.api.get(`api/t3_device/${t}/count`).json()}async createRecord(t,e){return await this.api.post(`api/t3_device/${t}`,{json:e}).json()}async updateRecord(t,e,i){return await this.api.put(`api/t3_device/${t}/${e}`,{json:i}).json()}async deleteRecord(t,e){return await this.api.delete(`api/t3_device/${t}/${e}`).json()}async getBuildings(t){return this.getTableRecords("buildings",t)}async getBuildingsCount(){return this.getTableCount("buildings")}async getDevices(t){return this.getTableRecords("devices",t)}async getDevicesCount(){return this.getTableCount("devices")}async getInputPoints(t){return this.getTableRecords("input_points",t)}async getInputPointsCount(){return this.getTableCount("input_points")}async getOutputPoints(t){return this.getTableRecords("output_points",t)}async getOutputPointsCount(){return this.getTableCount("output_points")}async getVariables(t){return this.getTableRecords("variables",t)}async getVariablesCount(){return this.getTableCount("variables")}async getPrograms(t){return this.getTableRecords("programs",t)}async getProgramsCount(){return this.getTableCount("programs")}async getSchedules(t){return this.getTableRecords("schedules",t)}async getSchedulesCount(){return this.getTableCount("schedules")}async getHolidays(t){return this.getTableRecords("holidays",t)}async getHolidaysCount(){return this.getTableCount("holidays")}async getTrendlogs(t){return this.getTableRecords("trendlogs",t)}async getTrendlogsCount(){return this.getTableCount("trendlogs")}}("http://localhost:9103");var Or,vr,wr="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),kr="undefined"!=typeof Map,Lr="undefined"!=typeof Set,Ar="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Ir=wr?Symbol.for("immer-nothing"):((Or={})["immer-nothing"]=!0,Or),Er=wr?Symbol.for("immer-draftable"):"__$immer_draftable",Fr=wr?Symbol.for("immer-state"):"__$immer_state",Gr=""+Object.prototype.constructor,Rr="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,jr=Object.getOwnPropertyDescriptors||function(t){var e={};return Rr(t).forEach((function(i){e[i]=Object.getOwnPropertyDescriptor(t,i)})),e},Br={},Mr={get:function(t,e){if(e===Fr)return t;var i,o,n,s=ir(t);if(!Za(s,e))return i=t,(n=Dr(s,e))?"value"in n?n.value:null===(o=n.get)||void 0===o?void 0:o.call(i.k):void 0;var a=s[e];return t.I||!qa(a)?a:a===br(t.t,e)?(xr(t),t.o[e]=Cr(t.A.h,a,t)):a},has:function(t,e){return e in ir(t)},ownKeys:function(t){return Reflect.ownKeys(ir(t))},set:function(t,e,i){var o=Dr(ir(t),e);if(null==o?void 0:o.set)return o.set.call(t.k,i),!0;if(!t.P){var n=br(ir(t),e),s=null==n?void 0:n[Fr];if(s&&s.t===i)return t.o[e]=i,t.R[e]=!1,!0;if(function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}(i,n)&&(void 0!==i||Za(t.t,e)))return!0;xr(t),fr(t)}return t.o[e]===i&&(void 0!==i||e in t.o)||Number.isNaN(i)&&Number.isNaN(t.o[e])||(t.o[e]=i,t.R[e]=!0),!0},deleteProperty:function(t,e){return void 0!==br(t.t,e)||e in t.t?(t.R[e]=!1,xr(t),fr(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var i=ir(t),o=Reflect.getOwnPropertyDescriptor(i,e);return o?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:o.enumerable,value:i[e]}:o},defineProperty:function(){Ya(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){Ya(12)}},Hr={};Ja(Mr,(function(t,e){Hr[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),Hr.deleteProperty=function(t,e){return Hr.set.call(this,t,e,void 0)},Hr.set=function(t,e,i){return Mr.set.call(this,t[0],e,i,t[0])};var _r=new(function(){function t(t){var e=this;this.O=Ar,this.D=!0,this.produce=function(t,i,o){if("function"==typeof t&&"function"!=typeof i){var n=i;i=t;var s=e;return function(t){var e=this;void 0===t&&(t=n);for(var o=arguments.length,a=Array(o>1?o-1:0),r=1;r<o;r++)a[r-1]=arguments[r];return s.produce(t,(function(t){var o;return(o=i).call.apply(o,[e,t].concat(a))}))}}var a;if("function"!=typeof i&&Ya(6),void 0!==o&&"function"!=typeof o&&Ya(7),qa(t)){var r=dr(e),l=Cr(e,t,void 0),h=!0;try{a=i(l),h=!1}finally{h?cr(r):pr(r)}return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(t){return hr(r,o),gr(t,r)}),(function(t){throw cr(r),t})):(hr(r,o),gr(a,r))}if(!t||"object"!=typeof t){if(void 0===(a=i(t))&&(a=t),a===Ir&&(a=void 0),e.D&&nr(a,!0),o){var c=[],p=[];rr("Patches").M(t,a,c,p),o(c,p)}return a}Ya(21,t)},this.produceWithPatches=function(t,i){if("function"==typeof t)return function(i){for(var o=arguments.length,n=Array(o>1?o-1:0),s=1;s<o;s++)n[s-1]=arguments[s];return e.produceWithPatches(i,(function(e){return t.apply(void 0,[e].concat(n))}))};var o,n,s=e.produce(t,i,(function(t,e){o=t,n=e}));return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(t){return[t,o,n]})):[s,o,n]},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){qa(t)||Ya(8),Xa(t)&&(t=Pr(t));var e=dr(this),i=Cr(this,t,void 0);return i[Fr].C=!0,pr(e),i},e.finishDraft=function(t,e){var i=(t&&t[Fr]).A;return hr(i,e),gr(void 0,i)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!Ar&&Ya(20),this.O=t},e.applyPatches=function(t,e){var i;for(i=e.length-1;i>=0;i--){var o=e[i];if(0===o.path.length&&"replace"===o.op){t=o.value;break}}i>-1&&(e=e.slice(i+1));var n=rr("Patches").$;return Xa(t)?n(t,e):this.produce(t,(function(t){return n(t,e)}))},t}()),Ur=_r.produce;_r.produceWithPatches.bind(_r),_r.setAutoFreeze.bind(_r),_r.setUseProxies.bind(_r),_r.applyPatches.bind(_r),_r.createDraft.bind(_r),_r.finishDraft.bind(_r);const Nr=t=>(e,i,o)=>(o.setState=(t,i,...o)=>{const n="function"==typeof t?Ur(t):t;return e(n,i,...o)},t(o.setState,i,o)),Vr={viewport:{width:3e3,height:2e3,zoom:1,pan:{x:0,y:0},gridSize:20,snapToGrid:!0,showRulers:!0,showGrid:!0,backgroundColor:"#ffffff"},shapes:[],selectedShapeIds:[],clipboard:[],history:{past:[],future:[]},activeTool:"select",toolOptions:{strokeColor:"#000000",fillColor:"#cccccc",strokeWidth:2,opacity:1},isDrawing:!1,layers:[{id:"layer-1",name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0}],activeLayerId:"layer-1",symbolLibrary:[],drawingName:"Untitled Drawing",isDirty:!1},zr=G()(R(Nr(((t,e)=>({...Vr,setZoom:e=>t((t=>{t.viewport.zoom=Math.max(.1,Math.min(5,e))})),setPan:(e,i)=>t((t=>{t.viewport.pan={x:e,y:i}})),setGridSize:e=>t((t=>{t.viewport.gridSize=e})),toggleGrid:()=>t((t=>{t.viewport.showGrid=!t.viewport.showGrid})),toggleRulers:()=>t((t=>{t.viewport.showRulers=!t.viewport.showRulers})),toggleSnapToGrid:()=>t((t=>{t.viewport.snapToGrid=!t.viewport.snapToGrid})),resetView:()=>t((t=>{t.viewport.zoom=1,t.viewport.pan={x:0,y:0}})),addShape:i=>t((t=>{t.shapes.push(i),t.isDirty=!0,t.history.past.push([...e().shapes]),t.history.future=[]})),updateShape:(e,i)=>t((t=>{const o=t.shapes.find((t=>t.id===e));o&&(Object.assign(o,i),t.isDirty=!0)})),deleteShape:e=>t((t=>{t.history.past.push([...t.shapes]),t.shapes=t.shapes.filter((t=>t.id!==e)),t.selectedShapeIds=t.selectedShapeIds.filter((t=>t!==e)),t.isDirty=!0,t.history.future=[]})),deleteShapes:e=>t((t=>{t.history.past.push([...t.shapes]),t.shapes=t.shapes.filter((t=>!e.includes(t.id))),t.selectedShapeIds=t.selectedShapeIds.filter((t=>!e.includes(t))),t.isDirty=!0,t.history.future=[]})),duplicateShapes:e=>t((t=>{const i=t.shapes.filter((t=>e.includes(t.id))).map((t=>({...t,id:`${t.type}-${Date.now()}-${Math.random()}`,transform:{...t.transform,x:t.transform.x+20,y:t.transform.y+20}})));t.shapes.push(...i),t.isDirty=!0})),groupShapes:e=>t((t=>{t.isDirty=!0})),ungroupShape:e=>t((t=>{t.isDirty=!0})),selectShape:(e,i=!1)=>t((t=>{i?t.selectedShapeIds.includes(e)||t.selectedShapeIds.push(e):t.selectedShapeIds=[e]})),selectShapes:e=>t((t=>{t.selectedShapeIds=e})),clearSelection:()=>t((t=>{t.selectedShapeIds=[]})),selectAll:()=>t((t=>{t.selectedShapeIds=t.shapes.map((t=>t.id))})),copyToClipboard:()=>t((t=>{const e=t.shapes.filter((e=>t.selectedShapeIds.includes(e.id)));t.clipboard=e})),cutToClipboard:()=>t((t=>{const e=t.shapes.filter((e=>t.selectedShapeIds.includes(e.id)));t.clipboard=e,t.shapes=t.shapes.filter((e=>!t.selectedShapeIds.includes(e.id))),t.selectedShapeIds=[],t.isDirty=!0})),pasteFromClipboard:()=>t((t=>{const e=t.clipboard.map((t=>({...t,id:`${t.type}-${Date.now()}-${Math.random()}`,transform:{...t.transform,x:t.transform.x+20,y:t.transform.y+20}})));t.shapes.push(...e),t.selectedShapeIds=e.map((t=>t.id)),t.isDirty=!0})),undo:()=>t((t=>{if(t.history.past.length>0){const e=t.history.past.pop();t.history.future.unshift([...t.shapes]),t.shapes=e,t.isDirty=!0}})),redo:()=>t((t=>{if(t.history.future.length>0){const e=t.history.future.shift();t.history.past.push([...t.shapes]),t.shapes=e,t.isDirty=!0}})),saveHistory:()=>t((t=>{t.history.past.push([...t.shapes]),t.history.future=[]})),clearHistory:()=>t((t=>{t.history.past=[],t.history.future=[]})),setActiveTool:e=>t((t=>{t.activeTool=e,t.isDrawing=!1})),setToolOptions:e=>t((t=>{t.toolOptions={...t.toolOptions,...e}})),setIsDrawing:e=>t((t=>{t.isDrawing=e})),addLayer:e=>t((t=>{t.layers.push(e),t.isDirty=!0})),updateLayer:(e,i)=>t((t=>{const o=t.layers.find((t=>t.id===e));o&&(Object.assign(o,i),t.isDirty=!0)})),deleteLayer:e=>t((t=>{var i;t.layers=t.layers.filter((t=>t.id!==e)),t.activeLayerId===e&&(t.activeLayerId=(null==(i=t.layers[0])?void 0:i.id)||""),t.isDirty=!0})),setActiveLayer:e=>t((t=>{t.activeLayerId=e})),reorderLayers:e=>t((t=>{t.layers=e.map((e=>t.layers.find((t=>t.id===e)))).filter(Boolean),t.isDirty=!0})),addSymbol:e=>t((t=>{t.symbolLibrary.push(e)})),deleteSymbol:e=>t((t=>{t.symbolLibrary=t.symbolLibrary.filter((t=>t.id!==e))})),loadDrawing:(e,i,o)=>t((t=>{var n;t.drawingId=e,t.shapes=i,t.layers=o.length>0?o:Vr.layers,t.activeLayerId=(null==(n=o[0])?void 0:n.id)||"layer-1",t.selectedShapeIds=[],t.history={past:[],future:[]},t.isDirty=!1})),clearDrawing:()=>t((t=>{t.shapes=[],t.selectedShapeIds=[],t.layers=Vr.layers,t.activeLayerId="layer-1",t.history={past:[],future:[]},t.drawingName="Untitled Drawing",t.isDirty=!1})),setDrawingName:e=>t((t=>{t.drawingName=e,t.isDirty=!0})),markDirty:()=>t((t=>{t.isDirty=!0})),markClean:()=>t((t=>{t.isDirty=!1,t.lastSaved=(new Date).toISOString()}))}))),{name:"hvac-designer-store"}));async function Wr(t,e){const{format:i,quality:o,scale:n,includeBackground:s,selectedOnly:a}=e;switch(i){case"json":return function(t,e){const i=e?{...t,shapes:t.shapes.filter((t=>t.visible))}:t;return JSON.stringify(i,null,2)}(t,a);case"svg":return function(t,e,i){let o=`<svg xmlns="http://www.w3.org/2000/svg" width="${t.width}" height="${t.height}" viewBox="0 0 ${t.width} ${t.height}">`;e&&(o+=`<rect width="${t.width}" height="${t.height}" fill="${t.backgroundColor}" />`);return o+="</svg>",o}(t,s);case"png":return async function(t,e,i,o,n){const s=document.createElement("canvas"),a=s.getContext("2d");if(!a)throw new Error("Failed to get canvas context");const r=i||1;s.width=t.width*r,s.height=t.height*r,o&&(a.fillStyle=t.backgroundColor,a.fillRect(0,0,s.width,s.height));return new Promise(((t,i)=>{s.toBlob((e=>{e?t(e):i(new Error("Failed to create blob"))}),"image/png",e||.92)}))}(t,o,n,s);case"pdf":return async function(t,e,i,o){throw new Error("PDF export not yet implemented")}();default:throw new Error(`Unsupported export format: ${i}`)}}async function Kr(t,e){const{format:i,replaceExisting:o,targetLayer:n}=e;switch(i){case"json":return async function(t,e,i){const o=await t.text(),n=JSON.parse(o),s=n.shapes||[],a=n.layers||[];i&&s.forEach((t=>{t.layer=i}));return{shapes:s,layers:e?a:[]}}(t,o,n);case"svg":return async function(t,e){throw new Error("SVG import not yet implemented")}();case"dxf":return async function(t,e){throw new Error("DXF import not yet implemented")}();default:throw new Error(`Unsupported import format: ${i}`)}}function Yr(){const[t,e]=l.exports.useState(!1),[i,o]=l.exports.useState(!1),[n,s]=l.exports.useState(null),a=zr(),r=l.exports.useCallback((async()=>{e(!0),s(null);try{const t={id:a.drawingId||"",name:a.drawingName,description:"",width:a.viewport.width,height:a.viewport.height,backgroundColor:a.viewport.backgroundColor,shapes:a.shapes,layers:a.layers,symbols:a.symbolLibrary,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),version:1,gridSize:a.viewport.gridSize,snapToGrid:a.viewport.snapToGrid,showRulers:a.viewport.showRulers,showGrid:a.viewport.showGrid};if(a.drawingId)await async function(t,e){try{const i=await fetch(`/api/drawings/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error(`Failed to update drawing: ${i.statusText}`);return{success:!0}}catch(n){throw console.error("Error updating drawing:",n),n}}(a.drawingId,t);else{const e=await async function(t){try{const e=await fetch("/api/drawings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Failed to save drawing: ${e.statusText}`);return{success:!0,id:(await e.json()).id}}catch(n){throw console.error("Error saving drawing:",n),n}}(t);a.loadDrawing(e.id,a.shapes,a.layers)}a.markClean()}catch(t){const e=t instanceof Error?t.message:"Failed to save drawing";throw s(e),t}finally{e(!1)}}),[a]),h=l.exports.useCallback((async t=>{o(!0),s(null);try{const e=await async function(t){try{const e=await fetch(`/api/drawings/${t}`);if(!e.ok)throw new Error(`Failed to load drawing: ${e.statusText}`);return await e.json()}catch(n){throw console.error("Error loading drawing:",n),n}}(t);a.loadDrawing(e.id,e.shapes,e.layers),a.setDrawingName(e.name)}catch(e){const t=e instanceof Error?e.message:"Failed to load drawing";throw s(t),e}finally{o(!1)}}),[a]);return{isSaving:t,isLoading:i,error:n,saveDrawing:r,loadDrawing:h,exportAs:l.exports.useCallback((async t=>{s(null);try{const e={id:a.drawingId||"",name:a.drawingName,description:"",width:a.viewport.width,height:a.viewport.height,backgroundColor:a.viewport.backgroundColor,shapes:a.shapes,layers:a.layers,symbols:a.symbolLibrary,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),version:1,gridSize:a.viewport.gridSize,snapToGrid:a.viewport.snapToGrid,showRulers:a.viewport.showRulers,showGrid:a.viewport.showGrid},i=await Wr(e,t),o="string"==typeof i?new Blob([i],{type:"application/json"}):i,n=URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.download=`${a.drawingName}.${t.format}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}catch(e){const t=e instanceof Error?e.message:"Failed to export drawing";throw s(t),e}}),[a]),importFrom:l.exports.useCallback((async(t,e)=>{o(!0),s(null);try{const{shapes:i,layers:n}=await Kr(t,e);e.replaceExisting&&a.clearDrawing(),i.forEach((t=>a.addShape(t))),n.length>0&&n.forEach((t=>a.addLayer(t)))}catch(i){const t=i instanceof Error?i.message:"Failed to import drawing";throw s(t),i}finally{o(!1)}}),[a]),createNew:l.exports.useCallback((()=>{if(a.isDirty){if(!window.confirm("You have unsaved changes. Do you want to discard them and create a new drawing?"))return}a.clearDrawing()}),[a])}}const Xr=j({container:{display:"flex",flexDirection:"row",flexWrap:"nowrap",backgroundColor:"#f5f5f5",margin:"0px 2px",height:"60px",borderBottom:"1px solid #e1e1e1",alignItems:"center",gap:"0",overflow:"auto",scrollbarWidth:"thin",scrollbarColor:"#c1c1c1 #f5f5f5","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f5f5f5"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#c1c1c1",borderRadius:"3px","&:hover":{backgroundColor:"#a1a1a1"}}},group:{display:"flex",flexWrap:"wrap",alignItems:"center",alignContent:"center",gap:"2px",padding:"2px 6px",height:"100%"},toolItem:{display:"inline-flex",alignItems:"center",gap:"4px",color:"#323130",fontSize:"11px",fontWeight:"normal",padding:"2px 6px",cursor:"pointer",borderRadius:"2px",userSelect:"none","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.05)"},'&[data-disabled="true"]':{color:"#a19f9d",cursor:"not-allowed",opacity:.6}},toolIcon:{fontSize:"14px"},divider:{width:"1px",alignSelf:"stretch",backgroundColor:"rgba(0, 0, 0, 0.2)",flexShrink:0},menuItem:{fontSize:"13px",fontWeight:"normal"}}),qr=()=>{const t=Xr(),{canvas:e,history:i,selectedShapeIds:o,shapes:n,isDirty:s,undo:a,redo:h,copyToClipboard:c,cutToClipboard:p,pasteFromClipboard:d,deleteShapes:u,duplicateShapes:g,toggleGrid:y,toggleRulers:S,selectAll:m,clearSelection:b,groupShapes:D,ungroupShape:f,clearDrawing:x}=zr(),{saveDrawing:C,exportAs:P,createNew:T,isSaving:O}=Yr();l.exports.useState(!1);const[v,w]=l.exports.useState(!1),[k,L]=l.exports.useState(!1),[A,I]=l.exports.useState(!1),[E,F]=l.exports.useState(!1),[G,R]=l.exports.useState(!1),[j,$]=l.exports.useState(100),Tt=t=>{console.log("Rotate:",t),w(!1)},Ot=t=>{console.log("Align:",t),L(!1)},vt=t=>{console.log("Flip:",t),I(!1)},wt=t=>{console.log("Make same:",t),F(!1)},kt=t=>{console.log("Background:",t),R(!1)};return r.exports.jsxs("div",{className:t.container,children:[r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs("div",{className:t.toolItem,onClick:b,children:[r.exports.jsx(B,{className:t.toolIcon}),r.exports.jsx("span",{children:"Select"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,onClick:o.length>0?()=>{console.log("Lock")}:void 0,children:[r.exports.jsx(M,{className:t.toolIcon}),r.exports.jsx("span",{children:"Lock"})]}),r.exports.jsxs("div",{className:t.toolItem,onClick:m,children:[r.exports.jsx(H,{className:t.toolIcon}),r.exports.jsx("span",{children:"Select All"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,onClick:o.length>0?()=>{console.log("Unlock")}:void 0,children:[r.exports.jsx(_,{className:t.toolIcon}),r.exports.jsx("span",{children:"Unlock"})]})]}),r.exports.jsx("div",{className:t.divider}),r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs("div",{className:t.toolItem,onClick:d,children:[r.exports.jsx(U,{className:t.toolIcon}),r.exports.jsx("span",{children:"Paste"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,onClick:o.length>0?c:void 0,children:[r.exports.jsx(N,{className:t.toolIcon}),r.exports.jsx("span",{children:"Copy"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,onClick:o.length>0?p:void 0,children:[r.exports.jsx(V,{className:t.toolIcon}),r.exports.jsx("span",{children:"Cut"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,onClick:o.length>0?()=>{o.length>0&&u(o)}:void 0,children:[r.exports.jsx(z,{className:t.toolIcon}),r.exports.jsx("span",{children:"Delete"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,onClick:o.length>0?()=>{o.length>0&&g(o)}:void 0,children:[r.exports.jsx(W,{className:t.toolIcon}),r.exports.jsx("span",{children:"Duplicate"})]}),r.exports.jsxs("div",{className:t.toolItem,onClick:()=>{console.log("Insert")},children:[r.exports.jsx(K,{className:t.toolIcon}),r.exports.jsx("span",{children:"Insert"})]})]}),r.exports.jsx("div",{className:t.divider}),r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===i.past.length,onClick:i.past.length>0?a:void 0,children:[r.exports.jsx(Y,{className:t.toolIcon}),r.exports.jsx("span",{children:"Undo"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":!s||O,onClick:s&&!O?async()=>{try{await C()}catch(t){console.error("Failed to save:",t)}}:void 0,children:[r.exports.jsx(X,{className:t.toolIcon}),r.exports.jsx("span",{children:O?"Saving...":"Save"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===i.future.length,onClick:i.future.length>0?h:void 0,children:[r.exports.jsx(q,{className:t.toolIcon}),r.exports.jsx("span",{children:"Redo"})]}),r.exports.jsxs("div",{className:t.toolItem,onClick:x,children:[r.exports.jsx(J,{className:t.toolIcon}),r.exports.jsx("span",{children:"Clear"})]})]}),r.exports.jsx("div",{className:t.divider}),r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs(Z,{open:v,onOpenChange:(t,e)=>w(e.open),children:[r.exports.jsx(Q,{children:r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,children:[r.exports.jsx(tt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Rotate"}),r.exports.jsx(et,{style:{fontSize:"10px"}})]})}),r.exports.jsx(it,{children:r.exports.jsxs(ot,{children:[r.exports.jsx(nt,{className:t.menuItem,onClick:()=>Tt(0),children:"0"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>Tt(45),children:"45"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>Tt(90),children:"90"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>Tt(180),children:"180"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>Tt(270),children:"270"})]})})]}),r.exports.jsxs(Z,{open:k,onOpenChange:(t,e)=>L(e.open),children:[r.exports.jsx(Q,{children:r.exports.jsxs("div",{className:t.toolItem,"data-disabled":o.length<2,children:[r.exports.jsx(st,{className:t.toolIcon}),r.exports.jsx("span",{children:"Align"}),r.exports.jsx(et,{style:{fontSize:"10px"}})]})}),r.exports.jsx(it,{children:r.exports.jsxs(ot,{children:[r.exports.jsx(nt,{className:t.menuItem,icon:r.exports.jsx(at,{}),onClick:()=>Ot("left"),children:"Align Left"}),r.exports.jsx(nt,{className:t.menuItem,icon:r.exports.jsx(st,{}),onClick:()=>Ot("center-h"),children:"Align Center H"}),r.exports.jsx(nt,{className:t.menuItem,icon:r.exports.jsx(rt,{}),onClick:()=>Ot("right"),children:"Align Right"}),r.exports.jsx(nt,{className:t.menuItem,icon:r.exports.jsx(lt,{}),onClick:()=>Ot("top"),children:"Align Top"}),r.exports.jsx(nt,{className:t.menuItem,icon:r.exports.jsx(ht,{}),onClick:()=>Ot("center-v"),children:"Align Center V"}),r.exports.jsx(nt,{className:t.menuItem,icon:r.exports.jsx(ct,{}),onClick:()=>Ot("bottom"),children:"Align Bottom"})]})})]}),r.exports.jsxs(Z,{open:A,onOpenChange:(t,e)=>I(e.open),children:[r.exports.jsx(Q,{children:r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,children:[r.exports.jsx(pt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Flip"}),r.exports.jsx(et,{style:{fontSize:"10px"}})]})}),r.exports.jsx(it,{children:r.exports.jsxs(ot,{children:[r.exports.jsx(nt,{className:t.menuItem,onClick:()=>vt("horizontal"),children:"Flip Horizontal"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>vt("vertical"),children:"Flip Vertical"})]})})]}),r.exports.jsxs(Z,{open:E,onOpenChange:(t,e)=>F(e.open),children:[r.exports.jsx(Q,{children:r.exports.jsxs("div",{className:t.toolItem,"data-disabled":o.length<2,children:[r.exports.jsx(dt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Make same"}),r.exports.jsx(et,{style:{fontSize:"10px"}})]})}),r.exports.jsx(it,{children:r.exports.jsxs(ot,{children:[r.exports.jsx(nt,{className:t.menuItem,onClick:()=>wt("width"),children:"Same Width"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>wt("height"),children:"Same Height"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>wt("size"),children:"Same Size"})]})})]})]}),r.exports.jsx("div",{className:t.divider}),r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs("div",{className:t.toolItem,"data-disabled":o.length<2,onClick:o.length>=2?()=>{o.length>1&&D(o)}:void 0,children:[r.exports.jsx(ut,{className:t.toolIcon}),r.exports.jsx("span",{children:"Group"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,children:[r.exports.jsx(gt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Bring to Front"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,children:[r.exports.jsx(yt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Ungroup"})]}),r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,children:[r.exports.jsx(St,{className:t.toolIcon}),r.exports.jsx("span",{children:"Send to Back"})]})]}),r.exports.jsx("div",{className:t.divider}),r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs("div",{className:t.toolItem,"data-disabled":0===o.length,children:[r.exports.jsx(W,{className:t.toolIcon}),r.exports.jsx("span",{children:"Add to Library"})]}),r.exports.jsxs("div",{className:t.toolItem,children:[r.exports.jsx(mt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Load Library"})]})]}),r.exports.jsx("div",{className:t.divider}),r.exports.jsxs("div",{className:t.group,children:[r.exports.jsxs(Z,{open:G,onOpenChange:(t,e)=>R(e.open),children:[r.exports.jsx(Q,{children:r.exports.jsxs("div",{className:t.toolItem,children:[r.exports.jsx(bt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Background"}),r.exports.jsx(et,{style:{fontSize:"10px"}})]})}),r.exports.jsx(it,{children:r.exports.jsxs(ot,{children:[r.exports.jsx(nt,{className:t.menuItem,onClick:()=>kt("white"),children:"White"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>kt("gray"),children:"Gray"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>kt("black"),children:"Black"}),r.exports.jsx(nt,{className:t.menuItem,onClick:()=>kt("custom"),children:"Custom..."})]})})]}),r.exports.jsxs("div",{className:t.toolItem,onClick:S,children:[r.exports.jsx(Dt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Rulers"})]}),r.exports.jsxs("div",{className:t.toolItem,onClick:y,children:[r.exports.jsx(ft,{className:t.toolIcon}),r.exports.jsx("span",{children:"Grid"})]}),r.exports.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"2px",padding:"2px 4px"},children:[r.exports.jsx("div",{className:t.toolItem,onClick:()=>{var t;return null==(t=ye.docUtil)?void 0:t.SetZoomLevel((ye.docUtil.zoom.value||100)-10)},style:{padding:"2px 4px"},children:r.exports.jsx(xt,{className:t.toolIcon})}),r.exports.jsx("input",{type:"number",value:j,onChange:t=>{const e=parseInt(t.target.value)||100;$(e)},style:{width:"50px",height:"22px",fontSize:"11px",padding:"2px 4px",border:"1px solid #ccc",borderRadius:"2px",textAlign:"center"}}),r.exports.jsx("span",{style:{fontSize:"11px",color:"#323130"},children:"%"}),r.exports.jsx("div",{className:t.toolItem,onClick:()=>{var t;return null==(t=ye.docUtil)?void 0:t.SetZoomLevel((ye.docUtil.zoom.value||100)+10)},style:{padding:"2px 4px"},children:r.exports.jsx(Ct,{className:t.toolIcon})})]}),r.exports.jsxs("div",{className:t.toolItem,onClick:()=>{$(100)},children:[r.exports.jsx(Pt,{className:t.toolIcon}),r.exports.jsx("span",{children:"Reset Zoom"})]})]})]})},Jr=j({container:{width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden",backgroundColor:"#fafafa",scrollbarWidth:"thin","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#c1c1c1",borderRadius:"3px","&:hover":{backgroundColor:"#a8a8a8"}}},accordion:{width:"100%","& .fui-AccordionHeader":{padding:"0",minHeight:"24px",fontSize:"11px"},"& .fui-AccordionHeader__button":{padding:"2px 4px"},"& .fui-AccordionPanel":{padding:"0 !important",width:"100%",margin:"0 !important",backgroundColor:"#f9f9f9"}},toolGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1px",padding:"0",margin:"10px"},toolButton:{width:"100%",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",minWidth:"0",padding:"4px"},emptyMessage:{padding:"8px 6px",fontSize:"10px",color:"#666",textAlign:"center",lineHeight:"1.3"},tooltipContent:{fontSize:"10px"}}),$r=()=>{const t=Jr(),{activeTool:e,setActiveTool:i}=zr(),[o,n]=l.exports.useState(["Basic","General","Pipe","Duct","Room","Metrics","User"]),[s,a]=l.exports.useState(Mo[0]),h=l.exports.useMemo((()=>{const t={};return Ho.forEach((e=>{t[e]=Mo.filter((t=>t.cat.includes(e)))})),t}),[]);return r.exports.jsx("div",{className:t.container,children:r.exports.jsx(Jt,{className:t.accordion,multiple:!0,collapsible:!0,openItems:o,onToggle:(t,e)=>{n(e.openItems)},children:Ho.map((e=>r.exports.jsxs(ie,{value:e,children:[r.exports.jsx(ce,{size:"small",children:e}),r.exports.jsx(ue,{children:h[e]&&h[e].length>0?r.exports.jsx("div",{className:t.toolGrid,children:h[e].map((e=>r.exports.jsx(Tt,{content:{children:e.label,className:t.tooltipContent},relationship:"label",positioning:"after",children:r.exports.jsx(Ot,{icon:(e.icon,r.exports.jsx(B,{})),appearance:s.name===e.name?"primary":"subtle",onClick:()=>(t=>{a(t),On.value={...t,type:"default"},i(t.name.toLowerCase()),console.log(" Tool selected:",t.name)})(e),className:t.toolButton})},e.name)))}):r.exports.jsx("div",{className:t.emptyMessage,children:"User"===e?r.exports.jsxs(r.exports.Fragment,{children:["Library is empty.",r.exports.jsx("br",{}),"Select objects and save",r.exports.jsx("br",{}),"to library to reuse."]}):r.exports.jsx(r.exports.Fragment,{children:"Coming soon"})})})]},e)))})})};var Zr="_documentArea_1rprz_6",Qr="_rulerCorner_1rprz_13",tl="_rulerHorizontal_1rprz_26",el="_rulerVertical_1rprz_38",il="_svgArea_1rprz_50";const ol=()=>{const t=l.exports.useRef(null);zr();return r.exports.jsxs("div",{id:"document-area",className:Zr,children:[r.exports.jsx("div",{id:"c-ruler",className:Qr}),r.exports.jsx("div",{id:"h-ruler",className:tl}),r.exports.jsx("div",{id:"v-ruler",className:el}),r.exports.jsx("div",{id:"svg-area",className:il,ref:t,onMouseMove:e=>{var i,o,n,s,a,r,l,h,c;if(t.current&&xn.value&&vn.includes((null==(i=On.value)?void 0:i.name)||"")&&null!==(null==(o=po.value)?void 0:o.activeItemIndex)){const i=t.current.getBoundingClientRect(),o={left:i.left,top:i.top},p=1/((null==(s=null==(n=po.value)?void 0:n.viewportTransform)?void 0:s.scale)||1),d=e.ctrlKey,u=(e.clientX-o.left-((null==(r=null==(a=po.value)?void 0:a.viewportTransform)?void 0:r.x)||0))*p,g=(e.clientY-o.top-((null==(h=null==(l=po.value)?void 0:l.viewportTransform)?void 0:h.y)||0))*p,y=u-Cn.value[0],S=g-Cn.value[1];let m=Math.atan2(S,y)*(180/Math.PI);d&&(m=5*Math.round(m/5));const b=Math.sqrt(y*y+S*S);(null==(c=po.value)?void 0:c.items)&&null!==po.value.activeItemIndex&&(po.value.items[po.value.activeItemIndex].rotate=m,po.value.items[po.value.activeItemIndex].width=b,console.log("Drawing continuous object - angle:",m,"distance:",b))}},tabIndex:0})]})},nl=j({container:{display:"flex",height:"100%",overflow:"hidden",backgroundColor:"#f5f5f5"},leftPanel:{display:"flex",flexDirection:"column",borderRight:"1px solid #e1e1e1",backgroundColor:"#fafafa",overflow:"hidden",transition:"width 0.3s ease"},leftPanelHeader:{display:"flex",flexDirection:"column",borderBottom:"1px solid #e1e1e1",backgroundColor:"#f5f5f5",height:"60px"},leftPanelRow:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 8px",height:"30px"},leftPanelTitle:{fontSize:"12px",fontWeight:"600",color:"#323130"},leftPanelContent:{flex:1,overflow:"auto"},rightPanel:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},drawingArea:{flex:1,overflow:"hidden",backgroundColor:"#ffffff"},messageBar:{borderTop:"1px solid #e1e1e1",backgroundColor:"#ffffff",padding:"4px 8px",fontSize:"11px",minHeight:"28px",display:"flex",alignItems:"center","& .fui-MessageBar":{width:"100%",minHeight:"unset",padding:"0",border:"none"},"& .fui-MessageBarBody":{fontSize:"11px",padding:"0"}}}),sl=()=>{const t=nl(),e=vt(),{graphicId:i}=wt(),{loadDrawing:o,createNew:n,isLoading:s,error:a}=Yr(),[h,c]=l.exports.useState(!0),[p,d]=l.exports.useState("Ready"),[u,g]=l.exports.useState(!1),[y,S]=l.exports.useState(115);if(l.exports.useEffect((()=>{Ka.UI.Initialize(null),console.log(" HVAC Designer UI initialized")}),[]),l.exports.useEffect((()=>{i?o(i).catch((t=>{console.error("Failed to load drawing:",t)})):n()}),[i]),s)return r.exports.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:r.exports.jsx(kt,{label:"Loading drawing..."})});if(a)return r.exports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:"16px"},children:[r.exports.jsx(Lt,{size:500,weight:"semibold",children:"Failed to load drawing"}),r.exports.jsx(Lt,{children:a})]});const m=()=>{g(!u)};return r.exports.jsxs("div",{className:t.container,children:[r.exports.jsx("div",{className:t.leftPanel,style:{width:u?"0px":`${y}px`},children:!u&&r.exports.jsxs(r.exports.Fragment,{children:[r.exports.jsxs("div",{className:t.leftPanelHeader,children:[r.exports.jsxs("div",{className:t.leftPanelRow,children:[r.exports.jsx("span",{className:t.leftPanelTitle,children:"T3 Hvac"}),r.exports.jsx(At,{appearance:"subtle",size:"small",icon:r.exports.jsx(It,{style:{fontSize:"14px"}}),onClick:m,title:"Collapse panel"})]}),r.exports.jsxs("div",{className:t.leftPanelRow,children:[r.exports.jsx(Lt,{size:200,style:{fontSize:"10px",color:"#605e5c"},children:"v1.0"}),r.exports.jsx(At,{appearance:"subtle",size:"small",icon:r.exports.jsx(Et,{style:{fontSize:"14px"}}),onClick:()=>e("/t3000"),title:"Back to main page"})]})]}),r.exports.jsx("div",{className:t.leftPanelContent,children:r.exports.jsx($r,{})})]})}),u&&r.exports.jsx("div",{style:{width:"24px",borderRight:"1px solid #e1e1e1",backgroundColor:"#fafafa",display:"flex",alignItems:"flex-start",paddingTop:"8px"},children:r.exports.jsx(At,{appearance:"subtle",size:"small",icon:r.exports.jsx(It,{}),onClick:m,title:"Expand panel"})}),r.exports.jsxs("div",{className:t.rightPanel,children:[r.exports.jsx(qr,{}),r.exports.jsx("div",{className:t.drawingArea,children:r.exports.jsx(ol,{})}),h&&r.exports.jsx("div",{className:t.messageBar,children:r.exports.jsx(Ft,{intent:"info",children:r.exports.jsx(Gt,{children:p})})})]})]})};export{sl as HvacDesignerPage};

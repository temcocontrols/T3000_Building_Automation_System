import{J as yt,m as Qe,d as K,n as xt,y as I,o as C,K as _t,Q as x,R as J,a as l,a7 as st,M as r,w as i,a2 as se,L as aa,C as la,W as m,c as E,P as S,a3 as X,V as Q,U as Ee,Y as oe,X as ee,a9 as rt,aa as ut,Z as dt,ab as Se,N as na,ac as je,_ as ia,$ as oa}from"./index.7a304d87.js";import{Q as sa,a as O,b as f,d as N,c as ra,C as j}from"./ClosePopup.7058a11c.js";import{b as te,Q as ct,c as ft}from"./QExpansionItem.451fef9a.js";import{Q as ua}from"./QPage.f8b5e3d8.js";import{U as M,T as Oe,fm as da,K as ca,L as c,N as $e,O as vt,R as fa,S as va,fn as pt,V as $,W as pa,fo as ma,fp as ga,X as mt,Z as ba}from"./QTree.3799a953.js";import{u as ha,l as be}from"./api.a3f70ecf.js";import{u as ya}from"./use-meta.6d04d7db.js";import{c as P,T as F,g as Pe,a as n,m as he,l as L,b as H,r as ae,i as pe,e as gt,f as le,s as Le,u as ye,k,n as Be,q as bt,x as xe}from"./T3Data.b7dff31d.js";import{D as xa}from"./DeviceInfo.2ec8b55d.js";import{N as _a,T as Ia,_ as ka,O as wa}from"./T3Message.41977598.js";import{t as re,i as Da,s as ht}from"./common.6c42c722.js";import{_ as Ca}from"./plugin-vue_export-helper.21dcd24c.js";import{B as _e,a as Ye,E as Ta}from"./button.935623f7.js";import"./FileUploadS3.e530e2fd.js";import"./AntdIcon.38c79ae3.js";import"./QToolbar.d08c6dee.js";_e.Group=Ye;_e.install=function(z){return z.component(_e.name,_e),z.component(Ye.name,Ye),z};yt({name:"ToolConfig",props:{object:{type:Object,required:!0}},emits:["refreshMoveable","T3UpdateEntryField","linkT3Entry","gaugeSettings","mounted","noChange"],setup(z,{emit:A}){let u={active:!1,cat:"General",group:{},height:60,id:1,rotate:0,scaleX:1,scaleY:1,settings:{bgColor:"inherit",fillColor:"#659dc5",fontSize:16,textColor:"inherit",titleColor:"inherit"},bgColor:"inherit",fillColor:"#659dc5",fontSize:16,textColor:"inherit",titleColor:"inherit",showDimensions:!0,t3Entry:null,title:null,translate:[217,49],type:"G_Circle",width:60,zindex:1};Qe(()=>{A("mounted")});const p=K({get(){return u},set(y,d){y!==d&&A("update:object",y)}}),ue=K(()=>{var y;return((y=re.find(d=>d.name===u.type))==null?void 0:y.settings)||{}}),q=K(()=>{var Y,ne;const y=(ne=(Y=M.getEntryRange(u.t3Entry))==null?void 0:Y.options)==null?void 0:ne.filter(ie=>ie.status===1),d=P.exports.cloneDeep(y);return d==null?void 0:d.map(ie=>(ie.value=ie.value,ie))}),de=K(()=>{var d,B,Y,ne;const y=[{label:"None",value:"none"},{label:"ID",value:"id"}];return((d=p.value.t3Entry)==null?void 0:d.label)!==void 0&&y.push({label:"Label",value:"label"}),((B=p.value.t3Entry)==null?void 0:B.description)!==void 0&&y.push({label:"Description",value:"description"}),((Y=p.value.t3Entry)==null?void 0:Y.value)!==void 0&&y.push({label:"Value",value:((ne=p.value.t3Entry)==null?void 0:ne.digital_analog)===1?"value":"control"}),y});function v(){p.value.type==="Int_Ext_Wall"&&(p.value.settings.strokeWidth=Oe.Hvac.PageMain.GetExteriorWallStrokeWidth(p.value.height)),A("refreshMoveable")}function w(y,d){A("T3UpdateEntryField",y,d)}function W(){A("linkT3Entry")}function V(y){A("gaugeSettings",y)}xt(()=>{P.exports.isEqual(z.object,u)&&A("noChange")});function U(y){var B;const d=ht.find(Y=>Y.value===y);return(B=d==null?void 0:d.icon)!=null&&B.off?d.icon.off:"block"}function R(y){p.value.type==="Int_Ext_Wall"&&(p.value.height=Oe.Hvac.PageMain.GetExteriorWallHeight(p.value.settings.strokeWidth),A("refreshMoveable"))}function ce(y){A("DisplayFieldValueChanged",y)}const Me=y=>M.getEntryRange(y),ze=K(()=>` ${M.getUnitText(p.value.t3Entry)}`);return{item:p,refreshMoveable:v,T3UpdateEntryField:w,linkT3Entry:W,t3EntryDisplayFieldOptions:de,gaugeSettings:V,icons:Da,switchIcons:ht,settings:ue,getEntryRange:Me,getSwitchIcon:U,rangeOptions:q,updatePropsValue:R,DisplayFieldValueChanged:ce,unitText:ze}}});yt({__name:"AntdTest",props:{item:{},showArrows:{type:Boolean}},emits:["autoManualToggle","objectClicked","changeValue","updateWeldModel"],setup(z,{emit:A}){const u=z,p=A;console.log("ObjectType2 props",u.item),K(()=>{var v;return M.getEntryRange((v=u.item)==null?void 0:v.t3Entry)}),K(()=>{var w;if(!u.item.t3Entry)return"";const v=M.getEntryRange(u.item.t3Entry);if(console.log("= Ot range,t3e",v,u.item.t3Entry),u.item.settings.t3EntryDisplayField==="description"){const W=u.item.t3Entry.description||"",V=u.item.t3Entry.value||"";let U="";if(u.item.t3Entry.range>100){const R=(w=v.options)==null?void 0:w.find(ce=>ce.value===u.item.t3Entry.value);U=(R==null?void 0:R.name)||""}else u.item.t3Entry.digital_analog===1?U=(V||"")+" "+((v==null?void 0:v.unit)||""):u.item.t3Entry.digital_analog===0&&(u.item.t3Entry.control?U=(v==null?void 0:v.on)||"":U=(v==null?void 0:v.off)||"");return W+" "+U}return u.item.t3Entry[u.item.settings.t3EntryDisplayField]||""}),K(()=>{var w,W;const v=u.item;return["Gauge","Dial"].includes(v.type||"")?v.type==="Gauge"?(w=v.settings.colors)==null?void 0:w.map(V=>[V.offset/100,V.color]):(W=v.settings.colors)==null?void 0:W.map((V,U)=>{var R;return{from:U?(R=v.settings.colors)==null?void 0:R[U-1].offset:0,to:V.offset,color:[V.color]}}):null}),I(null);function ue(v){v.stopPropagation(),alert("Icon edit clicked")}function q(v){v.stopPropagation(),alert("Antd button clicked")}function de(){p("objectClicked")}return Qe(()=>{console.log("Component mounted with props:",{item:u.item,showArrows:u.showArrows,title:u.item.title,type:u.item.type,settings:u.item.settings})}),(v,w)=>v.item.title?(C(),_t("div",{key:0,onClick:de},[x(J(v.item.title)+" ",1),l(r(Ta),{onClick:st(ue,["stop"]),class:"edit-icon"}),l(r(_e),{type:"primary",onClick:st(q,["stop"])},{default:i(()=>[x("Antd Button")]),_:1}),l(r(da))])):se("",!0)}});const Z=z=>(ia("data-v-ed2fc902"),z=z(),oa(),z),Ea=Z(()=>m("div",{id:"_crossTabClipboardDiv",style:{position:"absolute","z-index":"10000",left:"0px",top:"0px",width:"0px",height:"0px",overflow:"hidden"}},[m("div",{id:"_IEclipboardDiv",contenteditable:"true"}),m("input",{id:"_clipboardInput",type:"text",value:" "})],-1)),Sa={id:"main-app"},ja={id:"main-panel",class:"main-panel"},Pa={class:"main-area"},La={id:"left-panel",class:"left-panel"},Oa={id:"work-area",class:"main-panel"},Ma={style:{"padding-bottom":"5px","margin-left":"5px","margin-right":"5px"}},za=Z(()=>m("div",{id:"document-area"},[m("div",{id:"c-ruler",class:"document-ruler-corner"}),m("div",{id:"h-ruler",class:"document-ruler-top"}),m("div",{id:"v-ruler",class:"document-ruler-left"}),m("div",{id:"svg-area",class:"svg-area"})],-1)),Aa=Z(()=>m("div",{id:"doc-toolbar",class:"doc-toolbar"},null,-1)),Va=Z(()=>m("div",{class:"text-h6"},"Link Entry",-1)),Ua={class:"flex"},Ga=Z(()=>m("strong",null,"Reload panels data",-1)),Fa={class:"flex flex-col items-center mt-4"},Wa={class:"text-xl text-center"},Ra=Z(()=>m("div",{class:"text-h6"},"Insert Entry",-1)),Xa={class:"flex"},$a=Z(()=>m("strong",null,"Reload panels data",-1)),Ba={class:"flex flex-col items-center mt-4"},Ya={class:"text-xl text-center"},Qa=Z(()=>m("div",{class:"text-h6"},"Import from a JSON file",-1)),Ha=Z(()=>m("div",{class:"text-h6"},"Devices List",-1)),qa={__name:"HvacT2",setup(z){var ot;aa(e=>({"9635dcc6":r(gt).widthOffset,"468ec514":r(gt).heightOffset})),ya({title:"HVAC Drawer"});const u=new ca,p=ha(),ue=I(null);I([]);const q=I({...re[0],type:"default"}),de=I(!1);I([0,0]);const v=I(!0);I(!1);const w=I({addedCount:0,active:!1,uploadBtnLoading:!1,data:null}),W=K(()=>F.value.loadingPanel===null?100:parseInt((F.value.loadingPanel+1/F.value.panelsList.length)*100)),V=I(!1),U=c.IdxPage.zoom;let R=null;I({x:0,y:0});const ce=I(null);Qe(()=>{c.UI.Initialize(p),c.IdxPage2.initQuasar(p),c.IdxPage2.initPage()});function Me(e,t){LogUtil.Debug("= Idx updateDeviceModel ===",e,t),le.value.active=e,le.value.data=t}function ze(){c.DeviceOpt.clearDirtyCurrentDevice(),le.value.active=!0,n.value.selectedTarget=[],n.value.selectedTargets=[],n.value.activeItemIndex=null,c.DeviceOpt.refreshGraphicPanelElementCount(le.value.data)}xt(()=>{}),la(()=>{c.IdxPage.clearAutoSaveInterval(),c.WsClient.clearInitialDataInterval(),c.IdxPage.clearIdx()});function y(){if(!!ce.value)for(const e of ce.value)!e.refresh||e.refresh()}function d(e){e!=="Move Object"&&setTimeout(()=>{LogUtil.Debug("= IdxPage addActionToHistory",e),me(!1,!1),y()},200),ae.value=[],H.value.unshift({title:e,state:P.exports.cloneDeep(n.value)}),H.value.length>20&&H.value.pop()}function B(e,t="default"){LogUtil.Debug("= IdxPage selectTool",e,t),q.value=e,typeof e=="string"&&(q.value=re.find(a=>a.name===e)),q.value.type=t,Oe.Hvac.UI.evtOpt.HandleSidebarToolEvent(q)}function Y(e,t=!1){!e||(d("Rotate object"),t?e.rotate=e.rotate-90:e.rotate=e.rotate+90,c.IdxPage.refreshMoveable())}function ne(e){d("Flip object H"),e.scaleX===1?e.scaleX=-1:e.scaleX=1,c.IdxPage.refreshMoveable()}function ie(e){d("Flip object V"),e.scaleY===1?e.scaleY=-1:e.scaleY=1,c.IdxPage.refreshMoveable()}function It(e){d("Bring object to front"),e.zindex=e.zindex+1}function kt(e){d("Send object to back"),e.zindex=e.zindex-1}function wt(e){d("Remove object");const t=n.value.items.findIndex(a=>a.id===e.id);n.value.activeItemIndex=null,n.value.items.splice(t,1),n.value.selectedTargets=[]}function Dt(e){d(`Duplicate ${e.type}`),n.value.activeItemIndex=null;const t=Ae(e);n.value.selectedTargets=[],setTimeout(()=>{Ct(t)},10)}function Ae(e,t=void 0){const a=P.exports.cloneDeep(e);return a.translate[0]=a.translate[0]+5,a.translate[1]=a.translate[1]+5,addObject(a,t,!1)}function Ct(e){const t=document.querySelector(`#moveable-item-${e.id}`);n.value.selectedTargets=[t],n.value.activeItemIndex=n.value.items.findIndex(a=>a.id===e.id)}function Tt(e){LogUtil.Debug("= IdxPage DX DisplayFieldValueChanged",e),me(!1,!0)}function Et(){pt.LinkT3EntrySaveV2()}function He(e,t){if(e===""){t(()=>{Le.value=F.value.panelsData});return}t(()=>{const a=e.toUpperCase();Le.value=F.value.panelsData.filter(o=>{var s,b;return o.command.toUpperCase().indexOf(a)>-1||((s=o.description)==null?void 0:s.toUpperCase().indexOf(a))>-1||((b=o.label)==null?void 0:b.toUpperCase().indexOf(a))>-1})})}const qe=I(0);function St(e){d("Insert object to T3000 entry");const t=qe.value*80,a={width:60,height:60},o={clientX:300,clientY:100,top:100,left:200+t},s=re.find(h=>h.name==="Pump"),b=drawObject(a,o,s),T=n.value.items.findIndex(h=>h.id===b.id);n.value.activeItemIndex=T,jt(),qe.value++}function jt(){if(d("Link object to T3000 entry"),n.value.items[n.value.activeItemIndex].settings.t3EntryDisplayField||(n.value.items[n.value.activeItemIndex].label===void 0?n.value.items[n.value.activeItemIndex].settings.t3EntryDisplayField="description":n.value.items[n.value.activeItemIndex].settings.t3EntryDisplayField="label"),n.value.items[n.value.activeItemIndex].t3Entry=P.exports.cloneDeep(je($.value.data)),n.value.items[n.value.activeItemIndex].type==="Icon"){let e="fa-solid fa-camera-retro";$.value.data.type==="GRP"?e="fa-solid fa-camera-retro":$.value.data.type==="SCHEDULE"?e="schedule":$.value.data.type==="PROGRAM"?e="fa-solid fa-laptop-code":$.value.data.type==="HOLIDAY"&&(e="calendar_month"),n.value.items[n.value.activeItemIndex].settings.icon=e}M.refreshObjectStatus(n.value.items[n.value.activeItemIndex]),$.value.data=null,$.value.active=!1}function Pt(){}function me(e=!1,t=!1){LogUtil.Debug("= IdxPage save",e,t),c.IdxPage2.save(e,t)}function Ne(){var e;if(((e=n.value.items)==null?void 0:e.length)>0){p.dialog({dark:!0,title:"Do you want to clear the drawing and start over?",message:"This will also erase your undo history",cancel:!0,persistent:!0}).onOk(()=>{c.IdxPage.newProject()}).onCancel(()=>{});return}c.IdxPage.newProject()}u.keyup(e=>{e.key==="ctrl"&&(v.value=!0)}),u.keydown(e=>{e.key==="esc"&&(B(re[0]),Pe.value.length>1&&at(),de.value&&(de.value=!1,Ge())),e.key==="ctrl"&&(v.value=!1),!(n.value.selectedTargets.length<1)&&(["up","down","left","right"].includes(e.key)&&d("Move object"),e.key==="up"?he.value.request("draggable",{deltaX:0,deltaY:-5},!0):e.key==="down"?he.value.request("draggable",{deltaX:0,deltaY:5},!0):e.key==="left"?he.value.request("draggable",{deltaX:-5,deltaY:0},!0):e.key==="right"?he.value.request("draggable",{deltaX:5,deltaY:0},!0):e.key==="delete"&&Ve(),["up","down","left","right"].includes(e.key)&&c.IdxPage.refreshMoveable())}),u.keydown(["ctrl","s"],e=>{e.inputEvent.preventDefault(),me(!0,!0)}),u.keydown(["ctrl","z"],e=>{e.inputEvent.preventDefault(),!L.value&&Ge()}),u.keydown(["ctrl","y"],e=>{e.inputEvent.preventDefault(),!L.value&&et()}),u.keydown(["ctrl","r"],e=>{e.inputEvent.preventDefault(),Ne()}),u.keydown(["ctrl","d"],e=>{e.inputEvent.preventDefault(),Fe()}),u.keydown(["ctrl","g"],e=>{e.inputEvent.preventDefault(),We()}),u.keydown(["ctrl","shift","g"],e=>{e.inputEvent.preventDefault(),Re()}),u.keydown(["ctrl","c"],e=>{!document.activeElement.matches(".viewport")||(e.inputEvent.preventDefault(),Xe())}),u.keydown(["ctrl","v"],e=>{!document.activeElement.matches(".viewport")||(e.inputEvent.preventDefault(),it())}),u.keydown(["ctrl","b"],e=>{e.inputEvent.preventDefault(),Ue()}),u.keydown(["insert"],e=>{Oe.Hvac.KiOpt.InsertT3EntryDialog()});function Je(){pt.LinkT3EntryDialogActionV2()}function Ve(){d("Remove selected objects"),n.value.selectedTargets.length>0&&(n.value.selectedTargets.forEach(e=>{const t=n.value.items.findIndex(a=>`moveable-item-${a.id}`===e.id);t!==-1&&n.value.items.splice(t,1)}),n.value.selectedTargets=[],n.value.activeItemIndex=null)}function Lt(e){const t=1/n.value.viewportTransform.scale,a=e[0].translate[0];e[0].translate[1];const o=Math.min(...e.map(D=>D.translate[0])),s=Math.min(...e.map(D=>D.translate[1])),b=Math.max(...e.map(D=>D.translate[0]+D.width)),T=Math.max(...e.map(D=>D.translate[1]+D.height)),h=a<o?a:o,G=e.map(D=>{var De;return(De=D==null?void 0:D.type)!=null?De:""}).join("-");let ke=e[0].zindex;e.forEach(D=>{D.zindex=ke-1,ke=D.zindex});const we={title:`Weld-${G}`,active:!1,type:"Weld",translate:[h,s],width:(b-o)*t,height:(T-s)*t,rotate:0,scaleX:1,scaleY:1,settings:{active:!1,fillColor:"#659dc5",fontSize:16,inAlarm:!1,textColor:"inherit",titleColor:"inherit",weldItems:P.exports.cloneDeep(e)},zindex:1,t3Entry:null,id:n.value.itemsCount+1};addObject(we)}function Ot(e){const t=1/n.value.viewportTransform.scale,a=e[0].translate[0];e[0].translate[1];const o=Math.min(...e.map(g=>g.translate[0]));let s=Math.min(...e.map(g=>g.translate[1]));const b=Math.max(...e.map(g=>g.translate[0]+g.width)),T=Math.max(...e.map(g=>g.translate[1]+g.height));let h=a<o?a:o;const G=e.reduce((g,_)=>{const fe=_.rotate*Math.PI/180,ve=Math.cos(fe),Ce=Math.sin(fe);return[{x:_.translate[0],y:_.translate[1]},{x:_.translate[0]+_.width*ve,y:_.translate[1]+_.width*Ce},{x:_.translate[0]-_.height*Ce,y:_.translate[1]+_.height*ve},{x:_.translate[0]+_.width*ve-_.height*Ce,y:_.translate[1]+_.width*Ce+_.height*ve}].forEach(Te=>{g.minX=Math.min(g.minX,Te.x),g.minY=Math.min(g.minY,Te.y),g.maxX=Math.max(g.maxX,Te.x),g.maxY=Math.max(g.maxY,Te.y)}),g},{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});G.minX,G.minY,G.maxX-G.minX,G.maxY-G.minY;const ke=e.map(g=>{var _;return(_=g==null?void 0:g.type)!=null?_:""}).join("-");let we=e[0].zindex;e.forEach(g=>{g.zindex=we-1,we=g.zindex});const D=e.every(g=>g.type==="Duct");if(D){const g=Mt(e);e.forEach(_=>{const fe=g.find(ve=>ve.id===_.id);fe&&(_.overlap={isStartOverlap:fe.isStartOverlap,isEndOverlap:fe.isEndOverlap})})}const De=(b-o)*t+8,ea=(T-s)*t+8,ta={title:`Weld-${ke}`,active:!1,cat:"General",type:D?"Weld_Duct":"Weld_General",translate:[h,s],width:De,height:ea,rotate:0,scaleX:1,scaleY:1,settings:{active:!1,fillColor:"#659dc5",fontSize:16,inAlarm:!1,textColor:"inherit",titleColor:"inherit"},weldItems:P.exports.cloneDeep(e),zindex:1,t3Entry:null,id:n.value.itemsCount+1};addObject(ta)}function Ke(e){const{left:t,top:a,pos1:o,pos2:s,pos3:b,pos4:T}=e;return[o,s,T,b].map(h=>[t+h[0],a+h[1]])}function Ze(e){const t=e.closest(".moveable-item.Duct"),a=mt(e),o=document.querySelectorAll(".moveable-item.Duct");for(const s of Array.from(o)){if(t.isSameNode(s))continue;const b=mt(s),T=Ke(a),h=Ke(b);if(ba(T,h)>0)return!0}return!1}function Mt(e){const t=[];return e.map(a=>{const o=document.querySelector(`#moveable-item-${a.id} .duct-start`),s=document.querySelector(`#moveable-item-${a.id} .duct-end`),b=Ze(o),T=Ze(s);t.push({id:a.id,isStartOverlap:b,isEndOverlap:T})}),t}function Ue(){if(n.value.selectedTargets.length<2)return;if(n.value.items.filter(s=>n.value.selectedTargets.some(b=>b.id===`moveable-item-${s.id}`)).some(s=>s.type==="Weld")){p.notify({type:"warning",message:"Currently not supported!"});return}d("Weld selected objects");const t=n.value.items.filter(s=>n.value.selectedTargets.some(b=>b.id===`moveable-item-${s.id}`)),a=t.every(s=>s.cat==="General"),o=t.every(s=>s.type==="Duct");a||o?Ot(t):Lt(t),t.forEach(s=>{const b=n.value.items.findIndex(T=>T.id===s.id);b!==-1&&n.value.items.splice(b,1)}),c.IdxPage.refreshMoveable()}function Ge(){H.value.length<1||(ae.value.unshift({title:R,state:P.exports.cloneDeep(n.value)}),n.value=P.exports.cloneDeep(H.value[0].state),H.value.shift(),c.IdxPage.refreshMoveable())}function et(){ae.value.length<1||(H.value.unshift({title:R,state:P.exports.cloneDeep(n.value)}),n.value=P.exports.cloneDeep(ae.value[0].state),ae.value.shift(),c.IdxPage.refreshMoveable())}function zt(e){}function At(e){return new Promise((t,a)=>{var o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=a,o.readAsDataURL(e)})}async function Vt(e){if(ye.value){LogUtil.Debug("= Idx saveLibImage file",e),LogUtil.Debug("= Idx saveLibImage user",ye.value),be.post("hvacTools",{json:{name:e.name,fileId:e.id}}).then(async a=>{p.notify({color:"positive",message:"Image successfully saved"});const o=await a.json();Zt(o)}).catch(a=>{p.notify({color:"negative",message:a.message})});return}k.value.imagesCount++;const t={action:9,filename:e.name,fileLength:e.size,fileData:await At(e.data)};pe.value?c.WebClient.SaveImage(t):c.WsClient.SaveImage(t)}const ge=I({active:!1,data:{settings:(ot=re.find(e=>e.name==="Gauge"))==null?void 0:ot.settings}});function Ut(e){const t=n.value.items.findIndex(a=>a.id===e.id);n.value.items[t]=e,ge.value.active=!1,ge.value.data={}}function Gt(){w.value.active=!0}function Ft(){const e=P.exports.cloneDeep(je(n.value));e.selectedTargets=[],e.elementGuidelines=[];const t=document.createElement("a"),a=new Blob([JSON.stringify(e)],{type:"application/json"});t.href=URL.createObjectURL(a),t.download="HVAC_Drawer_Project.json",t.click()}async function Wt(e){const t=await e.data.text();w.value.data=t,Rt()}function Rt(){var t,a;const e=JSON.parse(w.value.data);if(!((t=e.items)!=null&&t[0].type)){p.notify({message:"Error, Invalid json file",color:"negative",icon:"error",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]});return}if(((a=n.value.items)==null?void 0:a.length)>0){p.dialog({dark:!0,title:"You have unsaved drawing!",message:`Before proceeding with the import, please note that any unsaved drawing will be lost,
           and your undo history will also be erased. Are you sure you want to proceed?`,cancel:!0,persistent:!0}).onOk(()=>{H.value=[],ae.value=[],w.value.active=!1,n.value=e,w.value.data=null,setTimeout(()=>{M.refreshMoveableGuides()},100),c.IdxPage.refreshMoveable()}).onCancel(()=>{w.value.active=!1});return}H.value=[],ae.value=[],w.value.active=!1,n.value=e,w.value.data=null,setTimeout(()=>{M.refreshMoveableGuides()},100),c.IdxPage.refreshMoveable()}function Fe(){if(n.value.selectedTargets.length<1)return;d("Duplicate the selected objects");const e=[],t={};n.value.selectedTargets.forEach(a=>{const o=n.value.items.find(s=>`moveable-item-${s.id}`===a.id);if(o){let s;o.group&&(t[`${o.group}`]||(n.value.groupCount++,t[`${o.group}`]=n.value.groupCount),s=t[`${o.group}`]);const b=Ae(o,s);setTimeout(()=>{const T=document.querySelector(`#moveable-item-${b.id}`);e.push(T)},10)}}),setTimeout(()=>{n.value.selectedTargets=e,ue.value.setSelectedTargets(e),n.value.activeItemIndex=null},20)}function We(){n.value.selectedTargets.length<2||(d("Group the selected objects"),n.value.selectedTargets.length>0&&(n.value.groupCount++,n.value.selectedTargets.forEach(e=>{const t=n.value.items.find(a=>`moveable-item-${a.id}`===e.id);t&&(t.group=n.value.groupCount)})))}function Re(){n.value.selectedTargets.length<2||(d("Ungroup the selected objects"),n.value.selectedTargets.length>0&&n.value.selectedTargets.forEach(e=>{const t=n.value.items.find(a=>`moveable-item-${a.id}`===e.id);t&&(t.group=void 0)}))}function Xt(e,t){const a=n.value.items[n.value.activeItemIndex];switch(e){case"newProject":Ne();break;case"importJsonAction":Gt();break;case"exportToJsonAction":Ft();break;case"save":me(!0,!0);break;case"undoAction":Ge();break;case"redoAction":et();break;case"duplicateSelected":Fe();break;case"groupSelected":We();break;case"ungroupSelected":Re();break;case"addToLibrary":lt();break;case"deleteSelected":Ve();break;case"weldSelected":Ue();break;case"duplicateObject":Dt(a);break;case"rotate90":Y(a);break;case"rotate-90":Y(a,!0);break;case"flipH":ne(a);break;case"flipV":ie(a);break;case"bringToFront":It(a);break;case"sendToBack":kt(a);break;case"removeObject":wt(a);break;case"zoomOut":c.IdxPage.zoomAction("out");break;case"zoomIn":c.IdxPage.zoomAction();break;case"zoomSet":c.IdxPage.zoomAction("set",t);break;case"copy":Xe();break;case"paste":it();break;case"link":Je();break;case"convertObjectType":Nt(a,t);break;case"toggleRulersGrid":Jt(t);break}}function tt(){F.value.loadingPanel=null,pe.value?c.WebClient.GetPanelsList():c.WsClient.GetPanelsList()}function Ie(e){let t=e.description&&e.id!==e.description||!e.description&&e.id!==e.label?e.id+" - ":"";return t=!e.description&&!e.label?e.id:t,t+(e.description||e.label||"")}function $t(){n.value.activeItemIndex=null,n.value.selectedTargets=[],L.value=!L.value,L.value&&B("Pointer"),pa.restDocumentAreaPosition()}I(!1),I(!1),I("Auto"),I("Off"),I(!1),I(!1),I(!1),I(!1),I(0);function at(){if(Pe.value.length>1){const e=Pe.value[Pe.value.length-2],t={action:7,panelId:e.pid,entryIndex:e.index};pe.value?c.WebClient.LoadGraphicEntry(t):c.WsClient.LoadGraphicEntry(t)}else if(pe.value)c.WebClient.GetInitialData();else{const e=c.DeviceOpt.getCurrentDevice(),t=e.panelId,a=e.graphic;c.WsClient.GetInitialData(t,a,!0)}}async function lt(){if(n.value.selectedTargets.length<1||L.value)return;const e=n.value.items.filter(s=>n.value.selectedTargets.some(b=>b.id===`moveable-item-${s.id}`));let t=!1;const a=P.exports.cloneDeep(e);k.value.objLibItemsCount++;let o=null;ye.value&&(t=!0,be.post("hvacObjectLibs",{json:{label:"Item "+k.value.objLibItemsCount,items:a.map(s=>(delete s.id,s))}}).then(async s=>{o=await s.json(),p.notify({type:"positive",message:"Successfully saved to library"}),k.value.objLib.push({id:(o==null?void 0:o.id)||k.value.objLibItemsCount,label:"Item "+k.value.objLibItemsCount,items:o.items,online:t}),M.saveLib()}).catch(s=>{p.notify({type:"negative",message:s.message})})),k.value.objLib.push({id:(o==null?void 0:o.id)||k.value.objLibItemsCount,label:"Item "+k.value.objLibItemsCount,items:a,online:t}),M.saveLib()}function Bt(){d("Bring selected objects to front"),n.value.items.filter(t=>n.value.selectedTargets.some(a=>a.id===`moveable-item-${t.id}`)).forEach(t=>{t.zindex=t.zindex+1})}function Yt(){d("Send selected objects to back"),n.value.items.filter(t=>n.value.selectedTargets.some(a=>a.id===`moveable-item-${t.id}`)).forEach(t=>{t.zindex=t.zindex-1})}function nt(e=!1){he.value.request("rotatable",{deltaRotate:e?-90:90},!0),c.IdxPage.refreshMoveable()}function Xe(){if(L.value||n.value.selectedTargets.length===0)return;const e=n.value.items.filter(t=>n.value.selectedTargets.some(a=>a.id===`moveable-item-${t.id}`));localStorage.setItem("clipboard",JSON.stringify(e)),V.value=!0}function it(){if(L.value)return;let e=[];const t=localStorage.getItem("clipboard");if(t&&(e=JSON.parse(t)),!e)return;d("Paste");const a=[],o=[];e.forEach(s=>{o.push(Ae(s))}),setTimeout(()=>{o.forEach(s=>{const b=document.querySelector(`#moveable-item-${s.id}`);a.push(b)}),n.value.selectedTargets=a,ue.value.setSelectedTargets(a),n.value.activeItemIndex=null},10)}function Qt(e){ye.value&&e.online&&be.delete("hvacObjectLibs/"+e.id).then(async()=>{p.notify({type:"positive",message:"Successfully deleted"})}).catch(a=>{p.notify({type:"negative",message:a.message})});const t=k.value.objLib.findIndex(a=>a.name===e.name);t!==-1&&k.value.objLib.splice(t,1),M.saveLib()}function Ht(e,t){ye.value&&e.online&&be.patch("hvacObjectLibs/"+e.id,{json:{label:t}}).then(async()=>{p.notify({type:"positive",message:"Successfully updated"})}).catch(o=>{p.notify({type:"negative",message:o.message})});const a=k.value.objLib.findIndex(o=>o.name===e.name);a!==-1&&(k.value.objLib[a].label=t),M.saveLib()}function qt(e){e.online&&be.delete("hvacTools/"+e.dbId||e.id.slice(4)).then(async()=>{p.notify({type:"positive",message:"Successfully deleted"})}).catch(a=>{p.notify({type:"negative",message:a.message})});const t=k.value.images.findIndex(a=>a.name===e.name);if(t!==-1&&(k.value.images.splice(t,1),!e.online)){if(k.value.images.length<=0)return;const a=P.exports.cloneDeep(k.value.images[t].path);pe.value?c.WebClient.DeleteImage(je(a)):c.WsClient.DeleteImage(je(a)),M.saveLib()}}function Nt(e,t){var T;if(e||(e=n.value.items[n.value.activeItemIndex]),!e)return;d("Convert object to "+t);const a=P.exports.cloneDeep((T=re.find(h=>h.name===t))==null?void 0:T.settings)||{},o=Object.keys(a).reduce((h,G)=>(h[G]=a[G].value,h),{}),s={};for(const h in o)Object.hasOwnProperty.call(o,h)&&(e.settings[h]!==void 0?s[h]=e.settings[h]:s[h]=o[h]);const b=["bgColor","textColor","title","t3EntryDisplayField"];for(const h of b)s[h]===void 0&&(s[h]=e.settings[h]);e.type=t,e.settings=s}function Jt(e){Be.value=e==="Enable",n.value.rulersGridVisible=Be.value,me(!1,!1)}function Kt(e,t){LogUtil.Debug("toolDropped->tool",e,t)}function Zt(e){const t=k.value.images.findIndex(a=>a.id==="IMG-"+e.id);t!==-1&&k.value.images.splice(t,1),k.value.images.push({id:"IMG-"+e.id,dbId:e.id,name:e.name,path:{}.API_URL+"/file/"+e.file.path,online:!0})}return(e,t)=>(C(),_t(na,null,[l(ua,null,{default:i(()=>{var a;return[Ea,m("div",Sa,[m("div",ja,[!r(pe)&&!r(L)?(C(),E(_a,{key:0,locked:r(L),onLockToggle:$t,onNavGoBack:at,onMenuAction:Xt,object:r(n).items[r(n).activeItemIndex],"selected-count":(a=r(n).selectedTargets)==null?void 0:a.length,"disable-undo":r(L)||r(H).length<1,"disable-redo":r(L)||r(ae).length<1,"disable-paste":r(L)||!V.value,zoom:r(U),rulersGridVisible:r(Be),deviceModel:r(le),onShowMoreDevices:ze},null,8,["locked","object","selected-count","disable-undo","disable-redo","disable-paste","zoom","rulersGridVisible","deviceModel"])):se("",!0),m("div",Pa,[m("div",La,[r(L)?se("",!0):(C(),E(Ia,{key:0,"selected-tool":q.value,images:r(k).images,"object-lib":r(k).objLib,onSelectTool:B,onDeleteLibItem:Qt,onRenameLibItem:Ht,onDeleteLibImage:qt,onSaveLibImage:Vt,onToolDropped:Kt},null,8,["selected-tool","images","object-lib"]))]),m("div",Oa,[m("div",Ma,[l(ka)]),za,Aa])])])]),r(ma)?(C(),E(ra,{key:0,"touch-position":"",target:"#svg-area","context-menu":""},{default:i(()=>[l(sa,null,{default:i(()=>[S((C(),E(O,{dense:"",clickable:"",onClick:Xe},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"content_copy",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[l(te,null,{default:i(()=>[x("Copy")]),_:1})]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Ctrl + C")]),_:1})]),_:1})]),_:1})),[[j]]),l(Q),S((C(),E(O,{dense:"",clickable:"",onClick:Fe},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"content_copy",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[l(te,null,{default:i(()=>[x("Duplicate")]),_:1})]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Ctrl + D")]),_:1})]),_:1})]),_:1})),[[j]]),l(Q),S((C(),E(O,{dense:"",clickable:"",onClick:We},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"join_full",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[l(te,null,{default:i(()=>[x("Group")]),_:1})]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Ctrl + G")]),_:1})]),_:1})]),_:1})),[[j]]),S((C(),E(O,{dense:"",clickable:"",onClick:Re},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"join_inner",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[l(te,null,{default:i(()=>[x("Ungroup")]),_:1})]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Ctrl + Shift + G")]),_:1})]),_:1})]),_:1})),[[j]]),l(Q),S((C(),E(O,{dense:"",clickable:"",onClick:lt},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"library_books",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[l(te,null,{default:i(()=>[x("Add to Library")]),_:1})]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Ctrl + L")]),_:1})]),_:1})]),_:1})),[[j]]),l(Q),S((C(),E(O,{dense:"",clickable:"",onClick:t[0]||(t[0]=o=>Bt())},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"flip_to_front",color:"grey-7","text-color":"white"})]),_:1}),l(f,{class:"py-2"},{default:i(()=>[x("Bring to front")]),_:1})]),_:1})),[[j]]),S((C(),E(O,{dense:"",clickable:"",onClick:t[1]||(t[1]=o=>Yt())},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"flip_to_back",color:"grey-7","text-color":"white"})]),_:1}),l(f,{class:"py-2"},{default:i(()=>[x("Send to Back")]),_:1})]),_:1})),[[j]]),l(Q),S((C(),E(O,{dense:"",clickable:"",onClick:t[2]||(t[2]=o=>nt())},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"autorenew",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[x("Rotate 90\xB0")]),_:1})]),_:1})),[[j]]),S((C(),E(O,{dense:"",clickable:"",onClick:t[3]||(t[3]=o=>nt(!0))},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"sync",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[x("Rotate -90\xB0")]),_:1})]),_:1})),[[j]]),l(Q),S((C(),E(O,{dense:"",clickable:"",onClick:Ve},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"delete",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[l(te,null,{default:i(()=>[x("Delete")]),_:1})]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Delete")]),_:1})]),_:1})]),_:1})),[[j]]),S((C(),E(O,{dense:"",clickable:"",onClick:Ue},{default:i(()=>[l(f,{avatar:""},{default:i(()=>[l(X,{size:"sm",icon:"splitscreen",color:"grey-7","text-color":"white"})]),_:1}),l(f,null,{default:i(()=>[x("Weld Selected")]),_:1}),l(f,{side:""},{default:i(()=>[l(N,null,{default:i(()=>[x("Ctrl + B")]),_:1})]),_:1})]),_:1})),[[j]])]),_:1})]),_:1})):se("",!0),r(ga)?(C(),E(wa,{key:1,current:r(bt).items[r(bt).activeItemIndex],onLinkT3Entry:Je,onDisplayFieldValueChanged:Tt},null,8,["current"])):se("",!0)]}),_:1}),l(Se,{modelValue:r(xe).active,"onUpdate:modelValue":t[5]||(t[5]=a=>r(xe).active=a)},{default:i(()=>[l(Ee,{style:{"min-width":"650px"}},{default:i(()=>[l(oe,{class:"row items-center q-pb-none"},{default:i(()=>[Va,l($e),S(l(ee,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),l(Q),l(oe,{style:{height:"70vh"},class:"scroll"},{default:i(()=>[m("div",Ua,[l(ee,{icon:"refresh",flat:"",onClick:tt},{default:i(()=>[l(ct,{anchor:"top middle",self:"bottom middle"},{default:i(()=>[Ga]),_:1})]),_:1}),l(ft,{"option-label":Ie,"option-value":"id",filled:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",modelValue:r(xe).data,"onUpdate:modelValue":t[4]||(t[4]=a=>r(xe).data=a),options:r(Le),onFilter:He,label:"Select Entry",class:"grow"},{option:i(a=>[l(O,rt(ut(a.itemProps)),{default:i(()=>[l(f,{class:"grow"},{default:i(()=>[l(te,null,{default:i(()=>[x(J(Ie(a.opt)),1)]),_:2},1024)]),_:2},1024),l(f,{avatar:"",class:"pl-1 min-w-0"},{default:i(()=>[l(N,{size:"sm",icon:"label_important"},{default:i(()=>[x("Panel: "+J(a.opt.pid),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),m("div",Fa,[r(F).loadingPanel!==null?(C(),E(vt,{key:0,indeterminate:"","show-value":"",value:W.value,size:"270px",thickness:.22,color:"light-blue","track-color":"grey-3",class:"q-ma-md overflow-hidden"},{default:i(()=>[m("div",Wa,[m("div",null,J(W.value)+"%",1),m("div",null," Loading Panel #"+J(r(F).panelsList[r(F).loadingPanel].panel_number),1)])]),_:1},8,["value"])):se("",!0)])]),_:1}),l(Q),l(dt,{align:"right"},{default:i(()=>[S(l(ee,{flat:"",label:"Cancel",color:"primary"},null,512),[[j]]),l(ee,{flat:"",label:"Save",disable:!r(xe).data,color:"primary",onClick:Et},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Se,{modelValue:r($).active,"onUpdate:modelValue":t[8]||(t[8]=a=>r($).active=a)},{default:i(()=>[l(Ee,{style:{"min-width":"650px"}},{default:i(()=>[l(oe,{class:"row items-center q-pb-none"},{default:i(()=>[Ra,l($e),S(l(ee,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),l(Q),l(oe,{style:{height:"70vh"},class:"scroll"},{default:i(()=>[m("div",Xa,[l(ee,{icon:"refresh",flat:"",onClick:tt},{default:i(()=>[l(ct,{anchor:"top middle",self:"bottom middle"},{default:i(()=>[$a]),_:1})]),_:1}),l(ft,{"option-label":Ie,label:"Type or select Entry","option-value":"id",filled:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",modelValue:r($).data,"onUpdate:modelValue":[t[6]||(t[6]=a=>r($).data=a),t[7]||(t[7]=a=>St(e.value))],options:r(Le),onFilter:He,class:"grow",autofocus:"",onFocus:Pt},{option:i(a=>[l(O,rt(ut(a.itemProps)),{default:i(()=>[l(f,{class:"grow"},{default:i(()=>[l(te,null,{default:i(()=>[x(J(Ie(a.opt)),1)]),_:2},1024)]),_:2},1024),l(f,{avatar:"",class:"pl-1 min-w-0"},{default:i(()=>[l(N,{size:"sm",icon:"label_important"},{default:i(()=>[x("Panel: "+J(a.opt.pid),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),m("div",Ba,[r(F).loadingPanel!==null?(C(),E(vt,{key:0,indeterminate:"","show-value":"",value:W.value,size:"270px",thickness:.22,color:"light-blue","track-color":"grey-3",class:"q-ma-md overflow-hidden"},{default:i(()=>[m("div",Ya,[m("div",null,J(W.value)+"%",1),m("div",null," Loading Panel #"+J(r(F).panelsList[r(F).loadingPanel].panel_number),1)])]),_:1},8,["value"])):se("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(fa,{active:ge.value.active,"onUpdate:active":t[9]||(t[9]=a=>ge.value.active=a),data:ge.value.data,onSaved:Ut},null,8,["active","data"]),l(Se,{modelValue:w.value.active,"onUpdate:modelValue":t[11]||(t[11]=a=>w.value.active=a)},{default:i(()=>[l(Ee,{style:{"min-width":"450px"}},{default:i(()=>[l(oe,null,{default:i(()=>[Qa]),_:1}),l(oe,{class:"q-pt-none"},{default:i(()=>[l(va,{types:["application/json"],onUploaded:zt,onFileAdded:Wt})]),_:1}),l(dt,{align:"right",class:"text-primary"},{default:i(()=>[l(ee,{flat:"",label:"Cancel",onClick:t[10]||(t[10]=a=>w.value.active=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Se,{modelValue:r(le).active,"onUpdate:modelValue":t[12]||(t[12]=a=>r(le).active=a)},{default:i(()=>[l(Ee,{style:{"min-width":"900px"}},{default:i(()=>[l(oe,{class:"row items-center q-pb-none"},{default:i(()=>[Ha,l($e),S(l(ee,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),l(Q),l(xa,{deviceModel:r(le),onUpdateDeviceModel:Me,onTestSendMsg:e.testSendMsg},null,8,["deviceModel","onTestSendMsg"])]),_:1})]),_:1},8,["modelValue"])],64))}};var vl=Ca(qa,[["__scopeId","data-v-ed2fc902"]]);export{vl as default};

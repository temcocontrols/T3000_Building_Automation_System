import{j as e}from"./react.1acd1a13.js";import{r as s,R as r}from"./client.58f92968.js";import{l as t,L as l,M as a,n,T as i,y as o,N as d,z as c,P as u,Q as p,I as x,S as h,R as m,U as j,V as f,X as g,Y as b,Z as _,$ as N}from"./App.3fe38e41.js";import{R as v,g as C}from"./RangeSelectionDrawer.b80e2e52.js";import{c as I,D as w,a as S,b as z,d as y,e as k,f as $}from"./DataGridHeaderCell.f7016832.js";import{T as L}from"./TableCellLayout.9e29eb07.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";import"./RadioGroup.34e0e018.js";import"./Input.037b8c53.js";var W="_container_1lu2z_18",D="_bladeContentContainer_1lu2z_30",E="_bladeContentWrapper_1lu2z_38",F="_bladeContent_1lu2z_30",T="_partContent_1lu2z_54",H="_toolbar_1lu2z_63",R="_toolbarContainer_1lu2z_72",M="_toolbarButton_1lu2z_80",V="_toolbarSeparator_1lu2z_119",A="_searchInputWrapper_1lu2z_127",P="_searchIcon_1lu2z_134",U="_searchInput_1lu2z_127",B="_overviewHr_1lu2z_194",O="_dockingBody_1lu2z_202",K="_scrollContainer_1lu2z_211",G="_noData_1lu2z_242",Y="_loadingBar_1lu2z_251",J="_autoLoadIndicator_1lu2z_265",Q="_editableCell_1lu2z_467",X="_editInput_1lu2z_481",Z="_saveButton_1lu2z_517",q="_refreshIconButton_1lu2z_548",ee="_isRefreshing_1lu2z_583",se="_rotating_1lu2z_603",re="_headerCellSort_1lu2z_611",te="_headerCell_1lu2z_611",le="_sortIconFaded_1lu2z_624",ae="_cellFlexContainer_1lu2z_628",ne="_editInputContainer_1lu2z_633",ie="_flex1_1lu2z_640",oe="_iconSmall_1lu2z_644",de="_iconMedium_1lu2z_648",ce="_switchScale_1lu2z_656",ue="_switchContainer_1lu2z_660",pe="_rangeLink_1lu2z_666",xe="_marginLeft8_1lu2z_671",he="_errorNotice_1lu2z_675",me="_iconError_1lu2z_685",je="_textError_1lu2z_691",fe="_noPadding_1lu2z_697",ge="_centerText_1lu2z_701";const be=()=>{const{selectedDevice:be,treeData:_e,selectDevice:Ne,getNextDevice:ve,getFilteredDevices:Ce}=t(),Ie=l((e=>e.setMessage)),[we,Se]=s.exports.useState([]),[ze,ye]=s.exports.useState(!1),[ke,$e]=s.exports.useState(null),[Le,We]=s.exports.useState(!1),[De,Ee]=s.exports.useState(new Set),[Fe,Te]=s.exports.useState(!1),He=s.exports.useRef(!1),Re=s.exports.useRef(null),[Me,Ve]=s.exports.useState(!1),Ae=s.exports.useRef(!1),Pe=s.exports.useCallback((async()=>{if(be){ye(!0),$e(null);try{const e=`${a}/api/t3_device/devices/${be.serialNumber}/input-points`,s=await fetch(e);if(!s.ok)throw new Error(`Failed to fetch inputs: ${s.statusText}`);const r=(await s.json()).input_points||[];Se(r)}catch(e){const s=e instanceof Error?e.message:"Failed to load inputs";$e(s)}finally{ye(!1)}}else Se([])}),[be]);s.exports.useEffect((()=>{Pe()}),[Pe]),s.exports.useEffect((()=>{Se([]),Te(!1),He.current=!1}),[null==be?void 0:be.serialNumber]),s.exports.useEffect((()=>{if(ze||!be||Fe||He.current)return;(async()=>{if(He.current=!0,we.length>0)Te(!0);else{ye(!0);try{const e=await m.refreshFromDevice({serialNumber:be.serialNumber,type:"input",onLoadingChange:e=>{e&&Ie(`Loading inputs from ${be.nameShowOnTree} (Action 17)...`,"info")}});Ie(`âœ“ Synced ${e.itemCount} inputs from ${be.nameShowOnTree}`,"success")}catch(e){Ie(`Failed to sync inputs: ${e instanceof Error?e.message:"Unknown error"}`,"error")}finally{await Pe(),Te(!0),ye(!1)}}})()}),[ze,be,Fe,Pe,we.length,Ie]);const Ue=s.exports.useCallback((async()=>{const e=ve();e&&(Ve(!0),Ne(e),setTimeout((()=>{Ve(!1)}),500))}),[ve,Ne]),Be=s.exports.useCallback((e=>{if(Me||ze)return;const s=e.currentTarget;s.scrollHeight-s.scrollTop-s.clientHeight<=1&&we.length>0?Ae.current=!0:Ae.current=!1}),[Me,ze,we.length]),Oe=s.exports.useCallback((e=>{Me||ze||0===we.length||e.deltaY>0&&Ae.current&&(Ae.current=!1,Ue())}),[Me,ze,we.length,Ue]);s.exports.useEffect((()=>{be&&Re.current&&Re.current.scrollTo({top:0,behavior:Me?"smooth":"auto"})}),[be,Me]);const Ke=(e,s,r)=>{qe({serialNumber:e.serialNumber,inputIndex:e.inputIndex||"",field:s}),ss(r||"")},Ge=async(e,s,r,t,l)=>{var n,i;try{const o={fullLabel:"fullLabel"===r?t:l.fullLabel||"",label:"label"===r?t:l.label||"",value:"fValue"===r?parseFloat(t||"0"):parseFloat(l.fValue||"0"),range:"range"===r?parseInt(t||"0",10):parseInt(l.rangeField||l.range||"0",10),autoManual:"autoManual"===r?parseInt(t||"0",10):parseInt(l.autoManual||"0",10),control:0,filter:parseInt(l.filterField||"0",10),digitalAnalog:parseInt(l.digitalAnalog||"0",10),calibrationSign:parseInt(l.sign||"0",10),calibrationH:parseInt((null==(n=l.calibration)?void 0:n.split(".")[0])||"0",10),calibrationL:parseInt((null==(i=l.calibration)?void 0:i.split(".")[1])||"0",10),decom:0},d=await fetch(`${a}/api/t3_device/inputs/${e}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!d.ok){const e=await d.text();throw new Error(`HTTP ${d.status}: ${e}`)}return await d.json()}catch(o){throw o}},Ye=async()=>{if(Ze)if("fValue"===Ze.field||es.trim()){ts(!0);try{if(be&&["fullLabel","label","fValue","range","autoManual"].includes(Ze.field)){const e=we.find((e=>e.serialNumber===Ze.serialNumber&&e.inputIndex===Ze.inputIndex));if(!e)throw new Error("Current input data not found");await Ge(be.serialNumber,Ze.inputIndex,Ze.field,es,e)}Se((e=>e.map((e=>e.serialNumber===Ze.serialNumber&&e.inputIndex===Ze.inputIndex?{...e,[Ze.field]:es}:e)))),qe(null)}catch(e){alert(`Failed to update: ${e instanceof Error?e.message:"Unknown error"}`)}finally{ts(!1)}}else qe(null);else qe(null)},Je=e=>{"Enter"===e.key?(e.preventDefault(),Ye()):"Escape"===e.key&&(e.preventDefault(),qe(null),ss(""))},[Qe,Xe]=s.exports.useState(""),[Ze,qe]=s.exports.useState(null),[es,ss]=s.exports.useState(""),[rs,ts]=s.exports.useState(!1),[ls,as]=s.exports.useState(!1),[ns,is]=s.exports.useState(null),[os,ds]=s.exports.useState(null),[cs,us]=s.exports.useState("ascending"),ps=e=>{os===e?us("ascending"===cs?"descending":"ascending"):(ds(e),us("ascending"))},xs=r.useMemo((()=>0===we.length?Array(10).fill(null).map(((e,s)=>({serialNumber:(null==be?void 0:be.serialNumber)||0,inputId:"",inputIndex:"",panel:"",fullLabel:"",autoManual:"",fValue:"",units:"",range:"",rangeField:"",calibration:"",sign:"",filterField:"",status:"",signalType:"",digitalAnalog:"",label:"",typeField:""}))):we),[we,be]),hs=e=>!e.inputIndex&&!e.inputId&&0===we.length,ms=[I({columnId:"panel",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("panel"),children:[e.exports.jsx("span",{children:"Panel"}),"panel"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>e.exports.jsx(L,{children:!hs(s)&&(s.panel||"---")})}),I({columnId:"input",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("input"),children:[e.exports.jsx("span",{children:"Input"}),"input"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>{const r=s.inputIndex||"",t=De.has(r);return e.exports.jsx(L,{children:!hs(s)&&e.exports.jsxs("div",{className:ae,children:[e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(!be)return;const s=parseInt(e,10);if(!isNaN(s)){Ee((s=>new Set(s).add(e)));try{await m.refreshSingleInput(be.serialNumber,s),await Pe()}catch(r){}finally{Ee((s=>{const r=new Set(s);return r.delete(e),r}))}}})(r)},className:`${q} ${t?ee:""}`,title:"Refresh this input from device",disabled:t,children:e.exports.jsx(o,{className:`${oe} ${t?se:""}`})}),e.exports.jsx(i,{size:200,weight:"regular",children:s.inputId||(s.inputIndex?`IN${parseInt(s.inputIndex)+1}`:"---")})]})})}}),I({columnId:"fullLabel",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("fullLabel"),children:[e.exports.jsx("span",{children:"Full Label"}),"fullLabel"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>{const r=(null==Ze?void 0:Ze.serialNumber)===s.serialNumber&&(null==Ze?void 0:Ze.inputIndex)===s.inputIndex&&"fullLabel"===(null==Ze?void 0:Ze.field);return e.exports.jsx(L,{children:!hs(s)&&(r?e.exports.jsxs("div",{className:ne,children:[e.exports.jsx("input",{type:"text",className:`${X} ${ie}`,value:es,onChange:e=>ss(e.target.value),onBlur:Ye,onKeyDown:Je,autoFocus:!0,disabled:rs,placeholder:"Enter label","aria-label":"Edit full label"}),e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),Ye()},disabled:rs,className:Z,title:"Save",children:e.exports.jsx(b,{className:de})})]}):e.exports.jsx("div",{className:Q,onDoubleClick:()=>Ke(s,"fullLabel",s.fullLabel||""),title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:s.fullLabel||"Unnamed"})}))})}}),I({columnId:"label",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("label"),children:[e.exports.jsx("span",{children:"Label"}),"label"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>{const r=(null==Ze?void 0:Ze.serialNumber)===s.serialNumber&&(null==Ze?void 0:Ze.inputIndex)===s.inputIndex&&"label"===(null==Ze?void 0:Ze.field);return e.exports.jsx(L,{children:!hs(s)&&(r?e.exports.jsxs("div",{className:ne,children:[e.exports.jsx("input",{type:"text",className:`${X} ${ie}`,value:es,onChange:e=>ss(e.target.value),onBlur:Ye,onKeyDown:Je,autoFocus:!0,disabled:rs,placeholder:"Enter label","aria-label":"Edit label"}),e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),Ye()},disabled:rs,className:Z,title:"Save",children:e.exports.jsx(b,{className:de})})]}):e.exports.jsx("div",{className:Q,onDoubleClick:()=>Ke(s,"label",s.label||""),title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:s.label||"---"})}))})}}),I({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{className:te,children:e.exports.jsx("span",{children:"Auto/Man"})}),renderCell:s=>{var r;const t=null==(r=s.autoManual)?void 0:r.toString().toLowerCase(),l="auto"===t||"1"===t;return e.exports.jsx(L,{children:!hs(s)&&e.exports.jsx("div",{onClick:async()=>{const e=l?"0":"1";try{const r=we.find((e=>e.serialNumber===s.serialNumber&&e.inputIndex===s.inputIndex));if(!r)throw new Error("Current input data not found");await Ge(s.serialNumber,s.inputIndex,"autoManual",e,r),Se((r=>r.map((r=>r.serialNumber===s.serialNumber&&r.inputIndex===s.inputIndex?{...r,autoManual:e}:r))))}catch(r){alert(`Failed to update Auto/Man: ${r instanceof Error?r.message:"Unknown error"}`)}},className:ue,children:e.exports.jsx(_,{checked:l,className:ce})})})}}),I({columnId:"value",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("value"),children:[e.exports.jsx("span",{children:"Value"}),"value"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>{const r=(null==Ze?void 0:Ze.serialNumber)===s.serialNumber&&(null==Ze?void 0:Ze.inputIndex)===s.inputIndex&&"fValue"===(null==Ze?void 0:Ze.field);return e.exports.jsx(L,{children:!hs(s)&&(r?e.exports.jsxs("div",{className:ne,children:[e.exports.jsx("input",{type:"number",step:"0.01",className:`${X} ${ie}`,value:es,onChange:e=>ss(e.target.value),onBlur:Ye,onKeyDown:Je,autoFocus:!0,disabled:rs,placeholder:"Enter value","aria-label":"Edit value"}),e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),Ye()},disabled:rs,className:Z,title:"Save",children:e.exports.jsx(b,{className:de})})]}):e.exports.jsx("div",{className:Q,onDoubleClick:()=>{var e;return Ke(s,"fValue",(null==(e=s.fValue)?void 0:e.toString())||"0")},title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:s.fValue||"---"})}))})}}),I({columnId:"units",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("units"),children:[e.exports.jsx("span",{children:"Units"}),"units"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>e.exports.jsx(L,{children:!hs(s)&&(s.units||"---")})}),I({columnId:"range",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("range"),children:[e.exports.jsx("span",{children:"Range"}),"range"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>{const r=s.range?parseInt(s.range):0,t="Digital"===s.signalType?1:0,l=C(r,t);return e.exports.jsx(L,{children:!hs(s)&&e.exports.jsx("div",{onClick:()=>(e=>{is(e),as(!0)})(s),className:pe,title:"Click to change range",children:e.exports.jsx(i,{size:200,weight:"regular",children:l})})})}}),I({columnId:"calibration",renderHeaderCell:()=>e.exports.jsx("div",{className:te,children:e.exports.jsx("span",{children:"Calibration"})}),renderCell:s=>e.exports.jsx(L,{children:!hs(s)&&(s.calibration||"0")})}),I({columnId:"sign",renderHeaderCell:()=>e.exports.jsx("div",{className:te,children:e.exports.jsx("span",{children:"Sign"})}),renderCell:s=>e.exports.jsx(L,{children:!hs(s)&&(s.sign||"+")})}),I({columnId:"filter",renderHeaderCell:()=>e.exports.jsx("div",{className:te,children:e.exports.jsx("span",{children:"Filter"})}),renderCell:s=>e.exports.jsx(L,{children:!hs(s)&&(s.filterField||"0")})}),I({columnId:"status",renderHeaderCell:()=>e.exports.jsxs("div",{className:re,onClick:()=>ps("status"),children:[e.exports.jsx("span",{children:"Status"}),"status"===os?"ascending"===cs?e.exports.jsx(j,{}):e.exports.jsx(f,{}):e.exports.jsx(g,{className:le})]}),renderCell:s=>{var r;let t="Normal",l="success";const a=null==(r=s.status)?void 0:r.toString();return"0"===a||"64"===a?(t="Normal",l="success"):a&&"online"!==a&&"normal"!==a?(t=`Code ${a}`,l="warning"):"online"!==(null==a?void 0:a.toLowerCase())&&"normal"!==(null==a?void 0:a.toLowerCase())||(t="Normal",l="success"),e.exports.jsx(L,{children:!hs(s)&&e.exports.jsx(N,{appearance:"filled",color:l,children:t})})}}),I({columnId:"signalType",renderHeaderCell:()=>e.exports.jsx("div",{className:te,children:e.exports.jsx("span",{children:"Signal Type"})}),renderCell:()=>e.exports.jsx(L,{})}),I({columnId:"type",renderHeaderCell:()=>e.exports.jsx("div",{className:te,children:e.exports.jsx("span",{children:"Type"})}),renderCell:s=>{const r="0"===s.digitalAnalog;return e.exports.jsx(L,{children:!hs(s)&&e.exports.jsx(N,{appearance:"outline",color:r?"informative":"brand",children:r?"Digital":"Analog"})})}})];return e.exports.jsxs("div",{className:W,children:[e.exports.jsx("div",{className:D,children:e.exports.jsx("div",{className:E,children:e.exports.jsx("div",{className:F,children:e.exports.jsxs("div",{className:T,children:[ke&&e.exports.jsxs("div",{className:he,children:[e.exports.jsx(n,{className:me}),e.exports.jsx(i,{className:je,children:ke})]}),be&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:H,children:e.exports.jsxs("div",{className:R,children:[e.exports.jsxs("button",{className:M,onClick:async()=>{if(be){We(!0),Ie("Refreshing inputs from device...","info");try{const e=await m.refreshFromDevice({serialNumber:be.serialNumber,type:"input",onLoadingChange:e=>{e&&Ie("Loading data from device (Action 17)...","info")}});Ie(e.message,"success")}catch(e){const s=e instanceof Error?e.message:"Failed to refresh from device";$e(s),Ie(s,"error")}finally{await Pe(),We(!1)}}},disabled:Le,title:"Refresh all inputs from device","aria-label":"Refresh from Device",children:[e.exports.jsx(o,{}),e.exports.jsx("span",{children:Le?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:M,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(d,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:V,role:"separator"}),e.exports.jsxs("button",{className:M,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(c,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:A,children:[e.exports.jsx(u,{className:P}),e.exports.jsx("input",{className:U,type:"text",placeholder:"Search inputs...",value:Qe,onChange:e=>{Xe(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search inputs"})]}),e.exports.jsx(p,{content:`Showing input points for ${be.nameShowOnTree} (SN: ${be.serialNumber}). This table displays all configured input points including digital and analog sensors, their current values, calibration settings, and operational status.`,relationship:"description",children:e.exports.jsx("button",{className:`${M} ${xe}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(x,{})})})]})}),e.exports.jsx("div",{className:fe,children:e.exports.jsx("hr",{className:B})})]}),e.exports.jsxs("div",{className:O,children:[ze&&0===we.length&&e.exports.jsxs("div",{className:Y,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(i,{size:200,weight:"regular",children:"Loading inputs..."})]}),!be&&!ze&&e.exports.jsx("div",{className:G,children:e.exports.jsxs("div",{className:ge,children:[e.exports.jsx(i,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(i,{size:200,children:"Please select a device from the tree to view inputs"})]})}),be&&!ze&&e.exports.jsxs("div",{ref:Re,className:K,onScroll:Be,onWheel:Oe,children:[e.exports.jsxs(w,{items:xs,columns:ms,sortable:!0,resizableColumns:!0,columnSizingOptions:{input:{minWidth:60,defaultWidth:80},panel:{minWidth:60,defaultWidth:75},fullLabel:{minWidth:180,defaultWidth:250},autoManual:{minWidth:90,defaultWidth:120},value:{minWidth:120,defaultWidth:180},units:{minWidth:100,defaultWidth:150},range:{minWidth:80,defaultWidth:100},calibration:{minWidth:80,defaultWidth:100},sign:{minWidth:50,defaultWidth:60},filter:{minWidth:60,defaultWidth:80},status:{minWidth:80,defaultWidth:100},signalType:{minWidth:90,defaultWidth:110},label:{minWidth:130,defaultWidth:170},type:{minWidth:60,defaultWidth:75}},children:[e.exports.jsx(S,{children:e.exports.jsx(z,{children:({renderHeaderCell:s})=>e.exports.jsx(y,{children:s()})})}),e.exports.jsx(k,{children:({item:s,rowId:r})=>e.exports.jsx(z,{children:({renderCell:r})=>e.exports.jsx($,{children:r(s)})},r)})]}),Me&&e.exports.jsxs("div",{className:J,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(i,{size:200,weight:"regular",children:"Loading next device..."})]})]})]})]})})})}),ns&&e.exports.jsx(v,{isOpen:ls,onClose:()=>as(!1),currentRange:ns.range?parseInt(ns.range):0,digitalAnalog:"Digital"===ns.signalType?1:0,onSave:async e=>{if(ns&&be)try{const s=we.find((e=>e.serialNumber===ns.serialNumber&&e.inputIndex===ns.inputIndex));if(!s)throw new Error("Current input data not found");await Ge(be.serialNumber,ns.inputIndex,"range",e.toString(),s),Se((s=>s.map((s=>s.serialNumber===ns.serialNumber&&s.inputIndex===ns.inputIndex?{...s,range:e.toString(),rangeField:e.toString()}:s))))}catch(s){alert(`Failed to update range: ${s instanceof Error?s.message:"Unknown error"}`)}},inputLabel:`Input ${ns.inputIndex||ns.inputId} - ${ns.fullLabel||"Unnamed"}`})]})};export{be as InputsPage,be as default};

import{j as e}from"./react.3bc90b5d.js";import{aO as t,z as r,B as s,aR as o,T as a,h as n,cP as i,$ as l,l as c,u as p,L as d,M as x,R as u,S as f,E as h}from"./App.4ea21eda.js";import{C as g}from"./Card.8c416f8b.js";import{r as m}from"./client.58f92968.js";import{g as j}from"./rangeData.f0c44010.js";import"./index.f111124c.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.f6c34e59.js";import"./_commonjsHelpers.a5007c1f.js";const v=t({appBar:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",backgroundColor:r.colorBrandBackground,color:r.colorNeutralForegroundOnBrand,boxShadow:r.shadow4,position:"sticky",top:0,zIndex:1e3},leftSection:{display:"flex",alignItems:"center",gap:"12px",flex:1},title:{fontSize:r.fontSizeBase400,fontWeight:r.fontWeightSemibold,color:r.colorNeutralForegroundOnBrand},rightSection:{display:"flex",alignItems:"center",gap:"8px"}}),b=({title:t,onBack:l,onRefresh:c,onMore:p,showBack:d=!1,showRefresh:x=!0,showMore:u=!1})=>{const f=v();return e.exports.jsxs("div",{className:f.appBar,children:[e.exports.jsxs("div",{className:f.leftSection,children:[d&&l&&e.exports.jsx(s,{appearance:"transparent",icon:e.exports.jsx(o,{}),onClick:l,style:{color:r.colorNeutralForegroundOnBrand}}),e.exports.jsx(a,{className:f.title,children:t})]}),e.exports.jsxs("div",{className:f.rightSection,children:[x&&c&&e.exports.jsx(s,{appearance:"transparent",icon:e.exports.jsx(n,{}),onClick:c,style:{color:r.colorNeutralForegroundOnBrand}}),u&&p&&e.exports.jsx(s,{appearance:"transparent",icon:e.exports.jsx(i,{}),onClick:p,style:{color:r.colorNeutralForegroundOnBrand}})]})]})},N=t({layout:{display:"flex",flexDirection:"column",height:"100vh",width:"100vw",backgroundColor:r.colorNeutralBackground1,overflow:"hidden"},content:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px",WebkitOverflowScrolling:"touch"},contentNoPadding:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch"}}),y=({children:t,appBarProps:r,noPadding:s=!1})=>{const o=N();return e.exports.jsxs("div",{className:o.layout,children:[r&&e.exports.jsx(b,{...r}),e.exports.jsx("div",{className:s?o.contentNoPadding:o.content,children:t})]})},w=t({card:{marginBottom:"12px",cursor:"pointer","&:active":{transform:"scale(0.98)",transition:"transform 0.1s ease"}},cardContent:{padding:"12px 16px"},row:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},titleContainer:{flex:1},label:{fontSize:r.fontSizeBase300,color:r.colorNeutralForeground2,fontWeight:r.fontWeightSemibold},value:{fontSize:r.fontSizeBase400,color:r.colorNeutralForeground1,fontWeight:r.fontWeightRegular},valueWithUnit:{display:"flex",alignItems:"baseline",gap:"4px"},unit:{fontSize:r.fontSizeBase200,color:r.colorNeutralForeground3},badge:{marginLeft:"8px"},subtitle:{display:"block",color:r.colorNeutralForeground3},actions:{display:"flex",gap:"8px",justifyContent:"flex-end",marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.colorNeutralStroke2}`}}),S=({title:t,subtitle:r,value:o,unit:i,status:p,badge:d,onTap:x,onRefresh:u,refreshing:f=!1,children:h})=>{const m=w();return e.exports.jsx(g,{className:m.card,onClick:x,appearance:"filled-alternative",children:e.exports.jsxs("div",{className:m.cardContent,children:[e.exports.jsxs("div",{className:m.row,children:[e.exports.jsxs("div",{className:m.titleContainer,children:[e.exports.jsx(a,{weight:"semibold",size:400,children:t}),r&&e.exports.jsx(a,{size:200,className:m.subtitle,children:r})]}),d&&e.exports.jsx(l,{appearance:"filled",color:"informative",className:m.badge,children:d}),x&&e.exports.jsx(c,{fontSize:20})]}),(void 0!==o||h)&&e.exports.jsx("div",{className:m.row,children:void 0!==o?e.exports.jsxs("div",{className:m.valueWithUnit,children:[e.exports.jsx(a,{className:m.value,children:o}),i&&e.exports.jsx(a,{className:m.unit,children:i})]}):h}),p&&e.exports.jsxs("div",{className:m.row,children:[e.exports.jsx(a,{className:m.label,children:"Status"}),e.exports.jsx(a,{className:m.value,children:p})]}),u&&e.exports.jsx("div",{className:m.actions,children:e.exports.jsx(s,{appearance:"subtle",icon:e.exports.jsx(n,{}),onClick:e=>{e.stopPropagation(),u()},disabled:f,children:f?"Refreshing...":"Refresh"})})]})})},I=t({container:{paddingBottom:"24px"},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"48px 24px",textAlign:"center",gap:"16px"},errorState:{display:"flex",flexDirection:"column",alignItems:"center",padding:"24px",textAlign:"center",gap:"12px"},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:"48px"},cardList:{display:"flex",flexDirection:"column",gap:"0"},deviceInfo:{padding:"12px 16px",backgroundColor:r.colorNeutralBackground2,borderRadius:r.borderRadiusMedium,marginBottom:"16px"}}),F=()=>{const t=I(),{inputs:o,loading:i,error:l,refreshing:c,refreshingItems:g,selectedDevice:v,handleRefresh:b,handleRefreshFromDevice:N,handleRefreshSingleInput:w}=(()=>{const{selectedDevice:e}=p(),t=d((e=>e.setMessage)),[r,s]=m.exports.useState([]),[o,a]=m.exports.useState(!1),[n,i]=m.exports.useState(null),[l,c]=m.exports.useState(!1),[f,h]=m.exports.useState(new Set),[g,j]=m.exports.useState(!1),v=m.exports.useRef(!1),b=m.exports.useCallback((async()=>{if(e){a(!0),i(null);try{const t=`${x}/api/t3_device/devices/${e.serialNumber}/input-points`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch inputs: ${r.statusText}`);const o=(await r.json()).input_points||[];s(o)}catch(t){const e=t instanceof Error?t.message:"Failed to load inputs";i(e)}finally{a(!1)}}else s([])}),[e]);return m.exports.useEffect((()=>{s([]),j(!1),v.current=!1}),[null==e?void 0:e.serialNumber]),m.exports.useEffect((()=>{o||!e||g||v.current||(async()=>{if(v.current=!0,r.length>0)j(!0);else{a(!0);try{const r=await u.refreshFromDevice({serialNumber:e.serialNumber,type:"input",onLoadingChange:r=>{r&&t(`Loading inputs from ${e.nameShowOnTree} (Action 17)...`,"info")}});t(`✓ Synced ${r.itemCount} inputs from ${e.nameShowOnTree}`,"success")}catch(s){t(`Failed to sync inputs: ${s instanceof Error?s.message:"Unknown error"}`,"error")}finally{await b(),j(!0),a(!1)}}})()}),[o,e,g,b,r.length,t]),m.exports.useEffect((()=>{b()}),[b]),{inputs:r,loading:o,error:n,refreshing:l,refreshingItems:f,selectedDevice:e,fetchInputs:b,handleRefresh:async()=>{c(!0),await b(),c(!1)},handleRefreshFromDevice:async()=>{if(e){c(!0),t("Refreshing inputs from device...","info");try{const r=await u.refreshFromDevice({serialNumber:e.serialNumber,type:"input",onLoadingChange:e=>{e&&t("Loading data from device (Action 17)...","info")}});t(r.message,"success")}catch(r){const e=r instanceof Error?r.message:"Failed to refresh from device";i(e),t(e,"error")}finally{await b(),c(!1)}}},handleRefreshSingleInput:async t=>{if(!e)return;const r=parseInt(t,10);if(!isNaN(r)){h((e=>new Set(e).add(t)));try{await u.refreshSingleInput(e.serialNumber,r),await b()}catch(s){}finally{h((e=>{const r=new Set(e);return r.delete(t),r}))}}},updateInputField:async(t,r,o,a)=>{var n,i;if(e)try{const l={fullLabel:"fullLabel"===r?o:a.fullLabel||"",label:"label"===r?o:a.label||"",value:"fValue"===r?parseFloat(o||"0"):parseFloat(a.fValue||"0")/1e3,range:"range"===r?parseInt(o||"0",10):parseInt(a.rangeField||a.range||"0",10),autoManual:"autoManual"===r?parseInt(o||"0",10):parseInt(a.autoManual||"0",10),control:0,filter:parseInt(a.filterField||"0",10),digitalAnalog:parseInt(a.digitalAnalog||"0",10),calibrationSign:parseInt(a.sign||"0",10),calibrationH:parseInt((null==(n=a.calibration)?void 0:n.split(".")[0])||"0",10),calibrationL:parseInt((null==(i=a.calibration)?void 0:i.split(".")[1])||"0",10),decom:0},c=await fetch(`${x}/api/t3_device/inputs/${e.serialNumber}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!c.ok){const e=await c.text();throw new Error(`HTTP ${c.status}: ${e}`)}const p=await c.json();return s((e=>e.map((e=>e.inputIndex===t?{...e,[r]:"fValue"===r?(1e3*parseFloat(o||"0")).toString():o}:e)))),p}catch(l){throw l}}}})();return i&&0===o.length?e.exports.jsx(y,{appBarProps:{title:"Inputs",showRefresh:!1},children:e.exports.jsx("div",{className:t.loadingContainer,children:e.exports.jsx(f,{label:"Loading inputs...",size:"large"})})}):l&&0===o.length?e.exports.jsx(y,{appBarProps:{title:"Inputs",onRefresh:b},children:e.exports.jsxs("div",{className:t.errorState,children:[e.exports.jsx(h,{fontSize:48,color:r.colorPaletteRedForeground1}),e.exports.jsx(a,{size:400,weight:"semibold",children:"Failed to load inputs"}),e.exports.jsx(a,{size:300,style:{color:r.colorNeutralForeground3},children:l}),e.exports.jsx(s,{appearance:"primary",icon:e.exports.jsx(n,{}),onClick:b,children:"Try Again"})]})}):v?0===o.length?e.exports.jsx(y,{appBarProps:{title:"Inputs",onRefresh:N},children:e.exports.jsxs("div",{className:t.emptyState,children:[e.exports.jsx(a,{size:500,weight:"semibold",children:"No Inputs Found"}),e.exports.jsx(a,{size:300,style:{color:r.colorNeutralForeground3},children:"Tap refresh to load inputs from device"}),e.exports.jsx(s,{appearance:"primary",icon:e.exports.jsx(n,{}),onClick:N,disabled:c,children:c?"Refreshing...":"Refresh from Device"})]})}):e.exports.jsx(y,{appBarProps:{title:`Inputs (${o.length})`,onRefresh:N},children:e.exports.jsxs("div",{className:t.container,children:[e.exports.jsxs("div",{className:t.deviceInfo,children:[e.exports.jsx(a,{size:300,weight:"semibold",style:{display:"block",marginBottom:"4px"},children:"Device"}),e.exports.jsx(a,{size:400,children:v.nameShowOnTree}),e.exports.jsxs(a,{size:200,style:{color:r.colorNeutralForeground3,display:"block"},children:["SN: ",v.serialNumber]})]}),e.exports.jsx("div",{className:t.cardList,children:o.map((t=>{const r=g.has(t.inputIndex||""),s=parseInt(t.rangeField||t.range||"0",10),o=parseInt(t.digitalAnalog||"0",10),a=j(s,o);return e.exports.jsx(S,{title:t.fullLabel||t.label||`Input ${t.inputIndex}`,subtitle:`#${t.inputIndex} • ${a}`,value:t.fValue?(parseFloat(t.fValue)/1e3).toFixed(2):"N/A",unit:t.units,status:"1"===t.autoManual?"Manual":"Auto",onRefresh:()=>w(t.inputIndex||""),refreshing:r},`${t.serialNumber}-${t.inputIndex}`)}))})]})}):e.exports.jsx(y,{appBarProps:{title:"Inputs"},children:e.exports.jsxs("div",{className:t.emptyState,children:[e.exports.jsx(a,{size:500,weight:"semibold",children:"No Device Selected"}),e.exports.jsx(a,{size:300,style:{color:r.colorNeutralForeground3},children:"Please select a device from the tree to view inputs"})]})})};export{F as InputsPageMobile};

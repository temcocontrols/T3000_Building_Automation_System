import{ab as e,aY as a,aO as s,a_ as l,aS as o,a as t,Q as n,T as i,g as r,bD as u,a6 as c,h as d,o as m,a1 as g,a8 as b,a9 as f,a2 as p,a4 as v,u as y}from"./index.1af70167.js";import{Q as S}from"./QPage.0e95dcd5.js";import{u as h}from"./use-quasar.76055695.js";import{u as j,g as k,b as w}from"./common.c9804b89.js";import{a as x}from"./api.5a19c015.js";import"./index.d11c4764.js";var _=e({name:"QInnerLoading",props:{...a,...s,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:a}){const s=r(),c=l(e,s.proxy.$q),{transitionProps:d,transitionStyle:m}=o(e),g=t((()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(!0===c.value?" q-inner-loading--dark":""))),b=t((()=>"q-inner-loading__label"+(void 0!==e.labelClass?` ${e.labelClass}`:"")));function f(){return!0===e.showing?n("div",{class:g.value,style:m.value},void 0!==a.default?a.default():function(){const a=[n(u,{size:e.size,color:e.color})];return void 0!==e.label&&a.push(n("div",{class:b.value,style:e.labelStyle},[e.label])),a}()):null}return()=>n(i,d.value,f)}});const q={key:1},L={__name:"LoginPage",setup(e){const a=c(),s=h(),l=d(null),o=d(!1);return m((()=>{new WebSocket({}.API_WS_URL).onmessage=({data:e})=>{var t;if("hello"===(e=JSON.parse(e)).type){l.value=e.cid;const a={}.API_URL+"/login?cid="+l.value;x.post("login",{json:{url:a}})}else"token"===e.type&&(o.value=!0,j.value=e.user,localStorage.setItem("user",JSON.stringify(j.value)),x.post("user",{json:{token:e.token,id:e.user.id,name:e.user.name}}),s.cookies.set("token",e.token,{expires:360,sameSite:"Strict",secure:!0}),"OFFLINE"===(null==(t=k())?void 0:t.syncData)&&s.notify({message:"Offline mode enabled, data will not be synced, you can change that from settings.",color:"warning",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{}}]}),a.replace({path:w.value.home}))}})),(e,a)=>(g(),b(S,{class:"flex items-center justify-center"},{default:f((()=>[o.value?(g(),p("div",q,"Logged in as "+v(y(j).name),1)):(g(),b(_,{key:0,showing:!0,label:"Waiting for the login in the browser window...","label-class":"text-teal","label-style":"font-size: 1.1em"}))])),_:1}))}};export{L as default};

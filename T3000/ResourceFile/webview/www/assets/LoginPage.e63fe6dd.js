import{b as h,aJ as S,af as k,aK as p,aj as _,d,h as u,ao as w,g as x,bw as I,a0 as C,y as f,m as P,o as c,c as b,w as q,K as L,R as D,M as Q}from"./index.a446fa3f.js";import{Q as R}from"./QPage.be1b2b29.js";import{u as j,a as y}from"./api.1a67fc33.js";import{g as O}from"./common.a643a366.js";import{u as g}from"./T3Data.b51b73fb.js";var z=h({name:"QInnerLoading",props:{...S,...k,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(t,{slots:s}){const a=x(),o=p(t,a.proxy.$q),{transitionProps:l,transitionStyle:r}=_(t),e=d(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(o.value===!0?" q-inner-loading--dark":"")),i=d(()=>"q-inner-loading__label"+(t.labelClass!==void 0?` ${t.labelClass}`:""));function n(){const m=[u(I,{size:t.size,color:t.color})];return t.label!==void 0&&m.push(u("div",{class:i.value,style:t.labelStyle},[t.label])),m}function v(){return t.showing===!0?u("div",{class:e.value,style:r.value},s.default!==void 0?s.default():n()):null}return()=>u(w,l.value,v)}});const A={key:1},U={__name:"LoginPage",setup(t){const s=C(),a=j(),o=f(null),l=f(!1);return P(()=>{const r=new WebSocket({}.API_WS_URL);r.onmessage=({data:e})=>{var i;if(e=JSON.parse(e),e.type==="hello"){o.value=e.cid;const n={}.API_URL+"/login?cid="+o.value;y.post("login",{json:{url:n}})}else if(e.type==="token"){l.value=!0,g.value=e.user,localStorage.setItem("user",JSON.stringify(g.value)),y.post("user",{json:{token:e.token,id:e.user.id,name:e.user.name}}),a.cookies.set("token",e.token,{expires:360,sameSite:"Strict",secure:!0}),((i=O())==null?void 0:i.syncData)==="OFFLINE"&&a.notify({message:"Offline mode enabled, data will not be synced, you can change that from settings.",color:"warning",timeout:0,actions:[{label:"Dismiss",color:"white",handler:()=>{}}]});const n=s.currentRoute.value.query.redirect||"/apps-library";s.replace({path:n})}}}),(r,e)=>(c(),b(R,{class:"flex items-center justify-center"},{default:q(()=>[l.value?(c(),L("div",A,"Logged in as "+D(Q(g).name),1)):(c(),b(z,{key:0,showing:!0,label:"Waiting for the login in the browser window...","label-class":"text-teal","label-style":"font-size: 1.1em"}))]),_:1}))}};export{U as default};

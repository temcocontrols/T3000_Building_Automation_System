import{h as e,a,g as l,bl as t,aU as n,br as o,Q as i,a7 as s,c5 as u,bg as r,bc as d,be as c,bh as p,c6 as m,bx as f,bd as v,bj as g,bi as b,Y as h,Z as T,$ as _,c as E,a5 as y,ao as C,ax as x,au as k,ap as D,an as S,a4 as A,a0 as N,C as V,a1 as I,av as R,ay as F,ar as w}from"./index.2479820c.js";import{Q as L}from"./QBadge.5da94d60.js";import{Q as U}from"./QChip.9c9048aa.js";import{h as O}from"./format.b9446fb2.js";import{u as z}from"./use-quasar.5414ee75.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";function X(e,a,l,t){const n=[];return e.forEach((e=>{!0===t(e)?n.push(e):a.push({failedPropValidation:l,file:e})})),n}function P(e){(null==e?void 0:e.dataTransfer)&&(e.dataTransfer.dropEffect="copy"),n(e)}var j=s({name:"QFile",inheritAttrs:!1,props:{...u,...r,...{multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...d,"rejected"],setup(s,{slots:u,emit:r,attrs:d}){const{proxy:h}=l(),T=c(),_=e(null),E=e(!1),y=p(s),{pickFiles:C,onDragover:x,onDragleave:k,processFiles:D,getDndNode:S}=function({editable:s,dnd:u,getFileInput:r,addFilesToQueue:d}){const{props:c,emit:p,proxy:m}=l(),f=e(null),v=a((()=>void 0!==c.accept?c.accept.split(",").map((e=>"*"===(e=e.trim())?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null)),g=a((()=>parseInt(c.maxFiles,10))),b=a((()=>parseInt(c.maxTotalSize,10)));function h(e){var a;if(s.value)if(e!==Object(e)&&(e={target:null}),!0===(null==(a=e.target)?void 0:a.matches('input[type="file"]')))0===e.clientX&&0===e.clientY&&t(e);else{const a=r();a!==e.target&&(null==a||a.click(e))}}function T(e){s.value&&e&&d(null,e)}function _(e){n(e),!0==(null!==e.relatedTarget||!0!==o.is.safari?e.relatedTarget!==f.value:!1===document.elementsFromPoint(e.clientX,e.clientY).includes(f.value))&&(u.value=!1)}function E(e){P(e);const a=e.dataTransfer.files;0!==a.length&&d(null,a),u.value=!1}return Object.assign(m,{pickFiles:h,addFiles:T}),{pickFiles:h,addFiles:T,onDragover:function(e){P(e),!0!==u.value&&(u.value=!0)},onDragleave:_,processFiles:function(e,a,l,t){let n=Array.from(a||e.target.files);const o=[],i=()=>{0!==o.length&&p("rejected",o)};if(void 0!==c.accept&&-1===v.value.indexOf("*/")&&(n=X(n,o,"accept",(e=>v.value.some((a=>e.type.toUpperCase().startsWith(a)||e.name.toUpperCase().endsWith(a))))),0===n.length))return i();if(void 0!==c.maxFileSize){const e=parseInt(c.maxFileSize,10);if(n=X(n,o,"max-file-size",(a=>a.size<=e)),0===n.length)return i()}if(!0!==c.multiple&&0!==n.length&&(n=[n[0]]),n.forEach((e=>{e.__key=e.webkitRelativePath+e.lastModified+e.name+e.size})),!0===t){const e=l.map((e=>e.__key));n=X(n,o,"duplicate",(a=>!1===e.includes(a.__key)))}if(0===n.length)return i();if(void 0!==c.maxTotalSize){let e=!0===t?l.reduce(((e,a)=>e+a.size),0):0;if(n=X(n,o,"max-total-size",(a=>(e+=a.size,e<=b.value))),0===n.length)return i()}if("function"==typeof c.filter){const e=c.filter(n);n=X(n,o,"filter",(a=>e.includes(a)))}if(void 0!==c.maxFiles){let e=!0===t?l.length:0;if(n=X(n,o,"max-files",(()=>(e++,e<=g.value))),0===n.length)return i()}return i(),0!==n.length?n:void 0},getDndNode:function(e){if(!0===u.value)return i("div",{ref:f,class:`q-${e}__dnd absolute-full`,onDragenter:P,onDragover:P,onDragleave:_,onDrop:E})},maxFilesNumber:g,maxTotalSizeNumber:b}}({editable:T.editable,dnd:E,getFileInput:B,addFilesToQueue:Y}),A=m(s),N=a((()=>Object(s.modelValue)===s.modelValue?"length"in s.modelValue?Array.from(s.modelValue):[s.modelValue]:[])),V=a((()=>g(N.value))),I=a((()=>N.value.map((e=>e.name)).join(", "))),R=a((()=>O(N.value.reduce(((e,a)=>e+a.size),0)))),F=a((()=>({totalSize:R.value,filesNumber:N.value.length,maxFiles:s.maxFiles}))),w=a((()=>({tabindex:-1,type:"file",title:"",accept:s.accept,capture:s.capture,name:y.value,...d,id:T.targetUid.value,disabled:!0!==T.editable.value}))),L=a((()=>"q-file q-field--auto-height"+(!0===E.value?" q-file--dnd":""))),z=a((()=>!0===s.multiple&&!0===s.append));function M(e){const a=N.value.slice();a.splice(e,1),j(a)}function j(e){r("update:modelValue",!0===s.multiple?e:e[0])}function q(e){13===e.keyCode&&b(e)}function G(e){13!==e.keyCode&&32!==e.keyCode||C(e)}function B(){return _.value}function Y(e,a){const l=D(e,a,N.value,z.value),t=B();null!=t&&(t.value=""),void 0!==l&&((!0===s.multiple?s.modelValue&&l.every((e=>N.value.includes(e))):s.modelValue===l[0])||j(!0===z.value?N.value.concat(l):l))}function $(){return[i("input",{class:[s.inputClass,"q-file__filler"],style:s.inputStyle})]}function Q(){const e={ref:_,...w.value,...A.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:Y};return!0===s.multiple&&(e.multiple=!0),i("input",e)}return Object.assign(T,{fieldClass:L,emitValue:j,hasValue:V,inputRef:_,innerValue:N,floatingLabel:a((()=>!0===V.value||g(s.displayValue))),computedCounter:a((()=>{if(void 0!==s.counterLabel)return s.counterLabel(F.value);const e=s.maxFiles;return`${N.value.length}${void 0!==e?" / "+e:""} (${R.value})`})),getControlChild:()=>S("file"),getControl:()=>{const e={ref:T.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:s.tabindex};return!0===T.editable.value&&Object.assign(e,{onDragover:x,onDragleave:k,onKeydown:q,onKeyup:G}),i("div",e,[Q()].concat(function(){if(void 0!==u.file)return 0===N.value.length?$():N.value.map(((e,a)=>u.file({index:a,file:e,ref:this})));if(void 0!==u.selected)return 0===N.value.length?$():u.selected({files:N.value,ref:this});if(!0===s.useChips)return 0===N.value.length?$():N.value.map(((e,a)=>i(U,{key:"file-"+a,removable:T.editable.value,dense:!0,textColor:s.color,tabindex:s.tabindex,onRemove:()=>{M(a)}},(()=>i("span",{class:"ellipsis",textContent:e.name})))));const e=void 0!==s.displayValue?s.displayValue:I.value;return 0!==e.length?[i("div",{class:s.inputClass,style:s.inputStyle,textContent:e})]:$()}()))}}),Object.assign(h,{removeAtIndex:M,removeFile:function(e){const a=N.value.indexOf(e);-1!==a&&M(a)},getNativeElement:()=>_.value}),f(h,"nativeEl",(()=>_.value)),v(T)}});const q={class:"database-tools-panel"},G={class:"tools-grid"},B={class:"tool-header"},Y={class:"tool-header"},$={class:"tool-header"},Q={class:"tool-header"},K={class:"tool-header"},W={class:"tool-header"},J={class:"operation-result"},Z={class:"result-header"},H={class:"operation-name"},ee={class:"result-details"},ae={key:0},le={class:"schema-text"};var te=M({name:"ManagementToolsPanel",setup(){const a=z(),l=e({vacuum:!1,analyze:!1,backup:!1,indexes:!1}),t=e(null),n=e(!1),o=e(!1),i=e(!1),s=e(!1),u=e(!1),r=e(null),d=e({autoVacuum:!0,autoBackup:!0,autoCleanup:!0,backupRetentionDays:30}),c=e("\n-- Database Schema\nCREATE TABLE APPLICATION_SETTINGS (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    category TEXT NOT NULL,\n    setting_key TEXT NOT NULL,\n    setting_value TEXT,\n    data_type TEXT DEFAULT 'string',\n    description TEXT,\n    user_id INTEGER,\n    device_serial INTEGER,\n    panel_id INTEGER,\n    is_read_only INTEGER DEFAULT 0,\n    expires_at TEXT,\n    created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    created_by TEXT DEFAULT 'SYSTEM'\n);\n\nCREATE TABLE DATABASE_PARTITIONS (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    table_name TEXT NOT NULL,\n    partition_type TEXT NOT NULL,\n    partition_identifier TEXT NOT NULL,\n    partition_start_date TEXT,\n    partition_end_date TEXT,\n    record_count INTEGER DEFAULT 0,\n    size_bytes INTEGER DEFAULT 0,\n    is_active INTEGER DEFAULT 1,\n    auto_cleanup_enabled INTEGER DEFAULT 1,\n    retention_days INTEGER DEFAULT 30,\n    created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    last_cleanup_at TEXT,\n    metadata TEXT\n);\n\n-- Indexes\nCREATE INDEX IDX_APP_SETTINGS_CATEGORY ON APPLICATION_SETTINGS(category);\nCREATE INDEX IDX_APP_SETTINGS_KEY ON APPLICATION_SETTINGS(category, setting_key);\n-- ... (additional indexes)\n    "),p=async(e,n)=>{const o=Date.now();try{l.value[n]=!0,await new Promise((e=>setTimeout(e,2e3)));const i=Date.now()-o;t.value={name:e,success:!0,duration:i,timestamp:(new Date).toLocaleString(),message:`${e} completed successfully`},a.notify({type:"positive",message:`${e} completed successfully`})}catch(i){const l=Date.now()-o;t.value={name:e,success:!1,duration:l,timestamp:(new Date).toLocaleString(),message:i.message},a.notify({type:"negative",message:`${e} failed: ${i.message}`})}finally{l.value[n]=!1}};return{operations:l,lastOperation:t,showRestoreDialog:n,showScheduleDialog:o,showSchema:i,showIndexes:s,showJobs:u,restoreFile:r,schedule:d,schemaText:c,runVacuum:()=>p("VACUUM","vacuum"),runAnalyze:()=>p("ANALYZE","analyze"),rebuildIndexes:()=>p("Rebuild Indexes","indexes"),createBackup:async()=>{await p("Create Backup","backup")},restoreDatabase:()=>{a.dialog({title:"Confirm Restore",message:"This will replace the current database. Are you sure?",cancel:!0,persistent:!0}).onOk((()=>{a.notify({type:"info",message:"Database restore initiated..."}),n.value=!1,r.value=null}))},exportSettings:()=>{a.notify({type:"info",message:"Exporting application settings..."})},exportAll:()=>{a.notify({type:"info",message:"Exporting all data..."})},generateDDL:()=>{a.notify({type:"info",message:"DDL generated and copied to clipboard"})},saveSchedule:()=>{a.notify({type:"positive",message:"Maintenance schedule saved"}),o.value=!1},copySchema:()=>{navigator.clipboard.writeText(c.value),a.notify({type:"positive",message:"Schema copied to clipboard"})}}}},[["render",function(e,a,l,t,n,o){return h(),T("div",q,[a[35]||(a[35]=_("div",{class:"page-header"},[_("h2",null,"Database Management Tools"),_("p",null,"Database maintenance, optimization, and backup utilities")],-1)),_("div",G,[E(S,{flat:"",bordered:"",class:"tool-card"},{default:y((()=>[E(C,null,{default:y((()=>[_("div",B,[E(x,{name:"speed",size:"2rem",color:"primary"}),a[16]||(a[16]=_("div",{class:"tool-title"},"Database Optimization",-1))]),a[17]||(a[17]=_("div",{class:"tool-description"}," Optimize database performance and reclaim unused space ",-1))])),_:1}),E(k,null,{default:y((()=>[E(D,{color:"primary",label:"Run VACUUM",onClick:t.runVacuum,loading:t.operations.vacuum},null,8,["onClick","loading"]),E(D,{color:"secondary",label:"ANALYZE",onClick:t.runAnalyze,loading:t.operations.analyze},null,8,["onClick","loading"])])),_:1})])),_:1}),E(S,{flat:"",bordered:"",class:"tool-card"},{default:y((()=>[E(C,null,{default:y((()=>[_("div",Y,[E(x,{name:"backup",size:"2rem",color:"positive"}),a[18]||(a[18]=_("div",{class:"tool-title"},"Backup & Restore",-1))]),a[19]||(a[19]=_("div",{class:"tool-description"}," Create database backups and restore from existing backups ",-1))])),_:1}),E(k,null,{default:y((()=>[E(D,{color:"positive",label:"Create Backup",onClick:t.createBackup,loading:t.operations.backup},null,8,["onClick","loading"]),E(D,{color:"warning",label:"Restore",onClick:a[0]||(a[0]=e=>t.showRestoreDialog=!0)})])),_:1})])),_:1}),E(S,{flat:"",bordered:"",class:"tool-card"},{default:y((()=>[E(C,null,{default:y((()=>[_("div",$,[E(x,{name:"account_tree",size:"2rem",color:"secondary"}),a[20]||(a[20]=_("div",{class:"tool-title"},"Index Management",-1))]),a[21]||(a[21]=_("div",{class:"tool-description"}," Manage database indexes for optimal query performance ",-1))])),_:1}),E(k,null,{default:y((()=>[E(D,{color:"secondary",label:"Rebuild Indexes",onClick:t.rebuildIndexes,loading:t.operations.indexes},null,8,["onClick","loading"]),E(D,{flat:"",label:"View Indexes",onClick:a[1]||(a[1]=e=>t.showIndexes=!0)})])),_:1})])),_:1}),E(S,{flat:"",bordered:"",class:"tool-card"},{default:y((()=>[E(C,null,{default:y((()=>[_("div",Q,[E(x,{name:"file_download",size:"2rem",color:"info"}),a[22]||(a[22]=_("div",{class:"tool-title"},"Data Export",-1))]),a[23]||(a[23]=_("div",{class:"tool-description"}," Export database contents to various formats ",-1))])),_:1}),E(k,null,{default:y((()=>[E(D,{color:"info",label:"Export Settings",onClick:t.exportSettings},null,8,["onClick"]),E(D,{flat:"",label:"Export All",onClick:t.exportAll},null,8,["onClick"])])),_:1})])),_:1}),E(S,{flat:"",bordered:"",class:"tool-card"},{default:y((()=>[E(C,null,{default:y((()=>[_("div",K,[E(x,{name:"schema",size:"2rem",color:"deep-orange"}),a[24]||(a[24]=_("div",{class:"tool-title"},"Schema Management",-1))]),a[25]||(a[25]=_("div",{class:"tool-description"}," View and manage database schema structure ",-1))])),_:1}),E(k,null,{default:y((()=>[E(D,{color:"deep-orange",label:"View Schema",onClick:a[2]||(a[2]=e=>t.showSchema=!0)}),E(D,{flat:"",label:"Generate DDL",onClick:t.generateDDL},null,8,["onClick"])])),_:1})])),_:1}),E(S,{flat:"",bordered:"",class:"tool-card"},{default:y((()=>[E(C,null,{default:y((()=>[_("div",W,[E(x,{name:"schedule",size:"2rem",color:"purple"}),a[26]||(a[26]=_("div",{class:"tool-title"},"Maintenance Schedule",-1))]),a[27]||(a[27]=_("div",{class:"tool-description"}," Configure automated maintenance tasks ",-1))])),_:1}),E(k,null,{default:y((()=>[E(D,{color:"purple",label:"Configure",onClick:a[3]||(a[3]=e=>t.showScheduleDialog=!0)}),E(D,{flat:"",label:"View Jobs",onClick:a[4]||(a[4]=e=>t.showJobs=!0)})])),_:1})])),_:1})]),t.lastOperation?(h(),A(S,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:y((()=>[E(C,null,{default:y((()=>[a[31]||(a[31]=_("div",{class:"text-h6 q-mb-sm"},"Last Operation Result",-1)),_("div",J,[_("div",Z,[_("span",H,N(t.lastOperation.name),1),E(L,{color:t.lastOperation.success?"positive":"negative",label:t.lastOperation.success?"Success":"Failed"},null,8,["color","label"])]),_("div",ee,[_("div",null,[a[28]||(a[28]=_("strong",null,"Duration:",-1)),V(" "+N(t.lastOperation.duration)+"ms",1)]),_("div",null,[a[29]||(a[29]=_("strong",null,"Time:",-1)),V(" "+N(t.lastOperation.timestamp),1)]),t.lastOperation.message?(h(),T("div",ae,[a[30]||(a[30]=_("strong",null,"Message:",-1)),V(" "+N(t.lastOperation.message),1)])):I("",!0)])])])),_:1})])),_:1})):I("",!0),E(R,{modelValue:t.showRestoreDialog,"onUpdate:modelValue":a[7]||(a[7]=e=>t.showRestoreDialog=e),persistent:""},{default:y((()=>[E(S,{style:{width:"400px"}},{default:y((()=>[E(C,null,{default:y((()=>[...a[32]||(a[32]=[_("div",{class:"text-h6"},"Restore Database",-1),_("div",{class:"text-caption text-warning q-mt-sm"}," Warning: This will replace the current database! ",-1)])])),_:1}),E(C,null,{default:y((()=>[E(j,{modelValue:t.restoreFile,"onUpdate:modelValue":a[5]||(a[5]=e=>t.restoreFile=e),label:"Select backup file",accept:".db,.sqlite,.sql",outlined:""},null,8,["modelValue"])])),_:1}),E(k,{align:"right"},{default:y((()=>[E(D,{flat:"",label:"Cancel",onClick:a[6]||(a[6]=e=>t.showRestoreDialog=!1)}),E(D,{color:"warning",label:"Restore",onClick:t.restoreDatabase,disable:!t.restoreFile},null,8,["onClick","disable"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),E(R,{modelValue:t.showScheduleDialog,"onUpdate:modelValue":a[13]||(a[13]=e=>t.showScheduleDialog=e),persistent:""},{default:y((()=>[E(S,{style:{width:"500px"}},{default:y((()=>[E(C,null,{default:y((()=>[...a[33]||(a[33]=[_("div",{class:"text-h6"},"Maintenance Schedule",-1)])])),_:1}),E(C,null,{default:y((()=>[E(F,{modelValue:t.schedule.autoVacuum,"onUpdate:modelValue":a[8]||(a[8]=e=>t.schedule.autoVacuum=e),label:"Auto VACUUM (Weekly)",class:"q-mb-md"},null,8,["modelValue"]),E(F,{modelValue:t.schedule.autoBackup,"onUpdate:modelValue":a[9]||(a[9]=e=>t.schedule.autoBackup=e),label:"Auto Backup (Daily)",class:"q-mb-md"},null,8,["modelValue"]),E(F,{modelValue:t.schedule.autoCleanup,"onUpdate:modelValue":a[10]||(a[10]=e=>t.schedule.autoCleanup=e),label:"Auto Cleanup (Daily)",class:"q-mb-md"},null,8,["modelValue"]),E(w,{modelValue:t.schedule.backupRetentionDays,"onUpdate:modelValue":a[11]||(a[11]=e=>t.schedule.backupRetentionDays=e),label:"Backup Retention (Days)",type:"number",outlined:"",class:"q-mt-md"},null,8,["modelValue"])])),_:1}),E(k,{align:"right"},{default:y((()=>[E(D,{flat:"",label:"Cancel",onClick:a[12]||(a[12]=e=>t.showScheduleDialog=!1)}),E(D,{color:"primary",label:"Save",onClick:t.saveSchedule},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),E(R,{modelValue:t.showSchema,"onUpdate:modelValue":a[15]||(a[15]=e=>t.showSchema=e),maximized:""},{default:y((()=>[E(S,null,{default:y((()=>[E(C,null,{default:y((()=>[...a[34]||(a[34]=[_("div",{class:"text-h6"},"Database Schema",-1)])])),_:1}),E(C,{class:"schema-content"},{default:y((()=>[_("pre",le,N(t.schemaText),1)])),_:1}),E(k,{align:"right"},{default:y((()=>[E(D,{flat:"",label:"Close",onClick:a[14]||(a[14]=e=>t.showSchema=!1)}),E(D,{color:"primary",label:"Copy",onClick:t.copySchema},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}],["__scopeId","data-v-81dbd002"]]);export{te as default};

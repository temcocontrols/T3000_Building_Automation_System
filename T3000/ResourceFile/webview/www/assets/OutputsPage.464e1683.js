var e=Object.defineProperty;import{j as t}from"./react.2da10d74.js";import{r as s,R as a}from"./client.b9d1bbf8.js";import{B as l,M as r,T as o,R as n,N as i,A as d,w as c,x as p,y as u,z as x,S as h,C as g,D as m,I as y,F as j,H as v,J as b,K as f,L as N}from"./App.2c62e2d1.js";import{D as _,a as w}from"./DrawerBody.3013704d.js";import{D as C,a as S,R as k}from"./DrawerHeaderTitle.9bf254d7.js";import{I}from"./Input.16f797a0.js";import{c as D,D as T,a as V,b as $,d as O,e as E,f as P,T as H}from"./DataGridHeaderCell.34491fc4.js";import{S as W}from"./Switch.411cd684.js";import{B as L}from"./Badge.bfe12ada.js";import"./index.5672de35.js";import"./Serializer.f6a5f515.js";import"./useDialogSurfaceContextValues.45ba7119.js";import"./useDialogTitleStyles.styles.836f5a4a.js";import"./useFocusableGroup.6d334b5b.js";const z=[{value:0,label:"Unused",unit:"",category:"General"},{value:1,label:"0.0 -> 10",unit:"Volts",category:"Voltage"},{value:2,label:"0.0 -> 100",unit:"%Open",category:"Percentage"},{value:3,label:"4 -> 20",unit:"psi",category:"Pressure"},{value:4,label:"0.0 -> 100",unit:"%",category:"Percentage"},{value:5,label:"0.0 -> 100",unit:"%Cls",category:"Percentage"},{value:6,label:"4 -> 20",unit:"ma",category:"Current"},{value:7,label:"0.0 -> 100",unit:"PWM",category:"PWM"},{value:8,label:"2 -> 10",unit:"Volts",category:"Voltage"}],F=[{value:0,label:"Unused",category:"General"},{value:1,label:"Off/On",category:"Standard"},{value:2,label:"Close/Open",category:"Standard"},{value:3,label:"Stop/Start",category:"Standard"},{value:4,label:"Disable/Enable",category:"Standard"},{value:5,label:"Normal/Alarm",category:"Standard"},{value:6,label:"Normal/High",category:"Standard"},{value:7,label:"Normal/Low",category:"Standard"},{value:8,label:"No/Yes",category:"Standard"},{value:9,label:"Cool/Heat",category:"Standard"},{value:10,label:"Unoccupy/Occupy",category:"Standard"},{value:11,label:"Low/High",category:"Standard"},{value:12,label:"On/Off",category:"Standard"},{value:13,label:"Open/Close",category:"Standard"},{value:14,label:"Start/Stop",category:"Standard"},{value:15,label:"Enable/Disable",category:"Standard"},{value:16,label:"Alarm/Normal",category:"Standard"},{value:17,label:"High/Normal",category:"Standard"},{value:18,label:"Low/Normal",category:"Standard"},{value:19,label:"Yes/No",category:"Standard"},{value:20,label:"Heat/Cool",category:"Standard"},{value:21,label:"Occupy/Unoccupy",category:"Standard"},{value:22,label:"High/Low",category:"Standard"},{value:23,label:"Custom Digital 1",category:"Custom"},{value:24,label:"Custom Digital 2",category:"Custom"},{value:25,label:"Custom Digital 3",category:"Custom"},{value:26,label:"Custom Digital 4",category:"Custom"},{value:27,label:"Custom Digital 5",category:"Custom"},{value:28,label:"Custom Digital 6",category:"Custom"},{value:29,label:"Custom Digital 7",category:"Custom"},{value:30,label:"Custom Digital 8",category:"Custom"}];function R(e,t){const s={23:"9/9",24:"/",25:"/",26:"/",27:"/",28:"/",29:"/",30:"/"};if(s.hasOwnProperty(e))return s[e];const a=function(e){return 1===e?F:z}(t),l=a.find((t=>t.value===e));return l?l.label:"Unknown"}var U="_drawerHeader_k2oy1_5",A="_headerContent_k2oy1_15",B="_drawerTitle_k2oy1_29",M="_inputLabelHeader_k2oy1_41",K="_drawerBody_k2oy1_53",J="_topCombinedSection_k2oy1_73",G="_defaultColumn_k2oy1_97",Y="_selectionColumn_k2oy1_109",Z="_sectionDivider_k2oy1_123",q="_dividerText_k2oy1_175",Q="_topSection_k2oy1_191",X="_inputLabel_k2oy1_41",ee="_numberInput_k2oy1_231",te="_currentLabel_k2oy1_331",se="_actionButtons_k2oy1_361",ae="_saveButton_k2oy1_395",le="_defaultSection_k2oy1_407",re="_digitalSection_k2oy1_425",oe="_analogSection_k2oy1_447",ne="_analogColumns_k2oy1_461",ie="_column_k2oy1_473",de="_sectionHeader_k2oy1_485",ce="_sectionTitle_k2oy1_505",pe="_rangeGroup_k2oy1_541",ue="_rangeGroupTwoColumn_k2oy1_557",xe="_rangeOption_k2oy1_577",he="_editButton_k2oy1_685",ge="_mainContent_k2oy1_779";const me=({isOpen:e,onClose:d,currentRange:c,digitalAnalog:p,onSave:u,inputLabel:x})=>{const[h,g]=s.exports.useState(c),[m,y]=s.exports.useState(c.toString()),j=()=>{g(c),y(c.toString()),d()};a.useEffect((()=>{e&&(g(c),y(c.toString()))}),[e,c]);const v=R(h,(b=h)>=1&&b<=30?1:0);var b;return t.exports.jsxs(_,{type:"overlay",separator:!0,open:e,onOpenChange:(e,{open:t})=>!t&&j(),position:"end",size:"large",style:{width:"1000px",maxWidth:"90vw"},children:[t.exports.jsx(C,{className:U,children:t.exports.jsx(S,{action:t.exports.jsx(l,{appearance:"subtle","aria-label":"Close",icon:t.exports.jsx(r,{}),onClick:j}),children:t.exports.jsxs("div",{className:A,children:[t.exports.jsx(o,{size:300,weight:"semibold",className:B,children:"Select Range Number"}),x&&t.exports.jsx(o,{size:200,className:M,children:x})]})})}),t.exports.jsxs(w,{className:K,children:[t.exports.jsxs("div",{className:J,children:[t.exports.jsxs("div",{className:G,children:[t.exports.jsx("div",{className:Z,children:t.exports.jsx("span",{className:q,children:"Default"})}),t.exports.jsx("div",{className:le,children:t.exports.jsx(k,{value:h.toString(),onChange:(e,t)=>g(Number(t.value)),children:t.exports.jsx(n,{value:"0",label:"0. Unused"})})})]}),t.exports.jsxs("div",{className:Y,children:[t.exports.jsx("div",{className:Z,children:t.exports.jsx("span",{className:q,children:"Selection"})}),t.exports.jsxs("div",{className:Q,children:[t.exports.jsx(i,{className:X,children:"Enter Range Number (0-30):"}),t.exports.jsx(I,{type:"number",value:m,onChange:(e,t)=>(e=>{y(e);const t=parseInt(e,10);!isNaN(t)&&t>=0&&t<=30&&g(t)})(t.value),className:ee,min:0,max:30}),t.exports.jsx("div",{className:te,children:v}),t.exports.jsxs("div",{className:se,children:[t.exports.jsx(l,{appearance:"primary",onClick:()=>{u(h),d()},className:ae,children:"OK"}),t.exports.jsx(l,{appearance:"secondary",onClick:j,children:"Cancel"})]})]})]})]}),t.exports.jsx("div",{className:Z,children:t.exports.jsx("span",{className:q,children:"Digital"})}),t.exports.jsx(k,{value:h.toString(),onChange:(e,t)=>g(Number(t.value)),children:t.exports.jsx("div",{className:ge,children:t.exports.jsxs("div",{className:re,children:[t.exports.jsxs("div",{className:ie,children:[t.exports.jsx("div",{className:de,children:t.exports.jsx(o,{weight:"semibold",size:300,className:ce,children:"Digital Units"})}),t.exports.jsx("div",{className:ue,children:F.filter((e=>e.value>=1&&e.value<=22)).map((e=>t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:e.value.toString(),label:`${e.value}. ${e.label}`})},e.value)))})]}),t.exports.jsxs("div",{className:ie,children:[t.exports.jsxs("div",{className:de,children:[t.exports.jsx(o,{weight:"semibold",size:300,className:ce,children:"Custom Digital Units"}),t.exports.jsx(l,{appearance:"primary",className:he,children:"Edit"})]}),t.exports.jsxs("div",{className:pe,children:[t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"23",label:"23. 9/9"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"24",label:"24. /"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"25",label:"25. /"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"26",label:"26. /"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"27",label:"27. /"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"28",label:"28. /"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"29",label:"29. /"})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"30",label:"30. /"})})]})]}),t.exports.jsxs("div",{className:ie,children:[t.exports.jsxs("div",{className:de,children:[t.exports.jsx(o,{weight:"semibold",size:300,className:ce,children:"Multi State"}),t.exports.jsx(l,{appearance:"primary",className:he,children:"Edit"})]}),t.exports.jsxs("div",{className:pe,children:[t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"100",label:""})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"101",label:""})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"102",label:""})}),t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:"103",label:""})})]})]})]})})}),t.exports.jsx("div",{className:Z,children:t.exports.jsx("span",{className:q,children:"Output Analog Units"})}),t.exports.jsx(k,{value:h.toString(),onChange:(e,t)=>g(Number(t.value)),children:t.exports.jsx("div",{className:oe,children:t.exports.jsx("div",{className:ne,children:t.exports.jsxs("div",{className:ie,children:[t.exports.jsx("div",{className:de,children:t.exports.jsx(o,{weight:"semibold",size:300,className:ce,children:"Analog Ranges"})}),t.exports.jsx("div",{className:pe,children:z.filter((e=>e.value>=1&&e.value<=8)).map((e=>t.exports.jsx("div",{className:xe,children:t.exports.jsx(n,{value:e.value.toString(),label:`${e.value}. ${e.label} ${e.unit}`})},e.value)))})]})})})})]})]})};class ye{static async refreshOutput(e,t){try{const s=await fetch(`${this.baseUrl}/outputs/${e}/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:t})});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e||s.statusText}`)}return await s.json()}catch(s){throw s}}static async refreshAllOutputs(e){try{const t=await fetch(`${this.baseUrl}/outputs/${e}/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!t.ok){const e=await t.text();throw new Error(`HTTP ${t.status}: ${e||t.statusText}`)}return await t.json()}catch(t){throw t}}static async saveRefreshedOutputs(e,t){try{const s=await fetch(`${this.baseUrl}/outputs/${e}/save-refreshed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t})});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e||s.statusText}`)}return await s.json()}catch(s){throw s}}}var je,ve;ve=`${d}/api/t3_device`,((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(ye,"symbol"!=typeof(je="baseUrl")?je+"":je,ve);var be="_container_1y0yk_35",fe="_bladeContentContainer_1y0yk_59",Ne="_bladeContentWrapper_1y0yk_75",_e="_bladeContent_1y0yk_59",we="_partContent_1y0yk_107",Ce="_toolbar_1y0yk_125",Se="_toolbarContainer_1y0yk_143",ke="_toolbarButton_1y0yk_159",Ie="_toolbarSeparator_1y0yk_237",De="_searchInputWrapper_1y0yk_253",Te="_searchIcon_1y0yk_267",Ve="_searchInput_1y0yk_253",$e="_overviewHr_1y0yk_387",Oe="_dockingBody_1y0yk_403",Ee="_scrollContainer_1y0yk_421",Pe="_noData_1y0yk_443",He="_loadingBar_1y0yk_461",We="_autoLoadIndicator_1y0yk_489",Le="_editableCell_1y0yk_777",ze="_editInput_1y0yk_805",Fe="_saveButton_1y0yk_877",Re="_refreshIconButton_1y0yk_939",Ue="_isRefreshing_1y0yk_1009",Ae="_rotating_1y0yk_1041";const Be=()=>{const{selectedDevice:e,treeData:a,selectDevice:r,getNextDevice:n,getFilteredDevices:i}=c(),[_,w]=s.exports.useState([]),[C,S]=s.exports.useState(!1),[k,I]=s.exports.useState(null),[z,F]=s.exports.useState(!1),[U,A]=s.exports.useState(new Set),[B,M]=s.exports.useState(!1),K=s.exports.useRef(null),[J,G]=s.exports.useState(!1),Y=s.exports.useRef(!1);s.exports.useEffect((()=>{if(!e&&a.length>0){const e=i();if(e.length>0){const t=e[0];r(t)}}}),[e,a,r,i]);const Z=s.exports.useCallback((async()=>{if(e){S(!0),I(null);try{const t=`${d}/api/t3_device/devices/${e.serialNumber}/output-points`,s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch outputs: ${s.statusText}`);const a=(await s.json()).output_points||[];w(a)}catch(t){const e=t instanceof Error?t.message:"Failed to load outputs";I(e)}finally{S(!1)}}else w([])}),[e]);s.exports.useEffect((()=>{Z()}),[Z]),s.exports.useEffect((()=>{if(C||!e||B)return;const t=setTimeout((async()=>{try{const t=await ye.refreshAllOutputs(e.serialNumber);t.items&&t.items.length>0&&(await ye.saveRefreshedOutputs(e.serialNumber,t.items),await Z()),M(!0)}catch(t){M(!0)}}),500);return()=>clearTimeout(t)}),[C,e,B,Z]);const q=s.exports.useCallback((async()=>{const e=n();e&&(G(!0),r(e),setTimeout((()=>{G(!1)}),500))}),[n,r]),Q=s.exports.useCallback((e=>{if(J||C)return;const t=e.currentTarget;t.scrollHeight-t.scrollTop-t.clientHeight<=1&&_.length>0?Y.current=!0:Y.current=!1}),[J,C,_.length]),X=s.exports.useCallback((e=>{J||C||0===_.length||e.deltaY>0&&Y.current&&(Y.current=!1,q())}),[J,C,_.length,q]);s.exports.useEffect((()=>{e&&K.current&&K.current.scrollTo({top:0,behavior:J?"smooth":"auto"})}),[e,J]);const ee=(e,t,s)=>{oe({serialNumber:e.serialNumber,outputIndex:e.outputIndex||"",field:t}),ie(s||"")},te=async()=>{if(re)if("fValue"===re.field||ne.trim()){ce(!0);try{if(e&&["fullLabel","fValue"].includes(re.field)){const t=_.find((e=>e.serialNumber===re.serialNumber&&e.outputIndex===re.outputIndex));if(!t)throw new Error("Current output data not found");const s={fullLabel:"fullLabel"===re.field?ne:t.fullLabel||"",label:t.label||"",value:"fValue"===re.field?parseFloat(ne||"0"):parseFloat(t.fValue||"0"),range:parseInt(t.range||"0"),autoManual:parseInt(t.autoManual||"0"),control:0,lowVoltage:parseFloat(t.lowVoltage||"0"),highVoltage:parseFloat(t.highVoltage||"0"),pwmPeriod:parseInt(t.pwmPeriod||"0")},a=await fetch(`${d}/api/t3_device/outputs/${e.serialNumber}/${re.outputIndex}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const e=await a.text();throw new Error(`HTTP ${a.status}: ${e}`)}await a.json()}w((e=>e.map((e=>e.serialNumber===re.serialNumber&&e.outputIndex===re.outputIndex?{...e,[re.field]:ne}:e)))),oe(null)}catch(t){alert(`Failed to update: ${t instanceof Error?t.message:"Unknown error"}`)}finally{ce(!1)}}else oe(null);else oe(null)},se=e=>{"Enter"===e.key?(e.preventDefault(),te()):"Escape"===e.key&&(e.preventDefault(),oe(null),ie(""))},[ae,le]=s.exports.useState(""),[re,oe]=s.exports.useState(null),[ne,ie]=s.exports.useState(""),[de,ce]=s.exports.useState(!1),[pe,ue]=s.exports.useState(!1),[xe,he]=s.exports.useState(null),[ge,je]=s.exports.useState(null),[ve,Be]=s.exports.useState("ascending"),Me=e=>{ge===e?Be("ascending"===ve?"descending":"ascending"):(je(e),Be("ascending"))},Ke=[D({columnId:"panel",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("panel"),children:[t.exports.jsx("span",{children:"Panel"}),"panel"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>t.exports.jsx(H,{children:e.panel||"---"})}),D({columnId:"output",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("output"),children:[t.exports.jsx("span",{children:"Output"}),"output"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:s=>{const a=U.has(s.outputIndex||"");return t.exports.jsx(H,{children:t.exports.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.exports.jsx("button",{onClick:t=>{t.stopPropagation(),(async t=>{if(!e)return;const s=parseInt(t,10);if(!isNaN(s)){A((e=>new Set(e).add(t)));try{const a=await ye.refreshOutput(e.serialNumber,s);a.items&&a.items.length>0&&await ye.saveRefreshedOutputs(e.serialNumber,a.items),await Z()}catch(a){}finally{A((e=>{const s=new Set(e);return s.delete(t),s}))}}})(s.outputIndex||"")},className:`${Re} ${a?Ue:""}`,title:"Refresh this output from device",disabled:a,children:t.exports.jsx(u,{style:{fontSize:"14px"},className:a?Ae:""})}),t.exports.jsx(o,{size:200,weight:"regular",children:s.outputId||s.outputIndex||"---"})]})})}}),D({columnId:"fullLabel",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("fullLabel"),children:[t.exports.jsx("span",{children:"Full Label"}),"fullLabel"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{const s=(null==re?void 0:re.serialNumber)===e.serialNumber&&(null==re?void 0:re.outputIndex)===e.outputIndex&&"fullLabel"===(null==re?void 0:re.field);return t.exports.jsx(H,{children:s?t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:[t.exports.jsx("input",{type:"text",className:ze,value:ne,onChange:e=>ie(e.target.value),onBlur:te,onKeyDown:se,autoFocus:!0,disabled:de,placeholder:"Enter label","aria-label":"Edit full label",style:{flex:1}}),t.exports.jsx("button",{onClick:e=>{e.stopPropagation(),te()},disabled:de,className:Fe,title:"Save",children:t.exports.jsx(N,{style:{fontSize:"18px"}})})]}):t.exports.jsx("div",{className:Le,onDoubleClick:()=>ee(e,"fullLabel",e.fullLabel||""),title:"Double-click to edit",children:t.exports.jsx(o,{size:200,weight:"regular",children:e.fullLabel||"Unnamed"})})})}}),D({columnId:"label",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("label"),children:[t.exports.jsx("span",{children:"Label"}),"label"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{const s=(null==re?void 0:re.serialNumber)===e.serialNumber&&(null==re?void 0:re.outputIndex)===e.outputIndex&&"label"===(null==re?void 0:re.field);return t.exports.jsx(H,{children:s?t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:[t.exports.jsx("input",{type:"text",className:ze,value:ne,onChange:e=>ie(e.target.value),onBlur:te,onKeyDown:se,autoFocus:!0,disabled:de,placeholder:"Enter label","aria-label":"Edit label",style:{flex:1}}),t.exports.jsx("button",{onClick:e=>{e.stopPropagation(),te()},disabled:de,className:Fe,title:"Save",children:t.exports.jsx(N,{style:{fontSize:"18px"}})})]}):t.exports.jsx("div",{className:Le,onDoubleClick:()=>ee(e,"label",e.label||""),title:"Double-click to edit",children:t.exports.jsx(o,{size:200,weight:"regular",children:e.label||"---"})})})}}),D({columnId:"autoManual",renderHeaderCell:()=>t.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:t.exports.jsx("span",{children:"Auto/Man"})}),renderCell:e=>{var s;const a=null==(s=e.autoManual)?void 0:s.toString().toLowerCase(),l="auto"===a||"1"===a;return t.exports.jsx(H,{children:t.exports.jsx("div",{onClick:async()=>{const t=l?"0":"1";try{const s=_.find((t=>t.serialNumber===e.serialNumber&&t.outputIndex===e.outputIndex));if(!s)throw new Error("Current output data not found");const a={fullLabel:s.fullLabel||"",label:s.label||"",value:parseFloat(s.fValue||"0"),range:parseInt(s.range||"0"),autoManual:parseInt(t),control:0,lowVoltage:parseFloat(s.lowVoltage||"0"),highVoltage:parseFloat(s.highVoltage||"0"),pwmPeriod:parseInt(s.pwmPeriod||"0")},l=await fetch(`${d}/api/t3_device/outputs/${e.serialNumber}/${e.outputIndex}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){const e=await l.text();throw new Error(`HTTP ${l.status}: ${e}`)}await l.json();w((s=>s.map((s=>s.serialNumber===e.serialNumber&&s.outputIndex===e.outputIndex?{...s,autoManual:t}:s))))}catch(s){alert(`Failed to update Auto/Man: ${s instanceof Error?s.message:"Unknown error"}`)}},style:{cursor:"pointer",display:"flex",alignItems:"center"},children:t.exports.jsx(W,{checked:l,style:{transform:"scale(0.8)"}})})})}}),D({columnId:"hoaSwitch",renderHeaderCell:()=>t.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:t.exports.jsx("span",{children:"HOA Switch"})}),renderCell:e=>{var s;const a=(null==(s=e.hwSwitchStatus)?void 0:s.toString())||"1";let l="AUTO",r="success";return"0"===a?(l="MAN-OFF",r="danger"):"2"===a?(l="MAN-ON",r="warning"):(l="AUTO",r="success"),t.exports.jsx(H,{children:t.exports.jsx(L,{appearance:"filled",color:r,size:"small",children:l})})}}),D({columnId:"value",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("value"),children:[t.exports.jsx("span",{children:"Value"}),"value"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{const s=(null==re?void 0:re.serialNumber)===e.serialNumber&&(null==re?void 0:re.outputIndex)===e.outputIndex&&"fValue"===(null==re?void 0:re.field);return t.exports.jsx(H,{children:s?t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:[t.exports.jsx("input",{type:"number",step:"0.01",className:ze,value:ne,onChange:e=>ie(e.target.value),onBlur:te,onKeyDown:se,autoFocus:!0,disabled:de,placeholder:"Enter value","aria-label":"Edit value",style:{flex:1}}),t.exports.jsx("button",{onClick:e=>{e.stopPropagation(),te()},disabled:de,className:Fe,title:"Save",children:t.exports.jsx(N,{style:{fontSize:"18px"}})})]}):t.exports.jsx("div",{className:Le,onDoubleClick:()=>{var t;return ee(e,"fValue",(null==(t=e.fValue)?void 0:t.toString())||"0")},title:"Double-click to edit",children:t.exports.jsx(o,{size:200,weight:"regular",children:e.fValue||"---"})})})}}),D({columnId:"units",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("units"),children:[t.exports.jsx("span",{children:"Units"}),"units"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>t.exports.jsx(H,{children:e.units||"---"})}),D({columnId:"range",compare:(e,t)=>{const s=e.range||"",a=t.range||"";return s.localeCompare(a)},renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("range"),children:[t.exports.jsx("span",{children:"Range"}),"range"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{const s=R(e.range?parseInt(e.range):0,"Digital"===e.signalType?1:0);return t.exports.jsx(H,{children:t.exports.jsx("div",{onClick:()=>(e=>{he(e),ue(!0)})(e),style:{cursor:"pointer",color:"#0078d4",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:"Click to change range",children:t.exports.jsx(o,{size:200,weight:"regular",children:s})})})}}),D({columnId:"lowVoltage",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("lowVoltage"),children:[t.exports.jsx("span",{children:"Low V"}),"lowVoltage"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{const s=(null==re?void 0:re.serialNumber)===e.serialNumber&&(null==re?void 0:re.outputIndex)===e.outputIndex&&"lowVoltage"===(null==re?void 0:re.field);return t.exports.jsx(H,{children:s?t.exports.jsx("input",{type:"number",step:"0.01",className:ze,value:ne,onChange:e=>ie(e.target.value),onBlur:te,onKeyDown:se,autoFocus:!0,disabled:de,placeholder:"Enter voltage","aria-label":"Edit low voltage"}):t.exports.jsx("div",{className:Le,onDoubleClick:()=>{var t;return ee(e,"lowVoltage",(null==(t=e.lowVoltage)?void 0:t.toString())||"0")},title:"Double-click to edit",children:t.exports.jsx(o,{size:200,weight:"regular",children:e.lowVoltage||"---"})})})}}),D({columnId:"highVoltage",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("highVoltage"),children:[t.exports.jsx("span",{children:"High V"}),"highVoltage"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{const s=(null==re?void 0:re.serialNumber)===e.serialNumber&&(null==re?void 0:re.outputIndex)===e.outputIndex&&"highVoltage"===(null==re?void 0:re.field);return t.exports.jsx(H,{children:s?t.exports.jsx("input",{type:"number",step:"0.01",className:ze,value:ne,onChange:e=>ie(e.target.value),onBlur:te,onKeyDown:se,autoFocus:!0,disabled:de,placeholder:"Enter voltage","aria-label":"Edit high voltage"}):t.exports.jsx("div",{className:Le,onDoubleClick:()=>{var t;return ee(e,"highVoltage",(null==(t=e.highVoltage)?void 0:t.toString())||"0")},title:"Double-click to edit",children:t.exports.jsx(o,{size:200,weight:"regular",children:e.highVoltage||"---"})})})}}),D({columnId:"pwmPeriod",renderHeaderCell:()=>t.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:t.exports.jsx("span",{children:"PWM Period"})}),renderCell:e=>{const s=(null==re?void 0:re.serialNumber)===e.serialNumber&&(null==re?void 0:re.outputIndex)===e.outputIndex&&"pwmPeriod"===(null==re?void 0:re.field);return t.exports.jsx(H,{children:s?t.exports.jsx("input",{type:"number",step:"1",className:ze,value:ne,onChange:e=>ie(e.target.value),onBlur:te,onKeyDown:se,autoFocus:!0,disabled:de,placeholder:"Enter period","aria-label":"Edit PWM period"}):t.exports.jsx("div",{className:Le,onDoubleClick:()=>{var t;return ee(e,"pwmPeriod",(null==(t=e.pwmPeriod)?void 0:t.toString())||"0")},title:"Double-click to edit",children:t.exports.jsx(o,{size:200,weight:"regular",children:e.pwmPeriod||"---"})})})}}),D({columnId:"status",renderHeaderCell:()=>t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Me("status"),children:[t.exports.jsx("span",{children:"Status"}),"status"===ge?"ascending"===ve?t.exports.jsx(v,{}):t.exports.jsx(b,{}):t.exports.jsx(f,{style:{opacity:.5}})]}),renderCell:e=>{var s;let a="Normal",l="success";const r=null==(s=e.status)?void 0:s.toString();return"0"===r||"64"===r?(a="Normal",l="success"):r&&"online"!==r&&"normal"!==r?(a=`Code ${r}`,l="warning"):"online"!==(null==r?void 0:r.toLowerCase())&&"normal"!==(null==r?void 0:r.toLowerCase())||(a="Normal",l="success"),t.exports.jsx(H,{children:t.exports.jsx(L,{appearance:"filled",color:l,children:a})})}}),D({columnId:"signalType",renderHeaderCell:()=>t.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:t.exports.jsx("span",{children:"Type"})}),renderCell:e=>{let s="Virtual",a="success";switch(e.typeField||"0"){case"0":default:s="Virtual",a="success";break;case"1":s="Digital",a="informative";break;case"2":s="Analog",a="brand";break;case"3":s="Extend Digital",a="informative";break;case"4":s="Extend Analog",a="brand";break;case"5":s="Internal",a="warning"}return t.exports.jsx(H,{children:t.exports.jsx(L,{appearance:"outline",color:a,children:s})})}})];return t.exports.jsxs("div",{className:be,children:[t.exports.jsx("div",{className:fe,children:t.exports.jsx("div",{className:Ne,children:t.exports.jsx("div",{className:_e,children:t.exports.jsxs("div",{className:we,children:[k&&t.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[t.exports.jsx(p,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),t.exports.jsx(o,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:k})]}),e&&t.exports.jsx("div",{className:Ce,children:t.exports.jsxs("div",{className:Se,children:[t.exports.jsxs("button",{className:ke,onClick:async()=>{if(e){F(!0);try{const t=await ye.refreshAllOutputs(e.serialNumber);if(t.items&&t.items.length>0){await ye.saveRefreshedOutputs(e.serialNumber,t.items);await Z()}}catch(t){I(t instanceof Error?t.message:"Failed to refresh from device")}finally{F(!1)}}},disabled:z,title:"Refresh all outputs from device","aria-label":"Refresh from Device",children:[t.exports.jsx(u,{}),t.exports.jsx("span",{children:z?"Refreshing...":"Refresh from Device"})]}),t.exports.jsxs("button",{className:ke,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[t.exports.jsx(x,{}),t.exports.jsx("span",{children:"Export to CSV"})]}),t.exports.jsx("div",{className:Ie,role:"separator"}),t.exports.jsxs("button",{className:ke,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[t.exports.jsx(h,{}),t.exports.jsx("span",{children:"Settings"})]}),t.exports.jsxs("div",{className:De,children:[t.exports.jsx(g,{className:Te}),t.exports.jsx("input",{className:Ve,type:"text",placeholder:"Search outputs...",value:ae,onChange:e=>{le(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search outputs"})]}),t.exports.jsx(m,{content:`Showing output points for ${e.nameShowOnTree} (SN: ${e.serialNumber}). This table displays all configured output points including digital and analog outputs, their current values, voltage settings, and operational status.`,relationship:"description",children:t.exports.jsx("button",{className:ke,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:t.exports.jsx(y,{})})})]})}),t.exports.jsx("div",{style:{padding:"0"},children:t.exports.jsx("hr",{className:$e})}),t.exports.jsxs("div",{className:Oe,children:[C&&0===_.length&&t.exports.jsxs("div",{className:He,children:[t.exports.jsx(j,{size:"tiny"}),t.exports.jsx(o,{size:200,weight:"regular",children:"Loading outputs..."})]}),!e&&!C&&t.exports.jsx("div",{className:Pe,children:t.exports.jsxs("div",{style:{textAlign:"center"},children:[t.exports.jsx(o,{size:500,weight:"semibold",children:"No device selected"}),t.exports.jsx("br",{}),t.exports.jsx(o,{size:300,children:"Please select a device from the tree to view outputs"})]})}),e&&!C&&t.exports.jsxs("div",{ref:K,className:Ee,onScroll:Q,onWheel:X,children:[t.exports.jsxs(T,{items:_,columns:Ke,sortable:!0,resizableColumns:!0,columnSizingOptions:{output:{minWidth:60,defaultWidth:80},panel:{minWidth:60,defaultWidth:75},fullLabel:{minWidth:150,defaultWidth:200},autoManual:{minWidth:90,defaultWidth:120},hoaSwitch:{minWidth:80,defaultWidth:120},value:{minWidth:100,defaultWidth:140},units:{minWidth:100,defaultWidth:150},range:{minWidth:80,defaultWidth:120},lowVoltage:{minWidth:80,defaultWidth:100},highVoltage:{minWidth:80,defaultWidth:100},pwmPeriod:{minWidth:90,defaultWidth:120},status:{minWidth:80,defaultWidth:100},signalType:{minWidth:60,defaultWidth:80},label:{minWidth:130,defaultWidth:170}},children:[t.exports.jsx(V,{children:t.exports.jsx($,{children:({renderHeaderCell:e})=>t.exports.jsx(O,{children:e()})})}),t.exports.jsx(E,{children:({item:e,rowId:s})=>t.exports.jsx($,{children:({renderCell:s})=>t.exports.jsx(P,{children:s(e)})},s)})]}),J&&t.exports.jsxs("div",{className:We,children:[t.exports.jsx(j,{size:"tiny"}),t.exports.jsx(o,{size:200,weight:"regular",children:"Loading next device..."})]}),0===_.length&&t.exports.jsxs("div",{style:{marginTop:"24px",textAlign:"center",padding:"0 20px"},children:[t.exports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"8px"},children:[t.exports.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{opacity:.5},children:t.exports.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4ZM10 8V16H14V8H10Z",fill:"currentColor"})}),t.exports.jsx(o,{size:400,weight:"semibold",children:"No outputs found"})]}),t.exports.jsx(o,{size:300,style:{display:"block",marginBottom:"16px",color:"#605e5c",textAlign:"center"},children:"This device has no configured output points"}),t.exports.jsx(l,{appearance:"subtle",icon:t.exports.jsx(u,{}),onClick:async()=>{F(!0),await Z(),F(!1)},style:{minWidth:"120px",fontWeight:"normal"},children:"Refresh"})]})]})]})]})})})}),xe&&t.exports.jsx(me,{isOpen:pe,onClose:()=>ue(!1),currentRange:xe.range?parseInt(xe.range):0,digitalAnalog:"Digital"===xe.signalType?1:0,onSave:async e=>{if(xe)try{const t={fullLabel:xe.fullLabel||"",label:xe.label||"",value:parseFloat(xe.fValue||"0"),range:e,autoManual:parseInt(xe.autoManual||"0"),control:0,lowVoltage:parseFloat(xe.lowVoltage||"0"),highVoltage:parseFloat(xe.highVoltage||"0"),pwmPeriod:parseInt(xe.pwmPeriod||"0")},s=await fetch(`${d}/api/t3_device/outputs/${xe.serialNumber}/${xe.outputIndex}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e}`)}await s.json();w((t=>t.map((t=>t.serialNumber===xe.serialNumber&&t.outputIndex===xe.outputIndex?{...t,range:e.toString()}:t))))}catch(t){alert(`Failed to update Range: ${t instanceof Error?t.message:"Unknown error"}`)}},inputLabel:`Output ${xe.outputIndex||xe.outputId} - ${xe.fullLabel||"Unnamed"}`})]})};export{Be as OutputsPage,Be as default};

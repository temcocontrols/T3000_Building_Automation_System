import{j as e}from"./react.8639cc86.js";import{r as a,R as s}from"./client.58f92968.js";import{a0 as t,a1 as l,a2 as r,B as o,a3 as n,T as i,a4 as c,a5 as u,a6 as d,l as p,L as x,M as h,n as g,y as m,N as v,z as j,P as b,Q as _,I as N,S as f,R as y,U as C,V as w,X as S,Y as I,Z as k,$}from"./App.7c34790a.js";import{R as V}from"./RadioGroup.bf5be0e5.js";import{I as D}from"./Input.7691f421.js";import{c as P,D as O,a as F,b as E,d as L,e as q,f as T}from"./DataGridHeaderCell.ec45a911.js";import{T as A}from"./TableCellLayout.d4b0b796.js";import"./index.3bd6c859.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.63f93fe7.js";import"./_commonjsHelpers.a5007c1f.js";const W=[{value:0,label:"Unused",unit:"",category:"General"},{value:1,label:"0.0 -> 10",unit:"Volts",category:"Voltage"},{value:2,label:"0.0 -> 100",unit:"%Open",category:"Percentage"},{value:3,label:"4 -> 20",unit:"psi",category:"Pressure"},{value:4,label:"0.0 -> 100",unit:"%",category:"Percentage"},{value:5,label:"0.0 -> 100",unit:"%Cls",category:"Percentage"},{value:6,label:"4 -> 20",unit:"ma",category:"Current"},{value:7,label:"0.0 -> 100",unit:"PWM",category:"PWM"},{value:8,label:"2 -> 10",unit:"Volts",category:"Voltage"}],H=[{value:0,label:"Unused",category:"General"},{value:1,label:"Off/On",category:"Standard"},{value:2,label:"Close/Open",category:"Standard"},{value:3,label:"Stop/Start",category:"Standard"},{value:4,label:"Disable/Enable",category:"Standard"},{value:5,label:"Normal/Alarm",category:"Standard"},{value:6,label:"Normal/High",category:"Standard"},{value:7,label:"Normal/Low",category:"Standard"},{value:8,label:"No/Yes",category:"Standard"},{value:9,label:"Cool/Heat",category:"Standard"},{value:10,label:"Unoccupy/Occupy",category:"Standard"},{value:11,label:"Low/High",category:"Standard"},{value:12,label:"On/Off",category:"Standard"},{value:13,label:"Open/Close",category:"Standard"},{value:14,label:"Start/Stop",category:"Standard"},{value:15,label:"Enable/Disable",category:"Standard"},{value:16,label:"Alarm/Normal",category:"Standard"},{value:17,label:"High/Normal",category:"Standard"},{value:18,label:"Low/Normal",category:"Standard"},{value:19,label:"Yes/No",category:"Standard"},{value:20,label:"Heat/Cool",category:"Standard"},{value:21,label:"Occupy/Unoccupy",category:"Standard"},{value:22,label:"High/Low",category:"Standard"},{value:23,label:"Custom Digital 1",category:"Custom"},{value:24,label:"Custom Digital 2",category:"Custom"},{value:25,label:"Custom Digital 3",category:"Custom"},{value:26,label:"Custom Digital 4",category:"Custom"},{value:27,label:"Custom Digital 5",category:"Custom"},{value:28,label:"Custom Digital 6",category:"Custom"},{value:29,label:"Custom Digital 7",category:"Custom"},{value:30,label:"Custom Digital 8",category:"Custom"}];function U(e,a){const s={23:"9/9",24:"/",25:"/",26:"/",27:"/",28:"/",29:"/",30:"/"};if(s.hasOwnProperty(e))return s[e];const t=function(e){return 1===e?H:W}(a),l=t.find((a=>a.value===e));return l?l.label:"Unknown"}var R="_drawerHeader_k2oy1_5",M="_headerContent_k2oy1_15",z="_drawerTitle_k2oy1_29",B="_inputLabelHeader_k2oy1_41",K="_drawerBody_k2oy1_53",G="_topCombinedSection_k2oy1_73",Y="_defaultColumn_k2oy1_97",J="_selectionColumn_k2oy1_109",Q="_sectionDivider_k2oy1_123",X="_dividerText_k2oy1_175",Z="_topSection_k2oy1_191",ee="_inputLabel_k2oy1_41",ae="_numberInput_k2oy1_231",se="_currentLabel_k2oy1_331",te="_actionButtons_k2oy1_361",le="_saveButton_k2oy1_395",re="_defaultSection_k2oy1_407",oe="_digitalSection_k2oy1_425",ne="_analogSection_k2oy1_447",ie="_analogColumns_k2oy1_461",ce="_column_k2oy1_473",ue="_sectionHeader_k2oy1_485",de="_sectionTitle_k2oy1_505",pe="_rangeGroup_k2oy1_541",xe="_rangeGroupTwoColumn_k2oy1_557",he="_rangeOption_k2oy1_577",ge="_editButton_k2oy1_685",me="_mainContent_k2oy1_779";const ve=({isOpen:p,onClose:x,currentRange:h,digitalAnalog:g,onSave:m,inputLabel:v})=>{const[j,b]=a.exports.useState(h),[_,N]=a.exports.useState(h.toString()),f=()=>{b(h),N(h.toString()),x()};s.useEffect((()=>{p&&(b(h),N(h.toString()))}),[p,h]);const y=U(j,(C=j)>=1&&C<=30?1:0);var C;return e.exports.jsxs(t,{type:"overlay",separator:!0,open:p,onOpenChange:(e,{open:a})=>!a&&f(),position:"end",size:"large",style:{width:"1000px",maxWidth:"90vw"},children:[e.exports.jsx(l,{className:R,children:e.exports.jsx(r,{action:e.exports.jsx(o,{appearance:"subtle","aria-label":"Close",icon:e.exports.jsx(n,{}),onClick:f}),children:e.exports.jsxs("div",{className:M,children:[e.exports.jsx(i,{size:300,weight:"semibold",className:z,children:"Select Range Number"}),v&&e.exports.jsx(i,{size:200,className:B,children:v})]})})}),e.exports.jsxs(c,{className:K,children:[e.exports.jsxs("div",{className:G,children:[e.exports.jsxs("div",{className:Y,children:[e.exports.jsx("div",{className:Q,children:e.exports.jsx("span",{className:X,children:"Default"})}),e.exports.jsx("div",{className:re,children:e.exports.jsx(V,{value:j.toString(),onChange:(e,a)=>b(Number(a.value)),children:e.exports.jsx(u,{value:"0",label:"0. Unused"})})})]}),e.exports.jsxs("div",{className:J,children:[e.exports.jsx("div",{className:Q,children:e.exports.jsx("span",{className:X,children:"Selection"})}),e.exports.jsxs("div",{className:Z,children:[e.exports.jsx(d,{className:ee,children:"Enter Range Number (0-30):"}),e.exports.jsx(D,{type:"number",value:_,onChange:(e,a)=>(e=>{N(e);const a=parseInt(e,10);!isNaN(a)&&a>=0&&a<=30&&b(a)})(a.value),className:ae,min:0,max:30}),e.exports.jsx("div",{className:se,children:y}),e.exports.jsxs("div",{className:te,children:[e.exports.jsx(o,{appearance:"primary",onClick:()=>{m(j),x()},className:le,children:"OK"}),e.exports.jsx(o,{appearance:"secondary",onClick:f,children:"Cancel"})]})]})]})]}),e.exports.jsx("div",{className:Q,children:e.exports.jsx("span",{className:X,children:"Digital"})}),e.exports.jsx(V,{value:j.toString(),onChange:(e,a)=>b(Number(a.value)),children:e.exports.jsx("div",{className:me,children:e.exports.jsxs("div",{className:oe,children:[e.exports.jsxs("div",{className:ce,children:[e.exports.jsx("div",{className:ue,children:e.exports.jsx(i,{weight:"semibold",size:300,className:de,children:"Digital Units"})}),e.exports.jsx("div",{className:xe,children:H.filter((e=>e.value>=1&&e.value<=22)).map((a=>e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:a.value.toString(),label:`${a.value}. ${a.label}`})},a.value)))})]}),e.exports.jsxs("div",{className:ce,children:[e.exports.jsxs("div",{className:ue,children:[e.exports.jsx(i,{weight:"semibold",size:300,className:de,children:"Custom Digital Units"}),e.exports.jsx(o,{appearance:"primary",className:ge,children:"Edit"})]}),e.exports.jsxs("div",{className:pe,children:[e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"23",label:"23. 9/9"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"24",label:"24. /"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"25",label:"25. /"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"26",label:"26. /"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"27",label:"27. /"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"28",label:"28. /"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"29",label:"29. /"})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"30",label:"30. /"})})]})]}),e.exports.jsxs("div",{className:ce,children:[e.exports.jsxs("div",{className:ue,children:[e.exports.jsx(i,{weight:"semibold",size:300,className:de,children:"Multi State"}),e.exports.jsx(o,{appearance:"primary",className:ge,children:"Edit"})]}),e.exports.jsxs("div",{className:pe,children:[e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"100",label:""})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"101",label:""})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"102",label:""})}),e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:"103",label:""})})]})]})]})})}),e.exports.jsx("div",{className:Q,children:e.exports.jsx("span",{className:X,children:"Output Analog Units"})}),e.exports.jsx(V,{value:j.toString(),onChange:(e,a)=>b(Number(a.value)),children:e.exports.jsx("div",{className:ne,children:e.exports.jsx("div",{className:ie,children:e.exports.jsxs("div",{className:ce,children:[e.exports.jsx("div",{className:ue,children:e.exports.jsx(i,{weight:"semibold",size:300,className:de,children:"Analog Ranges"})}),e.exports.jsx("div",{className:pe,children:W.filter((e=>e.value>=1&&e.value<=8)).map((a=>e.exports.jsx("div",{className:he,children:e.exports.jsx(u,{value:a.value.toString(),label:`${a.value}. ${a.label} ${a.unit}`})},a.value)))})]})})})})]})]})};var je="_container_6a69q_18",be="_bladeContentContainer_6a69q_30",_e="_bladeContentWrapper_6a69q_38",Ne="_bladeContent_6a69q_30",fe="_partContent_6a69q_54",ye="_toolbar_6a69q_63",Ce="_toolbarContainer_6a69q_72",we="_toolbarButton_6a69q_80",Se="_toolbarSeparator_6a69q_119",Ie="_searchInputWrapper_6a69q_127",ke="_searchIcon_6a69q_134",$e="_searchInput_6a69q_127",Ve="_overviewHr_6a69q_194",De="_dockingBody_6a69q_202",Pe="_scrollContainer_6a69q_211",Oe="_noData_6a69q_242",Fe="_loadingBar_6a69q_251",Ee="_autoLoadIndicator_6a69q_265",Le="_editableCell_6a69q_409",qe="_editInput_6a69q_423",Te="_saveButton_6a69q_459",Ae="_refreshIconButton_6a69q_490",We="_isRefreshing_6a69q_525",He="_rotating_6a69q_541",Ue="_headerCellSort_6a69q_546",Re="_headerCell_6a69q_546",Me="_sortIconFaded_6a69q_559",ze="_cellFlexContainer_6a69q_563",Be="_editInputContainer_6a69q_568",Ke="_errorNotice_6a69q_620",Ge="_noPadding_6a69q_646",Ye="_centerText_6a69q_650",Je="_iconSmall_6a69q_672",Qe="_iconMedium_6a69q_676",Xe="_iconError_6a69q_680",Ze="_textError_6a69q_686",ea="_flex1_6a69q_692",aa="_switchScale_6a69q_696",sa="_switchContainer_6a69q_700",ta="_rangeLink_6a69q_706",la="_marginLeft8_6a69q_714";const ra=()=>{const{selectedDevice:t,treeData:l,selectDevice:r,getNextDevice:o,getFilteredDevices:n}=p(),c=x((e=>e.setMessage)),[u,d]=a.exports.useState([]),[V,D]=a.exports.useState(!1),[W,H]=a.exports.useState(null),[R,M]=a.exports.useState(!1),[z,B]=a.exports.useState(new Set),[K,G]=a.exports.useState(!1),Y=a.exports.useRef(!1),J=a.exports.useRef(null),[Q,X]=a.exports.useState(!1),Z=a.exports.useRef(!1),ee=a.exports.useCallback((async()=>{if(t){D(!0),H(null);try{const e=`${h}/api/t3_device/devices/${t.serialNumber}/output-points`,a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch outputs: ${a.statusText}`);const s=(await a.json()).output_points||[];d(s)}catch(e){const a=e instanceof Error?e.message:"Failed to load outputs";H(a),console.error("Error fetching outputs:",e)}finally{D(!1)}}else d([])}),[t]);a.exports.useEffect((()=>{ee()}),[ee]),a.exports.useEffect((()=>{d([]),G(!1),Y.current=!1}),[null==t?void 0:t.serialNumber]),a.exports.useEffect((()=>{if(V||!t||K||Y.current)return;(async()=>{if(Y.current=!0,u.length>0)return console.log("[OutputsPage] Database has data, skipping auto-refresh"),void G(!0);console.log("[OutputsPage] Database empty, auto-refreshing from device..."),D(!0);try{const e=await y.refreshFromDevice({serialNumber:t.serialNumber,type:"output",onLoadingChange:e=>{e&&c(`Loading outputs from ${t.nameShowOnTree} (Action 17)...`,"info")}});console.log("[OutputsPage] Auto-refresh result:",e),c(`✓ Synced ${e.itemCount} outputs from ${t.nameShowOnTree}`,"success")}catch(e){console.error("[OutputsPage] Auto-refresh failed:",e),c(`Failed to sync outputs: ${e instanceof Error?e.message:"Unknown error"}`,"error")}finally{await ee(),G(!0),D(!1)}})()}),[V,t,K,ee,u.length,c]);const ae=a.exports.useCallback((async()=>{const e=o();e?(console.log(`[OutputsPage] Auto-loading next device: ${e.nameShowOnTree} (SN: ${e.serialNumber})`),X(!0),r(e),setTimeout((()=>{X(!1)}),500)):console.log("[OutputsPage] No next device available")}),[o,r]),se=a.exports.useCallback((e=>{if(Q||V)return;const a=e.currentTarget;a.scrollHeight-a.scrollTop-a.clientHeight<=1&&u.length>0?(Z.current=!0,console.log("[OutputsPage] Reached bottom, scroll again to load next device")):Z.current=!1}),[Q,V,u.length]),te=a.exports.useCallback((e=>{Q||V||0===u.length||e.deltaY>0&&Z.current&&(console.log("[OutputsPage] User scrolled down while at bottom, loading next device"),Z.current=!1,ae())}),[Q,V,u.length,ae]);a.exports.useEffect((()=>{t&&J.current&&J.current.scrollTo({top:0,behavior:Q?"smooth":"auto"})}),[t,Q]);const le=(e,a,s)=>{ue({serialNumber:e.serialNumber,outputIndex:e.outputIndex||"",field:a}),pe(s||"")},re=async()=>{if(ce)if("fValue"===ce.field||de.trim()){he(!0);try{if(t&&["fullLabel","fValue"].includes(ce.field)){console.log(`=== Updating ${ce.field} ===`),console.log(`Device: ${t.serialNumber}, Output: ${ce.outputIndex}, New Value: "${de}"`),console.log("Using Action 16 (UPDATE_WEBVIEW_LIST)");const e=u.find((e=>e.serialNumber===ce.serialNumber&&e.outputIndex===ce.outputIndex));if(!e)throw new Error("Current output data not found");console.log("[Action 16] Using current UI state as baseline:",e);const a={fullLabel:"fullLabel"===ce.field?de:e.fullLabel||"",label:e.label||"",value:"fValue"===ce.field?1e3*parseFloat(de||"0"):parseFloat(e.fValue||"0"),range:parseInt(e.range||"0"),autoManual:parseInt(e.autoManual||"0"),control:0,digitalAnalog:parseInt(e.digitalAnalog||"0"),decom:0,lowVoltage:0,highVoltage:0};console.log("[Action 16] Full payload:",a);const s=await fetch(`${h}/api/t3_device/outputs/${t.serialNumber}/${ce.outputIndex}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e}`)}const l=await s.json();console.log(`✅ ${ce.field} updated successfully!`,l)}d((e=>e.map((e=>e.serialNumber===ce.serialNumber&&e.outputIndex===ce.outputIndex?{...e,[ce.field]:"fValue"===ce.field?(1e3*parseFloat(de||"0")).toString():de}:e)))),console.log("Updated",ce.field,":",de,"for",ce),ue(null)}catch(e){console.error("Failed to update:",e),alert(`Failed to update: ${e instanceof Error?e.message:"Unknown error"}`)}finally{he(!1)}}else ue(null);else ue(null)},oe=e=>{"Enter"===e.key?(e.preventDefault(),re()):"Escape"===e.key&&(e.preventDefault(),ue(null),pe(""))},[ne,ie]=a.exports.useState(""),[ce,ue]=a.exports.useState(null),[de,pe]=a.exports.useState(""),[xe,he]=a.exports.useState(!1),[ge,me]=a.exports.useState(!1),[ra,oa]=a.exports.useState(null),[na,ia]=a.exports.useState(null),[ca,ua]=a.exports.useState("ascending"),da=e=>{na===e?ua("ascending"===ca?"descending":"ascending"):(ia(e),ua("ascending"))},pa=s.useMemo((()=>0===u.length?Array(10).fill(null).map(((e,a)=>({serialNumber:(null==t?void 0:t.serialNumber)||0,outputId:"",outputIndex:"",panel:"",fullLabel:"",autoManual:"",hwSwitchStatus:"",fValue:"",units:"",range:"",rangeField:"",lowVoltage:"",highVoltage:"",pwmPeriod:"",status:"",signalType:"",digitalAnalog:"",label:"",typeField:""}))):u),[u,t]),xa=e=>!e.outputIndex&&!e.outputId&&0===u.length,ha=[P({columnId:"panel",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("panel"),children:[e.exports.jsx("span",{children:"Panel"}),"panel"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>e.exports.jsx(A,{children:!xa(a)&&(a.panel||"---")})}),P({columnId:"output",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("output"),children:[e.exports.jsx("span",{children:"Output"}),"output"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=z.has(a.outputIndex||"");return e.exports.jsx(A,{children:!xa(a)&&e.exports.jsxs("div",{className:ze,children:[e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(!t)return;const a=parseInt(e,10);if(isNaN(a))console.error("[OutputsPage] Invalid output index:",e);else{B((a=>new Set(a).add(e)));try{console.log(`[OutputsPage] Refreshing output ${a} from device via FFI...`);const s=await y.refreshSingleOutput(t.serialNumber,a);console.log("[OutputsPage] Refresh result:",s),await ee()}catch(s){console.error(`[OutputsPage] Failed to refresh output ${a}:`,s)}finally{B((a=>{const s=new Set(a);return s.delete(e),s}))}}})(a.outputIndex||"")},className:`${Ae} ${s?We:""}`,title:"Refresh this output from device",disabled:s,children:e.exports.jsx(m,{className:`${Je} ${s?He:""}`})}),e.exports.jsx(i,{size:200,weight:"regular",children:a.outputId||(a.outputIndex?`OUT${parseInt(a.outputIndex)+1}`:"---")})]})})}}),P({columnId:"fullLabel",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("fullLabel"),children:[e.exports.jsx("span",{children:"Full Label"}),"fullLabel"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=(null==ce?void 0:ce.serialNumber)===a.serialNumber&&(null==ce?void 0:ce.outputIndex)===a.outputIndex&&"fullLabel"===(null==ce?void 0:ce.field);return e.exports.jsx(A,{children:!xa(a)&&(s?e.exports.jsxs("div",{className:Be,children:[e.exports.jsx("input",{type:"text",className:`${qe} ${ea}`,value:de,onChange:e=>pe(e.target.value),onBlur:re,onKeyDown:oe,autoFocus:!0,disabled:xe,placeholder:"Enter label","aria-label":"Edit full label"}),e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),re()},disabled:xe,className:Te,title:"Save",children:e.exports.jsx(I,{className:Qe})})]}):e.exports.jsx("div",{className:Le,onDoubleClick:()=>le(a,"fullLabel",a.fullLabel||""),title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:a.fullLabel||"Unnamed"})}))})}}),P({columnId:"label",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("label"),children:[e.exports.jsx("span",{children:"Label"}),"label"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=(null==ce?void 0:ce.serialNumber)===a.serialNumber&&(null==ce?void 0:ce.outputIndex)===a.outputIndex&&"label"===(null==ce?void 0:ce.field);return e.exports.jsx(A,{children:!xa(a)&&(s?e.exports.jsxs("div",{className:Be,children:[e.exports.jsx("input",{type:"text",className:`${qe} ${ea}`,value:de,onChange:e=>pe(e.target.value),onBlur:re,onKeyDown:oe,autoFocus:!0,disabled:xe,placeholder:"Enter label","aria-label":"Edit label"}),e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),re()},disabled:xe,className:Te,title:"Save",children:e.exports.jsx(I,{className:Qe})})]}):e.exports.jsx("div",{className:Le,onDoubleClick:()=>le(a,"label",a.label||""),title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:a.label||"---"})}))})}}),P({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{className:Re,children:e.exports.jsx("span",{children:"Auto/Man"})}),renderCell:a=>{var s;const t=null==(s=a.autoManual)?void 0:s.toString().toLowerCase(),l="auto"===t||"1"===t;return e.exports.jsx(A,{children:!xa(a)&&e.exports.jsx("div",{onClick:async()=>{const e=l?"0":"1";console.log("Auto/Man toggled:",a.serialNumber,a.outputIndex,e);try{const s=u.find((e=>e.serialNumber===a.serialNumber&&e.outputIndex===a.outputIndex));if(!s)throw new Error("Current output data not found");const t={fullLabel:s.fullLabel||"",label:s.label||"",value:parseFloat(s.fValue||"0"),range:parseInt(s.range||"0"),autoManual:parseInt(e),control:0,lowVoltage:parseFloat(s.lowVoltage||"0"),highVoltage:parseFloat(s.highVoltage||"0"),pwmPeriod:parseInt(s.pwmPeriod||"0")};console.log("[Action 16] Updating Auto/Man:",t);const l=await fetch(`${h}/api/t3_device/outputs/${a.serialNumber}/${a.outputIndex}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!l.ok){const e=await l.text();throw new Error(`HTTP ${l.status}: ${e}`)}const r=await l.json();console.log("[Action 16] Auto/Man updated successfully:",r),d((s=>s.map((s=>s.serialNumber===a.serialNumber&&s.outputIndex===a.outputIndex?{...s,autoManual:e}:s))))}catch(s){console.error("Failed to update Auto/Man:",s),alert(`Failed to update Auto/Man: ${s instanceof Error?s.message:"Unknown error"}`)}},className:sa,children:e.exports.jsx(k,{checked:l,className:aa})})})}}),P({columnId:"hoaSwitch",renderHeaderCell:()=>e.exports.jsx("div",{className:Re,children:e.exports.jsx("span",{children:"HOA Switch"})}),renderCell:a=>{var s;const t=(null==(s=a.hwSwitchStatus)?void 0:s.toString())||"1";let l="AUTO",r="success";return"0"===t?(l="MAN-OFF",r="danger"):"2"===t?(l="MAN-ON",r="warning"):(l="AUTO",r="success"),e.exports.jsx(A,{children:!xa(a)&&e.exports.jsx($,{appearance:"filled",color:r,size:"small",children:l})})}}),P({columnId:"value",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("value"),children:[e.exports.jsx("span",{children:"Value"}),"value"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=(null==ce?void 0:ce.serialNumber)===a.serialNumber&&(null==ce?void 0:ce.outputIndex)===a.outputIndex&&"fValue"===(null==ce?void 0:ce.field);return e.exports.jsx(A,{children:!xa(a)&&(s?e.exports.jsxs("div",{className:Be,children:[e.exports.jsx("input",{type:"number",step:"0.01",className:`${qe} ${ea}`,value:de,onChange:e=>pe(e.target.value),onBlur:re,onKeyDown:oe,autoFocus:!0,disabled:xe,placeholder:"Enter value","aria-label":"Edit value"}),e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),re()},disabled:xe,className:Te,title:"Save",children:e.exports.jsx(I,{className:Qe})})]}):e.exports.jsx("div",{className:Le,onDoubleClick:()=>le(a,"fValue",a.fValue?(parseFloat(a.fValue)/1e3).toFixed(2):"0"),title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:a.fValue?(parseFloat(a.fValue)/1e3).toFixed(2):"---"})}))})}}),P({columnId:"units",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("units"),children:[e.exports.jsx("span",{children:"Units"}),"units"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>e.exports.jsx(A,{children:!xa(a)&&(a.units||"---")})}),P({columnId:"range",compare:(e,a)=>{const s=e.range||"",t=a.range||"";return s.localeCompare(t)},renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("range"),children:[e.exports.jsx("span",{children:"Range"}),"range"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=U(a.range?parseInt(a.range):0,"Digital"===a.signalType?1:0);return e.exports.jsx(A,{children:!xa(a)&&e.exports.jsx("div",{onClick:()=>(e=>{oa(e),me(!0)})(a),className:ta,title:"Click to change range",children:e.exports.jsx(i,{size:200,weight:"regular",children:s})})})}}),P({columnId:"lowVoltage",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("lowVoltage"),children:[e.exports.jsx("span",{children:"Low V"}),"lowVoltage"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=(null==ce?void 0:ce.serialNumber)===a.serialNumber&&(null==ce?void 0:ce.outputIndex)===a.outputIndex&&"lowVoltage"===(null==ce?void 0:ce.field);return e.exports.jsx(A,{children:!xa(a)&&(s?e.exports.jsx("input",{type:"number",step:"0.01",className:qe,value:de,onChange:e=>pe(e.target.value),onBlur:re,onKeyDown:oe,autoFocus:!0,disabled:xe,placeholder:"Enter voltage","aria-label":"Edit low voltage"}):e.exports.jsx("div",{className:Le,onDoubleClick:()=>{var e;return le(a,"lowVoltage",(null==(e=a.lowVoltage)?void 0:e.toString())||"0")},title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:a.lowVoltage||"---"})}))})}}),P({columnId:"highVoltage",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("highVoltage"),children:[e.exports.jsx("span",{children:"High V"}),"highVoltage"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{const s=(null==ce?void 0:ce.serialNumber)===a.serialNumber&&(null==ce?void 0:ce.outputIndex)===a.outputIndex&&"highVoltage"===(null==ce?void 0:ce.field);return e.exports.jsx(A,{children:!xa(a)&&(s?e.exports.jsx("input",{type:"number",step:"0.01",className:qe,value:de,onChange:e=>pe(e.target.value),onBlur:re,onKeyDown:oe,autoFocus:!0,disabled:xe,placeholder:"Enter voltage","aria-label":"Edit high voltage"}):e.exports.jsx("div",{className:Le,onDoubleClick:()=>{var e;return le(a,"highVoltage",(null==(e=a.highVoltage)?void 0:e.toString())||"0")},title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:a.highVoltage||"---"})}))})}}),P({columnId:"pwmPeriod",renderHeaderCell:()=>e.exports.jsx("div",{className:Re,children:e.exports.jsx("span",{children:"PWM Period"})}),renderCell:a=>{const s=(null==ce?void 0:ce.serialNumber)===a.serialNumber&&(null==ce?void 0:ce.outputIndex)===a.outputIndex&&"pwmPeriod"===(null==ce?void 0:ce.field);return e.exports.jsx(A,{children:!xa(a)&&(s?e.exports.jsx("input",{type:"number",step:"1",className:qe,value:de,onChange:e=>pe(e.target.value),onBlur:re,onKeyDown:oe,autoFocus:!0,disabled:xe,placeholder:"Enter period","aria-label":"Edit PWM period"}):e.exports.jsx("div",{className:Le,onDoubleClick:()=>{var e;return le(a,"pwmPeriod",(null==(e=a.pwmPeriod)?void 0:e.toString())||"0")},title:"Double-click to edit",children:e.exports.jsx(i,{size:200,weight:"regular",children:a.pwmPeriod||"---"})}))})}}),P({columnId:"status",renderHeaderCell:()=>e.exports.jsxs("div",{className:Ue,onClick:()=>da("status"),children:[e.exports.jsx("span",{children:"Status"}),"status"===na?"ascending"===ca?e.exports.jsx(C,{}):e.exports.jsx(w,{}):e.exports.jsx(S,{className:Me})]}),renderCell:a=>{var s;let t="Normal",l="success";const r=null==(s=a.status)?void 0:s.toString();return"0"===r||"64"===r?(t="Normal",l="success"):r&&"online"!==r&&"normal"!==r?(t=`Code ${r}`,l="warning"):"online"!==(null==r?void 0:r.toLowerCase())&&"normal"!==(null==r?void 0:r.toLowerCase())||(t="Normal",l="success"),e.exports.jsx(A,{children:!xa(a)&&e.exports.jsx($,{appearance:"filled",color:l,children:t})})}}),P({columnId:"signalType",renderHeaderCell:()=>e.exports.jsx("div",{className:Re,children:e.exports.jsx("span",{children:"Type"})}),renderCell:a=>{let s="Virtual",t="success";switch(a.typeField||"0"){case"0":default:s="Virtual",t="success";break;case"1":s="Digital",t="informative";break;case"2":s="Analog",t="brand";break;case"3":s="Extend Digital",t="informative";break;case"4":s="Extend Analog",t="brand";break;case"5":s="Internal",t="warning"}return e.exports.jsx(A,{children:!xa(a)&&e.exports.jsx($,{appearance:"outline",color:t,children:s})})}})];return e.exports.jsxs("div",{className:je,children:[e.exports.jsx("div",{className:be,children:e.exports.jsx("div",{className:_e,children:e.exports.jsx("div",{className:Ne,children:e.exports.jsxs("div",{className:fe,children:[W&&e.exports.jsxs("div",{className:Ke,children:[e.exports.jsx(g,{className:Xe}),e.exports.jsx(i,{className:Ze,children:W})]}),t&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:ye,children:e.exports.jsxs("div",{className:Ce,children:[e.exports.jsxs("button",{className:we,onClick:async()=>{if(t){M(!0),c("Refreshing outputs from device...","info");try{console.log("[OutputsPage] Refreshing all outputs from device via FFI...");const e=await y.refreshFromDevice({serialNumber:t.serialNumber,type:"output",onLoadingChange:e=>{e&&c("Loading data from device (Action 17)...","info")}});console.log("[OutputsPage] Refresh result:",e),c(e.message,"success")}catch(e){console.error("[OutputsPage] Failed to refresh from device:",e);const a=e instanceof Error?e.message:"Failed to refresh from device";H(a),c(a,"error")}finally{await ee(),M(!1)}}},disabled:R,title:"Refresh all outputs from device","aria-label":"Refresh from Device",children:[e.exports.jsx(m,{}),e.exports.jsx("span",{children:R?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:we,onClick:()=>{console.log("Export outputs to CSV")},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(v,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:Se,role:"separator"}),e.exports.jsxs("button",{className:we,onClick:()=>{console.log("Settings clicked")},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(j,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:Ie,children:[e.exports.jsx(b,{className:ke}),e.exports.jsx("input",{className:$e,type:"text",placeholder:"Search outputs...",value:ne,onChange:e=>{ie(e.target.value),console.log("Search query:",e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search outputs"})]}),e.exports.jsx(_,{content:`Showing output points for ${t.nameShowOnTree} (SN: ${t.serialNumber}). This table displays all configured output points including digital and analog outputs, their current values, voltage settings, and operational status.`,relationship:"description",children:e.exports.jsx("button",{className:`${we} ${la}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(N,{})})})]})}),e.exports.jsx("div",{className:Ge,children:e.exports.jsx("hr",{className:Ve})})]}),e.exports.jsxs("div",{className:De,children:[V&&0===u.length&&e.exports.jsxs("div",{className:Fe,children:[e.exports.jsx(f,{size:"tiny"}),e.exports.jsx(i,{size:200,weight:"regular",children:"Loading outputs..."})]}),!t&&!V&&e.exports.jsx("div",{className:Oe,children:e.exports.jsxs("div",{className:Ye,children:[e.exports.jsx(i,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(i,{size:200,children:"Please select a device from the tree to view outputs"})]})}),t&&!V&&e.exports.jsxs("div",{ref:J,className:Pe,onScroll:se,onWheel:te,children:[e.exports.jsxs(O,{items:pa,columns:ha,sortable:!0,resizableColumns:!0,columnSizingOptions:{output:{minWidth:60,defaultWidth:80},panel:{minWidth:60,defaultWidth:75},fullLabel:{minWidth:150,defaultWidth:200},autoManual:{minWidth:90,defaultWidth:120},hoaSwitch:{minWidth:80,defaultWidth:120},value:{minWidth:100,defaultWidth:140},units:{minWidth:100,defaultWidth:150},range:{minWidth:80,defaultWidth:120},lowVoltage:{minWidth:80,defaultWidth:100},highVoltage:{minWidth:80,defaultWidth:100},pwmPeriod:{minWidth:90,defaultWidth:120},status:{minWidth:80,defaultWidth:100},signalType:{minWidth:60,defaultWidth:80},label:{minWidth:130,defaultWidth:170}},children:[e.exports.jsx(F,{children:e.exports.jsx(E,{children:({renderHeaderCell:a})=>e.exports.jsx(L,{children:a()})})}),e.exports.jsx(q,{children:({item:a,rowId:s})=>e.exports.jsx(E,{children:({renderCell:s})=>e.exports.jsx(T,{children:s(a)})},s)})]}),Q&&e.exports.jsxs("div",{className:Ee,children:[e.exports.jsx(f,{size:"tiny"}),e.exports.jsx(i,{size:200,weight:"regular",children:"Loading next device..."})]})]})]})]})})})}),ra&&e.exports.jsx(ve,{isOpen:ge,onClose:()=>me(!1),currentRange:ra.range?parseInt(ra.range):0,digitalAnalog:"Digital"===ra.signalType?1:0,onSave:async e=>{if(ra)try{console.log(`[Action 16] Updating Range for Output ${ra.outputIndex} (SN: ${ra.serialNumber})`);const a={fullLabel:ra.fullLabel||"",label:ra.label||"",value:parseFloat(ra.fValue||"0"),range:e,autoManual:parseInt(ra.autoManual||"0"),control:0,lowVoltage:parseFloat(ra.lowVoltage||"0"),highVoltage:parseFloat(ra.highVoltage||"0"),pwmPeriod:parseInt(ra.pwmPeriod||"0")};console.log("[Action 16] Full payload:",a);const s=await fetch(`${h}/api/t3_device/outputs/${ra.serialNumber}/${ra.outputIndex}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e}`)}const t=await s.json();console.log("[Action 16] Range updated successfully:",t),d((a=>a.map((a=>a.serialNumber===ra.serialNumber&&a.outputIndex===ra.outputIndex?{...a,range:e.toString()}:a))))}catch(a){console.error("Failed to update Range:",a),alert(`Failed to update Range: ${a instanceof Error?a.message:"Unknown error"}`)}},inputLabel:`Output ${ra.outputIndex||ra.outputId} - ${ra.fullLabel||"Unnamed"}`})]})};export{ra as OutputsPage,ra as default};

import{j as e}from"./react.3bc90b5d.js";import{r as t}from"./client.58f92968.js";import{u as s,M as r,E as a,T as l,aL as o,N as n,i,P as p,Q as d,I as c,a3 as x,aM as u,S as h,R as m,U as _,V as f,X as j,h as b,Z as g}from"./App.4ea21eda.js";import{c as v,D as C,a as N,b as I,d as y,e as S,f as W}from"./DataGridHeaderCell.c083631d.js";import{T as D}from"./TableCellLayout.777c5080.js";import{I as w}from"./Input.4fa0d50c.js";import"./index.f111124c.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.f6c34e59.js";import"./_commonjsHelpers.a5007c1f.js";var B={container:"_container_6523t_35",bladeContentContainer:"_bladeContentContainer_6523t_59",bladeContentWrapper:"_bladeContentWrapper_6523t_75",bladeContent:"_bladeContent_6523t_59",partContent:"_partContent_6523t_107",toolbar:"_toolbar_6523t_125",toolbarContainer:"_toolbarContainer_6523t_143",toolbarButton:"_toolbarButton_6523t_159",toolbarSeparator:"_toolbarSeparator_6523t_237",searchInputWrapper:"_searchInputWrapper_6523t_253",searchIcon:"_searchIcon_6523t_267",searchInput:"_searchInput_6523t_253",bladeDescription:"_bladeDescription_6523t_347",overviewHr:"_overviewHr_6523t_387",dockingBody:"_dockingBody_6523t_403",scrollContainer:"_scrollContainer_6523t_419",autoLoadIndicator:"_autoLoadIndicator_6523t_475",loading:"_loading_6523t_497",noData:"_noData_6523t_499",loadingBar:"_loadingBar_6523t_517",editableCell:"_editableCell_6523t_799",editInput:"_editInput_6523t_827",saveButton:"_saveButton_6523t_899",refreshIconButton:"_refreshIconButton_6523t_961",isRefreshing:"_isRefreshing_6523t_1031",rotating:"_rotating_6523t_1071",rotate:"_rotate_6523t_1"};var H=()=>{const{selectedDevice:H,treeData:k,selectDevice:A,getNextDevice:P,getFilteredDevices:T}=s(),[L,E]=t.exports.useState([]),[R,z]=t.exports.useState(!1),[M,O]=t.exports.useState(null),[U,$]=t.exports.useState(!1),[F,V]=t.exports.useState({}),[G,Q]=t.exports.useState(!1),[X,Y]=t.exports.useState(null),[Z,q]=t.exports.useState("ascending"),[J,K]=t.exports.useState(""),[ee,te]=t.exports.useState(!1),[se,re]=t.exports.useState(new Set),[ae,le]=t.exports.useState(!1),oe=t.exports.useRef(!1),ne=t.exports.useRef(null),[ie,pe]=t.exports.useState(!1),de=t.exports.useRef(!1),ce=t.exports.useMemo((()=>0===L.length?Array(10).fill(null).map(((e,t)=>({loop_field:"",input_field:"",input_value:"",units:"",auto_manual:"",output_field:"",output_value:"",set_value:"",units_state:"",action_field:"",proportional:"",reset_field:"",rate:"",bias:"",switch_node:"",status:"",type_field:"",setpoint_high:"",setpoint_low:"",variable_state:""}))):L),[L]),xe=e=>!e.loop_field&&0===L.length;t.exports.useEffect((()=>{if(!H){const e=T();e.length>0&&A(e[0])}}),[H,T,A]);const ue=t.exports.useCallback((async()=>{if(H){z(!0),O(null);try{const e=`${r}/api/t3_device/devices/${H.serialNumber}/table/PID_TABLE`,t=await fetch(e);if(!t.ok)throw new Error("Failed to fetch PID loops");const s=await t.json();E(s.data||[])}catch(e){O(e instanceof Error?e.message:"Failed to load PID loops")}finally{z(!1)}}}),[H]);t.exports.useEffect((()=>{ue()}),[ue]),t.exports.useEffect((()=>{E([]),le(!1),oe.current=!1}),[null==H?void 0:H.serialNumber]),t.exports.useEffect((()=>{if(R||!H||ae||oe.current)return;(async()=>{oe.current=!0;try{if(L.length>0)return void le(!0);await m.refreshAllPidLoops(H.serialNumber);await ue(),le(!0)}catch(e){le(!0)}})()}),[R,H,ae,ue,L.length]);const he=(e,t,s)=>{V((r=>({...r,[e]:{...r[e]||{},[t]:s}}))),Q(!0)},me=(e,t)=>{var s,r,a;const l=e.loop_field;return null!=(a=null!=(r=null==(s=F[l])?void 0:s[t])?r:e[t])?a:""},_e=e=>{const t="AUTO"===me(e,"auto_manual")?"MANUAL":"AUTO";he(e.loop_field,"auto_manual",t)},fe=e=>{X===e?q("ascending"===Z?"descending":"ascending"):(Y(e),q("ascending"))},je=t.exports.useCallback((()=>{const e=P();e&&(pe(!0),A(e),setTimeout((()=>{pe(!1)}),500))}),[P,A]),be=t.exports.useCallback((e=>{if(ie||R)return;const t=e.currentTarget;t.scrollHeight-t.scrollTop-t.clientHeight<=1&&L.length>0?de.current=!0:de.current=!1}),[ie,R,L.length]),ge=t.exports.useCallback((e=>{ie||R||0===L.length||e.deltaY>0&&de.current&&(de.current=!1,je())}),[ie,R,L.length,je]);t.exports.useEffect((()=>{H&&ne.current&&ne.current.scrollTo({top:0,behavior:ie?"smooth":"auto"})}),[H,ie]);const ve=t.exports.useMemo((()=>[v({columnId:"loop_field",compare:(e,t)=>Number(e.loop_field)-Number(t.loop_field),renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>fe("loop_field"),children:[e.exports.jsx("span",{children:"NUM"}),"loop_field"===X?"ascending"===Z?e.exports.jsx(_,{}):e.exports.jsx(f,{}):e.exports.jsx(j,{style:{opacity:.5}})]}),renderCell:t=>{if(xe(t))return e.exports.jsx(D,{});const s=t.loop_field||"",r=se.has(s);return e.exports.jsx(D,{children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(!H)return;const t=parseInt(e,10);if(!isNaN(t)){re((t=>new Set(t).add(e)));try{await m.refreshSinglePidLoop(H.serialNumber,t),await ue()}catch(s){}finally{re((t=>{const s=new Set(t);return s.delete(e),s}))}}})(s)},className:`${B.refreshIconButton} ${r?B.isRefreshing:""}`,title:"Refresh this PID loop from device",disabled:r,children:e.exports.jsx(b,{style:{fontSize:"14px"},className:r?B.rotating:""})}),e.exports.jsx(l,{size:200,weight:"regular",children:t.loop_field})]})})}}),v({columnId:"input_field",compare:(e,t)=>(e.input_field||"").localeCompare(t.input_field||""),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Input"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,value:me(t,"input_field"),onChange:(e,s)=>he(t.loop_field,"input_field",s.value)})})}),v({columnId:"input_value",compare:(e,t)=>Number(e.input_value||0)-Number(t.input_value||0),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Value"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,type:"number",value:me(t,"input_value"),onChange:(e,s)=>he(t.loop_field,"input_value",s.value)})})}),v({columnId:"units",compare:(e,t)=>(e.units||"").localeCompare(t.units||""),renderHeaderCell:()=>e.exports.jsx("div",{className:B.headerText,children:"Units"}),renderCell:t=>e.exports.jsx(D,{className:B.readOnlyCell,children:!xe(t)&&me(t,"units")})}),v({columnId:"auto_manual",compare:(e,t)=>(e.auto_manual||"").localeCompare(t.auto_manual||""),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"A/M"})}),renderCell:t=>{if(xe(t))return e.exports.jsx(D,{});const s="AUTO"===me(t,"auto_manual");return e.exports.jsx(D,{children:e.exports.jsxs("div",{className:B.autoManualContainer,children:[e.exports.jsx(g,{checked:s,onChange:()=>_e(t),className:B.autoManualSwitch}),e.exports.jsx("span",{className:B.autoManualLabel,children:s?"AUTO":"MAN"})]})})}}),v({columnId:"output_field",compare:(e,t)=>(e.output_field||"").localeCompare(t.output_field||""),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Output"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,value:me(t,"output_field"),onChange:(e,s)=>he(t.loop_field,"output_field",s.value)})})}),v({columnId:"set_value",compare:(e,t)=>Number(e.set_value||0)-Number(t.set_value||0),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Setpoint"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,type:"number",value:me(t,"set_value"),onChange:(e,s)=>he(t.loop_field,"set_value",s.value)})})}),v({columnId:"units_state",compare:(e,t)=>(e.units_state||"").localeCompare(t.units_state||""),renderHeaderCell:()=>e.exports.jsx("div",{className:B.headerText,children:"Units"}),renderCell:t=>e.exports.jsx(D,{className:B.readOnlyCell,children:!xe(t)&&me(t,"units_state")})}),v({columnId:"action_field",compare:(e,t)=>(e.action_field||"").localeCompare(t.action_field||""),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Action"})}),renderCell:t=>e.exports.jsx(D,{className:B.readOnlyCell,children:!xe(t)&&me(t,"action_field")})}),v({columnId:"proportional",compare:(e,t)=>Number(e.proportional||0)-Number(t.proportional||0),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Prop"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,type:"number",value:me(t,"proportional"),onChange:(e,s)=>he(t.loop_field,"proportional",s.value)})})}),v({columnId:"reset_field",compare:(e,t)=>Number(e.reset_field||0)-Number(t.reset_field||0),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Int"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,type:"number",value:me(t,"reset_field"),onChange:(e,s)=>he(t.loop_field,"reset_field",s.value)})})}),v({columnId:"rate",compare:(e,t)=>Number(e.rate||0)-Number(t.rate||0),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Der"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,type:"number",value:me(t,"rate"),onChange:(e,s)=>he(t.loop_field,"rate",s.value)})})}),v({columnId:"bias",compare:(e,t)=>Number(e.bias||0)-Number(t.bias||0),renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Bias"})}),renderCell:t=>e.exports.jsx(D,{children:!xe(t)&&e.exports.jsx(w,{className:B.editableInput,type:"number",value:me(t,"bias"),onChange:(e,s)=>he(t.loop_field,"bias",s.value)})})})]),[F,X,Z,fe,he,_e,me,xe]);return e.exports.jsx("div",{className:B.container,children:e.exports.jsx("div",{className:B.bladeContentContainer,children:e.exports.jsx("div",{className:B.bladeContentWrapper,children:e.exports.jsx("div",{className:B.bladeContent,children:e.exports.jsxs("div",{className:B.partContent,children:[M&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(a,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(l,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:M})]}),H&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:B.toolbar,children:e.exports.jsxs("div",{className:B.toolbarContainer,children:[e.exports.jsxs("button",{className:B.toolbarButton,onClick:async()=>{if(H){te(!0);try{await m.refreshAllPidLoops(H.serialNumber);await ue()}catch(e){O(e instanceof Error?e.message:"Failed to refresh from device")}finally{te(!1)}}},disabled:ee,title:"Refresh all PID loops from device","aria-label":"Refresh from Device",children:[e.exports.jsx(o,{}),e.exports.jsx("span",{children:ee?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:B.toolbarButton,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(n,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:B.toolbarSeparator,role:"separator"}),e.exports.jsxs("button",{className:B.toolbarButton,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(i,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:B.searchInputWrapper,children:[e.exports.jsx(p,{className:B.searchIcon}),e.exports.jsx("input",{className:B.searchInput,type:"text",placeholder:"Search PID loops...",value:J,onChange:e=>{K(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search PID loops"})]}),H&&e.exports.jsx(d,{content:`Showing PID loops for ${H.nameShowOnTree} (SN: ${H.serialNumber}). This table displays all PID controller configurations including inputs, outputs, setpoints, and tuning parameters.`,relationship:"description",children:e.exports.jsx("button",{className:B.toolbarButton,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(c,{})})}),G&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:B.toolbarSeparator,role:"separator"}),e.exports.jsxs("button",{className:B.toolbarButton,onClick:()=>{V({}),Q(!1)},title:"Discard Changes","aria-label":"Discard Changes",children:[e.exports.jsx(x,{}),e.exports.jsx("span",{children:"Discard"})]}),e.exports.jsxs("button",{className:`${B.toolbarButton} ${B.toolbarButtonPrimary}`,onClick:async()=>{$(!0);try{V({}),Q(!1)}catch(e){}finally{$(!1)}},disabled:U,title:"Save All","aria-label":"Save All",children:[e.exports.jsx(u,{}),e.exports.jsx("span",{children:U?"Saving...":"Save All"})]})]})]})}),e.exports.jsx("div",{style:{padding:"0"},children:e.exports.jsx("hr",{className:B.overviewHr})})]}),e.exports.jsxs("div",{className:B.dockingBody,children:[R&&0===L.length&&e.exports.jsxs("div",{className:B.loadingBar,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(l,{size:200,weight:"regular",children:"Loading PID loops..."})]}),!H&&!R&&e.exports.jsx("div",{className:B.noData,children:e.exports.jsxs("div",{style:{textAlign:"center"},children:[e.exports.jsx(l,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(l,{size:200,children:"Please select a device from the tree to view pid loops"})]})}),H&&!R&&!M&&e.exports.jsxs("div",{ref:ne,className:B.scrollContainer,onScroll:be,onWheel:ge,children:[e.exports.jsxs(C,{items:ce,columns:ve,sortable:!0,resizableColumns:!0,columnSizingOptions:{loop_field:{minWidth:60,defaultWidth:80},input_field:{minWidth:100,defaultWidth:150},input_value:{minWidth:80,defaultWidth:100},units:{minWidth:80,defaultWidth:100},auto_manual:{minWidth:100,defaultWidth:120},output_field:{minWidth:100,defaultWidth:150},output_value:{minWidth:80,defaultWidth:100},setpoint_field:{minWidth:100,defaultWidth:150},setpoint_value:{minWidth:80,defaultWidth:100},prop_band:{minWidth:80,defaultWidth:100},integral:{minWidth:80,defaultWidth:100},derivative:{minWidth:80,defaultWidth:100},sample_time:{minWidth:90,defaultWidth:110}},children:[e.exports.jsx(N,{children:e.exports.jsx(I,{children:({renderHeaderCell:t})=>e.exports.jsx(y,{children:t()})})}),e.exports.jsx(S,{children:({item:t,rowId:s})=>e.exports.jsx(I,{children:({renderCell:s})=>e.exports.jsx(W,{children:s(t)})},s)})]}),ie&&e.exports.jsxs("div",{className:B.autoLoadIndicator,children:[e.exports.jsx(h,{size:"tiny"}),e.exports.jsx(l,{children:"Loading next device..."})]})]})]})]})})})})})};export{H as default};

import{j as e}from"./react.3bc90b5d.js";import{r,R as s}from"./client.58f92968.js";import{a0 as t,a1 as l,a2 as o,B as a,a3 as i,T as n,a4 as p,aF as d,aG as x,aH as c,Y as m,aI as u,aJ as h,u as g,M as f,E as j,h as y,N as v,i as b,P as C,Q as S,I as _,R as N,U as k,V as I,X as z,$ as w,Z as F,aK as L}from"./App.4ea21eda.js";import{F as E}from"./index.2cf43efd.js";import{c as D,D as H,a as T,b as W,d as R,e as P,f as B}from"./DataGridHeaderCell.c083631d.js";import{T as M}from"./TableCellLayout.777c5080.js";import"./index.f111124c.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.f6c34e59.js";import"./_commonjsHelpers.a5007c1f.js";const O=({open:s,onOpenChange:g,selectedProgram:f})=>{const[j,y]=r.exports.useState("10 SET = TEMP\n20 REM IF CNT < 10 THEN CNT = CNT + 1 ELSE CNT = 0\n30 V3 = FFFFF\n"),[v,b]=r.exports.useState("Ready. Use buttons above to compile, save, or load program code."),C=(null==f?void 0:f.programSize)?parseInt(f.programSize):0,S=2e3-C;return e.exports.jsxs(t,{type:"overlay",separator:!0,open:s,onOpenChange:(e,{open:r})=>g(r),position:"end",style:{width:"700px"},children:[e.exports.jsx(l,{style:{minHeight:"40px",padding:"8px 16px"},children:e.exports.jsx(o,{action:e.exports.jsx(a,{appearance:"subtle","aria-label":"Close",icon:e.exports.jsx(i,{}),onClick:()=>g(!1)}),children:e.exports.jsxs(n,{size:300,weight:"semibold",children:["Bacnet Program IDE - Program ",(null==f?void 0:f.programId)||""]})})}),e.exports.jsx(p,{style:{padding:0,display:"flex",flexDirection:"column",height:"100%"},children:f&&e.exports.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",gap:"8px",padding:"8px"},children:[e.exports.jsxs("div",{style:{display:"flex",gap:"8px",padding:"8px",borderBottom:"1px solid #e1dfdd"},children:[e.exports.jsx(a,{appearance:"primary",icon:e.exports.jsx(d,{style:{fontSize:"16px"}}),size:"small",title:"Send (F2) - Compile and send to device",onClick:()=>{b("Compiling program...\nSending to device...")},children:"Send (F2)"}),e.exports.jsx(a,{appearance:"secondary",icon:e.exports.jsx(x,{style:{fontSize:"16px"}}),size:"small",title:"Clear (F3) - Clear the editor",onClick:()=>{y(""),b("Editor cleared.")},children:"Clear (F3)"}),e.exports.jsx(a,{appearance:"secondary",icon:e.exports.jsx(c,{style:{fontSize:"16px"}}),size:"small",title:"Load File (F7) - Load from file",onClick:()=>{b("Load file functionality will be implemented.")},children:"Load (F7)"}),e.exports.jsx(a,{appearance:"secondary",icon:e.exports.jsx(m,{style:{fontSize:"16px"}}),size:"small",title:"Save File (F6) - Save to file",onClick:()=>{b("Save file functionality will be implemented.")},children:"Save (F6)"}),e.exports.jsx(a,{appearance:"secondary",icon:e.exports.jsx(u,{style:{fontSize:"16px"}}),size:"small",title:"Refresh (F8) - Refresh from device",onClick:()=>{b("Refreshing program from device...")},children:"Refresh (F8)"}),e.exports.jsx("div",{style:{flex:1}}),e.exports.jsx(a,{appearance:"secondary",icon:e.exports.jsx(h,{style:{fontSize:"16px"}}),size:"small",title:"Help - Programming help",onClick:()=>{b("Programming Help:\n- Use F2 to send\n- Use F3 to clear\n- Use F6 to save\n- Use F7 to load\n- Use F8 to refresh")},children:"Help"})]}),e.exports.jsx("div",{style:{flex:"1 1 60%",minHeight:"300px",display:"flex",flexDirection:"column",border:"1px solid #d1d1d1",borderRadius:"4px",overflow:"hidden",backgroundColor:"#f8f8f8"},children:e.exports.jsx(E,{height:"100%",defaultLanguage:"vb",value:j,onChange:e=>y(e||""),theme:"vs",options:{minimap:{enabled:!1},fontSize:11,lineHeight:18,fontFamily:'Consolas, "Courier New", monospace',scrollBeyondLastLine:!1,automaticLayout:!0,wordWrap:"on",wrappingIndent:"same",lineNumbers:"on",glyphMargin:!1,folding:!1,lineDecorationsWidth:10,lineNumbersMinChars:3,renderLineHighlight:"all",scrollbar:{vertical:"visible",horizontal:"hidden",verticalScrollbarSize:6,horizontalScrollbarSize:6}}})}),e.exports.jsxs("div",{style:{flex:"0 0 auto",display:"flex",gap:"8px",minHeight:"150px"},children:[e.exports.jsxs("div",{style:{flex:"1 1 60%",display:"flex",flexDirection:"column"},children:[e.exports.jsx(n,{size:200,weight:"semibold",style:{marginBottom:"4px"},children:"Information Window"}),e.exports.jsx("div",{style:{flex:1,border:"1px solid #d1d1d1",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa",fontFamily:'Consolas, "Courier New", monospace',fontSize:"12px",overflowY:"auto",minHeight:"120px",whiteSpace:"pre-wrap"},children:e.exports.jsx(n,{size:100,style:{color:"#605e5c"},children:v})})]}),e.exports.jsxs("div",{style:{flex:"0 0 200px",display:"flex",flexDirection:"column"},children:[e.exports.jsx(n,{size:200,weight:"semibold",style:{marginBottom:"4px"},children:"Memory Statistics"}),e.exports.jsxs("div",{style:{flex:1,border:"1px solid #d1d1d1",borderRadius:"4px",padding:"12px",backgroundColor:"#f5f5f5",display:"flex",flexDirection:"column",gap:"12px"},children:[e.exports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.exports.jsx(n,{size:200,children:"Programs pool size:"}),e.exports.jsx(n,{size:200,weight:"semibold",style:{color:"#d13438"},children:2e3})]}),e.exports.jsx("div",{style:{height:"1px",backgroundColor:"#e1dfdd"}}),e.exports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.exports.jsx(n,{size:200,children:"Programs size:"}),e.exports.jsx(n,{size:200,weight:"semibold",style:{color:"#d13438"},children:C})]}),e.exports.jsx("div",{style:{height:"1px",backgroundColor:"#e1dfdd"}}),e.exports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.exports.jsx(n,{size:200,children:"Free memory:"}),e.exports.jsx(n,{size:200,weight:"semibold",style:{color:"#d13438"},children:S})]}),e.exports.jsx("div",{style:{marginTop:"auto",paddingTop:"8px"},children:e.exports.jsx(n,{size:100,style:{color:"#605e5c"},children:"Bytes"})})]})]})]})]})})]})};var $="_container_1v08k_35",A="_bladeContentContainer_1v08k_59",U="_bladeContentWrapper_1v08k_75",V="_bladeContent_1v08k_59",K="_partContent_1v08k_107",Y="_toolbar_1v08k_125",G="_toolbarContainer_1v08k_143",J="_toolbarButton_1v08k_159",Q="_toolbarSeparator_1v08k_237",X="_searchInputWrapper_1v08k_253",Z="_searchIcon_1v08k_267",q="_searchInput_1v08k_253",ee="_overviewHr_1v08k_387",re="_dockingBody_1v08k_403",se="_scrollContainer_1v08k_421",te="_noData_1v08k_469",le="_loadingBar_1v08k_487",oe="_editableCell_1v08k_841",ae="_editInput_1v08k_869",ie="_refreshIconButton_1v08k_1003",ne="_isRefreshing_1v08k_1073",pe="_rotating_1v08k_1113";const de=()=>{const{selectedDevice:t,treeData:l,selectDevice:o,getNextDevice:i,getFilteredDevices:p}=g(),[d,x]=r.exports.useState([]),[c,m]=r.exports.useState(!1),[u,h]=r.exports.useState(null),[E,de]=r.exports.useState(!1),[xe,ce]=r.exports.useState(new Set),[me,ue]=r.exports.useState(!1),he=r.exports.useRef(!1),[ge,fe]=r.exports.useState(!1),[je,ye]=r.exports.useState(null),ve=r.exports.useRef(null),[be,Ce]=r.exports.useState(!1),Se=r.exports.useRef(!1);r.exports.useEffect((()=>{if(!t&&l.length>0){const e=p();e.length>0&&o(e[0])}}),[t,l,o,p]);const _e=r.exports.useCallback((async()=>{if(t){m(!0),h(null);try{const e=`${f}/api/t3_device/devices/${t.serialNumber}/programs`,r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch programs: ${r.statusText}`);const s=await r.json();x(s.programs||[])}catch(e){const r=e instanceof Error?e.message:"Failed to load programs";h(r)}finally{m(!1)}}else x([])}),[t]);r.exports.useEffect((()=>{_e()}),[_e]),r.exports.useEffect((()=>{x([]),ue(!1),he.current=!1}),[null==t?void 0:t.serialNumber]),r.exports.useEffect((()=>{if(c||!t||me||he.current)return;(async()=>{he.current=!0;try{if(d.length>0)return void ue(!0);await N.refreshAllPrograms(t.serialNumber);await _e(),ue(!0)}catch(e){ue(!0)}})()}),[c,t,me,_e,d.length]);const Ne=r.exports.useCallback((async()=>{const e=i();e&&(Ce(!0),o(e),setTimeout((()=>Ce(!1)),500))}),[i,o]),ke=r.exports.useCallback((e=>{if(be||c)return;const r=e.currentTarget;r.scrollHeight-r.scrollTop-r.clientHeight<=1&&d.length>0?Se.current=!0:Se.current=!1}),[be,c,d.length]),Ie=r.exports.useCallback((e=>{be||c||0===d.length||e.deltaY>0&&Se.current&&(Se.current=!1,Ne())}),[be,c,d.length,Ne]);r.exports.useEffect((()=>{t&&ve.current&&ve.current.scrollTo({top:0,behavior:be?"smooth":"auto"})}),[t,be]);const ze=(e,r,s)=>{He({serialNumber:e.serialNumber,programId:e.programId||"",field:r}),We(s||"")},we=async()=>{if(De&&Te.trim()){Pe(!0);try{x((e=>e.map((e=>e.serialNumber===De.serialNumber&&e.programId===De.programId?{...e,[De.field]:Te}:e)))),He(null)}catch(e){}finally{Pe(!1)}}else He(null)},Fe=e=>{"Enter"===e.key?(e.preventDefault(),we()):"Escape"===e.key&&(e.preventDefault(),He(null),We(""))},[Le,Ee]=r.exports.useState(""),[De,He]=r.exports.useState(null),[Te,We]=r.exports.useState(""),[Re,Pe]=r.exports.useState(!1),[Be,Me]=r.exports.useState(null),[Oe,$e]=r.exports.useState("ascending"),Ae=e=>{Be===e?$e("ascending"===Oe?"descending":"ascending"):(Me(e),$e("ascending"))},Ue=r.exports.useCallback((e=>{e.programId&&(ye(e),fe(!0))}),[]),Ve=s.useMemo((()=>0===d.length?Array(10).fill(null).map(((e,r)=>({serialNumber:(null==t?void 0:t.serialNumber)||0,programId:"",switchNode:"",programLabel:"",programList:"",programSize:"",programPointer:"",programStatus:"",autoManual:""}))):d),[d,t]),Ke=e=>!e.programId&&0===d.length,Ye=[D({columnId:"program",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Ae("program"),children:[e.exports.jsx("span",{children:"Program"}),"program"===Be?"ascending"===Oe?e.exports.jsx(k,{}):e.exports.jsx(I,{}):e.exports.jsx(z,{style:{opacity:.5}})]}),renderCell:r=>{if(Ke(r))return e.exports.jsx(M,{});const s=r.programId||"",l=xe.has(s);return e.exports.jsx(M,{children:e.exports.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.exports.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{if(!t)return;const r=parseInt(e,10);if(!isNaN(r)){ce((r=>new Set(r).add(e)));try{await N.refreshSingleProgram(t.serialNumber,r),await _e()}catch(s){}finally{ce((r=>{const s=new Set(r);return s.delete(e),s}))}}})(s)},className:`${ie} ${l?ne:""}`,title:"Refresh this program from device",disabled:l,children:e.exports.jsx(y,{style:{fontSize:"14px"},className:l?pe:""})}),e.exports.jsx(n,{size:200,weight:"regular",children:r.programId||"---"})]})})}}),D({columnId:"fullLabel",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Ae("fullLabel"),children:[e.exports.jsx("span",{children:"Full Label"}),"fullLabel"===Be?"ascending"===Oe?e.exports.jsx(k,{}):e.exports.jsx(I,{}):e.exports.jsx(z,{style:{opacity:.5}})]}),renderCell:r=>{var s;if(Ke(r))return e.exports.jsx(M,{});const t=(null==De?void 0:De.serialNumber)===r.serialNumber&&(null==De?void 0:De.programId)===r.programId&&"programLabel"===(null==De?void 0:De.field);return e.exports.jsx(M,{children:t?e.exports.jsx("input",{type:"text",className:ae,value:Te,onChange:e=>We(e.target.value),onBlur:we,onKeyDown:Fe,autoFocus:!0,disabled:Re,placeholder:"Enter full label","aria-label":"Edit full label"}):e.exports.jsx("div",{className:oe,onDoubleClick:()=>{var e;return ze(r,"programLabel",null!=(e=r.programLabel)?e:"")},title:"Double-click to edit",children:e.exports.jsx(n,{size:200,weight:"regular",children:null!=(s=r.programLabel)?s:""})})})}}),D({columnId:"status",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Ae("status"),children:[e.exports.jsx("span",{children:"Status"}),"status"===Be?"ascending"===Oe?e.exports.jsx(k,{}):e.exports.jsx(I,{}):e.exports.jsx(z,{style:{opacity:.5}})]}),renderCell:r=>{var s;if(Ke(r))return e.exports.jsx(M,{});const t="on"===(null==(s=r.programStatus)?void 0:s.toLowerCase())||"1"===r.programStatus;return e.exports.jsx(M,{children:e.exports.jsx(w,{appearance:"filled",color:t?"success":"warning",style:{cursor:"pointer"},onClick:()=>{const e=t?"OFF":"ON";x((s=>s.map((s=>s.serialNumber===r.serialNumber&&s.programId===r.programId?{...s,programStatus:e}:s))))},children:t?"ON":"OFF"})})}}),D({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Auto/Manual"})}),renderCell:r=>{var s;if(Ke(r))return e.exports.jsx(M,{});const t=null==(s=r.autoManual)?void 0:s.toString().toLowerCase(),l="auto"===t||"1"===t;return e.exports.jsx(M,{children:e.exports.jsx("div",{onClick:()=>{const e=l?"Manual":"Auto";x((s=>s.map((s=>s.serialNumber===r.serialNumber&&s.programId===r.programId?{...s,autoManual:e}:s))))},style:{cursor:"pointer",display:"flex",alignItems:"center"},children:e.exports.jsx(F,{checked:l,style:{transform:"scale(0.8)"}})})})}}),D({columnId:"size",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Ae("size"),children:[e.exports.jsx("span",{children:"Size"}),"size"===Be?"ascending"===Oe?e.exports.jsx(k,{}):e.exports.jsx(I,{}):e.exports.jsx(z,{style:{opacity:.5}})]}),renderCell:r=>e.exports.jsx(M,{children:!Ke(r)&&(r.programSize||"0")})}),D({columnId:"executionTime",renderHeaderCell:()=>e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:e.exports.jsx("span",{children:"Execution Time"})}),renderCell:r=>e.exports.jsx(M,{children:!Ke(r)&&(r.programPointer||"---")})}),D({columnId:"label",renderHeaderCell:()=>e.exports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},onClick:()=>Ae("label"),children:[e.exports.jsx("span",{children:"Label"}),"label"===Be?"ascending"===Oe?e.exports.jsx(k,{}):e.exports.jsx(I,{}):e.exports.jsx(z,{style:{opacity:.5}})]}),renderCell:r=>{if(Ke(r))return e.exports.jsx(M,{});const s=(null==De?void 0:De.serialNumber)===r.serialNumber&&(null==De?void 0:De.programId)===r.programId&&"programList"===(null==De?void 0:De.field);return e.exports.jsx(M,{children:s?e.exports.jsx("input",{type:"text",className:ae,value:Te,onChange:e=>We(e.target.value),onBlur:we,onKeyDown:Fe,autoFocus:!0,disabled:Re,placeholder:"Enter label","aria-label":"Edit label"}):e.exports.jsx("div",{className:oe,onDoubleClick:()=>ze(r,"programList",r.programList||""),title:"Double-click to edit",children:e.exports.jsx(n,{size:200,weight:"regular",children:r.programList||"---"})})})}}),D({columnId:"programming",renderHeaderCell:()=>e.exports.jsx("span",{children:"Programming"}),renderCell:r=>Ke(r)?e.exports.jsx(M,{}):e.exports.jsx(M,{children:e.exports.jsx(a,{size:"small",appearance:"subtle",icon:e.exports.jsx(L,{}),onClick:e=>{e.stopPropagation(),Ue(r)},title:"Open programming editor",children:"Edit"})})})];return e.exports.jsxs("div",{className:$,children:[e.exports.jsx("div",{className:A,children:e.exports.jsx("div",{className:U,children:e.exports.jsx("div",{className:V,children:e.exports.jsxs("div",{className:K,children:[u&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(j,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(n,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:u})]}),t&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:Y,children:e.exports.jsxs("div",{className:G,children:[e.exports.jsxs("button",{className:J,onClick:async()=>{if(t){de(!0);try{await N.refreshAllPrograms(t.serialNumber);await _e()}catch(e){h(e instanceof Error?e.message:"Failed to refresh from device")}finally{de(!1)}}},disabled:E,title:"Refresh all programs from device","aria-label":"Refresh from Device",children:[e.exports.jsx(y,{}),e.exports.jsx("span",{children:E?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:J,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(v,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:Q,role:"separator"}),e.exports.jsxs("button",{className:J,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(b,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:X,children:[e.exports.jsx(C,{className:Z}),e.exports.jsx("input",{className:q,type:"text",placeholder:"Search programs...",value:Le,onChange:e=>{Ee(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search programs"})]}),e.exports.jsx(S,{content:`Showing program points for ${t.nameShowOnTree} (SN: ${t.serialNumber}). This table displays all configured program logic including execution status, size, and control settings.`,relationship:"description",children:e.exports.jsx("button",{className:J,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(_,{})})})]})}),e.exports.jsx("div",{style:{padding:"0"},children:e.exports.jsx("hr",{className:ee})})]}),e.exports.jsxs("div",{className:re,children:[c&&0===d.length&&e.exports.jsxs("div",{className:le,children:[e.exports.jsx(y,{}),e.exports.jsx(n,{size:200,weight:"regular",children:"Loading programs..."})]}),!t&&!c&&e.exports.jsx("div",{className:te,children:e.exports.jsxs("div",{style:{textAlign:"center"},children:[e.exports.jsx(n,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(n,{size:200,children:"Please select a device from the tree to view programs"})]})}),t&&!c&&e.exports.jsx("div",{ref:ve,className:se,onScroll:ke,onWheel:Ie,children:e.exports.jsxs(H,{items:Ve,columns:Ye,sortable:!0,resizableColumns:!0,columnSizingOptions:{program:{minWidth:80,defaultWidth:100},fullLabel:{minWidth:150,defaultWidth:200},status:{minWidth:80,defaultWidth:100},autoManual:{minWidth:100,defaultWidth:120},size:{minWidth:60,defaultWidth:80},executionTime:{minWidth:120,defaultWidth:180},label:{minWidth:130,defaultWidth:200},programming:{minWidth:80,defaultWidth:100}},children:[e.exports.jsx(T,{children:e.exports.jsx(W,{children:({renderHeaderCell:r})=>e.exports.jsx(R,{children:r()})})}),e.exports.jsx(P,{children:({item:r,rowId:s})=>e.exports.jsx(W,{children:({renderCell:s})=>e.exports.jsx(B,{children:s(r)})},s)})]})}),"              "]})]})})})}),e.exports.jsx(O,{open:ge,onOpenChange:fe,selectedProgram:je})]})};export{de as ProgramsPage,de as default};

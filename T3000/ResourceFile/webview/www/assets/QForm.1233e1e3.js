import{a6 as o,h as e,J as t,I as n,o as a,Q as s,a8 as r,g as u,bY as i,aT as c,n as l,b6 as f,p as d,bZ as m}from"./index.0d1b2de5.js";var p=o({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(o,{slots:p,emit:v}){const b=u(),y=e(null);let h=0;const x=[];function S(e){const t="boolean"==typeof e?e:!0!==o.noErrorFocus,n=++h,a=(o,e)=>{v("validation"+(!0===o?"Success":"Error"),e)},s=o=>{const e=o.validate();return"function"==typeof e.then?e.then((e=>({valid:e,comp:o})),(e=>({valid:!1,comp:o,err:e}))):Promise.resolve({valid:e,comp:o})};return(!0===o.greedy?Promise.all(x.map(s)).then((o=>o.filter((o=>!0!==o.valid)))):x.reduce(((o,e)=>o.then((()=>s(e).then((o=>{if(!1===o.valid)return Promise.reject(o)}))))),Promise.resolve()).catch((o=>[o]))).then((o=>{if(void 0===o||0===o.length)return n===h&&a(!0),!0;if(n===h){const{comp:e,err:n}=o[0];if(a(!1,e),!0===t){const e=o.find((({comp:o})=>"function"==typeof o.focus&&!1===i(o.$)));void 0!==e&&e.comp.focus()}}return!1}))}function g(){h++,x.forEach((o=>{"function"==typeof o.resetValidation&&o.resetValidation()}))}function F(e){void 0!==e&&c(e);const t=h+1;S().then((n=>{t===h&&!0===n&&(void 0!==o.onSubmit?v("submit",e):void 0!==(null==e?void 0:e.target)&&"function"==typeof e.target.submit&&e.target.submit())}))}function q(e){void 0!==e&&c(e),v("reset"),l((()=>{g(),!0===o.autofocus&&!0!==o.noResetFocus&&E()}))}function E(){f((()=>{if(null===y.value)return;const o=y.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||y.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||y.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(y.value.querySelectorAll("[tabindex]"),(o=>-1!==o.tabIndex));null==o||o.focus({preventScroll:!0})}))}d(m,{bindComponent(o){x.push(o)},unbindComponent(o){const e=x.indexOf(o);-1!==e&&x.splice(e,1)}});let B=!1;return t((()=>{B=!0})),n((()=>{!0===B&&!0===o.autofocus&&E()})),a((()=>{!0===o.autofocus&&E()})),Object.assign(b.proxy,{validate:S,resetValidation:g,submit:F,reset:q,focus:E,getValidationComponents:()=>x}),()=>s("form",{class:"q-form",ref:y,onSubmit:F,onReset:q},r(p.default))}});export{p as Q};

import{j as e}from"./react.3bc90b5d.js";import{r as s,R as r}from"./client.58f92968.js";import{u as t,M as a,E as l,T as i,h as o,N as c,i as n,P as d,Q as x,I as h,S as p,R as u,U as m,V as j,X as _,Z as f}from"./App.4ea21eda.js";import{c as v,D as C,a as N,b,d as g,e as y,f as S}from"./DataGridHeaderCell.c083631d.js";import{T as I}from"./TableCellLayout.777c5080.js";import"./index.f111124c.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.f6c34e59.js";import"./_commonjsHelpers.a5007c1f.js";var q="_container_1ciqc_21",w="_bladeContentContainer_1ciqc_51",F="_bladeContentWrapper_1ciqc_67",T="_bladeContent_1ciqc_51",W="_partContent_1ciqc_99",k="_toolbar_1ciqc_127",H="_toolbarContainer_1ciqc_145",E="_toolbarButton_1ciqc_161",D="_toolbarSeparator_1ciqc_239",L="_searchInputWrapper_1ciqc_253",R="_searchIcon_1ciqc_267",z="_searchInput_1ciqc_253",M="_overviewHr_1ciqc_385",A="_dockingBody_1ciqc_401",$="_scrollContainer_1ciqc_417",B="_autoLoadIndicator_1ciqc_473",P="_noData_1ciqc_497",V="_loadingBar_1ciqc_515",O="_refreshIconButton_1ciqc_965",U="_rotating_1ciqc_1057",G="_headerCellSort_1ciqc_1067",Q="_headerCellWith8Gap_1ciqc_1081",X="_headerCell_1ciqc_1067",Y="_sortIconFaded_1ciqc_1105",Z="_errorNotice_1ciqc_1113",J="_clearFiltersButton_1ciqc_1133",K="_noPadding_1ciqc_1141",ee="_centerText_1ciqc_1149",se="_iconError_1ciqc_1193",re="_textError_1ciqc_1205";const te=()=>{const{selectedDevice:te,treeData:ae,selectDevice:le,getNextDevice:ie,getFilteredDevices:oe}=t(),[ce,ne]=s.exports.useState([]),[de,xe]=s.exports.useState(!1),[he,pe]=s.exports.useState(null),[ue,me]=s.exports.useState(!1),[je,_e]=s.exports.useState(""),[fe,ve]=s.exports.useState("scheduleId"),[Ce,Ne]=s.exports.useState("ascending"),[be,ge]=s.exports.useState(new Set),[ye,Se]=s.exports.useState(!1),Ie=s.exports.useRef(!1),qe=s.exports.useRef(null),[we,Fe]=s.exports.useState(!1),Te=s.exports.useRef(!1);s.exports.useEffect((()=>{if(!te){const e=oe();e.length>0&&le(e[0])}}),[te,oe,le]);const We=s.exports.useCallback((async()=>{if(te){xe(!0),pe(null);try{const e=await fetch(`${a}/api/t3_device/devices/${te.serialNumber}/table/SCHEDULES`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();s.data&&Array.isArray(s.data)?ne(s.data):ne([])}catch(e){pe(e instanceof Error?e.message:"Failed to fetch schedules")}finally{xe(!1),me(!1)}}else ne([])}),[te]);s.exports.useEffect((()=>{We()}),[We]),s.exports.useEffect((()=>{ne([]),Se(!1),Ie.current=!1}),[null==te?void 0:te.serialNumber]),s.exports.useEffect((()=>{if(de||!te||ye||Ie.current)return;(async()=>{if(Ie.current=!0,ce.length>0)Se(!0);else try{const e=te.serialNumber;await u.refreshAllSchedules(e);await We(),Se(!0)}catch(e){}})()}),[de,te,ye,We,ce.length]);const ke=e=>{fe===e?Ne("ascending"===Ce?"descending":"ascending"):(ve(e),Ne("ascending"))},He=s.exports.useCallback((()=>{const e=ie();e&&(Fe(!0),le(e),setTimeout((()=>{Fe(!1)}),500))}),[ie,le]),Ee=s.exports.useCallback((e=>{if(we||de)return;const s=e.currentTarget;s.scrollHeight-s.scrollTop-s.clientHeight<=1&&ce.length>0?Te.current=!0:Te.current=!1}),[we,de,ce.length]),De=s.exports.useCallback((e=>{we||de||0===ce.length||e.deltaY>0&&Te.current&&(Te.current=!1,He())}),[we,de,ce.length,He]);s.exports.useEffect((()=>{te&&qe.current&&qe.current.scrollTo({top:0,behavior:we?"smooth":"auto"})}),[te,we]);const Le=r.useMemo((()=>0===ce.length?Array(10).fill(null).map(((e,s)=>({serialNumber:0,scheduleId:"",autoManual:"",outputField:"",variableField:"",holiday1:"",status1:"",holiday2:"",status2:"",intervalField:"",scheduleTime:"",mondayTime:"",tuesdayTime:"",wednesdayTime:"",thursdayTime:"",fridayTime:""}))):ce),[ce]),Re=e=>!e.scheduleId&&0===ce.length,ze=[v({columnId:"scheduleId",renderHeaderCell:()=>e.exports.jsxs("div",{className:G,onClick:()=>ke("scheduleId"),children:[e.exports.jsx("span",{children:"Schedule"}),"scheduleId"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Y})]}),renderCell:s=>{const r=s.scheduleId&&be.has(s.scheduleId);return e.exports.jsx(I,{children:!Re(s)&&e.exports.jsxs("div",{className:Q,children:[e.exports.jsx("button",{className:`${O} ${r?U:""}`,onClick:e=>{e.stopPropagation(),(async e=>{if(!te||!e.scheduleId)return;const s=e.scheduleId;ge((e=>new Set(e).add(s)));try{const r=te.serialNumber,t=parseInt(e.scheduleId);await u.refreshSingleSchedule(r,t),await We()}catch(r){}finally{ge((e=>{const r=new Set(e);return r.delete(s),r}))}})(s)},disabled:r,title:"Refresh this schedule from device","aria-label":"Refresh schedule",children:e.exports.jsx(o,{fontSize:16})}),e.exports.jsx("span",{children:s.scheduleId||"---"})]})})}}),v({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{className:X,children:e.exports.jsx("span",{children:"Auto/Man"})}),renderCell:s=>{const r="1"===s.autoManual;return e.exports.jsx(I,{children:!Re(s)&&e.exports.jsxs("div",{className:Q,children:[e.exports.jsx(f,{checked:r,onChange:()=>(async e=>{const s="1"===e.autoManual?"0":"1";ne((r=>r.map((r=>r.serialNumber===e.serialNumber&&r.scheduleId===e.scheduleId?{...r,autoManual:s}:r))))})(s)}),e.exports.jsx(i,{size:200,children:r?"AUTO":"MAN"})]})})}}),v({columnId:"outputField",renderHeaderCell:()=>e.exports.jsxs("div",{className:G,onClick:()=>ke("outputField"),children:[e.exports.jsx("span",{children:"Output"}),"outputField"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Y})]}),renderCell:s=>e.exports.jsx(I,{children:!Re(s)&&(s.outputField||"---")})}),v({columnId:"variableField",renderHeaderCell:()=>e.exports.jsxs("div",{className:G,onClick:()=>ke("variableField"),children:[e.exports.jsx("span",{children:"Variable"}),"variableField"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Y})]}),renderCell:s=>e.exports.jsx(I,{children:!Re(s)&&(s.variableField||"---")})}),v({columnId:"holiday1",renderHeaderCell:()=>e.exports.jsxs("div",{className:G,onClick:()=>ke("holiday1"),children:[e.exports.jsx("span",{children:"Holiday1"}),"holiday1"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Y})]}),renderCell:s=>e.exports.jsx(I,{children:!Re(s)&&(s.holiday1||"---")})}),v({columnId:"status1",renderHeaderCell:()=>e.exports.jsx("div",{className:X,children:e.exports.jsx("span",{children:"Label"})}),renderCell:s=>e.exports.jsx(I,{children:!Re(s)&&(s.status1||"---")})}),v({columnId:"holiday2",renderHeaderCell:()=>e.exports.jsxs("div",{className:G,onClick:()=>ke("holiday2"),children:[e.exports.jsx("span",{children:"Holiday2"}),"holiday2"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Y})]}),renderCell:s=>e.exports.jsx(I,{children:!Re(s)&&(s.holiday2||"---")})}),v({columnId:"status2",renderHeaderCell:()=>e.exports.jsx("div",{className:X,children:e.exports.jsx("span",{children:"Status"})}),renderCell:s=>e.exports.jsx(I,{children:!Re(s)&&(s.status2||"---")})})],Me=[...Le.filter((e=>{var s,r,t;return""===je||(null==(s=e.scheduleId)?void 0:s.toLowerCase().includes(je.toLowerCase()))||(null==(r=e.outputField)?void 0:r.toLowerCase().includes(je.toLowerCase()))||(null==(t=e.variableField)?void 0:t.toLowerCase().includes(je.toLowerCase()))}))].sort(((e,s)=>{const r=(e[fe]||"").toString(),t=(s[fe]||"").toString(),a=r.localeCompare(t);return"ascending"===Ce?a:-a}));return e.exports.jsx("div",{className:q,children:e.exports.jsx("div",{className:w,children:e.exports.jsx("div",{className:F,children:e.exports.jsx("div",{className:T,children:e.exports.jsxs("div",{className:W,children:[he&&e.exports.jsxs("div",{className:Z,children:[e.exports.jsx(l,{className:se}),e.exports.jsx(i,{className:re,children:he})]}),te&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:k,children:e.exports.jsxs("div",{className:H,children:[e.exports.jsxs("button",{className:E,onClick:async()=>{if(te){me(!0),pe(null);try{const e=te.serialNumber;await u.refreshAllSchedules(e);await We()}catch(e){pe(e instanceof Error?e.message:"Failed to refresh from device")}finally{me(!1)}}},disabled:ue,title:"Refresh from Device","aria-label":"Refresh from Device",children:[e.exports.jsx(o,{className:ue?U:""}),e.exports.jsx("span",{children:ue?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:E,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(c,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:D,role:"separator"}),e.exports.jsxs("button",{className:E,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(n,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:L,children:[e.exports.jsx(d,{className:R}),e.exports.jsx("input",{className:z,type:"text",placeholder:"Search schedules...",value:je,onChange:e=>{_e(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search schedules"})]}),e.exports.jsx(x,{content:`Showing schedule points for ${te.nameShowOnTree} (SN: ${te.serialNumber}). This table displays all configured weekly routine schedules including holidays, outputs, and status information.`,relationship:"description",children:e.exports.jsx("button",{className:`${E} ${J}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(h,{})})})]})}),e.exports.jsx("div",{className:K,children:e.exports.jsx("hr",{className:M})})]}),e.exports.jsxs("div",{className:A,children:[de&&0===ce.length&&e.exports.jsxs("div",{className:V,children:[e.exports.jsx(p,{size:"tiny"}),e.exports.jsx(i,{size:200,weight:"regular",children:"Loading schedules..."})]}),!te&&!de&&e.exports.jsx("div",{className:P,children:e.exports.jsxs("div",{className:ee,children:[e.exports.jsx(i,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(i,{size:200,children:"Please select a device from the tree to view schedules"})]})}),te&&!de&&e.exports.jsxs("div",{ref:qe,className:$,onScroll:Ee,onWheel:De,children:[e.exports.jsxs(C,{items:Me,columns:ze,sortable:!0,resizableColumns:!0,columnSizingOptions:{scheduleId:{minWidth:70,idealWidth:"10%"},autoManual:{minWidth:100,idealWidth:"15%"},outputField:{minWidth:80,idealWidth:"12%"},variableField:{minWidth:80,idealWidth:"12%"},holiday1:{minWidth:80,idealWidth:"15%"},status1:{minWidth:80,idealWidth:"12%"},holiday2:{minWidth:80,idealWidth:"12%"},status2:{minWidth:80,idealWidth:"12%"}},children:[e.exports.jsx(N,{children:e.exports.jsx(b,{children:({renderHeaderCell:s})=>e.exports.jsx(g,{children:s()})})}),e.exports.jsx(y,{children:({item:s,rowId:r})=>e.exports.jsx(b,{children:({renderCell:r})=>e.exports.jsx(S,{children:r(s)})},r)})]}),we&&e.exports.jsxs("div",{className:B,children:[e.exports.jsx(p,{size:"tiny"}),e.exports.jsx(i,{children:"Loading next device..."})]})]})]})]})})})})})};var ae=te;export{te as SchedulesPage,ae as default};

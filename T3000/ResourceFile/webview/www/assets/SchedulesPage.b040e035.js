import{j as e}from"./react.1acd1a13.js";import{r as s,R as t}from"./client.58f92968.js";import{l as r,M as a,n as l,T as o,y as i,N as n,z as d,P as c,Q as x,I as h,S as p,R as u,U as m,V as j,X as _,Z as f}from"./App.3fe38e41.js";import{c as v,D as C,a as N,b,d as g,e as y,f as z}from"./DataGridHeaderCell.f7016832.js";import{T as S}from"./TableCellLayout.9e29eb07.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";var I="_container_16tmz_11",w="_bladeContentContainer_16tmz_26",F="_bladeContentWrapper_16tmz_34",T="_bladeContent_16tmz_26",W="_partContent_16tmz_50",k="_toolbar_16tmz_64",H="_toolbarContainer_16tmz_73",E="_toolbarButton_16tmz_81",D="_toolbarSeparator_16tmz_120",L="_searchInputWrapper_16tmz_127",R="_searchIcon_16tmz_134",M="_searchInput_16tmz_127",A="_overviewHr_16tmz_193",$="_dockingBody_16tmz_201",B="_scrollContainer_16tmz_209",P="_autoLoadIndicator_16tmz_237",V="_noData_16tmz_249",O="_loadingBar_16tmz_258",U="_refreshIconButton_16tmz_483",G="_rotating_16tmz_529",Q="_headerCellSort_16tmz_534",X="_headerCellWith8Gap_16tmz_541",Y="_headerCell_16tmz_534",Z="_sortIconFaded_16tmz_553",q="_errorNotice_16tmz_557",J="_clearFiltersButton_16tmz_567",K="_noPadding_16tmz_571",ee="_centerText_16tmz_575",se="_iconError_16tmz_597",te="_textError_16tmz_603";const re=()=>{const{selectedDevice:re,treeData:ae,selectDevice:le,getNextDevice:oe,getFilteredDevices:ie}=r(),[ne,de]=s.exports.useState([]),[ce,xe]=s.exports.useState(!1),[he,pe]=s.exports.useState(null),[ue,me]=s.exports.useState(!1),[je,_e]=s.exports.useState(""),[fe,ve]=s.exports.useState("scheduleId"),[Ce,Ne]=s.exports.useState("ascending"),[be,ge]=s.exports.useState(new Set),[ye,ze]=s.exports.useState(!1),Se=s.exports.useRef(!1),Ie=s.exports.useRef(null),[we,Fe]=s.exports.useState(!1),Te=s.exports.useRef(!1);s.exports.useEffect((()=>{if(!re){const e=ie();e.length>0&&le(e[0])}}),[re,ie,le]);const We=s.exports.useCallback((async()=>{if(re){xe(!0),pe(null);try{const e=await fetch(`${a}/api/t3_device/devices/${re.serialNumber}/table/SCHEDULES`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();s.data&&Array.isArray(s.data)?de(s.data):de([])}catch(e){pe(e instanceof Error?e.message:"Failed to fetch schedules")}finally{xe(!1),me(!1)}}else de([])}),[re]);s.exports.useEffect((()=>{We()}),[We]),s.exports.useEffect((()=>{de([]),ze(!1),Se.current=!1}),[null==re?void 0:re.serialNumber]),s.exports.useEffect((()=>{if(ce||!re||ye||Se.current)return;(async()=>{if(Se.current=!0,ne.length>0)ze(!0);else try{const e=re.serialNumber;await u.refreshAllSchedules(e);await We(),ze(!0)}catch(e){}})()}),[ce,re,ye,We,ne.length]);const ke=e=>{fe===e?Ne("ascending"===Ce?"descending":"ascending"):(ve(e),Ne("ascending"))},He=s.exports.useCallback((()=>{const e=oe();e&&(Fe(!0),le(e),setTimeout((()=>{Fe(!1)}),500))}),[oe,le]),Ee=s.exports.useCallback((e=>{if(we||ce)return;const s=e.currentTarget;s.scrollHeight-s.scrollTop-s.clientHeight<=1&&ne.length>0?Te.current=!0:Te.current=!1}),[we,ce,ne.length]),De=s.exports.useCallback((e=>{we||ce||0===ne.length||e.deltaY>0&&Te.current&&(Te.current=!1,He())}),[we,ce,ne.length,He]);s.exports.useEffect((()=>{re&&Ie.current&&Ie.current.scrollTo({top:0,behavior:we?"smooth":"auto"})}),[re,we]);const Le=t.useMemo((()=>0===ne.length?Array(10).fill(null).map(((e,s)=>({serialNumber:0,scheduleId:"",autoManual:"",outputField:"",variableField:"",holiday1:"",status1:"",holiday2:"",status2:"",intervalField:"",scheduleTime:"",mondayTime:"",tuesdayTime:"",wednesdayTime:"",thursdayTime:"",fridayTime:""}))):ne),[ne]),Re=e=>!e.scheduleId&&0===ne.length,Me=[v({columnId:"scheduleId",renderHeaderCell:()=>e.exports.jsxs("div",{className:Q,onClick:()=>ke("scheduleId"),children:[e.exports.jsx("span",{children:"Schedule"}),"scheduleId"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Z})]}),renderCell:s=>{const t=s.scheduleId&&be.has(s.scheduleId);return e.exports.jsx(S,{children:!Re(s)&&e.exports.jsxs("div",{className:X,children:[e.exports.jsx("button",{className:`${U} ${t?G:""}`,onClick:e=>{e.stopPropagation(),(async e=>{if(!re||!e.scheduleId)return;const s=e.scheduleId;ge((e=>new Set(e).add(s)));try{const t=re.serialNumber,r=parseInt(e.scheduleId);await u.refreshSingleSchedule(t,r),await We()}catch(t){}finally{ge((e=>{const t=new Set(e);return t.delete(s),t}))}})(s)},disabled:t,title:"Refresh this schedule from device","aria-label":"Refresh schedule",children:e.exports.jsx(i,{fontSize:16})}),e.exports.jsx("span",{children:s.scheduleId||"---"})]})})}}),v({columnId:"autoManual",renderHeaderCell:()=>e.exports.jsx("div",{className:Y,children:e.exports.jsx("span",{children:"Auto/Man"})}),renderCell:s=>{const t="1"===s.autoManual;return e.exports.jsx(S,{children:!Re(s)&&e.exports.jsxs("div",{className:X,children:[e.exports.jsx(f,{checked:t,onChange:()=>(async e=>{const s="1"===e.autoManual?"0":"1";de((t=>t.map((t=>t.serialNumber===e.serialNumber&&t.scheduleId===e.scheduleId?{...t,autoManual:s}:t))))})(s)}),e.exports.jsx(o,{size:200,children:t?"AUTO":"MAN"})]})})}}),v({columnId:"outputField",renderHeaderCell:()=>e.exports.jsxs("div",{className:Q,onClick:()=>ke("outputField"),children:[e.exports.jsx("span",{children:"Output"}),"outputField"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Z})]}),renderCell:s=>e.exports.jsx(S,{children:!Re(s)&&(s.outputField||"---")})}),v({columnId:"variableField",renderHeaderCell:()=>e.exports.jsxs("div",{className:Q,onClick:()=>ke("variableField"),children:[e.exports.jsx("span",{children:"Variable"}),"variableField"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Z})]}),renderCell:s=>e.exports.jsx(S,{children:!Re(s)&&(s.variableField||"---")})}),v({columnId:"holiday1",renderHeaderCell:()=>e.exports.jsxs("div",{className:Q,onClick:()=>ke("holiday1"),children:[e.exports.jsx("span",{children:"Holiday1"}),"holiday1"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Z})]}),renderCell:s=>e.exports.jsx(S,{children:!Re(s)&&(s.holiday1||"---")})}),v({columnId:"status1",renderHeaderCell:()=>e.exports.jsx("div",{className:Y,children:e.exports.jsx("span",{children:"Label"})}),renderCell:s=>e.exports.jsx(S,{children:!Re(s)&&(s.status1||"---")})}),v({columnId:"holiday2",renderHeaderCell:()=>e.exports.jsxs("div",{className:Q,onClick:()=>ke("holiday2"),children:[e.exports.jsx("span",{children:"Holiday2"}),"holiday2"===fe?"ascending"===Ce?e.exports.jsx(m,{}):e.exports.jsx(j,{}):e.exports.jsx(_,{className:Z})]}),renderCell:s=>e.exports.jsx(S,{children:!Re(s)&&(s.holiday2||"---")})}),v({columnId:"status2",renderHeaderCell:()=>e.exports.jsx("div",{className:Y,children:e.exports.jsx("span",{children:"Status"})}),renderCell:s=>e.exports.jsx(S,{children:!Re(s)&&(s.status2||"---")})})],Ae=[...Le.filter((e=>{var s,t,r;return""===je||(null==(s=e.scheduleId)?void 0:s.toLowerCase().includes(je.toLowerCase()))||(null==(t=e.outputField)?void 0:t.toLowerCase().includes(je.toLowerCase()))||(null==(r=e.variableField)?void 0:r.toLowerCase().includes(je.toLowerCase()))}))].sort(((e,s)=>{const t=(e[fe]||"").toString(),r=(s[fe]||"").toString(),a=t.localeCompare(r);return"ascending"===Ce?a:-a}));return e.exports.jsx("div",{className:I,children:e.exports.jsx("div",{className:w,children:e.exports.jsx("div",{className:F,children:e.exports.jsx("div",{className:T,children:e.exports.jsxs("div",{className:W,children:[he&&e.exports.jsxs("div",{className:q,children:[e.exports.jsx(l,{className:se}),e.exports.jsx(o,{className:te,children:he})]}),re&&e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx("div",{className:k,children:e.exports.jsxs("div",{className:H,children:[e.exports.jsxs("button",{className:E,onClick:async()=>{if(re){me(!0),pe(null);try{const e=re.serialNumber;await u.refreshAllSchedules(e);await We()}catch(e){pe(e instanceof Error?e.message:"Failed to refresh from device")}finally{me(!1)}}},disabled:ue,title:"Refresh from Device","aria-label":"Refresh from Device",children:[e.exports.jsx(i,{className:ue?G:""}),e.exports.jsx("span",{children:ue?"Refreshing...":"Refresh from Device"})]}),e.exports.jsxs("button",{className:E,onClick:()=>{},title:"Export to CSV","aria-label":"Export to CSV",children:[e.exports.jsx(n,{}),e.exports.jsx("span",{children:"Export to CSV"})]}),e.exports.jsx("div",{className:D,role:"separator"}),e.exports.jsxs("button",{className:E,onClick:()=>{},title:"Settings","aria-label":"Settings",children:[e.exports.jsx(d,{}),e.exports.jsx("span",{children:"Settings"})]}),e.exports.jsxs("div",{className:L,children:[e.exports.jsx(c,{className:R}),e.exports.jsx("input",{className:M,type:"text",placeholder:"Search schedules...",value:je,onChange:e=>{_e(e.target.value)},spellCheck:"false",role:"searchbox","aria-label":"Search schedules"})]}),e.exports.jsx(x,{content:`Showing schedule points for ${re.nameShowOnTree} (SN: ${re.serialNumber}). This table displays all configured weekly routine schedules including holidays, outputs, and status information.`,relationship:"description",children:e.exports.jsx("button",{className:`${E} ${J}`,title:"Information","aria-label":"Information about this page",children:e.exports.jsx(h,{})})})]})}),e.exports.jsx("div",{className:K,children:e.exports.jsx("hr",{className:A})})]}),e.exports.jsxs("div",{className:$,children:[ce&&0===ne.length&&e.exports.jsxs("div",{className:O,children:[e.exports.jsx(p,{size:"tiny"}),e.exports.jsx(o,{size:200,weight:"regular",children:"Loading schedules..."})]}),!re&&!ce&&e.exports.jsx("div",{className:V,children:e.exports.jsxs("div",{className:ee,children:[e.exports.jsx(o,{size:400,weight:"semibold",children:"No device selected"}),e.exports.jsx("br",{}),e.exports.jsx(o,{size:200,children:"Please select a device from the tree to view schedules"})]})}),re&&!ce&&e.exports.jsxs("div",{ref:Ie,className:B,onScroll:Ee,onWheel:De,children:[e.exports.jsxs(C,{items:Ae,columns:Me,sortable:!0,resizableColumns:!0,columnSizingOptions:{scheduleId:{minWidth:70,idealWidth:"10%"},autoManual:{minWidth:100,idealWidth:"15%"},outputField:{minWidth:80,idealWidth:"12%"},variableField:{minWidth:80,idealWidth:"12%"},holiday1:{minWidth:80,idealWidth:"15%"},status1:{minWidth:80,idealWidth:"12%"},holiday2:{minWidth:80,idealWidth:"12%"},status2:{minWidth:80,idealWidth:"12%"}},children:[e.exports.jsx(N,{children:e.exports.jsx(b,{children:({renderHeaderCell:s})=>e.exports.jsx(g,{children:s()})})}),e.exports.jsx(y,{children:({item:s,rowId:t})=>e.exports.jsx(b,{children:({renderCell:t})=>e.exports.jsx(z,{children:t(s)})},t)})]}),we&&e.exports.jsxs("div",{className:P,children:[e.exports.jsx(p,{size:"tiny"}),e.exports.jsx(o,{children:"Loading next device..."})]})]})]})]})})})})})};var ae=re;export{re as SchedulesPage,ae as default};

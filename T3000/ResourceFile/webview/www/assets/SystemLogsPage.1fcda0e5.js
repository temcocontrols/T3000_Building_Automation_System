import{j as e}from"./react.1acd1a13.js";import{r as s}from"./client.58f92968.js";import{cK as t,T as l,a7 as o,B as a,y as i,N as r,b4 as n,aV as c,aW as x,v as p,aX as d,aY as h,aZ as m,ce as f,z as j,cL as _,aU as g,cM as y,c9 as v,cm as u,cN as S,S as z,cz as N,K as C,cO as b}from"./App.3fe38e41.js";import{T as I}from"./Tag.c9a5d60c.js";import{I as k}from"./Input.037b8c53.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";var L={container:"_container_hyeoh_1",header:"_header_hyeoh_9",headerLeft:"_headerLeft_hyeoh_20",headerActions:"_headerActions_hyeoh_26",filterBar:"_filterBar_hyeoh_32",mainContent:"_mainContent_hyeoh_42",filePanel:"_filePanel_hyeoh_51",filePanelHeader:"_filePanelHeader_hyeoh_60",fileList:"_fileList_hyeoh_69",fileListPlaceholder:"_fileListPlaceholder_hyeoh_94",fileItem:"_fileItem_hyeoh_102",fileItemActive:"_fileItemActive_hyeoh_117",fileIcon:"_fileIcon_hyeoh_122",fileInfo:"_fileInfo_hyeoh_127",fileChevron:"_fileChevron_hyeoh_135",logPanel:"_logPanel_hyeoh_148",logPlaceholder:"_logPlaceholder_hyeoh_156",logViewer:"_logViewer_hyeoh_166",logLine:"_logLine_hyeoh_180",logTimestamp:"_logTimestamp_hyeoh_186",logLevel:"_logLevel_hyeoh_191",levelERROR:"_levelERROR_hyeoh_199",levelWARN:"_levelWARN_hyeoh_204",levelINFO:"_levelINFO_hyeoh_209",levelDEBUG:"_levelDEBUG_hyeoh_214",logMessage:"_logMessage_hyeoh_219",footer:"_footer_hyeoh_224"};const w=()=>{var w;const[R,P]=s.exports.useState(!1),[A,$]=s.exports.useState(!1),[E,O]=s.exports.useState(""),[B,D]=s.exports.useState([]),[F,M]=s.exports.useState([]),[T,U]=s.exports.useState(null),[W,H]=s.exports.useState(""),[V,G]=s.exports.useState([]),[K,Y]=s.exports.useState([]),[q,X]=s.exports.useState("all"),[Z,J]=s.exports.useState("all"),[Q,ee]=s.exports.useState(""),[se,te]=s.exports.useState("all"),[le,oe]=s.exports.useState(0),ae=s.exports.useRef(null),ie=e=>{const s=e.match(/_([0-9]+)\.txt$/);return s?s[1]:"unknown"},re=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,ne=async e=>{if(e){P(!0);try{const s=await fetch(`http://localhost:9103/api/develop/logs/files?date=${encodeURIComponent(e)}`);if(s.ok){const e=await s.json(),t=e.map((e=>{const{category:s,icon:t,displayName:l}=(o=e.name).includes("T3_Webview_API_")?{category:"api",icon:"globe",displayName:"API Logs"}:o.includes("T3_CppMsg_BacnetWebView_")?{category:"cpp_msg",icon:"settings",displayName:"C++ Messages"}:o.includes("T3_CppMsg_HandWebViewMsg_")?{category:"handler",icon:"mail",displayName:"Message Handler"}:o.includes("T3_DatabaseSizeMonitor_")?{category:"database",icon:"database",displayName:"Database Monitor"}:o.includes("T3_PartitionMonitor_")?{category:"partition",icon:"storage",displayName:"Partition Monitor"}:o.includes("T3_Webview_FFI_")?{category:"ffi",icon:"plug",displayName:"FFI Operations"}:o.includes("T3_Webview_Initialize_")?{category:"initialize",icon:"rocket",displayName:"Initialize"}:o.includes("T3_Webview_Socket_")?{category:"socket",icon:"connector",displayName:"Socket Logs"}:{category:"all",icon:"document",displayName:"Other"};var o;return{name:e.name,category:s,size:e.size,pid:ie(e.name),icon:t,displayName:l}}));M(t),oe(e.reduce(((e,s)=>e+s.size),0)),t.length>0&&!T&&U(t[0])}}catch(s){}finally{P(!1)}}},ce=async(e,s)=>{P(!0);try{const t=await fetch(`http://localhost:9103/api/develop/logs/content?date=${encodeURIComponent(s)}&file=${encodeURIComponent(e.name)}`);if(t.ok){const e=await t.text();H(e),xe(e)}else H(""),G([])}catch(t){H(""),G([])}finally{P(!1)}},xe=e=>{const s=e.split("\n"),t=[];for(const l of s){if(!l.trim())continue;const e=l.match(/^\[([^\]]+)\]\s*\[(ERROR|WARN|INFO|DEBUG)\]\s*(.+)$/);e?t.push({timestamp:e[1],level:e[2],message:e[3],raw:l}):t.push({timestamp:"",level:"INFO",message:l,raw:l})}G(t)};s.exports.useEffect((()=>{let e=V;if("all"!==q&&(e=e.filter((e=>e.level===q))),Q){const s=Q.toLowerCase();e=e.filter((e=>e.message.toLowerCase().includes(s)||e.raw.toLowerCase().includes(s)))}Y(e)}),[V,q,Q]),s.exports.useEffect((()=>{(async()=>{try{const e=await fetch("http://localhost:9103/api/develop/logs/dates");if(e.ok){const s=await e.json();D(s),s.length>0&&!E&&O(s[0].path)}}catch(e){const s=new Date,t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;String(s.getDate()).padStart(2,"0");const l=`${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}`;O(`${t}/${l}`)}})()}),[]),s.exports.useEffect((()=>{E&&ne(E)}),[E]),s.exports.useEffect((()=>{T&&E&&ce(T,E)}),[T,E]),s.exports.useEffect((()=>{if(!A||!T||!E)return;const e=setInterval((()=>{ce(T,E)}),5e3);return()=>clearInterval(e)}),[A,T,E]);const pe=Array.from(new Set(F.map((e=>e.pid)))).sort(),de=F.filter((e=>("all"===Z||e.category===Z)&&("all"===se||e.pid===se)));return e.exports.jsxs("div",{className:L.container,children:[e.exports.jsxs("div",{className:L.header,children:[e.exports.jsxs("div",{className:L.headerLeft,children:[e.exports.jsx(t,{style:{fontSize:"18px",marginRight:"4px"}}),e.exports.jsx(l,{size:400,weight:"semibold",children:"T3000 Logs - Live Monitor"}),e.exports.jsxs(I,{appearance:"filled",color:"informative",size:"extra-small",shape:"square",style:{fontSize:"11px",padding:"2px 6px"},children:[F.length," files • ",re(le)]})]}),e.exports.jsxs("div",{className:L.headerActions,children:[e.exports.jsx(l,{size:200,children:"Auto"}),e.exports.jsx(o,{checked:A,onChange:(e,s)=>$(!!s.checked)}),e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(i,{fontSize:14}),onClick:()=>T&&E&&ce(T,E),disabled:R||!T,size:"small"}),e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(r,{fontSize:14}),onClick:()=>{if(!T)return;const e=new Blob([W],{type:"text/plain"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=T.name,t.click(),URL.revokeObjectURL(s)},disabled:!T,size:"small"}),e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(n,{fontSize:14}),onClick:async()=>{try{await fetch("http://localhost:9103/api/develop/logs/clear",{method:"POST"}),H(""),G([]),ne(E)}catch(e){}},size:"small"})]})]}),e.exports.jsxs("div",{className:L.filterBar,children:[e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(p,{}),size:"small",style:{fontSize:"12px"},children:(null==(w=B.find((e=>e.path===E)))?void 0:w.displayDate)||E||"Select Date"})}),e.exports.jsx(d,{children:e.exports.jsx(h,{children:0===B.length?e.exports.jsx(m,{disabled:!0,style:{fontSize:"12px"},children:"No dates available"}):B.map((s=>e.exports.jsx(m,{onClick:()=>O(s.path),style:{fontSize:"12px"},children:s.displayDate},s.path)))})})]}),e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(a,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["Category: ","all"===Z?"All":Z]})}),e.exports.jsx(d,{children:e.exports.jsxs(h,{children:[e.exports.jsx(m,{onClick:()=>J("all"),style:{fontSize:"12px"},children:"All Categories"}),e.exports.jsx(m,{onClick:()=>J("api"),style:{fontSize:"12px"},icon:e.exports.jsx(f,{}),children:"API"}),e.exports.jsx(m,{onClick:()=>J("cpp_msg"),style:{fontSize:"12px"},icon:e.exports.jsx(j,{}),children:"C++ Messages"}),e.exports.jsx(m,{onClick:()=>J("handler"),style:{fontSize:"12px"},icon:e.exports.jsx(_,{}),children:"Handler"}),e.exports.jsx(m,{onClick:()=>J("database"),style:{fontSize:"12px"},icon:e.exports.jsx(g,{}),children:"Database"}),e.exports.jsx(m,{onClick:()=>J("partition"),style:{fontSize:"12px"},icon:e.exports.jsx(y,{}),children:"Partition"}),e.exports.jsx(m,{onClick:()=>J("ffi"),style:{fontSize:"12px"},icon:e.exports.jsx(v,{}),children:"FFI"}),e.exports.jsx(m,{onClick:()=>J("initialize"),style:{fontSize:"12px"},icon:e.exports.jsx(u,{}),children:"Initialize"}),e.exports.jsx(m,{onClick:()=>J("socket"),style:{fontSize:"12px"},icon:e.exports.jsx(S,{}),children:"Socket"})]})})]}),e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(a,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["Level: ","all"===q?"All":q]})}),e.exports.jsx(d,{children:e.exports.jsxs(h,{children:[e.exports.jsx(m,{onClick:()=>X("all"),style:{fontSize:"12px"},children:"All Levels"}),e.exports.jsx(m,{onClick:()=>X("ERROR"),style:{fontSize:"12px"},children:"ERROR"}),e.exports.jsx(m,{onClick:()=>X("WARN"),style:{fontSize:"12px"},children:"WARN"}),e.exports.jsx(m,{onClick:()=>X("INFO"),style:{fontSize:"12px"},children:"INFO"}),e.exports.jsx(m,{onClick:()=>X("DEBUG"),style:{fontSize:"12px"},children:"DEBUG"})]})})]}),pe.length>1&&e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(a,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["PID: ","all"===se?"All":se]})}),e.exports.jsx(d,{children:e.exports.jsxs(h,{children:[e.exports.jsx(m,{onClick:()=>te("all"),style:{fontSize:"12px"},children:"All PIDs"}),pe.map((s=>e.exports.jsx(m,{onClick:()=>te(s),style:{fontSize:"12px"},children:s},s)))]})})]}),e.exports.jsx(k,{placeholder:"Search logs...",value:Q,onChange:(e,s)=>ee(s.value),size:"small",style:{flex:1,minWidth:"200px"}})]}),e.exports.jsxs("div",{className:L.mainContent,children:[e.exports.jsxs("div",{className:L.filePanel,children:[e.exports.jsx("div",{className:L.filePanelHeader,children:e.exports.jsx(l,{size:200,weight:"semibold",children:"Log Categories"})}),e.exports.jsx("div",{className:L.fileList,children:R&&0===F.length?e.exports.jsx("div",{className:L.fileListPlaceholder,children:e.exports.jsx(z,{size:"tiny"})}):0===de.length?e.exports.jsx("div",{className:L.fileListPlaceholder,children:e.exports.jsx(l,{size:200,children:"No log files"})}):de.map((s=>e.exports.jsxs("div",{className:`${L.fileItem} ${(null==T?void 0:T.name)===s.name?L.fileItemActive:""}`,onClick:()=>U(s),children:[e.exports.jsxs("div",{className:L.fileIcon,children:["globe"===s.icon&&e.exports.jsx(f,{}),"settings"===s.icon&&e.exports.jsx(j,{}),"mail"===s.icon&&e.exports.jsx(_,{}),"database"===s.icon&&e.exports.jsx(g,{}),"storage"===s.icon&&e.exports.jsx(y,{}),"plug"===s.icon&&e.exports.jsx(v,{}),"rocket"===s.icon&&e.exports.jsx(u,{}),"connector"===s.icon&&e.exports.jsx(S,{}),"document"===s.icon&&e.exports.jsx(N,{})]}),e.exports.jsxs("div",{className:L.fileInfo,children:[e.exports.jsx(l,{size:200,weight:"semibold",children:s.displayName}),e.exports.jsxs(l,{size:100,style:{color:"#605e5c"},children:[re(s.size)," • PID ",s.pid]})]}),e.exports.jsx(C,{className:L.fileChevron})]},s.name)))})]}),e.exports.jsxs("div",{className:L.logPanel,children:[R&&!W?e.exports.jsx("div",{className:L.logPlaceholder,children:e.exports.jsx(z,{label:"Loading log content..."})}):T?0===K.length?e.exports.jsxs("div",{className:L.logPlaceholder,children:[e.exports.jsx(b,{style:{fontSize:"48px",color:"#d2d0ce"}}),e.exports.jsx(l,{size:300,children:"No logs match the current filters"})]}):e.exports.jsx("div",{className:L.logViewer,ref:ae,children:K.map(((s,t)=>{return e.exports.jsxs("div",{className:L.logLine,children:[s.timestamp&&e.exports.jsxs("span",{className:L.logTimestamp,children:["[",s.timestamp,"]"]}),s.level&&"INFO"!==s.level&&e.exports.jsxs("span",{className:`${L.logLevel} ${l=s.level,L[`level${l}`]||L.levelINFO}`,children:["[",s.level,"]"]}),e.exports.jsx("span",{className:L.logMessage,children:s.message})]},t);var l}))}):e.exports.jsxs("div",{className:L.logPlaceholder,children:[e.exports.jsx(N,{style:{fontSize:"48px",color:"#d2d0ce"}}),e.exports.jsx(l,{size:300,children:"Select a log file to view"})]}),e.exports.jsxs("div",{className:L.footer,children:[e.exports.jsx(l,{size:200,style:{color:"#605e5c"},children:T?e.exports.jsxs(e.exports.Fragment,{children:[T.displayName," • ",K.length," entries",Q&&` • Search: "${Q}"`]}):`${F.length} log files available • ${re(le)} total`}),E&&e.exports.jsx(l,{size:200,style:{color:"#605e5c"},children:E})]})]})]})]})};export{w as SystemLogsPage,w as default};

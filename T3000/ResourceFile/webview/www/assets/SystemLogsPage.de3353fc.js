import{j as e}from"./react.8639cc86.js";import{r as s}from"./client.58f92968.js";import{cF as t,T as l,a7 as o,B as a,y as i,N as n,b4 as r,aV as c,aW as x,v as p,aX as d,aY as h,aZ as f,c8 as m,z as g,cG as j,aU as _,cH as y,c3 as u,cg as v,cI as S,S as z,cu as N,K as I,cJ as C}from"./App.7c34790a.js";import{T as L}from"./Tag.514c13c1.js";import{I as b}from"./Input.7691f421.js";import"./index.3bd6c859.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.63f93fe7.js";import"./_commonjsHelpers.a5007c1f.js";var k={container:"_container_16yet_1",header:"_header_16yet_9",headerLeft:"_headerLeft_16yet_20",headerActions:"_headerActions_16yet_26",filterBar:"_filterBar_16yet_32",mainContent:"_mainContent_16yet_42",filePanel:"_filePanel_16yet_51",filePanelHeader:"_filePanelHeader_16yet_60",fileList:"_fileList_16yet_69",fileListPlaceholder:"_fileListPlaceholder_16yet_94",fileItem:"_fileItem_16yet_102",fileItemActive:"_fileItemActive_16yet_117",fileIcon:"_fileIcon_16yet_122",fileInfo:"_fileInfo_16yet_127",fileChevron:"_fileChevron_16yet_135",logPanel:"_logPanel_16yet_148",logPlaceholder:"_logPlaceholder_16yet_156",logLoading:"_logLoading_16yet_166",logViewer:"_logViewer_16yet_175",logLine:"_logLine_16yet_189",logTimestamp:"_logTimestamp_16yet_195",logLevel:"_logLevel_16yet_200",levelERROR:"_levelERROR_16yet_208",levelWARN:"_levelWARN_16yet_213",levelINFO:"_levelINFO_16yet_218",levelDEBUG:"_levelDEBUG_16yet_223",logMessage:"_logMessage_16yet_228",footer:"_footer_16yet_233"};const R=()=>{var R;const[w,A]=s.exports.useState(!1),[P,F]=s.exports.useState(!1),[$,E]=s.exports.useState(""),[B,D]=s.exports.useState([]),[O,U]=s.exports.useState([]),[M,T]=s.exports.useState(null),[W,H]=s.exports.useState(""),[G,V]=s.exports.useState([]),[K,Y]=s.exports.useState([]),[q,J]=s.exports.useState("all"),[X,Z]=s.exports.useState("all"),[Q,ee]=s.exports.useState(""),[se,te]=s.exports.useState("all"),[le,oe]=s.exports.useState(0),ae=s.exports.useRef(null),ie=e=>{const s=e.match(/_([0-9]+)\.txt$/);return s?s[1]:"unknown"},ne=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,re=async e=>{if(e){A(!0);try{console.log("ðŸ“ Loading log files for date:",e);const s=await fetch(`${API_BASE_URL}/files?date=${encodeURIComponent(e)}`);if(console.log("ðŸ“ Response status:",s.status),s.ok){const e=await s.json();console.log("ðŸ“ Loaded files:",e);const t=e.map((e=>{const{category:s,icon:t,displayName:l}=(o=e.name).includes("T3_Webview_API_")?{category:"api",icon:"globe",displayName:"API Logs"}:o.includes("T3_CppMsg_BacnetWebView_")?{category:"cpp_msg",icon:"settings",displayName:"C++ Messages"}:o.includes("T3_CppMsg_HandWebViewMsg_")?{category:"handler",icon:"mail",displayName:"Message Handler"}:o.includes("T3_DatabaseSizeMonitor_")?{category:"database",icon:"database",displayName:"Database Monitor"}:o.includes("T3_PartitionMonitor_")?{category:"partition",icon:"storage",displayName:"Partition Monitor"}:o.includes("T3_Webview_FFI_")?{category:"ffi",icon:"plug",displayName:"FFI Operations"}:o.includes("T3_Webview_Initialize_")?{category:"initialize",icon:"rocket",displayName:"Initialize"}:o.includes("T3_Webview_Socket_")?{category:"socket",icon:"connector",displayName:"Socket Logs"}:{category:"all",icon:"document",displayName:"Other"};var o;return{name:e.name,category:s,size:e.size,pid:ie(e.name),icon:t,displayName:l}}));U(t),oe(e.reduce(((e,s)=>e+s.size),0)),t.length>0&&!M&&(console.log("ðŸ“ Auto-selecting first file:",t[0]),T(t[0]))}else console.error("ðŸ“ Failed to load files, status:",s.status)}catch(s){console.error("ðŸ“ Failed to load log files:",s)}finally{A(!1)}}},ce=async(e,s)=>{A(!0);try{console.log("ðŸ“„ Loading log content:",e.name,"for date:",s);const t=await fetch(`${API_BASE_URL}/content?date=${encodeURIComponent(s)}&file=${encodeURIComponent(e.name)}`);if(console.log("ðŸ“„ Response status:",t.status),t.ok){const e=await t.text();console.log("ðŸ“„ Loaded content, length:",e.length),H(e),xe(e)}else console.error("ðŸ“„ Failed to load content, status:",t.status),H(""),V([])}catch(t){console.error("ðŸ“„ Failed to load log content:",t),H(""),V([])}finally{A(!1)}},xe=e=>{const s=e.split("\n"),t=[];for(const l of s){if(!l.trim())continue;const e=l.match(/^\[([^\]]+)\]\s*\[(ERROR|WARN|INFO|DEBUG)\]\s*(.+)$/);e?t.push({timestamp:e[1],level:e[2],message:e[3],raw:l}):t.push({timestamp:"",level:"INFO",message:l,raw:l})}V(t)};s.exports.useEffect((()=>{let e=G;if("all"!==q&&(e=e.filter((e=>e.level===q))),Q){const s=Q.toLowerCase();e=e.filter((e=>e.message.toLowerCase().includes(s)||e.raw.toLowerCase().includes(s)))}Y(e)}),[G,q,Q]),s.exports.useEffect((()=>{(async()=>{try{const e=await fetch(`${API_BASE_URL}/dates`);if(e.ok){const s=await e.json();D(s),s.length>0&&!$&&E(s[0].path)}else console.error("ðŸ“… Failed to load dates, status:",e.status)}catch(e){console.error("ðŸ“… Failed to load dates:",e);const s=new Date,t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;String(s.getDate()).padStart(2,"0");const l=`${t}/${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}`;console.log("ðŸ“… Using fallback date:",l),E(l)}})()}),[]),s.exports.useEffect((()=>{$&&re($)}),[$]),s.exports.useEffect((()=>{M&&$&&ce(M,$)}),[M,$]),s.exports.useEffect((()=>{if(!P||!M||!$)return;const e=setInterval((()=>{ce(M,$)}),5e3);return()=>clearInterval(e)}),[P,M,$]);const pe=Array.from(new Set(O.map((e=>e.pid)))).sort(),de=O.filter((e=>("all"===X||e.category===X)&&("all"===se||e.pid===se)));return e.exports.jsxs("div",{className:k.container,children:[e.exports.jsxs("div",{className:k.header,children:[e.exports.jsxs("div",{className:k.headerLeft,children:[e.exports.jsx(t,{style:{fontSize:"18px",marginRight:"4px"}}),e.exports.jsx(l,{size:400,weight:"semibold",children:"T3000 Logs - Live Monitor"}),e.exports.jsxs(L,{appearance:"filled",color:"informative",size:"extra-small",shape:"square",style:{fontSize:"11px",padding:"2px 6px"},children:[O.length," files â€¢ ",ne(le)]})]}),e.exports.jsxs("div",{className:k.headerActions,children:[e.exports.jsx(l,{size:200,children:"Auto"}),e.exports.jsx(o,{checked:P,onChange:(e,s)=>F(!!s.checked)}),e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(i,{fontSize:14}),onClick:()=>M&&$&&ce(M,$),disabled:w||!M,size:"small"}),e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(n,{fontSize:14}),onClick:()=>{if(!M)return;const e=new Blob([W],{type:"text/plain"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=M.name,t.click(),URL.revokeObjectURL(s)},disabled:!M,size:"small"}),e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(r,{fontSize:14}),onClick:async()=>{try{await fetch(`${API_BASE_URL}/clear`,{method:"POST"}),H(""),V([]),re($)}catch(e){console.error("Failed to clear logs:",e)}},size:"small"})]})]}),e.exports.jsxs("div",{className:k.filterBar,children:[e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsx(a,{appearance:"subtle",icon:e.exports.jsx(p,{}),size:"small",style:{fontSize:"12px"},children:(null==(R=B.find((e=>e.path===$)))?void 0:R.displayDate)||$||"Select Date"})}),e.exports.jsx(d,{children:e.exports.jsx(h,{children:0===B.length?e.exports.jsx(f,{disabled:!0,style:{fontSize:"12px"},children:"No dates available"}):B.map((s=>e.exports.jsx(f,{onClick:()=>E(s.path),style:{fontSize:"12px"},children:s.displayDate},s.path)))})})]}),e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(a,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["Category: ","all"===X?"All":X]})}),e.exports.jsx(d,{children:e.exports.jsxs(h,{children:[e.exports.jsx(f,{onClick:()=>Z("all"),style:{fontSize:"12px"},children:"All Categories"}),e.exports.jsx(f,{onClick:()=>Z("api"),style:{fontSize:"12px"},icon:e.exports.jsx(m,{}),children:"API"}),e.exports.jsx(f,{onClick:()=>Z("cpp_msg"),style:{fontSize:"12px"},icon:e.exports.jsx(g,{}),children:"C++ Messages"}),e.exports.jsx(f,{onClick:()=>Z("handler"),style:{fontSize:"12px"},icon:e.exports.jsx(j,{}),children:"Handler"}),e.exports.jsx(f,{onClick:()=>Z("database"),style:{fontSize:"12px"},icon:e.exports.jsx(_,{}),children:"Database"}),e.exports.jsx(f,{onClick:()=>Z("partition"),style:{fontSize:"12px"},icon:e.exports.jsx(y,{}),children:"Partition"}),e.exports.jsx(f,{onClick:()=>Z("ffi"),style:{fontSize:"12px"},icon:e.exports.jsx(u,{}),children:"FFI"}),e.exports.jsx(f,{onClick:()=>Z("initialize"),style:{fontSize:"12px"},icon:e.exports.jsx(v,{}),children:"Initialize"}),e.exports.jsx(f,{onClick:()=>Z("socket"),style:{fontSize:"12px"},icon:e.exports.jsx(S,{}),children:"Socket"})]})})]}),e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(a,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["Level: ","all"===q?"All":q]})}),e.exports.jsx(d,{children:e.exports.jsxs(h,{children:[e.exports.jsx(f,{onClick:()=>J("all"),style:{fontSize:"12px"},children:"All Levels"}),e.exports.jsx(f,{onClick:()=>J("ERROR"),style:{fontSize:"12px"},children:"ERROR"}),e.exports.jsx(f,{onClick:()=>J("WARN"),style:{fontSize:"12px"},children:"WARN"}),e.exports.jsx(f,{onClick:()=>J("INFO"),style:{fontSize:"12px"},children:"INFO"}),e.exports.jsx(f,{onClick:()=>J("DEBUG"),style:{fontSize:"12px"},children:"DEBUG"})]})})]}),pe.length>1&&e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(a,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["PID: ","all"===se?"All":se]})}),e.exports.jsx(d,{children:e.exports.jsxs(h,{children:[e.exports.jsx(f,{onClick:()=>te("all"),style:{fontSize:"12px"},children:"All PIDs"}),pe.map((s=>e.exports.jsx(f,{onClick:()=>te(s),style:{fontSize:"12px"},children:s},s)))]})})]}),e.exports.jsx(b,{placeholder:"Search logs...",value:Q,onChange:(e,s)=>ee(s.value),size:"small",style:{flex:1,minWidth:"200px"}})]}),e.exports.jsxs("div",{className:k.mainContent,children:[e.exports.jsxs("div",{className:k.filePanel,children:[e.exports.jsx("div",{className:k.filePanelHeader,children:e.exports.jsx(l,{size:200,weight:"semibold",children:"Log Categories"})}),e.exports.jsx("div",{className:k.fileList,children:w&&0===O.length?e.exports.jsx("div",{className:k.fileListPlaceholder,children:e.exports.jsx(z,{size:"tiny"})}):0===de.length?e.exports.jsx("div",{className:k.fileListPlaceholder,children:e.exports.jsx(l,{size:200,children:"No log files"})}):de.map((s=>e.exports.jsxs("div",{className:`${k.fileItem} ${(null==M?void 0:M.name)===s.name?k.fileItemActive:""}`,onClick:()=>T(s),children:[e.exports.jsxs("div",{className:k.fileIcon,children:["globe"===s.icon&&e.exports.jsx(m,{}),"settings"===s.icon&&e.exports.jsx(g,{}),"mail"===s.icon&&e.exports.jsx(j,{}),"database"===s.icon&&e.exports.jsx(_,{}),"storage"===s.icon&&e.exports.jsx(y,{}),"plug"===s.icon&&e.exports.jsx(u,{}),"rocket"===s.icon&&e.exports.jsx(v,{}),"connector"===s.icon&&e.exports.jsx(S,{}),"document"===s.icon&&e.exports.jsx(N,{})]}),e.exports.jsxs("div",{className:k.fileInfo,children:[e.exports.jsx(l,{size:200,weight:"semibold",children:s.displayName}),e.exports.jsxs(l,{size:100,style:{color:"#605e5c"},children:[ne(s.size)," â€¢ PID ",s.pid]})]}),e.exports.jsx(I,{className:k.fileChevron})]},s.name)))})]}),e.exports.jsxs("div",{className:k.logPanel,children:[w&&!W?e.exports.jsxs("div",{className:k.logLoading,children:[e.exports.jsx(z,{size:"tiny"}),e.exports.jsx(l,{size:200,weight:"regular",children:"Loading log content..."})]}):M?0===K.length?e.exports.jsxs("div",{className:k.logPlaceholder,children:[e.exports.jsx(C,{style:{fontSize:"48px",color:"#d2d0ce"}}),e.exports.jsx(l,{size:300,children:"No logs match the current filters"})]}):e.exports.jsx("div",{className:k.logViewer,ref:ae,children:K.map(((s,t)=>{return e.exports.jsxs("div",{className:k.logLine,children:[s.timestamp&&e.exports.jsxs("span",{className:k.logTimestamp,children:["[",s.timestamp,"]"]}),s.level&&"INFO"!==s.level&&e.exports.jsxs("span",{className:`${k.logLevel} ${l=s.level,k[`level${l}`]||k.levelINFO}`,children:["[",s.level,"]"]}),e.exports.jsx("span",{className:k.logMessage,children:s.message})]},t);var l}))}):e.exports.jsxs("div",{className:k.logPlaceholder,children:[e.exports.jsx(N,{style:{fontSize:"48px",color:"#d2d0ce"}}),e.exports.jsx(l,{size:300,children:"Select a log file to view"})]}),e.exports.jsxs("div",{className:k.footer,children:[e.exports.jsx(l,{size:200,style:{color:"#605e5c"},children:M?e.exports.jsxs(e.exports.Fragment,{children:[M.displayName," â€¢ ",K.length," entries",Q&&` â€¢ Search: "${Q}"`]}):`${O.length} log files available â€¢ ${ne(le)} total`}),$&&e.exports.jsx(l,{size:200,style:{color:"#605e5c"},children:$})]})]})]})]})};export{R as SystemLogsPage,R as default};

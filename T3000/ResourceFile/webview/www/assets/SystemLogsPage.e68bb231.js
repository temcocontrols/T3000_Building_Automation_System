import{j as e}from"./react.3bc90b5d.js";import{r as s}from"./client.58f92968.js";import{cH as t,T as l,a7 as a,B as i,h as o,N as r,b4 as n,aV as c,aW as x,e as p,aX as d,aY as m,aZ as f,cb as h,i as j,cI as _,aU as g,cJ as y,c6 as u,cj as v,cK as S,S as k,cx as z,l as N,cL as I}from"./App.4ea21eda.js";import{T as C}from"./Tag.fd14608a.js";import{I as b}from"./Input.4fa0d50c.js";import"./index.f111124c.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.f6c34e59.js";import"./_commonjsHelpers.a5007c1f.js";var L={container:"_container_amtfk_1",header:"_header_amtfk_17",headerLeft:"_headerLeft_amtfk_39",headerActions:"_headerActions_amtfk_51",filterBar:"_filterBar_amtfk_63",mainContent:"_mainContent_amtfk_83",filePanel:"_filePanel_amtfk_101",filePanelHeader:"_filePanelHeader_amtfk_119",fileList:"_fileList_amtfk_137",fileListPlaceholder:"_fileListPlaceholder_amtfk_187",fileItem:"_fileItem_amtfk_203",fileItemActive:"_fileItemActive_amtfk_233",fileIcon:"_fileIcon_amtfk_243",fileInfo:"_fileInfo_amtfk_253",fileChevron:"_fileChevron_amtfk_269",logPanel:"_logPanel_amtfk_295",logPlaceholder:"_logPlaceholder_amtfk_311",logLoading:"_logLoading_amtfk_331",logViewer:"_logViewer_amtfk_349",logLine:"_logLine_amtfk_377",logTimestamp:"_logTimestamp_amtfk_389",logLevel:"_logLevel_amtfk_399",levelERROR:"_levelERROR_amtfk_415",levelWARN:"_levelWARN_amtfk_425",levelINFO:"_levelINFO_amtfk_435",levelDEBUG:"_levelDEBUG_amtfk_445",logMessage:"_logMessage_amtfk_455",footer:"_footer_amtfk_465"};const R=()=>{var R;const[w,A]=s.exports.useState(!1),[P,$]=s.exports.useState(!1),[E,B]=s.exports.useState(""),[D,F]=s.exports.useState([]),[O,M]=s.exports.useState([]),[T,U]=s.exports.useState(null),[W,H]=s.exports.useState(""),[V,G]=s.exports.useState([]),[K,Y]=s.exports.useState([]),[q,J]=s.exports.useState("all"),[X,Z]=s.exports.useState("all"),[Q,ee]=s.exports.useState(""),[se,te]=s.exports.useState("all"),[le,ae]=s.exports.useState(0),ie=s.exports.useRef(null),oe=e=>{const s=e.match(/_([0-9]+)\.txt$/);return s?s[1]:"unknown"},re=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,ne=async e=>{if(e){A(!0);try{const s=await fetch(`${API_BASE_URL}/files?date=${encodeURIComponent(e)}`);if(s.ok){const e=await s.json(),t=e.map((e=>{const{category:s,icon:t,displayName:l}=(a=e.name).includes("T3_Webview_API_")?{category:"api",icon:"globe",displayName:"API Logs"}:a.includes("T3_CppMsg_BacnetWebView_")?{category:"cpp_msg",icon:"settings",displayName:"C++ Messages"}:a.includes("T3_CppMsg_HandWebViewMsg_")?{category:"handler",icon:"mail",displayName:"Message Handler"}:a.includes("T3_DatabaseSizeMonitor_")?{category:"database",icon:"database",displayName:"Database Monitor"}:a.includes("T3_PartitionMonitor_")?{category:"partition",icon:"storage",displayName:"Partition Monitor"}:a.includes("T3_Webview_FFI_")?{category:"ffi",icon:"plug",displayName:"FFI Operations"}:a.includes("T3_Webview_Initialize_")?{category:"initialize",icon:"rocket",displayName:"Initialize"}:a.includes("T3_Webview_Socket_")?{category:"socket",icon:"connector",displayName:"Socket Logs"}:{category:"all",icon:"document",displayName:"Other"};var a;return{name:e.name,category:s,size:e.size,pid:oe(e.name),icon:t,displayName:l}}));M(t),ae(e.reduce(((e,s)=>e+s.size),0)),t.length>0&&!T&&U(t[0])}}catch(s){}finally{A(!1)}}},ce=async(e,s)=>{A(!0);try{const t=await fetch(`${API_BASE_URL}/content?date=${encodeURIComponent(s)}&file=${encodeURIComponent(e.name)}`);if(t.ok){const e=await t.text();H(e),xe(e)}else H(""),G([])}catch(t){H(""),G([])}finally{A(!1)}},xe=e=>{const s=e.split("\n"),t=[];for(const l of s){if(!l.trim())continue;const e=l.match(/^\[([^\]]+)\]\s*\[(ERROR|WARN|INFO|DEBUG)\]\s*(.+)$/);e?t.push({timestamp:e[1],level:e[2],message:e[3],raw:l}):t.push({timestamp:"",level:"INFO",message:l,raw:l})}G(t)};s.exports.useEffect((()=>{let e=V;if("all"!==q&&(e=e.filter((e=>e.level===q))),Q){const s=Q.toLowerCase();e=e.filter((e=>e.message.toLowerCase().includes(s)||e.raw.toLowerCase().includes(s)))}Y(e)}),[V,q,Q]),s.exports.useEffect((()=>{(async()=>{try{const e=await fetch(`${API_BASE_URL}/dates`);if(e.ok){const s=await e.json();F(s),s.length>0&&!E&&B(s[0].path)}}catch(e){const s=new Date,t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;String(s.getDate()).padStart(2,"0");const l=`${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}`;B(`${t}/${l}`)}})()}),[]),s.exports.useEffect((()=>{E&&ne(E)}),[E]),s.exports.useEffect((()=>{T&&E&&ce(T,E)}),[T,E]),s.exports.useEffect((()=>{if(!P||!T||!E)return;const e=setInterval((()=>{ce(T,E)}),5e3);return()=>clearInterval(e)}),[P,T,E]);const pe=Array.from(new Set(O.map((e=>e.pid)))).sort(),de=O.filter((e=>("all"===X||e.category===X)&&("all"===se||e.pid===se)));return e.exports.jsxs("div",{className:L.container,children:[e.exports.jsxs("div",{className:L.header,children:[e.exports.jsxs("div",{className:L.headerLeft,children:[e.exports.jsx(t,{style:{fontSize:"18px",marginRight:"4px"}}),e.exports.jsx(l,{size:400,weight:"semibold",children:"T3000 Logs - Live Monitor"}),e.exports.jsxs(C,{appearance:"filled",color:"informative",size:"extra-small",shape:"square",style:{fontSize:"11px",padding:"2px 6px"},children:[O.length," files • ",re(le)]})]}),e.exports.jsxs("div",{className:L.headerActions,children:[e.exports.jsx(l,{size:200,children:"Auto"}),e.exports.jsx(a,{checked:P,onChange:(e,s)=>$(!!s.checked)}),e.exports.jsx(i,{appearance:"subtle",icon:e.exports.jsx(o,{fontSize:14}),onClick:()=>T&&E&&ce(T,E),disabled:w||!T,size:"small"}),e.exports.jsx(i,{appearance:"subtle",icon:e.exports.jsx(r,{fontSize:14}),onClick:()=>{if(!T)return;const e=new Blob([W],{type:"text/plain"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=T.name,t.click(),URL.revokeObjectURL(s)},disabled:!T,size:"small"}),e.exports.jsx(i,{appearance:"subtle",icon:e.exports.jsx(n,{fontSize:14}),onClick:async()=>{try{await fetch(`${API_BASE_URL}/clear`,{method:"POST"}),H(""),G([]),ne(E)}catch(e){}},size:"small"})]})]}),e.exports.jsxs("div",{className:L.filterBar,children:[e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsx(i,{appearance:"subtle",icon:e.exports.jsx(p,{}),size:"small",style:{fontSize:"12px"},children:(null==(R=D.find((e=>e.path===E)))?void 0:R.displayDate)||E||"Select Date"})}),e.exports.jsx(d,{children:e.exports.jsx(m,{children:0===D.length?e.exports.jsx(f,{disabled:!0,style:{fontSize:"12px"},children:"No dates available"}):D.map((s=>e.exports.jsx(f,{onClick:()=>B(s.path),style:{fontSize:"12px"},children:s.displayDate},s.path)))})})]}),e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(i,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["Category: ","all"===X?"All":X]})}),e.exports.jsx(d,{children:e.exports.jsxs(m,{children:[e.exports.jsx(f,{onClick:()=>Z("all"),style:{fontSize:"12px"},children:"All Categories"}),e.exports.jsx(f,{onClick:()=>Z("api"),style:{fontSize:"12px"},icon:e.exports.jsx(h,{}),children:"API"}),e.exports.jsx(f,{onClick:()=>Z("cpp_msg"),style:{fontSize:"12px"},icon:e.exports.jsx(j,{}),children:"C++ Messages"}),e.exports.jsx(f,{onClick:()=>Z("handler"),style:{fontSize:"12px"},icon:e.exports.jsx(_,{}),children:"Handler"}),e.exports.jsx(f,{onClick:()=>Z("database"),style:{fontSize:"12px"},icon:e.exports.jsx(g,{}),children:"Database"}),e.exports.jsx(f,{onClick:()=>Z("partition"),style:{fontSize:"12px"},icon:e.exports.jsx(y,{}),children:"Partition"}),e.exports.jsx(f,{onClick:()=>Z("ffi"),style:{fontSize:"12px"},icon:e.exports.jsx(u,{}),children:"FFI"}),e.exports.jsx(f,{onClick:()=>Z("initialize"),style:{fontSize:"12px"},icon:e.exports.jsx(v,{}),children:"Initialize"}),e.exports.jsx(f,{onClick:()=>Z("socket"),style:{fontSize:"12px"},icon:e.exports.jsx(S,{}),children:"Socket"})]})})]}),e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(i,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["Level: ","all"===q?"All":q]})}),e.exports.jsx(d,{children:e.exports.jsxs(m,{children:[e.exports.jsx(f,{onClick:()=>J("all"),style:{fontSize:"12px"},children:"All Levels"}),e.exports.jsx(f,{onClick:()=>J("ERROR"),style:{fontSize:"12px"},children:"ERROR"}),e.exports.jsx(f,{onClick:()=>J("WARN"),style:{fontSize:"12px"},children:"WARN"}),e.exports.jsx(f,{onClick:()=>J("INFO"),style:{fontSize:"12px"},children:"INFO"}),e.exports.jsx(f,{onClick:()=>J("DEBUG"),style:{fontSize:"12px"},children:"DEBUG"})]})})]}),pe.length>1&&e.exports.jsxs(c,{children:[e.exports.jsx(x,{disableButtonEnhancement:!0,children:e.exports.jsxs(i,{appearance:"subtle",size:"small",style:{fontSize:"12px"},children:["PID: ","all"===se?"All":se]})}),e.exports.jsx(d,{children:e.exports.jsxs(m,{children:[e.exports.jsx(f,{onClick:()=>te("all"),style:{fontSize:"12px"},children:"All PIDs"}),pe.map((s=>e.exports.jsx(f,{onClick:()=>te(s),style:{fontSize:"12px"},children:s},s)))]})})]}),e.exports.jsx(b,{placeholder:"Search logs...",value:Q,onChange:(e,s)=>ee(s.value),size:"small",style:{flex:1,minWidth:"200px"}})]}),e.exports.jsxs("div",{className:L.mainContent,children:[e.exports.jsxs("div",{className:L.filePanel,children:[e.exports.jsx("div",{className:L.filePanelHeader,children:e.exports.jsx(l,{size:200,weight:"semibold",children:"Log Categories"})}),e.exports.jsx("div",{className:L.fileList,children:w&&0===O.length?e.exports.jsx("div",{className:L.fileListPlaceholder,children:e.exports.jsx(k,{size:"tiny"})}):0===de.length?e.exports.jsx("div",{className:L.fileListPlaceholder,children:e.exports.jsx(l,{size:200,children:"No log files"})}):de.map((s=>e.exports.jsxs("div",{className:`${L.fileItem} ${(null==T?void 0:T.name)===s.name?L.fileItemActive:""}`,onClick:()=>U(s),children:[e.exports.jsxs("div",{className:L.fileIcon,children:["globe"===s.icon&&e.exports.jsx(h,{}),"settings"===s.icon&&e.exports.jsx(j,{}),"mail"===s.icon&&e.exports.jsx(_,{}),"database"===s.icon&&e.exports.jsx(g,{}),"storage"===s.icon&&e.exports.jsx(y,{}),"plug"===s.icon&&e.exports.jsx(u,{}),"rocket"===s.icon&&e.exports.jsx(v,{}),"connector"===s.icon&&e.exports.jsx(S,{}),"document"===s.icon&&e.exports.jsx(z,{})]}),e.exports.jsxs("div",{className:L.fileInfo,children:[e.exports.jsx(l,{size:200,weight:"semibold",children:s.displayName}),e.exports.jsxs(l,{size:100,style:{color:"#605e5c"},children:[re(s.size)," • PID ",s.pid]})]}),e.exports.jsx(N,{className:L.fileChevron})]},s.name)))})]}),e.exports.jsxs("div",{className:L.logPanel,children:[w&&!W?e.exports.jsxs("div",{className:L.logLoading,children:[e.exports.jsx(k,{size:"tiny"}),e.exports.jsx(l,{size:200,weight:"regular",children:"Loading log content..."})]}):T?0===K.length?e.exports.jsxs("div",{className:L.logPlaceholder,children:[e.exports.jsx(I,{style:{fontSize:"48px",color:"#d2d0ce"}}),e.exports.jsx(l,{size:300,children:"No logs match the current filters"})]}):e.exports.jsx("div",{className:L.logViewer,ref:ie,children:K.map(((s,t)=>{return e.exports.jsxs("div",{className:L.logLine,children:[s.timestamp&&e.exports.jsxs("span",{className:L.logTimestamp,children:["[",s.timestamp,"]"]}),s.level&&"INFO"!==s.level&&e.exports.jsxs("span",{className:`${L.logLevel} ${l=s.level,L[`level${l}`]||L.levelINFO}`,children:["[",s.level,"]"]}),e.exports.jsx("span",{className:L.logMessage,children:s.message})]},t);var l}))}):e.exports.jsxs("div",{className:L.logPlaceholder,children:[e.exports.jsx(z,{style:{fontSize:"48px",color:"#d2d0ce"}}),e.exports.jsx(l,{size:300,children:"Select a log file to view"})]}),e.exports.jsxs("div",{className:L.footer,children:[e.exports.jsx(l,{size:200,style:{color:"#605e5c"},children:T?e.exports.jsxs(e.exports.Fragment,{children:[T.displayName," • ",K.length," entries",Q&&` • Search: "${Q}"`]}):`${O.length} log files available • ${re(le)} total`}),E&&e.exports.jsx(l,{size:200,style:{color:"#605e5c"},children:E})]})]})]})]})};export{R as SystemLogsPage,R as default};

import{j as e}from"./react.1acd1a13.js";import{r as s}from"./client.58f92968.js";import{l as t,M as r,n as a,T as l,C as n,B as o,y as i,Q as d,I as x,S as c}from"./App.3fe38e41.js";import{c as p,D as u,a as m,b as h,d as f,e as j,f as b}from"./DataGridHeaderCell.f7016832.js";import{T as _}from"./TableCellLayout.9e29eb07.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";var v="_container_1642z_35",g="_bladeContentContainer_1642z_59",y="_bladeContentWrapper_1642z_75",C="_bladeContent_1642z_59",I="_partContent_1642z_107",N="_toolbar_1642z_125",w="_toolbarContainer_1642z_143",S="_toolbarButton_1642z_159",z="_overviewHr_1642z_387",T="_dockingBody_1642z_403",k="_loading_1642z_421",D="_noData_1642z_423",E="_editInput_1642z_751";const H=()=>{const{selectedDevice:H,treeData:$,selectDevice:B}=t(),[O,F]=s.exports.useState([]),[L,W]=s.exports.useState(!1),[M,R]=s.exports.useState(null),[U,J]=s.exports.useState(null),[K,P]=s.exports.useState(null),[A,G]=s.exports.useState("");s.exports.useEffect((()=>{if(!H&&$.length>0){const e=s=>{for(const t of s){if(t.data)return t;if(t.children&&t.children.length>0){const s=e(t.children);if(s)return s}}return null},s=e($);(null==s?void 0:s.data)&&B(s.data)}}),[H,$,B]);const Q=s.exports.useCallback((async()=>{if(H){W(!0),R(null);try{const e=await fetch(`${r}/api/v1/devices/${H.serialNumber}/tables/refresh`);if(!e.ok)throw new Error(`Failed to fetch tables: ${e.statusText}`);const s=await e.json();F(s.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load tables";R(s)}finally{W(!1)}}else F([])}),[H]);s.exports.useEffect((()=>{Q()}),[Q]);const q=(e,s,t)=>{"tableId"!==s&&"tableIndex"!==s&&(P({rowIndex:e,columnId:s}),G(t||""))},V=e=>{G(e.target.value)},X=async(e,s)=>{if(!H||!K)return;const t=O[e],a={...t,[s]:A};try{const s=await fetch(`${r}/api/v1/devices/${H.serialNumber}/tables/${t.tableIndex}/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`Update failed: ${s.statusText}`);const l=[...O];l[e]=a,F(l),J(`Table ${t.tableIndex} updated successfully`),setTimeout((()=>J(null)),3e3)}catch(l){const e=l instanceof Error?l.message:"Update failed";R(e),setTimeout((()=>R(null)),5e3)}finally{P(null)}},Y=()=>{P(null),G("")},Z=s.exports.useMemo((()=>[p({columnId:"tableId",renderHeaderCell:()=>e.exports.jsx("span",{children:"Table ID"}),renderCell:s=>e.exports.jsx(_,{children:s.tableId})}),p({columnId:"tableIndex",renderHeaderCell:()=>e.exports.jsx("span",{children:"Index"}),renderCell:s=>e.exports.jsx(_,{children:s.tableIndex})}),p({columnId:"panel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Panel"}),renderCell:s=>{const t=O.indexOf(s),r=(null==K?void 0:K.rowIndex)===t&&"panel"===(null==K?void 0:K.columnId);return e.exports.jsx(_,{children:r?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:E,value:A,onChange:V,onBlur:()=>X(t,"panel"),onKeyDown:e=>{"Enter"===e.key&&X(t,"panel"),"Escape"===e.key&&Y()},autoFocus:!0})}):e.exports.jsx("span",{onClick:()=>q(t,"panel",s.panel),children:s.panel||"-"})})}}),p({columnId:"tableName",renderHeaderCell:()=>e.exports.jsx("span",{children:"Table Name"}),renderCell:s=>{const t=O.indexOf(s),r=(null==K?void 0:K.rowIndex)===t&&"tableName"===(null==K?void 0:K.columnId);return e.exports.jsx(_,{children:r?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:E,value:A,onChange:V,onBlur:()=>X(t,"tableName"),onKeyDown:e=>{"Enter"===e.key&&X(t,"tableName"),"Escape"===e.key&&Y()},autoFocus:!0,maxLength:9})}):e.exports.jsx("span",{onClick:()=>q(t,"tableName",s.tableName),children:s.tableName||"-"})})}}),p({columnId:"tableData",renderHeaderCell:()=>e.exports.jsx("span",{children:"Table Data (JSON)"}),renderCell:s=>e.exports.jsx(_,{children:e.exports.jsx("span",{style:{fontSize:"10px",maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.tableData||"[]"})})}),p({columnId:"status",renderHeaderCell:()=>e.exports.jsx("span",{children:"Status"}),renderCell:s=>e.exports.jsx(_,{children:s.status||"-"})})]),[K,A]);return e.exports.jsx("div",{className:v,children:e.exports.jsx("div",{className:g,children:e.exports.jsx("div",{className:y,children:e.exports.jsx("div",{className:C,children:e.exports.jsxs("div",{className:I,children:[M&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(a,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(l,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:M})]}),U&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#f0f6ff",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(n,{style:{color:"#107c10",fontSize:"16px",flexShrink:0}}),e.exports.jsx(l,{style:{color:"#323130",fontWeight:500,fontSize:"13px"},children:U})]}),e.exports.jsx("div",{className:N,children:e.exports.jsxs("div",{className:w,children:[e.exports.jsx(o,{appearance:"subtle",icon:e.exports.jsx(i,{}),onClick:()=>{Q()},disabled:L,className:S,children:"Refresh"}),H&&e.exports.jsx(d,{content:`Showing analog conversion tables for ${H.nameShowOnTree} (SN: ${H.serialNumber}). These tables define custom voltage-to-value conversions for analog inputs.`,relationship:"description",children:e.exports.jsx("button",{className:S,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(x,{})})})]})}),e.exports.jsx("hr",{className:z}),e.exports.jsx("div",{className:T,children:L?e.exports.jsx("div",{className:k,children:e.exports.jsx(c,{size:"medium",label:"Loading tables..."})}):0===O.length?e.exports.jsx("div",{className:D,children:e.exports.jsx(l,{children:"No tables configured for this device."})}):e.exports.jsxs(u,{items:O,columns:Z,sortable:!0,resizableColumns:!0,focusMode:"composite",children:[e.exports.jsx(m,{children:e.exports.jsx(h,{children:({renderHeaderCell:s})=>e.exports.jsx(f,{children:s()})})}),e.exports.jsx(j,{children:({item:s,rowId:t})=>e.exports.jsx(h,{children:({renderCell:t})=>e.exports.jsx(b,{children:t(s)})},t)})]})})]})})})})})};export{H as TablesPage};

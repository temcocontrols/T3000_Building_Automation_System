import{j as e}from"./react.2da10d74.js";import{r as s}from"./client.b9d1bbf8.js";import{w as t,A as r,x as a,T as l,b3 as n,B as o,y as i,D as d,I as x,F as c}from"./App.2c62e2d1.js";import{c as p,D as u,a as h,b as m,d as f,e as b,f as j,T as _}from"./DataGridHeaderCell.34491fc4.js";import"./index.5672de35.js";import"./Serializer.f6a5f515.js";import"./useFocusableGroup.6d334b5b.js";var v="_container_1642z_35",g="_bladeContentContainer_1642z_59",y="_bladeContentWrapper_1642z_75",C="_bladeContent_1642z_59",I="_partContent_1642z_107",N="_toolbar_1642z_125",w="_toolbarContainer_1642z_143",z="_toolbarButton_1642z_159",S="_overviewHr_1642z_387",k="_dockingBody_1642z_403",T="_loading_1642z_421",D="_noData_1642z_423",E="_editInput_1642z_751";const $=()=>{const{selectedDevice:$,treeData:H,selectDevice:B}=t(),[F,O]=s.exports.useState([]),[W,L]=s.exports.useState(!1),[R,U]=s.exports.useState(null),[A,G]=s.exports.useState(null),[J,K]=s.exports.useState(null),[M,P]=s.exports.useState("");s.exports.useEffect((()=>{if(!$&&H.length>0){const e=s=>{for(const t of s){if(t.data)return t;if(t.children&&t.children.length>0){const s=e(t.children);if(s)return s}}return null},s=e(H);(null==s?void 0:s.data)&&B(s.data)}}),[$,H,B]);const q=s.exports.useCallback((async()=>{if($){L(!0),U(null);try{const e=await fetch(`${r}/api/v1/devices/${$.serialNumber}/tables/refresh`);if(!e.ok)throw new Error(`Failed to fetch tables: ${e.statusText}`);const s=await e.json();O(s.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load tables";U(s)}finally{L(!1)}}else O([])}),[$]);s.exports.useEffect((()=>{q()}),[q]);const Q=(e,s,t)=>{"tableId"!==s&&"tableIndex"!==s&&(K({rowIndex:e,columnId:s}),P(t||""))},V=e=>{P(e.target.value)},X=async(e,s)=>{if(!$||!J)return;const t=F[e],a={...t,[s]:M};try{const s=await fetch(`${r}/api/v1/devices/${$.serialNumber}/tables/${t.tableIndex}/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`Update failed: ${s.statusText}`);const l=[...F];l[e]=a,O(l),G(`Table ${t.tableIndex} updated successfully`),setTimeout((()=>G(null)),3e3)}catch(l){const e=l instanceof Error?l.message:"Update failed";U(e),setTimeout((()=>U(null)),5e3)}finally{K(null)}},Y=()=>{K(null),P("")},Z=s.exports.useMemo((()=>[p({columnId:"tableId",renderHeaderCell:()=>e.exports.jsx("span",{children:"Table ID"}),renderCell:s=>e.exports.jsx(_,{children:s.tableId})}),p({columnId:"tableIndex",renderHeaderCell:()=>e.exports.jsx("span",{children:"Index"}),renderCell:s=>e.exports.jsx(_,{children:s.tableIndex})}),p({columnId:"panel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Panel"}),renderCell:s=>{const t=F.indexOf(s),r=(null==J?void 0:J.rowIndex)===t&&"panel"===(null==J?void 0:J.columnId);return e.exports.jsx(_,{children:r?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:E,value:M,onChange:V,onBlur:()=>X(t,"panel"),onKeyDown:e=>{"Enter"===e.key&&X(t,"panel"),"Escape"===e.key&&Y()},autoFocus:!0})}):e.exports.jsx("span",{onClick:()=>Q(t,"panel",s.panel),children:s.panel||"-"})})}}),p({columnId:"tableName",renderHeaderCell:()=>e.exports.jsx("span",{children:"Table Name"}),renderCell:s=>{const t=F.indexOf(s),r=(null==J?void 0:J.rowIndex)===t&&"tableName"===(null==J?void 0:J.columnId);return e.exports.jsx(_,{children:r?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:E,value:M,onChange:V,onBlur:()=>X(t,"tableName"),onKeyDown:e=>{"Enter"===e.key&&X(t,"tableName"),"Escape"===e.key&&Y()},autoFocus:!0,maxLength:9})}):e.exports.jsx("span",{onClick:()=>Q(t,"tableName",s.tableName),children:s.tableName||"-"})})}}),p({columnId:"tableData",renderHeaderCell:()=>e.exports.jsx("span",{children:"Table Data (JSON)"}),renderCell:s=>e.exports.jsx(_,{children:e.exports.jsx("span",{style:{fontSize:"10px",maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.tableData||"[]"})})}),p({columnId:"status",renderHeaderCell:()=>e.exports.jsx("span",{children:"Status"}),renderCell:s=>e.exports.jsx(_,{children:s.status||"-"})})]),[J,M]);return e.exports.jsx("div",{className:v,children:e.exports.jsx("div",{className:g,children:e.exports.jsx("div",{className:y,children:e.exports.jsx("div",{className:C,children:e.exports.jsxs("div",{className:I,children:[R&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(a,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(l,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:R})]}),A&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#f0f6ff",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(n,{style:{color:"#107c10",fontSize:"16px",flexShrink:0}}),e.exports.jsx(l,{style:{color:"#323130",fontWeight:500,fontSize:"13px"},children:A})]}),e.exports.jsx("div",{className:N,children:e.exports.jsxs("div",{className:w,children:[e.exports.jsx(o,{appearance:"subtle",icon:e.exports.jsx(i,{}),onClick:()=>{q()},disabled:W,className:z,children:"Refresh"}),$&&e.exports.jsx(d,{content:`Showing analog conversion tables for ${$.nameShowOnTree} (SN: ${$.serialNumber}). These tables define custom voltage-to-value conversions for analog inputs.`,relationship:"description",children:e.exports.jsx("button",{className:z,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(x,{})})})]})}),e.exports.jsx("hr",{className:S}),e.exports.jsx("div",{className:k,children:W?e.exports.jsx("div",{className:T,children:e.exports.jsx(c,{size:"medium",label:"Loading tables..."})}):0===F.length?e.exports.jsx("div",{className:D,children:e.exports.jsx(l,{children:"No tables configured for this device."})}):e.exports.jsxs(u,{items:F,columns:Z,sortable:!0,resizableColumns:!0,focusMode:"composite",children:[e.exports.jsx(h,{children:e.exports.jsx(m,{children:({renderHeaderCell:s})=>e.exports.jsx(f,{children:s()})})}),e.exports.jsx(b,{children:({item:s,rowId:t})=>e.exports.jsx(m,{children:({renderCell:t})=>e.exports.jsx(j,{children:t(s)})},t)})]})})]})})})})})};export{$ as TablesPage};

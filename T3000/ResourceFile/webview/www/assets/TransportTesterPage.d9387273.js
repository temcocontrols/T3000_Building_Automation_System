import{j as e}from"./react.8639cc86.js";import{r as s}from"./client.58f92968.js";import{T as t,aP as r,aQ as o,B as i,aF as l,bx as n,cC as a,S as c,b4 as p,cD as x,cE as d,b0 as _,K as E,M as h}from"./App.7c34790a.js";import{I as m}from"./Input.7691f421.js";import"./index.3bd6c859.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.63f93fe7.js";import"./_commonjsHelpers.a5007c1f.js";var u="_container_1isyn_1",j="_topBar_1isyn_8",A="_topBarControls_1isyn_22",T="_controlGroup_1isyn_29",y="_content_1isyn_35",S="_bottomArea_1isyn_41",f="_messagePanel_1isyn_50",N="_panelHeader_1isyn_59",I="_formGroup_1isyn_71",v="_messageInfo_1isyn_81",b="_infoSection_1isyn_90",D="_responsePanel_1isyn_102",L="_responseText_1isyn_111",g="_responsePlaceholder_1isyn_123",G="_rightPanel_1isyn_133",P="_requestPanel_1isyn_143",w="_requestText_1isyn_152",z="_historyPanel_1isyn_165",R="_historyList_1isyn_173",O="_historyPlaceholder_1isyn_178",C="_historyItem_1isyn_184",V="_historyItemHeader_1isyn_195";const W=({json:t})=>{let r;try{r=JSON.parse(t)}catch{return e.exports.jsx("pre",{className:L,children:t})}const o=(e,s="root",t=new Set)=>(t.add(s),Array.isArray(e)?e.forEach(((e,r)=>{"object"==typeof e&&null!==e&&o(e,`${s}.${r}`,t)})):"object"==typeof e&&null!==e&&Object.keys(e).forEach((r=>{const i=e[r];"object"==typeof i&&null!==i&&o(i,`${s}.${r}`,t)})),t),[i,l]=s.exports.useState((()=>o(r))),n=e=>{l((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))},a=(s,t,r,o=0)=>{const l=20*o,c=i.has(t);if(null===s)return e.exports.jsxs("div",{style:{marginLeft:`${l}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{style:{color:"#0000ff"},children:"null"})]});if("boolean"==typeof s)return e.exports.jsxs("div",{style:{marginLeft:`${l}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{style:{color:"#0000ff"},children:s.toString()})]});if("number"==typeof s)return e.exports.jsxs("div",{style:{marginLeft:`${l}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{style:{color:"#098658"},children:s})]});if("string"==typeof s)return e.exports.jsxs("div",{style:{marginLeft:`${l}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsxs("span",{style:{color:"#a31515"},children:['"',s,'"']})]});if(Array.isArray(s))return e.exports.jsxs("div",{style:{marginLeft:`${l}px`,fontSize:"12px",fontFamily:"monospace"},children:[e.exports.jsxs("div",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>n(t),children:[c?e.exports.jsx(_,{fontSize:12}):e.exports.jsx(E,{fontSize:12}),void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsxs("span",{children:["[",s.length,"]"]})]}),c&&e.exports.jsx("div",{children:s.map(((e,s)=>a(e,`${t}.${s}`,void 0,o+1)))})]});if("object"==typeof s){const i=Object.keys(s);return e.exports.jsxs("div",{style:{marginLeft:`${l}px`,fontSize:"12px",fontFamily:"monospace"},children:[e.exports.jsxs("div",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>n(t),children:[c?e.exports.jsx(_,{fontSize:12}):e.exports.jsx(E,{fontSize:12}),void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{children:`{${i.length}}`})]}),c&&e.exports.jsx("div",{children:i.map((e=>a(s[e],`${t}.${e}`,e,o+1)))})]})}return null};return e.exports.jsx("div",{className:L,style:{padding:"8px",overflow:"auto"},children:a(r,"root")})},F=`${h}/api`,B=()=>{var _;const[E,h]=s.exports.useState("ffi"),[B,$]=s.exports.useState("GET_PANELS_LIST"),[k,Y]=s.exports.useState([]),[H,U]=s.exports.useState(""),[M,J]=s.exports.useState(""),[q,K]=s.exports.useState("{}"),[Q,X]=s.exports.useState(!1),[Z,ee]=s.exports.useState(""),[se,te]=s.exports.useState(""),[re,oe]=s.exports.useState([]),[ie,le]=s.exports.useState(""),[ne,ae]=s.exports.useState(!1),ce=s.exports.useRef(null);s.exports.useEffect((()=>((async()=>{try{const s=new x({apiBaseUrl:F});try{await s.connect("ffi"),le("Connected via FFI (HTTP API)"),h("ffi")}catch(e){console.warn("FFI connection failed, trying auto-connect:",e);const t=await s.autoConnect();le(`Connected via ${t}`),h(t)}ce.current=s}catch(s){console.error("Transport initialization error:",s),le(`Error: ${s instanceof Error?s.message:"Unknown error"}`)}})(),()=>{ce.current&&ce.current.disconnect()})),[]);const pe=[{value:"GET_PANEL_DATA",label:"0 - GET_PANEL_DATA"},{value:"GET_INITIAL_DATA",label:"1 - GET_INITIAL_DATA"},{value:"SAVE_GRAPHIC_DATA",label:"2 - SAVE_GRAPHIC_DATA"},{value:"UPDATE_ENTRY",label:"3 - UPDATE_ENTRY"},{value:"GET_PANELS_LIST",label:"4 - GET_PANELS_LIST"},{value:"GET_PANEL_RANGE_INFO",label:"5 - GET_PANEL_RANGE_INFO"},{value:"GET_ENTRIES",label:"6 - GET_ENTRIES"},{value:"LOAD_GRAPHIC_ENTRY",label:"7 - LOAD_GRAPHIC_ENTRY"},{value:"OPEN_ENTRY_EDIT_WINDOW",label:"8 - OPEN_ENTRY_EDIT_WINDOW"},{value:"SAVE_IMAGE",label:"9 - SAVE_IMAGE"},{value:"SAVE_LIBRAY_DATA",label:"10 - SAVE_LIBRAY_DATA"},{value:"DELETE_IMAGE",label:"11 - DELETE_IMAGE"},{value:"GET_SELECTED_DEVICE_INFO",label:"12 - GET_SELECTED_DEVICE_INFO"},{value:"BIND_DEVICE",label:"13 - BIND_DEVICE"},{value:"SAVE_NEW_LIBRARY_DATA",label:"14 - SAVE_NEW_LIBRARY_DATA"},{value:"LOGGING_DATA",label:"15 - LOGGING_DATA"},{value:"UPDATE_WEBVIEW_LIST",label:"16 - UPDATE_WEBVIEW_LIST"},{value:"GET_WEBVIEW_LIST",label:"17 - GET_WEBVIEW_LIST"}];return e.exports.jsxs("div",{className:u,children:[e.exports.jsx("div",{className:j,children:e.exports.jsxs("div",{className:A,children:[e.exports.jsxs("div",{className:T,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Transport Type:"}),e.exports.jsxs(r,{placeholder:"Transport Type",value:"websocket"===E?"WebSocket":"ffi"===E?"FFI":"WebView2",disabled:!0,style:{minWidth:"150px",fontSize:"12px"},size:"small",children:[e.exports.jsx(o,{value:"websocket",text:"WebSocket",children:e.exports.jsx("span",{style:{fontSize:"12px"},children:"WebSocket"})}),e.exports.jsx(o,{value:"ffi",text:"FFI",children:e.exports.jsx("span",{style:{fontSize:"12px"},children:"FFI"})}),e.exports.jsx(o,{value:"webview2",text:"WebView2",children:e.exports.jsx("span",{style:{fontSize:"12px"},children:"WebView2"})})]}),ie&&e.exports.jsx(t,{size:200,style:{marginLeft:"8px",color:ie.includes("Error")?"#d13438":"#107c10"},children:ie})]}),e.exports.jsxs("div",{className:T,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Message Type:"}),e.exports.jsx(r,{placeholder:"Select message type",value:(null==(_=pe.find((e=>e.value===B)))?void 0:_.label)||B,onOptionSelect:(e,s)=>s.optionValue&&$(s.optionValue),style:{minWidth:"280px",fontSize:"12px"},size:"small",children:pe.map((s=>e.exports.jsx(o,{value:s.value,text:s.label,children:e.exports.jsx("span",{style:{fontSize:"12px"},children:s.label})},s.value)))})]}),e.exports.jsx(i,{appearance:"primary",icon:e.exports.jsx(l,{fontSize:14}),onClick:async()=>{if(ce.current){X(!0),ee("");try{const s=Date.now(),t={GET_PANEL_DATA:d.GET_PANEL_DATA,GET_INITIAL_DATA:d.GET_INITIAL_DATA,SAVE_GRAPHIC_DATA:d.SAVE_GRAPHIC_DATA,UPDATE_ENTRY:d.UPDATE_ENTRY,GET_PANELS_LIST:d.GET_PANELS_LIST,GET_PANEL_RANGE_INFO:d.GET_PANEL_RANGE_INFO,GET_ENTRIES:d.GET_ENTRIES,LOAD_GRAPHIC_ENTRY:d.LOAD_GRAPHIC_ENTRY,OPEN_ENTRY_EDIT_WINDOW:d.OPEN_ENTRY_EDIT_WINDOW,SAVE_IMAGE:d.SAVE_IMAGE,SAVE_LIBRAY_DATA:d.SAVE_LIBRAY_DATA,DELETE_IMAGE:d.DELETE_IMAGE,GET_SELECTED_DEVICE_INFO:d.GET_SELECTED_DEVICE_INFO,BIND_DEVICE:d.BIND_DEVICE,SAVE_NEW_LIBRARY_DATA:d.SAVE_NEW_LIBRARY_DATA,LOGGING_DATA:d.LOGGING_DATA,UPDATE_WEBVIEW_LIST:d.UPDATE_WEBVIEW_LIST,GET_WEBVIEW_LIST:d.GET_WEBVIEW_LIST}[B];if(void 0===t)throw new Error(`Unknown action: ${B}`);let r={};if("GET_PANELS_LIST"!==B&&(H&&(r.panelId=parseInt(H)),M&&(r.serialNumber=parseInt(M)),"{}"!==q))try{const e=JSON.parse(q);r={...r,...e}}catch(e){console.warn("Invalid custom JSON data:",e)}const o=()=>{const e=navigator.userAgent;return e.indexOf("Firefox")>-1?"Firefox":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":e.indexOf("Edge")>-1?"Edge":"Unknown"},i={action:t,msgId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,from:o(),...r};te(JSON.stringify(i,null,2));const l=await fetch(`${F}/t3000/ffi/call`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),n=await l.json(),a=Date.now()-s;console.log("C++ Response:",n);const c=l.ok&&!n.error;if("GET_PANELS_LIST"===B&&c&&n.data){let e=Array.isArray(n.data)?n.data:[];e=e.filter((e=>e&&"object"==typeof e&&void 0!==e.panel_number&&null!==e.panel_number)),Y(e)}ee(JSON.stringify(n,null,2));const p={id:Date.now().toString(),timestamp:new Date,action:B,request:i,response:n,duration:a,status:c?"success":"error"};oe((e=>[p,...e].slice(0,50)))}catch(s){const e={success:!1,error:s instanceof Error?s.message:"Request failed",details:s instanceof Error?s.stack:void 0};ee(JSON.stringify(e,null,2));const t={id:Date.now().toString(),timestamp:new Date,action:B,request:{action:B},response:e,duration:0,status:"error"};oe((e=>[t,...e].slice(0,50)))}finally{X(!1)}}else ee(JSON.stringify({success:!1,error:"Transport not initialized. Please wait for connection."},null,2))},disabled:Q,size:"small",children:Q?"Sending...":"Send Message"})]})}),e.exports.jsx("div",{className:y,children:e.exports.jsxs("div",{className:S,children:[e.exports.jsxs("div",{className:f,children:[e.exports.jsx("div",{className:N,children:e.exports.jsx(t,{size:200,weight:"semibold",children:"Message"})}),"GET_PANELS_LIST"===B?e.exports.jsxs("div",{className:v,children:[e.exports.jsxs("div",{className:b,children:[e.exports.jsx(t,{size:300,weight:"semibold",style:{marginBottom:"8px"},children:"Description"}),e.exports.jsx(t,{size:200,style:{color:"#605e5c",lineHeight:"1.5"},children:"Retrieves the list of all available panels/devices in the network."})]}),e.exports.jsxs("div",{className:b,children:[e.exports.jsx(t,{size:300,weight:"semibold",style:{marginBottom:"8px"},children:"Parameters"}),e.exports.jsx(t,{size:200,style:{color:"#605e5c"},children:"None required"})]}),e.exports.jsxs("div",{className:b,children:[e.exports.jsx(t,{size:300,weight:"semibold",style:{marginBottom:"8px"},children:"Returns"}),e.exports.jsx(t,{size:200,style:{color:"#605e5c",lineHeight:"1.5"},children:"Array of panels with:"}),e.exports.jsxs("ul",{style:{margin:"4px 0 0 0",padding:"0 0 0 20px",fontSize:"12px",color:"#605e5c"},children:[e.exports.jsx("li",{children:"Panel Number"}),e.exports.jsx("li",{children:"Serial Number"}),e.exports.jsx("li",{children:"Panel Name"}),e.exports.jsx("li",{children:"Object Instance"}),e.exports.jsx("li",{children:"Last Online Time"}),e.exports.jsx("li",{children:"PID (Panel Type)"})]})]}),e.exports.jsx("div",{className:b,children:e.exports.jsx(t,{size:200,style:{color:"#0078d4",fontStyle:"italic"},children:"ðŸ’¡ This is typically the first message you should send to discover available devices."})})]}):e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsxs("div",{className:I,style:{gridColumn:"1 / -1"},children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Panel ID"}),k.length>0?e.exports.jsx(r,{placeholder:"Select a panel",value:(()=>{const e=k.find((e=>e.panel_number.toString()===H));return e?`${e.panel_name||"Unknown"}, Panel Number: ${e.panel_number}`:H})(),onOptionSelect:(e,s)=>s.optionValue&&U(s.optionValue),size:"small",style:{width:"100%"},children:k.filter((e=>e&&void 0!==e.panel_number)).map((s=>e.exports.jsx(o,{value:s.panel_number.toString(),children:e.exports.jsxs("span",{style:{fontSize:"12px"},children:[s.panel_name||"Unknown",", Panel Number: ",s.panel_number]})},s.panel_number)))}):e.exports.jsx(m,{value:H,onChange:(e,s)=>U(s.value),placeholder:"Run GET_PANELS_LIST first",size:"small",disabled:!0,style:{width:"100%"}})]}),e.exports.jsxs("div",{className:I,style:{gridColumn:"1 / -1"},children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Serial Number (optional)"}),e.exports.jsx(m,{value:M,onChange:(e,s)=>J(s.value),placeholder:"Leave empty for broadcast",size:"small",style:{width:"100%"}})]})]})]}),e.exports.jsxs("div",{className:D,children:[e.exports.jsxs("div",{className:N,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Response"}),Z&&e.exports.jsxs("div",{style:{display:"flex",gap:"4px"},children:[e.exports.jsx(i,{appearance:"subtle",size:"small",icon:e.exports.jsx(n,{}),onClick:()=>{navigator.clipboard.writeText(Z)},title:"Copy JSON to clipboard"}),e.exports.jsx(i,{appearance:"subtle",size:"small",icon:e.exports.jsx(a,{}),onClick:()=>ae(!ne),title:ne?"Switch to text view":"Switch to tree view"})]})]}),Q&&e.exports.jsx("div",{className:g,children:e.exports.jsx(c,{size:"small",label:"Waiting for response..."})}),!Q&&!Z&&e.exports.jsx("div",{className:g,children:e.exports.jsx(t,{size:300,children:"Send a message to see response"})}),!Q&&Z&&(ne?e.exports.jsx(W,{json:Z}):e.exports.jsx("pre",{className:L,children:Z}))]}),e.exports.jsxs("div",{className:G,children:[e.exports.jsxs("div",{className:P,children:[e.exports.jsx("div",{className:N,children:e.exports.jsx(t,{size:200,weight:"semibold",children:"Request Payload"})}),!se&&e.exports.jsx("div",{className:g,children:e.exports.jsx(t,{size:300,children:"Request details will appear here"})}),se&&e.exports.jsx("pre",{className:w,children:se})]}),e.exports.jsxs("div",{className:z,children:[e.exports.jsxs("div",{className:N,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"History"}),e.exports.jsx(i,{appearance:"subtle",size:"small",icon:e.exports.jsx(p,{}),onClick:()=>{oe([])},children:"Clear"})]}),e.exports.jsxs("div",{className:R,children:[0===re.length&&e.exports.jsx("div",{className:O,children:e.exports.jsx(t,{size:300,children:"No messages sent yet"})}),re.map((s=>e.exports.jsxs("div",{className:C,children:[e.exports.jsxs("div",{className:V,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:s.action}),e.exports.jsxs(t,{size:200,style:{color:"success"===s.status?"#107c10":"#d13438"},children:[s.duration,"ms"]})]}),e.exports.jsx(t,{size:100,style:{color:"#605e5c"},children:s.timestamp.toLocaleTimeString()})]},s.id)))]})]})]})]})})]})};export{B as TransportTesterPage,B as default};

import{j as e}from"./react.1acd1a13.js";import{r as s}from"./client.58f92968.js";import{T as t,aP as r,aQ as l,B as i,aF as o,bD as n,cH as a,S as c,b4 as p,cI as x,cJ as d,b0 as _,K as E}from"./App.3fe38e41.js";import{I as h}from"./Input.037b8c53.js";import"./index.2479820c.js";import"./Serializer.f6a5f515.js";import"./T3Data.5fdf3c76.js";import"./_commonjsHelpers.a5007c1f.js";var m="_container_1isyn_1",j="_topBar_1isyn_8",u="_topBarControls_1isyn_22",A="_controlGroup_1isyn_29",T="_content_1isyn_35",y="_bottomArea_1isyn_41",S="_messagePanel_1isyn_50",f="_panelHeader_1isyn_59",N="_formGroup_1isyn_71",I="_messageInfo_1isyn_81",v="_infoSection_1isyn_90",b="_responsePanel_1isyn_102",D="_responseText_1isyn_111",L="_responsePlaceholder_1isyn_123",g="_rightPanel_1isyn_133",G="_requestPanel_1isyn_143",P="_requestText_1isyn_152",w="_historyPanel_1isyn_165",z="_historyList_1isyn_173",R="_historyPlaceholder_1isyn_178",O="_historyItem_1isyn_184",C="_historyItemHeader_1isyn_195";const V=({json:t})=>{let r;try{r=JSON.parse(t)}catch{return e.exports.jsx("pre",{className:D,children:t})}const l=(e,s="root",t=new Set)=>(t.add(s),Array.isArray(e)?e.forEach(((e,r)=>{"object"==typeof e&&null!==e&&l(e,`${s}.${r}`,t)})):"object"==typeof e&&null!==e&&Object.keys(e).forEach((r=>{const i=e[r];"object"==typeof i&&null!==i&&l(i,`${s}.${r}`,t)})),t),[i,o]=s.exports.useState((()=>l(r))),n=e=>{o((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))},a=(s,t,r,l=0)=>{const o=20*l,c=i.has(t);if(null===s)return e.exports.jsxs("div",{style:{marginLeft:`${o}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{style:{color:"#0000ff"},children:"null"})]});if("boolean"==typeof s)return e.exports.jsxs("div",{style:{marginLeft:`${o}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{style:{color:"#0000ff"},children:s.toString()})]});if("number"==typeof s)return e.exports.jsxs("div",{style:{marginLeft:`${o}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{style:{color:"#098658"},children:s})]});if("string"==typeof s)return e.exports.jsxs("div",{style:{marginLeft:`${o}px`,fontSize:"12px",fontFamily:"monospace"},children:[void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsxs("span",{style:{color:"#a31515"},children:['"',s,'"']})]});if(Array.isArray(s))return e.exports.jsxs("div",{style:{marginLeft:`${o}px`,fontSize:"12px",fontFamily:"monospace"},children:[e.exports.jsxs("div",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>n(t),children:[c?e.exports.jsx(_,{fontSize:12}):e.exports.jsx(E,{fontSize:12}),void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsxs("span",{children:["[",s.length,"]"]})]}),c&&e.exports.jsx("div",{children:s.map(((e,s)=>a(e,`${t}.${s}`,void 0,l+1)))})]});if("object"==typeof s){const i=Object.keys(s);return e.exports.jsxs("div",{style:{marginLeft:`${o}px`,fontSize:"12px",fontFamily:"monospace"},children:[e.exports.jsxs("div",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>n(t),children:[c?e.exports.jsx(_,{fontSize:12}):e.exports.jsx(E,{fontSize:12}),void 0!==r&&e.exports.jsxs("span",{style:{color:"#881391"},children:['"',r,'": ']}),e.exports.jsx("span",{children:`{${i.length}}`})]}),c&&e.exports.jsx("div",{children:i.map((e=>a(s[e],`${t}.${e}`,e,l+1)))})]})}return null};return e.exports.jsx("div",{className:D,style:{padding:"8px",overflow:"auto"},children:a(r,"root")})},W=()=>{var _;const[E,W]=s.exports.useState("ffi"),[B,F]=s.exports.useState("GET_PANELS_LIST"),[$,k]=s.exports.useState([]),[Y,H]=s.exports.useState(""),[U,M]=s.exports.useState(""),[J,q]=s.exports.useState("{}"),[K,Q]=s.exports.useState(!1),[X,Z]=s.exports.useState(""),[ee,se]=s.exports.useState(""),[te,re]=s.exports.useState([]),[le,ie]=s.exports.useState(""),[oe,ne]=s.exports.useState(!1),ae=s.exports.useRef(null);s.exports.useEffect((()=>((async()=>{try{const s=new x({apiBaseUrl:"http://localhost:9103/api"});try{await s.connect("ffi"),ie("Connected via FFI (HTTP API)"),W("ffi")}catch(e){const t=await s.autoConnect();ie(`Connected via ${t}`),W(t)}ae.current=s}catch(s){ie(`Error: ${s instanceof Error?s.message:"Unknown error"}`)}})(),()=>{ae.current&&ae.current.disconnect()})),[]);const ce=[{value:"GET_PANEL_DATA",label:"0 - GET_PANEL_DATA"},{value:"GET_INITIAL_DATA",label:"1 - GET_INITIAL_DATA"},{value:"SAVE_GRAPHIC_DATA",label:"2 - SAVE_GRAPHIC_DATA"},{value:"UPDATE_ENTRY",label:"3 - UPDATE_ENTRY"},{value:"GET_PANELS_LIST",label:"4 - GET_PANELS_LIST"},{value:"GET_PANEL_RANGE_INFO",label:"5 - GET_PANEL_RANGE_INFO"},{value:"GET_ENTRIES",label:"6 - GET_ENTRIES"},{value:"LOAD_GRAPHIC_ENTRY",label:"7 - LOAD_GRAPHIC_ENTRY"},{value:"OPEN_ENTRY_EDIT_WINDOW",label:"8 - OPEN_ENTRY_EDIT_WINDOW"},{value:"SAVE_IMAGE",label:"9 - SAVE_IMAGE"},{value:"SAVE_LIBRAY_DATA",label:"10 - SAVE_LIBRAY_DATA"},{value:"DELETE_IMAGE",label:"11 - DELETE_IMAGE"},{value:"GET_SELECTED_DEVICE_INFO",label:"12 - GET_SELECTED_DEVICE_INFO"},{value:"BIND_DEVICE",label:"13 - BIND_DEVICE"},{value:"SAVE_NEW_LIBRARY_DATA",label:"14 - SAVE_NEW_LIBRARY_DATA"},{value:"LOGGING_DATA",label:"15 - LOGGING_DATA"},{value:"UPDATE_WEBVIEW_LIST",label:"16 - UPDATE_WEBVIEW_LIST"},{value:"GET_WEBVIEW_LIST",label:"17 - GET_WEBVIEW_LIST"}];return e.exports.jsxs("div",{className:m,children:[e.exports.jsx("div",{className:j,children:e.exports.jsxs("div",{className:u,children:[e.exports.jsxs("div",{className:A,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Transport Type:"}),e.exports.jsxs(r,{placeholder:"Transport Type",value:"websocket"===E?"WebSocket":"ffi"===E?"FFI":"WebView2",disabled:!0,style:{minWidth:"150px",fontSize:"12px"},size:"small",children:[e.exports.jsx(l,{value:"websocket",text:"WebSocket",children:e.exports.jsx("span",{style:{fontSize:"12px"},children:"WebSocket"})}),e.exports.jsx(l,{value:"ffi",text:"FFI",children:e.exports.jsx("span",{style:{fontSize:"12px"},children:"FFI"})}),e.exports.jsx(l,{value:"webview2",text:"WebView2",children:e.exports.jsx("span",{style:{fontSize:"12px"},children:"WebView2"})})]}),le&&e.exports.jsx(t,{size:200,style:{marginLeft:"8px",color:le.includes("Error")?"#d13438":"#107c10"},children:le})]}),e.exports.jsxs("div",{className:A,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Message Type:"}),e.exports.jsx(r,{placeholder:"Select message type",value:(null==(_=ce.find((e=>e.value===B)))?void 0:_.label)||B,onOptionSelect:(e,s)=>s.optionValue&&F(s.optionValue),style:{minWidth:"280px",fontSize:"12px"},size:"small",children:ce.map((s=>e.exports.jsx(l,{value:s.value,text:s.label,children:e.exports.jsx("span",{style:{fontSize:"12px"},children:s.label})},s.value)))})]}),e.exports.jsx(i,{appearance:"primary",icon:e.exports.jsx(o,{fontSize:14}),onClick:async()=>{if(ae.current){Q(!0),Z("");try{const s=Date.now(),t={GET_PANEL_DATA:d.GET_PANEL_DATA,GET_INITIAL_DATA:d.GET_INITIAL_DATA,SAVE_GRAPHIC_DATA:d.SAVE_GRAPHIC_DATA,UPDATE_ENTRY:d.UPDATE_ENTRY,GET_PANELS_LIST:d.GET_PANELS_LIST,GET_PANEL_RANGE_INFO:d.GET_PANEL_RANGE_INFO,GET_ENTRIES:d.GET_ENTRIES,LOAD_GRAPHIC_ENTRY:d.LOAD_GRAPHIC_ENTRY,OPEN_ENTRY_EDIT_WINDOW:d.OPEN_ENTRY_EDIT_WINDOW,SAVE_IMAGE:d.SAVE_IMAGE,SAVE_LIBRAY_DATA:d.SAVE_LIBRAY_DATA,DELETE_IMAGE:d.DELETE_IMAGE,GET_SELECTED_DEVICE_INFO:d.GET_SELECTED_DEVICE_INFO,BIND_DEVICE:d.BIND_DEVICE,SAVE_NEW_LIBRARY_DATA:d.SAVE_NEW_LIBRARY_DATA,LOGGING_DATA:d.LOGGING_DATA,UPDATE_WEBVIEW_LIST:d.UPDATE_WEBVIEW_LIST,GET_WEBVIEW_LIST:d.GET_WEBVIEW_LIST}[B];if(void 0===t)throw new Error(`Unknown action: ${B}`);let r={};if("GET_PANELS_LIST"!==B&&(Y&&(r.panelId=parseInt(Y)),U&&(r.serialNumber=parseInt(U)),"{}"!==J))try{const e=JSON.parse(J);r={...r,...e}}catch(e){}const l=()=>{const e=navigator.userAgent;return e.indexOf("Firefox")>-1?"Firefox":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":e.indexOf("Edge")>-1?"Edge":"Unknown"},i={action:t,msgId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,from:l(),...r};se(JSON.stringify(i,null,2));const o=await fetch("http://localhost:9103/api/t3000/ffi/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),n=await o.json(),a=Date.now()-s,c=o.ok&&!n.error;if("GET_PANELS_LIST"===B&&c&&n.data){let e=Array.isArray(n.data)?n.data:[];e=e.filter((e=>e&&"object"==typeof e&&void 0!==e.panel_number&&null!==e.panel_number)),k(e)}Z(JSON.stringify(n,null,2));const p={id:Date.now().toString(),timestamp:new Date,action:B,request:i,response:n,duration:a,status:c?"success":"error"};re((e=>[p,...e].slice(0,50)))}catch(s){const e={success:!1,error:s instanceof Error?s.message:"Request failed",details:s instanceof Error?s.stack:void 0};Z(JSON.stringify(e,null,2));const t={id:Date.now().toString(),timestamp:new Date,action:B,request:{action:B},response:e,duration:0,status:"error"};re((e=>[t,...e].slice(0,50)))}finally{Q(!1)}}else Z(JSON.stringify({success:!1,error:"Transport not initialized. Please wait for connection."},null,2))},disabled:K,size:"small",children:K?"Sending...":"Send Message"})]})}),e.exports.jsx("div",{className:T,children:e.exports.jsxs("div",{className:y,children:[e.exports.jsxs("div",{className:S,children:[e.exports.jsx("div",{className:f,children:e.exports.jsx(t,{size:200,weight:"semibold",children:"Message"})}),"GET_PANELS_LIST"===B?e.exports.jsxs("div",{className:I,children:[e.exports.jsxs("div",{className:v,children:[e.exports.jsx(t,{size:300,weight:"semibold",style:{marginBottom:"8px"},children:"Description"}),e.exports.jsx(t,{size:200,style:{color:"#605e5c",lineHeight:"1.5"},children:"Retrieves the list of all available panels/devices in the network."})]}),e.exports.jsxs("div",{className:v,children:[e.exports.jsx(t,{size:300,weight:"semibold",style:{marginBottom:"8px"},children:"Parameters"}),e.exports.jsx(t,{size:200,style:{color:"#605e5c"},children:"None required"})]}),e.exports.jsxs("div",{className:v,children:[e.exports.jsx(t,{size:300,weight:"semibold",style:{marginBottom:"8px"},children:"Returns"}),e.exports.jsx(t,{size:200,style:{color:"#605e5c",lineHeight:"1.5"},children:"Array of panels with:"}),e.exports.jsxs("ul",{style:{margin:"4px 0 0 0",padding:"0 0 0 20px",fontSize:"12px",color:"#605e5c"},children:[e.exports.jsx("li",{children:"Panel Number"}),e.exports.jsx("li",{children:"Serial Number"}),e.exports.jsx("li",{children:"Panel Name"}),e.exports.jsx("li",{children:"Object Instance"}),e.exports.jsx("li",{children:"Last Online Time"}),e.exports.jsx("li",{children:"PID (Panel Type)"})]})]}),e.exports.jsx("div",{className:v,children:e.exports.jsx(t,{size:200,style:{color:"#0078d4",fontStyle:"italic"},children:"ðŸ’¡ This is typically the first message you should send to discover available devices."})})]}):e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsxs("div",{className:N,style:{gridColumn:"1 / -1"},children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Panel ID"}),$.length>0?e.exports.jsx(r,{placeholder:"Select a panel",value:(()=>{const e=$.find((e=>e.panel_number.toString()===Y));return e?`${e.panel_name||"Unknown"}, Panel Number: ${e.panel_number}`:Y})(),onOptionSelect:(e,s)=>s.optionValue&&H(s.optionValue),size:"small",style:{width:"100%"},children:$.filter((e=>e&&void 0!==e.panel_number)).map((s=>e.exports.jsx(l,{value:s.panel_number.toString(),children:e.exports.jsxs("span",{style:{fontSize:"12px"},children:[s.panel_name||"Unknown",", Panel Number: ",s.panel_number]})},s.panel_number)))}):e.exports.jsx(h,{value:Y,onChange:(e,s)=>H(s.value),placeholder:"Run GET_PANELS_LIST first",size:"small",disabled:!0,style:{width:"100%"}})]}),e.exports.jsxs("div",{className:N,style:{gridColumn:"1 / -1"},children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Serial Number (optional)"}),e.exports.jsx(h,{value:U,onChange:(e,s)=>M(s.value),placeholder:"Leave empty for broadcast",size:"small",style:{width:"100%"}})]})]})]}),e.exports.jsxs("div",{className:b,children:[e.exports.jsxs("div",{className:f,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"Response"}),X&&e.exports.jsxs("div",{style:{display:"flex",gap:"4px"},children:[e.exports.jsx(i,{appearance:"subtle",size:"small",icon:e.exports.jsx(n,{}),onClick:()=>{navigator.clipboard.writeText(X)},title:"Copy JSON to clipboard"}),e.exports.jsx(i,{appearance:"subtle",size:"small",icon:e.exports.jsx(a,{}),onClick:()=>ne(!oe),title:oe?"Switch to text view":"Switch to tree view"})]})]}),K&&e.exports.jsx("div",{className:L,children:e.exports.jsx(c,{size:"small",label:"Waiting for response..."})}),!K&&!X&&e.exports.jsx("div",{className:L,children:e.exports.jsx(t,{size:300,children:"Send a message to see response"})}),!K&&X&&(oe?e.exports.jsx(V,{json:X}):e.exports.jsx("pre",{className:D,children:X}))]}),e.exports.jsxs("div",{className:g,children:[e.exports.jsxs("div",{className:G,children:[e.exports.jsx("div",{className:f,children:e.exports.jsx(t,{size:200,weight:"semibold",children:"Request Payload"})}),!ee&&e.exports.jsx("div",{className:L,children:e.exports.jsx(t,{size:300,children:"Request details will appear here"})}),ee&&e.exports.jsx("pre",{className:P,children:ee})]}),e.exports.jsxs("div",{className:w,children:[e.exports.jsxs("div",{className:f,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:"History"}),e.exports.jsx(i,{appearance:"subtle",size:"small",icon:e.exports.jsx(p,{}),onClick:()=>{re([])},children:"Clear"})]}),e.exports.jsxs("div",{className:z,children:[0===te.length&&e.exports.jsx("div",{className:R,children:e.exports.jsx(t,{size:300,children:"No messages sent yet"})}),te.map((s=>e.exports.jsxs("div",{className:O,children:[e.exports.jsxs("div",{className:C,children:[e.exports.jsx(t,{size:200,weight:"semibold",children:s.action}),e.exports.jsxs(t,{size:200,style:{color:"success"===s.status?"#107c10":"#d13438"},children:[s.duration,"ms"]})]}),e.exports.jsx(t,{size:100,style:{color:"#605e5c"},children:s.timestamp.toLocaleTimeString()})]},s.id)))]})]})]})]})})]})};export{W as TransportTesterPage,W as default};

import{j as e}from"./react.2da10d74.js";import{r as s}from"./client.b9d1bbf8.js";import{w as r,A as n,x as t,T as a,b3 as l,B as o,y as d,D as i,I as c,F as x,b4 as p}from"./App.2c62e2d1.js";import{c as u,D as m,a as h,b as f,d as j,e as v,f as g,T as y}from"./DataGridHeaderCell.34491fc4.js";import{B as _}from"./Badge.bfe12ada.js";import"./index.5672de35.js";import"./Serializer.f6a5f515.js";import"./useFocusableGroup.6d334b5b.js";var C="_container_1642z_35",w="_bladeContentContainer_1642z_59",I="_bladeContentWrapper_1642z_75",b="_bladeContent_1642z_59",N="_partContent_1642z_107",z="_toolbar_1642z_125",S="_toolbarContainer_1642z_143",k="_toolbarButton_1642z_159",L="_overviewHr_1642z_387",D="_dockingBody_1642z_403",E="_loading_1642z_421",H="_noData_1642z_423",B="_editInput_1642z_751";const $=()=>{const{selectedDevice:$,treeData:T,selectDevice:F}=r(),[P,G]=s.exports.useState([]),[O,U]=s.exports.useState(!1),[A,K]=s.exports.useState(null),[M,R]=s.exports.useState(null),[W,J]=s.exports.useState(null),[q,Q]=s.exports.useState("");s.exports.useEffect((()=>{if(!$&&T.length>0){const e=s=>{for(const r of s){if(r.data)return r;if(r.children&&r.children.length>0){const s=e(r.children);if(s)return s}}return null},s=e(T);(null==s?void 0:s.data)&&F(s.data)}}),[$,T,F]);const V=s.exports.useCallback((async()=>{if($){U(!0),K(null);try{const e=await fetch(`${n}/api/v1/devices/${$.serialNumber}/users/refresh`);if(!e.ok)throw new Error(`Failed to fetch users: ${e.statusText}`);const s=await e.json();G(s.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load users";K(s)}finally{U(!1)}}else G([])}),[$]);s.exports.useEffect((()=>{V()}),[V]);const X=(e,s,r)=>{"userId"!==s&&"userIndex"!==s&&(J({rowIndex:e,columnId:s}),Q(String(r||"")))},Y=e=>{Q(e.target.value)},Z=async(e,s)=>{if(!$||!W)return;const r=P[e];let t=q;["accessLevel","rightsAccess","defaultPanel","defaultGroup"].includes(s)&&(t=parseInt(q)||0);const a={...r,[s]:t};try{const s=await fetch(`${n}/api/v1/devices/${$.serialNumber}/users/${r.userIndex}/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`Update failed: ${s.statusText}`);const t=[...P];t[e]=a,G(t),R(`User ${r.name||r.userIndex} updated successfully`),setTimeout((()=>R(null)),3e3)}catch(l){const e=l instanceof Error?l.message:"Update failed";K(e),setTimeout((()=>K(null)),5e3)}finally{J(null)}},ee=()=>{J(null),Q("")},se=s.exports.useMemo((()=>[u({columnId:"userIndex",renderHeaderCell:()=>e.exports.jsx("span",{children:"Index"}),renderCell:s=>e.exports.jsx(y,{children:s.userIndex})}),u({columnId:"name",renderHeaderCell:()=>e.exports.jsx("span",{children:"Username"}),renderCell:s=>{const r=P.indexOf(s),n=(null==W?void 0:W.rowIndex)===r&&"name"===(null==W?void 0:W.columnId);return e.exports.jsx(y,{media:e.exports.jsx(p,{}),children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:B,value:q,onChange:Y,onBlur:()=>Z(r,"name"),onKeyDown:e=>{"Enter"===e.key&&Z(r,"name"),"Escape"===e.key&&ee()},autoFocus:!0,maxLength:16})}):e.exports.jsx("span",{onClick:()=>X(r,"name",s.name),children:s.name||"-"})})}}),u({columnId:"password",renderHeaderCell:()=>e.exports.jsx("span",{children:"Password"}),renderCell:s=>{const r=P.indexOf(s),n=(null==W?void 0:W.rowIndex)===r&&"password"===(null==W?void 0:W.columnId);return e.exports.jsx(y,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"password",className:B,value:q,onChange:Y,onBlur:()=>Z(r,"password"),onKeyDown:e=>{"Enter"===e.key&&Z(r,"password"),"Escape"===e.key&&ee()},autoFocus:!0,maxLength:9})}):e.exports.jsx("span",{onClick:()=>X(r,"password",s.password),children:s.password?"••••••••":"-"})})}}),u({columnId:"accessLevel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Access Level"}),renderCell:s=>{const r=P.indexOf(s),n=(null==W?void 0:W.rowIndex)===r&&"accessLevel"===(null==W?void 0:W.columnId);return e.exports.jsx(y,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"number",className:B,value:q,onChange:Y,onBlur:()=>Z(r,"accessLevel"),onKeyDown:e=>{"Enter"===e.key&&Z(r,"accessLevel"),"Escape"===e.key&&ee()},autoFocus:!0,min:0,max:255})}):e.exports.jsx("div",{onClick:()=>X(r,"accessLevel",s.accessLevel||0),children:e.exports.jsx(_,{appearance:"filled",color:(t=s.accessLevel||0,t>=200?"danger":t>=100?"warning":t>=50?"informative":"success"),children:s.accessLevel||0})})});var t}}),u({columnId:"panel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Panel"}),renderCell:s=>e.exports.jsx(y,{children:s.panel||"-"})}),u({columnId:"defaultPanel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Default Panel"}),renderCell:s=>e.exports.jsx(y,{children:s.defaultPanel||0})}),u({columnId:"defaultGroup",renderHeaderCell:()=>e.exports.jsx("span",{children:"Default Group"}),renderCell:s=>e.exports.jsx(y,{children:s.defaultGroup||0})}),u({columnId:"status",renderHeaderCell:()=>e.exports.jsx("span",{children:"Status"}),renderCell:s=>e.exports.jsx(y,{children:s.status||"-"})})]),[W,q]);return e.exports.jsx("div",{className:C,children:e.exports.jsx("div",{className:w,children:e.exports.jsx("div",{className:I,children:e.exports.jsx("div",{className:b,children:e.exports.jsxs("div",{className:N,children:[A&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(t,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(a,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:A})]}),M&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#f0f6ff",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(l,{style:{color:"#107c10",fontSize:"16px",flexShrink:0}}),e.exports.jsx(a,{style:{color:"#323130",fontWeight:500,fontSize:"13px"},children:M})]}),e.exports.jsx("div",{className:z,children:e.exports.jsxs("div",{className:S,children:[e.exports.jsx(o,{appearance:"subtle",icon:e.exports.jsx(d,{}),onClick:()=>{V()},disabled:O,className:k,children:"Refresh"}),$&&e.exports.jsx(i,{content:`Showing user accounts for ${$.nameShowOnTree} (SN: ${$.serialNumber}). Manage user access levels, passwords, and permissions.`,relationship:"description",children:e.exports.jsx("button",{className:k,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(c,{})})})]})}),e.exports.jsx("hr",{className:L}),e.exports.jsx("div",{className:D,children:O?e.exports.jsxs("div",{className:E,children:[e.exports.jsx(x,{size:"medium"}),e.exports.jsx(a,{size:200,weight:"regular",children:"Loading users..."})]}):0===P.length?e.exports.jsx("div",{className:H,children:e.exports.jsx(a,{children:"No users configured for this device."})}):e.exports.jsxs(m,{items:P,columns:se,sortable:!0,resizableColumns:!0,focusMode:"composite",children:[e.exports.jsx(h,{children:e.exports.jsx(f,{children:({renderHeaderCell:s})=>e.exports.jsx(j,{children:s()})})}),e.exports.jsx(v,{children:({item:s,rowId:r})=>e.exports.jsx(f,{children:({renderCell:r})=>e.exports.jsx(g,{children:r(s)})},r)})]})})]})})})})})};export{$ as UsersPage};

import{j as e}from"./react.8639cc86.js";import{r as s}from"./client.58f92968.js";import{l as r,M as n,n as t,T as a,C as l,B as o,y as d,Q as i,I as c,S as x,b6 as p,$ as u}from"./App.7c34790a.js";import{c as m,D as h,a as f,b as j,d as v,e as g,f as y}from"./DataGridHeaderCell.ec45a911.js";import{T as _}from"./TableCellLayout.d4b0b796.js";import"./index.3bd6c859.js";import"./Serializer.f6a5f515.js";import"./axios.65f6a2c9.js";import"./T3Data.63f93fe7.js";import"./_commonjsHelpers.a5007c1f.js";var C="_container_1642z_35",I="_bladeContentContainer_1642z_59",w="_bladeContentWrapper_1642z_75",b="_bladeContent_1642z_59",N="_partContent_1642z_107",z="_toolbar_1642z_125",S="_toolbarContainer_1642z_143",k="_toolbarButton_1642z_159",L="_overviewHr_1642z_387",E="_dockingBody_1642z_403",D="_noData_1642z_423",H="_loadingBar_1642z_441",T="_editInput_1642z_751";const $=()=>{const{selectedDevice:$,treeData:B,selectDevice:P}=r(),[F,G]=s.exports.useState([]),[O,U]=s.exports.useState(!1),[M,A]=s.exports.useState(null),[K,R]=s.exports.useState(null),[W,J]=s.exports.useState(null),[Q,q]=s.exports.useState("");s.exports.useEffect((()=>{if(!$&&B.length>0){const e=s=>{for(const r of s){if(r.data)return r;if(r.children&&r.children.length>0){const s=e(r.children);if(s)return s}}return null},s=e(B);(null==s?void 0:s.data)&&P(s.data)}}),[$,B,P]);const V=s.exports.useCallback((async()=>{if($){U(!0),A(null);try{const e=await fetch(`${n}/api/v1/devices/${$.serialNumber}/users/refresh`);if(!e.ok)throw new Error(`Failed to fetch users: ${e.statusText}`);const s=await e.json();G(s.data||[])}catch(e){const s=e instanceof Error?e.message:"Failed to load users";A(s),console.error("Error fetching users:",e)}finally{U(!1)}}else G([])}),[$]);s.exports.useEffect((()=>{V()}),[V]);const X=(e,s,r)=>{"userId"!==s&&"userIndex"!==s&&(J({rowIndex:e,columnId:s}),q(String(r||"")))},Y=e=>{q(e.target.value)},Z=async(e,s)=>{if(!$||!W)return;const r=F[e];let t=Q;["accessLevel","rightsAccess","defaultPanel","defaultGroup"].includes(s)&&(t=parseInt(Q)||0);const a={...r,[s]:t};try{const s=await fetch(`${n}/api/v1/devices/${$.serialNumber}/users/${r.userIndex}/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`Update failed: ${s.statusText}`);const t=[...F];t[e]=a,G(t),R(`User ${r.name||r.userIndex} updated successfully`),setTimeout((()=>R(null)),3e3)}catch(l){const e=l instanceof Error?l.message:"Update failed";A(e),setTimeout((()=>A(null)),5e3)}finally{J(null)}},ee=()=>{J(null),q("")},se=s.exports.useMemo((()=>[m({columnId:"userIndex",renderHeaderCell:()=>e.exports.jsx("span",{children:"Index"}),renderCell:s=>e.exports.jsx(_,{children:s.userIndex})}),m({columnId:"name",renderHeaderCell:()=>e.exports.jsx("span",{children:"Username"}),renderCell:s=>{const r=F.indexOf(s),n=(null==W?void 0:W.rowIndex)===r&&"name"===(null==W?void 0:W.columnId);return e.exports.jsx(_,{media:e.exports.jsx(p,{}),children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"text",className:T,value:Q,onChange:Y,onBlur:()=>Z(r,"name"),onKeyDown:e=>{"Enter"===e.key&&Z(r,"name"),"Escape"===e.key&&ee()},autoFocus:!0,maxLength:16})}):e.exports.jsx("span",{onClick:()=>X(r,"name",s.name),children:s.name||"-"})})}}),m({columnId:"password",renderHeaderCell:()=>e.exports.jsx("span",{children:"Password"}),renderCell:s=>{const r=F.indexOf(s),n=(null==W?void 0:W.rowIndex)===r&&"password"===(null==W?void 0:W.columnId);return e.exports.jsx(_,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"password",className:T,value:Q,onChange:Y,onBlur:()=>Z(r,"password"),onKeyDown:e=>{"Enter"===e.key&&Z(r,"password"),"Escape"===e.key&&ee()},autoFocus:!0,maxLength:9})}):e.exports.jsx("span",{onClick:()=>X(r,"password",s.password),children:s.password?"••••••••":"-"})})}}),m({columnId:"accessLevel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Access Level"}),renderCell:s=>{const r=F.indexOf(s),n=(null==W?void 0:W.rowIndex)===r&&"accessLevel"===(null==W?void 0:W.columnId);return e.exports.jsx(_,{children:n?e.exports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},children:e.exports.jsx("input",{type:"number",className:T,value:Q,onChange:Y,onBlur:()=>Z(r,"accessLevel"),onKeyDown:e=>{"Enter"===e.key&&Z(r,"accessLevel"),"Escape"===e.key&&ee()},autoFocus:!0,min:0,max:255})}):e.exports.jsx("div",{onClick:()=>X(r,"accessLevel",s.accessLevel||0),children:e.exports.jsx(u,{appearance:"filled",color:(t=s.accessLevel||0,t>=200?"danger":t>=100?"warning":t>=50?"informative":"success"),children:s.accessLevel||0})})});var t}}),m({columnId:"panel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Panel"}),renderCell:s=>e.exports.jsx(_,{children:s.panel||"-"})}),m({columnId:"defaultPanel",renderHeaderCell:()=>e.exports.jsx("span",{children:"Default Panel"}),renderCell:s=>e.exports.jsx(_,{children:s.defaultPanel||0})}),m({columnId:"defaultGroup",renderHeaderCell:()=>e.exports.jsx("span",{children:"Default Group"}),renderCell:s=>e.exports.jsx(_,{children:s.defaultGroup||0})}),m({columnId:"status",renderHeaderCell:()=>e.exports.jsx("span",{children:"Status"}),renderCell:s=>e.exports.jsx(_,{children:s.status||"-"})})]),[W,Q]);return e.exports.jsx("div",{className:C,children:e.exports.jsx("div",{className:I,children:e.exports.jsx("div",{className:w,children:e.exports.jsx("div",{className:b,children:e.exports.jsxs("div",{className:N,children:[M&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#fef6f6",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(t,{style:{color:"#d13438",fontSize:"16px",flexShrink:0}}),e.exports.jsx(a,{style:{color:"#d13438",fontWeight:500,fontSize:"13px"},children:M})]}),K&&e.exports.jsxs("div",{style:{marginBottom:"12px",padding:"8px 12px",backgroundColor:"#f0f6ff",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px"},children:[e.exports.jsx(l,{style:{color:"#107c10",fontSize:"16px",flexShrink:0}}),e.exports.jsx(a,{style:{color:"#323130",fontWeight:500,fontSize:"13px"},children:K})]}),e.exports.jsx("div",{className:z,children:e.exports.jsxs("div",{className:S,children:[e.exports.jsx(o,{appearance:"subtle",icon:e.exports.jsx(d,{}),onClick:()=>{V()},disabled:O,className:k,children:"Refresh"}),$&&e.exports.jsx(i,{content:`Showing user accounts for ${$.nameShowOnTree} (SN: ${$.serialNumber}). Manage user access levels, passwords, and permissions.`,relationship:"description",children:e.exports.jsx("button",{className:k,style:{marginLeft:"8px"},title:"Information","aria-label":"Information about this page",children:e.exports.jsx(c,{})})})]})}),e.exports.jsx("hr",{className:L}),e.exports.jsx("div",{className:E,children:O?e.exports.jsxs("div",{className:H,children:[e.exports.jsx(x,{size:"tiny"}),e.exports.jsx(a,{size:200,weight:"regular",children:"Loading users..."})]}):0===F.length?e.exports.jsx("div",{className:D,children:e.exports.jsx(a,{children:"No users configured for this device."})}):e.exports.jsxs(h,{items:F,columns:se,sortable:!0,resizableColumns:!0,focusMode:"composite",children:[e.exports.jsx(f,{children:e.exports.jsx(j,{children:({renderHeaderCell:s})=>e.exports.jsx(v,{children:s()})})}),e.exports.jsx(g,{children:({item:s,rowId:r})=>e.exports.jsx(j,{children:({renderCell:r})=>e.exports.jsx(y,{children:r(s)})},r)})]})})]})})})})})};export{$ as UsersPage};

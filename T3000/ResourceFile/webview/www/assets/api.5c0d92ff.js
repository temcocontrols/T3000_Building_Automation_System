import{i as v,bz as C,bA as f}from"./index.b8957d33.js";function K(){return v(C)}class _ extends Error{constructor(e,r,t){const o=e.status||e.status===0?e.status:"",n=e.statusText||"",a=`${o} ${n}`.trim(),i=a?`status code ${a}`:"an unknown error";super(`Request failed with ${i}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=e,this.request=r,this.options=t}}class R extends Error{constructor(e){super("Request timed out"),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=e}}const p=s=>s!==null&&typeof s=="object",l=(...s)=>{for(const e of s)if((!p(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return m({},...s)},g=(s={},e={})=>{const r=new globalThis.Headers(s),t=e instanceof globalThis.Headers,o=new globalThis.Headers(e);for(const[n,a]of o.entries())t&&a==="undefined"||a===void 0?r.delete(n):r.set(n,a);return r},m=(...s)=>{let e={},r={};for(const t of s)if(Array.isArray(t))Array.isArray(e)||(e=[]),e=[...e,...t];else if(p(t)){for(let[o,n]of Object.entries(t))p(n)&&o in e&&(n=m(e[o],n)),e={...e,[o]:n};p(t.headers)&&(r=g(r,t.headers),e.headers=r)}return e},x=(()=>{let s=!1,e=!1;const r=typeof globalThis.ReadableStream=="function",t=typeof globalThis.Request=="function";return r&&t&&(e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type")),s&&!e})(),P=typeof globalThis.AbortController=="function",E=typeof globalThis.ReadableStream=="function",S=typeof globalThis.FormData=="function",T=["get","post","put","patch","head","delete"],O={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},y=2147483647,q=Symbol("stop"),j={json:!0,parseJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},L={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},U=s=>T.includes(s)?s.toUpperCase():s,I=["get","put","head","delete","options","trace"],H=[408,413,429,500,502,503,504],A=[413,429,503],w={limit:2,methods:I,statusCodes:H,afterStatusCodes:A,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:s=>.3*2**(s-1)*1e3},N=(s={})=>{if(typeof s=="number")return{...w,limit:s};if(s.methods&&!Array.isArray(s.methods))throw new Error("retry.methods must be an array");if(s.statusCodes&&!Array.isArray(s.statusCodes))throw new Error("retry.statusCodes must be an array");return{...w,...s,afterStatusCodes:A}};async function D(s,e,r,t){return new Promise((o,n)=>{const a=setTimeout(()=>{r&&r.abort(),n(new R(s))},t.timeout);t.fetch(s,e).then(o).catch(n).then(()=>{clearTimeout(a)})})}async function M(s,{signal:e}){return new Promise((r,t)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));function o(){clearTimeout(n),t(e.reason)}const n=setTimeout(()=>{e==null||e.removeEventListener("abort",o),r()},s)})}const z=(s,e)=>{const r={};for(const t in e)!(t in L)&&!(t in j)&&!(t in s)&&(r[t]=e[t]);return r};class d{static create(e,r){const t=new d(e,r),o=async()=>{if(typeof t._options.timeout=="number"&&t._options.timeout>y)throw new RangeError(`The \`timeout\` option cannot be greater than ${y}`);await Promise.resolve();let i=await t._fetch();for(const u of t._options.hooks.afterResponse){const h=await u(t.request,t._options,t._decorateResponse(i.clone()));h instanceof globalThis.Response&&(i=h)}if(t._decorateResponse(i),!i.ok&&t._options.throwHttpErrors){let u=new _(i,t.request,t._options);for(const h of t._options.hooks.beforeError)u=await h(u);throw u}if(t._options.onDownloadProgress){if(typeof t._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!E)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return t._stream(i.clone(),t._options.onDownloadProgress)}return i},a=t._options.retry.methods.includes(t.request.method.toLowerCase())?t._retry(o):o();for(const[i,u]of Object.entries(O))a[i]=async()=>{t.request.headers.set("accept",t.request.headers.get("accept")||u);const c=(await a).clone();if(i==="json"){if(c.status===204||(await c.clone().arrayBuffer()).byteLength===0)return"";if(r.parseJson)return r.parseJson(await c.text())}return c[i]()};return a}constructor(e,r={}){var o,n,a,i;Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=e;const t=this._input instanceof Request&&"credentials"in Request.prototype?this._input.credentials:void 0;if(this._options={...t&&{credentials:t},...r,headers:g(this._input.headers,r.headers),hooks:m({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:U((o=r.method)!=null?o:this._input.method),prefixUrl:String(r.prefixUrl||""),retry:N(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:(n=r.timeout)!=null?n:1e4,fetch:(a=r.fetch)!=null?a:globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(P){if(this.abortController=new globalThis.AbortController,this._options.signal){const u=this._options.signal;this._options.signal.addEventListener("abort",()=>{this.abortController.abort(u.reason)})}this._options.signal=this.abortController.signal}if(x&&(this._options.duplex="half"),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const u=typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString(),h="?"+u,c=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,h);(S&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(c,{...this.request}),this._options)}this._options.json!==void 0&&(this._options.body=JSON.stringify(this._options.json),this.request.headers.set("content-type",(i=this._options.headers.get("content-type"))!=null?i:"application/json"),this.request=new globalThis.Request(this.request,{body:this._options.body}))}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount<=this._options.retry.limit&&!(e instanceof R)){if(e instanceof _){if(!this._options.retry.statusCodes.includes(e.response.status))return 0;const t=e.response.headers.get("Retry-After");if(t&&this._options.retry.afterStatusCodes.includes(e.response.status)){let o=Number(t);return Number.isNaN(o)?o=Date.parse(t)-Date.now():o*=1e3,this._options.retry.maxRetryAfter!==void 0&&o>this._options.retry.maxRetryAfter?0:o}if(e.response.status===413)return 0}const r=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,r)}return 0}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(r){const t=Math.min(this._calculateRetryDelay(r),y);if(t!==0&&this._retryCount>0){await M(t,{signal:this._options.signal});for(const o of this._options.hooks.beforeRetry)if(await o({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===q)return;return this._retry(e)}throw r}}async _fetch(){for(const r of this._options.hooks.beforeRequest){const t=await r(this.request,this._options);if(t instanceof Request){this.request=t;break}if(t instanceof Response)return t}const e=z(this.request,this._options);return this._options.timeout===!1?this._options.fetch(this.request.clone(),e):D(this.request.clone(),e,this.abortController,this._options)}_stream(e,r){const t=Number(e.headers.get("content-length"))||0;let o=0;return e.status===204?(r&&r({percent:1,totalBytes:t,transferredBytes:o},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(n){const a=e.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:t},new Uint8Array);async function i(){const{done:u,value:h}=await a.read();if(u){n.close();return}if(r){o+=h.byteLength;const c=t===0?0:o/t;r({percent:c,transferredBytes:o,totalBytes:t},h)}n.enqueue(h),await i()}await i()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License Â© Sindre Sorhus */const b=s=>{const e=(r,t)=>d.create(r,l(s,t));for(const r of T)e[r]=(t,o)=>d.create(t,l(s,o,{method:r}));return e.create=r=>b(l(r)),e.extend=r=>b(l(s,r)),e.stop=q,e},B=b();var k=B;const Y=k.create({prefixUrl:{}.API_URL,headers:{auth:f.get("token")},hooks:{beforeRequest:[s=>{s.headers.set("auth",f.get("token"))}],afterResponse:[s=>{s.status===401&&f.remove("token")}]}}),V=k.create({prefixUrl:{}.LOCAL_API_URL,headers:{Authorization:{}.LOCAL_API_SECRET_KEY||"secret"},hooks:{beforeRequest:[s=>{s.headers.set("Authorization",{}.LOCAL_API_SECRET_KEY||"secret")}],afterResponse:[s=>{s.status===401&&f.remove("Authorization")}]}});export{V as a,k,Y as l,K as u};

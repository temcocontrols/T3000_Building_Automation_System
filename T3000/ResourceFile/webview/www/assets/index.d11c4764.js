var t=Object.defineProperty,e=(e,o,s)=>(((e,o,s)=>{o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s})(e,"symbol"!=typeof o?o+"":o,s),s);class o extends Error{constructor(t,o,s){const r=`${t.status||0===t.status?t.status:""} ${t.statusText||""}`.trim();super(`Request failed with ${r?`status code ${r}`:"an unknown error"}: ${o.method} ${o.url}`),e(this,"response"),e(this,"request"),e(this,"options"),this.name="HTTPError",this.response=t,this.request=o,this.options=s}}class s extends Error{constructor(t){super(`Request timed out: ${t.method} ${t.url}`),e(this,"request"),this.name="TimeoutError",this.request=t}}const r=(()=>{let t=!1,e=!1;const o="function"==typeof globalThis.ReadableStream,s="function"==typeof globalThis.Request;if(o&&s)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(r){if(r instanceof Error&&"unsupported BodyInit type"===r.message)return!1;throw r}return t&&!e})(),n="function"==typeof globalThis.AbortController,i="function"==typeof globalThis.AbortSignal&&"function"==typeof globalThis.AbortSignal.any,a="function"==typeof globalThis.ReadableStream,h="function"==typeof globalThis.FormData,u=["get","post","put","patch","head","delete"],l={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},p=(new TextEncoder).encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,c=Symbol("stop"),f={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0},d={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},y=(t,e,o)=>{const s=(t=>{if(!t)return 0;if(t instanceof FormData){let e=0;for(const[o,s]of t)e+=p,e+=(new TextEncoder).encode(`Content-Disposition: form-data; name="${o}"`).length,e+="string"==typeof s?(new TextEncoder).encode(s).length:s.size;return e}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength;if("string"==typeof t)return(new TextEncoder).encode(t).length;if(t instanceof URLSearchParams)return(new TextEncoder).encode(t.toString()).length;if("byteLength"in t)return t.byteLength;if("object"==typeof t&&null!==t)try{const e=JSON.stringify(t);return(new TextEncoder).encode(e).length}catch{return 0}return 0})(null!=o?o:t.body);let r=0;return new Request(t,{duplex:"half",body:new ReadableStream({async start(o){const n=t.body instanceof ReadableStream?t.body.getReader():new Response("").body.getReader();await async function t(){const{done:i,value:a}=await n.read();if(i)return e&&e({percent:1,transferredBytes:r,totalBytes:Math.max(s,r)},new Uint8Array),void o.close();r+=a.byteLength;let h=0===s?0:r/s;(s<r||1===h)&&(h=.99),e&&e({percent:Number(h.toFixed(2)),transferredBytes:r,totalBytes:s},a),o.enqueue(a),await t()}()}})})},b=t=>null!==t&&"object"==typeof t,m=(...t)=>{for(const e of t)if((!b(e)||Array.isArray(e))&&void 0!==e)throw new TypeError("The `options` argument must be an object");return R({},...t)},g=(t={},e={})=>{const o=new globalThis.Headers(t),s=e instanceof globalThis.Headers,r=new globalThis.Headers(e);for(const[n,i]of r.entries())s&&"undefined"===i||void 0===i?o.delete(n):o.set(n,i);return o};function w(t,e,o){var s,r;return Object.hasOwn(e,o)&&void 0===e[o]?[]:R(null!=(s=t[o])?s:[],null!=(r=e[o])?r:[])}const _=(t={},e={})=>({beforeRequest:w(t,e,"beforeRequest"),beforeRetry:w(t,e,"beforeRetry"),afterResponse:w(t,e,"afterResponse"),beforeError:w(t,e,"beforeError")}),R=(...t)=>{let e={},o={},s={};for(const r of t)if(Array.isArray(r))Array.isArray(e)||(e=[]),e=[...e,...r];else if(b(r)){for(let[t,o]of Object.entries(r))b(o)&&t in e&&(o=R(e[t],o)),e={...e,[t]:o};b(r.hooks)&&(s=_(s,r.hooks),e.hooks=s),b(r.headers)&&(o=g(o,r.headers),e.headers=o)}return e},T=t=>u.includes(t)?t.toUpperCase():t,q={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3},x=(t={})=>{if("number"==typeof t)return{...q,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...q,...t}};class E{constructor(t,o={}){var s,a,u,l,p,c,f,d,b,m;if(e(this,"request"),e(this,"abortController"),e(this,"_retryCount",0),e(this,"_input"),e(this,"_options"),this._input=t,this._options={...o,headers:g(this._input.headers,o.headers),hooks:_({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},o.hooks),method:T(null!=(a=null!=(s=o.method)?s:this._input.method)?a:"GET"),prefixUrl:String(o.prefixUrl||""),retry:x(o.retry),throwHttpErrors:!1!==o.throwHttpErrors,timeout:null!=(u=o.timeout)?u:1e4,fetch:null!=(l=o.fetch)?l:globalThis.fetch.bind(globalThis)},"string"!=typeof this._input&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&"string"==typeof this._input){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(n&&i){const t=null!=(p=this._options.signal)?p:this._input.signal;this.abortController=new globalThis.AbortController,this._options.signal=t?AbortSignal.any([t,this.abortController.signal]):this.abortController.signal}if(r&&(this._options.duplex="half"),void 0!==this._options.json&&(this._options.body=null!=(d=null==(f=(c=this._options).stringifyJson)?void 0:f.call(c,this._options.json))?d:JSON.stringify(this._options.json),this._options.headers.set("content-type",null!=(b=this._options.headers.get("content-type"))?b:"application/json")),this.request=new globalThis.Request(this._input,this._options),void 0!==(m=this._options.searchParams)&&(Array.isArray(m)?m.length>0:m instanceof URLSearchParams?m.size>0:"object"==typeof m?Object.keys(m).length>0:"string"==typeof m?m.trim().length>0:Boolean(m))){const t="?"+("string"==typeof this._options.searchParams?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),e=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,t);!(h&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)||this._options.headers&&this._options.headers["content-type"]||this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(e,{...this.request}),this._options)}if(this._options.onUploadProgress){if("function"!=typeof this._options.onUploadProgress)throw new TypeError("The `onUploadProgress` option must be a function");if(!r)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request.body&&(this.request=y(this.request,this._options.onUploadProgress,this._options.body))}}static create(t,e){var s,r;const n=new E(t,e),i=async()=>{if("number"==typeof n._options.timeout&&n._options.timeout>2147483647)throw new RangeError("The `timeout` option cannot be greater than 2147483647");await Promise.resolve();let t=await n._fetch();for(const e of n._options.hooks.afterResponse){const o=await e(n.request,n._options,n._decorateResponse(t.clone()));o instanceof globalThis.Response&&(t=o)}if(n._decorateResponse(t),!t.ok&&n._options.throwHttpErrors){let e=new o(t,n.request,n._options);for(const t of n._options.hooks.beforeError)e=await t(e);throw e}if(n._options.onDownloadProgress){if("function"!=typeof n._options.onDownloadProgress)throw new TypeError("The `onDownloadProgress` option must be a function");if(!a)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return((t,e)=>{const o=Number(t.headers.get("content-length"))||0;let s=0;return 204===t.status?(e&&e({percent:1,totalBytes:o,transferredBytes:s},new Uint8Array),new Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new Response(new ReadableStream({async start(r){const n=t.body.getReader();e&&e({percent:0,transferredBytes:0,totalBytes:o},new Uint8Array),await async function t(){const{done:i,value:a}=await n.read();i?r.close():(e&&(s+=a.byteLength,e({percent:0===o?0:s/o,transferredBytes:s,totalBytes:o},a)),r.enqueue(a),await t())}()}}),{status:t.status,statusText:t.statusText,headers:t.headers})})(t.clone(),n._options.onDownloadProgress)}return t},h=(n._options.retry.methods.includes(n.request.method.toLowerCase())?n._retry(i):i()).finally((async()=>{var t;n.request.bodyUsed||await(null==(t=n.request.body)?void 0:t.cancel())}));for(const[o,a]of Object.entries(l))"bytes"===o&&"function"!=typeof(null==(r=null==(s=globalThis.Response)?void 0:s.prototype)?void 0:r.bytes)||(h[o]=async()=>{n.request.headers.set("accept",n.request.headers.get("accept")||a);const t=await h;if("json"===o){if(204===t.status)return"";if(0===(await t.clone().arrayBuffer()).byteLength)return"";if(e.parseJson)return e.parseJson(await t.text())}return t[o]()});return h}_calculateRetryDelay(t){var e,r,n,i;if(this._retryCount++,this._retryCount>this._options.retry.limit||t instanceof s)throw t;if(t instanceof o){if(!this._options.retry.statusCodes.includes(t.response.status))throw t;const o=null!=(n=null!=(r=null!=(e=t.response.headers.get("Retry-After"))?e:t.response.headers.get("RateLimit-Reset"))?r:t.response.headers.get("X-RateLimit-Reset"))?n:t.response.headers.get("X-Rate-Limit-Reset");if(o&&this._options.retry.afterStatusCodes.includes(t.response.status)){let t=1e3*Number(o);Number.isNaN(t)?t=Date.parse(o)-Date.now():t>=Date.parse("2024-01-01")&&(t-=Date.now());const e=null!=(i=this._options.retry.maxRetryAfter)?i:t;return t<e?t:e}if(413===t.response.status)throw t}const a=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,a)}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(e){const o=Math.min(this._calculateRetryDelay(e),2147483647);if(this._retryCount<1)throw e;await async function(t,{signal:e}){return new Promise(((o,s)=>{function r(){clearTimeout(n),s(e.reason)}e&&(e.throwIfAborted(),e.addEventListener("abort",r,{once:!0}));const n=setTimeout((()=>{null==e||e.removeEventListener("abort",r),o()}),t)}))}(o,{signal:this._options.signal});for(const t of this._options.hooks.beforeRetry){if(await t({request:this.request,options:this._options,error:e,retryCount:this._retryCount})===c)return}return this._retry(t)}}async _fetch(){for(const o of this._options.hooks.beforeRequest){const t=await o(this.request,this._options);if(t instanceof Request){this.request=t;break}if(t instanceof Response)return t}const t=((t,e)=>{const o={};for(const s in e)s in d||s in f||s in t||(o[s]=e[s]);return o})(this.request,this._options),e=this.request;return this.request=e.clone(),!1===this._options.timeout?this._options.fetch(e,t):async function(t,e,o,r){return new Promise(((n,i)=>{const a=setTimeout((()=>{o&&o.abort(),i(new s(t))}),r.timeout);r.fetch(t,e).then(n).catch(i).then((()=>{clearTimeout(a)}))}))}(e,t,this.abortController,this._options)}}
/*! MIT License © Sindre Sorhus */const P=t=>{const e=(e,o)=>E.create(e,m(t,o));for(const o of u)e[o]=(e,s)=>E.create(e,m(t,s,{method:o}));return e.create=t=>P(m(t)),e.extend=e=>("function"==typeof e&&(e=e(null!=t?t:{})),P(m(t,e))),e.stop=c,e};var v=P();export{v as k};
